---
description: è®°å½•Goæ•°æ®ç»“æ„ç›¸å…³çŸ¥è¯†
tags:
  - Go
date: 2024-12-12
---



# Goæ•°æ®ç»“æ„

## string

Goè¯­è¨€ä¸­ï¼Œstringå¯ä»¥çœ‹ä½œæ˜¯æ‰€æœ‰**8bit å­—èŠ‚**çš„é›†åˆï¼Œä¸€ä¸ªå­—èŠ‚æ•°ç»„ã€‚

- å­—ç¬¦ä¸²å¯ä»¥ä¸ºç©ºä¸²ï¼Œä½†ä¸èƒ½ä¸ºnil
- å­—ç¬¦ä¸²çš„å­—é¢å€¼æ˜¯åªè¯»çš„ï¼Œä¸å¯ä»¥è¢«ä¿®æ”¹
  - å­—ç¬¦ä¸²æ˜¯ä¸èƒ½è¢«ä¿®æ”¹çš„ï¼Œä½†æ˜¯å˜é‡å¯ä»¥é‡æ–°èµ‹å€¼

åœ¨æºç ä¸­ä¹Ÿç»™å‡ºäº†stringçš„ç»“æ„ï¼šå…¶ä¸­`str`æ˜¯**æŒ‡å‘å­—ç¬¦ä¸²é¦–åœ°å€çš„æŒ‡é’ˆ**ã€`len`è¡¨ç¤º**å­—ç¬¦ä¸²çš„é•¿åº¦**

```go
type stringStruct struct {
    str unsafe.Pointer
    len int
}
```

ğŸŒ°ï¼š

<img src="https://raw.githubusercontent.com/lyydsheep/pic/main/202410051022321.png" alt="image-20241005102225290" style="zoom:67%;" />

å€¼å¾—æ³¨æ„çš„æ˜¯ï¼Œ**lenè¡¨ç¤ºå­—ç¬¦ä¸²é•¿åº¦æ˜¯ä»¥å­—èŠ‚æ•°è®¡é‡çš„**ï¼Œè€Œéå­—ç¬¦æ•°ã€‚

ä¸¾ä¸ªğŸŒ°ï¼šå­—ç¬¦ä¸²`hello`çš„å­—èŠ‚æ•°å’Œå­—ç¬¦æ•°æ˜¯5ï¼Œé•¿åº¦ä¹Ÿæ˜¯5ï¼›è€Œå­—ç¬¦ä¸²`helloå•Š`çš„å­—èŠ‚æ•°æ˜¯8ã€å­—ç¬¦æ•°æ˜¯6ï¼Œè€Œé•¿åº¦åŒå­—èŠ‚æ•°ä¸€æ ·æ˜¯8

æ‰€ä»¥å¯¹åŒ…å«éå•å­—èŠ‚ç¼–ç çš„å­—ç¬¦çš„å­—ç¬¦ä¸²è¿›è¡Œ`len()`æ“ä½œï¼Œå¯èƒ½ä¼šå¾—åˆ°æ„æƒ³ä¸åˆ°çš„ç»“æœ

### stringå’Œ[]byteçš„äº’ç›¸è½¬æ¢

stringå’Œ[]byteçš„è½¬åŒ–ï¼ˆä¸€èˆ¬ï¼‰ä¼šå‘ç”Ÿä¸€æ¬¡å†…å­˜æ‹·è´ï¼Œå¹¶ç”³è¯·ä¸€å—æ–°çš„åˆ‡ç‰‡å†…å­˜ç©ºé—´

**[]byteè½¬ä¸ºstringçš„å¤§è‡´è¿‡ç¨‹ï¼š**

- ç”³è¯·ä¸€å—æ–°çš„å†…å­˜ç©ºé—´ï¼Œå¹¶è®°å½•é¦–åœ°å€`addr`å’Œå­—èŠ‚é•¿åº¦`len`
- æ„å»ºstringå¯¹è±¡ï¼ŒæŒ‡é’ˆåœ°å€ä¸º`addr`ï¼Œ`len`å­—æ®µèµ‹å€¼ä¸º`len`
- å°†æºå­—èŠ‚åˆ‡ç‰‡ä¸­çš„æ•°æ®æ‹·è´åˆ°åˆšç”³è¯·çš„å†…å­˜ç©ºé—´ä¸­

![image-20241005103541446](https://raw.githubusercontent.com/lyydsheep/pic/main/202410051035476.png)

stringè½¬ä¸º[]byteçš„å¤§è‡´è¿‡ç¨‹ï¼š

- ç”³è¯·ä¸€å—æ–°çš„å†…å­˜ç©ºé—´

- å°†stringæŒ‡é’ˆæ‰€æŒ‡å‘çš„å†…å­˜åŒºåŸŸæ‹·è´`len`å­—èŠ‚åˆ°åˆšç”³è¯·çš„ç©ºé—´ä¸­

  ![image-20241005103722955](https://raw.githubusercontent.com/lyydsheep/pic/main/202410051037987.png)

âš ï¸ï¼šå½“**è½¬åŒ–ä¸ºçš„å­—ç¬¦ä¸²è¢«ç”¨äºä¸´æ—¶åœºæ™¯æ—¶**ï¼Œstringå’Œ[]byteä¹‹é—´çš„è½¬æ¢å¹¶**ä¸ä¼šå‘ç”Ÿæ‹·è´**

ä¾‹å¦‚ï¼š

- å­—ç¬¦ä¸²æ¯”è¾ƒï¼šstring(ss) == "hello"
- å­—ç¬¦ä¸²æ‹¼æ¥ï¼š"hello" + string(ss) + "world"
- ç”¨äºæŸ¥æ‰¾ï¼šk, v := map[string(ss)]

åœ¨ä¸Šè¿°åœºæ™¯ä¸­ï¼Œ[]byteè½¬æ¢çš„å­—ç¬¦ä¸²åªæœ‰ä¸´æ—¶ä½œç”¨ï¼Œåœ¨åç»­ç¨‹åºä¸­ä¸ä¼šå†æ¬¡ä½¿ç”¨ï¼Œæ‰€ä»¥å¹¶ä¸ä¼šæ‹·è´åˆ°å†…å­˜ï¼Œè€Œæ˜¯ç›´æ¥è¿”å›ä¸€ä¸ªstringï¼Œè¿™ä¸ªstringçš„æŒ‡é’ˆå°±æŒ‡å‘å­—èŠ‚åˆ‡ç‰‡çš„å†…å­˜åœ°å€

## slice

åœ¨Goè¯­è¨€ä¸­ï¼Œsliceæ˜¯åŸºäºæ•°ç»„å°è£…å‡ºæ¥çš„æŠ½è±¡æ•°æ®ç»“æ„ã€‚å› æ­¤åœ¨è§£æsliceä¹‹å‰ï¼Œéœ€è¦å…ˆè®¤è¯†è®¤è¯†golangä¸­çš„æ•°ç»„ã€‚

Goè¯­è¨€ä¸­çš„æ•°ç»„æ˜¯ä¸€ç§å€¼ç±»å‹ï¼Œå’ŒCè¯­è¨€ä¸­çš„æŒ‡é’ˆç±»å‹ä¸åŒï¼Œæ‰€ä»¥åœ¨Goä¸­å¯¹æ•°ç»„è¿›è¡Œå¤åˆ¶ã€ä¼ å‚éƒ½æ˜¯è¿›è¡Œ**å€¼å¤åˆ¶**æ“ä½œï¼Œå°±å’Œ`int`ã€`float64`è¿™äº›åŸºæœ¬æ•°æ®ç±»å‹ç±»ä¼¼

æ•°ç»„ç±»å‹åœ¨golangä¸­ç”±**æ•°ç»„å¤§å°å’Œæ•°æ®ç±»å‹**å…±åŒå†³å®šï¼ŒéªŒè¯ä¾‹å­å¦‚ä¸‹ï¼š

```go
	arr := [3]int{1, 2, 3}
	fmt.Printf("arr`s type is %T", arr)
	//arr`s type is [3]int
```

æ­£å› ä¸ºæ•°ç»„ç±»å‹åœ¨åˆå§‹æ—¶å°±è¢«ç¡®å®šï¼ˆå¤§å°å’Œæ•°æ®ç±»å‹ï¼‰ï¼Œæ‰€ä»¥åœ¨é¢å¯¹ä¸€äº›åŠ¨æ€å­˜å‚¨çš„åœºæ™¯æ—¶æ•°ç»„å°±æœ‰ç‚¹åŠ›ä¸ä»å¿ƒäº†ã€‚

**slice**å°±æ˜¯ä¸ºäº†è§£å†³æ•°ç»„åœ¨é•¿åº¦ä¸Šä¸å¯å¢é•¿çš„é—®é¢˜ï¼ŒåŸºäºæ•°ç»„å®ç°äº†**å˜é•¿æ•°ç»„**çš„æœºåˆ¶

### sliceåº•å±‚ç»“æ„

sliceåº•å±‚ç»“æ„å¦‚ä¸‹ï¼š

```go
type slice struct {
    // åº•å±‚æ•°ç»„æŒ‡é’ˆ
    array unsafe.Pointer
    // sliceçš„é•¿åº¦
    len int
    // å®¹é‡
    cap int
}
```

sliceæ‰©å®¹ä¸¤æ­¥éª¤ï¼š

1. è®¡ç®—æ‰€éœ€å®¹é‡
   1. å¦‚æœ**æ–°åˆ‡ç‰‡çš„é•¿åº¦ï¼æ—§åˆ‡ç‰‡çš„å®¹é‡çš„ä¸¤å€**ï¼Œé‚£ä¹ˆæ–°åˆ‡ç‰‡çš„å®¹é‡ç­‰äºé•¿åº¦
   2. å¦åˆ™
      1. å¦‚æœ**æ—§åˆ‡ç‰‡çš„å®¹é‡ï¼œ256**ï¼Œé‚£ä¹ˆæ–°åˆ‡ç‰‡çš„å®¹é‡å°±æ˜¯åŸå®¹é‡çš„ä¸¤å€
      2. å¦åˆ™æ–°åˆ‡ç‰‡çš„å®¹é‡å°±æ˜¯**1.25 * åŸåˆ‡ç‰‡å®¹é‡+3/4 * 256**
2. å†…å­˜å¯¹é½ï¼Œç¡®å®šæœ€ç»ˆå®¹é‡
   1. æŒ‰ç…§Goå†…å­˜ç®¡ç†çš„çº§åˆ«ç¡®å¯¹é½å†…å­˜ï¼Œæœ€ç»ˆå®¹é‡ä»¥æ­¤ä¸ºå‡†

### sliceé—®é¢˜è§£å¯†

- sliceé€šè¿‡å‡½æ•°ä¼ é€’çš„æ˜¯ä»€ä¹ˆï¼Ÿ

  - ä¼ é€’çš„æ˜¯åº•å±‚sliceç»“æ„ä½“çš„æ‹·è´

  - ```go
    func PrintSliceStruct(s *[]int) {
    	ss := (*reflect.SliceHeader)(unsafe.Pointer(s))
    	fmt.Printf("slice struct: %+v, slice is %v\n", ss, s)
    }
    
    func test(s []int) {
    	fmt.Printf("slice address in main is %p	", &s)
    	PrintSliceStruct(&s)
    }
    
    func main() {
    	s := make([]int, 5, 10)
    	fmt.Printf("slice address in main is %p	", &s)
    	PrintSliceStruct(&s)
    	test(s)
    	/*
    	slice address in main is 0xc000008048	slice struct: &{Data:824633788048 Len:5 Cap:10}, slice is &[0 0 0 0 0]
    	slice address in main is 0xc000008078	slice struct: &{Data:824633788048 Len:5 Cap:10}, slice is &[0 0 0 0 0]
    	 */
    }
    ```

- åœ¨å‡½æ•°é‡Œé¢æ”¹å˜sliceï¼Œå¤–å±‚ä¼šå—åˆ°å½±å“å—ï¼Ÿ

  - åªè¦ä¿®æ”¹çš„åº•å±‚æ•°ç»„æ˜¯åŒä¸€ä¸ªï¼Œé‚£ä¹ˆå°±ä¼šå—åˆ°å½±å“
```
    func test1(s []int) {
    	s[0] = 7
    	fmt.Printf("test1 value %v\n", s)
    }
    
    func test2(s []int) {
    	s = append(s, 4)
    	fmt.Printf("test2 value %v\n", s)
    }
    
    func main() {
    	s := []int{1, 2, 3}
    	fmt.Printf("initial value of s: %v\n", s)
    	test1(s) // åº•å±‚æ•°ç»„ç›¸åŒï¼Œä¼šå—åˆ°å½±å“
    	fmt.Printf("after test1, value of s: %v\n", s)
    	test2(s) // åº•å±‚æ•°ç»„å‘ç”Ÿå˜åŒ–ï¼Œä¸å—å½±å“
    	fmt.Printf("after test2, value of s: %v\n", s)
    	/*
    	initial value of s: [1 2 3]
    	test1 value [7 2 3]
    	after test1, value of s: [7 2 3]
    	test2 value [7 2 3 4]
    	after test2, value of s: [7 2 3]
    	 */
    }
```
## sync.map

è¿™é‡Œæ˜¯sync.map