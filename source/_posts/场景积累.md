---
date: 2025-09-24
title: 场景积累
---
## 常见问题及解决方法
### 接口幂等性
+ 数据库唯一键
    - 唯一键（插入操作）
    - 防重表（插入操作）
+ 乐观锁
    - 更新操作
+ 防重 token
    - 插入、更新操作
    - 可能由于网络原因，客户端无法感知服务端处理请求失败

### 定时任务
+ cron 表达式
+ 定时扫表
    - MySQL、Redis
+ 延迟队列（多级时间轮）
    - rocketmq

### 数据一致性
+ 强一致
    - 分布式事务（TCC）
    - 分布式锁
+ 最终一致性
    - 先写 MySQL，再删 Redis
    - 延迟双删
    - 异步更新
    - 消息队列补偿
    - 通过canal 订阅 binlog

### 消息推送
+ 推模式
    - 优点
        * 实时性高
        * 生产者控制发送时机
    - 缺点
        * 资源浪费，消息可能不是消费者所需要的
        * 消费者可能过载，如果生产速度过快，消费者可能会崩溃
+ 拉模式
    - 优点
        * 消费者控制
    - 缺点
        * 实时性差
        * 额外的轮询开销

## 《亿级流量系统》
### 高并发读场景方案
+ 数据库读/写分离
+ 本地缓存
+ 分布式缓存

CQRS （command query responsibility segregation）模式：是一种将数据的读取操作与更新操作分离的模式。

![](https://cdn.nlark.com/yuque/0/2025/png/36232735/1758720984962-86855ebf-d5df-4b68-a1fe-5ea15bdca742.png)

下面是在一个多表关联查询场景使用 CQRS 模式的例子：

![](https://cdn.nlark.com/yuque/0/2025/png/36232735/1758721355686-457bc1ec-ee4e-45aa-884f-da6ad35c2696.png)

