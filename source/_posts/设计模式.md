---
date: 2024-12-15
title: è®¾è®¡æ¨¡å¼
---

# è®¾è®¡æ¨¡å¼

> è¿™æ˜¯[Easyæå®šGolangè®¾è®¡æ¨¡å¼](https://www.bilibili.com/video/BV1Eg411m7rV/?spm_id_from=333.1387.collection.video_card.click&vd_source=a15269894d9b8114cb5f9bb663d22be9)çš„å­¦ä¹ è®°å½•

## é¢å‘å¯¹è±¡è®¾è®¡åŸåˆ™

### å•ä¸€èŒè´£åŸåˆ™

ç±»çš„èŒè´£å•ä¸€ï¼Œå¯¹å¤–åªæä¾›ä¸€ç§åŠŸèƒ½ï¼Œè€Œå¼•èµ·ç±»çš„å˜åŒ–çš„åŸå› é€šå¸¸åªæœ‰ä¸€ä¸ªã€‚è¿™æ˜¯ä¸ºäº†é¿å…åˆ«äººçœ‹ä»£ç æ—¶äº§ç”Ÿæ­§ä¹‰ï¼Œæé«˜ä»£ç çš„é€»è¾‘æ€§

è®¾è®¡ä¸€ä¸ªç±»ï¼Œå¯¹å¤–æä¾›çš„åŠŸèƒ½åº”è¯¥å•ä¸€ï¼Œæ¥å£å•ä¸€ï¼Œä»…æœ‰è¿™ä¸ªæ¥å£ä¼šå½±å“è¿™ä¸ªç±»ã€‚ä¸€ä¸ªç±»çš„ä¸€ä¸ªæ¥å£åº”å…·å¤‡è¿™ä¸ªç±»çš„åŠŸèƒ½å«ä¹‰ï¼ŒèŒè´£å•ä¸€å¹¶ä¸”ä¸å¤æ‚

### å¼€é—­åŸåˆ™

> å¯¹æ‰©å±•å¼€æ”¾ï¼Œå¯¹ä¿®æ”¹å…³é—­

å¦‚æœæˆ‘ä»¬æƒ³ä¸ºæŸä¸ªç±»å¢æ·»æ–°çš„åŠŸèƒ½ï¼Œæœ€å¥½çš„æ–¹æ³•æ˜¯åŸºäºæ¥å£æˆ–è€…ç»„åˆçš„æ–¹å¼å¯¹å…¶è¿›è¡Œæ‰©å±•ï¼Œè€Œä¸æ˜¯åœ¨åŸæœ‰çš„ç±»ä»£ç ä¸Šè¿›è¡Œä¿®æ”¹ã€‚æ¯”å¦‚ä¸€ä¸ªç±»å·²ç»æœ‰äº†99ä¸ªæ–¹æ³•ï¼Œé‚£ä¹ˆå¢æ·»ç¬¬100ä¸ªæ–¹æ³•æ—¶å°±å¾ˆæœ‰å¯èƒ½å¯¼è‡´å‰é¢99ä¸ªæ–¹æ³•æ— æ³•æ­£å¸¸å·¥ä½œï¼ˆæ¯•ç«Ÿè°çŸ¥é“é‚£99ä¸ªæ–¹æ³•ç”¨äº†ä»€ä¹ˆå¥‡æŠ€æ·«å·§ï¼‰

æ‰€ä»¥å¼€é—­åŸåˆ™çš„æ ¸å¿ƒæ€æƒ³å°±æ˜¯ï¼šä¸æ˜¯é€šè¿‡ä¿®æ”¹ä»£ç ,è€Œæ˜¯é€šè¿‡å¢æ·»ä»£ç æ¥ç»™ç³»ç»Ÿæ·»åŠ åŠŸèƒ½

### ä¾èµ–å€’è½¬åŸåˆ™ï¼ˆé‡è¦ï¼‰

æ„Ÿè§‰ä¾èµ–å€’è½¬åŸåˆ™çš„æ ¸å¿ƒå°±æ˜¯**é¢å‘æ¥å£ç¼–ç¨‹**
<img src="https://raw.githubusercontent.com/lyydsheep/pic/main/202412121814145.png" />

é¦–å…ˆéœ€è¦åšå¥½ä¸­é—´æŠ½è±¡å±‚çš„è®¾è®¡ï¼Œç„¶åä¾ç…§è¿™æŠ½è±¡å±‚ä¸€æ¬¡å°†å®ç°å±‚çš„æ¯ä¸€ä¸ªæ¨¡å—è¿›è¡Œå®ç°ã€‚è¿™ä¸€æ­¥æç°äº†å®ç°å±‚**å‘ä¸Šä¾èµ–æŠ½è±¡å±‚**
å¦ä¸€æ–¹é¢ï¼ŒæŠ½è±¡å±‚å‘ä¸šåŠ¡é€»è¾‘å±‚æš´éœ²å‡ºåŠŸèƒ½çš„æ¥å£ï¼Œä¸šåŠ¡é€»è¾‘å±‚åªéœ€è¦æ ¹æ®æš´éœ²å‡ºæ¥çš„æ¥å£å®ç°å¯¹ä¹Ÿçš„ä¸šåŠ¡é€»è¾‘å³å¯ï¼Œæ— éœ€å…³ç³»åŠŸèƒ½å…·ä½“æ˜¯å¦‚ä½•å®ç°

### åˆæˆå¤ç”¨åŸåˆ™

å¦‚æœä½¿ç”¨ç»§æ‰¿ï¼Œä¼šå¯¼è‡´çˆ¶ç±»çš„ä»»ä½•å˜æ¢éƒ½å¯èƒ½å½±å“åˆ°å­ç±»çš„è¡Œä¸ºã€‚å¦‚æœä½¿ç”¨ç»„åˆï¼Œå°±å¤§å¤§é™ä½äº†è¿™ç§ä¾èµ–å…³ç³»ã€‚å¯¹äºç»„åˆå’Œç»§æ‰¿ï¼Œä¼˜å…ˆä½¿ç”¨ç»„åˆã€‚ï¼ˆGoå¤©ç„¶å®ç°ç»„åˆğŸ˜‚ï¼‰
æ¯”å¦‚çˆ¶ç±»æœ‰100ä¸ªæ–¹æ³•ï¼Œè€Œå­ç±»åªæƒ³ä½¿ç”¨å…¶ä¸­çš„æŸä¸€ä¸ªæ–¹æ³•ï¼Œé‚£ä¹ˆå­ç±»é‡‡ç”¨ç»„åˆçš„æ–¹å¼å°±èƒ½å±è”½æ‰çˆ¶ç±»çš„å…¶ä»–99ä¸ªæ–¹æ³•

### è¿ªç±³ç‰¹æ³•åˆ™

ä¸€ä¸ªå¯¹è±¡åº”å½“å¯¹å…¶ä»–å¯¹è±¡å°½å¯èƒ½äº†è§£å¾—å°‘ï¼Œä»è€Œé™ä½å„ä¸ªå¯¹è±¡ä¹‹é—´çš„è€¦åˆï¼Œæé«˜ç³»ç»Ÿçš„å¯ç»´æŠ¤æ€§ã€‚

## åˆ›å»ºå‹æ¨¡å¼
### ç®€å•å·¥å‚æ¨¡å¼

**ä¸šåŠ¡é€»è¾‘å±‚ --->  å·¥å‚æ¨¡å— ---> åŸºç¡€ç±»æ¨¡å—**

åä¾‹ï¼šä¸šåŠ¡é€»è¾‘å±‚ ---> åŸºç¡€ç±»æ¨¡å—
```go
type Fruit struct {  
}  
  
func (f *Fruit) Name() {  
    }  
  
func NewFruit(name string) *Fruit {  
    res := &Fruit{}  
    switch {  
    case name == "apple":  
       // do something  
    case name == "pear":  
       // do something  
    default:  
       // do something  
    }  
    return res  
}  
  
func main() {  
    apple := NewFruit("apple")  
    apple.Name()  
    pear := NewFruit("pear")  
    pear.Name()  
}
```
ç®€å•å·¥å‚æ¨¡å¼å®ç°ä»£ç ï¼š
```go
type Fruit interface {  
    Show()  
}  
  
type Apple struct {  
}  
  
func (a *Apple) Show() {  
}  
  
type Pear struct{  
}  
  
func (p *Pear) Show() {  
}  
  
type Banana struct{  
}  
  
func (b *Banana) Show() {  
}  
  
type Factory struct{}  
  
func (f *Factory) CreateFruit(name string) (Fruit, bool) {  
    var fruit Fruit  
    ok := false  
    switch {  
    case name == "apple":  
       fruit, ok = new(Apple), true  
    case name == "pear":  
       fruit, ok = new(Pear), true  
    case name == "banana":  
       fruit, ok = new(Banana), true  
    }  
    return fruit, ok  
}  
  

```

![image.png](https://raw.githubusercontent.com/lyydsheep/pic/main/202412151724598.png)

**ä¼˜ç‚¹**ï¼š
1. å®ç°äº†å¯¹è±¡åˆ›å»ºå’Œä½¿ç”¨çš„åˆ†ç¦»
**ç¼ºç‚¹**ï¼š
1. è¿æ³•â€œå¼€é—­åŸåˆ™â€
2. å·¥å‚ç±»èŒè´£è¿‡é‡ï¼Œä¸€æ—¦ä¸èƒ½å·¥ä½œï¼Œç³»ç»Ÿæ·±å—å½±å“
3. å¤æ‚åº¦å’Œç†è§£åº¦éšç€ç±»çš„ä¸ªæ•°å¢åŠ 

### å·¥å‚æ¨¡å¼

å·¥å‚æ¨¡å¼å°±æ˜¯â€œç®€å•å·¥å‚æ¨¡å¼ + å¼€é—­åŸåˆ™â€
åœ¨Goé‡Œé¢ï¼Œå®ç°å·¥å‚æ¨¡å¼æ¯”è¾ƒå¸¸è§çš„å†™æ³•å°±æ˜¯`Newxxx()`
```go
func NewFactory() *Factory {  
    return &Factory{}  
}
```
### å•ä¾‹æ¨¡å¼

> ä¿è¯ä¸€ä¸ªç±»æ°¸è¿œåªèƒ½æœ‰ä¸€ä¸ªå¯¹è±¡ï¼Œä¸”è¯¥å¯¹è±¡çš„åŠŸèƒ½ä¾ç„¶èƒ½è¢«å…¶ä»–æ¨¡å—ä½¿ç”¨

**é¥¿æ±‰å¼**ï¼š
```go
type single struct{}  
  
var instance = new(single)  
  
func (s *single) Show() {  
    // do something  
}  
  
func GetInstance() *single {  
    return instance  
}
```
**æ‡’æ±‰å¼**ï¼šå»¶è¿Ÿåˆå§‹åŒ–ï¼Œç›´åˆ°è°ƒç”¨GetInstanceæ–¹æ³•æ—¶æ‰è¿›è¡Œåˆå§‹åŒ–ã€‚éœ€è¦é‡ç‚¹å…³å¿ƒçš„æ˜¯å¦‚ä½•ä¿è¯å¹¶å‘å®‰å…¨
	- é”
	- åŸå­æ“ä½œ
	- once
```go
type single struct{}  
  
var (  
    instance *single  
    mtx sync.RWMutex  
    lock uint32  
    once sync.Once  
)  
  
func GetInstance() *single {  
    // ä¿è¯å¹¶å‘å®‰å…¨ï¼šé”ã€åŸå­æ“ä½œã€once  
    // åŸå­æ“ä½œ  
    //if atomic.LoadUint32(&lock) == 1 {  
    // return instance    //}    //mtx.Lock()    //defer mtx.Unlock()    //instance = new(single)    //return instance        // once  
    once.Do(func() {  
       instance = new(single)  
    })  
    return instance  
}
```
## ç»“æ„å‹æ¨¡å¼

### ä»£ç†æ¨¡å¼
![image.png](https://raw.githubusercontent.com/lyydsheep/pic/main/202412182052160.png)

**Subject**ï¼šå…·ä½“ä¸»é¢˜å’Œä»£ç†ä¸»é¢˜çš„å…¬å…±æ¥å£
**RealSubject**ï¼šå…·ä½“ä¸»é¢˜
**Proxy**ï¼šä»£ç†ä¸»é¢˜ï¼Œ**åŒ…å«äº†å¯¹å…·ä½“ä¸»é¢˜è§’è‰²çš„å¼•ç”¨**ï¼Œé€šå¸¸å¯ä»¥åœ¨ä»£ç†ä¸»é¢˜ä¸­å°è£…å…·ä½“ä¸»é¢˜éœ€è¦æ‰§è¡Œçš„ä¸€äº›æµç¨‹ï¼Œæé«˜ä»£ç å¤ç”¨æ€§

```go
type D interface {  
    Dance()  
}  
  
type KunDance struct {  
}  
  
func (k *KunDance) Dance() {  
    fmt.Println("KunDance")  
}  
  
type KunKunDance struct{}  
  
func (k *KunKunDance) Dance() {}  
  
type SingDanceRap struct {  
    d D  
}  
  
func (s *SingDanceRap) Dance() {  
    s.Sing()  
    // åŠ¨æ€è°ƒç”¨æŸä¸€ä¸ªDanceæ–¹æ³•  
    s.d.Dance()  
    s.Rap()  
}  
  
func (s *SingDanceRap) Sing() {}  
  
func (s *SingDanceRap) Rap() {}  
  
func NewSingDanceRap(d D) D {  
    return &SingDanceRap{  
       d: d,  
    }  
}
```
æ„Ÿè§‰æ ¸å¿ƒç‚¹åœ¨äºï¼Œå®ç°ä¸€ä¸ªå…¬å…±çš„æ¥å£ï¼Œå°è£…ä¸€äº›é‡å¤æ€§çš„ä»£ç ï¼Œæé«˜å¤ç”¨ğŸ¤”

### è£…é¥°å™¨æ¨¡å¼

è£…é¥°å™¨æ¨¡å¼å’Œä»£ç†æ¨¡å¼å¾ˆåƒï¼Œéƒ½æ˜¯åœ¨åŸæœ‰æ¥å£ä¸Šè¿›è¡ŒåŠŸèƒ½çš„æ‰©å±•ã€‚å…¸å‹çš„æ¨¡æ¿å°±æ˜¯**ç»“æ„ä½“ ç»„åˆ å¾…æ‰©å±•çš„æ¥å£**
```go
type Phone interface {  
    Show()  
}  
  
type Hua struct {  
}  
  
func (h *Hua) Show() {  
  
}  
  
type PhonePlus struct {  
    Phone  
}  
  
func (pp *PhonePlus) Show() {  
  
}  
  
func (pp *PhonePlus) AnotherMethod() {  
  
}
```

### é€‚é…å™¨æ¨¡å¼

é€‚é…å™¨æ¨¡å¼å¯ä»¥å®ç°ä¸€ä¸ªç±»æˆ–æ¥å£èƒ½å¤Ÿåœ¨ä¸€ä¸ªä¸ä¹‹æ¯«ä¸ç›¸å¹²çš„æ¥å£ç¯å¢ƒè¿è¡Œã€ä½œç”¨

![image.png](https://raw.githubusercontent.com/lyydsheep/pic/main/202412202127687.png)

```go
type V5 interface{  
    Use5() }  
  
type V220 interface{  
    Use220()  
}  
  
type Adapter struct {  
    v220 V220  
}  
  
func (a *Adapter) Use5() {  
    a.v220.Use220()  
}  
  
func NewAdapter(v220 V220) *Adapter {  
    return &Adapter{v220: v220}  
}
```

### å¤–è§‚æ¨¡å¼

å¤–è§‚æ¨¡å¼æœ¬è´¨ä¸Šå°±æ˜¯æ·»åŠ ä¸€ä¸ªä¸­é—´å±‚ï¼Œè¿™ä¸ªä¸­é—´å±‚å‘ä¸Šå±‚æä¾›äº†åº•å±‚APIçš„å°è£…ï¼Œé™ä½äº†ä¸šåŠ¡å±‚å’Œåº•å±‚çš„è€¦åˆ
```go
type A struct {}  
  
func (a *A)work() {  
    }  
  
type T struct {  
    a *A  
}
```

## è¡Œä¸ºå‹æ¨¡å¼
### æ¨¡æ¿æ–¹æ³•æ¨¡å¼

æ¨¡æ¿æ–¹æ³•æ¨¡å¼å¯ä»¥ç”¨äºç»Ÿä¸€æ¥å£æ–¹æ³•çš„æ“ä½œæ­¥éª¤ï¼Œå¿½è§†æ¯ä¸ªå®ä¾‹å¯¹äºæ–¹æ³•çš„å…·ä½“å®ç°
ï¼ˆGoç¡®å®ä¸é€‚åˆæŒ‰ç…§ä¸¥æ ¼çš„è®¾è®¡æ¨¡å¼ç±»å›¾è¿›è¡Œç¼–ç ï¼‰

```go
type Work interface {  
    Step1()  
    Step2()  
    Step3()  
}  
  
type WorkFlow interface {  
    DoSomething()  
}  
  
type BasicWorkFlow struct {  
    Work  
}  
  
func (wf *BasicWorkFlow) DoSomething() {  
    wf.Step1()  
    wf.Step2()  
    wf.Step3()  
}
```

### å‘½ä»¤æ¨¡å¼

å‘½ä»¤æ¨¡å¼æ˜¯åœ¨ä¸€ä¸ªåŠŸèƒ½ç±»ä¸Šæä¾›ç‰¹æ®Šçš„å‘½ä»¤ç±»ï¼Œç”¨äºåŒºåˆ†åŠŸèƒ½ç±»ä¸­çš„ç‰¹å®šåŠŸèƒ½ã€‚å‘ä¸šåŠ¡æ–¹å±è”½äº†åŠŸèƒ½ç±»çš„å…·ä½“ç»†èŠ‚ã€‚åœ¨å‘½ä»¤ç±»çš„åŸºç¡€ä¸Šç»„åˆå‡ºä¸€ä¸ªä¸­é—´ç±»ï¼Œä¸­é—´ç±»å‘ä¸šåŠ¡æ–¹æä¾›ç»Ÿä¸€çš„æ¥å£ï¼Œè¿›ä¸€æ­¥å±è”½äº†ä¸åŒå‘½ä»¤ä¹‹é—´çš„å·®å¼‚

```go
type Doctor struct {}  
  
func (d *Doctor) treatEye() {  
    }  
  
type Cmd interface {  
    Treat()  
}  
  
type Nurse struct {  
    cmds []Cmd  
}  
  
func (n *Nurse) Notify() {  
    if n.cmds == nil {  
       return  
    }  
    for i := range n.cmds {  
       n.cmds[i].Treat()  
    }  
}  
  
func (d *Doctor) treatNose() {}  
  
type cmdEye struct {  
    d *Doctor  
}  
  
func (c *cmdEye) Treat() {  
    c.d.treatEye()  
}  
  
type cmdNose struct {  
    d *Doctor  
}
```
### ç­–ç•¥æ¨¡å¼

ä¸ºç¯å¢ƒç±»é…ç½®ä¸€ä¸ªæ¥å£ï¼Œé€šè¿‡è¿™ä¸ªæ¥å£ç”¨æˆ·å¯ä»¥è‡ªç”±åˆ‡æ¢åŠŸèƒ½ç›¸åŒä½†å®ç°ä¸åŒçš„ç®—æ³•

![image.png](https://raw.githubusercontent.com/lyydsheep/pic/main/202412242041157.png)

```go
type Strategy interface {  
    UseWeapon()  
}  
  
type AK struct{}  
  
func (a *AK) UseWeapon() {  
    fmt.Println("ak")  
}  
  
type Knife struct{}  
  
func (k *Knife) UseWeapon() { fmt.Println("k") }  
  
type Person struct {  
    s Strategy  
}  
  
func (p *Person) SetStrategy(s Strategy) {  
    p.s = s  
}  
  
func (p *Person) Fight() {  
    p.s.UseWeapon()  
}

```
### è§‚å¯Ÿè€…æ¨¡å¼

å¦‚æœç³»ç»Ÿéœ€è¦åˆ›å»ºä¸€ä¸ªè§¦å‘é“¾ï¼ŒAå¯¹è±¡çš„è¡Œä¸ºå½±å“Bå¯¹è±¡ï¼ŒBå¯¹è±¡çš„è¡Œä¸ºå½±å“Cå¯¹è±¡...ï¼Œå°±å¯ä»¥ä½¿ç”¨è§‚å¯Ÿè€…æ¨¡å¼åˆ›å»ºä¸€ç§é“¾å¼è§¦å‘æœºåˆ¶
![image.png](https://raw.githubusercontent.com/lyydsheep/pic/main/202412242129694.png)

```go
type Listener interface {  
    OnTeacherComing()  
}  
  
type StuZ3 struct {  
    badThing string  
}  
  
func (s *StuZ3) OnTeacherComing() {  
    fmt.Println("z3 stop", s.badThing)  
}  
  
type StuZ4 struct {  
    badThing string  
}  
  
func (s *StuZ4) OnTeacherComing() {  
    fmt.Println("z3 stop", s.badThing)  
}  
  
type StuW5 struct {  
    badThing string  
}  
  
func (s *StuW5) OnTeacherComing() {  
    fmt.Println("z3 stop", s.badThing)  
}  
  
type Notifier interface {  
    Add(l Listener)  
    Del(l Listener)  
    Notify()  
}  
  
type Monitor struct {  
    listeners []Listener  
}  
  
func (m *Monitor) Add(l Listener) {  
    if m.listeners != nil {  
       m.listeners = append(m.listeners, l)  
    }  
}  
  
func (m *Monitor) Del(l Listener) {  
    //TODO implement me  
    panic("implement me")  
}  
  
func (m *Monitor) Notify() {  
    for i := range m.listeners {  
       m.listeners[i].OnTeacherComing()  
    }  
}
```
