{"meta":{"version":1,"warehouse":"5.0.1"},"models":{"Asset":[{"_id":"themes/sea/source/css/base.css","path":"css/base.css","modified":0,"renderable":1},{"_id":"themes/sea/source/css/media.css","path":"css/media.css","modified":0,"renderable":1},{"_id":"themes/sea/source/css/main.styl","path":"css/main.styl","modified":0,"renderable":1},{"_id":"themes/sea/source/css/variables.css","path":"css/variables.css","modified":0,"renderable":1},{"_id":"themes/sea/source/js/main.js","path":"js/main.js","modified":0,"renderable":1},{"_id":"themes/sea/source/js/theme_mode.js","path":"js/theme_mode.js","modified":0,"renderable":1},{"_id":"themes/sea/source/js/theme.js","path":"js/theme.js","modified":0,"renderable":1},{"_id":"themes/sea/source/css/partial/archive.css","path":"css/partial/archive.css","modified":0,"renderable":1},{"_id":"themes/sea/source/css/partial/common.css","path":"css/partial/common.css","modified":0,"renderable":1},{"_id":"themes/sea/source/css/partial/footer.css","path":"css/partial/footer.css","modified":0,"renderable":1},{"_id":"themes/sea/source/css/partial/friends.css","path":"css/partial/friends.css","modified":0,"renderable":1},{"_id":"themes/sea/source/css/partial/hero.css","path":"css/partial/hero.css","modified":0,"renderable":1},{"_id":"themes/sea/source/css/partial/index.css","path":"css/partial/index.css","modified":0,"renderable":1},{"_id":"themes/sea/source/css/partial/layout.css","path":"css/partial/layout.css","modified":0,"renderable":1},{"_id":"themes/sea/source/css/partial/menu.css","path":"css/partial/menu.css","modified":0,"renderable":1},{"_id":"themes/sea/source/css/partial/nav.css","path":"css/partial/nav.css","modified":0,"renderable":1},{"_id":"themes/sea/source/css/partial/page.css","path":"css/partial/page.css","modified":0,"renderable":1},{"_id":"themes/sea/source/css/partial/pagination.css","path":"css/partial/pagination.css","modified":0,"renderable":1},{"_id":"themes/sea/source/css/partial/post.css","path":"css/partial/post.css","modified":0,"renderable":1},{"_id":"themes/sea/source/css/partial/sea_doc.css","path":"css/partial/sea_doc.css","modified":0,"renderable":1},{"_id":"themes/sea/source/css/partial/prev_next.css","path":"css/partial/prev_next.css","modified":0,"renderable":1},{"_id":"themes/sea/source/css/plugins/docsearch.css","path":"css/plugins/docsearch.css","modified":0,"renderable":1},{"_id":"themes/sea/source/css/plugins/prism.styl","path":"css/plugins/prism.styl","modified":0,"renderable":1},{"_id":"themes/sea/source/css/plugins/waline.css","path":"css/plugins/waline.css","modified":0,"renderable":1}],"Cache":[{"_id":"source/_posts/hello-world.md","hash":"7d98d6592de80fdcd2949bd7401cec12afd98cdf","modified":1737809549271},{"_id":"themes/sea/example/themes/.gitkeep","hash":"da39a3ee5e6b4b0d3255bfef95601890afd80709","modified":1737810118260},{"_id":"themes/sea/.gitignore","hash":"ea0049f4ac0eb1f99fdb8d720f13799f2ade859a","modified":1737810118254},{"_id":"themes/sea/LICENSE","hash":"df9911a27e482d1a3d37addfa4e82e3cd619bfb3","modified":1737810118255},{"_id":"themes/sea/package.json","hash":"befaeeddacac5ea57093c0467f31e047f373fbff","modified":1737810118264},{"_id":"themes/sea/.npmignore","hash":"f7151d659dde1336b7e2aa5d088aa1b814c0fc02","modified":1737810118254},{"_id":"themes/sea/README.md","hash":"de8cff42a53c4d308c1eeaebec3f7ade162a1f83","modified":1737810118255},{"_id":"themes/sea/.vscode/settings.json","hash":"027d15c4945cb0df2d722fc41225836c3e2c290f","modified":1737810118255},{"_id":"themes/sea/_config.yml","hash":"e9c22578ffa601786f02cef952649e0fdf0e5dbe","modified":1737810490696},{"_id":"themes/sea/example/_config.sea.yml","hash":"889bb0400bfd6f652e3d2df75b346c87407d8bde","modified":1737810118255},{"_id":"themes/sea/example/package.json","hash":"271066d691d28c648e0901e24c14d7ad45fd034a","modified":1737810118255},{"_id":"themes/sea/example/_config.yml","hash":"9e651e7d8814de0ae74b7979bb811172a6a613aa","modified":1737810118255},{"_id":"themes/sea/languages/en.yml","hash":"7a4a990823d32ca46e041068d8f4537acadc1814","modified":1737810118260},{"_id":"themes/sea/languages/zh.yml","hash":"a025e8178ce30e47a3e65f2218ae202f36cb383c","modified":1737810118261},{"_id":"themes/sea/scripts/helpers.js","hash":"104daeba100ab0cf6022aecb2b7d671b5edc2cef","modified":1737810118264},{"_id":"themes/sea/scripts/tags.js","hash":"a9f602c92dc3dac5ce8ea4da971753eee4f9d70d","modified":1737810118264},{"_id":"themes/sea/scripts/page.js","hash":"c3cb89a430244d02dffacc640a04692063833983","modified":1737810118264},{"_id":"themes/sea/layout/archive.njk","hash":"8ce79fed59307a3e0ea8e1f38ef38fa157968e03","modified":1737810118262},{"_id":"themes/sea/scripts/filters.js","hash":"dfc0b9a8e53127feba70af3946f9fb29879c984d","modified":1737810118264},{"_id":"themes/sea/layout/category.njk","hash":"81665b52b56cebf6fae00cea983994ca3ef409a1","modified":1737810118262},{"_id":"themes/sea/layout/index.njk","hash":"d4440fabf837fd7c1523c6706a749eac37e1da60","modified":1737810118262},{"_id":"themes/sea/layout/articles.njk","hash":"49a42959cc6a55b4cb732cb88cfa31b68f569d2e","modified":1737810118262},{"_id":"themes/sea/layout/page.njk","hash":"df2af7bdd96665c742370f4f4f400980934e27fb","modified":1737810118263},{"_id":"themes/sea/layout/tag.njk","hash":"54f3b8d807fc0502ee50ee11d15e0c8b0554e3e3","modified":1737810118264},{"_id":"themes/sea/layout/post.njk","hash":"17f56c72c09b443de4f2039d0d55b3ed81f145ab","modified":1737810118263},{"_id":"themes/sea/.github/workflows/release.yml","hash":"85f9854b1504f6df9dbb9387547bf53bc57b3572","modified":1737810118254},{"_id":"themes/sea/example/scaffolds/page.md","hash":"f0af1cb10f27d859caa51c8e3704469d9ed842a6","modified":1737810118255},{"_id":"themes/sea/example/scaffolds/draft.md","hash":"204ab550ddffa92051ea0eb2484a78d84dac3693","modified":1737810118255},{"_id":"themes/sea/layout/layout.njk","hash":"1d3aadc03104c0c1da231d5dced7184317bab088","modified":1737810118263},{"_id":"themes/sea/example/scaffolds/post.md","hash":"e7169dab8ce62d41e3734e30706fa786cc7d46f4","modified":1737810118255},{"_id":"themes/sea/example/source/logo.svg","hash":"6657ba50e702d84afb32fe846bed54fba1a77add","modified":1737810118260},{"_id":"themes/sea/layout/_partial/head.njk","hash":"8c4b903e222a21aec9a3774b2feb440662616bd6","modified":1737810118261},{"_id":"themes/sea/layout/svg/arrow_left.njk","hash":"3dbd82c60d0c6b79042d7bc343eaff0b98acc221","modified":1737810118263},{"_id":"themes/sea/layout/_partial/body_script.njk","hash":"7c3043efea83fc911d73b5f19dcbe34d09328468","modified":1737810118261},{"_id":"themes/sea/layout/svg/arrow_up.njk","hash":"b2dd1743b51fb782d36c3150d6239851429b5f69","modified":1737810118263},{"_id":"themes/sea/layout/svg/bars.njk","hash":"605cf58596c7922eea99e4aadafed9dc56da8075","modified":1737810118263},{"_id":"themes/sea/layout/svg/arrow_right.njk","hash":"3a14a7d93c96bfc7fb0961a53d40f8a73a2163ef","modified":1737810118263},{"_id":"themes/sea/layout/svg/close.njk","hash":"5ace5cb06d27bc1beaac0061f1d47b692e302b7f","modified":1737810118263},{"_id":"themes/sea/layout/svg/folder.njk","hash":"f2db5705fa18167ab8dd56a678cbb21e5b986b1d","modified":1737810118263},{"_id":"themes/sea/layout/svg/email.njk","hash":"acb522ac1deed1896970c16f7dac49d32ae85550","modified":1737810118263},{"_id":"themes/sea/layout/svg/date.njk","hash":"6e9d6b2abc3960ddf73b76cd1694929be765d22b","modified":1737810118263},{"_id":"themes/sea/layout/svg/moon.njk","hash":"e8764ed7cac36ca1cda4e57bfad290073365da07","modified":1737810118264},{"_id":"themes/sea/layout/svg/github.njk","hash":"87376073509d4398d1cca07dacd1f7dd3fa12616","modified":1737810118263},{"_id":"themes/sea/layout/svg/juejin.njk","hash":"fac363afd8a1e853713456cea354be974c2bfd5d","modified":1737810118263},{"_id":"themes/sea/layout/svg/rss.njk","hash":"96218f60bed20e6d98773bb53315ba26861ae795","modified":1737810118264},{"_id":"themes/sea/layout/svg/sun.njk","hash":"32a057015a6000edccf90347f6da5776147f78ad","modified":1737810118264},{"_id":"themes/sea/layout/svg/search.njk","hash":"4f87a5c8a3e035d5f1e56fe3eebb6dbe31d0ee42","modified":1737810118264},{"_id":"themes/sea/layout/svg/tag.njk","hash":"39f5791023fd1d5f61f14cabbd77c48f8a0b7bcf","modified":1737810118264},{"_id":"themes/sea/source/css/media.css","hash":"1851795a8094cdae3a0283877f8b042fddfe059b","modified":1737810118264},{"_id":"themes/sea/source/css/main.styl","hash":"6bc38a3e4b7ffe32f5a5f7c51ae91e738f3e04bc","modified":1737810118264},{"_id":"themes/sea/source/css/base.css","hash":"77b45165b38e07f4a61fadf225b1b23fb1d157e0","modified":1737810118264},{"_id":"themes/sea/source/js/main.js","hash":"dde1df7981f498a1f726414f19c67f1e5021f1cb","modified":1737810118266},{"_id":"themes/sea/source/js/theme_mode.js","hash":"58e9e66b6fd90219d921d11801d8e43832d780b9","modified":1737810118266},{"_id":"themes/sea/source/css/variables.css","hash":"7a8c724f01d83c5d9077c9d492366e89a3abde9a","modified":1737810118266},{"_id":"themes/sea/source/js/theme.js","hash":"612df0a7d087141ff59203d3c1900669c43b4541","modified":1737810118266},{"_id":"themes/sea/example/source/_posts/categories.md","hash":"c023118431e400a213f568fd572d2da1eb42bff4","modified":1737810118256},{"_id":"themes/sea/example/source/_posts/elements.md","hash":"c74ed1974348870b22053f4ef56623be9f548a7e","modified":1737810118256},{"_id":"themes/sea/example/source/_posts/code-highlight.md","hash":"334e0e84be834318e2b00fc0ef665e49d59ec47f","modified":1737810118256},{"_id":"themes/sea/example/source/_posts/excerpts.md","hash":"64dabd6382092c9424de013e1b1e24be2a6d73b8","modified":1737810118256},{"_id":"themes/sea/example/source/_posts/gallery-post.md","hash":"2eb3bdfbc32d64396aa8d958adcb74b6dfca3a26","modified":1737810118256},{"_id":"themes/sea/example/source/_posts/hello-world.md","hash":"9429cd5d2c34ebda1ef04248bf67b18c369c1220","modified":1737810118256},{"_id":"themes/sea/example/source/_posts/images.md","hash":"566d27e870757555ef8bc32781ddddcae9a7b693","modified":1737810118256},{"_id":"themes/sea/example/source/_posts/long-title.md","hash":"0d101b388a23e6609c121ff00b4dfd14df1e9938","modified":1737810118256},{"_id":"themes/sea/example/source/_posts/markdown.md","hash":"3e297f3c739f9b70083b19541955a74c75ba15c4","modified":1737810118256},{"_id":"themes/sea/example/source/_posts/mathjax.md","hash":"b003cf320e6d1f36025cdf4ebdf2965395ad6733","modified":1737810118256},{"_id":"themes/sea/example/source/_posts/tag-plugins.md","hash":"f9f8d7a4361668c410cb5ddd54f4d1f2f167d51e","modified":1737810118256},{"_id":"themes/sea/example/source/_posts/ä¸­æ–‡æ¸¬è©¦.md","hash":"dc6e9310fa1c331bd61c63aef7c8a87dfa18b8cd","modified":1737810118257},{"_id":"themes/sea/example/source/_posts/æ—¥æœ¬èªãƒ†ã‚¹ãƒˆ.md","hash":"0941ec02163c0329e38217195aed622de32c2e61","modified":1737810118257},{"_id":"themes/sea/example/source/_posts/tags.md","hash":"22452f7286e135658aabe870143c5550e5648143","modified":1737810118256},{"_id":"themes/sea/layout/_partial/main/footer.njk","hash":"917482e7f8517a7c2cf27312638c22712037d000","modified":1737810118261},{"_id":"themes/sea/example/source/friends/index.md","hash":"6971052af98328af210cf218aa98ae3368e73196","modified":1737810118260},{"_id":"themes/sea/layout/_partial/main/hero.njk","hash":"34720508c8866a6d37fc59a8689c4a55a2b59e8f","modified":1737810118261},{"_id":"themes/sea/layout/_partial/main/menu.njk","hash":"2fd44172a9dcee2b9c5b2ea1727724a36d546aca","modified":1737810118261},{"_id":"themes/sea/layout/_partial/main/pagination.njk","hash":"2c8a3d27854d29fee50c581cbd67efff64bfc76b","modified":1737810118261},{"_id":"themes/sea/layout/_partial/main/navbar.njk","hash":"fc618d279296aff1f55d633919ad4de1be20bc56","modified":1737810118261},{"_id":"themes/sea/layout/_partial/main/prev_next.njk","hash":"24aa5adaa593992292e93807e96219a2b363f768","modified":1737810118261},{"_id":"themes/sea/layout/_partial/page/tags.njk","hash":"0ca3558a458344954beb3a2d26f9b1abdf6b5113","modified":1737810118261},{"_id":"themes/sea/layout/_partial/page/categories.njk","hash":"8e954ea0804f5c36f95151ab09ef4ea596ea6889","modified":1737810118261},{"_id":"themes/sea/layout/_partial/page/default.njk","hash":"af86d797eb375b7190cba50e5c083905b9819534","modified":1737810118261},{"_id":"themes/sea/layout/_partial/post/post_categories.njk","hash":"c2fb0937ff9a7288105fea5dcdddb2c5aacf5fe5","modified":1737810118262},{"_id":"themes/sea/layout/_partial/post/post_list.njk","hash":"2b04e0d9a3c7a3810784ae5c678b08cadf48ed20","modified":1737810118262},{"_id":"themes/sea/layout/_partial/post/post_tags.njk","hash":"0cd17ecf392f2b90a44b2af0b9c064343aafc511","modified":1737810118262},{"_id":"themes/sea/layout/_partial/post/post_date.njk","hash":"5602ad9071768c367a08fbcb02847a5e5459bdc4","modified":1737810118262},{"_id":"themes/sea/layout/_plugins/comments/giscus.njk","hash":"bc52987ebfd554d4ed4dc65fd4769d59ffecd0b6","modified":1737810118262},{"_id":"themes/sea/layout/_plugins/comments/waline.njk","hash":"bf57c88eca1c2b1d2593091548a5356c62114d08","modified":1737810118262},{"_id":"themes/sea/layout/_plugins/search/docsearch.njk","hash":"c9e42c6896dfd5a6670aa6cdbf3469d2ad242341","modified":1737810118262},{"_id":"themes/sea/layout/_plugins/comments/index.njk","hash":"123e19964d587a6cd95151edf12145b52f4975ee","modified":1737810118262},{"_id":"themes/sea/layout/_plugins/search/local.njk","hash":"c966c605f91f39a88de2047e1ff42edbf72d512d","modified":1737810118262},{"_id":"themes/sea/source/css/partial/archive.css","hash":"9f4efdde49f4eef173ab95f21a31511b17be29fd","modified":1737810118265},{"_id":"themes/sea/source/css/partial/common.css","hash":"5d51ded96a49e4687f8412b0e0116db398b9dfdd","modified":1737810118265},{"_id":"themes/sea/source/css/partial/footer.css","hash":"fb38ed32a1efae788fb9da9db2ab37f16a5b300d","modified":1737810118265},{"_id":"themes/sea/source/css/partial/friends.css","hash":"fc4c1386de32b7a4c836fa7465d77d652e53eb5b","modified":1737810118265},{"_id":"themes/sea/source/css/partial/hero.css","hash":"97b851bdc5f8d565f8803def53fd20948f393bba","modified":1737810118265},{"_id":"themes/sea/layout/_plugins/search/index.njk","hash":"a684f8d7e03b3313e4ee60390a6dede8d4afaf43","modified":1737810118262},{"_id":"themes/sea/source/css/partial/index.css","hash":"0f992168abddf7a5b06a95dbb034d7904db0a989","modified":1737810118265},{"_id":"themes/sea/source/css/partial/layout.css","hash":"27f3d61443fd9994bfe7563bbe556bbc51142ff7","modified":1737810118265},{"_id":"themes/sea/source/css/partial/nav.css","hash":"d98825b190522f163fa09d72a58d8c24fbffc311","modified":1737810118265},{"_id":"themes/sea/source/css/partial/menu.css","hash":"167ec058606f02ca6ba37d716f4d3f8b56f31f52","modified":1737810118265},{"_id":"themes/sea/source/css/partial/page.css","hash":"a13ff27338136dbd2aab06b118c2e1f65fdcd0c2","modified":1737810118265},{"_id":"themes/sea/source/css/partial/pagination.css","hash":"4876cf32ad1f0973952c65fa9c9f6e2146f12853","modified":1737810118265},{"_id":"themes/sea/source/css/partial/post.css","hash":"e993f31a46eb33e0e6dfa070358193d0fcaed04f","modified":1737810118265},{"_id":"themes/sea/source/css/partial/prev_next.css","hash":"233f0d196833e63c04063f0bab372d47e04b8c92","modified":1737810118265},{"_id":"themes/sea/source/css/plugins/docsearch.css","hash":"61c9afe7758f17766bf7bcf3cb1231ee201a9faa","modified":1737810118265},{"_id":"themes/sea/source/css/plugins/prism.styl","hash":"42a1981f84f7c90877284383617c2c6a8ddfbf1e","modified":1737810118265},{"_id":"themes/sea/source/css/plugins/waline.css","hash":"b18e502b4d49a5f0300b3cdec6a37c19e0f7a564","modified":1737810118266},{"_id":"themes/sea/source/css/partial/sea_doc.css","hash":"4a032c39ab58828fdcb0d73c91a829f66ca01674","modified":1737810118265},{"_id":"themes/sea/example/source/assets/wallpaper-2572384.jpg","hash":"1df3620ab8c69fe2498a746f8ead057162df0637","modified":1737810118258},{"_id":"themes/sea/example/source/assets/wallpaper-878514.jpg","hash":"9f9705a377c42320b335b3c66b023e62b80e56e3","modified":1737810118260},{"_id":"themes/sea/example/source/assets/wallpaper-2311325.jpg","hash":"ddaaaeb4fa04a05c83053c1f8149720d18c9c8de","modified":1737810118257},{"_id":"public/2025/01/25/hello-world/index.html","hash":"bf9872a9fe7312ddb5dcad44cca02b12e52e28aa","modified":1737810615195},{"_id":"public/archives/index.html","hash":"368db19d20505255fe46c87be7a2ebfa54cde957","modified":1737810993929},{"_id":"public/archives/2025/index.html","hash":"4de90844c8032f9d73fabf8974e59590e2069f28","modified":1737810993929},{"_id":"public/archives/2025/01/index.html","hash":"be2fe6b4697412bbaa8011d8357767b7da806e24","modified":1737810993929},{"_id":"public/index.html","hash":"a93f1b34ab60263fb839e968e8a44e7268791c96","modified":1737810993929},{"_id":"public/tags/index.html","hash":"85584341b213f991f11cce982f6828850bf4cfe4","modified":1737810698988},{"_id":"public/categories/index.html","hash":"97c06ed63d3d6497b46a3eea88a232488d6c5ba5","modified":1737810615195},{"_id":"public/articles/index.html","hash":"ce27bddffe3fe9d263178839a543f465bf1cb512","modified":1737810993929},{"_id":"public/css/main.css","hash":"35bab8ded49d800b47bda4eded49657926f01b3b","modified":1737810204517},{"_id":"public/css/base.css","hash":"db7d2fbfaa093d82e18557b0a4b89f897bc47fe5","modified":1737810204517},{"_id":"public/css/media.css","hash":"d51b836803b09aef1e1c2f2ac2a00f51854d6763","modified":1737810204517},{"_id":"public/js/theme.js","hash":"612df0a7d087141ff59203d3c1900669c43b4541","modified":1737810204517},{"_id":"public/js/theme_mode.js","hash":"455ea87174cbe06f0b7a9f7f16a05b7282b8c37a","modified":1737810204517},{"_id":"public/js/main.js","hash":"0a83cb0a8ccf336ae6f24d1b5f957fe7efea2214","modified":1737810204517},{"_id":"public/css/partial/common.css","hash":"5d51ded96a49e4687f8412b0e0116db398b9dfdd","modified":1737810204517},{"_id":"public/css/variables.css","hash":"e816bf1ad04fcddaab77bf7e9caa8025c365e687","modified":1737810204517},{"_id":"public/css/partial/friends.css","hash":"877a1e5b6e4d884e2c7c4b38bacf35b6f14c401b","modified":1737810204517},{"_id":"public/css/partial/hero.css","hash":"97b851bdc5f8d565f8803def53fd20948f393bba","modified":1737810204517},{"_id":"public/css/partial/index.css","hash":"0f992168abddf7a5b06a95dbb034d7904db0a989","modified":1737810204517},{"_id":"public/css/partial/layout.css","hash":"0819c2195788887927b641ba206a2936b89a2dc2","modified":1737810204517},{"_id":"public/css/partial/footer.css","hash":"c668aa13cc8ee9c1514edfa7d251327cca2ea94a","modified":1737810204517},{"_id":"public/css/partial/archive.css","hash":"9f4efdde49f4eef173ab95f21a31511b17be29fd","modified":1737810204517},{"_id":"public/css/partial/menu.css","hash":"167ec058606f02ca6ba37d716f4d3f8b56f31f52","modified":1737810204517},{"_id":"public/css/partial/nav.css","hash":"d98825b190522f163fa09d72a58d8c24fbffc311","modified":1737810204517},{"_id":"public/css/partial/page.css","hash":"b3e0fdbab7fc1705113a5bdc801f6222d7e5bbd4","modified":1737810204517},{"_id":"public/css/partial/pagination.css","hash":"4876cf32ad1f0973952c65fa9c9f6e2146f12853","modified":1737810204517},{"_id":"public/css/partial/post.css","hash":"e993f31a46eb33e0e6dfa070358193d0fcaed04f","modified":1737810204517},{"_id":"public/css/partial/sea_doc.css","hash":"2b1edf9eabaf38659b0729555824f1aa29ddfdd8","modified":1737810204517},{"_id":"public/css/partial/prev_next.css","hash":"233f0d196833e63c04063f0bab372d47e04b8c92","modified":1737810204517},{"_id":"public/css/plugins/prism.css","hash":"426bf2b87b6fb1ba4c116d64baa6fab59b1c8836","modified":1737810204517},{"_id":"public/css/plugins/docsearch.css","hash":"61c9afe7758f17766bf7bcf3cb1231ee201a9faa","modified":1737810204517},{"_id":"public/css/plugins/waline.css","hash":"97a62b3cdd60f9325f0e8e2a632ee8d02f093f28","modified":1737810204517},{"_id":"source/_posts/mysql/mmysql.md","hash":"b6f058f64b072444d2f3e2752773d8db73237300","modified":1737810604155},{"_id":"public/2025/01/25/mysql/mmysql/index.html","hash":"27422a07cb3fe2a27782df800034d251840954f1","modified":1737810615195},{"_id":"source/_posts/Alistè®¿é—®.md","hash":"51fe02e54259af5a52d960aa9c1f30d1dc8add26","modified":1735297395342},{"_id":"source/_posts/Dockerå­¦ä¹ ç¬”è®°.md","hash":"df28d661e409e0be755e4606a51dc18cf05a6c06","modified":1735297395342},{"_id":"source/_posts/Kafkaå®è·µ.md","hash":"dc8d9edc85680f9fff3e80d9ef62c129263a37f1","modified":1735972325125},{"_id":"source/_posts/Kafkaç†è®ºçŸ¥è¯†.md","hash":"ea8e52ea502a8e4793a0b82a941b6d0482f77211","modified":1736078199329},{"_id":"source/_posts/.DS_Store","hash":"4a7bd8fd6d55b97d3657d3afb748d8875a7e94ae","modified":1737810696990},{"_id":"source/_posts/Sync.md","hash":"be56e54d71f14566772f8d60e61829b0c8acc593","modified":1735297395343},{"_id":"source/.DS_Store","hash":"af6910d7d10ea2eff8009ca951ddbbf5c8d62022","modified":1737810687633},{"_id":"source/_posts/component.md","hash":"f3ae9b8ed6850112a62c6037049982ce742d7690","modified":1735297395343},{"_id":"source/_posts/gitå­¦ä¹ ç¬”è®°.md","hash":"587de83665c5922301b311597bfe98c168bb83a6","modified":1735297395343},{"_id":"source/_posts/goroutine.md","hash":"2565a2c03b3144905dc835ac329cffdab0c9f156","modified":1735297395343},{"_id":"source/_posts/more.md","hash":"df68b34fbedff0eb553a654d9048fb468a1619d8","modified":1735297395344},{"_id":"source/_posts/style.md","hash":"b3d856ab3551d94120926afcb8a08878eaa6cdf7","modified":1735297395344},{"_id":"source/_posts/ã€Šè®¾è®¡æ¨¡å¼ä¹‹ç¾ã€‹é˜…è¯»ç¬”è®°.md","hash":"4023490db301b9ebd1a95dc6835e2f3aeaaa76be","modified":1735297395344},{"_id":"source/_posts/ä»–ä»¬çœ¼ä¸­çš„ç®€å†.md","hash":"0909bf5d230617025a7e5cb696edcbb70f3cec1a","modified":1737810988409},{"_id":"source/_posts/ã€ŠGoè¯­è¨€ç²¾è¿›ä¹‹è·¯ã€‹é˜…è¯»ç¬”è®°.md","hash":"89f552fe3bd6ce132d6728c5f0f30f5458ab12b9","modified":1735297395344},{"_id":"source/_posts/ä¼˜è´¨å¥½æ–‡åˆé›†.md","hash":"449e2c57eabb757c4cf49990f1d44c72fbffe6e4","modified":1735297395344},{"_id":"source/_posts/ä½¿ç”¨æœ¬åœ°ç¼“å­˜ä»£æ›¿Redis.md","hash":"b72cf767b7217ed32aecb97c3e8227508b3ed99d","modified":1735297395344},{"_id":"source/_posts/ä¼ è¾“å±‚çŸ¥è¯†ç‚¹.md","hash":"909cc6d89d75ddfc3da960b6cbaf8046cf30a1ec","modified":1735297395344},{"_id":"source/_posts/ä¼˜è´¨å¼€æºè½¯ä»¶åˆé›†.md","hash":"1ca15d4963b3e9b1bbdf88a005d79fd32e176c9b","modified":1735297395344},{"_id":"source/_posts/å‘å¸–åŠŸèƒ½å®ç°.md","hash":"1eceb361519f1b26c72f583cbca2d7b3a7fa2310","modified":1735297395344},{"_id":"source/_posts/åˆ†å¸ƒå¼ç†è®ºåŸºç¡€.md","hash":"7ff89b680e130482fcdc00b7e7efdd8d00c748e7","modified":1735297395344},{"_id":"source/_posts/å¼‚æ­¥æ¡†æ¶.md","hash":"a10e00f3de5e4cf2f4c7827a957180fb4a4d9707","modified":1735297395344},{"_id":"source/_posts/æ¢å–Mac OSç¬¬ä¸€æ­¥.md","hash":"043f279e824f251a7a29b78585a93a828b29c0e9","modified":1735297395344},{"_id":"source/_posts/å®šæ—¶å¾®æœåŠ¡.md","hash":"33adc2df9b64e6a89d5af0e8499b5aec55538db1","modified":1735297395344},{"_id":"source/_posts/æ•°æ®é“¾è·¯å±‚çŸ¥è¯†ç‚¹.md","hash":"b78be4afcfbe3d0a48a9b0c36f92d1887c455492","modified":1735297395345},{"_id":"source/_posts/çŸ­é“¾ç³»ç»Ÿ.md","hash":"bf6166d84d1abc061b1a73c828179f59c5190833","modified":1735297395345},{"_id":"source/_posts/ç†ç¬.md","hash":"a277f5575b4bf38992f64867415e1207688397d1","modified":1735297395345},{"_id":"source/_posts/ç”¨æˆ·æ€å’Œå†…æ ¸æ€.md","hash":"99ce65930686769cc55e3ef4fd8c2df3b8b20d89","modified":1735297395345},{"_id":"source/_posts/ç½‘ç»œä»£ç†.md","hash":"09ece3a1b4df62b3acf3b31efffe1a6a386b4c7c","modified":1735297395345},{"_id":"source/_posts/è®¾è®¡æ¨¡å¼.md","hash":"d99c110491e55867a06571a49c61b59e42a9439f","modified":1735299107220},{"_id":"source/_posts/ç½‘ç»œå±‚çŸ¥è¯†ç‚¹.md","hash":"0dc759b2a9fb277acba6bbd48ea43b00d8d82255","modified":1735297395345},{"_id":"source/_posts/è‰ç¨¿.md","hash":"2073e15a91610d95def0a9b9ac30a0e7893f8fef","modified":1735297395345},{"_id":"source/_posts/è¯»ä¹¦ç¬”è®°.md","hash":"727f569d53714fff4f7abc2409d66a9ef5728180","modified":1735297395345},{"_id":"source/_posts/Go/Go embedä½¿ç”¨.md","hash":"5d5754aaddef5e0ed6d066b6d6739c1b12bef908","modified":1735297395342},{"_id":"source/_posts/Asyncflow/è‰ç¨¿.md","hash":"e351cbc786356a36e89fbf6c3ee056c998b71a27","modified":1737380153875},{"_id":"source/_posts/Go/GC.md","hash":"d8b09b96c79e22d98c172f0fdb5241ab67751516","modified":1735297395342},{"_id":"source/_posts/Excalidraw/Drawing 2024-12-17 15.07.21.excalidraw.md","hash":"64035e224c6d79222bffcaaeaa563adf0ddae654","modified":1736060491935},{"_id":"source/_posts/Go/GMPåŸç†.md","hash":"a4e2e67cd087f49b829e71757fcb961d350a09b6","modified":1735297395342},{"_id":"source/_posts/Go/Golangæ•°æ®ç»“æ„.md","hash":"5d1631c9c6592034fdee204b2da16cd321b5f72d","modified":1735297395342},{"_id":"source/_posts/Go/æ¥å…¥æ—¥å¿—æ¨¡å—.md","hash":"91190b5b1e56a27e17b9cf65c3c6de99cded96e3","modified":1735297395345},{"_id":"source/_posts/Go/æ¥å…¥é…ç½®æ¨¡å—.md","hash":"52a904748bc0971b6f0c885161e9ae614b5cb060","modified":1735297395345},{"_id":"source/_posts/Go/Goç”µå•†å®æˆ˜ç¬”è®°.md","hash":"a28377656921bf374a646870104af58e8875c10a","modified":1735297395342},{"_id":"source/_posts/Go/æ¦œå•æ¨¡å‹ä¸åˆ†å¸ƒå¼ä»»åŠ¡è°ƒåº¦.md","hash":"95dea834db445e91c6b1bb77b5ac7676395e3e7a","modified":1735297395345},{"_id":"source/_posts/MySQL/MySQLäº‹åŠ¡å­¦ä¹ .md","hash":"dbd5d8f8ff3315020edc3c56320139269ba8d2ab","modified":1735297395343},{"_id":"source/_posts/MySQL/MySQLç´¢å¼•å­¦ä¹ .md","hash":"a842471b8b3748763a1aa8459cbd45c7ef1ffb7d","modified":1735297395343},{"_id":"source/_posts/Go/é˜…è¯»ã€ç‚¹èµã€æ”¶è—åŠŸèƒ½.md","hash":"f60a452dd3df1fb753d240f46b792262bab046d5","modified":1735297395345},{"_id":"source/_posts/MySQL/MySQLæ—¥å¿—å­¦ä¹ .md","hash":"1c4d05f0b09a0d8628e5356fa783c8e43cf34561","modified":1735297395343},{"_id":"source/_posts/MySQL/MySQLå®æˆ˜45è®².md","hash":"fc9db9d66b2099c702eeaafe8414a3de88889ee4","modified":1737641436311},{"_id":"source/_posts/MySQL/MySQLé”å­¦ä¹ .md","hash":"480f6dc686d2ec32c33f26af75e8d07bf701ba34","modified":1735297395343},{"_id":"source/_posts/Redis/Redisåœºæ™¯åº”ç”¨.md","hash":"9e8e17758e9a2b978f3befdf154c8133a9b19eef","modified":1735297395343},{"_id":"source/_posts/Redis/Rediså¯¹è±¡.md","hash":"877db456091778eb66c408ebe2e6945f7e64658f","modified":1735297395343},{"_id":"source/_posts/MySQL/MySQLè¿æ¥æ± ä¼˜åŒ–.md","hash":"284fadcfe3f6f8c59844b22b016b36ab78b88626","modified":1735297395343},{"_id":"source/_posts/Redis/RedisæŒä¹…åŒ–.md","hash":"54e6d4e0464a8ec9e488f522960035a3d6a5c882","modified":1735297395343},{"_id":"source/_posts/Redis/Redisè¿è¡ŒåŸç†.md","hash":"b8d8d748aaab8f4fb6d02bda2b5551ddf8db3042","modified":1735297395343},{"_id":"source/_posts/interview experience/å…¶ä»–.md","hash":"568ab5a7d503e635dfe682f788e52cc7179d1f80","modified":1737082143403},{"_id":"source/_posts/interview experience/é˜¿é‡Œå·´å·´.md","hash":"8656d7692ef567c20f457d203255681a33020827","modified":1737383395728},{"_id":"source/_posts/interview experience/å­—èŠ‚è·³åŠ¨.md","hash":"695f2072c430ad36463f619395a46e3440b144be","modified":1737270415166},{"_id":"source/_posts/interview experience/.obsidian/core-plugins.json","hash":"688b44c61ce85d9ac421b1a310a72c1348bc9b51","modified":1736861959814},{"_id":"source/_posts/interview experience/.obsidian/app.json","hash":"bf21a9e8fbc5a3846fb05b4fa0859e0917b2202f","modified":1736861960299},{"_id":"source/_posts/interview experience/.obsidian/appearance.json","hash":"bf21a9e8fbc5a3846fb05b4fa0859e0917b2202f","modified":1736861960301},{"_id":"source/_posts/interview experience/.obsidian/workspace.json","hash":"b9277dc189b96d756e771592c6d873022c02c962","modified":1736864286597},{"_id":"public/2025/01/19/ä»–ä»¬çœ¼ä¸­çš„ç®€å†/index.html","hash":"d49f95ab53a498be6cd805d0106b211700fe0a50","modified":1737810698988},{"_id":"public/2025/01/19/interview experience/é˜¿é‡Œå·´å·´/index.html","hash":"0e6c66de7e5657a5fc629e839d55d0ca1289fe86","modified":1737810993929},{"_id":"public/2025/01/16/interview experience/å…¶ä»–/index.html","hash":"7e13fa5e40a044201cd62bca4d1b642c714d07e8","modified":1737810698988},{"_id":"public/2025/01/13/MySQL/MySQLå®æˆ˜45è®²/index.html","hash":"5a658b761c6634f2b4d4221f0a3352f5306b31a5","modified":1737810698988},{"_id":"public/2025/01/12/interview experience/å­—èŠ‚è·³åŠ¨/index.html","hash":"f18ec43931b0aae3d7166061461ecbb2a025c053","modified":1737810698988},{"_id":"public/2025/01/04/Kafkaç†è®ºçŸ¥è¯†/index.html","hash":"db769c2100a8dfdbbb007649ab1af9341a03e3da","modified":1737810698988},{"_id":"public/2024/12/27/ç†ç¬/index.html","hash":"763b7a773c503bc6de1a209425ba2434ccdd98d5","modified":1737810698988},{"_id":"public/2024/12/27/ç”¨æˆ·æ€å’Œå†…æ ¸æ€/index.html","hash":"e8fd96f790b7b1115da462b200c3074210a02b69","modified":1737810698988},{"_id":"public/2024/12/27/çŸ­é“¾ç³»ç»Ÿ/index.html","hash":"53dbf305c143d9cf9be0a49ffde00009520f38ca","modified":1737810698988},{"_id":"public/2024/12/27/è‰ç¨¿/index.html","hash":"d5474046c5a697788d9291b21d6dd9bdd4d25969","modified":1737810698988},{"_id":"public/2024/12/27/è¯»ä¹¦ç¬”è®°/index.html","hash":"da8f85a4ac595fc978304a81a2df415e74290377","modified":1737810698988},{"_id":"public/2024/12/27/Go/é˜…è¯»ã€ç‚¹èµã€æ”¶è—åŠŸèƒ½/index.html","hash":"3d5adc78229934a329b4b9a6e8c82159ca0f1328","modified":1737810698988},{"_id":"public/2024/12/27/Go/æ¦œå•æ¨¡å‹ä¸åˆ†å¸ƒå¼ä»»åŠ¡è°ƒåº¦/index.html","hash":"1355758c58ad34050037309b1afb0c3fc9c5c93b","modified":1737810698988},{"_id":"public/2024/12/27/more/index.html","hash":"d97a4ed1b14ffebbeed4248efd3a9c8a47fe52a2","modified":1737810698988},{"_id":"public/2024/12/27/style/index.html","hash":"0bf672cdd5e72bed818d94407e4dea0edcafe54d","modified":1737810698988},{"_id":"public/2024/12/27/ã€ŠGoè¯­è¨€ç²¾è¿›ä¹‹è·¯ã€‹é˜…è¯»ç¬”è®°/index.html","hash":"92ab759324db1966fac37a89c639510494236db4","modified":1737810698988},{"_id":"public/2024/12/27/ã€Šè®¾è®¡æ¨¡å¼ä¹‹ç¾ã€‹é˜…è¯»ç¬”è®°/index.html","hash":"ecf178d4c364157787355d6bcd88438d16a9d36f","modified":1737810698988},{"_id":"public/2024/12/27/ä¼˜è´¨å¼€æºè½¯ä»¶åˆé›†/index.html","hash":"d53eda780aa192a012e354883df2179667c3e1c4","modified":1737810698988},{"_id":"public/2024/12/27/ä½¿ç”¨æœ¬åœ°ç¼“å­˜ä»£æ›¿Redis/index.html","hash":"75d12d60b4597e0f55498056a5dae5bca1c7e09e","modified":1737810698988},{"_id":"public/2024/12/27/åˆ†å¸ƒå¼ç†è®ºåŸºç¡€/index.html","hash":"7b58f8aad92b5bbff952059b55da85f3601069f2","modified":1737810698988},{"_id":"public/2024/12/27/å‘å¸–åŠŸèƒ½å®ç°/index.html","hash":"87b1c9d955d5e4397ca5c05c04371bd0f4e9e3e1","modified":1737810698988},{"_id":"public/2024/12/27/æ¢å–Mac OSç¬¬ä¸€æ­¥/index.html","hash":"39ebb5f67b3229a6bc2a533b0d023d735a2d18f6","modified":1737810698988},{"_id":"public/2024/12/27/å®šæ—¶å¾®æœåŠ¡/index.html","hash":"b76b5fdb5e31ad53e73c981bb5cf891db7f0db2e","modified":1737810698988},{"_id":"public/2024/12/27/Sync/index.html","hash":"8c5cbd405d75754c4399df2c0a540448a39281fa","modified":1737810698988},{"_id":"public/2024/12/27/component/index.html","hash":"4b2f925e4d24a2330814a07700054de753e2486d","modified":1737810698988},{"_id":"public/2024/12/27/MySQL/MySQLæ—¥å¿—å­¦ä¹ /index.html","hash":"b69f0af77e70cb9d701b1a550ba3ec25d93c479f","modified":1737810698988},{"_id":"public/2024/12/27/MySQL/MySQLè¿æ¥æ± ä¼˜åŒ–/index.html","hash":"360fd135aaa44664aff2ad095fc8c327d274b16a","modified":1737810698988},{"_id":"public/2024/12/27/Redis/RedisæŒä¹…åŒ–/index.html","hash":"9dda157886820b3a60c10d122e8714197691a1b1","modified":1737810698988},{"_id":"public/2024/12/27/Redis/Redisåœºæ™¯åº”ç”¨/index.html","hash":"1b97de1cc6d49f60675c6008846553ffc4a15cad","modified":1737810698988},{"_id":"public/2024/12/27/Redis/Rediså¯¹è±¡/index.html","hash":"003e064c25494c3a3c3d674941259849bdc38026","modified":1737810698988},{"_id":"public/2024/12/27/Redis/Redisè¿è¡ŒåŸç†/index.html","hash":"433450d2feb0c31e289c98fb58c479edf104cf9b","modified":1737810698988},{"_id":"public/2024/12/27/Alistè®¿é—®/index.html","hash":"9bcc4b76e5a524054df904c0b64522b7bbfaac22","modified":1737810698988},{"_id":"public/2024/12/27/Dockerå­¦ä¹ ç¬”è®°/index.html","hash":"77504a3b1d5d6f54bf5318a94f58cd0ba1ccc0a3","modified":1737810698988},{"_id":"public/2024/12/27/Kafkaå®è·µ/index.html","hash":"45c1550287f7b618db8eed28f5522f5c068d2888","modified":1737810698988},{"_id":"public/2024/12/27/Asyncflow/è‰ç¨¿/index.html","hash":"4fb86b5fb87d196f37bb6fad5b26c1a58fbc55e3","modified":1737810698988},{"_id":"public/2024/12/27/Excalidraw/Drawing 2024-12-17 15.07.21.excalidraw/index.html","hash":"678104c885ebf1a4d79926dc63f22d9eda76c2a2","modified":1737810698988},{"_id":"public/2024/12/27/Go/GC/index.html","hash":"d3d16f779a98e5f31d3204ed25aadab7ea3bcba1","modified":1737810698988},{"_id":"public/2024/12/27/Go/Go embedä½¿ç”¨/index.html","hash":"4651862faee18b57ac02f0cf8269dba81275bccd","modified":1737810698988},{"_id":"public/2024/12/27/Go/GMPåŸç†/index.html","hash":"30232779edaf8a0a473a142e238ced68d3438c81","modified":1737810698988},{"_id":"public/2024/12/27/Go/Goç”µå•†å®æˆ˜ç¬”è®°/index.html","hash":"21dd8d4255db61835669332f5d6604dd1172d7f2","modified":1737810698988},{"_id":"public/2024/12/15/è®¾è®¡æ¨¡å¼/index.html","hash":"92199bb352ee3ff2de8c631d2955ec05910953b0","modified":1737810698988},{"_id":"public/2024/12/13/å¼‚æ­¥æ¡†æ¶/index.html","hash":"6fc996c0b7e855cbb8a7971848681e9ab12a2894","modified":1737810698988},{"_id":"public/2024/12/12/ä¼˜è´¨å¥½æ–‡åˆé›†/index.html","hash":"b0075c7c43ab4d54ecc13870e3a430c2a3dd8dfd","modified":1737810698988},{"_id":"public/2024/09/27/goroutine/index.html","hash":"a2644edec29b50b00cb0f01d22b504614f4f1e02","modified":1737810698988},{"_id":"public/2024/12/12/Go/Golangæ•°æ®ç»“æ„/index.html","hash":"c8a0987f3d4745db702125b7f52725b02a2e7972","modified":1737810698988},{"_id":"public/2024/09/27/ç½‘ç»œä»£ç†/index.html","hash":"9b35f6d5abde0a857938a453dcbf1ef00f1fa3ee","modified":1737810698988},{"_id":"public/2024/09/27/MySQL/MySQLé”å­¦ä¹ /index.html","hash":"31a0b948d84db91e79b8d746e188557bef8c1bdb","modified":1737810698988},{"_id":"public/2024/09/23/æ•°æ®é“¾è·¯å±‚çŸ¥è¯†ç‚¹/index.html","hash":"18e992aa0457ef4b7aaa837d8d033aaf7ba546f9","modified":1737810698988},{"_id":"public/2024/09/23/MySQL/MySQLäº‹åŠ¡å­¦ä¹ /index.html","hash":"427abc96190eb860053ddaae96154b85f8481f2a","modified":1737810698988},{"_id":"public/2024/09/21/ç½‘ç»œå±‚çŸ¥è¯†ç‚¹/index.html","hash":"ae46eb38176068620e6774b9738ae0beb203c4d3","modified":1737810698988},{"_id":"public/2024/09/19/MySQL/MySQLç´¢å¼•å­¦ä¹ /index.html","hash":"d5ad98a08b2ddd6e407134a13b38c64d62df5d00","modified":1737810698988},{"_id":"public/2024/09/15/gitå­¦ä¹ ç¬”è®°/index.html","hash":"de49bf0b42482f1b8cb4ca288705d242465d6930","modified":1737810698988},{"_id":"public/2024/09/14/ä¼ è¾“å±‚çŸ¥è¯†ç‚¹/index.html","hash":"ff3b0bc03bf4205e77bbbc7b57de7533023a43fb","modified":1737810698988},{"_id":"public/2024/08/20/Go/æ¥å…¥æ—¥å¿—æ¨¡å—/index.html","hash":"889f7f45c3fe3ba1be7a3c6c66f36ceee366e2b9","modified":1737810698988},{"_id":"public/2024/08/15/Go/æ¥å…¥é…ç½®æ¨¡å—/index.html","hash":"d558ab8049fa46b5af3ac9d0675fef3ab47dd747","modified":1737810698988},{"_id":"public/archives/page/2/index.html","hash":"897888f6c4a799156ca8fbf8a1be9e4ebd826f34","modified":1737810698988},{"_id":"public/archives/page/3/index.html","hash":"a84edef257037e5eea8845a169a0002cc622a67d","modified":1737810698988},{"_id":"public/archives/page/4/index.html","hash":"5bb37ffc278db0821f5b3165aff51ec51ec6b241","modified":1737810698988},{"_id":"public/archives/page/5/index.html","hash":"1df559dc724bb01d60c0adf9407a2742b29deeaf","modified":1737810698988},{"_id":"public/archives/page/6/index.html","hash":"261440e610497dfa09dfc98617e42a48a120001f","modified":1737810698988},{"_id":"public/archives/2024/index.html","hash":"c248a7338cc3bbf6cc46d99eb1ada1380938a337","modified":1737810698988},{"_id":"public/archives/2024/page/2/index.html","hash":"bcfa53ed9e2530c30e3508867b12d2542586ef21","modified":1737810698988},{"_id":"public/archives/2024/page/3/index.html","hash":"75b616d47480e44d15126bec5fc8089e7f901499","modified":1737810698988},{"_id":"public/archives/2024/page/4/index.html","hash":"122d2173db48d5fcd84f799041b11d00899a9905","modified":1737810698988},{"_id":"public/archives/2024/page/5/index.html","hash":"806d6a4f3a60aebf72a2b9aac3fcd4531e807c0e","modified":1737810698988},{"_id":"public/archives/2024/08/index.html","hash":"fe941621bc216143c867a076013fe1805139a3c3","modified":1737810698988},{"_id":"public/archives/2024/09/index.html","hash":"670c557b8f889369c79e975a11dc410f0d17549a","modified":1737810698988},{"_id":"public/archives/2024/12/index.html","hash":"503387b55f97f4222547a6bcd1ba98bd6553105e","modified":1737810698988},{"_id":"public/archives/2024/12/page/2/index.html","hash":"2f5657e0517f808955b7b7afcff71c9e5e2b5346","modified":1737810698988},{"_id":"public/archives/2024/12/page/3/index.html","hash":"6a4b69529218b60ff3065b7bea5871120ac9116c","modified":1737810698988},{"_id":"public/archives/2024/12/page/4/index.html","hash":"4e861554086f39c3257f842b15813b421032c5f6","modified":1737810698988},{"_id":"public/page/2/index.html","hash":"eb9a3eec566c490b31534a2a89c7f5ad448015fc","modified":1737810993929},{"_id":"public/page/3/index.html","hash":"6545c2a85ee5776f2a6e9ae1c80576da12d2dff7","modified":1737810993929},{"_id":"public/page/4/index.html","hash":"0b8d08f813bacd11dd3bed7d21738afd4be308f5","modified":1737810993929},{"_id":"public/page/6/index.html","hash":"ff81ca257c64424d2d8ca3485962a19053e62bc0","modified":1737810993929},{"_id":"public/page/5/index.html","hash":"4c923a39e7b962c22e3b6d71c674a08917ccda14","modified":1737810993929},{"_id":"public/tags/Docker/index.html","hash":"1aaa827b5a657d37881a8ac9a232bab38985c28b","modified":1737810698988},{"_id":"public/tags/Git/index.html","hash":"cca73bbdfffecd601ecb4913365928786c535f52","modified":1737810698988},{"_id":"public/tags/Golang/index.html","hash":"a651259ab8acccf69e6729bfdcf6fefa08ca28c6","modified":1737810698988},{"_id":"public/tags/é…ç½®/index.html","hash":"e0f8a92f8014e77397d8094f8a9100b44dd8f089","modified":1737810698988},{"_id":"public/tags/Go/index.html","hash":"f186ac116715e5c8afba55ca0a4b8e73fedb9b6c","modified":1737810698988},{"_id":"public/tags/ä¼˜è´¨æ–‡ç« /index.html","hash":"320907230befdc4c9537ae16c3a9375122879a34","modified":1737810698988},{"_id":"public/tags/è®¾è®¡æ¨¡å¼/index.html","hash":"e0d65104843bee2efdefa9938b40bde3d59eb200","modified":1737810698988},{"_id":"public/tags/è®¡ç®—æœºç½‘ç»œ/index.html","hash":"83b9d946a4f537942731e03226a81f590bc747f3","modified":1737810698988},{"_id":"public/tags/å¼€æºå·¥å…·/index.html","hash":"1583d9c5b504872330dca6eb880d75621c9dabfd","modified":1737810698988},{"_id":"public/tags/èµ„æº/index.html","hash":"83d61077a0efbe8e2f2d595cb5b60703c6f308f2","modified":1737810698988},{"_id":"public/tags/é¡¹ç›®/index.html","hash":"53d715d70df1953c49eb5e50d95e231d65b78c84","modified":1737810698988},{"_id":"public/tags/å­¦ä¹ /index.html","hash":"9945ccd486347a0d2407d4066f43870f6eca6fff","modified":1737810698988},{"_id":"public/tags/excalidraw/index.html","hash":"4445ededba53095ef3a39c222eaeb31791289de4","modified":1737810698988},{"_id":"public/tags/MySQL/index.html","hash":"c9ec44b0f5874a7a2604c676d36faa3ecae1ae5b","modified":1737810698988},{"_id":"public/tags/Redis/index.html","hash":"133510c770b458ef6b12995dd4c1dd16e3071f9d","modified":1737810698988},{"_id":"public/tags/æ•°æ®ç»“æ„/index.html","hash":"3bde0c042ca4f919604de3b23a2027f633dd1a4d","modified":1737810698988},{"_id":"public/articles/page/2/index.html","hash":"a733975eb79180ec767b302e28fcd3c081842ad2","modified":1737810698988},{"_id":"public/articles/page/3/index.html","hash":"35095a209201c4d8b2ecaa12a29aa13d3b4f8526","modified":1737810698988},{"_id":"public/articles/page/4/index.html","hash":"192e546d58af1c45dc7b1ea0a292c4d26de4df1e","modified":1737810698988},{"_id":"public/articles/page/5/index.html","hash":"731e92bd543494dbbb1ceddaf018d40d79088459","modified":1737810698988},{"_id":"public/articles/page/6/index.html","hash":"a1a9a19de891ee79761e3999b083bce6d32bee06","modified":1737810698988},{"_id":"public/2025/01/25/ä»–ä»¬çœ¼ä¸­çš„ç®€å†/index.html","hash":"bb8f29765b8c458046f20f29d1636bb859d8d670","modified":1737810993929}],"Category":[],"Data":[],"Page":[],"Post":[{"publish":true,"_content":"\n\n\nä¸€èˆ¬åœ°ï¼Œç‚¹å‡»ä¸€ä¸ªè§†é¢‘æ˜¯ä¸ä¼šåŠ è½½æˆåŠŸçš„ï¼Œå°±åƒè¿™æ ·å­ï¼š\n\n<img src=\"https://raw.githubusercontent.com/lyydsheep/pic/main/202410191901690.png\" alt=\"image-20241019190139605\" style=\"zoom:50%;\" />\n\nè¿™æ˜¯å› ä¸º**AlistæŒ‚è½½çš„æ˜¯ç™¾åº¦äº‘ç›˜ï¼Œè€Œç™¾åº¦äº‘ç›˜ä¼šåœ¨å¤„ç†è¯·æ±‚æ—¶ä¼šå…ˆè¿›è¡Œèº«ä»½æ ¡éªŒ**ã€‚ä¸€èˆ¬èº«ä»½æ ¡éªŒæ“ä½œéƒ½ä¼šé’ˆå¯¹**jwt-tokenã€è¯·æ±‚å¤´ä¸­çš„User-Agentå­—æ®µ**è¿›è¡ŒéªŒè¯ã€‚\n\nä¸Šè¿°è§†é¢‘æ— æ³•åŠ è½½æˆåŠŸçš„åŸå› å°±æ˜¯**User-Agentå­—æ®µ**è®¾ç½®é”™è¯¯ã€‚é‚£ä¹ˆæˆ‘ä»¬åªéœ€è¦å°†**User-Agentå­—æ®µè®¾ç½®ä¸º`pan.baidu.com`å°±èƒ½åœ¨çº¿æ’­æ”¾è§†é¢‘å•¦**~~ï¼ˆAlistå®˜ç½‘å®˜æ–¹æ–‡æ¡£å‘Šè¯‰æˆ‘çš„ğŸ¤ªï¼‰~~\n\nå…·ä½“æ“ä½œï¼ˆä»¥edgeæµè§ˆå™¨ä¸ºä¾‹ï¼‰ï¼š\n\n- æŒ‰ä¸‹é”®ç›˜`F12`ï¼Œå‘¼å‡ºå¼€å‘è€…å·¥å…·\n  - <img src=\"https://raw.githubusercontent.com/lyydsheep/pic/main/202410191910833.png\" alt=\"image-20241019191014765\" style=\"zoom:50%;\" />\n\n- ç‚¹å‡»ç½‘ç»œçŠ¶å†µï¼ˆå…³é”®æ˜¯æ‰¾åˆ°è¿™ä¸ªğŸ›œ+âš™ï¸çš„å›¾æ ‡ï¼‰\n  - <img src=\"https://raw.githubusercontent.com/lyydsheep/pic/main/202410191913926.png\" style=\"zoom:50%;\" />\n\n- å–æ¶ˆå‹¾é€‰`Use browse default`ï¼Œå¹¶å°†å­—æ®µå€¼è‡ªå®šä¹‰ä¸º`pan.baidu.com`ã€‚æœ€ç»ˆç»“æœå¦‚ä¸‹å›¾\n  - <img src=\"https://raw.githubusercontent.com/lyydsheep/pic/main/202410191916203.png\" alt=\"image-20241019191634164\" style=\"zoom: 67%;\" />\n\n- ä¿®æ”¹å®Œååˆ·æ–°ï¼ˆ**åˆ·æ–°æ—¶ä¸è¦å…³é—­å¼€å‘è€…å·¥å…·**ï¼‰å³å¯æ’­æ”¾ã€‚è‹¥åç»­ä»å‡ºç°ä¸å¯æ’­æ”¾çš„æƒ…å†µï¼Œè¯·æ£€æŸ¥`User-Agent`æ˜¯å¦ä¸º`pan.baidu.com`\n  - <img src=\"https://raw.githubusercontent.com/lyydsheep/pic/main/202410191920677.png\" alt=\"image-20241019192045600\" style=\"zoom:50%;\" />\n\n","source":"_posts/Alistè®¿é—®.md","raw":"---\npublish: true\n---\n\n\n\nä¸€èˆ¬åœ°ï¼Œç‚¹å‡»ä¸€ä¸ªè§†é¢‘æ˜¯ä¸ä¼šåŠ è½½æˆåŠŸçš„ï¼Œå°±åƒè¿™æ ·å­ï¼š\n\n<img src=\"https://raw.githubusercontent.com/lyydsheep/pic/main/202410191901690.png\" alt=\"image-20241019190139605\" style=\"zoom:50%;\" />\n\nè¿™æ˜¯å› ä¸º**AlistæŒ‚è½½çš„æ˜¯ç™¾åº¦äº‘ç›˜ï¼Œè€Œç™¾åº¦äº‘ç›˜ä¼šåœ¨å¤„ç†è¯·æ±‚æ—¶ä¼šå…ˆè¿›è¡Œèº«ä»½æ ¡éªŒ**ã€‚ä¸€èˆ¬èº«ä»½æ ¡éªŒæ“ä½œéƒ½ä¼šé’ˆå¯¹**jwt-tokenã€è¯·æ±‚å¤´ä¸­çš„User-Agentå­—æ®µ**è¿›è¡ŒéªŒè¯ã€‚\n\nä¸Šè¿°è§†é¢‘æ— æ³•åŠ è½½æˆåŠŸçš„åŸå› å°±æ˜¯**User-Agentå­—æ®µ**è®¾ç½®é”™è¯¯ã€‚é‚£ä¹ˆæˆ‘ä»¬åªéœ€è¦å°†**User-Agentå­—æ®µè®¾ç½®ä¸º`pan.baidu.com`å°±èƒ½åœ¨çº¿æ’­æ”¾è§†é¢‘å•¦**~~ï¼ˆAlistå®˜ç½‘å®˜æ–¹æ–‡æ¡£å‘Šè¯‰æˆ‘çš„ğŸ¤ªï¼‰~~\n\nå…·ä½“æ“ä½œï¼ˆä»¥edgeæµè§ˆå™¨ä¸ºä¾‹ï¼‰ï¼š\n\n- æŒ‰ä¸‹é”®ç›˜`F12`ï¼Œå‘¼å‡ºå¼€å‘è€…å·¥å…·\n  - <img src=\"https://raw.githubusercontent.com/lyydsheep/pic/main/202410191910833.png\" alt=\"image-20241019191014765\" style=\"zoom:50%;\" />\n\n- ç‚¹å‡»ç½‘ç»œçŠ¶å†µï¼ˆå…³é”®æ˜¯æ‰¾åˆ°è¿™ä¸ªğŸ›œ+âš™ï¸çš„å›¾æ ‡ï¼‰\n  - <img src=\"https://raw.githubusercontent.com/lyydsheep/pic/main/202410191913926.png\" style=\"zoom:50%;\" />\n\n- å–æ¶ˆå‹¾é€‰`Use browse default`ï¼Œå¹¶å°†å­—æ®µå€¼è‡ªå®šä¹‰ä¸º`pan.baidu.com`ã€‚æœ€ç»ˆç»“æœå¦‚ä¸‹å›¾\n  - <img src=\"https://raw.githubusercontent.com/lyydsheep/pic/main/202410191916203.png\" alt=\"image-20241019191634164\" style=\"zoom: 67%;\" />\n\n- ä¿®æ”¹å®Œååˆ·æ–°ï¼ˆ**åˆ·æ–°æ—¶ä¸è¦å…³é—­å¼€å‘è€…å·¥å…·**ï¼‰å³å¯æ’­æ”¾ã€‚è‹¥åç»­ä»å‡ºç°ä¸å¯æ’­æ”¾çš„æƒ…å†µï¼Œè¯·æ£€æŸ¥`User-Agent`æ˜¯å¦ä¸º`pan.baidu.com`\n  - <img src=\"https://raw.githubusercontent.com/lyydsheep/pic/main/202410191920677.png\" alt=\"image-20241019192045600\" style=\"zoom:50%;\" />\n\n","slug":"Alistè®¿é—®","published":1,"date":"2024-12-27T11:03:15.342Z","updated":"2024-12-27T11:03:15.342Z","title":"","comments":1,"layout":"post","photos":[],"_id":"cm6c7md6d0000a5t2cua69y20","content":"<p>ä¸€èˆ¬åœ°ï¼Œç‚¹å‡»ä¸€ä¸ªè§†é¢‘æ˜¯ä¸ä¼šåŠ è½½æˆåŠŸçš„ï¼Œå°±åƒè¿™æ ·å­ï¼š</p>\n<img src=\"https://raw.githubusercontent.com/lyydsheep/pic/main/202410191901690.png\" alt=\"image-20241019190139605\" style=\"zoom:50%;\" />\n\n<p>è¿™æ˜¯å› ä¸º<strong>AlistæŒ‚è½½çš„æ˜¯ç™¾åº¦äº‘ç›˜ï¼Œè€Œç™¾åº¦äº‘ç›˜ä¼šåœ¨å¤„ç†è¯·æ±‚æ—¶ä¼šå…ˆè¿›è¡Œèº«ä»½æ ¡éªŒ</strong>ã€‚ä¸€èˆ¬èº«ä»½æ ¡éªŒæ“ä½œéƒ½ä¼šé’ˆå¯¹<strong>jwt-tokenã€è¯·æ±‚å¤´ä¸­çš„User-Agentå­—æ®µ</strong>è¿›è¡ŒéªŒè¯ã€‚</p>\n<p>ä¸Šè¿°è§†é¢‘æ— æ³•åŠ è½½æˆåŠŸçš„åŸå› å°±æ˜¯<strong>User-Agentå­—æ®µ</strong>è®¾ç½®é”™è¯¯ã€‚é‚£ä¹ˆæˆ‘ä»¬åªéœ€è¦å°†<strong>User-Agentå­—æ®µè®¾ç½®ä¸º<code>pan.baidu.com</code>å°±èƒ½åœ¨çº¿æ’­æ”¾è§†é¢‘å•¦</strong><del>ï¼ˆAlistå®˜ç½‘å®˜æ–¹æ–‡æ¡£å‘Šè¯‰æˆ‘çš„ğŸ¤ªï¼‰</del></p>\n<p>å…·ä½“æ“ä½œï¼ˆä»¥edgeæµè§ˆå™¨ä¸ºä¾‹ï¼‰ï¼š</p>\n<ul>\n<li><p>æŒ‰ä¸‹é”®ç›˜<code>F12</code>ï¼Œå‘¼å‡ºå¼€å‘è€…å·¥å…·</p>\n<ul>\n<li><img src=\"https://raw.githubusercontent.com/lyydsheep/pic/main/202410191910833.png\" alt=\"image-20241019191014765\" style=\"zoom:50%;\" /></li>\n</ul>\n</li>\n<li><p>ç‚¹å‡»ç½‘ç»œçŠ¶å†µï¼ˆå…³é”®æ˜¯æ‰¾åˆ°è¿™ä¸ªğŸ›œ+âš™ï¸çš„å›¾æ ‡ï¼‰</p>\n<ul>\n<li><img src=\"https://raw.githubusercontent.com/lyydsheep/pic/main/202410191913926.png\" style=\"zoom:50%;\" /></li>\n</ul>\n</li>\n<li><p>å–æ¶ˆå‹¾é€‰<code>Use browse default</code>ï¼Œå¹¶å°†å­—æ®µå€¼è‡ªå®šä¹‰ä¸º<code>pan.baidu.com</code>ã€‚æœ€ç»ˆç»“æœå¦‚ä¸‹å›¾</p>\n<ul>\n<li><img src=\"https://raw.githubusercontent.com/lyydsheep/pic/main/202410191916203.png\" alt=\"image-20241019191634164\" style=\"zoom: 67%;\" /></li>\n</ul>\n</li>\n<li><p>ä¿®æ”¹å®Œååˆ·æ–°ï¼ˆ<strong>åˆ·æ–°æ—¶ä¸è¦å…³é—­å¼€å‘è€…å·¥å…·</strong>ï¼‰å³å¯æ’­æ”¾ã€‚è‹¥åç»­ä»å‡ºç°ä¸å¯æ’­æ”¾çš„æƒ…å†µï¼Œè¯·æ£€æŸ¥<code>User-Agent</code>æ˜¯å¦ä¸º<code>pan.baidu.com</code></p>\n<ul>\n<li><img src=\"https://raw.githubusercontent.com/lyydsheep/pic/main/202410191920677.png\" alt=\"image-20241019192045600\" style=\"zoom:50%;\" /></li>\n</ul>\n</li>\n</ul>\n","excerpt":"","more":"<p>ä¸€èˆ¬åœ°ï¼Œç‚¹å‡»ä¸€ä¸ªè§†é¢‘æ˜¯ä¸ä¼šåŠ è½½æˆåŠŸçš„ï¼Œå°±åƒè¿™æ ·å­ï¼š</p>\n<img src=\"https://raw.githubusercontent.com/lyydsheep/pic/main/202410191901690.png\" alt=\"image-20241019190139605\" style=\"zoom:50%;\" />\n\n<p>è¿™æ˜¯å› ä¸º<strong>AlistæŒ‚è½½çš„æ˜¯ç™¾åº¦äº‘ç›˜ï¼Œè€Œç™¾åº¦äº‘ç›˜ä¼šåœ¨å¤„ç†è¯·æ±‚æ—¶ä¼šå…ˆè¿›è¡Œèº«ä»½æ ¡éªŒ</strong>ã€‚ä¸€èˆ¬èº«ä»½æ ¡éªŒæ“ä½œéƒ½ä¼šé’ˆå¯¹<strong>jwt-tokenã€è¯·æ±‚å¤´ä¸­çš„User-Agentå­—æ®µ</strong>è¿›è¡ŒéªŒè¯ã€‚</p>\n<p>ä¸Šè¿°è§†é¢‘æ— æ³•åŠ è½½æˆåŠŸçš„åŸå› å°±æ˜¯<strong>User-Agentå­—æ®µ</strong>è®¾ç½®é”™è¯¯ã€‚é‚£ä¹ˆæˆ‘ä»¬åªéœ€è¦å°†<strong>User-Agentå­—æ®µè®¾ç½®ä¸º<code>pan.baidu.com</code>å°±èƒ½åœ¨çº¿æ’­æ”¾è§†é¢‘å•¦</strong><del>ï¼ˆAlistå®˜ç½‘å®˜æ–¹æ–‡æ¡£å‘Šè¯‰æˆ‘çš„ğŸ¤ªï¼‰</del></p>\n<p>å…·ä½“æ“ä½œï¼ˆä»¥edgeæµè§ˆå™¨ä¸ºä¾‹ï¼‰ï¼š</p>\n<ul>\n<li><p>æŒ‰ä¸‹é”®ç›˜<code>F12</code>ï¼Œå‘¼å‡ºå¼€å‘è€…å·¥å…·</p>\n<ul>\n<li><img src=\"https://raw.githubusercontent.com/lyydsheep/pic/main/202410191910833.png\" alt=\"image-20241019191014765\" style=\"zoom:50%;\" /></li>\n</ul>\n</li>\n<li><p>ç‚¹å‡»ç½‘ç»œçŠ¶å†µï¼ˆå…³é”®æ˜¯æ‰¾åˆ°è¿™ä¸ªğŸ›œ+âš™ï¸çš„å›¾æ ‡ï¼‰</p>\n<ul>\n<li><img src=\"https://raw.githubusercontent.com/lyydsheep/pic/main/202410191913926.png\" style=\"zoom:50%;\" /></li>\n</ul>\n</li>\n<li><p>å–æ¶ˆå‹¾é€‰<code>Use browse default</code>ï¼Œå¹¶å°†å­—æ®µå€¼è‡ªå®šä¹‰ä¸º<code>pan.baidu.com</code>ã€‚æœ€ç»ˆç»“æœå¦‚ä¸‹å›¾</p>\n<ul>\n<li><img src=\"https://raw.githubusercontent.com/lyydsheep/pic/main/202410191916203.png\" alt=\"image-20241019191634164\" style=\"zoom: 67%;\" /></li>\n</ul>\n</li>\n<li><p>ä¿®æ”¹å®Œååˆ·æ–°ï¼ˆ<strong>åˆ·æ–°æ—¶ä¸è¦å…³é—­å¼€å‘è€…å·¥å…·</strong>ï¼‰å³å¯æ’­æ”¾ã€‚è‹¥åç»­ä»å‡ºç°ä¸å¯æ’­æ”¾çš„æƒ…å†µï¼Œè¯·æ£€æŸ¥<code>User-Agent</code>æ˜¯å¦ä¸º<code>pan.baidu.com</code></p>\n<ul>\n<li><img src=\"https://raw.githubusercontent.com/lyydsheep/pic/main/202410191920677.png\" alt=\"image-20241019192045600\" style=\"zoom:50%;\" /></li>\n</ul>\n</li>\n</ul>\n"},{"description":"è®°å½•æœ‰å…³Dockerçš„ä¸€äº›çŸ¥è¯†ç‚¹","_content":"\n# Dockerå­¦ä¹ ç¬”è®°\n\n## Dockerå’Œä¼ ç»Ÿè™šæ‹Ÿæœºçš„åŒºåˆ«\n\n![image-20241114183050052](https://raw.githubusercontent.com/lyydsheep/pic/main/202411141831820.png)\n\n**ç‰©ç†æœåŠ¡å™¨**\n\nä¸€å°çœ‹å¾—è§æ‘¸çš„ç€çš„æœºå™¨å°±æ˜¯ç‰©ç†æœºå™¨ï¼Œå³äº‘æœåŠ¡å‚å•†æ‰€è¯´çš„**ç‰©ç†æœåŠ¡å™¨ã€ç‰©ç†æœºã€ç‹¬ç«‹æœåŠ¡å™¨**\n\n**VPS**\n\nä¸€èˆ¬æ¥è¯´ï¼Œä¸€å°ç‰©ç†æœåŠ¡å™¨æ€§èƒ½æ¯”æ™®é€šç”µè„‘è¦å¥½å¾—å¤šï¼Œä½†æ˜¯è¿™æ ·ä¸€å°æœåŠ¡å™¨åˆ†é…ç»™ä¸ªäººä½¿ç”¨å°±ä¼šå¯¼è‡´æ€§èƒ½è¿‡å‰©ã€èµ„é‡‘æµªè´¹ã€‚**VPSï¼ˆVirtual Private Serverï¼Œè™šæ‹Ÿä¸“ç”¨æœåŠ¡å™¨ï¼‰**å°±æ˜¯æŒ‡åœ¨ç‰©ç†æœåŠ¡å™¨ä¸Šè¿è¡Œå¤šå°è™šæ‹Ÿæœºï¼Œè¿™äº›è™šæ‹Ÿæœºæœ‰ç‹¬ç«‹çš„èµ„æºã€æ“ä½œç³»ç»Ÿå’Œå…¬ç½‘IPåœ°å€ã€‚äº‘æœåŠ¡å‚å®¶å°±èƒ½ä¸€VPSä¸ºæœ€å°å•ä½å‘ç”¨æˆ·å‡ºç§ŸæœåŠ¡å™¨\n\n**ECS**\n\nVPSçš„é…ç½®éƒ½æ˜¯äº‹å…ˆç”±å‚å®¶ç¡®å®šå¥½çš„ï¼Œä½†æ˜¯å¾ˆå¤šæƒ…å†µä¸‹ç”¨æˆ·æœ‰è‡ªå®šä¹‰æœåŠ¡å™¨é…ç½®çš„éœ€æ±‚ã€‚**ECSï¼ˆElastic Computer Serviceï¼‰**å°±æ˜¯åŠ å…¥äº†è‡ªä¸»å‡é™çº§åŠŸèƒ½çš„VPSï¼Œç”¨æˆ·å¯ä»¥æ ¹æ®éœ€æ±‚éšæ—¶è°ƒæ•´CPUã€å†…å­˜ã€ç£ç›˜ç­‰é…ç½®\n\n**Docker**\n\nECSå½’æ ¹åˆ°åº•ä¹Ÿæ˜¯ä¸€å°ç”µè„‘ï¼Œé‚£å°±ä¸å¯é¿å…ä¼šå­˜åœ¨**åº”ç”¨åœ¨ä¸åŒæ“ä½œç³»ç»Ÿä¹‹é—´å…¼å®¹æ€§**çš„é—®é¢˜ã€‚~~ä¸€ä¸ªå¾ˆç®€å•çš„æƒ³æ³•å°±æ˜¯å°†è½¯ä»¶è¿å¸¦æ“ä½œç³»ç»Ÿä¸€åŒéƒ¨ç½²~~Dockerå®¹å™¨æŠ€æœ¯é€‰æ‹©å°†**è½¯ä»¶åŠå…¶æ‰€ä¾èµ–çš„ç¯å¢ƒé…ç½®**ä¸€åŒæ‰“åŒ…ï¼ŒæŒ‚è½½åœ¨æœåŠ¡å™¨ä¸Šï¼Œå†é€šè¿‡**Namespace**è®©å®ƒä»¬çœ‹èµ·æ¥æ˜¯è¿è¡Œåœ¨ä¸€ä¸ªç‹¬ç«‹çš„æ“ä½œç³»ç»Ÿä¸Šï¼Œä»¥åŠåˆ©ç”¨**Cgroup**é™åˆ¶å¯ä½¿ç”¨çš„è®¡ç®—èµ„æº\n\n![image-20241114190259158](https://raw.githubusercontent.com/lyydsheep/pic/main/202411141902210.png)\n\næ€»ç»“ä¸€ä¸‹å°±æ˜¯ï¼š**ç‰©ç†æœåŠ¡å™¨ä¸Šè·‘ecsï¼Œecsè·‘Dockerå®¹å™¨ã€‚å¤šä¸ªDockerå®¹å™¨å…±äº«ä¸€ä¸ªecså®ä¾‹æ“ä½œç³»ç»Ÿå†…æ ¸**\n\n## å‚è€ƒ\n\n[é¢è¯•å®˜ï¼šDockerå’Œä¼ ç»Ÿè™šæ‹Ÿæœºæœ‰ä»€ä¹ˆåŒºåˆ«ï¼Ÿ (qq.com)](https://mp.weixin.qq.com/s?__biz=MzUxODAzNDg4NQ==&mid=2247534049&idx=2&sn=1ef2674ddb3217bbafcb5cd6946407ac&chksm=f98d014bcefa885d6b68c0405718abf634a33427264a8ae4d04bc478bc03121dbfdceed7012e&token=630123097&lang=zh_CN#rd)","source":"_posts/Dockerå­¦ä¹ ç¬”è®°.md","raw":"---\ntags:\n- Docker\ndescription: è®°å½•æœ‰å…³Dockerçš„ä¸€äº›çŸ¥è¯†ç‚¹\n---\n\n# Dockerå­¦ä¹ ç¬”è®°\n\n## Dockerå’Œä¼ ç»Ÿè™šæ‹Ÿæœºçš„åŒºåˆ«\n\n![image-20241114183050052](https://raw.githubusercontent.com/lyydsheep/pic/main/202411141831820.png)\n\n**ç‰©ç†æœåŠ¡å™¨**\n\nä¸€å°çœ‹å¾—è§æ‘¸çš„ç€çš„æœºå™¨å°±æ˜¯ç‰©ç†æœºå™¨ï¼Œå³äº‘æœåŠ¡å‚å•†æ‰€è¯´çš„**ç‰©ç†æœåŠ¡å™¨ã€ç‰©ç†æœºã€ç‹¬ç«‹æœåŠ¡å™¨**\n\n**VPS**\n\nä¸€èˆ¬æ¥è¯´ï¼Œä¸€å°ç‰©ç†æœåŠ¡å™¨æ€§èƒ½æ¯”æ™®é€šç”µè„‘è¦å¥½å¾—å¤šï¼Œä½†æ˜¯è¿™æ ·ä¸€å°æœåŠ¡å™¨åˆ†é…ç»™ä¸ªäººä½¿ç”¨å°±ä¼šå¯¼è‡´æ€§èƒ½è¿‡å‰©ã€èµ„é‡‘æµªè´¹ã€‚**VPSï¼ˆVirtual Private Serverï¼Œè™šæ‹Ÿä¸“ç”¨æœåŠ¡å™¨ï¼‰**å°±æ˜¯æŒ‡åœ¨ç‰©ç†æœåŠ¡å™¨ä¸Šè¿è¡Œå¤šå°è™šæ‹Ÿæœºï¼Œè¿™äº›è™šæ‹Ÿæœºæœ‰ç‹¬ç«‹çš„èµ„æºã€æ“ä½œç³»ç»Ÿå’Œå…¬ç½‘IPåœ°å€ã€‚äº‘æœåŠ¡å‚å®¶å°±èƒ½ä¸€VPSä¸ºæœ€å°å•ä½å‘ç”¨æˆ·å‡ºç§ŸæœåŠ¡å™¨\n\n**ECS**\n\nVPSçš„é…ç½®éƒ½æ˜¯äº‹å…ˆç”±å‚å®¶ç¡®å®šå¥½çš„ï¼Œä½†æ˜¯å¾ˆå¤šæƒ…å†µä¸‹ç”¨æˆ·æœ‰è‡ªå®šä¹‰æœåŠ¡å™¨é…ç½®çš„éœ€æ±‚ã€‚**ECSï¼ˆElastic Computer Serviceï¼‰**å°±æ˜¯åŠ å…¥äº†è‡ªä¸»å‡é™çº§åŠŸèƒ½çš„VPSï¼Œç”¨æˆ·å¯ä»¥æ ¹æ®éœ€æ±‚éšæ—¶è°ƒæ•´CPUã€å†…å­˜ã€ç£ç›˜ç­‰é…ç½®\n\n**Docker**\n\nECSå½’æ ¹åˆ°åº•ä¹Ÿæ˜¯ä¸€å°ç”µè„‘ï¼Œé‚£å°±ä¸å¯é¿å…ä¼šå­˜åœ¨**åº”ç”¨åœ¨ä¸åŒæ“ä½œç³»ç»Ÿä¹‹é—´å…¼å®¹æ€§**çš„é—®é¢˜ã€‚~~ä¸€ä¸ªå¾ˆç®€å•çš„æƒ³æ³•å°±æ˜¯å°†è½¯ä»¶è¿å¸¦æ“ä½œç³»ç»Ÿä¸€åŒéƒ¨ç½²~~Dockerå®¹å™¨æŠ€æœ¯é€‰æ‹©å°†**è½¯ä»¶åŠå…¶æ‰€ä¾èµ–çš„ç¯å¢ƒé…ç½®**ä¸€åŒæ‰“åŒ…ï¼ŒæŒ‚è½½åœ¨æœåŠ¡å™¨ä¸Šï¼Œå†é€šè¿‡**Namespace**è®©å®ƒä»¬çœ‹èµ·æ¥æ˜¯è¿è¡Œåœ¨ä¸€ä¸ªç‹¬ç«‹çš„æ“ä½œç³»ç»Ÿä¸Šï¼Œä»¥åŠåˆ©ç”¨**Cgroup**é™åˆ¶å¯ä½¿ç”¨çš„è®¡ç®—èµ„æº\n\n![image-20241114190259158](https://raw.githubusercontent.com/lyydsheep/pic/main/202411141902210.png)\n\næ€»ç»“ä¸€ä¸‹å°±æ˜¯ï¼š**ç‰©ç†æœåŠ¡å™¨ä¸Šè·‘ecsï¼Œecsè·‘Dockerå®¹å™¨ã€‚å¤šä¸ªDockerå®¹å™¨å…±äº«ä¸€ä¸ªecså®ä¾‹æ“ä½œç³»ç»Ÿå†…æ ¸**\n\n## å‚è€ƒ\n\n[é¢è¯•å®˜ï¼šDockerå’Œä¼ ç»Ÿè™šæ‹Ÿæœºæœ‰ä»€ä¹ˆåŒºåˆ«ï¼Ÿ (qq.com)](https://mp.weixin.qq.com/s?__biz=MzUxODAzNDg4NQ==&mid=2247534049&idx=2&sn=1ef2674ddb3217bbafcb5cd6946407ac&chksm=f98d014bcefa885d6b68c0405718abf634a33427264a8ae4d04bc478bc03121dbfdceed7012e&token=630123097&lang=zh_CN#rd)","slug":"Dockerå­¦ä¹ ç¬”è®°","published":1,"date":"2024-12-27T11:03:15.342Z","updated":"2024-12-27T11:03:15.342Z","title":"","comments":1,"layout":"post","photos":[],"_id":"cm6c7md6f0001a5t2d10u8ihd","content":"<h1 id=\"Dockerå­¦ä¹ ç¬”è®°\"><a href=\"#Dockerå­¦ä¹ ç¬”è®°\" class=\"headerlink\" title=\"Dockerå­¦ä¹ ç¬”è®°\"></a>Dockerå­¦ä¹ ç¬”è®°</h1><h2 id=\"Dockerå’Œä¼ ç»Ÿè™šæ‹Ÿæœºçš„åŒºåˆ«\"><a href=\"#Dockerå’Œä¼ ç»Ÿè™šæ‹Ÿæœºçš„åŒºåˆ«\" class=\"headerlink\" title=\"Dockerå’Œä¼ ç»Ÿè™šæ‹Ÿæœºçš„åŒºåˆ«\"></a>Dockerå’Œä¼ ç»Ÿè™šæ‹Ÿæœºçš„åŒºåˆ«</h2><p><img src=\"https://raw.githubusercontent.com/lyydsheep/pic/main/202411141831820.png\" alt=\"image-20241114183050052\"></p>\n<p><strong>ç‰©ç†æœåŠ¡å™¨</strong></p>\n<p>ä¸€å°çœ‹å¾—è§æ‘¸çš„ç€çš„æœºå™¨å°±æ˜¯ç‰©ç†æœºå™¨ï¼Œå³äº‘æœåŠ¡å‚å•†æ‰€è¯´çš„<strong>ç‰©ç†æœåŠ¡å™¨ã€ç‰©ç†æœºã€ç‹¬ç«‹æœåŠ¡å™¨</strong></p>\n<p><strong>VPS</strong></p>\n<p>ä¸€èˆ¬æ¥è¯´ï¼Œä¸€å°ç‰©ç†æœåŠ¡å™¨æ€§èƒ½æ¯”æ™®é€šç”µè„‘è¦å¥½å¾—å¤šï¼Œä½†æ˜¯è¿™æ ·ä¸€å°æœåŠ¡å™¨åˆ†é…ç»™ä¸ªäººä½¿ç”¨å°±ä¼šå¯¼è‡´æ€§èƒ½è¿‡å‰©ã€èµ„é‡‘æµªè´¹ã€‚<strong>VPSï¼ˆVirtual Private Serverï¼Œè™šæ‹Ÿä¸“ç”¨æœåŠ¡å™¨ï¼‰</strong>å°±æ˜¯æŒ‡åœ¨ç‰©ç†æœåŠ¡å™¨ä¸Šè¿è¡Œå¤šå°è™šæ‹Ÿæœºï¼Œè¿™äº›è™šæ‹Ÿæœºæœ‰ç‹¬ç«‹çš„èµ„æºã€æ“ä½œç³»ç»Ÿå’Œå…¬ç½‘IPåœ°å€ã€‚äº‘æœåŠ¡å‚å®¶å°±èƒ½ä¸€VPSä¸ºæœ€å°å•ä½å‘ç”¨æˆ·å‡ºç§ŸæœåŠ¡å™¨</p>\n<p><strong>ECS</strong></p>\n<p>VPSçš„é…ç½®éƒ½æ˜¯äº‹å…ˆç”±å‚å®¶ç¡®å®šå¥½çš„ï¼Œä½†æ˜¯å¾ˆå¤šæƒ…å†µä¸‹ç”¨æˆ·æœ‰è‡ªå®šä¹‰æœåŠ¡å™¨é…ç½®çš„éœ€æ±‚ã€‚<strong>ECSï¼ˆElastic Computer Serviceï¼‰</strong>å°±æ˜¯åŠ å…¥äº†è‡ªä¸»å‡é™çº§åŠŸèƒ½çš„VPSï¼Œç”¨æˆ·å¯ä»¥æ ¹æ®éœ€æ±‚éšæ—¶è°ƒæ•´CPUã€å†…å­˜ã€ç£ç›˜ç­‰é…ç½®</p>\n<p><strong>Docker</strong></p>\n<p>ECSå½’æ ¹åˆ°åº•ä¹Ÿæ˜¯ä¸€å°ç”µè„‘ï¼Œé‚£å°±ä¸å¯é¿å…ä¼šå­˜åœ¨<strong>åº”ç”¨åœ¨ä¸åŒæ“ä½œç³»ç»Ÿä¹‹é—´å…¼å®¹æ€§</strong>çš„é—®é¢˜ã€‚<del>ä¸€ä¸ªå¾ˆç®€å•çš„æƒ³æ³•å°±æ˜¯å°†è½¯ä»¶è¿å¸¦æ“ä½œç³»ç»Ÿä¸€åŒéƒ¨ç½²</del>Dockerå®¹å™¨æŠ€æœ¯é€‰æ‹©å°†<strong>è½¯ä»¶åŠå…¶æ‰€ä¾èµ–çš„ç¯å¢ƒé…ç½®</strong>ä¸€åŒæ‰“åŒ…ï¼ŒæŒ‚è½½åœ¨æœåŠ¡å™¨ä¸Šï¼Œå†é€šè¿‡<strong>Namespace</strong>è®©å®ƒä»¬çœ‹èµ·æ¥æ˜¯è¿è¡Œåœ¨ä¸€ä¸ªç‹¬ç«‹çš„æ“ä½œç³»ç»Ÿä¸Šï¼Œä»¥åŠåˆ©ç”¨<strong>Cgroup</strong>é™åˆ¶å¯ä½¿ç”¨çš„è®¡ç®—èµ„æº</p>\n<p><img src=\"https://raw.githubusercontent.com/lyydsheep/pic/main/202411141902210.png\" alt=\"image-20241114190259158\"></p>\n<p>æ€»ç»“ä¸€ä¸‹å°±æ˜¯ï¼š<strong>ç‰©ç†æœåŠ¡å™¨ä¸Šè·‘ecsï¼Œecsè·‘Dockerå®¹å™¨ã€‚å¤šä¸ªDockerå®¹å™¨å…±äº«ä¸€ä¸ªecså®ä¾‹æ“ä½œç³»ç»Ÿå†…æ ¸</strong></p>\n<h2 id=\"å‚è€ƒ\"><a href=\"#å‚è€ƒ\" class=\"headerlink\" title=\"å‚è€ƒ\"></a>å‚è€ƒ</h2><p><a href=\"https://mp.weixin.qq.com/s?__biz=MzUxODAzNDg4NQ==&mid=2247534049&idx=2&sn=1ef2674ddb3217bbafcb5cd6946407ac&chksm=f98d014bcefa885d6b68c0405718abf634a33427264a8ae4d04bc478bc03121dbfdceed7012e&token=630123097&lang=zh_CN#rd\">é¢è¯•å®˜ï¼šDockerå’Œä¼ ç»Ÿè™šæ‹Ÿæœºæœ‰ä»€ä¹ˆåŒºåˆ«ï¼Ÿ (qq.com)</a></p>\n","excerpt":"","more":"<h1 id=\"Dockerå­¦ä¹ ç¬”è®°\"><a href=\"#Dockerå­¦ä¹ ç¬”è®°\" class=\"headerlink\" title=\"Dockerå­¦ä¹ ç¬”è®°\"></a>Dockerå­¦ä¹ ç¬”è®°</h1><h2 id=\"Dockerå’Œä¼ ç»Ÿè™šæ‹Ÿæœºçš„åŒºåˆ«\"><a href=\"#Dockerå’Œä¼ ç»Ÿè™šæ‹Ÿæœºçš„åŒºåˆ«\" class=\"headerlink\" title=\"Dockerå’Œä¼ ç»Ÿè™šæ‹Ÿæœºçš„åŒºåˆ«\"></a>Dockerå’Œä¼ ç»Ÿè™šæ‹Ÿæœºçš„åŒºåˆ«</h2><p><img src=\"https://raw.githubusercontent.com/lyydsheep/pic/main/202411141831820.png\" alt=\"image-20241114183050052\"></p>\n<p><strong>ç‰©ç†æœåŠ¡å™¨</strong></p>\n<p>ä¸€å°çœ‹å¾—è§æ‘¸çš„ç€çš„æœºå™¨å°±æ˜¯ç‰©ç†æœºå™¨ï¼Œå³äº‘æœåŠ¡å‚å•†æ‰€è¯´çš„<strong>ç‰©ç†æœåŠ¡å™¨ã€ç‰©ç†æœºã€ç‹¬ç«‹æœåŠ¡å™¨</strong></p>\n<p><strong>VPS</strong></p>\n<p>ä¸€èˆ¬æ¥è¯´ï¼Œä¸€å°ç‰©ç†æœåŠ¡å™¨æ€§èƒ½æ¯”æ™®é€šç”µè„‘è¦å¥½å¾—å¤šï¼Œä½†æ˜¯è¿™æ ·ä¸€å°æœåŠ¡å™¨åˆ†é…ç»™ä¸ªäººä½¿ç”¨å°±ä¼šå¯¼è‡´æ€§èƒ½è¿‡å‰©ã€èµ„é‡‘æµªè´¹ã€‚<strong>VPSï¼ˆVirtual Private Serverï¼Œè™šæ‹Ÿä¸“ç”¨æœåŠ¡å™¨ï¼‰</strong>å°±æ˜¯æŒ‡åœ¨ç‰©ç†æœåŠ¡å™¨ä¸Šè¿è¡Œå¤šå°è™šæ‹Ÿæœºï¼Œè¿™äº›è™šæ‹Ÿæœºæœ‰ç‹¬ç«‹çš„èµ„æºã€æ“ä½œç³»ç»Ÿå’Œå…¬ç½‘IPåœ°å€ã€‚äº‘æœåŠ¡å‚å®¶å°±èƒ½ä¸€VPSä¸ºæœ€å°å•ä½å‘ç”¨æˆ·å‡ºç§ŸæœåŠ¡å™¨</p>\n<p><strong>ECS</strong></p>\n<p>VPSçš„é…ç½®éƒ½æ˜¯äº‹å…ˆç”±å‚å®¶ç¡®å®šå¥½çš„ï¼Œä½†æ˜¯å¾ˆå¤šæƒ…å†µä¸‹ç”¨æˆ·æœ‰è‡ªå®šä¹‰æœåŠ¡å™¨é…ç½®çš„éœ€æ±‚ã€‚<strong>ECSï¼ˆElastic Computer Serviceï¼‰</strong>å°±æ˜¯åŠ å…¥äº†è‡ªä¸»å‡é™çº§åŠŸèƒ½çš„VPSï¼Œç”¨æˆ·å¯ä»¥æ ¹æ®éœ€æ±‚éšæ—¶è°ƒæ•´CPUã€å†…å­˜ã€ç£ç›˜ç­‰é…ç½®</p>\n<p><strong>Docker</strong></p>\n<p>ECSå½’æ ¹åˆ°åº•ä¹Ÿæ˜¯ä¸€å°ç”µè„‘ï¼Œé‚£å°±ä¸å¯é¿å…ä¼šå­˜åœ¨<strong>åº”ç”¨åœ¨ä¸åŒæ“ä½œç³»ç»Ÿä¹‹é—´å…¼å®¹æ€§</strong>çš„é—®é¢˜ã€‚<del>ä¸€ä¸ªå¾ˆç®€å•çš„æƒ³æ³•å°±æ˜¯å°†è½¯ä»¶è¿å¸¦æ“ä½œç³»ç»Ÿä¸€åŒéƒ¨ç½²</del>Dockerå®¹å™¨æŠ€æœ¯é€‰æ‹©å°†<strong>è½¯ä»¶åŠå…¶æ‰€ä¾èµ–çš„ç¯å¢ƒé…ç½®</strong>ä¸€åŒæ‰“åŒ…ï¼ŒæŒ‚è½½åœ¨æœåŠ¡å™¨ä¸Šï¼Œå†é€šè¿‡<strong>Namespace</strong>è®©å®ƒä»¬çœ‹èµ·æ¥æ˜¯è¿è¡Œåœ¨ä¸€ä¸ªç‹¬ç«‹çš„æ“ä½œç³»ç»Ÿä¸Šï¼Œä»¥åŠåˆ©ç”¨<strong>Cgroup</strong>é™åˆ¶å¯ä½¿ç”¨çš„è®¡ç®—èµ„æº</p>\n<p><img src=\"https://raw.githubusercontent.com/lyydsheep/pic/main/202411141902210.png\" alt=\"image-20241114190259158\"></p>\n<p>æ€»ç»“ä¸€ä¸‹å°±æ˜¯ï¼š<strong>ç‰©ç†æœåŠ¡å™¨ä¸Šè·‘ecsï¼Œecsè·‘Dockerå®¹å™¨ã€‚å¤šä¸ªDockerå®¹å™¨å…±äº«ä¸€ä¸ªecså®ä¾‹æ“ä½œç³»ç»Ÿå†…æ ¸</strong></p>\n<h2 id=\"å‚è€ƒ\"><a href=\"#å‚è€ƒ\" class=\"headerlink\" title=\"å‚è€ƒ\"></a>å‚è€ƒ</h2><p><a href=\"https://mp.weixin.qq.com/s?__biz=MzUxODAzNDg4NQ==&mid=2247534049&idx=2&sn=1ef2674ddb3217bbafcb5cd6946407ac&chksm=f98d014bcefa885d6b68c0405718abf634a33427264a8ae4d04bc478bc03121dbfdceed7012e&token=630123097&lang=zh_CN#rd\">é¢è¯•å®˜ï¼šDockerå’Œä¼ ç»Ÿè™šæ‹Ÿæœºæœ‰ä»€ä¹ˆåŒºåˆ«ï¼Ÿ (qq.com)</a></p>\n"},{"_content":"# æ¶ˆæ¯é˜Ÿåˆ—\n\næ¶ˆæ¯é˜Ÿåˆ—çš„åŸºæœ¬å½¢æ€ï¼Œå°±æ˜¯æœ‰**Nä¸ªç”Ÿäº§è€…ï¼ŒNä¸ªæ¶ˆè´¹è€…**\n\nç”Ÿäº§è€…å’Œæ¶ˆè´¹è€…è§£è€¦äº†\n\n## åº”ç”¨åœºæ™¯\n### æ¶ˆæ¯é˜Ÿåˆ—è§£è€¦\nä¸€ä¸ªæ¨¡å—Aæ¥æ”¶åˆ°è¯·æ±‚åéœ€è¦è°ƒç”¨æ¨¡å—Bï¼Œæ¥ç€ç­‰å¾…æ¨¡å—Bå®Œæˆåç»­å·¥ä½œï¼Œæ‰è¿›è¡Œå›åŒ…ã€‚è¿™ç§æƒ…å†µä¸‹æ¨¡å—Aæåº¦ä¾èµ–äºæ¨¡å—Bçš„è¿è¡ŒçŠ¶å†µï¼Œè€¦åˆåº¦è¾ƒé«˜ã€‚å¦‚æœä¸šåŠ¡å…è®¸çš„è¯ï¼Œæ¨¡å—Aå®Œå…¨å¯ä»¥å°†è°ƒç”¨æ¨¡å—Bçš„è¯·æ±‚ä¿¡æ¯ä¸¢è¿›**æ¶ˆæ¯ä¸­è½¬ç«™**ä¸­ï¼Œæ¨¡å—Bä¸€æ—¦å‘ç°ä¸­è½¬ç«™ä¸­æœ‰æ¶ˆæ¯å°±è¿›è¡Œå·¥ä½œã€‚è¿™ä¸ªä¸­è½¬ç«™å°±æ˜¯æ¶ˆæ¯é˜Ÿåˆ—ï¼Œèµ·ç€è§£è€¦åˆä½œç”¨\nè§£è€¦çš„æœ¬è´¨å°±æ˜¯**Aä¸ç”¨å…³å¿ƒBçš„äº‹æƒ…ï¼Œä»¥åŠä¸å—Bæ‰§è¡Œç»“æœçš„å½±å“**\n\n### æ¶ˆæ¯é˜Ÿåˆ—å‰Šå³°\nåœ¨è¯·æ±‚å¤„ç†é“¾ä¸­ï¼Œå„æ¨¡å—çš„å¤„ç†èƒ½åŠ›é€šå¸¸å­˜åœ¨è¾ƒå¤§å·®å¼‚ã€‚æ ¹æ®æœ¨æ¡¶åŸç†ï¼Œç³»ç»Ÿçš„ QPSï¼ˆæ¯ç§’æŸ¥è¯¢é‡ï¼‰å¾€å¾€å—æœ€å¼±å¤„ç†æ¨¡å—çš„é™åˆ¶ï¼Œè¿™å¯¼è‡´ä¸Šæ¸¸æ¨¡å—çš„å‰©ä½™å¤„ç†èƒ½åŠ›æ— æ³•å……åˆ†åˆ©ç”¨ï¼Œè¿›è€Œé€ æˆæ€§èƒ½ä¸èµ„æºçš„æµªè´¹ã€‚ä¸ºæå‡ç³»ç»Ÿæ•´ä½“çš„ QPSï¼Œå¹¶æœ€å¤§é™åº¦å‘æŒ¥ä¸Šæ¸¸æ¨¡å—çš„é«˜å“åº”æ€§èƒ½ï¼Œ**ä¸Šæ¸¸å¯ä»¥å°†å¤„ç†å®Œæˆçš„æ¶ˆæ¯æš‚å­˜è‡³æ¶ˆæ¯é˜Ÿåˆ—**ã€‚ä¸‹æ¸¸æ¨¡å—åˆ™ä»æ¶ˆæ¯é˜Ÿåˆ—ä¸­é€æ­¥è·å–æ¶ˆæ¯è¿›è¡Œå¤„ç†ï¼Œé€šè¿‡å»¶è¿Ÿå¤„ç†çš„æ–¹å¼ï¼Œå®ç°**å‰Šå³°å¡«è°·**çš„æ•ˆæœï¼Œæœ‰æ•ˆç¼“è§£è´Ÿè½½ä¸å‡é—®é¢˜ã€‚\nå®é™…åœºæ™¯ï¼š1ã€ç§’æ€åœºæ™¯ 2ã€å‡Œæ™¨å½•å…¥æ•°æ®\n\n```sh\ncnt=1\nwhile [ $cnt -le 10 ]\ndo\n\tcurl -w \"\\n cost %{time_total}s\" -H \"Trace-ID:lyydsheep1\" -H \"Content-Type: application/json; charset=utf-8\" -H \"User-ID: 7\" http://localhost:8080/demo/peak_clipping -d '{\"num\":1}'\n\tcnt=$((cnt + 1))\ndone\n```\n\n### æ¶ˆæ¯é˜Ÿåˆ—åˆ†å‘\nä¸€ä¸ªæ¨¡å—Aéœ€è¦å°†æ¶ˆæ¯åˆ†å‘è‡³æ¨¡å—Bã€Cã€D\nå®é™…åœºæ™¯ï¼š1ã€æ•°æ®æ›´æ–° 2ã€æ•°æ®åˆ†æ/æ ¡éªŒ\nåœ¨å¼•å…¥æ¶ˆæ¯é˜Ÿåˆ—ä¹‹å‰ï¼Œç”Ÿäº§è€…éœ€è¦äº†è§£æœ‰å¤šå°‘ä¸ªæ¶ˆè´¹è€…ï¼Œä»¥åŠæ¶ˆè´¹è€…å¯¹äºæ¶ˆæ¯çš„æ ¼å¼åŒ–è¦æ±‚ã€‚åœ¨å¼•å…¥æ¶ˆæ¯é˜Ÿåˆ—åï¼Œç”Ÿäº§è€…åªéœ€è¦å’Œæ¶ˆæ¯é˜Ÿåˆ—æ‰“äº¤é“ï¼Œä¸å¿…å…³å¿ƒæ¶ˆè´¹è€…ï¼Œä¹Ÿå¯ä»¥è¯´æ˜¯å®ç°äº†æ¶ˆæ¯ç¾¤å‘åœºæ™¯ä¸‹çš„è§£è€¦\n\n## åŸºæœ¬æ¦‚å¿µ\n\n- ç”Ÿäº§è€… producer\n- æ¶ˆè´¹è€… consumer\n- æ¶ˆæ¯æœåŠ¡å™¨ broker\n- topicä¸partition\n- æ¶ˆè´¹è€…ç»„ä¸æ¶ˆè´¹è€…\n\n![image-20241121143736964](https://raw.githubusercontent.com/lyydsheep/pic/main/202411211437013.png)\n\nbrokerï¼ˆä¸­é—´äººï¼‰ï¼Œæ˜¯ä¸€ä¸ªé€»è¾‘ä¸Šçš„æ¦‚å¿µã€‚åœ¨å®è·µä¸­ï¼Œå¯ä»¥æ˜ å°„ä¸ºä¸€ä¸ªæ¶ˆæ¯é˜Ÿåˆ—è¿›ç¨‹æˆ–ä¸€å°æœºå™¨\n\n**topicæ˜¯æ¶ˆæ¯é˜Ÿåˆ—ä¸Šä»£è¡¨ä¸åŒä¸šåŠ¡çš„ä¸œè¥¿**ï¼Œç®€å•æ¥è¯´ï¼Œä¸€ä¸ªä¸šåŠ¡å°±æ˜¯ä¸€ä¸ªtopicï¼Œè€Œ**ä¸€ä¸ªtopicå¯ä»¥æœ‰å¤šä¸ªåˆ†åŒº**\n\n![image-20241121144040306](https://raw.githubusercontent.com/lyydsheep/pic/main/202411211440344.png)\n\n**å½“å‘é€æ¶ˆæ¯åˆ°Kafkaä¸Šçš„æ—¶å€™ï¼ŒKafkaä¼šå…ˆæŠŠæ¶ˆæ¯å†™å…¥ä¸»åˆ†åŒºï¼Œå†åŒæ­¥åˆ°ä»åˆ†åŒº**ã€‚è¿™æ˜¯ä¸ºäº†ä¿è¯é«˜å¯ç”¨å’Œæ•°æ®ä¸ä¸¢å¤±\n\nä½†é€šå¸¸è¯´topicæœ‰å¤šå°‘ä¸ªåˆ†åŒºï¼Œæ˜¯æŒ‡æœ‰å¤šå°‘ä¸ªä¸»åˆ†åŒº\n\n![image-20241121144329550](https://raw.githubusercontent.com/lyydsheep/pic/main/202411211443600.png)\n\næ­£å¸¸æƒ…å†µä¸‹ï¼ŒåŒä¸€ä¸ªtopicçš„åˆ†åŒºä¼šå°½é‡å‡åŒ€åˆ†æ•£åˆ°æ‰€æœ‰çš„brokerä¸Šã€‚ä¸ºäº†ä¿è¯å½“æŸä¸ªbrokerå¥”æºƒåï¼Œä¸ä¼šé€ æˆå¾ˆå¤§çš„å½±å“ï¼Œéœ€è¦æ»¡è¶³ä¸‹é¢ä¸¤ä¸ªæ¡ä»¶ï¼š\n\n- **æ‰€æœ‰ä¸»åˆ†åŒºä¸åœ¨åŒä¸€ä¸ªbrokerä¸Š**\n- **åŒä¸€ä¸ªtopicçš„åˆ†åŒºä¸éƒ½åœ¨ä¸€ä¸ªbrokerä¸Š**\n\nå¦‚ä¸Šæ–‡æ‰€è¿°ï¼Œä¸€ä¸ªtopicéƒ½ä¼šæœ‰å¤šä¸ªåˆ†åŒºï¼Œ**æ‰€ä»¥å‘é€è€…åœ¨å‘é€æ¶ˆæ¯çš„æ—¶å€™ï¼Œå°±éœ€è¦é€‰æ‹©ä¸€ä¸ªç›®æ ‡ï¼ˆä¸»ï¼‰åˆ†åŒº**\n\næ¯”è¾ƒå¸¸ç”¨çš„ç­–ç•¥ï¼š\n\n- è½®è¯¢\n- å“ˆå¸Œ\n- éšæœº\n\n![image-20241121150303848](https://raw.githubusercontent.com/lyydsheep/pic/main/202411211503889.png)\n\nKafkaæ¶ˆæ¯éš”ç¦»å•ä½æ˜¯**åŒº**ï¼Œ**åªæœ‰ä¸€ä¸ªåˆ†åŒºå†…çš„æ¶ˆæ¯æ‰èƒ½ä¿è¯æ˜¯æœ‰åºçš„**\n\n**ä¸€ä¸ªæ¶ˆè´¹è€…ç»„å¯ä»¥çœ‹ä½œæ˜¯å…³å¿ƒè¿™ä¸ªtopicçš„ä¸šåŠ¡æ–¹**ï¼Œå¯¹äºä¸€ä¸ªåˆ†åŒºï¼ŒåŒä¸€ä¸ªæ¶ˆè´¹è€…ç»„åªèƒ½æœ‰ä¸€ä¸ªæ¶ˆè´¹è€…å‡ºæ¥æ¶ˆè´¹\n\n- ä¸€ä¸ªæ¶ˆè´¹è€…å¯ä»¥æ¶ˆè´¹å¤šä¸ªåˆ†åŒºçš„æ•°æ®\n- ä¸€ä¸ªåˆ†åŒºåœ¨åŒä¸€æ—¶åˆ»ï¼Œåªèƒ½è¢«ä¸€ä¸ªæ¶ˆè´¹è€…æ¶ˆè´¹\n\n![image-20241121151119740](https://raw.githubusercontent.com/lyydsheep/pic/main/202411211511775.png)\n\n**æ¶ˆæ¯ç§¯å‹é—®é¢˜**\n\n- **å¦‚æœä¸€ä¸ªtopicæœ‰Nä¸ªåˆ†ç»„ï¼Œé‚£ä¹ˆåŒä¸€ä¸ªæ¶ˆè´¹è€…ç»„æœ€å¤šæœ‰Nä¸ªæ¶ˆè´¹è€…ï¼Œå¤šä½™çš„æ¶ˆè´¹è€…ä¼šè¢«å¿½ç•¥**\n- **å¦‚æœæ¶ˆè´¹è€…æ€§èƒ½ä½ï¼Œé‚£ä¹ˆä¸èƒ½é€šè¿‡æ— é™å¢åŠ æ¶ˆè´¹è€…æ•°é‡çš„æ–¹å¼æé«˜æ¶ˆè´¹é€Ÿç‡**\n\n## å‘½ä»¤è¡Œå·¥å…·\n\nsaramaæä¾›äº†è®¸å¤šå‘½ä»¤è¡Œå·¥å…·ï¼Œå…¶ä¸­consumerå’Œproducerç”¨å¾—æ¯”è¾ƒå¤š\n\n```go\ngo install github.com/IBM/sarama/tools/kafka-console-consumer\n\ngo install github.com/IBM/sarama/tools/kafka-console-producer\n```\n\nè¿™äº›å…·ä½“å·¥å…·çš„ä½¿ç”¨æ–¹æ³•å¯ä»¥å‚è€ƒsaramaä¸­çš„`ReadMe`æ–‡æ¡£\n\n## Saramaä½¿ç”¨\n\n### åŒæ­¥å‘é€æ¶ˆæ¯\n\n```go\nfunc TestSyncProducer(t *testing.T) {\n\tcfg := sarama.NewConfig()\n\t// åŒæ­¥ç”Ÿäº§è€…å¿…é¡»è®¾ç½®\n\tcfg.Producer.Return.Successes = true\n\tclient, err := sarama.NewClient([]string{\"localhost:9094\"}, cfg)\n\trequire.NoError(t, err)\n\tproducer, err := sarama.NewSyncProducerFromClient(client)\n\trequire.NoError(t, err)\n\terr = producer.SendMessages([]*sarama.ProducerMessage{\n\t\t{\n\t\t\tTopic: \"test_topic\",\n\t\t\tValue: sarama.StringEncoder(\"message A\"),\n\t\t},\n\t\t{\n\t\t\tTopic: \"test_topic\",\n\t\t\tValue: sarama.StringEncoder(\"message B\"),\n\t\t},\n\t})\n\trequire.NoError(t, err)\n}\n\n```\n\n### æŒ‡å®šåˆ†åŒº\n\nç”±ä¸Šæ–‡å¯çŸ¥ï¼ŒKafkaåªèƒ½ä¿è¯ä¸€ä¸ªåˆ†åŒºå†…çš„æ¶ˆæ¯æ˜¯æœ‰åºçš„ã€‚å€˜è‹¥æˆ‘ä»¬å¸Œæœ›**åŒä¸€ä¸ªä¸šåŠ¡çš„æ¶ˆæ¯ä¸€å®šå‘é€åˆ°åŒä¸€ä¸ªåˆ†åŒºä¸Šï¼Œä¿è¯ä¸šåŠ¡å†…æ¶ˆæ¯æœ‰åºæ€§**ï¼Œå¯ä»¥å¯¹`sarama.Config.Producer`ç»“æ„ä½“ä¸­çš„`Partitioner`å­—æ®µè¿›è¡Œé…ç½®ï¼Œå¦‚ä¸‹å›¾ï¼š\n\n![image-20241124201226717](https://raw.githubusercontent.com/lyydsheep/pic/main/202411242012815.png)\n\nå¸¸è§çš„ï¼š\n\n- Randomï¼šéšæœºä¸€ä¸ª\n- RoundRobinï¼šè½®è¯¢\n- Hashï¼šæ ¹æ®Messageä¸­çš„keyçš„å“ˆå¸Œå€¼æ¥ç­›é€‰ä¸€ä¸ª\n- Manualï¼šæ ¹æ®Messageä¸­çš„partitionå­—æ®µæ¥é€‰æ‹©\n- ConsistentCRCï¼šä¸€è‡´æ€§å“ˆå¸Œï¼Œç”¨çš„æ˜¯CRC16ç®—æ³•\n- Customï¼šè‡ªå®šä¹‰ä¸€éƒ¨åˆ†Hashå‚æ•°\n\n### å¼‚æ­¥å‘é€æ¶ˆæ¯\n\n```go\nfunc TestAsyncProducer(t *testing.T) {\n\tcfg := sarama.NewConfig()\n\tcfg.Producer.Return.Successes = true\n\tcfg.Producer.Return.Errors = true\n\tclient, err := sarama.NewClient([]string{\"localhost:9094\"}, cfg)\n\trequire.NoError(t, err)\n\tproducer, err := sarama.NewAsyncProducerFromClient(client)\n\trequire.NoError(t, err)\n\tmsgInput := producer.Input()\n\tmsgInput <- &sarama.ProducerMessage{\n\t\tTopic: \"test_topic\",\n\t\tValue: sarama.StringEncoder(\"message Hello\"),\n\t}\n\tsuCh, erCh := producer.Successes(), producer.Errors()\n\t// å®è·µä¸­ä¸€èˆ¬éƒ½æ˜¯å¼€ä¸€ä¸ªgoroutineæ¥å¤„ç†\n\tselect {\n\tcase msg := <-suCh:\n\t\tval, _ := msg.Value.Encode()\n\t\tfmt.Println(msg.Topic, string(val))\n\tcase err := <-erCh:\n\t\tfmt.Println(err.Error())\n\t}\n}\n```\n\n- éœ€è¦æŠŠ`Success`å’Œ`Errors`éƒ½è®¾ç½®ä¸º`true`ï¼Œè¿™æ˜¯ä¸ºäº†åé¢èƒ½å¼‚æ­¥è·å–åˆ°ç»“æœ\n- é€šè¿‡ä¸€ä¸ª**channel**å¼‚æ­¥å‘é€æ¶ˆæ¯\n- é€šè¿‡`select case`ï¼Œç›‘å¬å¼‚æ­¥å‘é€æ¶ˆæ¯çš„ç»“æœ\n\n### æŒ‡å®šacks\n\nç”Ÿäº§è€…åœ¨å‘é€æ•°æ®çš„æ—¶å€™ï¼Œæœ‰ä¸€ä¸ªå…³é”®å‚æ•°â€”â€”**acks**,è¯¥å‚æ•°æœ‰ä¸‰ä¸ªå–å€¼ï¼š\n\n![image-20241125193828822](https://raw.githubusercontent.com/lyydsheep/pic/main/202411251938899.png)\n\n- 0ï¼šå®¢æˆ·ç«¯å‘ä¸€æ¬¡ï¼Œä»…æ”¶åˆ°TCPçš„ACKæŠ¥æ–‡ï¼ˆæ²¡å®è´¨ä½œç”¨ï¼‰\n- 1ï¼šå®¢æˆ·ç«¯å‘é€ä¸€æ¬¡ï¼Œéœ€è¦**ç­‰å¾…æœåŠ¡ç«¯å°†æ¶ˆæ¯å†™å…¥ä¸»åˆ†åŒº**ï¼Œèƒ½ç¡®ä¿æ¶ˆæ¯æˆåŠŸé€è¾¾\n- -1ï¼šå®¢æˆ·ç«¯å‘é€ä¸€æ¬¡ï¼Œéœ€è¦**ç­‰å¾…æœåŠ¡ç«¯å°†æ¶ˆæ¯åŒæ­¥è‡³æ‰€æœ‰ï¼ˆå¯é…ç½®ï¼‰çš„ISRä¸Š**\n\n![image-20241125194219136](https://raw.githubusercontent.com/lyydsheep/pic/main/202411251942196.png)\n\nè‡ªä¸Šè€Œä¸‹ï¼Œæ€§èƒ½é€æ¸å˜å·®ï¼Œä½†æ˜¯æ•°æ®å¯é æ€§ä¸Šå‡\n\n### ISR\n\n**ISRï¼ˆIn Sync Replicasï¼‰ï¼Œå°±æ˜¯å’Œä¸»åˆ†åŒºä¿æŒæ•°æ®åŒæ­¥çš„ä»åˆ†åŒºé›†åˆ**\n\n![image-20241125194510901](https://raw.githubusercontent.com/lyydsheep/pic/main/202411251945935.png)\n\n### **å¯åŠ¨æ¶ˆè´¹è€…**\n\n```go\nfunc TestConsumer(t *testing.T) {\n\tcfg := sarama.NewConfig()\n\t// è®¾ç½®åˆå§‹æ¶ˆè´¹åç§»é‡ï¼Œå¦‚æœæ²¡æœ‰å·²æäº¤çš„offsetæ•°æ®ï¼Œåˆ™é»˜è®¤æ˜¯ä¸‹ä¸€ä¸ªæ¶ˆæ¯çš„ä½ç½®\n\t//cfg.Consumer.Offsets.Initial = sarama.OffsetOldest\n\tcg, err := sarama.NewConsumerGroup([]string{\"localhost:9094\"}, \"test_id\", cfg)\n\trequire.NoError(t, err)\n\t// å®šæ—¶ç»“æŸ\n\tctx, cancel := context.WithTimeout(context.Background(), time.Second*10)\n\tdefer cancel()\n\terr = cg.Consume(ctx, []string{\"test_topic\"}, &ConsumerHandler{})\n}\n\ntype ConsumerHandler struct {\n}\n\nfunc (c ConsumerHandler) Setup(session sarama.ConsumerGroupSession) error {\n\tfmt.Println(\"this is setup\")\n\t// é‡ç½®åç§»é‡\n\t//partitions := session.Claims()[\"test_topic\"]\n\t//for _, v := range partitions {\n\t//\tsession.ResetOffset(\"test_topic\", v, sarama.OffsetOldest, \"\")\n\t//}\n\treturn nil\n}\n\nfunc (c ConsumerHandler) Cleanup(session sarama.ConsumerGroupSession) error {\n\tfmt.Println(\"this is cleanup\")\n\treturn nil\n}\n\nfunc (c ConsumerHandler) ConsumeClaim(session sarama.ConsumerGroupSession, claim sarama.ConsumerGroupClaim) error {\n\t// å…³é”®å®ç°\n\tmsgCh := claim.Messages()\n\tfor msg := range msgCh {\n\t\tfmt.Println(string(msg.Value))\n\t\t// æ ‡è®°æ¶ˆè´¹æˆåŠŸï¼Œç”¨äºç§»åŠ¨offset\n\t\t// æœåŠ¡ç«¯åªä¼šæäº¤å¸¦æœ‰æ ‡è®°çš„æ¶ˆæ¯ï¼Œä»£è¡¨è¯¥æ¶ˆæ¯è¢«æˆåŠŸæ¶ˆè´¹\n\t\tsession.MarkMessage(msg, \"\")\n\t}\n\treturn nil\n}\n```\n\n- åˆå§‹åŒ–ä¸€ä¸ª**æ¶ˆè´¹è€…ç»„**\n- è°ƒç”¨æ¶ˆè´¹è€…ç»„çš„**Consume**æ–¹æ³•\n- ä¸º**Consume**æ–¹æ³•ä¼ å…¥ä¸€ä¸ª**ConsumerGroupHandleræ¥å£**\n  - å‘Consumeæ–¹æ³•ä¸­ä¼ å…¥ä¸€ä¸ªå¸¦æœ‰å®šæ—¶å™¨æˆ–Cancelçš„Contextï¼Œå¯ä»¥æ§åˆ¶æ¶ˆè´¹è€…é€€å‡º\n\nConsumerGroupHandleræ¥å£éœ€è¦å®ç°ä¸‰ä¸ªæ–¹æ³•ï¼š\n\n- Setup\n- Cleanup\n- ConsumeClaim\n\nå…¶ä¸­æ¶ˆè´¹ç»„å¯¹æ¶ˆæ¯è¿›è¡Œæ¶ˆè´¹çš„é€»è¾‘åœ¨ConsumClaimæ–¹æ³•ä¸­å®ç°ï¼š\n\n![image-20241126130732077](https://raw.githubusercontent.com/lyydsheep/pic/main/202411261307125.png)\n\nç”±äºConsumeæ–¹æ³•éœ€è¦çš„æ˜¯ä¸€ä¸ªæ¥å£ï¼Œé‚£ä¹ˆæˆ‘ä»¬å¯ä»¥åŸºäºç±»å‹å®šä¹‰ã€ç»“æ„ä½“ç­‰æ–¹å¼èŠ±å¼å®ç°ConsumeClaimæ–¹æ³•ï¼Œä»¥è¾¾åˆ°ä¸€äº›å·§å¦™çš„ä½œç”¨\n\n### è‡ªå®šåç§»é‡æ¶ˆè´¹\n\nsaramaä¸­æä¾›äº†ä¸¤ä¸ªè®¾ç½®åç§»é‡çš„æ–¹æ³•ï¼š\n\n- è®¾ç½®`cfg.Consumer.Offsets.Initial`å­—æ®µ\n\n  - ```go\n    cfg := sarama.NewConfig()\n    // è®¾ç½®åˆå§‹æ¶ˆè´¹åç§»é‡ï¼Œå¦‚æœæ²¡æœ‰å·²æäº¤çš„offsetæ•°æ®ï¼Œåˆ™é»˜è®¤æ˜¯ä¸‹ä¸€ä¸ªæ¶ˆæ¯çš„ä½ç½®\n    cfg.Consumer.Offsets.Initial = sarama.OffsetOldest\n    ```\n\n- è°ƒç”¨`session.ResetOffset()`æ–¹æ³•\n\n  - ```go\n    // é‡ç½®åç§»é‡\n    partitions := session.Claims()[\"test_topic\"]\n    for _, v := range partitions {\n    \tsession.ResetOffset(\"test_topic\", v, sarama.OffsetOldest, \"\")\n    }\n    ```\n\nResetOffsetæ–¹æ³•é€šå¸¸åœ¨Setupå‡½æ•°ä¸­è°ƒç”¨\n\nå€¼å¾—æ³¨æ„çš„æ˜¯ï¼Œåªæœ‰ä¸Šè¿°ä¸¤ä¸ªæ–¹å¼åŒæ—¶æ‰§è¡Œï¼Œæ¶ˆè´¹è€…ç»„æ‰ä¼šä»å†å²ç¬¬ä¸€æ¡æ¶ˆæ¯è¿›è¡Œæ¶ˆè´¹ã€‚æœ€å¥½çš„æ–¹å¼æ˜¯èµ°ç¦»çº¿æ¸ é“ï¼Œæ“ä½œkafkaé›†ç¾¤å»é‡ç½®å¯¹åº”çš„åç§»é‡ã€‚\n\n### å¼‚æ­¥æ¶ˆè´¹ï¼Œæ‰¹é‡æäº¤\n\n```go\nfunc (h *Handler[T]) ConsumeClaim(session sarama.ConsumerGroupSession, claim sarama.ConsumerGroupClaim) error {\n\tmsgCh := claim.Messages()\n\tfor {\n\t\tctx, cancel := context.WithTimeout(context.Background(), time.Second*2)\n\t\tdone := false\n\t\tmsgs := make([]*sarama.ConsumerMessage, 0, 10)\n\t\tevts := make([]T, 0, 10)\n\t\tfor i := 0; i < h.batch && !done; i++ {\n\t\t\tselect {\n\t\t\tcase msg, ok := <-msgCh:\n\t\t\t\tif !ok {\n\t\t\t\t\t// msgChè¢«å…³é—­\n\t\t\t\t\tcancel()\n\t\t\t\t\treturn nil\n\t\t\t\t}\n\t\t\t\tvar t T\n\t\t\t\terr := json.Unmarshal(msg.Value, &t)\n\t\t\t\tif err != nil {\n\t\t\t\t\th.l.Error(\"fail to unmarshal\")\n\t\t\t\t\tcontinue\n\t\t\t\t}\n\t\t\t\tmsgs = append(msgs, msg)\n\t\t\t\tevts = append(evts, t)\n\t\t\tcase <-ctx.Done():\n\t\t\t\tdone = true\n\t\t\t}\n\t\t}\n\t\tcancel()\n\t\terr := h.fn(msgs, evts)\n\t\tif err != nil {\n\t\t\treturn err\n\t\t}\n\t\tfor i := range msgs {\n\t\t\tsession.MarkMessage(msgs[i], \"\")\n\t\t}\n\t}\n}\n\n```\n\n**å¼‚æ­¥æ¶ˆè´¹ä¸€æ‰¹ï¼Œæäº¤ä¸€æ‰¹**ã€‚\n\nå…¶ä¸­æäº¤ä¸€æ‰¹åœ¨å®ç°è¿‡ç¨‹ä¸­åªéœ€è¦**å°†æœ€åä¸€ä¸ªæ¶ˆæ¯æ ‡è®°**å³å¯\n\nåœ¨`select case`ä¸­æœ‰ä¸¤ä¸ªåˆ†æ”¯ï¼Œä¸€ä¸ªåˆ†æ”¯æ˜¯ctx.Doneï¼Œå¯ä»¥é˜²æ­¢å› é•¿æ—¶é—´å‡‘ä¸é½ä¸€ä¸ªbatchçš„æ¶ˆæ¯ï¼Œè€Œå¯¼è‡´çš„é˜»å¡ç°è±¡ï¼›å¦ä¸€ä¸ªåˆ†æ”¯è°ƒç”¨`errgroup.Go()`æ–¹æ³•å¼‚æ­¥å¤„ç†kafkaä¸­çš„æ¶ˆæ¯\n\n## æ”¹é€ ç»Ÿè®¡é˜…è¯»è®¡æ•°\n\n**DDDä¸­çš„ä¸€ä¸ªé‡è¦æ¦‚å¿µï¼šé¢†åŸŸäº‹ä»¶**\n\nå½“æˆ‘ä»¬åœ¨å‘é€æ¶ˆæ¯æ—¶ï¼Œéœ€è¦å‘é€çš„æ˜¯ä¸€ä¸ª**äº‹ä»¶**ï¼Œå³æŸä¸ªç”¨æˆ·é˜…è¯»äº†æŸç¯‡æ–‡ç« çš„äº‹ä»¶ã€‚é¡¹ç›®ç»“æ„ï¼š\n\n![image-20241127185624318](https://raw.githubusercontent.com/lyydsheep/pic/main/202411271856428.png)\n\n### å°è£…æ‰¹é‡æ¶ˆè´¹\n\nå‰æ–‡æåŠ`cg.consumer()`æ–¹æ³•ç¬¬ä¸‰ä¸ªå‚æ•°æ˜¯ä¸€ä¸ª`ConsumeGroupHandler`æ¥å£å‚æ•°ï¼Œæˆ‘ä»¬å¯ä»¥å°è£…ä¸€ä¸ªHandlerç»“æ„ä½“å®ç°è¿™ä¸ªæ¥å£ï¼Œè¿™ä¸ªç»“æ„ä½“åˆå§‹åŒ–æ—¶æ¥å—ä¸šåŠ¡æ–¹çš„æ¶ˆè´¹å‡½æ•°ï¼Œå¹¶åœ¨`ConsumeClaim()`æ–¹æ³•ä¸­è°ƒç”¨ä¸‹æ¸¸çš„æ¶ˆè´¹å‡½æ•°å¯¹æ¶ˆæ¯è¿›è¡Œå¤„ç†ã€‚å…·ä½“ï¼ˆæ‰¹é‡æ¶ˆè´¹ï¼‰å°è£…ä¸‹ï¼š\n\n```go\ntype Handler[T any] struct {\n\tl     *zap.Logger\n\tfn    func(msgs []*sarama.ConsumerMessage, evts []T) error\n\tbatch int\n}\n\nfunc (h *Handler[T]) ConsumeClaim(session sarama.ConsumerGroupSession, claim sarama.ConsumerGroupClaim) error {\n\tmsgCh := claim.Messages()\n\tfor {\n\t\tctx, cancel := context.WithTimeout(context.Background(), time.Second)\n\t\tmsgs := make([]*sarama.ConsumerMessage, 0, h.batch)\n\t\tevts := make([]T, 0, h.batch)\n\t\tdone := false\n\t\tfor i := 0; i < h.batch && !done; i++ {\n\t\t\tselect {\n\t\t\tcase msg, ok := <-msgCh:\n\t\t\t\tif !ok {\n\t\t\t\t\t// channelå…³é—­\n\t\t\t\t\tcancel()\n\t\t\t\t\treturn nil\n\t\t\t\t}\n\t\t\t\tvar t T\n\t\t\t\terr := json.Unmarshal(msg.Value, &t)\n\t\t\t\tif err != nil {\n\t\t\t\t\t// è®°å½•æ—¥å¿—\n\t\t\t\t\tcontinue\n\t\t\t\t}\n\t\t\t\tmsgs = append(msgs, msg)\n\t\t\t\tevts = append(evts, t)\n\t\t\tcase <-ctx.Done():\n\t\t\t\t// è¶…æ—¶\n\t\t\t\tdone = true\n\t\t\t}\n\t\t}\n\t\tcancel()\n\t\terr := h.fn(msgs, evts)\n\t\tif err != nil {\n\t\t\t// è®°å½•æ—¥å¿—\n\t\t\t// è®°å½•æ•´ä¸ªæ‰¹æ¬¡\n\t\t\t// ç»§ç»­æ¶ˆè´¹\n\t\t}\n\t\t// æ ‡è®°æ¶ˆæ¯\n\t\tfor i := range msgs {\n\t\t\tsession.MarkMessage(msgs[i], \"\")\n\t\t}\n\t}\n}\n```\n\nä¸Šè¿°ä»£ç å®ç°äº†å¯¹æ¶ˆè´¹è€…æ‰¹é‡æ¶ˆè´¹çš„å°è£…ï¼Œå¯ä»¥æé«˜ç³»ç»Ÿå¤„ç†æ¶ˆæ¯çš„æ€§èƒ½ã€‚è¿™æ˜¯å› ä¸ºæ‰¹é‡å¤„ç†å¯ä»¥å°†DAOå±‚é¢10æ¬¡ï¼ˆå‡å®šbatchä¸º10ï¼‰äº‹åŠ¡å¤„ç†ç¼©å‡è‡³åœ¨ä¸€æ¬¡äº‹åŠ¡ä¸­å¤„ç†åæ¬¡æ“ä½œã€‚ä¸¤ä¸ªæ³¨æ„ç‚¹ï¼š\n\n- æ³¨æ„è¶…æ—¶\n- è°ƒç”¨ä¸‹æ¸¸\n\n### ç»„è£…æ¶ˆè´¹è€…\n\nåœ¨ä¾èµ–æ³¨å…¥çš„è¿‡ç¨‹ä¸­ï¼Œæ¶ˆè´¹è€…ç±»ä¼¼äºWebã€GRpcæœåŠ¡å™¨çš„ä¸œè¥¿ï¼Œéœ€è¦å¯åŠ¨ã€‚å› æ­¤å¼•å…¥ä¸€ä¸ªAppç»“æ„ä½“ï¼Œå¯¹Webå’Œæ¶ˆè´¹è€…è¿›è¡Œç»„åˆ\n\n```go\n// app.go\ntype App struct {\n    Web *gin.Engine\n    Consumers []events.Consumer\n}\n\n// ioc/kafka.go\n// ç”±äºGoæ²¡æœ‰åŠ¨æ€ç±»å‹ï¼Œå› æ­¤æ¯ä¸€ä¸ªæ¶ˆè´¹è€…éƒ½éœ€è¦è¿›è¡Œæ³¨å†Œæ“ä½œ\nfunc NewConsumers(c1 *articles.InteractiveReadEventConsumer) []events.Consumer {\n    return []events.Consumer{c1}\n}\n\n// wire.go\n// ç»„åˆç»“æ„ä½“æ‰€æœ‰çš„å­—æ®µï¼Œ*è¡¨ç¤ºæ‰€æœ‰\nwire.Struct(new(App), \"*\")\n```\n\n### æ‰¹é‡ç”Ÿäº§\n\nsvcé€šè¿‡channelå°†æ¶ˆæ¯å‘é€ç»™ç”Ÿäº§è€…ï¼Œå½“ç”Ÿäº§è€…ç§¯ç´¯è¶³å¤Ÿå¤šçš„æ¶ˆæ¯åï¼Œå°±å°†è¿™ä¸€æ‰¹æ¶ˆæ¯å‘é€ç»™Kafka\n\n```go\nfunc NewBasicInteractService(repo repository.InteractRepository, producer events.Producer) *BasicInteractService {\n\tch := make(chan events.ReadEvent, 10)\n    // å‡‘è¶³ä¸€æ‰¹æ¶ˆæ¯\n\tgo func() {\n\t\tfor {\n\t\t\tctx, cancel := context.WithTimeout(context.Background(), time.Second)\n\t\t\tevts := make([]events.ReadEvent, 0, 10)\n\t\t\tdone := false\n\t\t\tfor i := 0; i < 10 && !done; i++ {\n\t\t\t\tselect {\n\t\t\t\tcase evt, ok := <-ch:\n\t\t\t\t\tif !ok {\n\t\t\t\t\t\tcancel()\n\t\t\t\t\t\tbreak\n\t\t\t\t\t}\n\t\t\t\t\tevts = append(evts, evt)\n\t\t\t\tcase <-ctx.Done():\n\t\t\t\t\tdone = true\n\t\t\t\t}\n\t\t\t}\n\t\t\tcancel()\n\t\t\terr := producer.ProduceReadEventV1(ctx, evts)\n\t\t\tif err != nil {\n\t\t\t\t// æ—¥å¿—\n\t\t\t}\n\t\t}\n\t}()\n\treturn &BasicInteractService{repo: repo, producer: producer, ch: ch}\n}\n\n\n// ç§¯ç´¯æ¶ˆæ¯\nfunc (svc *BasicInteractService) IncReadCnt(ctx context.Context, biz string, bizId, uid int64) error {\n\t_, err := svc.Get(ctx, biz, bizId, uid)\n\tgo func() {\n\t\tif err == nil {\n\t\t\tsvc.ch <- events.ReadEvent{\n\t\t\t\tUid: uid,\n\t\t\t\tAid: bizId,\n\t\t\t}\n\t\t}\n\t}()\n\treturn err\n}\n```\n\n","source":"_posts/Kafkaå®è·µ.md","raw":"# æ¶ˆæ¯é˜Ÿåˆ—\n\næ¶ˆæ¯é˜Ÿåˆ—çš„åŸºæœ¬å½¢æ€ï¼Œå°±æ˜¯æœ‰**Nä¸ªç”Ÿäº§è€…ï¼ŒNä¸ªæ¶ˆè´¹è€…**\n\nç”Ÿäº§è€…å’Œæ¶ˆè´¹è€…è§£è€¦äº†\n\n## åº”ç”¨åœºæ™¯\n### æ¶ˆæ¯é˜Ÿåˆ—è§£è€¦\nä¸€ä¸ªæ¨¡å—Aæ¥æ”¶åˆ°è¯·æ±‚åéœ€è¦è°ƒç”¨æ¨¡å—Bï¼Œæ¥ç€ç­‰å¾…æ¨¡å—Bå®Œæˆåç»­å·¥ä½œï¼Œæ‰è¿›è¡Œå›åŒ…ã€‚è¿™ç§æƒ…å†µä¸‹æ¨¡å—Aæåº¦ä¾èµ–äºæ¨¡å—Bçš„è¿è¡ŒçŠ¶å†µï¼Œè€¦åˆåº¦è¾ƒé«˜ã€‚å¦‚æœä¸šåŠ¡å…è®¸çš„è¯ï¼Œæ¨¡å—Aå®Œå…¨å¯ä»¥å°†è°ƒç”¨æ¨¡å—Bçš„è¯·æ±‚ä¿¡æ¯ä¸¢è¿›**æ¶ˆæ¯ä¸­è½¬ç«™**ä¸­ï¼Œæ¨¡å—Bä¸€æ—¦å‘ç°ä¸­è½¬ç«™ä¸­æœ‰æ¶ˆæ¯å°±è¿›è¡Œå·¥ä½œã€‚è¿™ä¸ªä¸­è½¬ç«™å°±æ˜¯æ¶ˆæ¯é˜Ÿåˆ—ï¼Œèµ·ç€è§£è€¦åˆä½œç”¨\nè§£è€¦çš„æœ¬è´¨å°±æ˜¯**Aä¸ç”¨å…³å¿ƒBçš„äº‹æƒ…ï¼Œä»¥åŠä¸å—Bæ‰§è¡Œç»“æœçš„å½±å“**\n\n### æ¶ˆæ¯é˜Ÿåˆ—å‰Šå³°\nåœ¨è¯·æ±‚å¤„ç†é“¾ä¸­ï¼Œå„æ¨¡å—çš„å¤„ç†èƒ½åŠ›é€šå¸¸å­˜åœ¨è¾ƒå¤§å·®å¼‚ã€‚æ ¹æ®æœ¨æ¡¶åŸç†ï¼Œç³»ç»Ÿçš„ QPSï¼ˆæ¯ç§’æŸ¥è¯¢é‡ï¼‰å¾€å¾€å—æœ€å¼±å¤„ç†æ¨¡å—çš„é™åˆ¶ï¼Œè¿™å¯¼è‡´ä¸Šæ¸¸æ¨¡å—çš„å‰©ä½™å¤„ç†èƒ½åŠ›æ— æ³•å……åˆ†åˆ©ç”¨ï¼Œè¿›è€Œé€ æˆæ€§èƒ½ä¸èµ„æºçš„æµªè´¹ã€‚ä¸ºæå‡ç³»ç»Ÿæ•´ä½“çš„ QPSï¼Œå¹¶æœ€å¤§é™åº¦å‘æŒ¥ä¸Šæ¸¸æ¨¡å—çš„é«˜å“åº”æ€§èƒ½ï¼Œ**ä¸Šæ¸¸å¯ä»¥å°†å¤„ç†å®Œæˆçš„æ¶ˆæ¯æš‚å­˜è‡³æ¶ˆæ¯é˜Ÿåˆ—**ã€‚ä¸‹æ¸¸æ¨¡å—åˆ™ä»æ¶ˆæ¯é˜Ÿåˆ—ä¸­é€æ­¥è·å–æ¶ˆæ¯è¿›è¡Œå¤„ç†ï¼Œé€šè¿‡å»¶è¿Ÿå¤„ç†çš„æ–¹å¼ï¼Œå®ç°**å‰Šå³°å¡«è°·**çš„æ•ˆæœï¼Œæœ‰æ•ˆç¼“è§£è´Ÿè½½ä¸å‡é—®é¢˜ã€‚\nå®é™…åœºæ™¯ï¼š1ã€ç§’æ€åœºæ™¯ 2ã€å‡Œæ™¨å½•å…¥æ•°æ®\n\n```sh\ncnt=1\nwhile [ $cnt -le 10 ]\ndo\n\tcurl -w \"\\n cost %{time_total}s\" -H \"Trace-ID:lyydsheep1\" -H \"Content-Type: application/json; charset=utf-8\" -H \"User-ID: 7\" http://localhost:8080/demo/peak_clipping -d '{\"num\":1}'\n\tcnt=$((cnt + 1))\ndone\n```\n\n### æ¶ˆæ¯é˜Ÿåˆ—åˆ†å‘\nä¸€ä¸ªæ¨¡å—Aéœ€è¦å°†æ¶ˆæ¯åˆ†å‘è‡³æ¨¡å—Bã€Cã€D\nå®é™…åœºæ™¯ï¼š1ã€æ•°æ®æ›´æ–° 2ã€æ•°æ®åˆ†æ/æ ¡éªŒ\nåœ¨å¼•å…¥æ¶ˆæ¯é˜Ÿåˆ—ä¹‹å‰ï¼Œç”Ÿäº§è€…éœ€è¦äº†è§£æœ‰å¤šå°‘ä¸ªæ¶ˆè´¹è€…ï¼Œä»¥åŠæ¶ˆè´¹è€…å¯¹äºæ¶ˆæ¯çš„æ ¼å¼åŒ–è¦æ±‚ã€‚åœ¨å¼•å…¥æ¶ˆæ¯é˜Ÿåˆ—åï¼Œç”Ÿäº§è€…åªéœ€è¦å’Œæ¶ˆæ¯é˜Ÿåˆ—æ‰“äº¤é“ï¼Œä¸å¿…å…³å¿ƒæ¶ˆè´¹è€…ï¼Œä¹Ÿå¯ä»¥è¯´æ˜¯å®ç°äº†æ¶ˆæ¯ç¾¤å‘åœºæ™¯ä¸‹çš„è§£è€¦\n\n## åŸºæœ¬æ¦‚å¿µ\n\n- ç”Ÿäº§è€… producer\n- æ¶ˆè´¹è€… consumer\n- æ¶ˆæ¯æœåŠ¡å™¨ broker\n- topicä¸partition\n- æ¶ˆè´¹è€…ç»„ä¸æ¶ˆè´¹è€…\n\n![image-20241121143736964](https://raw.githubusercontent.com/lyydsheep/pic/main/202411211437013.png)\n\nbrokerï¼ˆä¸­é—´äººï¼‰ï¼Œæ˜¯ä¸€ä¸ªé€»è¾‘ä¸Šçš„æ¦‚å¿µã€‚åœ¨å®è·µä¸­ï¼Œå¯ä»¥æ˜ å°„ä¸ºä¸€ä¸ªæ¶ˆæ¯é˜Ÿåˆ—è¿›ç¨‹æˆ–ä¸€å°æœºå™¨\n\n**topicæ˜¯æ¶ˆæ¯é˜Ÿåˆ—ä¸Šä»£è¡¨ä¸åŒä¸šåŠ¡çš„ä¸œè¥¿**ï¼Œç®€å•æ¥è¯´ï¼Œä¸€ä¸ªä¸šåŠ¡å°±æ˜¯ä¸€ä¸ªtopicï¼Œè€Œ**ä¸€ä¸ªtopicå¯ä»¥æœ‰å¤šä¸ªåˆ†åŒº**\n\n![image-20241121144040306](https://raw.githubusercontent.com/lyydsheep/pic/main/202411211440344.png)\n\n**å½“å‘é€æ¶ˆæ¯åˆ°Kafkaä¸Šçš„æ—¶å€™ï¼ŒKafkaä¼šå…ˆæŠŠæ¶ˆæ¯å†™å…¥ä¸»åˆ†åŒºï¼Œå†åŒæ­¥åˆ°ä»åˆ†åŒº**ã€‚è¿™æ˜¯ä¸ºäº†ä¿è¯é«˜å¯ç”¨å’Œæ•°æ®ä¸ä¸¢å¤±\n\nä½†é€šå¸¸è¯´topicæœ‰å¤šå°‘ä¸ªåˆ†åŒºï¼Œæ˜¯æŒ‡æœ‰å¤šå°‘ä¸ªä¸»åˆ†åŒº\n\n![image-20241121144329550](https://raw.githubusercontent.com/lyydsheep/pic/main/202411211443600.png)\n\næ­£å¸¸æƒ…å†µä¸‹ï¼ŒåŒä¸€ä¸ªtopicçš„åˆ†åŒºä¼šå°½é‡å‡åŒ€åˆ†æ•£åˆ°æ‰€æœ‰çš„brokerä¸Šã€‚ä¸ºäº†ä¿è¯å½“æŸä¸ªbrokerå¥”æºƒåï¼Œä¸ä¼šé€ æˆå¾ˆå¤§çš„å½±å“ï¼Œéœ€è¦æ»¡è¶³ä¸‹é¢ä¸¤ä¸ªæ¡ä»¶ï¼š\n\n- **æ‰€æœ‰ä¸»åˆ†åŒºä¸åœ¨åŒä¸€ä¸ªbrokerä¸Š**\n- **åŒä¸€ä¸ªtopicçš„åˆ†åŒºä¸éƒ½åœ¨ä¸€ä¸ªbrokerä¸Š**\n\nå¦‚ä¸Šæ–‡æ‰€è¿°ï¼Œä¸€ä¸ªtopicéƒ½ä¼šæœ‰å¤šä¸ªåˆ†åŒºï¼Œ**æ‰€ä»¥å‘é€è€…åœ¨å‘é€æ¶ˆæ¯çš„æ—¶å€™ï¼Œå°±éœ€è¦é€‰æ‹©ä¸€ä¸ªç›®æ ‡ï¼ˆä¸»ï¼‰åˆ†åŒº**\n\næ¯”è¾ƒå¸¸ç”¨çš„ç­–ç•¥ï¼š\n\n- è½®è¯¢\n- å“ˆå¸Œ\n- éšæœº\n\n![image-20241121150303848](https://raw.githubusercontent.com/lyydsheep/pic/main/202411211503889.png)\n\nKafkaæ¶ˆæ¯éš”ç¦»å•ä½æ˜¯**åŒº**ï¼Œ**åªæœ‰ä¸€ä¸ªåˆ†åŒºå†…çš„æ¶ˆæ¯æ‰èƒ½ä¿è¯æ˜¯æœ‰åºçš„**\n\n**ä¸€ä¸ªæ¶ˆè´¹è€…ç»„å¯ä»¥çœ‹ä½œæ˜¯å…³å¿ƒè¿™ä¸ªtopicçš„ä¸šåŠ¡æ–¹**ï¼Œå¯¹äºä¸€ä¸ªåˆ†åŒºï¼ŒåŒä¸€ä¸ªæ¶ˆè´¹è€…ç»„åªèƒ½æœ‰ä¸€ä¸ªæ¶ˆè´¹è€…å‡ºæ¥æ¶ˆè´¹\n\n- ä¸€ä¸ªæ¶ˆè´¹è€…å¯ä»¥æ¶ˆè´¹å¤šä¸ªåˆ†åŒºçš„æ•°æ®\n- ä¸€ä¸ªåˆ†åŒºåœ¨åŒä¸€æ—¶åˆ»ï¼Œåªèƒ½è¢«ä¸€ä¸ªæ¶ˆè´¹è€…æ¶ˆè´¹\n\n![image-20241121151119740](https://raw.githubusercontent.com/lyydsheep/pic/main/202411211511775.png)\n\n**æ¶ˆæ¯ç§¯å‹é—®é¢˜**\n\n- **å¦‚æœä¸€ä¸ªtopicæœ‰Nä¸ªåˆ†ç»„ï¼Œé‚£ä¹ˆåŒä¸€ä¸ªæ¶ˆè´¹è€…ç»„æœ€å¤šæœ‰Nä¸ªæ¶ˆè´¹è€…ï¼Œå¤šä½™çš„æ¶ˆè´¹è€…ä¼šè¢«å¿½ç•¥**\n- **å¦‚æœæ¶ˆè´¹è€…æ€§èƒ½ä½ï¼Œé‚£ä¹ˆä¸èƒ½é€šè¿‡æ— é™å¢åŠ æ¶ˆè´¹è€…æ•°é‡çš„æ–¹å¼æé«˜æ¶ˆè´¹é€Ÿç‡**\n\n## å‘½ä»¤è¡Œå·¥å…·\n\nsaramaæä¾›äº†è®¸å¤šå‘½ä»¤è¡Œå·¥å…·ï¼Œå…¶ä¸­consumerå’Œproducerç”¨å¾—æ¯”è¾ƒå¤š\n\n```go\ngo install github.com/IBM/sarama/tools/kafka-console-consumer\n\ngo install github.com/IBM/sarama/tools/kafka-console-producer\n```\n\nè¿™äº›å…·ä½“å·¥å…·çš„ä½¿ç”¨æ–¹æ³•å¯ä»¥å‚è€ƒsaramaä¸­çš„`ReadMe`æ–‡æ¡£\n\n## Saramaä½¿ç”¨\n\n### åŒæ­¥å‘é€æ¶ˆæ¯\n\n```go\nfunc TestSyncProducer(t *testing.T) {\n\tcfg := sarama.NewConfig()\n\t// åŒæ­¥ç”Ÿäº§è€…å¿…é¡»è®¾ç½®\n\tcfg.Producer.Return.Successes = true\n\tclient, err := sarama.NewClient([]string{\"localhost:9094\"}, cfg)\n\trequire.NoError(t, err)\n\tproducer, err := sarama.NewSyncProducerFromClient(client)\n\trequire.NoError(t, err)\n\terr = producer.SendMessages([]*sarama.ProducerMessage{\n\t\t{\n\t\t\tTopic: \"test_topic\",\n\t\t\tValue: sarama.StringEncoder(\"message A\"),\n\t\t},\n\t\t{\n\t\t\tTopic: \"test_topic\",\n\t\t\tValue: sarama.StringEncoder(\"message B\"),\n\t\t},\n\t})\n\trequire.NoError(t, err)\n}\n\n```\n\n### æŒ‡å®šåˆ†åŒº\n\nç”±ä¸Šæ–‡å¯çŸ¥ï¼ŒKafkaåªèƒ½ä¿è¯ä¸€ä¸ªåˆ†åŒºå†…çš„æ¶ˆæ¯æ˜¯æœ‰åºçš„ã€‚å€˜è‹¥æˆ‘ä»¬å¸Œæœ›**åŒä¸€ä¸ªä¸šåŠ¡çš„æ¶ˆæ¯ä¸€å®šå‘é€åˆ°åŒä¸€ä¸ªåˆ†åŒºä¸Šï¼Œä¿è¯ä¸šåŠ¡å†…æ¶ˆæ¯æœ‰åºæ€§**ï¼Œå¯ä»¥å¯¹`sarama.Config.Producer`ç»“æ„ä½“ä¸­çš„`Partitioner`å­—æ®µè¿›è¡Œé…ç½®ï¼Œå¦‚ä¸‹å›¾ï¼š\n\n![image-20241124201226717](https://raw.githubusercontent.com/lyydsheep/pic/main/202411242012815.png)\n\nå¸¸è§çš„ï¼š\n\n- Randomï¼šéšæœºä¸€ä¸ª\n- RoundRobinï¼šè½®è¯¢\n- Hashï¼šæ ¹æ®Messageä¸­çš„keyçš„å“ˆå¸Œå€¼æ¥ç­›é€‰ä¸€ä¸ª\n- Manualï¼šæ ¹æ®Messageä¸­çš„partitionå­—æ®µæ¥é€‰æ‹©\n- ConsistentCRCï¼šä¸€è‡´æ€§å“ˆå¸Œï¼Œç”¨çš„æ˜¯CRC16ç®—æ³•\n- Customï¼šè‡ªå®šä¹‰ä¸€éƒ¨åˆ†Hashå‚æ•°\n\n### å¼‚æ­¥å‘é€æ¶ˆæ¯\n\n```go\nfunc TestAsyncProducer(t *testing.T) {\n\tcfg := sarama.NewConfig()\n\tcfg.Producer.Return.Successes = true\n\tcfg.Producer.Return.Errors = true\n\tclient, err := sarama.NewClient([]string{\"localhost:9094\"}, cfg)\n\trequire.NoError(t, err)\n\tproducer, err := sarama.NewAsyncProducerFromClient(client)\n\trequire.NoError(t, err)\n\tmsgInput := producer.Input()\n\tmsgInput <- &sarama.ProducerMessage{\n\t\tTopic: \"test_topic\",\n\t\tValue: sarama.StringEncoder(\"message Hello\"),\n\t}\n\tsuCh, erCh := producer.Successes(), producer.Errors()\n\t// å®è·µä¸­ä¸€èˆ¬éƒ½æ˜¯å¼€ä¸€ä¸ªgoroutineæ¥å¤„ç†\n\tselect {\n\tcase msg := <-suCh:\n\t\tval, _ := msg.Value.Encode()\n\t\tfmt.Println(msg.Topic, string(val))\n\tcase err := <-erCh:\n\t\tfmt.Println(err.Error())\n\t}\n}\n```\n\n- éœ€è¦æŠŠ`Success`å’Œ`Errors`éƒ½è®¾ç½®ä¸º`true`ï¼Œè¿™æ˜¯ä¸ºäº†åé¢èƒ½å¼‚æ­¥è·å–åˆ°ç»“æœ\n- é€šè¿‡ä¸€ä¸ª**channel**å¼‚æ­¥å‘é€æ¶ˆæ¯\n- é€šè¿‡`select case`ï¼Œç›‘å¬å¼‚æ­¥å‘é€æ¶ˆæ¯çš„ç»“æœ\n\n### æŒ‡å®šacks\n\nç”Ÿäº§è€…åœ¨å‘é€æ•°æ®çš„æ—¶å€™ï¼Œæœ‰ä¸€ä¸ªå…³é”®å‚æ•°â€”â€”**acks**,è¯¥å‚æ•°æœ‰ä¸‰ä¸ªå–å€¼ï¼š\n\n![image-20241125193828822](https://raw.githubusercontent.com/lyydsheep/pic/main/202411251938899.png)\n\n- 0ï¼šå®¢æˆ·ç«¯å‘ä¸€æ¬¡ï¼Œä»…æ”¶åˆ°TCPçš„ACKæŠ¥æ–‡ï¼ˆæ²¡å®è´¨ä½œç”¨ï¼‰\n- 1ï¼šå®¢æˆ·ç«¯å‘é€ä¸€æ¬¡ï¼Œéœ€è¦**ç­‰å¾…æœåŠ¡ç«¯å°†æ¶ˆæ¯å†™å…¥ä¸»åˆ†åŒº**ï¼Œèƒ½ç¡®ä¿æ¶ˆæ¯æˆåŠŸé€è¾¾\n- -1ï¼šå®¢æˆ·ç«¯å‘é€ä¸€æ¬¡ï¼Œéœ€è¦**ç­‰å¾…æœåŠ¡ç«¯å°†æ¶ˆæ¯åŒæ­¥è‡³æ‰€æœ‰ï¼ˆå¯é…ç½®ï¼‰çš„ISRä¸Š**\n\n![image-20241125194219136](https://raw.githubusercontent.com/lyydsheep/pic/main/202411251942196.png)\n\nè‡ªä¸Šè€Œä¸‹ï¼Œæ€§èƒ½é€æ¸å˜å·®ï¼Œä½†æ˜¯æ•°æ®å¯é æ€§ä¸Šå‡\n\n### ISR\n\n**ISRï¼ˆIn Sync Replicasï¼‰ï¼Œå°±æ˜¯å’Œä¸»åˆ†åŒºä¿æŒæ•°æ®åŒæ­¥çš„ä»åˆ†åŒºé›†åˆ**\n\n![image-20241125194510901](https://raw.githubusercontent.com/lyydsheep/pic/main/202411251945935.png)\n\n### **å¯åŠ¨æ¶ˆè´¹è€…**\n\n```go\nfunc TestConsumer(t *testing.T) {\n\tcfg := sarama.NewConfig()\n\t// è®¾ç½®åˆå§‹æ¶ˆè´¹åç§»é‡ï¼Œå¦‚æœæ²¡æœ‰å·²æäº¤çš„offsetæ•°æ®ï¼Œåˆ™é»˜è®¤æ˜¯ä¸‹ä¸€ä¸ªæ¶ˆæ¯çš„ä½ç½®\n\t//cfg.Consumer.Offsets.Initial = sarama.OffsetOldest\n\tcg, err := sarama.NewConsumerGroup([]string{\"localhost:9094\"}, \"test_id\", cfg)\n\trequire.NoError(t, err)\n\t// å®šæ—¶ç»“æŸ\n\tctx, cancel := context.WithTimeout(context.Background(), time.Second*10)\n\tdefer cancel()\n\terr = cg.Consume(ctx, []string{\"test_topic\"}, &ConsumerHandler{})\n}\n\ntype ConsumerHandler struct {\n}\n\nfunc (c ConsumerHandler) Setup(session sarama.ConsumerGroupSession) error {\n\tfmt.Println(\"this is setup\")\n\t// é‡ç½®åç§»é‡\n\t//partitions := session.Claims()[\"test_topic\"]\n\t//for _, v := range partitions {\n\t//\tsession.ResetOffset(\"test_topic\", v, sarama.OffsetOldest, \"\")\n\t//}\n\treturn nil\n}\n\nfunc (c ConsumerHandler) Cleanup(session sarama.ConsumerGroupSession) error {\n\tfmt.Println(\"this is cleanup\")\n\treturn nil\n}\n\nfunc (c ConsumerHandler) ConsumeClaim(session sarama.ConsumerGroupSession, claim sarama.ConsumerGroupClaim) error {\n\t// å…³é”®å®ç°\n\tmsgCh := claim.Messages()\n\tfor msg := range msgCh {\n\t\tfmt.Println(string(msg.Value))\n\t\t// æ ‡è®°æ¶ˆè´¹æˆåŠŸï¼Œç”¨äºç§»åŠ¨offset\n\t\t// æœåŠ¡ç«¯åªä¼šæäº¤å¸¦æœ‰æ ‡è®°çš„æ¶ˆæ¯ï¼Œä»£è¡¨è¯¥æ¶ˆæ¯è¢«æˆåŠŸæ¶ˆè´¹\n\t\tsession.MarkMessage(msg, \"\")\n\t}\n\treturn nil\n}\n```\n\n- åˆå§‹åŒ–ä¸€ä¸ª**æ¶ˆè´¹è€…ç»„**\n- è°ƒç”¨æ¶ˆè´¹è€…ç»„çš„**Consume**æ–¹æ³•\n- ä¸º**Consume**æ–¹æ³•ä¼ å…¥ä¸€ä¸ª**ConsumerGroupHandleræ¥å£**\n  - å‘Consumeæ–¹æ³•ä¸­ä¼ å…¥ä¸€ä¸ªå¸¦æœ‰å®šæ—¶å™¨æˆ–Cancelçš„Contextï¼Œå¯ä»¥æ§åˆ¶æ¶ˆè´¹è€…é€€å‡º\n\nConsumerGroupHandleræ¥å£éœ€è¦å®ç°ä¸‰ä¸ªæ–¹æ³•ï¼š\n\n- Setup\n- Cleanup\n- ConsumeClaim\n\nå…¶ä¸­æ¶ˆè´¹ç»„å¯¹æ¶ˆæ¯è¿›è¡Œæ¶ˆè´¹çš„é€»è¾‘åœ¨ConsumClaimæ–¹æ³•ä¸­å®ç°ï¼š\n\n![image-20241126130732077](https://raw.githubusercontent.com/lyydsheep/pic/main/202411261307125.png)\n\nç”±äºConsumeæ–¹æ³•éœ€è¦çš„æ˜¯ä¸€ä¸ªæ¥å£ï¼Œé‚£ä¹ˆæˆ‘ä»¬å¯ä»¥åŸºäºç±»å‹å®šä¹‰ã€ç»“æ„ä½“ç­‰æ–¹å¼èŠ±å¼å®ç°ConsumeClaimæ–¹æ³•ï¼Œä»¥è¾¾åˆ°ä¸€äº›å·§å¦™çš„ä½œç”¨\n\n### è‡ªå®šåç§»é‡æ¶ˆè´¹\n\nsaramaä¸­æä¾›äº†ä¸¤ä¸ªè®¾ç½®åç§»é‡çš„æ–¹æ³•ï¼š\n\n- è®¾ç½®`cfg.Consumer.Offsets.Initial`å­—æ®µ\n\n  - ```go\n    cfg := sarama.NewConfig()\n    // è®¾ç½®åˆå§‹æ¶ˆè´¹åç§»é‡ï¼Œå¦‚æœæ²¡æœ‰å·²æäº¤çš„offsetæ•°æ®ï¼Œåˆ™é»˜è®¤æ˜¯ä¸‹ä¸€ä¸ªæ¶ˆæ¯çš„ä½ç½®\n    cfg.Consumer.Offsets.Initial = sarama.OffsetOldest\n    ```\n\n- è°ƒç”¨`session.ResetOffset()`æ–¹æ³•\n\n  - ```go\n    // é‡ç½®åç§»é‡\n    partitions := session.Claims()[\"test_topic\"]\n    for _, v := range partitions {\n    \tsession.ResetOffset(\"test_topic\", v, sarama.OffsetOldest, \"\")\n    }\n    ```\n\nResetOffsetæ–¹æ³•é€šå¸¸åœ¨Setupå‡½æ•°ä¸­è°ƒç”¨\n\nå€¼å¾—æ³¨æ„çš„æ˜¯ï¼Œåªæœ‰ä¸Šè¿°ä¸¤ä¸ªæ–¹å¼åŒæ—¶æ‰§è¡Œï¼Œæ¶ˆè´¹è€…ç»„æ‰ä¼šä»å†å²ç¬¬ä¸€æ¡æ¶ˆæ¯è¿›è¡Œæ¶ˆè´¹ã€‚æœ€å¥½çš„æ–¹å¼æ˜¯èµ°ç¦»çº¿æ¸ é“ï¼Œæ“ä½œkafkaé›†ç¾¤å»é‡ç½®å¯¹åº”çš„åç§»é‡ã€‚\n\n### å¼‚æ­¥æ¶ˆè´¹ï¼Œæ‰¹é‡æäº¤\n\n```go\nfunc (h *Handler[T]) ConsumeClaim(session sarama.ConsumerGroupSession, claim sarama.ConsumerGroupClaim) error {\n\tmsgCh := claim.Messages()\n\tfor {\n\t\tctx, cancel := context.WithTimeout(context.Background(), time.Second*2)\n\t\tdone := false\n\t\tmsgs := make([]*sarama.ConsumerMessage, 0, 10)\n\t\tevts := make([]T, 0, 10)\n\t\tfor i := 0; i < h.batch && !done; i++ {\n\t\t\tselect {\n\t\t\tcase msg, ok := <-msgCh:\n\t\t\t\tif !ok {\n\t\t\t\t\t// msgChè¢«å…³é—­\n\t\t\t\t\tcancel()\n\t\t\t\t\treturn nil\n\t\t\t\t}\n\t\t\t\tvar t T\n\t\t\t\terr := json.Unmarshal(msg.Value, &t)\n\t\t\t\tif err != nil {\n\t\t\t\t\th.l.Error(\"fail to unmarshal\")\n\t\t\t\t\tcontinue\n\t\t\t\t}\n\t\t\t\tmsgs = append(msgs, msg)\n\t\t\t\tevts = append(evts, t)\n\t\t\tcase <-ctx.Done():\n\t\t\t\tdone = true\n\t\t\t}\n\t\t}\n\t\tcancel()\n\t\terr := h.fn(msgs, evts)\n\t\tif err != nil {\n\t\t\treturn err\n\t\t}\n\t\tfor i := range msgs {\n\t\t\tsession.MarkMessage(msgs[i], \"\")\n\t\t}\n\t}\n}\n\n```\n\n**å¼‚æ­¥æ¶ˆè´¹ä¸€æ‰¹ï¼Œæäº¤ä¸€æ‰¹**ã€‚\n\nå…¶ä¸­æäº¤ä¸€æ‰¹åœ¨å®ç°è¿‡ç¨‹ä¸­åªéœ€è¦**å°†æœ€åä¸€ä¸ªæ¶ˆæ¯æ ‡è®°**å³å¯\n\nåœ¨`select case`ä¸­æœ‰ä¸¤ä¸ªåˆ†æ”¯ï¼Œä¸€ä¸ªåˆ†æ”¯æ˜¯ctx.Doneï¼Œå¯ä»¥é˜²æ­¢å› é•¿æ—¶é—´å‡‘ä¸é½ä¸€ä¸ªbatchçš„æ¶ˆæ¯ï¼Œè€Œå¯¼è‡´çš„é˜»å¡ç°è±¡ï¼›å¦ä¸€ä¸ªåˆ†æ”¯è°ƒç”¨`errgroup.Go()`æ–¹æ³•å¼‚æ­¥å¤„ç†kafkaä¸­çš„æ¶ˆæ¯\n\n## æ”¹é€ ç»Ÿè®¡é˜…è¯»è®¡æ•°\n\n**DDDä¸­çš„ä¸€ä¸ªé‡è¦æ¦‚å¿µï¼šé¢†åŸŸäº‹ä»¶**\n\nå½“æˆ‘ä»¬åœ¨å‘é€æ¶ˆæ¯æ—¶ï¼Œéœ€è¦å‘é€çš„æ˜¯ä¸€ä¸ª**äº‹ä»¶**ï¼Œå³æŸä¸ªç”¨æˆ·é˜…è¯»äº†æŸç¯‡æ–‡ç« çš„äº‹ä»¶ã€‚é¡¹ç›®ç»“æ„ï¼š\n\n![image-20241127185624318](https://raw.githubusercontent.com/lyydsheep/pic/main/202411271856428.png)\n\n### å°è£…æ‰¹é‡æ¶ˆè´¹\n\nå‰æ–‡æåŠ`cg.consumer()`æ–¹æ³•ç¬¬ä¸‰ä¸ªå‚æ•°æ˜¯ä¸€ä¸ª`ConsumeGroupHandler`æ¥å£å‚æ•°ï¼Œæˆ‘ä»¬å¯ä»¥å°è£…ä¸€ä¸ªHandlerç»“æ„ä½“å®ç°è¿™ä¸ªæ¥å£ï¼Œè¿™ä¸ªç»“æ„ä½“åˆå§‹åŒ–æ—¶æ¥å—ä¸šåŠ¡æ–¹çš„æ¶ˆè´¹å‡½æ•°ï¼Œå¹¶åœ¨`ConsumeClaim()`æ–¹æ³•ä¸­è°ƒç”¨ä¸‹æ¸¸çš„æ¶ˆè´¹å‡½æ•°å¯¹æ¶ˆæ¯è¿›è¡Œå¤„ç†ã€‚å…·ä½“ï¼ˆæ‰¹é‡æ¶ˆè´¹ï¼‰å°è£…ä¸‹ï¼š\n\n```go\ntype Handler[T any] struct {\n\tl     *zap.Logger\n\tfn    func(msgs []*sarama.ConsumerMessage, evts []T) error\n\tbatch int\n}\n\nfunc (h *Handler[T]) ConsumeClaim(session sarama.ConsumerGroupSession, claim sarama.ConsumerGroupClaim) error {\n\tmsgCh := claim.Messages()\n\tfor {\n\t\tctx, cancel := context.WithTimeout(context.Background(), time.Second)\n\t\tmsgs := make([]*sarama.ConsumerMessage, 0, h.batch)\n\t\tevts := make([]T, 0, h.batch)\n\t\tdone := false\n\t\tfor i := 0; i < h.batch && !done; i++ {\n\t\t\tselect {\n\t\t\tcase msg, ok := <-msgCh:\n\t\t\t\tif !ok {\n\t\t\t\t\t// channelå…³é—­\n\t\t\t\t\tcancel()\n\t\t\t\t\treturn nil\n\t\t\t\t}\n\t\t\t\tvar t T\n\t\t\t\terr := json.Unmarshal(msg.Value, &t)\n\t\t\t\tif err != nil {\n\t\t\t\t\t// è®°å½•æ—¥å¿—\n\t\t\t\t\tcontinue\n\t\t\t\t}\n\t\t\t\tmsgs = append(msgs, msg)\n\t\t\t\tevts = append(evts, t)\n\t\t\tcase <-ctx.Done():\n\t\t\t\t// è¶…æ—¶\n\t\t\t\tdone = true\n\t\t\t}\n\t\t}\n\t\tcancel()\n\t\terr := h.fn(msgs, evts)\n\t\tif err != nil {\n\t\t\t// è®°å½•æ—¥å¿—\n\t\t\t// è®°å½•æ•´ä¸ªæ‰¹æ¬¡\n\t\t\t// ç»§ç»­æ¶ˆè´¹\n\t\t}\n\t\t// æ ‡è®°æ¶ˆæ¯\n\t\tfor i := range msgs {\n\t\t\tsession.MarkMessage(msgs[i], \"\")\n\t\t}\n\t}\n}\n```\n\nä¸Šè¿°ä»£ç å®ç°äº†å¯¹æ¶ˆè´¹è€…æ‰¹é‡æ¶ˆè´¹çš„å°è£…ï¼Œå¯ä»¥æé«˜ç³»ç»Ÿå¤„ç†æ¶ˆæ¯çš„æ€§èƒ½ã€‚è¿™æ˜¯å› ä¸ºæ‰¹é‡å¤„ç†å¯ä»¥å°†DAOå±‚é¢10æ¬¡ï¼ˆå‡å®šbatchä¸º10ï¼‰äº‹åŠ¡å¤„ç†ç¼©å‡è‡³åœ¨ä¸€æ¬¡äº‹åŠ¡ä¸­å¤„ç†åæ¬¡æ“ä½œã€‚ä¸¤ä¸ªæ³¨æ„ç‚¹ï¼š\n\n- æ³¨æ„è¶…æ—¶\n- è°ƒç”¨ä¸‹æ¸¸\n\n### ç»„è£…æ¶ˆè´¹è€…\n\nåœ¨ä¾èµ–æ³¨å…¥çš„è¿‡ç¨‹ä¸­ï¼Œæ¶ˆè´¹è€…ç±»ä¼¼äºWebã€GRpcæœåŠ¡å™¨çš„ä¸œè¥¿ï¼Œéœ€è¦å¯åŠ¨ã€‚å› æ­¤å¼•å…¥ä¸€ä¸ªAppç»“æ„ä½“ï¼Œå¯¹Webå’Œæ¶ˆè´¹è€…è¿›è¡Œç»„åˆ\n\n```go\n// app.go\ntype App struct {\n    Web *gin.Engine\n    Consumers []events.Consumer\n}\n\n// ioc/kafka.go\n// ç”±äºGoæ²¡æœ‰åŠ¨æ€ç±»å‹ï¼Œå› æ­¤æ¯ä¸€ä¸ªæ¶ˆè´¹è€…éƒ½éœ€è¦è¿›è¡Œæ³¨å†Œæ“ä½œ\nfunc NewConsumers(c1 *articles.InteractiveReadEventConsumer) []events.Consumer {\n    return []events.Consumer{c1}\n}\n\n// wire.go\n// ç»„åˆç»“æ„ä½“æ‰€æœ‰çš„å­—æ®µï¼Œ*è¡¨ç¤ºæ‰€æœ‰\nwire.Struct(new(App), \"*\")\n```\n\n### æ‰¹é‡ç”Ÿäº§\n\nsvcé€šè¿‡channelå°†æ¶ˆæ¯å‘é€ç»™ç”Ÿäº§è€…ï¼Œå½“ç”Ÿäº§è€…ç§¯ç´¯è¶³å¤Ÿå¤šçš„æ¶ˆæ¯åï¼Œå°±å°†è¿™ä¸€æ‰¹æ¶ˆæ¯å‘é€ç»™Kafka\n\n```go\nfunc NewBasicInteractService(repo repository.InteractRepository, producer events.Producer) *BasicInteractService {\n\tch := make(chan events.ReadEvent, 10)\n    // å‡‘è¶³ä¸€æ‰¹æ¶ˆæ¯\n\tgo func() {\n\t\tfor {\n\t\t\tctx, cancel := context.WithTimeout(context.Background(), time.Second)\n\t\t\tevts := make([]events.ReadEvent, 0, 10)\n\t\t\tdone := false\n\t\t\tfor i := 0; i < 10 && !done; i++ {\n\t\t\t\tselect {\n\t\t\t\tcase evt, ok := <-ch:\n\t\t\t\t\tif !ok {\n\t\t\t\t\t\tcancel()\n\t\t\t\t\t\tbreak\n\t\t\t\t\t}\n\t\t\t\t\tevts = append(evts, evt)\n\t\t\t\tcase <-ctx.Done():\n\t\t\t\t\tdone = true\n\t\t\t\t}\n\t\t\t}\n\t\t\tcancel()\n\t\t\terr := producer.ProduceReadEventV1(ctx, evts)\n\t\t\tif err != nil {\n\t\t\t\t// æ—¥å¿—\n\t\t\t}\n\t\t}\n\t}()\n\treturn &BasicInteractService{repo: repo, producer: producer, ch: ch}\n}\n\n\n// ç§¯ç´¯æ¶ˆæ¯\nfunc (svc *BasicInteractService) IncReadCnt(ctx context.Context, biz string, bizId, uid int64) error {\n\t_, err := svc.Get(ctx, biz, bizId, uid)\n\tgo func() {\n\t\tif err == nil {\n\t\t\tsvc.ch <- events.ReadEvent{\n\t\t\t\tUid: uid,\n\t\t\t\tAid: bizId,\n\t\t\t}\n\t\t}\n\t}()\n\treturn err\n}\n```\n\n","slug":"Kafkaå®è·µ","published":1,"date":"2024-12-27T11:03:15.342Z","updated":"2025-01-04T06:32:05.125Z","title":"","comments":1,"layout":"post","photos":[],"_id":"cm6c7md6f0002a5t2dxvx1v5t","content":"<h1 id=\"æ¶ˆæ¯é˜Ÿåˆ—\"><a href=\"#æ¶ˆæ¯é˜Ÿåˆ—\" class=\"headerlink\" title=\"æ¶ˆæ¯é˜Ÿåˆ—\"></a>æ¶ˆæ¯é˜Ÿåˆ—</h1><p>æ¶ˆæ¯é˜Ÿåˆ—çš„åŸºæœ¬å½¢æ€ï¼Œå°±æ˜¯æœ‰<strong>Nä¸ªç”Ÿäº§è€…ï¼ŒNä¸ªæ¶ˆè´¹è€…</strong></p>\n<p>ç”Ÿäº§è€…å’Œæ¶ˆè´¹è€…è§£è€¦äº†</p>\n<h2 id=\"åº”ç”¨åœºæ™¯\"><a href=\"#åº”ç”¨åœºæ™¯\" class=\"headerlink\" title=\"åº”ç”¨åœºæ™¯\"></a>åº”ç”¨åœºæ™¯</h2><h3 id=\"æ¶ˆæ¯é˜Ÿåˆ—è§£è€¦\"><a href=\"#æ¶ˆæ¯é˜Ÿåˆ—è§£è€¦\" class=\"headerlink\" title=\"æ¶ˆæ¯é˜Ÿåˆ—è§£è€¦\"></a>æ¶ˆæ¯é˜Ÿåˆ—è§£è€¦</h3><p>ä¸€ä¸ªæ¨¡å—Aæ¥æ”¶åˆ°è¯·æ±‚åéœ€è¦è°ƒç”¨æ¨¡å—Bï¼Œæ¥ç€ç­‰å¾…æ¨¡å—Bå®Œæˆåç»­å·¥ä½œï¼Œæ‰è¿›è¡Œå›åŒ…ã€‚è¿™ç§æƒ…å†µä¸‹æ¨¡å—Aæåº¦ä¾èµ–äºæ¨¡å—Bçš„è¿è¡ŒçŠ¶å†µï¼Œè€¦åˆåº¦è¾ƒé«˜ã€‚å¦‚æœä¸šåŠ¡å…è®¸çš„è¯ï¼Œæ¨¡å—Aå®Œå…¨å¯ä»¥å°†è°ƒç”¨æ¨¡å—Bçš„è¯·æ±‚ä¿¡æ¯ä¸¢è¿›<strong>æ¶ˆæ¯ä¸­è½¬ç«™</strong>ä¸­ï¼Œæ¨¡å—Bä¸€æ—¦å‘ç°ä¸­è½¬ç«™ä¸­æœ‰æ¶ˆæ¯å°±è¿›è¡Œå·¥ä½œã€‚è¿™ä¸ªä¸­è½¬ç«™å°±æ˜¯æ¶ˆæ¯é˜Ÿåˆ—ï¼Œèµ·ç€è§£è€¦åˆä½œç”¨<br>è§£è€¦çš„æœ¬è´¨å°±æ˜¯<strong>Aä¸ç”¨å…³å¿ƒBçš„äº‹æƒ…ï¼Œä»¥åŠä¸å—Bæ‰§è¡Œç»“æœçš„å½±å“</strong></p>\n<h3 id=\"æ¶ˆæ¯é˜Ÿåˆ—å‰Šå³°\"><a href=\"#æ¶ˆæ¯é˜Ÿåˆ—å‰Šå³°\" class=\"headerlink\" title=\"æ¶ˆæ¯é˜Ÿåˆ—å‰Šå³°\"></a>æ¶ˆæ¯é˜Ÿåˆ—å‰Šå³°</h3><p>åœ¨è¯·æ±‚å¤„ç†é“¾ä¸­ï¼Œå„æ¨¡å—çš„å¤„ç†èƒ½åŠ›é€šå¸¸å­˜åœ¨è¾ƒå¤§å·®å¼‚ã€‚æ ¹æ®æœ¨æ¡¶åŸç†ï¼Œç³»ç»Ÿçš„ QPSï¼ˆæ¯ç§’æŸ¥è¯¢é‡ï¼‰å¾€å¾€å—æœ€å¼±å¤„ç†æ¨¡å—çš„é™åˆ¶ï¼Œè¿™å¯¼è‡´ä¸Šæ¸¸æ¨¡å—çš„å‰©ä½™å¤„ç†èƒ½åŠ›æ— æ³•å……åˆ†åˆ©ç”¨ï¼Œè¿›è€Œé€ æˆæ€§èƒ½ä¸èµ„æºçš„æµªè´¹ã€‚ä¸ºæå‡ç³»ç»Ÿæ•´ä½“çš„ QPSï¼Œå¹¶æœ€å¤§é™åº¦å‘æŒ¥ä¸Šæ¸¸æ¨¡å—çš„é«˜å“åº”æ€§èƒ½ï¼Œ<strong>ä¸Šæ¸¸å¯ä»¥å°†å¤„ç†å®Œæˆçš„æ¶ˆæ¯æš‚å­˜è‡³æ¶ˆæ¯é˜Ÿåˆ—</strong>ã€‚ä¸‹æ¸¸æ¨¡å—åˆ™ä»æ¶ˆæ¯é˜Ÿåˆ—ä¸­é€æ­¥è·å–æ¶ˆæ¯è¿›è¡Œå¤„ç†ï¼Œé€šè¿‡å»¶è¿Ÿå¤„ç†çš„æ–¹å¼ï¼Œå®ç°<strong>å‰Šå³°å¡«è°·</strong>çš„æ•ˆæœï¼Œæœ‰æ•ˆç¼“è§£è´Ÿè½½ä¸å‡é—®é¢˜ã€‚<br>å®é™…åœºæ™¯ï¼š1ã€ç§’æ€åœºæ™¯ 2ã€å‡Œæ™¨å½•å…¥æ•°æ®</p>\n<figure class=\"highlight sh\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">cnt=1</span><br><span class=\"line\"><span class=\"keyword\">while</span> [ <span class=\"variable\">$cnt</span> -le 10 ]</span><br><span class=\"line\"><span class=\"keyword\">do</span></span><br><span class=\"line\">\tcurl -w <span class=\"string\">&quot;\\n cost %&#123;time_total&#125;s&quot;</span> -H <span class=\"string\">&quot;Trace-ID:lyydsheep1&quot;</span> -H <span class=\"string\">&quot;Content-Type: application/json; charset=utf-8&quot;</span> -H <span class=\"string\">&quot;User-ID: 7&quot;</span> http://localhost:8080/demo/peak_clipping -d <span class=\"string\">&#x27;&#123;&quot;num&quot;:1&#125;&#x27;</span></span><br><span class=\"line\">\tcnt=$((cnt + <span class=\"number\">1</span>))</span><br><span class=\"line\"><span class=\"keyword\">done</span></span><br></pre></td></tr></table></figure>\n\n<h3 id=\"æ¶ˆæ¯é˜Ÿåˆ—åˆ†å‘\"><a href=\"#æ¶ˆæ¯é˜Ÿåˆ—åˆ†å‘\" class=\"headerlink\" title=\"æ¶ˆæ¯é˜Ÿåˆ—åˆ†å‘\"></a>æ¶ˆæ¯é˜Ÿåˆ—åˆ†å‘</h3><p>ä¸€ä¸ªæ¨¡å—Aéœ€è¦å°†æ¶ˆæ¯åˆ†å‘è‡³æ¨¡å—Bã€Cã€D<br>å®é™…åœºæ™¯ï¼š1ã€æ•°æ®æ›´æ–° 2ã€æ•°æ®åˆ†æ&#x2F;æ ¡éªŒ<br>åœ¨å¼•å…¥æ¶ˆæ¯é˜Ÿåˆ—ä¹‹å‰ï¼Œç”Ÿäº§è€…éœ€è¦äº†è§£æœ‰å¤šå°‘ä¸ªæ¶ˆè´¹è€…ï¼Œä»¥åŠæ¶ˆè´¹è€…å¯¹äºæ¶ˆæ¯çš„æ ¼å¼åŒ–è¦æ±‚ã€‚åœ¨å¼•å…¥æ¶ˆæ¯é˜Ÿåˆ—åï¼Œç”Ÿäº§è€…åªéœ€è¦å’Œæ¶ˆæ¯é˜Ÿåˆ—æ‰“äº¤é“ï¼Œä¸å¿…å…³å¿ƒæ¶ˆè´¹è€…ï¼Œä¹Ÿå¯ä»¥è¯´æ˜¯å®ç°äº†æ¶ˆæ¯ç¾¤å‘åœºæ™¯ä¸‹çš„è§£è€¦</p>\n<h2 id=\"åŸºæœ¬æ¦‚å¿µ\"><a href=\"#åŸºæœ¬æ¦‚å¿µ\" class=\"headerlink\" title=\"åŸºæœ¬æ¦‚å¿µ\"></a>åŸºæœ¬æ¦‚å¿µ</h2><ul>\n<li>ç”Ÿäº§è€… producer</li>\n<li>æ¶ˆè´¹è€… consumer</li>\n<li>æ¶ˆæ¯æœåŠ¡å™¨ broker</li>\n<li>topicä¸partition</li>\n<li>æ¶ˆè´¹è€…ç»„ä¸æ¶ˆè´¹è€…</li>\n</ul>\n<p><img src=\"https://raw.githubusercontent.com/lyydsheep/pic/main/202411211437013.png\" alt=\"image-20241121143736964\"></p>\n<p>brokerï¼ˆä¸­é—´äººï¼‰ï¼Œæ˜¯ä¸€ä¸ªé€»è¾‘ä¸Šçš„æ¦‚å¿µã€‚åœ¨å®è·µä¸­ï¼Œå¯ä»¥æ˜ å°„ä¸ºä¸€ä¸ªæ¶ˆæ¯é˜Ÿåˆ—è¿›ç¨‹æˆ–ä¸€å°æœºå™¨</p>\n<p><strong>topicæ˜¯æ¶ˆæ¯é˜Ÿåˆ—ä¸Šä»£è¡¨ä¸åŒä¸šåŠ¡çš„ä¸œè¥¿</strong>ï¼Œç®€å•æ¥è¯´ï¼Œä¸€ä¸ªä¸šåŠ¡å°±æ˜¯ä¸€ä¸ªtopicï¼Œè€Œ<strong>ä¸€ä¸ªtopicå¯ä»¥æœ‰å¤šä¸ªåˆ†åŒº</strong></p>\n<p><img src=\"https://raw.githubusercontent.com/lyydsheep/pic/main/202411211440344.png\" alt=\"image-20241121144040306\"></p>\n<p><strong>å½“å‘é€æ¶ˆæ¯åˆ°Kafkaä¸Šçš„æ—¶å€™ï¼ŒKafkaä¼šå…ˆæŠŠæ¶ˆæ¯å†™å…¥ä¸»åˆ†åŒºï¼Œå†åŒæ­¥åˆ°ä»åˆ†åŒº</strong>ã€‚è¿™æ˜¯ä¸ºäº†ä¿è¯é«˜å¯ç”¨å’Œæ•°æ®ä¸ä¸¢å¤±</p>\n<p>ä½†é€šå¸¸è¯´topicæœ‰å¤šå°‘ä¸ªåˆ†åŒºï¼Œæ˜¯æŒ‡æœ‰å¤šå°‘ä¸ªä¸»åˆ†åŒº</p>\n<p><img src=\"https://raw.githubusercontent.com/lyydsheep/pic/main/202411211443600.png\" alt=\"image-20241121144329550\"></p>\n<p>æ­£å¸¸æƒ…å†µä¸‹ï¼ŒåŒä¸€ä¸ªtopicçš„åˆ†åŒºä¼šå°½é‡å‡åŒ€åˆ†æ•£åˆ°æ‰€æœ‰çš„brokerä¸Šã€‚ä¸ºäº†ä¿è¯å½“æŸä¸ªbrokerå¥”æºƒåï¼Œä¸ä¼šé€ æˆå¾ˆå¤§çš„å½±å“ï¼Œéœ€è¦æ»¡è¶³ä¸‹é¢ä¸¤ä¸ªæ¡ä»¶ï¼š</p>\n<ul>\n<li><strong>æ‰€æœ‰ä¸»åˆ†åŒºä¸åœ¨åŒä¸€ä¸ªbrokerä¸Š</strong></li>\n<li><strong>åŒä¸€ä¸ªtopicçš„åˆ†åŒºä¸éƒ½åœ¨ä¸€ä¸ªbrokerä¸Š</strong></li>\n</ul>\n<p>å¦‚ä¸Šæ–‡æ‰€è¿°ï¼Œä¸€ä¸ªtopicéƒ½ä¼šæœ‰å¤šä¸ªåˆ†åŒºï¼Œ<strong>æ‰€ä»¥å‘é€è€…åœ¨å‘é€æ¶ˆæ¯çš„æ—¶å€™ï¼Œå°±éœ€è¦é€‰æ‹©ä¸€ä¸ªç›®æ ‡ï¼ˆä¸»ï¼‰åˆ†åŒº</strong></p>\n<p>æ¯”è¾ƒå¸¸ç”¨çš„ç­–ç•¥ï¼š</p>\n<ul>\n<li>è½®è¯¢</li>\n<li>å“ˆå¸Œ</li>\n<li>éšæœº</li>\n</ul>\n<p><img src=\"https://raw.githubusercontent.com/lyydsheep/pic/main/202411211503889.png\" alt=\"image-20241121150303848\"></p>\n<p>Kafkaæ¶ˆæ¯éš”ç¦»å•ä½æ˜¯<strong>åŒº</strong>ï¼Œ<strong>åªæœ‰ä¸€ä¸ªåˆ†åŒºå†…çš„æ¶ˆæ¯æ‰èƒ½ä¿è¯æ˜¯æœ‰åºçš„</strong></p>\n<p><strong>ä¸€ä¸ªæ¶ˆè´¹è€…ç»„å¯ä»¥çœ‹ä½œæ˜¯å…³å¿ƒè¿™ä¸ªtopicçš„ä¸šåŠ¡æ–¹</strong>ï¼Œå¯¹äºä¸€ä¸ªåˆ†åŒºï¼ŒåŒä¸€ä¸ªæ¶ˆè´¹è€…ç»„åªèƒ½æœ‰ä¸€ä¸ªæ¶ˆè´¹è€…å‡ºæ¥æ¶ˆè´¹</p>\n<ul>\n<li>ä¸€ä¸ªæ¶ˆè´¹è€…å¯ä»¥æ¶ˆè´¹å¤šä¸ªåˆ†åŒºçš„æ•°æ®</li>\n<li>ä¸€ä¸ªåˆ†åŒºåœ¨åŒä¸€æ—¶åˆ»ï¼Œåªèƒ½è¢«ä¸€ä¸ªæ¶ˆè´¹è€…æ¶ˆè´¹</li>\n</ul>\n<p><img src=\"https://raw.githubusercontent.com/lyydsheep/pic/main/202411211511775.png\" alt=\"image-20241121151119740\"></p>\n<p><strong>æ¶ˆæ¯ç§¯å‹é—®é¢˜</strong></p>\n<ul>\n<li><strong>å¦‚æœä¸€ä¸ªtopicæœ‰Nä¸ªåˆ†ç»„ï¼Œé‚£ä¹ˆåŒä¸€ä¸ªæ¶ˆè´¹è€…ç»„æœ€å¤šæœ‰Nä¸ªæ¶ˆè´¹è€…ï¼Œå¤šä½™çš„æ¶ˆè´¹è€…ä¼šè¢«å¿½ç•¥</strong></li>\n<li><strong>å¦‚æœæ¶ˆè´¹è€…æ€§èƒ½ä½ï¼Œé‚£ä¹ˆä¸èƒ½é€šè¿‡æ— é™å¢åŠ æ¶ˆè´¹è€…æ•°é‡çš„æ–¹å¼æé«˜æ¶ˆè´¹é€Ÿç‡</strong></li>\n</ul>\n<h2 id=\"å‘½ä»¤è¡Œå·¥å…·\"><a href=\"#å‘½ä»¤è¡Œå·¥å…·\" class=\"headerlink\" title=\"å‘½ä»¤è¡Œå·¥å…·\"></a>å‘½ä»¤è¡Œå·¥å…·</h2><p>saramaæä¾›äº†è®¸å¤šå‘½ä»¤è¡Œå·¥å…·ï¼Œå…¶ä¸­consumerå’Œproducerç”¨å¾—æ¯”è¾ƒå¤š</p>\n<figure class=\"highlight go\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">go</span> install github.com/IBM/sarama/tools/kafka-console-consumer</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"keyword\">go</span> install github.com/IBM/sarama/tools/kafka-console-producer</span><br></pre></td></tr></table></figure>\n\n<p>è¿™äº›å…·ä½“å·¥å…·çš„ä½¿ç”¨æ–¹æ³•å¯ä»¥å‚è€ƒsaramaä¸­çš„<code>ReadMe</code>æ–‡æ¡£</p>\n<h2 id=\"Saramaä½¿ç”¨\"><a href=\"#Saramaä½¿ç”¨\" class=\"headerlink\" title=\"Saramaä½¿ç”¨\"></a>Saramaä½¿ç”¨</h2><h3 id=\"åŒæ­¥å‘é€æ¶ˆæ¯\"><a href=\"#åŒæ­¥å‘é€æ¶ˆæ¯\" class=\"headerlink\" title=\"åŒæ­¥å‘é€æ¶ˆæ¯\"></a>åŒæ­¥å‘é€æ¶ˆæ¯</h3><figure class=\"highlight go\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"function\"><span class=\"keyword\">func</span> <span class=\"title\">TestSyncProducer</span><span class=\"params\">(t *testing.T)</span></span> &#123;</span><br><span class=\"line\">\tcfg := sarama.NewConfig()</span><br><span class=\"line\">\t<span class=\"comment\">// åŒæ­¥ç”Ÿäº§è€…å¿…é¡»è®¾ç½®</span></span><br><span class=\"line\">\tcfg.Producer.Return.Successes = <span class=\"literal\">true</span></span><br><span class=\"line\">\tclient, err := sarama.NewClient([]<span class=\"type\">string</span>&#123;<span class=\"string\">&quot;localhost:9094&quot;</span>&#125;, cfg)</span><br><span class=\"line\">\trequire.NoError(t, err)</span><br><span class=\"line\">\tproducer, err := sarama.NewSyncProducerFromClient(client)</span><br><span class=\"line\">\trequire.NoError(t, err)</span><br><span class=\"line\">\terr = producer.SendMessages([]*sarama.ProducerMessage&#123;</span><br><span class=\"line\">\t\t&#123;</span><br><span class=\"line\">\t\t\tTopic: <span class=\"string\">&quot;test_topic&quot;</span>,</span><br><span class=\"line\">\t\t\tValue: sarama.StringEncoder(<span class=\"string\">&quot;message A&quot;</span>),</span><br><span class=\"line\">\t\t&#125;,</span><br><span class=\"line\">\t\t&#123;</span><br><span class=\"line\">\t\t\tTopic: <span class=\"string\">&quot;test_topic&quot;</span>,</span><br><span class=\"line\">\t\t\tValue: sarama.StringEncoder(<span class=\"string\">&quot;message B&quot;</span>),</span><br><span class=\"line\">\t\t&#125;,</span><br><span class=\"line\">\t&#125;)</span><br><span class=\"line\">\trequire.NoError(t, err)</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"></span><br></pre></td></tr></table></figure>\n\n<h3 id=\"æŒ‡å®šåˆ†åŒº\"><a href=\"#æŒ‡å®šåˆ†åŒº\" class=\"headerlink\" title=\"æŒ‡å®šåˆ†åŒº\"></a>æŒ‡å®šåˆ†åŒº</h3><p>ç”±ä¸Šæ–‡å¯çŸ¥ï¼ŒKafkaåªèƒ½ä¿è¯ä¸€ä¸ªåˆ†åŒºå†…çš„æ¶ˆæ¯æ˜¯æœ‰åºçš„ã€‚å€˜è‹¥æˆ‘ä»¬å¸Œæœ›<strong>åŒä¸€ä¸ªä¸šåŠ¡çš„æ¶ˆæ¯ä¸€å®šå‘é€åˆ°åŒä¸€ä¸ªåˆ†åŒºä¸Šï¼Œä¿è¯ä¸šåŠ¡å†…æ¶ˆæ¯æœ‰åºæ€§</strong>ï¼Œå¯ä»¥å¯¹<code>sarama.Config.Producer</code>ç»“æ„ä½“ä¸­çš„<code>Partitioner</code>å­—æ®µè¿›è¡Œé…ç½®ï¼Œå¦‚ä¸‹å›¾ï¼š</p>\n<p><img src=\"https://raw.githubusercontent.com/lyydsheep/pic/main/202411242012815.png\" alt=\"image-20241124201226717\"></p>\n<p>å¸¸è§çš„ï¼š</p>\n<ul>\n<li>Randomï¼šéšæœºä¸€ä¸ª</li>\n<li>RoundRobinï¼šè½®è¯¢</li>\n<li>Hashï¼šæ ¹æ®Messageä¸­çš„keyçš„å“ˆå¸Œå€¼æ¥ç­›é€‰ä¸€ä¸ª</li>\n<li>Manualï¼šæ ¹æ®Messageä¸­çš„partitionå­—æ®µæ¥é€‰æ‹©</li>\n<li>ConsistentCRCï¼šä¸€è‡´æ€§å“ˆå¸Œï¼Œç”¨çš„æ˜¯CRC16ç®—æ³•</li>\n<li>Customï¼šè‡ªå®šä¹‰ä¸€éƒ¨åˆ†Hashå‚æ•°</li>\n</ul>\n<h3 id=\"å¼‚æ­¥å‘é€æ¶ˆæ¯\"><a href=\"#å¼‚æ­¥å‘é€æ¶ˆæ¯\" class=\"headerlink\" title=\"å¼‚æ­¥å‘é€æ¶ˆæ¯\"></a>å¼‚æ­¥å‘é€æ¶ˆæ¯</h3><figure class=\"highlight go\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"function\"><span class=\"keyword\">func</span> <span class=\"title\">TestAsyncProducer</span><span class=\"params\">(t *testing.T)</span></span> &#123;</span><br><span class=\"line\">\tcfg := sarama.NewConfig()</span><br><span class=\"line\">\tcfg.Producer.Return.Successes = <span class=\"literal\">true</span></span><br><span class=\"line\">\tcfg.Producer.Return.Errors = <span class=\"literal\">true</span></span><br><span class=\"line\">\tclient, err := sarama.NewClient([]<span class=\"type\">string</span>&#123;<span class=\"string\">&quot;localhost:9094&quot;</span>&#125;, cfg)</span><br><span class=\"line\">\trequire.NoError(t, err)</span><br><span class=\"line\">\tproducer, err := sarama.NewAsyncProducerFromClient(client)</span><br><span class=\"line\">\trequire.NoError(t, err)</span><br><span class=\"line\">\tmsgInput := producer.Input()</span><br><span class=\"line\">\tmsgInput &lt;- &amp;sarama.ProducerMessage&#123;</span><br><span class=\"line\">\t\tTopic: <span class=\"string\">&quot;test_topic&quot;</span>,</span><br><span class=\"line\">\t\tValue: sarama.StringEncoder(<span class=\"string\">&quot;message Hello&quot;</span>),</span><br><span class=\"line\">\t&#125;</span><br><span class=\"line\">\tsuCh, erCh := producer.Successes(), producer.Errors()</span><br><span class=\"line\">\t<span class=\"comment\">// å®è·µä¸­ä¸€èˆ¬éƒ½æ˜¯å¼€ä¸€ä¸ªgoroutineæ¥å¤„ç†</span></span><br><span class=\"line\">\t<span class=\"keyword\">select</span> &#123;</span><br><span class=\"line\">\t<span class=\"keyword\">case</span> msg := &lt;-suCh:</span><br><span class=\"line\">\t\tval, _ := msg.Value.Encode()</span><br><span class=\"line\">\t\tfmt.Println(msg.Topic, <span class=\"type\">string</span>(val))</span><br><span class=\"line\">\t<span class=\"keyword\">case</span> err := &lt;-erCh:</span><br><span class=\"line\">\t\tfmt.Println(err.Error())</span><br><span class=\"line\">\t&#125;</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n\n<ul>\n<li>éœ€è¦æŠŠ<code>Success</code>å’Œ<code>Errors</code>éƒ½è®¾ç½®ä¸º<code>true</code>ï¼Œè¿™æ˜¯ä¸ºäº†åé¢èƒ½å¼‚æ­¥è·å–åˆ°ç»“æœ</li>\n<li>é€šè¿‡ä¸€ä¸ª<strong>channel</strong>å¼‚æ­¥å‘é€æ¶ˆæ¯</li>\n<li>é€šè¿‡<code>select case</code>ï¼Œç›‘å¬å¼‚æ­¥å‘é€æ¶ˆæ¯çš„ç»“æœ</li>\n</ul>\n<h3 id=\"æŒ‡å®šacks\"><a href=\"#æŒ‡å®šacks\" class=\"headerlink\" title=\"æŒ‡å®šacks\"></a>æŒ‡å®šacks</h3><p>ç”Ÿäº§è€…åœ¨å‘é€æ•°æ®çš„æ—¶å€™ï¼Œæœ‰ä¸€ä¸ªå…³é”®å‚æ•°â€”â€”<strong>acks</strong>,è¯¥å‚æ•°æœ‰ä¸‰ä¸ªå–å€¼ï¼š</p>\n<p><img src=\"https://raw.githubusercontent.com/lyydsheep/pic/main/202411251938899.png\" alt=\"image-20241125193828822\"></p>\n<ul>\n<li>0ï¼šå®¢æˆ·ç«¯å‘ä¸€æ¬¡ï¼Œä»…æ”¶åˆ°TCPçš„ACKæŠ¥æ–‡ï¼ˆæ²¡å®è´¨ä½œç”¨ï¼‰</li>\n<li>1ï¼šå®¢æˆ·ç«¯å‘é€ä¸€æ¬¡ï¼Œéœ€è¦<strong>ç­‰å¾…æœåŠ¡ç«¯å°†æ¶ˆæ¯å†™å…¥ä¸»åˆ†åŒº</strong>ï¼Œèƒ½ç¡®ä¿æ¶ˆæ¯æˆåŠŸé€è¾¾</li>\n<li>-1ï¼šå®¢æˆ·ç«¯å‘é€ä¸€æ¬¡ï¼Œéœ€è¦<strong>ç­‰å¾…æœåŠ¡ç«¯å°†æ¶ˆæ¯åŒæ­¥è‡³æ‰€æœ‰ï¼ˆå¯é…ç½®ï¼‰çš„ISRä¸Š</strong></li>\n</ul>\n<p><img src=\"https://raw.githubusercontent.com/lyydsheep/pic/main/202411251942196.png\" alt=\"image-20241125194219136\"></p>\n<p>è‡ªä¸Šè€Œä¸‹ï¼Œæ€§èƒ½é€æ¸å˜å·®ï¼Œä½†æ˜¯æ•°æ®å¯é æ€§ä¸Šå‡</p>\n<h3 id=\"ISR\"><a href=\"#ISR\" class=\"headerlink\" title=\"ISR\"></a>ISR</h3><p><strong>ISRï¼ˆIn Sync Replicasï¼‰ï¼Œå°±æ˜¯å’Œä¸»åˆ†åŒºä¿æŒæ•°æ®åŒæ­¥çš„ä»åˆ†åŒºé›†åˆ</strong></p>\n<p><img src=\"https://raw.githubusercontent.com/lyydsheep/pic/main/202411251945935.png\" alt=\"image-20241125194510901\"></p>\n<h3 id=\"å¯åŠ¨æ¶ˆè´¹è€…\"><a href=\"#å¯åŠ¨æ¶ˆè´¹è€…\" class=\"headerlink\" title=\"å¯åŠ¨æ¶ˆè´¹è€…\"></a><strong>å¯åŠ¨æ¶ˆè´¹è€…</strong></h3><figure class=\"highlight go\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br><span class=\"line\">31</span><br><span class=\"line\">32</span><br><span class=\"line\">33</span><br><span class=\"line\">34</span><br><span class=\"line\">35</span><br><span class=\"line\">36</span><br><span class=\"line\">37</span><br><span class=\"line\">38</span><br><span class=\"line\">39</span><br><span class=\"line\">40</span><br><span class=\"line\">41</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"function\"><span class=\"keyword\">func</span> <span class=\"title\">TestConsumer</span><span class=\"params\">(t *testing.T)</span></span> &#123;</span><br><span class=\"line\">\tcfg := sarama.NewConfig()</span><br><span class=\"line\">\t<span class=\"comment\">// è®¾ç½®åˆå§‹æ¶ˆè´¹åç§»é‡ï¼Œå¦‚æœæ²¡æœ‰å·²æäº¤çš„offsetæ•°æ®ï¼Œåˆ™é»˜è®¤æ˜¯ä¸‹ä¸€ä¸ªæ¶ˆæ¯çš„ä½ç½®</span></span><br><span class=\"line\">\t<span class=\"comment\">//cfg.Consumer.Offsets.Initial = sarama.OffsetOldest</span></span><br><span class=\"line\">\tcg, err := sarama.NewConsumerGroup([]<span class=\"type\">string</span>&#123;<span class=\"string\">&quot;localhost:9094&quot;</span>&#125;, <span class=\"string\">&quot;test_id&quot;</span>, cfg)</span><br><span class=\"line\">\trequire.NoError(t, err)</span><br><span class=\"line\">\t<span class=\"comment\">// å®šæ—¶ç»“æŸ</span></span><br><span class=\"line\">\tctx, cancel := context.WithTimeout(context.Background(), time.Second*<span class=\"number\">10</span>)</span><br><span class=\"line\">\t<span class=\"keyword\">defer</span> cancel()</span><br><span class=\"line\">\terr = cg.Consume(ctx, []<span class=\"type\">string</span>&#123;<span class=\"string\">&quot;test_topic&quot;</span>&#125;, &amp;ConsumerHandler&#123;&#125;)</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"keyword\">type</span> ConsumerHandler <span class=\"keyword\">struct</span> &#123;</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"function\"><span class=\"keyword\">func</span> <span class=\"params\">(c ConsumerHandler)</span></span> Setup(session sarama.ConsumerGroupSession) <span class=\"type\">error</span> &#123;</span><br><span class=\"line\">\tfmt.Println(<span class=\"string\">&quot;this is setup&quot;</span>)</span><br><span class=\"line\">\t<span class=\"comment\">// é‡ç½®åç§»é‡</span></span><br><span class=\"line\">\t<span class=\"comment\">//partitions := session.Claims()[&quot;test_topic&quot;]</span></span><br><span class=\"line\">\t<span class=\"comment\">//for _, v := range partitions &#123;</span></span><br><span class=\"line\">\t<span class=\"comment\">//\tsession.ResetOffset(&quot;test_topic&quot;, v, sarama.OffsetOldest, &quot;&quot;)</span></span><br><span class=\"line\">\t<span class=\"comment\">//&#125;</span></span><br><span class=\"line\">\t<span class=\"keyword\">return</span> <span class=\"literal\">nil</span></span><br><span class=\"line\">&#125;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"function\"><span class=\"keyword\">func</span> <span class=\"params\">(c ConsumerHandler)</span></span> Cleanup(session sarama.ConsumerGroupSession) <span class=\"type\">error</span> &#123;</span><br><span class=\"line\">\tfmt.Println(<span class=\"string\">&quot;this is cleanup&quot;</span>)</span><br><span class=\"line\">\t<span class=\"keyword\">return</span> <span class=\"literal\">nil</span></span><br><span class=\"line\">&#125;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"function\"><span class=\"keyword\">func</span> <span class=\"params\">(c ConsumerHandler)</span></span> ConsumeClaim(session sarama.ConsumerGroupSession, claim sarama.ConsumerGroupClaim) <span class=\"type\">error</span> &#123;</span><br><span class=\"line\">\t<span class=\"comment\">// å…³é”®å®ç°</span></span><br><span class=\"line\">\tmsgCh := claim.Messages()</span><br><span class=\"line\">\t<span class=\"keyword\">for</span> msg := <span class=\"keyword\">range</span> msgCh &#123;</span><br><span class=\"line\">\t\tfmt.Println(<span class=\"type\">string</span>(msg.Value))</span><br><span class=\"line\">\t\t<span class=\"comment\">// æ ‡è®°æ¶ˆè´¹æˆåŠŸï¼Œç”¨äºç§»åŠ¨offset</span></span><br><span class=\"line\">\t\t<span class=\"comment\">// æœåŠ¡ç«¯åªä¼šæäº¤å¸¦æœ‰æ ‡è®°çš„æ¶ˆæ¯ï¼Œä»£è¡¨è¯¥æ¶ˆæ¯è¢«æˆåŠŸæ¶ˆè´¹</span></span><br><span class=\"line\">\t\tsession.MarkMessage(msg, <span class=\"string\">&quot;&quot;</span>)</span><br><span class=\"line\">\t&#125;</span><br><span class=\"line\">\t<span class=\"keyword\">return</span> <span class=\"literal\">nil</span></span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n\n<ul>\n<li>åˆå§‹åŒ–ä¸€ä¸ª<strong>æ¶ˆè´¹è€…ç»„</strong></li>\n<li>è°ƒç”¨æ¶ˆè´¹è€…ç»„çš„<strong>Consume</strong>æ–¹æ³•</li>\n<li>ä¸º<strong>Consume</strong>æ–¹æ³•ä¼ å…¥ä¸€ä¸ª<strong>ConsumerGroupHandleræ¥å£</strong><ul>\n<li>å‘Consumeæ–¹æ³•ä¸­ä¼ å…¥ä¸€ä¸ªå¸¦æœ‰å®šæ—¶å™¨æˆ–Cancelçš„Contextï¼Œå¯ä»¥æ§åˆ¶æ¶ˆè´¹è€…é€€å‡º</li>\n</ul>\n</li>\n</ul>\n<p>ConsumerGroupHandleræ¥å£éœ€è¦å®ç°ä¸‰ä¸ªæ–¹æ³•ï¼š</p>\n<ul>\n<li>Setup</li>\n<li>Cleanup</li>\n<li>ConsumeClaim</li>\n</ul>\n<p>å…¶ä¸­æ¶ˆè´¹ç»„å¯¹æ¶ˆæ¯è¿›è¡Œæ¶ˆè´¹çš„é€»è¾‘åœ¨ConsumClaimæ–¹æ³•ä¸­å®ç°ï¼š</p>\n<p><img src=\"https://raw.githubusercontent.com/lyydsheep/pic/main/202411261307125.png\" alt=\"image-20241126130732077\"></p>\n<p>ç”±äºConsumeæ–¹æ³•éœ€è¦çš„æ˜¯ä¸€ä¸ªæ¥å£ï¼Œé‚£ä¹ˆæˆ‘ä»¬å¯ä»¥åŸºäºç±»å‹å®šä¹‰ã€ç»“æ„ä½“ç­‰æ–¹å¼èŠ±å¼å®ç°ConsumeClaimæ–¹æ³•ï¼Œä»¥è¾¾åˆ°ä¸€äº›å·§å¦™çš„ä½œç”¨</p>\n<h3 id=\"è‡ªå®šåç§»é‡æ¶ˆè´¹\"><a href=\"#è‡ªå®šåç§»é‡æ¶ˆè´¹\" class=\"headerlink\" title=\"è‡ªå®šåç§»é‡æ¶ˆè´¹\"></a>è‡ªå®šåç§»é‡æ¶ˆè´¹</h3><p>saramaä¸­æä¾›äº†ä¸¤ä¸ªè®¾ç½®åç§»é‡çš„æ–¹æ³•ï¼š</p>\n<ul>\n<li><p>è®¾ç½®<code>cfg.Consumer.Offsets.Initial</code>å­—æ®µ</p>\n<ul>\n<li><pre><code class=\"go\">cfg := sarama.NewConfig()\n// è®¾ç½®åˆå§‹æ¶ˆè´¹åç§»é‡ï¼Œå¦‚æœæ²¡æœ‰å·²æäº¤çš„offsetæ•°æ®ï¼Œåˆ™é»˜è®¤æ˜¯ä¸‹ä¸€ä¸ªæ¶ˆæ¯çš„ä½ç½®\ncfg.Consumer.Offsets.Initial = sarama.OffsetOldest\n<figure class=\"highlight plaintext\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"></span><br><span class=\"line\">- è°ƒç”¨`session.ResetOffset()`æ–¹æ³•</span><br><span class=\"line\"></span><br><span class=\"line\">  - ```go</span><br><span class=\"line\">    // é‡ç½®åç§»é‡</span><br><span class=\"line\">    partitions := session.Claims()[&quot;test_topic&quot;]</span><br><span class=\"line\">    for _, v := range partitions &#123;</span><br><span class=\"line\">    \tsession.ResetOffset(&quot;test_topic&quot;, v, sarama.OffsetOldest, &quot;&quot;)</span><br><span class=\"line\">    &#125;</span><br></pre></td></tr></table></figure>\n</code></pre>\n</li>\n</ul>\n</li>\n</ul>\n<p>ResetOffsetæ–¹æ³•é€šå¸¸åœ¨Setupå‡½æ•°ä¸­è°ƒç”¨</p>\n<p>å€¼å¾—æ³¨æ„çš„æ˜¯ï¼Œåªæœ‰ä¸Šè¿°ä¸¤ä¸ªæ–¹å¼åŒæ—¶æ‰§è¡Œï¼Œæ¶ˆè´¹è€…ç»„æ‰ä¼šä»å†å²ç¬¬ä¸€æ¡æ¶ˆæ¯è¿›è¡Œæ¶ˆè´¹ã€‚æœ€å¥½çš„æ–¹å¼æ˜¯èµ°ç¦»çº¿æ¸ é“ï¼Œæ“ä½œkafkaé›†ç¾¤å»é‡ç½®å¯¹åº”çš„åç§»é‡ã€‚</p>\n<h3 id=\"å¼‚æ­¥æ¶ˆè´¹ï¼Œæ‰¹é‡æäº¤\"><a href=\"#å¼‚æ­¥æ¶ˆè´¹ï¼Œæ‰¹é‡æäº¤\" class=\"headerlink\" title=\"å¼‚æ­¥æ¶ˆè´¹ï¼Œæ‰¹é‡æäº¤\"></a>å¼‚æ­¥æ¶ˆè´¹ï¼Œæ‰¹é‡æäº¤</h3><figure class=\"highlight go\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br><span class=\"line\">31</span><br><span class=\"line\">32</span><br><span class=\"line\">33</span><br><span class=\"line\">34</span><br><span class=\"line\">35</span><br><span class=\"line\">36</span><br><span class=\"line\">37</span><br><span class=\"line\">38</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"function\"><span class=\"keyword\">func</span> <span class=\"params\">(h *Handler[T])</span></span> ConsumeClaim(session sarama.ConsumerGroupSession, claim sarama.ConsumerGroupClaim) <span class=\"type\">error</span> &#123;</span><br><span class=\"line\">\tmsgCh := claim.Messages()</span><br><span class=\"line\">\t<span class=\"keyword\">for</span> &#123;</span><br><span class=\"line\">\t\tctx, cancel := context.WithTimeout(context.Background(), time.Second*<span class=\"number\">2</span>)</span><br><span class=\"line\">\t\tdone := <span class=\"literal\">false</span></span><br><span class=\"line\">\t\tmsgs := <span class=\"built_in\">make</span>([]*sarama.ConsumerMessage, <span class=\"number\">0</span>, <span class=\"number\">10</span>)</span><br><span class=\"line\">\t\tevts := <span class=\"built_in\">make</span>([]T, <span class=\"number\">0</span>, <span class=\"number\">10</span>)</span><br><span class=\"line\">\t\t<span class=\"keyword\">for</span> i := <span class=\"number\">0</span>; i &lt; h.batch &amp;&amp; !done; i++ &#123;</span><br><span class=\"line\">\t\t\t<span class=\"keyword\">select</span> &#123;</span><br><span class=\"line\">\t\t\t<span class=\"keyword\">case</span> msg, ok := &lt;-msgCh:</span><br><span class=\"line\">\t\t\t\t<span class=\"keyword\">if</span> !ok &#123;</span><br><span class=\"line\">\t\t\t\t\t<span class=\"comment\">// msgChè¢«å…³é—­</span></span><br><span class=\"line\">\t\t\t\t\tcancel()</span><br><span class=\"line\">\t\t\t\t\t<span class=\"keyword\">return</span> <span class=\"literal\">nil</span></span><br><span class=\"line\">\t\t\t\t&#125;</span><br><span class=\"line\">\t\t\t\t<span class=\"keyword\">var</span> t T</span><br><span class=\"line\">\t\t\t\terr := json.Unmarshal(msg.Value, &amp;t)</span><br><span class=\"line\">\t\t\t\t<span class=\"keyword\">if</span> err != <span class=\"literal\">nil</span> &#123;</span><br><span class=\"line\">\t\t\t\t\th.l.Error(<span class=\"string\">&quot;fail to unmarshal&quot;</span>)</span><br><span class=\"line\">\t\t\t\t\t<span class=\"keyword\">continue</span></span><br><span class=\"line\">\t\t\t\t&#125;</span><br><span class=\"line\">\t\t\t\tmsgs = <span class=\"built_in\">append</span>(msgs, msg)</span><br><span class=\"line\">\t\t\t\tevts = <span class=\"built_in\">append</span>(evts, t)</span><br><span class=\"line\">\t\t\t<span class=\"keyword\">case</span> &lt;-ctx.Done():</span><br><span class=\"line\">\t\t\t\tdone = <span class=\"literal\">true</span></span><br><span class=\"line\">\t\t\t&#125;</span><br><span class=\"line\">\t\t&#125;</span><br><span class=\"line\">\t\tcancel()</span><br><span class=\"line\">\t\terr := h.fn(msgs, evts)</span><br><span class=\"line\">\t\t<span class=\"keyword\">if</span> err != <span class=\"literal\">nil</span> &#123;</span><br><span class=\"line\">\t\t\t<span class=\"keyword\">return</span> err</span><br><span class=\"line\">\t\t&#125;</span><br><span class=\"line\">\t\t<span class=\"keyword\">for</span> i := <span class=\"keyword\">range</span> msgs &#123;</span><br><span class=\"line\">\t\t\tsession.MarkMessage(msgs[i], <span class=\"string\">&quot;&quot;</span>)</span><br><span class=\"line\">\t\t&#125;</span><br><span class=\"line\">\t&#125;</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"></span><br></pre></td></tr></table></figure>\n\n<p><strong>å¼‚æ­¥æ¶ˆè´¹ä¸€æ‰¹ï¼Œæäº¤ä¸€æ‰¹</strong>ã€‚</p>\n<p>å…¶ä¸­æäº¤ä¸€æ‰¹åœ¨å®ç°è¿‡ç¨‹ä¸­åªéœ€è¦<strong>å°†æœ€åä¸€ä¸ªæ¶ˆæ¯æ ‡è®°</strong>å³å¯</p>\n<p>åœ¨<code>select case</code>ä¸­æœ‰ä¸¤ä¸ªåˆ†æ”¯ï¼Œä¸€ä¸ªåˆ†æ”¯æ˜¯ctx.Doneï¼Œå¯ä»¥é˜²æ­¢å› é•¿æ—¶é—´å‡‘ä¸é½ä¸€ä¸ªbatchçš„æ¶ˆæ¯ï¼Œè€Œå¯¼è‡´çš„é˜»å¡ç°è±¡ï¼›å¦ä¸€ä¸ªåˆ†æ”¯è°ƒç”¨<code>errgroup.Go()</code>æ–¹æ³•å¼‚æ­¥å¤„ç†kafkaä¸­çš„æ¶ˆæ¯</p>\n<h2 id=\"æ”¹é€ ç»Ÿè®¡é˜…è¯»è®¡æ•°\"><a href=\"#æ”¹é€ ç»Ÿè®¡é˜…è¯»è®¡æ•°\" class=\"headerlink\" title=\"æ”¹é€ ç»Ÿè®¡é˜…è¯»è®¡æ•°\"></a>æ”¹é€ ç»Ÿè®¡é˜…è¯»è®¡æ•°</h2><p><strong>DDDä¸­çš„ä¸€ä¸ªé‡è¦æ¦‚å¿µï¼šé¢†åŸŸäº‹ä»¶</strong></p>\n<p>å½“æˆ‘ä»¬åœ¨å‘é€æ¶ˆæ¯æ—¶ï¼Œéœ€è¦å‘é€çš„æ˜¯ä¸€ä¸ª<strong>äº‹ä»¶</strong>ï¼Œå³æŸä¸ªç”¨æˆ·é˜…è¯»äº†æŸç¯‡æ–‡ç« çš„äº‹ä»¶ã€‚é¡¹ç›®ç»“æ„ï¼š</p>\n<p><img src=\"https://raw.githubusercontent.com/lyydsheep/pic/main/202411271856428.png\" alt=\"image-20241127185624318\"></p>\n<h3 id=\"å°è£…æ‰¹é‡æ¶ˆè´¹\"><a href=\"#å°è£…æ‰¹é‡æ¶ˆè´¹\" class=\"headerlink\" title=\"å°è£…æ‰¹é‡æ¶ˆè´¹\"></a>å°è£…æ‰¹é‡æ¶ˆè´¹</h3><p>å‰æ–‡æåŠ<code>cg.consumer()</code>æ–¹æ³•ç¬¬ä¸‰ä¸ªå‚æ•°æ˜¯ä¸€ä¸ª<code>ConsumeGroupHandler</code>æ¥å£å‚æ•°ï¼Œæˆ‘ä»¬å¯ä»¥å°è£…ä¸€ä¸ªHandlerç»“æ„ä½“å®ç°è¿™ä¸ªæ¥å£ï¼Œè¿™ä¸ªç»“æ„ä½“åˆå§‹åŒ–æ—¶æ¥å—ä¸šåŠ¡æ–¹çš„æ¶ˆè´¹å‡½æ•°ï¼Œå¹¶åœ¨<code>ConsumeClaim()</code>æ–¹æ³•ä¸­è°ƒç”¨ä¸‹æ¸¸çš„æ¶ˆè´¹å‡½æ•°å¯¹æ¶ˆæ¯è¿›è¡Œå¤„ç†ã€‚å…·ä½“ï¼ˆæ‰¹é‡æ¶ˆè´¹ï¼‰å°è£…ä¸‹ï¼š</p>\n<figure class=\"highlight go\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br><span class=\"line\">31</span><br><span class=\"line\">32</span><br><span class=\"line\">33</span><br><span class=\"line\">34</span><br><span class=\"line\">35</span><br><span class=\"line\">36</span><br><span class=\"line\">37</span><br><span class=\"line\">38</span><br><span class=\"line\">39</span><br><span class=\"line\">40</span><br><span class=\"line\">41</span><br><span class=\"line\">42</span><br><span class=\"line\">43</span><br><span class=\"line\">44</span><br><span class=\"line\">45</span><br><span class=\"line\">46</span><br><span class=\"line\">47</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">type</span> Handler[T any] <span class=\"keyword\">struct</span> &#123;</span><br><span class=\"line\">\tl     *zap.Logger</span><br><span class=\"line\">\tfn    <span class=\"function\"><span class=\"keyword\">func</span><span class=\"params\">(msgs []*sarama.ConsumerMessage, evts []T)</span></span> <span class=\"type\">error</span></span><br><span class=\"line\">\tbatch <span class=\"type\">int</span></span><br><span class=\"line\">&#125;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"function\"><span class=\"keyword\">func</span> <span class=\"params\">(h *Handler[T])</span></span> ConsumeClaim(session sarama.ConsumerGroupSession, claim sarama.ConsumerGroupClaim) <span class=\"type\">error</span> &#123;</span><br><span class=\"line\">\tmsgCh := claim.Messages()</span><br><span class=\"line\">\t<span class=\"keyword\">for</span> &#123;</span><br><span class=\"line\">\t\tctx, cancel := context.WithTimeout(context.Background(), time.Second)</span><br><span class=\"line\">\t\tmsgs := <span class=\"built_in\">make</span>([]*sarama.ConsumerMessage, <span class=\"number\">0</span>, h.batch)</span><br><span class=\"line\">\t\tevts := <span class=\"built_in\">make</span>([]T, <span class=\"number\">0</span>, h.batch)</span><br><span class=\"line\">\t\tdone := <span class=\"literal\">false</span></span><br><span class=\"line\">\t\t<span class=\"keyword\">for</span> i := <span class=\"number\">0</span>; i &lt; h.batch &amp;&amp; !done; i++ &#123;</span><br><span class=\"line\">\t\t\t<span class=\"keyword\">select</span> &#123;</span><br><span class=\"line\">\t\t\t<span class=\"keyword\">case</span> msg, ok := &lt;-msgCh:</span><br><span class=\"line\">\t\t\t\t<span class=\"keyword\">if</span> !ok &#123;</span><br><span class=\"line\">\t\t\t\t\t<span class=\"comment\">// channelå…³é—­</span></span><br><span class=\"line\">\t\t\t\t\tcancel()</span><br><span class=\"line\">\t\t\t\t\t<span class=\"keyword\">return</span> <span class=\"literal\">nil</span></span><br><span class=\"line\">\t\t\t\t&#125;</span><br><span class=\"line\">\t\t\t\t<span class=\"keyword\">var</span> t T</span><br><span class=\"line\">\t\t\t\terr := json.Unmarshal(msg.Value, &amp;t)</span><br><span class=\"line\">\t\t\t\t<span class=\"keyword\">if</span> err != <span class=\"literal\">nil</span> &#123;</span><br><span class=\"line\">\t\t\t\t\t<span class=\"comment\">// è®°å½•æ—¥å¿—</span></span><br><span class=\"line\">\t\t\t\t\t<span class=\"keyword\">continue</span></span><br><span class=\"line\">\t\t\t\t&#125;</span><br><span class=\"line\">\t\t\t\tmsgs = <span class=\"built_in\">append</span>(msgs, msg)</span><br><span class=\"line\">\t\t\t\tevts = <span class=\"built_in\">append</span>(evts, t)</span><br><span class=\"line\">\t\t\t<span class=\"keyword\">case</span> &lt;-ctx.Done():</span><br><span class=\"line\">\t\t\t\t<span class=\"comment\">// è¶…æ—¶</span></span><br><span class=\"line\">\t\t\t\tdone = <span class=\"literal\">true</span></span><br><span class=\"line\">\t\t\t&#125;</span><br><span class=\"line\">\t\t&#125;</span><br><span class=\"line\">\t\tcancel()</span><br><span class=\"line\">\t\terr := h.fn(msgs, evts)</span><br><span class=\"line\">\t\t<span class=\"keyword\">if</span> err != <span class=\"literal\">nil</span> &#123;</span><br><span class=\"line\">\t\t\t<span class=\"comment\">// è®°å½•æ—¥å¿—</span></span><br><span class=\"line\">\t\t\t<span class=\"comment\">// è®°å½•æ•´ä¸ªæ‰¹æ¬¡</span></span><br><span class=\"line\">\t\t\t<span class=\"comment\">// ç»§ç»­æ¶ˆè´¹</span></span><br><span class=\"line\">\t\t&#125;</span><br><span class=\"line\">\t\t<span class=\"comment\">// æ ‡è®°æ¶ˆæ¯</span></span><br><span class=\"line\">\t\t<span class=\"keyword\">for</span> i := <span class=\"keyword\">range</span> msgs &#123;</span><br><span class=\"line\">\t\t\tsession.MarkMessage(msgs[i], <span class=\"string\">&quot;&quot;</span>)</span><br><span class=\"line\">\t\t&#125;</span><br><span class=\"line\">\t&#125;</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n\n<p>ä¸Šè¿°ä»£ç å®ç°äº†å¯¹æ¶ˆè´¹è€…æ‰¹é‡æ¶ˆè´¹çš„å°è£…ï¼Œå¯ä»¥æé«˜ç³»ç»Ÿå¤„ç†æ¶ˆæ¯çš„æ€§èƒ½ã€‚è¿™æ˜¯å› ä¸ºæ‰¹é‡å¤„ç†å¯ä»¥å°†DAOå±‚é¢10æ¬¡ï¼ˆå‡å®šbatchä¸º10ï¼‰äº‹åŠ¡å¤„ç†ç¼©å‡è‡³åœ¨ä¸€æ¬¡äº‹åŠ¡ä¸­å¤„ç†åæ¬¡æ“ä½œã€‚ä¸¤ä¸ªæ³¨æ„ç‚¹ï¼š</p>\n<ul>\n<li>æ³¨æ„è¶…æ—¶</li>\n<li>è°ƒç”¨ä¸‹æ¸¸</li>\n</ul>\n<h3 id=\"ç»„è£…æ¶ˆè´¹è€…\"><a href=\"#ç»„è£…æ¶ˆè´¹è€…\" class=\"headerlink\" title=\"ç»„è£…æ¶ˆè´¹è€…\"></a>ç»„è£…æ¶ˆè´¹è€…</h3><p>åœ¨ä¾èµ–æ³¨å…¥çš„è¿‡ç¨‹ä¸­ï¼Œæ¶ˆè´¹è€…ç±»ä¼¼äºWebã€GRpcæœåŠ¡å™¨çš„ä¸œè¥¿ï¼Œéœ€è¦å¯åŠ¨ã€‚å› æ­¤å¼•å…¥ä¸€ä¸ªAppç»“æ„ä½“ï¼Œå¯¹Webå’Œæ¶ˆè´¹è€…è¿›è¡Œç»„åˆ</p>\n<figure class=\"highlight go\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\">// app.go</span></span><br><span class=\"line\"><span class=\"keyword\">type</span> App <span class=\"keyword\">struct</span> &#123;</span><br><span class=\"line\">    Web *gin.Engine</span><br><span class=\"line\">    Consumers []events.Consumer</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\">// ioc/kafka.go</span></span><br><span class=\"line\"><span class=\"comment\">// ç”±äºGoæ²¡æœ‰åŠ¨æ€ç±»å‹ï¼Œå› æ­¤æ¯ä¸€ä¸ªæ¶ˆè´¹è€…éƒ½éœ€è¦è¿›è¡Œæ³¨å†Œæ“ä½œ</span></span><br><span class=\"line\"><span class=\"function\"><span class=\"keyword\">func</span> <span class=\"title\">NewConsumers</span><span class=\"params\">(c1 *articles.InteractiveReadEventConsumer)</span></span> []events.Consumer &#123;</span><br><span class=\"line\">    <span class=\"keyword\">return</span> []events.Consumer&#123;c1&#125;</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\">// wire.go</span></span><br><span class=\"line\"><span class=\"comment\">// ç»„åˆç»“æ„ä½“æ‰€æœ‰çš„å­—æ®µï¼Œ*è¡¨ç¤ºæ‰€æœ‰</span></span><br><span class=\"line\">wire.Struct(<span class=\"built_in\">new</span>(App), <span class=\"string\">&quot;*&quot;</span>)</span><br></pre></td></tr></table></figure>\n\n<h3 id=\"æ‰¹é‡ç”Ÿäº§\"><a href=\"#æ‰¹é‡ç”Ÿäº§\" class=\"headerlink\" title=\"æ‰¹é‡ç”Ÿäº§\"></a>æ‰¹é‡ç”Ÿäº§</h3><p>svcé€šè¿‡channelå°†æ¶ˆæ¯å‘é€ç»™ç”Ÿäº§è€…ï¼Œå½“ç”Ÿäº§è€…ç§¯ç´¯è¶³å¤Ÿå¤šçš„æ¶ˆæ¯åï¼Œå°±å°†è¿™ä¸€æ‰¹æ¶ˆæ¯å‘é€ç»™Kafka</p>\n<figure class=\"highlight go\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br><span class=\"line\">31</span><br><span class=\"line\">32</span><br><span class=\"line\">33</span><br><span class=\"line\">34</span><br><span class=\"line\">35</span><br><span class=\"line\">36</span><br><span class=\"line\">37</span><br><span class=\"line\">38</span><br><span class=\"line\">39</span><br><span class=\"line\">40</span><br><span class=\"line\">41</span><br><span class=\"line\">42</span><br><span class=\"line\">43</span><br><span class=\"line\">44</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"function\"><span class=\"keyword\">func</span> <span class=\"title\">NewBasicInteractService</span><span class=\"params\">(repo repository.InteractRepository, producer events.Producer)</span></span> *BasicInteractService &#123;</span><br><span class=\"line\">\tch := <span class=\"built_in\">make</span>(<span class=\"keyword\">chan</span> events.ReadEvent, <span class=\"number\">10</span>)</span><br><span class=\"line\">    <span class=\"comment\">// å‡‘è¶³ä¸€æ‰¹æ¶ˆæ¯</span></span><br><span class=\"line\">\t<span class=\"keyword\">go</span> <span class=\"function\"><span class=\"keyword\">func</span><span class=\"params\">()</span></span> &#123;</span><br><span class=\"line\">\t\t<span class=\"keyword\">for</span> &#123;</span><br><span class=\"line\">\t\t\tctx, cancel := context.WithTimeout(context.Background(), time.Second)</span><br><span class=\"line\">\t\t\tevts := <span class=\"built_in\">make</span>([]events.ReadEvent, <span class=\"number\">0</span>, <span class=\"number\">10</span>)</span><br><span class=\"line\">\t\t\tdone := <span class=\"literal\">false</span></span><br><span class=\"line\">\t\t\t<span class=\"keyword\">for</span> i := <span class=\"number\">0</span>; i &lt; <span class=\"number\">10</span> &amp;&amp; !done; i++ &#123;</span><br><span class=\"line\">\t\t\t\t<span class=\"keyword\">select</span> &#123;</span><br><span class=\"line\">\t\t\t\t<span class=\"keyword\">case</span> evt, ok := &lt;-ch:</span><br><span class=\"line\">\t\t\t\t\t<span class=\"keyword\">if</span> !ok &#123;</span><br><span class=\"line\">\t\t\t\t\t\tcancel()</span><br><span class=\"line\">\t\t\t\t\t\t<span class=\"keyword\">break</span></span><br><span class=\"line\">\t\t\t\t\t&#125;</span><br><span class=\"line\">\t\t\t\t\tevts = <span class=\"built_in\">append</span>(evts, evt)</span><br><span class=\"line\">\t\t\t\t<span class=\"keyword\">case</span> &lt;-ctx.Done():</span><br><span class=\"line\">\t\t\t\t\tdone = <span class=\"literal\">true</span></span><br><span class=\"line\">\t\t\t\t&#125;</span><br><span class=\"line\">\t\t\t&#125;</span><br><span class=\"line\">\t\t\tcancel()</span><br><span class=\"line\">\t\t\terr := producer.ProduceReadEventV1(ctx, evts)</span><br><span class=\"line\">\t\t\t<span class=\"keyword\">if</span> err != <span class=\"literal\">nil</span> &#123;</span><br><span class=\"line\">\t\t\t\t<span class=\"comment\">// æ—¥å¿—</span></span><br><span class=\"line\">\t\t\t&#125;</span><br><span class=\"line\">\t\t&#125;</span><br><span class=\"line\">\t&#125;()</span><br><span class=\"line\">\t<span class=\"keyword\">return</span> &amp;BasicInteractService&#123;repo: repo, producer: producer, ch: ch&#125;</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\">// ç§¯ç´¯æ¶ˆæ¯</span></span><br><span class=\"line\"><span class=\"function\"><span class=\"keyword\">func</span> <span class=\"params\">(svc *BasicInteractService)</span></span> IncReadCnt(ctx context.Context, biz <span class=\"type\">string</span>, bizId, uid <span class=\"type\">int64</span>) <span class=\"type\">error</span> &#123;</span><br><span class=\"line\">\t_, err := svc.Get(ctx, biz, bizId, uid)</span><br><span class=\"line\">\t<span class=\"keyword\">go</span> <span class=\"function\"><span class=\"keyword\">func</span><span class=\"params\">()</span></span> &#123;</span><br><span class=\"line\">\t\t<span class=\"keyword\">if</span> err == <span class=\"literal\">nil</span> &#123;</span><br><span class=\"line\">\t\t\tsvc.ch &lt;- events.ReadEvent&#123;</span><br><span class=\"line\">\t\t\t\tUid: uid,</span><br><span class=\"line\">\t\t\t\tAid: bizId,</span><br><span class=\"line\">\t\t\t&#125;</span><br><span class=\"line\">\t\t&#125;</span><br><span class=\"line\">\t&#125;()</span><br><span class=\"line\">\t<span class=\"keyword\">return</span> err</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n\n","excerpt":"","more":"<h1 id=\"æ¶ˆæ¯é˜Ÿåˆ—\"><a href=\"#æ¶ˆæ¯é˜Ÿåˆ—\" class=\"headerlink\" title=\"æ¶ˆæ¯é˜Ÿåˆ—\"></a>æ¶ˆæ¯é˜Ÿåˆ—</h1><p>æ¶ˆæ¯é˜Ÿåˆ—çš„åŸºæœ¬å½¢æ€ï¼Œå°±æ˜¯æœ‰<strong>Nä¸ªç”Ÿäº§è€…ï¼ŒNä¸ªæ¶ˆè´¹è€…</strong></p>\n<p>ç”Ÿäº§è€…å’Œæ¶ˆè´¹è€…è§£è€¦äº†</p>\n<h2 id=\"åº”ç”¨åœºæ™¯\"><a href=\"#åº”ç”¨åœºæ™¯\" class=\"headerlink\" title=\"åº”ç”¨åœºæ™¯\"></a>åº”ç”¨åœºæ™¯</h2><h3 id=\"æ¶ˆæ¯é˜Ÿåˆ—è§£è€¦\"><a href=\"#æ¶ˆæ¯é˜Ÿåˆ—è§£è€¦\" class=\"headerlink\" title=\"æ¶ˆæ¯é˜Ÿåˆ—è§£è€¦\"></a>æ¶ˆæ¯é˜Ÿåˆ—è§£è€¦</h3><p>ä¸€ä¸ªæ¨¡å—Aæ¥æ”¶åˆ°è¯·æ±‚åéœ€è¦è°ƒç”¨æ¨¡å—Bï¼Œæ¥ç€ç­‰å¾…æ¨¡å—Bå®Œæˆåç»­å·¥ä½œï¼Œæ‰è¿›è¡Œå›åŒ…ã€‚è¿™ç§æƒ…å†µä¸‹æ¨¡å—Aæåº¦ä¾èµ–äºæ¨¡å—Bçš„è¿è¡ŒçŠ¶å†µï¼Œè€¦åˆåº¦è¾ƒé«˜ã€‚å¦‚æœä¸šåŠ¡å…è®¸çš„è¯ï¼Œæ¨¡å—Aå®Œå…¨å¯ä»¥å°†è°ƒç”¨æ¨¡å—Bçš„è¯·æ±‚ä¿¡æ¯ä¸¢è¿›<strong>æ¶ˆæ¯ä¸­è½¬ç«™</strong>ä¸­ï¼Œæ¨¡å—Bä¸€æ—¦å‘ç°ä¸­è½¬ç«™ä¸­æœ‰æ¶ˆæ¯å°±è¿›è¡Œå·¥ä½œã€‚è¿™ä¸ªä¸­è½¬ç«™å°±æ˜¯æ¶ˆæ¯é˜Ÿåˆ—ï¼Œèµ·ç€è§£è€¦åˆä½œç”¨<br>è§£è€¦çš„æœ¬è´¨å°±æ˜¯<strong>Aä¸ç”¨å…³å¿ƒBçš„äº‹æƒ…ï¼Œä»¥åŠä¸å—Bæ‰§è¡Œç»“æœçš„å½±å“</strong></p>\n<h3 id=\"æ¶ˆæ¯é˜Ÿåˆ—å‰Šå³°\"><a href=\"#æ¶ˆæ¯é˜Ÿåˆ—å‰Šå³°\" class=\"headerlink\" title=\"æ¶ˆæ¯é˜Ÿåˆ—å‰Šå³°\"></a>æ¶ˆæ¯é˜Ÿåˆ—å‰Šå³°</h3><p>åœ¨è¯·æ±‚å¤„ç†é“¾ä¸­ï¼Œå„æ¨¡å—çš„å¤„ç†èƒ½åŠ›é€šå¸¸å­˜åœ¨è¾ƒå¤§å·®å¼‚ã€‚æ ¹æ®æœ¨æ¡¶åŸç†ï¼Œç³»ç»Ÿçš„ QPSï¼ˆæ¯ç§’æŸ¥è¯¢é‡ï¼‰å¾€å¾€å—æœ€å¼±å¤„ç†æ¨¡å—çš„é™åˆ¶ï¼Œè¿™å¯¼è‡´ä¸Šæ¸¸æ¨¡å—çš„å‰©ä½™å¤„ç†èƒ½åŠ›æ— æ³•å……åˆ†åˆ©ç”¨ï¼Œè¿›è€Œé€ æˆæ€§èƒ½ä¸èµ„æºçš„æµªè´¹ã€‚ä¸ºæå‡ç³»ç»Ÿæ•´ä½“çš„ QPSï¼Œå¹¶æœ€å¤§é™åº¦å‘æŒ¥ä¸Šæ¸¸æ¨¡å—çš„é«˜å“åº”æ€§èƒ½ï¼Œ<strong>ä¸Šæ¸¸å¯ä»¥å°†å¤„ç†å®Œæˆçš„æ¶ˆæ¯æš‚å­˜è‡³æ¶ˆæ¯é˜Ÿåˆ—</strong>ã€‚ä¸‹æ¸¸æ¨¡å—åˆ™ä»æ¶ˆæ¯é˜Ÿåˆ—ä¸­é€æ­¥è·å–æ¶ˆæ¯è¿›è¡Œå¤„ç†ï¼Œé€šè¿‡å»¶è¿Ÿå¤„ç†çš„æ–¹å¼ï¼Œå®ç°<strong>å‰Šå³°å¡«è°·</strong>çš„æ•ˆæœï¼Œæœ‰æ•ˆç¼“è§£è´Ÿè½½ä¸å‡é—®é¢˜ã€‚<br>å®é™…åœºæ™¯ï¼š1ã€ç§’æ€åœºæ™¯ 2ã€å‡Œæ™¨å½•å…¥æ•°æ®</p>\n<figure class=\"highlight sh\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">cnt=1</span><br><span class=\"line\"><span class=\"keyword\">while</span> [ <span class=\"variable\">$cnt</span> -le 10 ]</span><br><span class=\"line\"><span class=\"keyword\">do</span></span><br><span class=\"line\">\tcurl -w <span class=\"string\">&quot;\\n cost %&#123;time_total&#125;s&quot;</span> -H <span class=\"string\">&quot;Trace-ID:lyydsheep1&quot;</span> -H <span class=\"string\">&quot;Content-Type: application/json; charset=utf-8&quot;</span> -H <span class=\"string\">&quot;User-ID: 7&quot;</span> http://localhost:8080/demo/peak_clipping -d <span class=\"string\">&#x27;&#123;&quot;num&quot;:1&#125;&#x27;</span></span><br><span class=\"line\">\tcnt=$((cnt + <span class=\"number\">1</span>))</span><br><span class=\"line\"><span class=\"keyword\">done</span></span><br></pre></td></tr></table></figure>\n\n<h3 id=\"æ¶ˆæ¯é˜Ÿåˆ—åˆ†å‘\"><a href=\"#æ¶ˆæ¯é˜Ÿåˆ—åˆ†å‘\" class=\"headerlink\" title=\"æ¶ˆæ¯é˜Ÿåˆ—åˆ†å‘\"></a>æ¶ˆæ¯é˜Ÿåˆ—åˆ†å‘</h3><p>ä¸€ä¸ªæ¨¡å—Aéœ€è¦å°†æ¶ˆæ¯åˆ†å‘è‡³æ¨¡å—Bã€Cã€D<br>å®é™…åœºæ™¯ï¼š1ã€æ•°æ®æ›´æ–° 2ã€æ•°æ®åˆ†æ&#x2F;æ ¡éªŒ<br>åœ¨å¼•å…¥æ¶ˆæ¯é˜Ÿåˆ—ä¹‹å‰ï¼Œç”Ÿäº§è€…éœ€è¦äº†è§£æœ‰å¤šå°‘ä¸ªæ¶ˆè´¹è€…ï¼Œä»¥åŠæ¶ˆè´¹è€…å¯¹äºæ¶ˆæ¯çš„æ ¼å¼åŒ–è¦æ±‚ã€‚åœ¨å¼•å…¥æ¶ˆæ¯é˜Ÿåˆ—åï¼Œç”Ÿäº§è€…åªéœ€è¦å’Œæ¶ˆæ¯é˜Ÿåˆ—æ‰“äº¤é“ï¼Œä¸å¿…å…³å¿ƒæ¶ˆè´¹è€…ï¼Œä¹Ÿå¯ä»¥è¯´æ˜¯å®ç°äº†æ¶ˆæ¯ç¾¤å‘åœºæ™¯ä¸‹çš„è§£è€¦</p>\n<h2 id=\"åŸºæœ¬æ¦‚å¿µ\"><a href=\"#åŸºæœ¬æ¦‚å¿µ\" class=\"headerlink\" title=\"åŸºæœ¬æ¦‚å¿µ\"></a>åŸºæœ¬æ¦‚å¿µ</h2><ul>\n<li>ç”Ÿäº§è€… producer</li>\n<li>æ¶ˆè´¹è€… consumer</li>\n<li>æ¶ˆæ¯æœåŠ¡å™¨ broker</li>\n<li>topicä¸partition</li>\n<li>æ¶ˆè´¹è€…ç»„ä¸æ¶ˆè´¹è€…</li>\n</ul>\n<p><img src=\"https://raw.githubusercontent.com/lyydsheep/pic/main/202411211437013.png\" alt=\"image-20241121143736964\"></p>\n<p>brokerï¼ˆä¸­é—´äººï¼‰ï¼Œæ˜¯ä¸€ä¸ªé€»è¾‘ä¸Šçš„æ¦‚å¿µã€‚åœ¨å®è·µä¸­ï¼Œå¯ä»¥æ˜ å°„ä¸ºä¸€ä¸ªæ¶ˆæ¯é˜Ÿåˆ—è¿›ç¨‹æˆ–ä¸€å°æœºå™¨</p>\n<p><strong>topicæ˜¯æ¶ˆæ¯é˜Ÿåˆ—ä¸Šä»£è¡¨ä¸åŒä¸šåŠ¡çš„ä¸œè¥¿</strong>ï¼Œç®€å•æ¥è¯´ï¼Œä¸€ä¸ªä¸šåŠ¡å°±æ˜¯ä¸€ä¸ªtopicï¼Œè€Œ<strong>ä¸€ä¸ªtopicå¯ä»¥æœ‰å¤šä¸ªåˆ†åŒº</strong></p>\n<p><img src=\"https://raw.githubusercontent.com/lyydsheep/pic/main/202411211440344.png\" alt=\"image-20241121144040306\"></p>\n<p><strong>å½“å‘é€æ¶ˆæ¯åˆ°Kafkaä¸Šçš„æ—¶å€™ï¼ŒKafkaä¼šå…ˆæŠŠæ¶ˆæ¯å†™å…¥ä¸»åˆ†åŒºï¼Œå†åŒæ­¥åˆ°ä»åˆ†åŒº</strong>ã€‚è¿™æ˜¯ä¸ºäº†ä¿è¯é«˜å¯ç”¨å’Œæ•°æ®ä¸ä¸¢å¤±</p>\n<p>ä½†é€šå¸¸è¯´topicæœ‰å¤šå°‘ä¸ªåˆ†åŒºï¼Œæ˜¯æŒ‡æœ‰å¤šå°‘ä¸ªä¸»åˆ†åŒº</p>\n<p><img src=\"https://raw.githubusercontent.com/lyydsheep/pic/main/202411211443600.png\" alt=\"image-20241121144329550\"></p>\n<p>æ­£å¸¸æƒ…å†µä¸‹ï¼ŒåŒä¸€ä¸ªtopicçš„åˆ†åŒºä¼šå°½é‡å‡åŒ€åˆ†æ•£åˆ°æ‰€æœ‰çš„brokerä¸Šã€‚ä¸ºäº†ä¿è¯å½“æŸä¸ªbrokerå¥”æºƒåï¼Œä¸ä¼šé€ æˆå¾ˆå¤§çš„å½±å“ï¼Œéœ€è¦æ»¡è¶³ä¸‹é¢ä¸¤ä¸ªæ¡ä»¶ï¼š</p>\n<ul>\n<li><strong>æ‰€æœ‰ä¸»åˆ†åŒºä¸åœ¨åŒä¸€ä¸ªbrokerä¸Š</strong></li>\n<li><strong>åŒä¸€ä¸ªtopicçš„åˆ†åŒºä¸éƒ½åœ¨ä¸€ä¸ªbrokerä¸Š</strong></li>\n</ul>\n<p>å¦‚ä¸Šæ–‡æ‰€è¿°ï¼Œä¸€ä¸ªtopicéƒ½ä¼šæœ‰å¤šä¸ªåˆ†åŒºï¼Œ<strong>æ‰€ä»¥å‘é€è€…åœ¨å‘é€æ¶ˆæ¯çš„æ—¶å€™ï¼Œå°±éœ€è¦é€‰æ‹©ä¸€ä¸ªç›®æ ‡ï¼ˆä¸»ï¼‰åˆ†åŒº</strong></p>\n<p>æ¯”è¾ƒå¸¸ç”¨çš„ç­–ç•¥ï¼š</p>\n<ul>\n<li>è½®è¯¢</li>\n<li>å“ˆå¸Œ</li>\n<li>éšæœº</li>\n</ul>\n<p><img src=\"https://raw.githubusercontent.com/lyydsheep/pic/main/202411211503889.png\" alt=\"image-20241121150303848\"></p>\n<p>Kafkaæ¶ˆæ¯éš”ç¦»å•ä½æ˜¯<strong>åŒº</strong>ï¼Œ<strong>åªæœ‰ä¸€ä¸ªåˆ†åŒºå†…çš„æ¶ˆæ¯æ‰èƒ½ä¿è¯æ˜¯æœ‰åºçš„</strong></p>\n<p><strong>ä¸€ä¸ªæ¶ˆè´¹è€…ç»„å¯ä»¥çœ‹ä½œæ˜¯å…³å¿ƒè¿™ä¸ªtopicçš„ä¸šåŠ¡æ–¹</strong>ï¼Œå¯¹äºä¸€ä¸ªåˆ†åŒºï¼ŒåŒä¸€ä¸ªæ¶ˆè´¹è€…ç»„åªèƒ½æœ‰ä¸€ä¸ªæ¶ˆè´¹è€…å‡ºæ¥æ¶ˆè´¹</p>\n<ul>\n<li>ä¸€ä¸ªæ¶ˆè´¹è€…å¯ä»¥æ¶ˆè´¹å¤šä¸ªåˆ†åŒºçš„æ•°æ®</li>\n<li>ä¸€ä¸ªåˆ†åŒºåœ¨åŒä¸€æ—¶åˆ»ï¼Œåªèƒ½è¢«ä¸€ä¸ªæ¶ˆè´¹è€…æ¶ˆè´¹</li>\n</ul>\n<p><img src=\"https://raw.githubusercontent.com/lyydsheep/pic/main/202411211511775.png\" alt=\"image-20241121151119740\"></p>\n<p><strong>æ¶ˆæ¯ç§¯å‹é—®é¢˜</strong></p>\n<ul>\n<li><strong>å¦‚æœä¸€ä¸ªtopicæœ‰Nä¸ªåˆ†ç»„ï¼Œé‚£ä¹ˆåŒä¸€ä¸ªæ¶ˆè´¹è€…ç»„æœ€å¤šæœ‰Nä¸ªæ¶ˆè´¹è€…ï¼Œå¤šä½™çš„æ¶ˆè´¹è€…ä¼šè¢«å¿½ç•¥</strong></li>\n<li><strong>å¦‚æœæ¶ˆè´¹è€…æ€§èƒ½ä½ï¼Œé‚£ä¹ˆä¸èƒ½é€šè¿‡æ— é™å¢åŠ æ¶ˆè´¹è€…æ•°é‡çš„æ–¹å¼æé«˜æ¶ˆè´¹é€Ÿç‡</strong></li>\n</ul>\n<h2 id=\"å‘½ä»¤è¡Œå·¥å…·\"><a href=\"#å‘½ä»¤è¡Œå·¥å…·\" class=\"headerlink\" title=\"å‘½ä»¤è¡Œå·¥å…·\"></a>å‘½ä»¤è¡Œå·¥å…·</h2><p>saramaæä¾›äº†è®¸å¤šå‘½ä»¤è¡Œå·¥å…·ï¼Œå…¶ä¸­consumerå’Œproducerç”¨å¾—æ¯”è¾ƒå¤š</p>\n<figure class=\"highlight go\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">go</span> install github.com/IBM/sarama/tools/kafka-console-consumer</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"keyword\">go</span> install github.com/IBM/sarama/tools/kafka-console-producer</span><br></pre></td></tr></table></figure>\n\n<p>è¿™äº›å…·ä½“å·¥å…·çš„ä½¿ç”¨æ–¹æ³•å¯ä»¥å‚è€ƒsaramaä¸­çš„<code>ReadMe</code>æ–‡æ¡£</p>\n<h2 id=\"Saramaä½¿ç”¨\"><a href=\"#Saramaä½¿ç”¨\" class=\"headerlink\" title=\"Saramaä½¿ç”¨\"></a>Saramaä½¿ç”¨</h2><h3 id=\"åŒæ­¥å‘é€æ¶ˆæ¯\"><a href=\"#åŒæ­¥å‘é€æ¶ˆæ¯\" class=\"headerlink\" title=\"åŒæ­¥å‘é€æ¶ˆæ¯\"></a>åŒæ­¥å‘é€æ¶ˆæ¯</h3><figure class=\"highlight go\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"function\"><span class=\"keyword\">func</span> <span class=\"title\">TestSyncProducer</span><span class=\"params\">(t *testing.T)</span></span> &#123;</span><br><span class=\"line\">\tcfg := sarama.NewConfig()</span><br><span class=\"line\">\t<span class=\"comment\">// åŒæ­¥ç”Ÿäº§è€…å¿…é¡»è®¾ç½®</span></span><br><span class=\"line\">\tcfg.Producer.Return.Successes = <span class=\"literal\">true</span></span><br><span class=\"line\">\tclient, err := sarama.NewClient([]<span class=\"type\">string</span>&#123;<span class=\"string\">&quot;localhost:9094&quot;</span>&#125;, cfg)</span><br><span class=\"line\">\trequire.NoError(t, err)</span><br><span class=\"line\">\tproducer, err := sarama.NewSyncProducerFromClient(client)</span><br><span class=\"line\">\trequire.NoError(t, err)</span><br><span class=\"line\">\terr = producer.SendMessages([]*sarama.ProducerMessage&#123;</span><br><span class=\"line\">\t\t&#123;</span><br><span class=\"line\">\t\t\tTopic: <span class=\"string\">&quot;test_topic&quot;</span>,</span><br><span class=\"line\">\t\t\tValue: sarama.StringEncoder(<span class=\"string\">&quot;message A&quot;</span>),</span><br><span class=\"line\">\t\t&#125;,</span><br><span class=\"line\">\t\t&#123;</span><br><span class=\"line\">\t\t\tTopic: <span class=\"string\">&quot;test_topic&quot;</span>,</span><br><span class=\"line\">\t\t\tValue: sarama.StringEncoder(<span class=\"string\">&quot;message B&quot;</span>),</span><br><span class=\"line\">\t\t&#125;,</span><br><span class=\"line\">\t&#125;)</span><br><span class=\"line\">\trequire.NoError(t, err)</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"></span><br></pre></td></tr></table></figure>\n\n<h3 id=\"æŒ‡å®šåˆ†åŒº\"><a href=\"#æŒ‡å®šåˆ†åŒº\" class=\"headerlink\" title=\"æŒ‡å®šåˆ†åŒº\"></a>æŒ‡å®šåˆ†åŒº</h3><p>ç”±ä¸Šæ–‡å¯çŸ¥ï¼ŒKafkaåªèƒ½ä¿è¯ä¸€ä¸ªåˆ†åŒºå†…çš„æ¶ˆæ¯æ˜¯æœ‰åºçš„ã€‚å€˜è‹¥æˆ‘ä»¬å¸Œæœ›<strong>åŒä¸€ä¸ªä¸šåŠ¡çš„æ¶ˆæ¯ä¸€å®šå‘é€åˆ°åŒä¸€ä¸ªåˆ†åŒºä¸Šï¼Œä¿è¯ä¸šåŠ¡å†…æ¶ˆæ¯æœ‰åºæ€§</strong>ï¼Œå¯ä»¥å¯¹<code>sarama.Config.Producer</code>ç»“æ„ä½“ä¸­çš„<code>Partitioner</code>å­—æ®µè¿›è¡Œé…ç½®ï¼Œå¦‚ä¸‹å›¾ï¼š</p>\n<p><img src=\"https://raw.githubusercontent.com/lyydsheep/pic/main/202411242012815.png\" alt=\"image-20241124201226717\"></p>\n<p>å¸¸è§çš„ï¼š</p>\n<ul>\n<li>Randomï¼šéšæœºä¸€ä¸ª</li>\n<li>RoundRobinï¼šè½®è¯¢</li>\n<li>Hashï¼šæ ¹æ®Messageä¸­çš„keyçš„å“ˆå¸Œå€¼æ¥ç­›é€‰ä¸€ä¸ª</li>\n<li>Manualï¼šæ ¹æ®Messageä¸­çš„partitionå­—æ®µæ¥é€‰æ‹©</li>\n<li>ConsistentCRCï¼šä¸€è‡´æ€§å“ˆå¸Œï¼Œç”¨çš„æ˜¯CRC16ç®—æ³•</li>\n<li>Customï¼šè‡ªå®šä¹‰ä¸€éƒ¨åˆ†Hashå‚æ•°</li>\n</ul>\n<h3 id=\"å¼‚æ­¥å‘é€æ¶ˆæ¯\"><a href=\"#å¼‚æ­¥å‘é€æ¶ˆæ¯\" class=\"headerlink\" title=\"å¼‚æ­¥å‘é€æ¶ˆæ¯\"></a>å¼‚æ­¥å‘é€æ¶ˆæ¯</h3><figure class=\"highlight go\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"function\"><span class=\"keyword\">func</span> <span class=\"title\">TestAsyncProducer</span><span class=\"params\">(t *testing.T)</span></span> &#123;</span><br><span class=\"line\">\tcfg := sarama.NewConfig()</span><br><span class=\"line\">\tcfg.Producer.Return.Successes = <span class=\"literal\">true</span></span><br><span class=\"line\">\tcfg.Producer.Return.Errors = <span class=\"literal\">true</span></span><br><span class=\"line\">\tclient, err := sarama.NewClient([]<span class=\"type\">string</span>&#123;<span class=\"string\">&quot;localhost:9094&quot;</span>&#125;, cfg)</span><br><span class=\"line\">\trequire.NoError(t, err)</span><br><span class=\"line\">\tproducer, err := sarama.NewAsyncProducerFromClient(client)</span><br><span class=\"line\">\trequire.NoError(t, err)</span><br><span class=\"line\">\tmsgInput := producer.Input()</span><br><span class=\"line\">\tmsgInput &lt;- &amp;sarama.ProducerMessage&#123;</span><br><span class=\"line\">\t\tTopic: <span class=\"string\">&quot;test_topic&quot;</span>,</span><br><span class=\"line\">\t\tValue: sarama.StringEncoder(<span class=\"string\">&quot;message Hello&quot;</span>),</span><br><span class=\"line\">\t&#125;</span><br><span class=\"line\">\tsuCh, erCh := producer.Successes(), producer.Errors()</span><br><span class=\"line\">\t<span class=\"comment\">// å®è·µä¸­ä¸€èˆ¬éƒ½æ˜¯å¼€ä¸€ä¸ªgoroutineæ¥å¤„ç†</span></span><br><span class=\"line\">\t<span class=\"keyword\">select</span> &#123;</span><br><span class=\"line\">\t<span class=\"keyword\">case</span> msg := &lt;-suCh:</span><br><span class=\"line\">\t\tval, _ := msg.Value.Encode()</span><br><span class=\"line\">\t\tfmt.Println(msg.Topic, <span class=\"type\">string</span>(val))</span><br><span class=\"line\">\t<span class=\"keyword\">case</span> err := &lt;-erCh:</span><br><span class=\"line\">\t\tfmt.Println(err.Error())</span><br><span class=\"line\">\t&#125;</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n\n<ul>\n<li>éœ€è¦æŠŠ<code>Success</code>å’Œ<code>Errors</code>éƒ½è®¾ç½®ä¸º<code>true</code>ï¼Œè¿™æ˜¯ä¸ºäº†åé¢èƒ½å¼‚æ­¥è·å–åˆ°ç»“æœ</li>\n<li>é€šè¿‡ä¸€ä¸ª<strong>channel</strong>å¼‚æ­¥å‘é€æ¶ˆæ¯</li>\n<li>é€šè¿‡<code>select case</code>ï¼Œç›‘å¬å¼‚æ­¥å‘é€æ¶ˆæ¯çš„ç»“æœ</li>\n</ul>\n<h3 id=\"æŒ‡å®šacks\"><a href=\"#æŒ‡å®šacks\" class=\"headerlink\" title=\"æŒ‡å®šacks\"></a>æŒ‡å®šacks</h3><p>ç”Ÿäº§è€…åœ¨å‘é€æ•°æ®çš„æ—¶å€™ï¼Œæœ‰ä¸€ä¸ªå…³é”®å‚æ•°â€”â€”<strong>acks</strong>,è¯¥å‚æ•°æœ‰ä¸‰ä¸ªå–å€¼ï¼š</p>\n<p><img src=\"https://raw.githubusercontent.com/lyydsheep/pic/main/202411251938899.png\" alt=\"image-20241125193828822\"></p>\n<ul>\n<li>0ï¼šå®¢æˆ·ç«¯å‘ä¸€æ¬¡ï¼Œä»…æ”¶åˆ°TCPçš„ACKæŠ¥æ–‡ï¼ˆæ²¡å®è´¨ä½œç”¨ï¼‰</li>\n<li>1ï¼šå®¢æˆ·ç«¯å‘é€ä¸€æ¬¡ï¼Œéœ€è¦<strong>ç­‰å¾…æœåŠ¡ç«¯å°†æ¶ˆæ¯å†™å…¥ä¸»åˆ†åŒº</strong>ï¼Œèƒ½ç¡®ä¿æ¶ˆæ¯æˆåŠŸé€è¾¾</li>\n<li>-1ï¼šå®¢æˆ·ç«¯å‘é€ä¸€æ¬¡ï¼Œéœ€è¦<strong>ç­‰å¾…æœåŠ¡ç«¯å°†æ¶ˆæ¯åŒæ­¥è‡³æ‰€æœ‰ï¼ˆå¯é…ç½®ï¼‰çš„ISRä¸Š</strong></li>\n</ul>\n<p><img src=\"https://raw.githubusercontent.com/lyydsheep/pic/main/202411251942196.png\" alt=\"image-20241125194219136\"></p>\n<p>è‡ªä¸Šè€Œä¸‹ï¼Œæ€§èƒ½é€æ¸å˜å·®ï¼Œä½†æ˜¯æ•°æ®å¯é æ€§ä¸Šå‡</p>\n<h3 id=\"ISR\"><a href=\"#ISR\" class=\"headerlink\" title=\"ISR\"></a>ISR</h3><p><strong>ISRï¼ˆIn Sync Replicasï¼‰ï¼Œå°±æ˜¯å’Œä¸»åˆ†åŒºä¿æŒæ•°æ®åŒæ­¥çš„ä»åˆ†åŒºé›†åˆ</strong></p>\n<p><img src=\"https://raw.githubusercontent.com/lyydsheep/pic/main/202411251945935.png\" alt=\"image-20241125194510901\"></p>\n<h3 id=\"å¯åŠ¨æ¶ˆè´¹è€…\"><a href=\"#å¯åŠ¨æ¶ˆè´¹è€…\" class=\"headerlink\" title=\"å¯åŠ¨æ¶ˆè´¹è€…\"></a><strong>å¯åŠ¨æ¶ˆè´¹è€…</strong></h3><figure class=\"highlight go\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br><span class=\"line\">31</span><br><span class=\"line\">32</span><br><span class=\"line\">33</span><br><span class=\"line\">34</span><br><span class=\"line\">35</span><br><span class=\"line\">36</span><br><span class=\"line\">37</span><br><span class=\"line\">38</span><br><span class=\"line\">39</span><br><span class=\"line\">40</span><br><span class=\"line\">41</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"function\"><span class=\"keyword\">func</span> <span class=\"title\">TestConsumer</span><span class=\"params\">(t *testing.T)</span></span> &#123;</span><br><span class=\"line\">\tcfg := sarama.NewConfig()</span><br><span class=\"line\">\t<span class=\"comment\">// è®¾ç½®åˆå§‹æ¶ˆè´¹åç§»é‡ï¼Œå¦‚æœæ²¡æœ‰å·²æäº¤çš„offsetæ•°æ®ï¼Œåˆ™é»˜è®¤æ˜¯ä¸‹ä¸€ä¸ªæ¶ˆæ¯çš„ä½ç½®</span></span><br><span class=\"line\">\t<span class=\"comment\">//cfg.Consumer.Offsets.Initial = sarama.OffsetOldest</span></span><br><span class=\"line\">\tcg, err := sarama.NewConsumerGroup([]<span class=\"type\">string</span>&#123;<span class=\"string\">&quot;localhost:9094&quot;</span>&#125;, <span class=\"string\">&quot;test_id&quot;</span>, cfg)</span><br><span class=\"line\">\trequire.NoError(t, err)</span><br><span class=\"line\">\t<span class=\"comment\">// å®šæ—¶ç»“æŸ</span></span><br><span class=\"line\">\tctx, cancel := context.WithTimeout(context.Background(), time.Second*<span class=\"number\">10</span>)</span><br><span class=\"line\">\t<span class=\"keyword\">defer</span> cancel()</span><br><span class=\"line\">\terr = cg.Consume(ctx, []<span class=\"type\">string</span>&#123;<span class=\"string\">&quot;test_topic&quot;</span>&#125;, &amp;ConsumerHandler&#123;&#125;)</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"keyword\">type</span> ConsumerHandler <span class=\"keyword\">struct</span> &#123;</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"function\"><span class=\"keyword\">func</span> <span class=\"params\">(c ConsumerHandler)</span></span> Setup(session sarama.ConsumerGroupSession) <span class=\"type\">error</span> &#123;</span><br><span class=\"line\">\tfmt.Println(<span class=\"string\">&quot;this is setup&quot;</span>)</span><br><span class=\"line\">\t<span class=\"comment\">// é‡ç½®åç§»é‡</span></span><br><span class=\"line\">\t<span class=\"comment\">//partitions := session.Claims()[&quot;test_topic&quot;]</span></span><br><span class=\"line\">\t<span class=\"comment\">//for _, v := range partitions &#123;</span></span><br><span class=\"line\">\t<span class=\"comment\">//\tsession.ResetOffset(&quot;test_topic&quot;, v, sarama.OffsetOldest, &quot;&quot;)</span></span><br><span class=\"line\">\t<span class=\"comment\">//&#125;</span></span><br><span class=\"line\">\t<span class=\"keyword\">return</span> <span class=\"literal\">nil</span></span><br><span class=\"line\">&#125;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"function\"><span class=\"keyword\">func</span> <span class=\"params\">(c ConsumerHandler)</span></span> Cleanup(session sarama.ConsumerGroupSession) <span class=\"type\">error</span> &#123;</span><br><span class=\"line\">\tfmt.Println(<span class=\"string\">&quot;this is cleanup&quot;</span>)</span><br><span class=\"line\">\t<span class=\"keyword\">return</span> <span class=\"literal\">nil</span></span><br><span class=\"line\">&#125;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"function\"><span class=\"keyword\">func</span> <span class=\"params\">(c ConsumerHandler)</span></span> ConsumeClaim(session sarama.ConsumerGroupSession, claim sarama.ConsumerGroupClaim) <span class=\"type\">error</span> &#123;</span><br><span class=\"line\">\t<span class=\"comment\">// å…³é”®å®ç°</span></span><br><span class=\"line\">\tmsgCh := claim.Messages()</span><br><span class=\"line\">\t<span class=\"keyword\">for</span> msg := <span class=\"keyword\">range</span> msgCh &#123;</span><br><span class=\"line\">\t\tfmt.Println(<span class=\"type\">string</span>(msg.Value))</span><br><span class=\"line\">\t\t<span class=\"comment\">// æ ‡è®°æ¶ˆè´¹æˆåŠŸï¼Œç”¨äºç§»åŠ¨offset</span></span><br><span class=\"line\">\t\t<span class=\"comment\">// æœåŠ¡ç«¯åªä¼šæäº¤å¸¦æœ‰æ ‡è®°çš„æ¶ˆæ¯ï¼Œä»£è¡¨è¯¥æ¶ˆæ¯è¢«æˆåŠŸæ¶ˆè´¹</span></span><br><span class=\"line\">\t\tsession.MarkMessage(msg, <span class=\"string\">&quot;&quot;</span>)</span><br><span class=\"line\">\t&#125;</span><br><span class=\"line\">\t<span class=\"keyword\">return</span> <span class=\"literal\">nil</span></span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n\n<ul>\n<li>åˆå§‹åŒ–ä¸€ä¸ª<strong>æ¶ˆè´¹è€…ç»„</strong></li>\n<li>è°ƒç”¨æ¶ˆè´¹è€…ç»„çš„<strong>Consume</strong>æ–¹æ³•</li>\n<li>ä¸º<strong>Consume</strong>æ–¹æ³•ä¼ å…¥ä¸€ä¸ª<strong>ConsumerGroupHandleræ¥å£</strong><ul>\n<li>å‘Consumeæ–¹æ³•ä¸­ä¼ å…¥ä¸€ä¸ªå¸¦æœ‰å®šæ—¶å™¨æˆ–Cancelçš„Contextï¼Œå¯ä»¥æ§åˆ¶æ¶ˆè´¹è€…é€€å‡º</li>\n</ul>\n</li>\n</ul>\n<p>ConsumerGroupHandleræ¥å£éœ€è¦å®ç°ä¸‰ä¸ªæ–¹æ³•ï¼š</p>\n<ul>\n<li>Setup</li>\n<li>Cleanup</li>\n<li>ConsumeClaim</li>\n</ul>\n<p>å…¶ä¸­æ¶ˆè´¹ç»„å¯¹æ¶ˆæ¯è¿›è¡Œæ¶ˆè´¹çš„é€»è¾‘åœ¨ConsumClaimæ–¹æ³•ä¸­å®ç°ï¼š</p>\n<p><img src=\"https://raw.githubusercontent.com/lyydsheep/pic/main/202411261307125.png\" alt=\"image-20241126130732077\"></p>\n<p>ç”±äºConsumeæ–¹æ³•éœ€è¦çš„æ˜¯ä¸€ä¸ªæ¥å£ï¼Œé‚£ä¹ˆæˆ‘ä»¬å¯ä»¥åŸºäºç±»å‹å®šä¹‰ã€ç»“æ„ä½“ç­‰æ–¹å¼èŠ±å¼å®ç°ConsumeClaimæ–¹æ³•ï¼Œä»¥è¾¾åˆ°ä¸€äº›å·§å¦™çš„ä½œç”¨</p>\n<h3 id=\"è‡ªå®šåç§»é‡æ¶ˆè´¹\"><a href=\"#è‡ªå®šåç§»é‡æ¶ˆè´¹\" class=\"headerlink\" title=\"è‡ªå®šåç§»é‡æ¶ˆè´¹\"></a>è‡ªå®šåç§»é‡æ¶ˆè´¹</h3><p>saramaä¸­æä¾›äº†ä¸¤ä¸ªè®¾ç½®åç§»é‡çš„æ–¹æ³•ï¼š</p>\n<ul>\n<li><p>è®¾ç½®<code>cfg.Consumer.Offsets.Initial</code>å­—æ®µ</p>\n<ul>\n<li><pre><code class=\"go\">cfg := sarama.NewConfig()\n// è®¾ç½®åˆå§‹æ¶ˆè´¹åç§»é‡ï¼Œå¦‚æœæ²¡æœ‰å·²æäº¤çš„offsetæ•°æ®ï¼Œåˆ™é»˜è®¤æ˜¯ä¸‹ä¸€ä¸ªæ¶ˆæ¯çš„ä½ç½®\ncfg.Consumer.Offsets.Initial = sarama.OffsetOldest\n<figure class=\"highlight plaintext\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"></span><br><span class=\"line\">- è°ƒç”¨`session.ResetOffset()`æ–¹æ³•</span><br><span class=\"line\"></span><br><span class=\"line\">  - ```go</span><br><span class=\"line\">    // é‡ç½®åç§»é‡</span><br><span class=\"line\">    partitions := session.Claims()[&quot;test_topic&quot;]</span><br><span class=\"line\">    for _, v := range partitions &#123;</span><br><span class=\"line\">    \tsession.ResetOffset(&quot;test_topic&quot;, v, sarama.OffsetOldest, &quot;&quot;)</span><br><span class=\"line\">    &#125;</span><br></pre></td></tr></table></figure>\n</code></pre>\n</li>\n</ul>\n</li>\n</ul>\n<p>ResetOffsetæ–¹æ³•é€šå¸¸åœ¨Setupå‡½æ•°ä¸­è°ƒç”¨</p>\n<p>å€¼å¾—æ³¨æ„çš„æ˜¯ï¼Œåªæœ‰ä¸Šè¿°ä¸¤ä¸ªæ–¹å¼åŒæ—¶æ‰§è¡Œï¼Œæ¶ˆè´¹è€…ç»„æ‰ä¼šä»å†å²ç¬¬ä¸€æ¡æ¶ˆæ¯è¿›è¡Œæ¶ˆè´¹ã€‚æœ€å¥½çš„æ–¹å¼æ˜¯èµ°ç¦»çº¿æ¸ é“ï¼Œæ“ä½œkafkaé›†ç¾¤å»é‡ç½®å¯¹åº”çš„åç§»é‡ã€‚</p>\n<h3 id=\"å¼‚æ­¥æ¶ˆè´¹ï¼Œæ‰¹é‡æäº¤\"><a href=\"#å¼‚æ­¥æ¶ˆè´¹ï¼Œæ‰¹é‡æäº¤\" class=\"headerlink\" title=\"å¼‚æ­¥æ¶ˆè´¹ï¼Œæ‰¹é‡æäº¤\"></a>å¼‚æ­¥æ¶ˆè´¹ï¼Œæ‰¹é‡æäº¤</h3><figure class=\"highlight go\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br><span class=\"line\">31</span><br><span class=\"line\">32</span><br><span class=\"line\">33</span><br><span class=\"line\">34</span><br><span class=\"line\">35</span><br><span class=\"line\">36</span><br><span class=\"line\">37</span><br><span class=\"line\">38</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"function\"><span class=\"keyword\">func</span> <span class=\"params\">(h *Handler[T])</span></span> ConsumeClaim(session sarama.ConsumerGroupSession, claim sarama.ConsumerGroupClaim) <span class=\"type\">error</span> &#123;</span><br><span class=\"line\">\tmsgCh := claim.Messages()</span><br><span class=\"line\">\t<span class=\"keyword\">for</span> &#123;</span><br><span class=\"line\">\t\tctx, cancel := context.WithTimeout(context.Background(), time.Second*<span class=\"number\">2</span>)</span><br><span class=\"line\">\t\tdone := <span class=\"literal\">false</span></span><br><span class=\"line\">\t\tmsgs := <span class=\"built_in\">make</span>([]*sarama.ConsumerMessage, <span class=\"number\">0</span>, <span class=\"number\">10</span>)</span><br><span class=\"line\">\t\tevts := <span class=\"built_in\">make</span>([]T, <span class=\"number\">0</span>, <span class=\"number\">10</span>)</span><br><span class=\"line\">\t\t<span class=\"keyword\">for</span> i := <span class=\"number\">0</span>; i &lt; h.batch &amp;&amp; !done; i++ &#123;</span><br><span class=\"line\">\t\t\t<span class=\"keyword\">select</span> &#123;</span><br><span class=\"line\">\t\t\t<span class=\"keyword\">case</span> msg, ok := &lt;-msgCh:</span><br><span class=\"line\">\t\t\t\t<span class=\"keyword\">if</span> !ok &#123;</span><br><span class=\"line\">\t\t\t\t\t<span class=\"comment\">// msgChè¢«å…³é—­</span></span><br><span class=\"line\">\t\t\t\t\tcancel()</span><br><span class=\"line\">\t\t\t\t\t<span class=\"keyword\">return</span> <span class=\"literal\">nil</span></span><br><span class=\"line\">\t\t\t\t&#125;</span><br><span class=\"line\">\t\t\t\t<span class=\"keyword\">var</span> t T</span><br><span class=\"line\">\t\t\t\terr := json.Unmarshal(msg.Value, &amp;t)</span><br><span class=\"line\">\t\t\t\t<span class=\"keyword\">if</span> err != <span class=\"literal\">nil</span> &#123;</span><br><span class=\"line\">\t\t\t\t\th.l.Error(<span class=\"string\">&quot;fail to unmarshal&quot;</span>)</span><br><span class=\"line\">\t\t\t\t\t<span class=\"keyword\">continue</span></span><br><span class=\"line\">\t\t\t\t&#125;</span><br><span class=\"line\">\t\t\t\tmsgs = <span class=\"built_in\">append</span>(msgs, msg)</span><br><span class=\"line\">\t\t\t\tevts = <span class=\"built_in\">append</span>(evts, t)</span><br><span class=\"line\">\t\t\t<span class=\"keyword\">case</span> &lt;-ctx.Done():</span><br><span class=\"line\">\t\t\t\tdone = <span class=\"literal\">true</span></span><br><span class=\"line\">\t\t\t&#125;</span><br><span class=\"line\">\t\t&#125;</span><br><span class=\"line\">\t\tcancel()</span><br><span class=\"line\">\t\terr := h.fn(msgs, evts)</span><br><span class=\"line\">\t\t<span class=\"keyword\">if</span> err != <span class=\"literal\">nil</span> &#123;</span><br><span class=\"line\">\t\t\t<span class=\"keyword\">return</span> err</span><br><span class=\"line\">\t\t&#125;</span><br><span class=\"line\">\t\t<span class=\"keyword\">for</span> i := <span class=\"keyword\">range</span> msgs &#123;</span><br><span class=\"line\">\t\t\tsession.MarkMessage(msgs[i], <span class=\"string\">&quot;&quot;</span>)</span><br><span class=\"line\">\t\t&#125;</span><br><span class=\"line\">\t&#125;</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"></span><br></pre></td></tr></table></figure>\n\n<p><strong>å¼‚æ­¥æ¶ˆè´¹ä¸€æ‰¹ï¼Œæäº¤ä¸€æ‰¹</strong>ã€‚</p>\n<p>å…¶ä¸­æäº¤ä¸€æ‰¹åœ¨å®ç°è¿‡ç¨‹ä¸­åªéœ€è¦<strong>å°†æœ€åä¸€ä¸ªæ¶ˆæ¯æ ‡è®°</strong>å³å¯</p>\n<p>åœ¨<code>select case</code>ä¸­æœ‰ä¸¤ä¸ªåˆ†æ”¯ï¼Œä¸€ä¸ªåˆ†æ”¯æ˜¯ctx.Doneï¼Œå¯ä»¥é˜²æ­¢å› é•¿æ—¶é—´å‡‘ä¸é½ä¸€ä¸ªbatchçš„æ¶ˆæ¯ï¼Œè€Œå¯¼è‡´çš„é˜»å¡ç°è±¡ï¼›å¦ä¸€ä¸ªåˆ†æ”¯è°ƒç”¨<code>errgroup.Go()</code>æ–¹æ³•å¼‚æ­¥å¤„ç†kafkaä¸­çš„æ¶ˆæ¯</p>\n<h2 id=\"æ”¹é€ ç»Ÿè®¡é˜…è¯»è®¡æ•°\"><a href=\"#æ”¹é€ ç»Ÿè®¡é˜…è¯»è®¡æ•°\" class=\"headerlink\" title=\"æ”¹é€ ç»Ÿè®¡é˜…è¯»è®¡æ•°\"></a>æ”¹é€ ç»Ÿè®¡é˜…è¯»è®¡æ•°</h2><p><strong>DDDä¸­çš„ä¸€ä¸ªé‡è¦æ¦‚å¿µï¼šé¢†åŸŸäº‹ä»¶</strong></p>\n<p>å½“æˆ‘ä»¬åœ¨å‘é€æ¶ˆæ¯æ—¶ï¼Œéœ€è¦å‘é€çš„æ˜¯ä¸€ä¸ª<strong>äº‹ä»¶</strong>ï¼Œå³æŸä¸ªç”¨æˆ·é˜…è¯»äº†æŸç¯‡æ–‡ç« çš„äº‹ä»¶ã€‚é¡¹ç›®ç»“æ„ï¼š</p>\n<p><img src=\"https://raw.githubusercontent.com/lyydsheep/pic/main/202411271856428.png\" alt=\"image-20241127185624318\"></p>\n<h3 id=\"å°è£…æ‰¹é‡æ¶ˆè´¹\"><a href=\"#å°è£…æ‰¹é‡æ¶ˆè´¹\" class=\"headerlink\" title=\"å°è£…æ‰¹é‡æ¶ˆè´¹\"></a>å°è£…æ‰¹é‡æ¶ˆè´¹</h3><p>å‰æ–‡æåŠ<code>cg.consumer()</code>æ–¹æ³•ç¬¬ä¸‰ä¸ªå‚æ•°æ˜¯ä¸€ä¸ª<code>ConsumeGroupHandler</code>æ¥å£å‚æ•°ï¼Œæˆ‘ä»¬å¯ä»¥å°è£…ä¸€ä¸ªHandlerç»“æ„ä½“å®ç°è¿™ä¸ªæ¥å£ï¼Œè¿™ä¸ªç»“æ„ä½“åˆå§‹åŒ–æ—¶æ¥å—ä¸šåŠ¡æ–¹çš„æ¶ˆè´¹å‡½æ•°ï¼Œå¹¶åœ¨<code>ConsumeClaim()</code>æ–¹æ³•ä¸­è°ƒç”¨ä¸‹æ¸¸çš„æ¶ˆè´¹å‡½æ•°å¯¹æ¶ˆæ¯è¿›è¡Œå¤„ç†ã€‚å…·ä½“ï¼ˆæ‰¹é‡æ¶ˆè´¹ï¼‰å°è£…ä¸‹ï¼š</p>\n<figure class=\"highlight go\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br><span class=\"line\">31</span><br><span class=\"line\">32</span><br><span class=\"line\">33</span><br><span class=\"line\">34</span><br><span class=\"line\">35</span><br><span class=\"line\">36</span><br><span class=\"line\">37</span><br><span class=\"line\">38</span><br><span class=\"line\">39</span><br><span class=\"line\">40</span><br><span class=\"line\">41</span><br><span class=\"line\">42</span><br><span class=\"line\">43</span><br><span class=\"line\">44</span><br><span class=\"line\">45</span><br><span class=\"line\">46</span><br><span class=\"line\">47</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">type</span> Handler[T any] <span class=\"keyword\">struct</span> &#123;</span><br><span class=\"line\">\tl     *zap.Logger</span><br><span class=\"line\">\tfn    <span class=\"function\"><span class=\"keyword\">func</span><span class=\"params\">(msgs []*sarama.ConsumerMessage, evts []T)</span></span> <span class=\"type\">error</span></span><br><span class=\"line\">\tbatch <span class=\"type\">int</span></span><br><span class=\"line\">&#125;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"function\"><span class=\"keyword\">func</span> <span class=\"params\">(h *Handler[T])</span></span> ConsumeClaim(session sarama.ConsumerGroupSession, claim sarama.ConsumerGroupClaim) <span class=\"type\">error</span> &#123;</span><br><span class=\"line\">\tmsgCh := claim.Messages()</span><br><span class=\"line\">\t<span class=\"keyword\">for</span> &#123;</span><br><span class=\"line\">\t\tctx, cancel := context.WithTimeout(context.Background(), time.Second)</span><br><span class=\"line\">\t\tmsgs := <span class=\"built_in\">make</span>([]*sarama.ConsumerMessage, <span class=\"number\">0</span>, h.batch)</span><br><span class=\"line\">\t\tevts := <span class=\"built_in\">make</span>([]T, <span class=\"number\">0</span>, h.batch)</span><br><span class=\"line\">\t\tdone := <span class=\"literal\">false</span></span><br><span class=\"line\">\t\t<span class=\"keyword\">for</span> i := <span class=\"number\">0</span>; i &lt; h.batch &amp;&amp; !done; i++ &#123;</span><br><span class=\"line\">\t\t\t<span class=\"keyword\">select</span> &#123;</span><br><span class=\"line\">\t\t\t<span class=\"keyword\">case</span> msg, ok := &lt;-msgCh:</span><br><span class=\"line\">\t\t\t\t<span class=\"keyword\">if</span> !ok &#123;</span><br><span class=\"line\">\t\t\t\t\t<span class=\"comment\">// channelå…³é—­</span></span><br><span class=\"line\">\t\t\t\t\tcancel()</span><br><span class=\"line\">\t\t\t\t\t<span class=\"keyword\">return</span> <span class=\"literal\">nil</span></span><br><span class=\"line\">\t\t\t\t&#125;</span><br><span class=\"line\">\t\t\t\t<span class=\"keyword\">var</span> t T</span><br><span class=\"line\">\t\t\t\terr := json.Unmarshal(msg.Value, &amp;t)</span><br><span class=\"line\">\t\t\t\t<span class=\"keyword\">if</span> err != <span class=\"literal\">nil</span> &#123;</span><br><span class=\"line\">\t\t\t\t\t<span class=\"comment\">// è®°å½•æ—¥å¿—</span></span><br><span class=\"line\">\t\t\t\t\t<span class=\"keyword\">continue</span></span><br><span class=\"line\">\t\t\t\t&#125;</span><br><span class=\"line\">\t\t\t\tmsgs = <span class=\"built_in\">append</span>(msgs, msg)</span><br><span class=\"line\">\t\t\t\tevts = <span class=\"built_in\">append</span>(evts, t)</span><br><span class=\"line\">\t\t\t<span class=\"keyword\">case</span> &lt;-ctx.Done():</span><br><span class=\"line\">\t\t\t\t<span class=\"comment\">// è¶…æ—¶</span></span><br><span class=\"line\">\t\t\t\tdone = <span class=\"literal\">true</span></span><br><span class=\"line\">\t\t\t&#125;</span><br><span class=\"line\">\t\t&#125;</span><br><span class=\"line\">\t\tcancel()</span><br><span class=\"line\">\t\terr := h.fn(msgs, evts)</span><br><span class=\"line\">\t\t<span class=\"keyword\">if</span> err != <span class=\"literal\">nil</span> &#123;</span><br><span class=\"line\">\t\t\t<span class=\"comment\">// è®°å½•æ—¥å¿—</span></span><br><span class=\"line\">\t\t\t<span class=\"comment\">// è®°å½•æ•´ä¸ªæ‰¹æ¬¡</span></span><br><span class=\"line\">\t\t\t<span class=\"comment\">// ç»§ç»­æ¶ˆè´¹</span></span><br><span class=\"line\">\t\t&#125;</span><br><span class=\"line\">\t\t<span class=\"comment\">// æ ‡è®°æ¶ˆæ¯</span></span><br><span class=\"line\">\t\t<span class=\"keyword\">for</span> i := <span class=\"keyword\">range</span> msgs &#123;</span><br><span class=\"line\">\t\t\tsession.MarkMessage(msgs[i], <span class=\"string\">&quot;&quot;</span>)</span><br><span class=\"line\">\t\t&#125;</span><br><span class=\"line\">\t&#125;</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n\n<p>ä¸Šè¿°ä»£ç å®ç°äº†å¯¹æ¶ˆè´¹è€…æ‰¹é‡æ¶ˆè´¹çš„å°è£…ï¼Œå¯ä»¥æé«˜ç³»ç»Ÿå¤„ç†æ¶ˆæ¯çš„æ€§èƒ½ã€‚è¿™æ˜¯å› ä¸ºæ‰¹é‡å¤„ç†å¯ä»¥å°†DAOå±‚é¢10æ¬¡ï¼ˆå‡å®šbatchä¸º10ï¼‰äº‹åŠ¡å¤„ç†ç¼©å‡è‡³åœ¨ä¸€æ¬¡äº‹åŠ¡ä¸­å¤„ç†åæ¬¡æ“ä½œã€‚ä¸¤ä¸ªæ³¨æ„ç‚¹ï¼š</p>\n<ul>\n<li>æ³¨æ„è¶…æ—¶</li>\n<li>è°ƒç”¨ä¸‹æ¸¸</li>\n</ul>\n<h3 id=\"ç»„è£…æ¶ˆè´¹è€…\"><a href=\"#ç»„è£…æ¶ˆè´¹è€…\" class=\"headerlink\" title=\"ç»„è£…æ¶ˆè´¹è€…\"></a>ç»„è£…æ¶ˆè´¹è€…</h3><p>åœ¨ä¾èµ–æ³¨å…¥çš„è¿‡ç¨‹ä¸­ï¼Œæ¶ˆè´¹è€…ç±»ä¼¼äºWebã€GRpcæœåŠ¡å™¨çš„ä¸œè¥¿ï¼Œéœ€è¦å¯åŠ¨ã€‚å› æ­¤å¼•å…¥ä¸€ä¸ªAppç»“æ„ä½“ï¼Œå¯¹Webå’Œæ¶ˆè´¹è€…è¿›è¡Œç»„åˆ</p>\n<figure class=\"highlight go\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\">// app.go</span></span><br><span class=\"line\"><span class=\"keyword\">type</span> App <span class=\"keyword\">struct</span> &#123;</span><br><span class=\"line\">    Web *gin.Engine</span><br><span class=\"line\">    Consumers []events.Consumer</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\">// ioc/kafka.go</span></span><br><span class=\"line\"><span class=\"comment\">// ç”±äºGoæ²¡æœ‰åŠ¨æ€ç±»å‹ï¼Œå› æ­¤æ¯ä¸€ä¸ªæ¶ˆè´¹è€…éƒ½éœ€è¦è¿›è¡Œæ³¨å†Œæ“ä½œ</span></span><br><span class=\"line\"><span class=\"function\"><span class=\"keyword\">func</span> <span class=\"title\">NewConsumers</span><span class=\"params\">(c1 *articles.InteractiveReadEventConsumer)</span></span> []events.Consumer &#123;</span><br><span class=\"line\">    <span class=\"keyword\">return</span> []events.Consumer&#123;c1&#125;</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\">// wire.go</span></span><br><span class=\"line\"><span class=\"comment\">// ç»„åˆç»“æ„ä½“æ‰€æœ‰çš„å­—æ®µï¼Œ*è¡¨ç¤ºæ‰€æœ‰</span></span><br><span class=\"line\">wire.Struct(<span class=\"built_in\">new</span>(App), <span class=\"string\">&quot;*&quot;</span>)</span><br></pre></td></tr></table></figure>\n\n<h3 id=\"æ‰¹é‡ç”Ÿäº§\"><a href=\"#æ‰¹é‡ç”Ÿäº§\" class=\"headerlink\" title=\"æ‰¹é‡ç”Ÿäº§\"></a>æ‰¹é‡ç”Ÿäº§</h3><p>svcé€šè¿‡channelå°†æ¶ˆæ¯å‘é€ç»™ç”Ÿäº§è€…ï¼Œå½“ç”Ÿäº§è€…ç§¯ç´¯è¶³å¤Ÿå¤šçš„æ¶ˆæ¯åï¼Œå°±å°†è¿™ä¸€æ‰¹æ¶ˆæ¯å‘é€ç»™Kafka</p>\n<figure class=\"highlight go\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br><span class=\"line\">31</span><br><span class=\"line\">32</span><br><span class=\"line\">33</span><br><span class=\"line\">34</span><br><span class=\"line\">35</span><br><span class=\"line\">36</span><br><span class=\"line\">37</span><br><span class=\"line\">38</span><br><span class=\"line\">39</span><br><span class=\"line\">40</span><br><span class=\"line\">41</span><br><span class=\"line\">42</span><br><span class=\"line\">43</span><br><span class=\"line\">44</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"function\"><span class=\"keyword\">func</span> <span class=\"title\">NewBasicInteractService</span><span class=\"params\">(repo repository.InteractRepository, producer events.Producer)</span></span> *BasicInteractService &#123;</span><br><span class=\"line\">\tch := <span class=\"built_in\">make</span>(<span class=\"keyword\">chan</span> events.ReadEvent, <span class=\"number\">10</span>)</span><br><span class=\"line\">    <span class=\"comment\">// å‡‘è¶³ä¸€æ‰¹æ¶ˆæ¯</span></span><br><span class=\"line\">\t<span class=\"keyword\">go</span> <span class=\"function\"><span class=\"keyword\">func</span><span class=\"params\">()</span></span> &#123;</span><br><span class=\"line\">\t\t<span class=\"keyword\">for</span> &#123;</span><br><span class=\"line\">\t\t\tctx, cancel := context.WithTimeout(context.Background(), time.Second)</span><br><span class=\"line\">\t\t\tevts := <span class=\"built_in\">make</span>([]events.ReadEvent, <span class=\"number\">0</span>, <span class=\"number\">10</span>)</span><br><span class=\"line\">\t\t\tdone := <span class=\"literal\">false</span></span><br><span class=\"line\">\t\t\t<span class=\"keyword\">for</span> i := <span class=\"number\">0</span>; i &lt; <span class=\"number\">10</span> &amp;&amp; !done; i++ &#123;</span><br><span class=\"line\">\t\t\t\t<span class=\"keyword\">select</span> &#123;</span><br><span class=\"line\">\t\t\t\t<span class=\"keyword\">case</span> evt, ok := &lt;-ch:</span><br><span class=\"line\">\t\t\t\t\t<span class=\"keyword\">if</span> !ok &#123;</span><br><span class=\"line\">\t\t\t\t\t\tcancel()</span><br><span class=\"line\">\t\t\t\t\t\t<span class=\"keyword\">break</span></span><br><span class=\"line\">\t\t\t\t\t&#125;</span><br><span class=\"line\">\t\t\t\t\tevts = <span class=\"built_in\">append</span>(evts, evt)</span><br><span class=\"line\">\t\t\t\t<span class=\"keyword\">case</span> &lt;-ctx.Done():</span><br><span class=\"line\">\t\t\t\t\tdone = <span class=\"literal\">true</span></span><br><span class=\"line\">\t\t\t\t&#125;</span><br><span class=\"line\">\t\t\t&#125;</span><br><span class=\"line\">\t\t\tcancel()</span><br><span class=\"line\">\t\t\terr := producer.ProduceReadEventV1(ctx, evts)</span><br><span class=\"line\">\t\t\t<span class=\"keyword\">if</span> err != <span class=\"literal\">nil</span> &#123;</span><br><span class=\"line\">\t\t\t\t<span class=\"comment\">// æ—¥å¿—</span></span><br><span class=\"line\">\t\t\t&#125;</span><br><span class=\"line\">\t\t&#125;</span><br><span class=\"line\">\t&#125;()</span><br><span class=\"line\">\t<span class=\"keyword\">return</span> &amp;BasicInteractService&#123;repo: repo, producer: producer, ch: ch&#125;</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\">// ç§¯ç´¯æ¶ˆæ¯</span></span><br><span class=\"line\"><span class=\"function\"><span class=\"keyword\">func</span> <span class=\"params\">(svc *BasicInteractService)</span></span> IncReadCnt(ctx context.Context, biz <span class=\"type\">string</span>, bizId, uid <span class=\"type\">int64</span>) <span class=\"type\">error</span> &#123;</span><br><span class=\"line\">\t_, err := svc.Get(ctx, biz, bizId, uid)</span><br><span class=\"line\">\t<span class=\"keyword\">go</span> <span class=\"function\"><span class=\"keyword\">func</span><span class=\"params\">()</span></span> &#123;</span><br><span class=\"line\">\t\t<span class=\"keyword\">if</span> err == <span class=\"literal\">nil</span> &#123;</span><br><span class=\"line\">\t\t\tsvc.ch &lt;- events.ReadEvent&#123;</span><br><span class=\"line\">\t\t\t\tUid: uid,</span><br><span class=\"line\">\t\t\t\tAid: bizId,</span><br><span class=\"line\">\t\t\t&#125;</span><br><span class=\"line\">\t\t&#125;</span><br><span class=\"line\">\t&#125;()</span><br><span class=\"line\">\t<span class=\"keyword\">return</span> err</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n\n"},{"publish":false,"_content":"\n\n\n# syncã€context\n\n## Sync\n\n### sync.WaitGroup\n\nåœ¨Goè¯­è¨€ä¸­å¯ä»¥ä½¿ç”¨`sync.WaitGroup`å®ç°å¹¶å‘ä»»åŠ¡çš„åŒæ­¥ä»¥åŠåç¨‹ç­‰å¾…\n\n`sync.WaitGroup`æ˜¯ä¸€ä¸ªç»“æ„ä½“ï¼Œå†…ç½®äº†ä¸€ä¸ªè®¡æ•°å™¨ï¼Œæœ‰ä¸‰ä¸ªæ–¹æ³•\n\n- Add(delta int)ï¼Œè®¡æ•°å™¨å¢åŠ `delta`\n- Done()ï¼Œè®¡æ•°å™¨`-1`\n- Wait()ï¼Œ**é˜»å¡å½“å‰åç¨‹çš„è¿è¡Œï¼Œç›´è‡³è®¡æ•°å™¨ä¸º0**\n\nğŸŒ°ï¼š\n\n```go\nvar wg sync.WaitGroup\n\nfunc main() {\n\twg.Add(10)\n\tfor range 10 {\n\t\tgo func() {\n\t\t\tdefer wg.Done()\n\t\t\tfmt.Println(\"hello world\")\n\t\t}()\n\t}\n\twg.Wait()\n\tfmt.Println(\"end!\")\n}\n```\n\nâš ï¸ï¼š`sync.WaitGroup`å¯¹è±¡çš„è®¡æ•°å™¨ä¸èƒ½ä¸ºè´Ÿæ•°ï¼Œå½“è°ƒç”¨Done()æ–¹æ³•åï¼Œå¿…é¡»ç¡®ä¿è®¡æ•°å™¨å€¼å¤§äºç­‰äºé›¶ï¼Œå¦åˆ™ä¼š`panic`\n\n### sync.Once\n\nç¨‹åºä¸­æœ‰ä¸€äº›é€»è¾‘åªéœ€è¦æ‰§è¡Œä¸€æ¬¡ï¼Œæœ€å…¸å‹çš„å°±æ˜¯é¡¹ç›®ä¸­çš„é…ç½®æ–‡ä»¶ï¼Œé€šå¸¸çš„åšæ³•æœ‰ä¸¤ç§ï¼Œä¸€æ˜¯åœ¨é¡¹ç›®å¯åŠ¨æ—¶å°±å°†ä»£ç æ‰§è¡Œå¹¶å°†ç»“æœä¿å­˜åœ¨å†…å­˜ä¸­ï¼ŒäºŒæ˜¯éœ€è¦ä½¿ç”¨æ—¶å†æ‰§è¡Œç›¸åº”çš„é€»è¾‘ä»£ç ï¼Œè€Œ`sync.Once`å°±å±äºåè€…\n\n`sync.Once`å¯ä»¥åœ¨ä»£ç çš„ä»»æ„ä½ç½®åˆå§‹åŒ–å’Œè°ƒç”¨ï¼Œå¹¶ä¸”çº¿ç¨‹å®‰å…¨ã€‚`sync.Once`æœ€å¤§çš„ç”¨å¤„å°±æ˜¯**å»¶è¿Ÿåˆå§‹åŒ–ï¼ˆè°ƒç”¨ï¼‰å¹¶åªåˆå§‹åŒ–ä¸€æ¬¡**ï¼Œé¿å…è¿‡æ—©æ‰§è¡Œä»£ç é€»è¾‘å¯¼è‡´å†…å­˜ç©ºé—´çš„æµªè´¹\n\nğŸŒ°ï¼š\n\n```go\nvar once sync.Once\nvar instance *Config\nvar i = 0\n\ntype Config struct{}\n\nfunc Init() {\n\tonce.Do(func() {\n\t\tinstance = &Config{}\n\t\tfmt.Println(i)\n\t\ti++\n\t})\n}\n\nfunc main() {\n\tfor range 10 {\n\t\tInit()\n\t}\n}\n```\n\nç”±ä¾‹å­å¯çŸ¥ï¼Œè¢«`once.Do()`åŒ…è£¹çš„å‡½æ•°åªä¼šæ‰§è¡Œä¸€æ¬¡ï¼Œå³ä½¿è°ƒç”¨å¤šæ¬¡`Init()`å‡½æ•°\n\n#### ä¸init()çš„åŒºåˆ«\n\n`init()`æ–¹æ³•å’Œ`sync.Once`éƒ½å¯ä»¥ç”¨æ¥è¿›è¡Œä¸€äº›åˆå§‹åŒ–æ“ä½œï¼Œ**äºŒè€…çš„åŒºåˆ«ä¸»è¦åœ¨äºè¢«è°ƒç”¨ï¼ˆåˆå§‹åŒ–ï¼‰çš„æ—¶æœº**\n\n`init()`æ–¹æ³•æ˜¯åœ¨å…¶æ‰€åœ¨çš„packageè¢«é¦–æ¬¡åŠ è½½æ—¶æ‰§è¡Œçš„ï¼Œå¯ä»¥ç¡®ä¿åœ¨`main`å‡½æ•°ä¹‹å‰æ‰§è¡Œï¼Œé€‚ç”¨äºç¨‹åºå¯åŠ¨æ—¶çš„åˆå§‹åŒ–æ“ä½œ\n\n`sync.Once`å¯ä»¥åœ¨ä»£ç çš„ä»»æ„ä½ç½®è°ƒç”¨ï¼Œé€‚ç”¨äºåœ¨**å¹¶å‘ç¯å¢ƒä¸‹ç¡®ä¿æŸä¸ªé€»è¾‘åªæ‰§è¡Œä¸€æ¬¡**\n\n### sync.Map\n\nGoå†…ç½®çš„Mapä¸æ˜¯å¹¶å‘å®‰å…¨çš„ï¼Œåœ¨å¤šä¸ªgoroutineæ“ä½œæƒ…å†µä¸‹ï¼Œä¼šå‡ºç°æ„æƒ³ä¸åˆ°çš„ç»“æœã€‚æƒ³è¦å¹¶å‘å®‰å…¨åœ°ä½¿ç”¨Mapç»“æ„ï¼Œè¦ä¹ˆæ˜¯è¿›è¡ŒåŠ é”æ“ä½œï¼Œè¦ä¹ˆå°±æ˜¯ä½¿ç”¨`sync.Map`ç»“æ„\n\n`sync.Map`æœ‰å¦‚ä¸‹å¸¸ç”¨æ–¹æ³•\n\n- `Load()`ï¼šå†™å…¥ä¸€ä¸ªé”®å€¼å¯¹\n- `Store()`ï¼šè¯»å–ä¸€ä¸ªé”®å€¼å¯¹\n- `Range()`ï¼šéå†mapï¼Œç±»ä¼¼äºJSä¸­çš„`for each`\n- `Delete()`ï¼šåˆ é™¤æ“ä½œ\n- `LoadOrStore()`ï¼šè¯»å–æˆ–å­˜å‚¨æ•°æ®\n\nğŸŒ°ï¼š\n\n```go\nfunc main() {\n\tvar m sync.Map\n\tm.Store(\"name\", \"zhao\")\n\tm.Store(\"hello\", \"world\")\n\n\tv, ok := m.Load(\"hello\")\n\tif ok {\n\t\tfmt.Println(v)\n\t}\n\n\tm.Range(func(key, value any) bool {\n\t\tfmt.Printf(\"key is %v\tval is %v\\n\", key, value)\n\t\treturn true\n\t})\n\n\tv, ok = m.LoadOrStore(\"name\", \"yun\")\n\tif ok {\n\t\tfmt.Printf(\"name`s new val is %v\\n\", v)\n\t}\n\n\tm.Delete(\"name\")\n\tv, ok = m.Load(\"name\")\n\tif ok {\n\t\tfmt.Printf(\"name`s val is %v\\n\", v)\n\t}\n}\n\n```\n\n## Context\n\nç”¨äºå¹¶å‘æ§åˆ¶\n\nä¸Šä¸‹æ–‡çš„ä¿¡æ¯ä¼ é€’\n","source":"_posts/Sync.md","raw":"---\npublish: false\n---\n\n\n\n# syncã€context\n\n## Sync\n\n### sync.WaitGroup\n\nåœ¨Goè¯­è¨€ä¸­å¯ä»¥ä½¿ç”¨`sync.WaitGroup`å®ç°å¹¶å‘ä»»åŠ¡çš„åŒæ­¥ä»¥åŠåç¨‹ç­‰å¾…\n\n`sync.WaitGroup`æ˜¯ä¸€ä¸ªç»“æ„ä½“ï¼Œå†…ç½®äº†ä¸€ä¸ªè®¡æ•°å™¨ï¼Œæœ‰ä¸‰ä¸ªæ–¹æ³•\n\n- Add(delta int)ï¼Œè®¡æ•°å™¨å¢åŠ `delta`\n- Done()ï¼Œè®¡æ•°å™¨`-1`\n- Wait()ï¼Œ**é˜»å¡å½“å‰åç¨‹çš„è¿è¡Œï¼Œç›´è‡³è®¡æ•°å™¨ä¸º0**\n\nğŸŒ°ï¼š\n\n```go\nvar wg sync.WaitGroup\n\nfunc main() {\n\twg.Add(10)\n\tfor range 10 {\n\t\tgo func() {\n\t\t\tdefer wg.Done()\n\t\t\tfmt.Println(\"hello world\")\n\t\t}()\n\t}\n\twg.Wait()\n\tfmt.Println(\"end!\")\n}\n```\n\nâš ï¸ï¼š`sync.WaitGroup`å¯¹è±¡çš„è®¡æ•°å™¨ä¸èƒ½ä¸ºè´Ÿæ•°ï¼Œå½“è°ƒç”¨Done()æ–¹æ³•åï¼Œå¿…é¡»ç¡®ä¿è®¡æ•°å™¨å€¼å¤§äºç­‰äºé›¶ï¼Œå¦åˆ™ä¼š`panic`\n\n### sync.Once\n\nç¨‹åºä¸­æœ‰ä¸€äº›é€»è¾‘åªéœ€è¦æ‰§è¡Œä¸€æ¬¡ï¼Œæœ€å…¸å‹çš„å°±æ˜¯é¡¹ç›®ä¸­çš„é…ç½®æ–‡ä»¶ï¼Œé€šå¸¸çš„åšæ³•æœ‰ä¸¤ç§ï¼Œä¸€æ˜¯åœ¨é¡¹ç›®å¯åŠ¨æ—¶å°±å°†ä»£ç æ‰§è¡Œå¹¶å°†ç»“æœä¿å­˜åœ¨å†…å­˜ä¸­ï¼ŒäºŒæ˜¯éœ€è¦ä½¿ç”¨æ—¶å†æ‰§è¡Œç›¸åº”çš„é€»è¾‘ä»£ç ï¼Œè€Œ`sync.Once`å°±å±äºåè€…\n\n`sync.Once`å¯ä»¥åœ¨ä»£ç çš„ä»»æ„ä½ç½®åˆå§‹åŒ–å’Œè°ƒç”¨ï¼Œå¹¶ä¸”çº¿ç¨‹å®‰å…¨ã€‚`sync.Once`æœ€å¤§çš„ç”¨å¤„å°±æ˜¯**å»¶è¿Ÿåˆå§‹åŒ–ï¼ˆè°ƒç”¨ï¼‰å¹¶åªåˆå§‹åŒ–ä¸€æ¬¡**ï¼Œé¿å…è¿‡æ—©æ‰§è¡Œä»£ç é€»è¾‘å¯¼è‡´å†…å­˜ç©ºé—´çš„æµªè´¹\n\nğŸŒ°ï¼š\n\n```go\nvar once sync.Once\nvar instance *Config\nvar i = 0\n\ntype Config struct{}\n\nfunc Init() {\n\tonce.Do(func() {\n\t\tinstance = &Config{}\n\t\tfmt.Println(i)\n\t\ti++\n\t})\n}\n\nfunc main() {\n\tfor range 10 {\n\t\tInit()\n\t}\n}\n```\n\nç”±ä¾‹å­å¯çŸ¥ï¼Œè¢«`once.Do()`åŒ…è£¹çš„å‡½æ•°åªä¼šæ‰§è¡Œä¸€æ¬¡ï¼Œå³ä½¿è°ƒç”¨å¤šæ¬¡`Init()`å‡½æ•°\n\n#### ä¸init()çš„åŒºåˆ«\n\n`init()`æ–¹æ³•å’Œ`sync.Once`éƒ½å¯ä»¥ç”¨æ¥è¿›è¡Œä¸€äº›åˆå§‹åŒ–æ“ä½œï¼Œ**äºŒè€…çš„åŒºåˆ«ä¸»è¦åœ¨äºè¢«è°ƒç”¨ï¼ˆåˆå§‹åŒ–ï¼‰çš„æ—¶æœº**\n\n`init()`æ–¹æ³•æ˜¯åœ¨å…¶æ‰€åœ¨çš„packageè¢«é¦–æ¬¡åŠ è½½æ—¶æ‰§è¡Œçš„ï¼Œå¯ä»¥ç¡®ä¿åœ¨`main`å‡½æ•°ä¹‹å‰æ‰§è¡Œï¼Œé€‚ç”¨äºç¨‹åºå¯åŠ¨æ—¶çš„åˆå§‹åŒ–æ“ä½œ\n\n`sync.Once`å¯ä»¥åœ¨ä»£ç çš„ä»»æ„ä½ç½®è°ƒç”¨ï¼Œé€‚ç”¨äºåœ¨**å¹¶å‘ç¯å¢ƒä¸‹ç¡®ä¿æŸä¸ªé€»è¾‘åªæ‰§è¡Œä¸€æ¬¡**\n\n### sync.Map\n\nGoå†…ç½®çš„Mapä¸æ˜¯å¹¶å‘å®‰å…¨çš„ï¼Œåœ¨å¤šä¸ªgoroutineæ“ä½œæƒ…å†µä¸‹ï¼Œä¼šå‡ºç°æ„æƒ³ä¸åˆ°çš„ç»“æœã€‚æƒ³è¦å¹¶å‘å®‰å…¨åœ°ä½¿ç”¨Mapç»“æ„ï¼Œè¦ä¹ˆæ˜¯è¿›è¡ŒåŠ é”æ“ä½œï¼Œè¦ä¹ˆå°±æ˜¯ä½¿ç”¨`sync.Map`ç»“æ„\n\n`sync.Map`æœ‰å¦‚ä¸‹å¸¸ç”¨æ–¹æ³•\n\n- `Load()`ï¼šå†™å…¥ä¸€ä¸ªé”®å€¼å¯¹\n- `Store()`ï¼šè¯»å–ä¸€ä¸ªé”®å€¼å¯¹\n- `Range()`ï¼šéå†mapï¼Œç±»ä¼¼äºJSä¸­çš„`for each`\n- `Delete()`ï¼šåˆ é™¤æ“ä½œ\n- `LoadOrStore()`ï¼šè¯»å–æˆ–å­˜å‚¨æ•°æ®\n\nğŸŒ°ï¼š\n\n```go\nfunc main() {\n\tvar m sync.Map\n\tm.Store(\"name\", \"zhao\")\n\tm.Store(\"hello\", \"world\")\n\n\tv, ok := m.Load(\"hello\")\n\tif ok {\n\t\tfmt.Println(v)\n\t}\n\n\tm.Range(func(key, value any) bool {\n\t\tfmt.Printf(\"key is %v\tval is %v\\n\", key, value)\n\t\treturn true\n\t})\n\n\tv, ok = m.LoadOrStore(\"name\", \"yun\")\n\tif ok {\n\t\tfmt.Printf(\"name`s new val is %v\\n\", v)\n\t}\n\n\tm.Delete(\"name\")\n\tv, ok = m.Load(\"name\")\n\tif ok {\n\t\tfmt.Printf(\"name`s val is %v\\n\", v)\n\t}\n}\n\n```\n\n## Context\n\nç”¨äºå¹¶å‘æ§åˆ¶\n\nä¸Šä¸‹æ–‡çš„ä¿¡æ¯ä¼ é€’\n","slug":"Sync","published":1,"date":"2024-12-27T11:03:15.343Z","updated":"2024-12-27T11:03:15.343Z","title":"","comments":1,"layout":"post","photos":[],"_id":"cm6c7md6g0004a5t21kkh6c8z","content":"<h1 id=\"syncã€context\"><a href=\"#syncã€context\" class=\"headerlink\" title=\"syncã€context\"></a>syncã€context</h1><h2 id=\"Sync\"><a href=\"#Sync\" class=\"headerlink\" title=\"Sync\"></a>Sync</h2><h3 id=\"sync-WaitGroup\"><a href=\"#sync-WaitGroup\" class=\"headerlink\" title=\"sync.WaitGroup\"></a>sync.WaitGroup</h3><p>åœ¨Goè¯­è¨€ä¸­å¯ä»¥ä½¿ç”¨<code>sync.WaitGroup</code>å®ç°å¹¶å‘ä»»åŠ¡çš„åŒæ­¥ä»¥åŠåç¨‹ç­‰å¾…</p>\n<p><code>sync.WaitGroup</code>æ˜¯ä¸€ä¸ªç»“æ„ä½“ï¼Œå†…ç½®äº†ä¸€ä¸ªè®¡æ•°å™¨ï¼Œæœ‰ä¸‰ä¸ªæ–¹æ³•</p>\n<ul>\n<li>Add(delta int)ï¼Œè®¡æ•°å™¨å¢åŠ <code>delta</code></li>\n<li>Done()ï¼Œè®¡æ•°å™¨<code>-1</code></li>\n<li>Wait()ï¼Œ<strong>é˜»å¡å½“å‰åç¨‹çš„è¿è¡Œï¼Œç›´è‡³è®¡æ•°å™¨ä¸º0</strong></li>\n</ul>\n<p>ğŸŒ°ï¼š</p>\n<figure class=\"highlight go\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">var</span> wg sync.WaitGroup</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"function\"><span class=\"keyword\">func</span> <span class=\"title\">main</span><span class=\"params\">()</span></span> &#123;</span><br><span class=\"line\">\twg.Add(<span class=\"number\">10</span>)</span><br><span class=\"line\">\t<span class=\"keyword\">for</span> <span class=\"keyword\">range</span> <span class=\"number\">10</span> &#123;</span><br><span class=\"line\">\t\t<span class=\"keyword\">go</span> <span class=\"function\"><span class=\"keyword\">func</span><span class=\"params\">()</span></span> &#123;</span><br><span class=\"line\">\t\t\t<span class=\"keyword\">defer</span> wg.Done()</span><br><span class=\"line\">\t\t\tfmt.Println(<span class=\"string\">&quot;hello world&quot;</span>)</span><br><span class=\"line\">\t\t&#125;()</span><br><span class=\"line\">\t&#125;</span><br><span class=\"line\">\twg.Wait()</span><br><span class=\"line\">\tfmt.Println(<span class=\"string\">&quot;end!&quot;</span>)</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n\n<p>âš ï¸ï¼š<code>sync.WaitGroup</code>å¯¹è±¡çš„è®¡æ•°å™¨ä¸èƒ½ä¸ºè´Ÿæ•°ï¼Œå½“è°ƒç”¨Done()æ–¹æ³•åï¼Œå¿…é¡»ç¡®ä¿è®¡æ•°å™¨å€¼å¤§äºç­‰äºé›¶ï¼Œå¦åˆ™ä¼š<code>panic</code></p>\n<h3 id=\"sync-Once\"><a href=\"#sync-Once\" class=\"headerlink\" title=\"sync.Once\"></a>sync.Once</h3><p>ç¨‹åºä¸­æœ‰ä¸€äº›é€»è¾‘åªéœ€è¦æ‰§è¡Œä¸€æ¬¡ï¼Œæœ€å…¸å‹çš„å°±æ˜¯é¡¹ç›®ä¸­çš„é…ç½®æ–‡ä»¶ï¼Œé€šå¸¸çš„åšæ³•æœ‰ä¸¤ç§ï¼Œä¸€æ˜¯åœ¨é¡¹ç›®å¯åŠ¨æ—¶å°±å°†ä»£ç æ‰§è¡Œå¹¶å°†ç»“æœä¿å­˜åœ¨å†…å­˜ä¸­ï¼ŒäºŒæ˜¯éœ€è¦ä½¿ç”¨æ—¶å†æ‰§è¡Œç›¸åº”çš„é€»è¾‘ä»£ç ï¼Œè€Œ<code>sync.Once</code>å°±å±äºåè€…</p>\n<p><code>sync.Once</code>å¯ä»¥åœ¨ä»£ç çš„ä»»æ„ä½ç½®åˆå§‹åŒ–å’Œè°ƒç”¨ï¼Œå¹¶ä¸”çº¿ç¨‹å®‰å…¨ã€‚<code>sync.Once</code>æœ€å¤§çš„ç”¨å¤„å°±æ˜¯<strong>å»¶è¿Ÿåˆå§‹åŒ–ï¼ˆè°ƒç”¨ï¼‰å¹¶åªåˆå§‹åŒ–ä¸€æ¬¡</strong>ï¼Œé¿å…è¿‡æ—©æ‰§è¡Œä»£ç é€»è¾‘å¯¼è‡´å†…å­˜ç©ºé—´çš„æµªè´¹</p>\n<p>ğŸŒ°ï¼š</p>\n<figure class=\"highlight go\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">var</span> once sync.Once</span><br><span class=\"line\"><span class=\"keyword\">var</span> instance *Config</span><br><span class=\"line\"><span class=\"keyword\">var</span> i = <span class=\"number\">0</span></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"keyword\">type</span> Config <span class=\"keyword\">struct</span>&#123;&#125;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"function\"><span class=\"keyword\">func</span> <span class=\"title\">Init</span><span class=\"params\">()</span></span> &#123;</span><br><span class=\"line\">\tonce.Do(<span class=\"function\"><span class=\"keyword\">func</span><span class=\"params\">()</span></span> &#123;</span><br><span class=\"line\">\t\tinstance = &amp;Config&#123;&#125;</span><br><span class=\"line\">\t\tfmt.Println(i)</span><br><span class=\"line\">\t\ti++</span><br><span class=\"line\">\t&#125;)</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"function\"><span class=\"keyword\">func</span> <span class=\"title\">main</span><span class=\"params\">()</span></span> &#123;</span><br><span class=\"line\">\t<span class=\"keyword\">for</span> <span class=\"keyword\">range</span> <span class=\"number\">10</span> &#123;</span><br><span class=\"line\">\t\tInit()</span><br><span class=\"line\">\t&#125;</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n\n<p>ç”±ä¾‹å­å¯çŸ¥ï¼Œè¢«<code>once.Do()</code>åŒ…è£¹çš„å‡½æ•°åªä¼šæ‰§è¡Œä¸€æ¬¡ï¼Œå³ä½¿è°ƒç”¨å¤šæ¬¡<code>Init()</code>å‡½æ•°</p>\n<h4 id=\"ä¸init-çš„åŒºåˆ«\"><a href=\"#ä¸init-çš„åŒºåˆ«\" class=\"headerlink\" title=\"ä¸init()çš„åŒºåˆ«\"></a>ä¸init()çš„åŒºåˆ«</h4><p><code>init()</code>æ–¹æ³•å’Œ<code>sync.Once</code>éƒ½å¯ä»¥ç”¨æ¥è¿›è¡Œä¸€äº›åˆå§‹åŒ–æ“ä½œï¼Œ<strong>äºŒè€…çš„åŒºåˆ«ä¸»è¦åœ¨äºè¢«è°ƒç”¨ï¼ˆåˆå§‹åŒ–ï¼‰çš„æ—¶æœº</strong></p>\n<p><code>init()</code>æ–¹æ³•æ˜¯åœ¨å…¶æ‰€åœ¨çš„packageè¢«é¦–æ¬¡åŠ è½½æ—¶æ‰§è¡Œçš„ï¼Œå¯ä»¥ç¡®ä¿åœ¨<code>main</code>å‡½æ•°ä¹‹å‰æ‰§è¡Œï¼Œé€‚ç”¨äºç¨‹åºå¯åŠ¨æ—¶çš„åˆå§‹åŒ–æ“ä½œ</p>\n<p><code>sync.Once</code>å¯ä»¥åœ¨ä»£ç çš„ä»»æ„ä½ç½®è°ƒç”¨ï¼Œé€‚ç”¨äºåœ¨<strong>å¹¶å‘ç¯å¢ƒä¸‹ç¡®ä¿æŸä¸ªé€»è¾‘åªæ‰§è¡Œä¸€æ¬¡</strong></p>\n<h3 id=\"sync-Map\"><a href=\"#sync-Map\" class=\"headerlink\" title=\"sync.Map\"></a>sync.Map</h3><p>Goå†…ç½®çš„Mapä¸æ˜¯å¹¶å‘å®‰å…¨çš„ï¼Œåœ¨å¤šä¸ªgoroutineæ“ä½œæƒ…å†µä¸‹ï¼Œä¼šå‡ºç°æ„æƒ³ä¸åˆ°çš„ç»“æœã€‚æƒ³è¦å¹¶å‘å®‰å…¨åœ°ä½¿ç”¨Mapç»“æ„ï¼Œè¦ä¹ˆæ˜¯è¿›è¡ŒåŠ é”æ“ä½œï¼Œè¦ä¹ˆå°±æ˜¯ä½¿ç”¨<code>sync.Map</code>ç»“æ„</p>\n<p><code>sync.Map</code>æœ‰å¦‚ä¸‹å¸¸ç”¨æ–¹æ³•</p>\n<ul>\n<li><code>Load()</code>ï¼šå†™å…¥ä¸€ä¸ªé”®å€¼å¯¹</li>\n<li><code>Store()</code>ï¼šè¯»å–ä¸€ä¸ªé”®å€¼å¯¹</li>\n<li><code>Range()</code>ï¼šéå†mapï¼Œç±»ä¼¼äºJSä¸­çš„<code>for each</code></li>\n<li><code>Delete()</code>ï¼šåˆ é™¤æ“ä½œ</li>\n<li><code>LoadOrStore()</code>ï¼šè¯»å–æˆ–å­˜å‚¨æ•°æ®</li>\n</ul>\n<p>ğŸŒ°ï¼š</p>\n<figure class=\"highlight go\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"function\"><span class=\"keyword\">func</span> <span class=\"title\">main</span><span class=\"params\">()</span></span> &#123;</span><br><span class=\"line\">\t<span class=\"keyword\">var</span> m sync.Map</span><br><span class=\"line\">\tm.Store(<span class=\"string\">&quot;name&quot;</span>, <span class=\"string\">&quot;zhao&quot;</span>)</span><br><span class=\"line\">\tm.Store(<span class=\"string\">&quot;hello&quot;</span>, <span class=\"string\">&quot;world&quot;</span>)</span><br><span class=\"line\"></span><br><span class=\"line\">\tv, ok := m.Load(<span class=\"string\">&quot;hello&quot;</span>)</span><br><span class=\"line\">\t<span class=\"keyword\">if</span> ok &#123;</span><br><span class=\"line\">\t\tfmt.Println(v)</span><br><span class=\"line\">\t&#125;</span><br><span class=\"line\"></span><br><span class=\"line\">\tm.Range(<span class=\"function\"><span class=\"keyword\">func</span><span class=\"params\">(key, value any)</span></span> <span class=\"type\">bool</span> &#123;</span><br><span class=\"line\">\t\tfmt.Printf(<span class=\"string\">&quot;key is %v\tval is %v\\n&quot;</span>, key, value)</span><br><span class=\"line\">\t\t<span class=\"keyword\">return</span> <span class=\"literal\">true</span></span><br><span class=\"line\">\t&#125;)</span><br><span class=\"line\"></span><br><span class=\"line\">\tv, ok = m.LoadOrStore(<span class=\"string\">&quot;name&quot;</span>, <span class=\"string\">&quot;yun&quot;</span>)</span><br><span class=\"line\">\t<span class=\"keyword\">if</span> ok &#123;</span><br><span class=\"line\">\t\tfmt.Printf(<span class=\"string\">&quot;name`s new val is %v\\n&quot;</span>, v)</span><br><span class=\"line\">\t&#125;</span><br><span class=\"line\"></span><br><span class=\"line\">\tm.Delete(<span class=\"string\">&quot;name&quot;</span>)</span><br><span class=\"line\">\tv, ok = m.Load(<span class=\"string\">&quot;name&quot;</span>)</span><br><span class=\"line\">\t<span class=\"keyword\">if</span> ok &#123;</span><br><span class=\"line\">\t\tfmt.Printf(<span class=\"string\">&quot;name`s val is %v\\n&quot;</span>, v)</span><br><span class=\"line\">\t&#125;</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"></span><br></pre></td></tr></table></figure>\n\n<h2 id=\"Context\"><a href=\"#Context\" class=\"headerlink\" title=\"Context\"></a>Context</h2><p>ç”¨äºå¹¶å‘æ§åˆ¶</p>\n<p>ä¸Šä¸‹æ–‡çš„ä¿¡æ¯ä¼ é€’</p>\n","excerpt":"","more":"<h1 id=\"syncã€context\"><a href=\"#syncã€context\" class=\"headerlink\" title=\"syncã€context\"></a>syncã€context</h1><h2 id=\"Sync\"><a href=\"#Sync\" class=\"headerlink\" title=\"Sync\"></a>Sync</h2><h3 id=\"sync-WaitGroup\"><a href=\"#sync-WaitGroup\" class=\"headerlink\" title=\"sync.WaitGroup\"></a>sync.WaitGroup</h3><p>åœ¨Goè¯­è¨€ä¸­å¯ä»¥ä½¿ç”¨<code>sync.WaitGroup</code>å®ç°å¹¶å‘ä»»åŠ¡çš„åŒæ­¥ä»¥åŠåç¨‹ç­‰å¾…</p>\n<p><code>sync.WaitGroup</code>æ˜¯ä¸€ä¸ªç»“æ„ä½“ï¼Œå†…ç½®äº†ä¸€ä¸ªè®¡æ•°å™¨ï¼Œæœ‰ä¸‰ä¸ªæ–¹æ³•</p>\n<ul>\n<li>Add(delta int)ï¼Œè®¡æ•°å™¨å¢åŠ <code>delta</code></li>\n<li>Done()ï¼Œè®¡æ•°å™¨<code>-1</code></li>\n<li>Wait()ï¼Œ<strong>é˜»å¡å½“å‰åç¨‹çš„è¿è¡Œï¼Œç›´è‡³è®¡æ•°å™¨ä¸º0</strong></li>\n</ul>\n<p>ğŸŒ°ï¼š</p>\n<figure class=\"highlight go\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">var</span> wg sync.WaitGroup</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"function\"><span class=\"keyword\">func</span> <span class=\"title\">main</span><span class=\"params\">()</span></span> &#123;</span><br><span class=\"line\">\twg.Add(<span class=\"number\">10</span>)</span><br><span class=\"line\">\t<span class=\"keyword\">for</span> <span class=\"keyword\">range</span> <span class=\"number\">10</span> &#123;</span><br><span class=\"line\">\t\t<span class=\"keyword\">go</span> <span class=\"function\"><span class=\"keyword\">func</span><span class=\"params\">()</span></span> &#123;</span><br><span class=\"line\">\t\t\t<span class=\"keyword\">defer</span> wg.Done()</span><br><span class=\"line\">\t\t\tfmt.Println(<span class=\"string\">&quot;hello world&quot;</span>)</span><br><span class=\"line\">\t\t&#125;()</span><br><span class=\"line\">\t&#125;</span><br><span class=\"line\">\twg.Wait()</span><br><span class=\"line\">\tfmt.Println(<span class=\"string\">&quot;end!&quot;</span>)</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n\n<p>âš ï¸ï¼š<code>sync.WaitGroup</code>å¯¹è±¡çš„è®¡æ•°å™¨ä¸èƒ½ä¸ºè´Ÿæ•°ï¼Œå½“è°ƒç”¨Done()æ–¹æ³•åï¼Œå¿…é¡»ç¡®ä¿è®¡æ•°å™¨å€¼å¤§äºç­‰äºé›¶ï¼Œå¦åˆ™ä¼š<code>panic</code></p>\n<h3 id=\"sync-Once\"><a href=\"#sync-Once\" class=\"headerlink\" title=\"sync.Once\"></a>sync.Once</h3><p>ç¨‹åºä¸­æœ‰ä¸€äº›é€»è¾‘åªéœ€è¦æ‰§è¡Œä¸€æ¬¡ï¼Œæœ€å…¸å‹çš„å°±æ˜¯é¡¹ç›®ä¸­çš„é…ç½®æ–‡ä»¶ï¼Œé€šå¸¸çš„åšæ³•æœ‰ä¸¤ç§ï¼Œä¸€æ˜¯åœ¨é¡¹ç›®å¯åŠ¨æ—¶å°±å°†ä»£ç æ‰§è¡Œå¹¶å°†ç»“æœä¿å­˜åœ¨å†…å­˜ä¸­ï¼ŒäºŒæ˜¯éœ€è¦ä½¿ç”¨æ—¶å†æ‰§è¡Œç›¸åº”çš„é€»è¾‘ä»£ç ï¼Œè€Œ<code>sync.Once</code>å°±å±äºåè€…</p>\n<p><code>sync.Once</code>å¯ä»¥åœ¨ä»£ç çš„ä»»æ„ä½ç½®åˆå§‹åŒ–å’Œè°ƒç”¨ï¼Œå¹¶ä¸”çº¿ç¨‹å®‰å…¨ã€‚<code>sync.Once</code>æœ€å¤§çš„ç”¨å¤„å°±æ˜¯<strong>å»¶è¿Ÿåˆå§‹åŒ–ï¼ˆè°ƒç”¨ï¼‰å¹¶åªåˆå§‹åŒ–ä¸€æ¬¡</strong>ï¼Œé¿å…è¿‡æ—©æ‰§è¡Œä»£ç é€»è¾‘å¯¼è‡´å†…å­˜ç©ºé—´çš„æµªè´¹</p>\n<p>ğŸŒ°ï¼š</p>\n<figure class=\"highlight go\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">var</span> once sync.Once</span><br><span class=\"line\"><span class=\"keyword\">var</span> instance *Config</span><br><span class=\"line\"><span class=\"keyword\">var</span> i = <span class=\"number\">0</span></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"keyword\">type</span> Config <span class=\"keyword\">struct</span>&#123;&#125;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"function\"><span class=\"keyword\">func</span> <span class=\"title\">Init</span><span class=\"params\">()</span></span> &#123;</span><br><span class=\"line\">\tonce.Do(<span class=\"function\"><span class=\"keyword\">func</span><span class=\"params\">()</span></span> &#123;</span><br><span class=\"line\">\t\tinstance = &amp;Config&#123;&#125;</span><br><span class=\"line\">\t\tfmt.Println(i)</span><br><span class=\"line\">\t\ti++</span><br><span class=\"line\">\t&#125;)</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"function\"><span class=\"keyword\">func</span> <span class=\"title\">main</span><span class=\"params\">()</span></span> &#123;</span><br><span class=\"line\">\t<span class=\"keyword\">for</span> <span class=\"keyword\">range</span> <span class=\"number\">10</span> &#123;</span><br><span class=\"line\">\t\tInit()</span><br><span class=\"line\">\t&#125;</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n\n<p>ç”±ä¾‹å­å¯çŸ¥ï¼Œè¢«<code>once.Do()</code>åŒ…è£¹çš„å‡½æ•°åªä¼šæ‰§è¡Œä¸€æ¬¡ï¼Œå³ä½¿è°ƒç”¨å¤šæ¬¡<code>Init()</code>å‡½æ•°</p>\n<h4 id=\"ä¸init-çš„åŒºåˆ«\"><a href=\"#ä¸init-çš„åŒºåˆ«\" class=\"headerlink\" title=\"ä¸init()çš„åŒºåˆ«\"></a>ä¸init()çš„åŒºåˆ«</h4><p><code>init()</code>æ–¹æ³•å’Œ<code>sync.Once</code>éƒ½å¯ä»¥ç”¨æ¥è¿›è¡Œä¸€äº›åˆå§‹åŒ–æ“ä½œï¼Œ<strong>äºŒè€…çš„åŒºåˆ«ä¸»è¦åœ¨äºè¢«è°ƒç”¨ï¼ˆåˆå§‹åŒ–ï¼‰çš„æ—¶æœº</strong></p>\n<p><code>init()</code>æ–¹æ³•æ˜¯åœ¨å…¶æ‰€åœ¨çš„packageè¢«é¦–æ¬¡åŠ è½½æ—¶æ‰§è¡Œçš„ï¼Œå¯ä»¥ç¡®ä¿åœ¨<code>main</code>å‡½æ•°ä¹‹å‰æ‰§è¡Œï¼Œé€‚ç”¨äºç¨‹åºå¯åŠ¨æ—¶çš„åˆå§‹åŒ–æ“ä½œ</p>\n<p><code>sync.Once</code>å¯ä»¥åœ¨ä»£ç çš„ä»»æ„ä½ç½®è°ƒç”¨ï¼Œé€‚ç”¨äºåœ¨<strong>å¹¶å‘ç¯å¢ƒä¸‹ç¡®ä¿æŸä¸ªé€»è¾‘åªæ‰§è¡Œä¸€æ¬¡</strong></p>\n<h3 id=\"sync-Map\"><a href=\"#sync-Map\" class=\"headerlink\" title=\"sync.Map\"></a>sync.Map</h3><p>Goå†…ç½®çš„Mapä¸æ˜¯å¹¶å‘å®‰å…¨çš„ï¼Œåœ¨å¤šä¸ªgoroutineæ“ä½œæƒ…å†µä¸‹ï¼Œä¼šå‡ºç°æ„æƒ³ä¸åˆ°çš„ç»“æœã€‚æƒ³è¦å¹¶å‘å®‰å…¨åœ°ä½¿ç”¨Mapç»“æ„ï¼Œè¦ä¹ˆæ˜¯è¿›è¡ŒåŠ é”æ“ä½œï¼Œè¦ä¹ˆå°±æ˜¯ä½¿ç”¨<code>sync.Map</code>ç»“æ„</p>\n<p><code>sync.Map</code>æœ‰å¦‚ä¸‹å¸¸ç”¨æ–¹æ³•</p>\n<ul>\n<li><code>Load()</code>ï¼šå†™å…¥ä¸€ä¸ªé”®å€¼å¯¹</li>\n<li><code>Store()</code>ï¼šè¯»å–ä¸€ä¸ªé”®å€¼å¯¹</li>\n<li><code>Range()</code>ï¼šéå†mapï¼Œç±»ä¼¼äºJSä¸­çš„<code>for each</code></li>\n<li><code>Delete()</code>ï¼šåˆ é™¤æ“ä½œ</li>\n<li><code>LoadOrStore()</code>ï¼šè¯»å–æˆ–å­˜å‚¨æ•°æ®</li>\n</ul>\n<p>ğŸŒ°ï¼š</p>\n<figure class=\"highlight go\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"function\"><span class=\"keyword\">func</span> <span class=\"title\">main</span><span class=\"params\">()</span></span> &#123;</span><br><span class=\"line\">\t<span class=\"keyword\">var</span> m sync.Map</span><br><span class=\"line\">\tm.Store(<span class=\"string\">&quot;name&quot;</span>, <span class=\"string\">&quot;zhao&quot;</span>)</span><br><span class=\"line\">\tm.Store(<span class=\"string\">&quot;hello&quot;</span>, <span class=\"string\">&quot;world&quot;</span>)</span><br><span class=\"line\"></span><br><span class=\"line\">\tv, ok := m.Load(<span class=\"string\">&quot;hello&quot;</span>)</span><br><span class=\"line\">\t<span class=\"keyword\">if</span> ok &#123;</span><br><span class=\"line\">\t\tfmt.Println(v)</span><br><span class=\"line\">\t&#125;</span><br><span class=\"line\"></span><br><span class=\"line\">\tm.Range(<span class=\"function\"><span class=\"keyword\">func</span><span class=\"params\">(key, value any)</span></span> <span class=\"type\">bool</span> &#123;</span><br><span class=\"line\">\t\tfmt.Printf(<span class=\"string\">&quot;key is %v\tval is %v\\n&quot;</span>, key, value)</span><br><span class=\"line\">\t\t<span class=\"keyword\">return</span> <span class=\"literal\">true</span></span><br><span class=\"line\">\t&#125;)</span><br><span class=\"line\"></span><br><span class=\"line\">\tv, ok = m.LoadOrStore(<span class=\"string\">&quot;name&quot;</span>, <span class=\"string\">&quot;yun&quot;</span>)</span><br><span class=\"line\">\t<span class=\"keyword\">if</span> ok &#123;</span><br><span class=\"line\">\t\tfmt.Printf(<span class=\"string\">&quot;name`s new val is %v\\n&quot;</span>, v)</span><br><span class=\"line\">\t&#125;</span><br><span class=\"line\"></span><br><span class=\"line\">\tm.Delete(<span class=\"string\">&quot;name&quot;</span>)</span><br><span class=\"line\">\tv, ok = m.Load(<span class=\"string\">&quot;name&quot;</span>)</span><br><span class=\"line\">\t<span class=\"keyword\">if</span> ok &#123;</span><br><span class=\"line\">\t\tfmt.Printf(<span class=\"string\">&quot;name`s val is %v\\n&quot;</span>, v)</span><br><span class=\"line\">\t&#125;</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"></span><br></pre></td></tr></table></figure>\n\n<h2 id=\"Context\"><a href=\"#Context\" class=\"headerlink\" title=\"Context\"></a>Context</h2><p>ç”¨äºå¹¶å‘æ§åˆ¶</p>\n<p>ä¸Šä¸‹æ–‡çš„ä¿¡æ¯ä¼ é€’</p>\n"},{"_content":"## æ•´ä½“æ¶æ„\nå®è§‚ä¸Šå¯ä»¥å°†Kafkaåˆ†æˆä¸‰ä¸ªéƒ¨åˆ†ï¼šç”Ÿäº§è€…ã€ä¸­é—´æœåŠ¡å±‚ã€æ¶ˆè´¹è€…\nä¸­é—´æœåŠ¡å±‚ç›¸å½“äºä¸€ä¸ªâ€œæ¶ˆæ¯ä¸­è½¬ç«™â€ï¼Œä½†ä¸åŒä¹‹å¤„åœ¨äºï¼Œä¸­é—´æœåŠ¡å±‚ä¼šå°†æ¶ˆæ¯æŒä¹…åŒ–å­˜å‚¨\n\nä¸­é—´æœåŠ¡å±‚ç”±å¤šä¸ªéƒ¨ä»¶æ„æˆï¼š\n- brokerï¼šå¯ä»¥ç†è§£ä¸ºæ˜¯ä¸€ä¸ªèŠ‚ç‚¹ï¼Œå³è¿è¡ŒKafkaç¨‹åºçš„æœåŠ¡å™¨\n- topicï¼šå¯¹æ¶ˆæ¯è¿›è¡Œé€»è¾‘åˆ†ç±»çš„ç²—ç²’åº¦å•ä½ï¼Œå¯ç”¨äºå®ç°è´Ÿè½½å‡è¡¡ã€æ¶ˆæ¯å¹¶è¡Œå¤„ç†ã€‚æ¶ˆè´¹è€…è®¢é˜…æŸä¸€ä¸ªä¸»é¢˜è¿›è¡Œæ¶ˆè´¹ã€‚ç”Ÿäº§è€…å‘æŒ‡å®šçš„ä¸»é¢˜å†™å…¥æ¶ˆæ¯\n- partitionï¼šæ¶ˆæ¯ä¸Šç‰©ç†ä¸Šå­˜å‚¨çš„ç©ºé—´ï¼Œä¸€ä¸ªpartitionå¯¹åº”ç€ä¸€ä¸ªtopicï¼Œä¸€ä¸ªtopicå¯ä»¥æœ‰å¤šä¸ªpartitionã€‚partitionå¯¹äºç”Ÿäº§è€…å’Œæ¶ˆè´¹è€…æ˜¯é€æ˜çš„ã€æ— æ³•æ„ŸçŸ¥çš„ã€‚\n\t- æ¯ä¸ªpartitionå­˜å‚¨ç€æœ‰åºã€ä¸å¯å˜çš„æ¶ˆæ¯åºåˆ—\n\t- partitionå¯è¢«ç‹¬ç«‹è¯»å†™\n\nbrokerã€topicã€partitionä¸‰è€…ä¹‹é—´çš„å…³ç³»å¦‚ä¸‹ï¼š\n\n![image.png](https://raw.githubusercontent.com/lyydsheep/pic/main/20250104150207.png)\n## Topic\nåœ¨Kafkaä¸­ï¼ŒTopicå°±æ˜¯ä¸€ä¸ªä¸»é¢˜ï¼Œå±äºé€»è¾‘ä¸Šçš„æ¦‚å¿µï¼Œå¹¶ä¸å­˜åœ¨ä»»ä½•ä¸€å°ç‰©ç†è®¾å¤‡ä¸Šã€‚ä½œä¸ºä½¿ç”¨è€…ï¼Œæˆ‘ä»¬å¯ä»¥å°†åŒä¸šåŠ¡çš„æ¶ˆæ¯æ”¾å…¥åŒä¸€ä¸ªtopicï¼Œä¾‹å¦‚ç§’æ€ä¸šåŠ¡ã€å”®ç¥¨ä¸šåŠ¡ç­‰ï¼Œé€šè¿‡è¿™ä¸ªé€»è¾‘ä¸Šçš„æ¦‚å¿µï¼Œå¯ä»¥ç²—ç²’åº¦åœ°å°†æ•°æ®æ¶ˆæ¯è¿›è¡Œåˆ†ç‰‡ï¼Œåˆ†é—¨åˆ«ç±»åœ°å¤„ç†æ¶ˆæ¯ã€‚\n\n## Partition\nå¯¹æ•°æ®è¿›è¡Œé€»è¾‘Topicåˆ†åŒºåï¼Œä¸€ä¸ªä¸šåŠ¡çš„æ•°æ®é‡å¯èƒ½ä»ç„¶åºå¤§ï¼Œä¸ºäº†å¯¹æ•°æ®è¿›ä¸€æ­¥åˆ†è€Œæ²»ä¹‹ï¼Œè®¾è®¡Kafkaçš„å¤§ä½¬å†³å®šå°†Topicçš„æ•°æ®å®é™…ç‰©ç†å­˜å‚¨åœ¨ä¸€ä¸ªä¸ªPartitionä¸­ã€‚Partitionå°±ç›¸å½“äºå¯¹ç²—ç²’åº¦åˆ’åˆ†çš„æ•°æ®å†è¿›è¡Œä¸€æ¬¡ç»†ç²’åº¦åŒºåˆ†ã€‚ç”±äºTopicæ˜¯ä¸€ä¸ªé€»è¾‘ä¸Šçš„æ¦‚å¿µï¼Œå¹¶ä¸å­˜åœ¨äºæŸä¸€ä¸ªå…·ä½“çš„brokerä¸Šï¼Œå› æ­¤åœ¨é›†ç¾¤æ¨¡å¼ä¸‹ï¼ŒåŒä¸€ä¸ªTopicä¸‹çš„å¤šä¸ªPartitionæ˜¯ç‹¬ç«‹çš„ï¼Œå®Œå…¨å¯ä»¥åœ¨ä¸åŒçš„brokerä¸Šã€‚\n\nåˆ†ç‰‡çš„å¥½å¤„ï¼š\n- æé«˜å†™å…¥æ€§èƒ½ï¼Œä¸åŒçš„partitionåˆ†å¸ƒåœ¨ä¸åŒçš„brokerä¸Šï¼Œå¯ä»¥å®ç°å¹¶è¡Œå†™å…¥ï¼Œæé«˜äº†ç³»ç»Ÿååé‡\n- æé«˜æ¶ˆè´¹è€…å¹¶å‘åº¦ï¼Œå› ä¸ºæœ‰äº†ä¸åŒçš„åˆ†ç‰‡ï¼Œä¸åŒçš„æ¶ˆè´¹è€…å¯ä»¥å¯¹ä¸åŒçš„åˆ†ç‰‡åŒæ—¶æ¶ˆè´¹\n- æé«˜äº†Kafkaæ°´å¹³æ‰©å±•èƒ½åŠ›\n- æé«˜äº†ç³»ç»Ÿçš„å®¹é”™èƒ½åŠ›ï¼Œå¼•å…¥partitionåï¼ŒåŒä¸€ä¸ª Topicä¸‹ä¸åŒpartitionä¸­çš„æ•°æ®è§£è€¦åˆï¼Œå³ä½¿ä¸€ä¸ªpartitionå´©æºƒäº†ï¼Œä¹Ÿä¸å½±å“å…¶ä»–partitionè¿ä½œ\n\nä¸€ä¸ªPartitionå°±ç›¸å½“äºä¸€ä¸ªé˜Ÿåˆ—ï¼Œæœ€æ–°çš„æ•°æ®è¢«å†™åœ¨é˜Ÿåˆ—çš„æœ«å°¾ï¼Œå³åŒä¸€ä¸ªPartitionä¸‹çš„æ•°æ®æ˜¯æœ‰åºçš„ï¼Œä½†ç»¼åˆæ¥çœ‹ï¼ŒåŒä¸€ä¸ªTopicä¸‹çš„æ‰€æœ‰Partitionä¸­çš„æ•°æ®æ˜¯æ— åºçš„\n![image.png](https://raw.githubusercontent.com/lyydsheep/pic/main/20250104192916.png)\n\nç”±äºPartitionå¯¹äºç”Ÿäº§è€…æ˜¯é€æ˜çš„ï¼Œé‚£ä¹ˆç”Ÿäº§è€…å‘ä¸€ä¸ªTopicå†™å…¥æ•°æ®ï¼Œæ•°æ®æœ€ç»ˆä¼šæµå‘ä½•å¤„å‘¢ï¼Ÿ\nå¦‚æœç”Ÿäº§è€…å‘Topicå‘é€æ¶ˆæ¯æ—¶æ²¡æœ‰æŒ‡å®šKeyï¼Œé‚£ä¹ˆKafkaæœåŠ¡å°±ä¼šé»˜è®¤é‡‡å–**è½®è¯¢Partition**çš„æ–¹å¼å°†æ•°æ®å†™å…¥åˆ°Partitionä¸­ã€‚\nå¦‚æœç”Ÿäº§è€…æŒ‡å®šäº†å‘é€çš„Keyï¼Œé‚£ä¹ˆæ¶ˆæ¯å°±ä¼šè¢«å†™å…¥åˆ°å°†Keyè¿›è¡Œå“ˆå¸Œè¿‡åå¯¹åº”çš„Partitionä¸­\n\n## Broker\nBrokerå®é™…å°±æ˜¯ä¸€ä¸ªè¿è¡ŒKafkaç¨‹åºçš„æœåŠ¡å™¨èŠ‚ç‚¹ï¼ŒBrokeréœ€è¦æä¾›å¦‚ä¸‹åŠŸèƒ½ï¼š\n1. æ¥å—æ¥è‡ªå®¢æˆ·ç«¯çš„è¿æ¥\n2. æ”¯æŒå®¢æˆ·ç«¯æŸ¥è¯¢Kafkaé›†ç¾¤çš„ä¿¡æ¯ï¼Œæ¯”å¦‚æŸ¥è¯¢å…¶ä»–Brokerä¿¡æ¯\n3. å“åº”æ¥è‡ªå®¢æˆ·ç«¯çš„å‘½ä»¤è¯·æ±‚\n4. å­˜å‚¨æ¶ˆæ¯ï¼Œå³å°†æ¶ˆæ¯æŒä¹…åŒ–å­˜å‚¨åœ¨æœ¬åœ°æœåŠ¡å™¨ä¸Š\n\nåœ¨é›†ç¾¤éƒ¨ç½²æ¨¡å¼ä¸‹ï¼Œæ¯ä¸€ä¸ªBrokeréƒ½æœ‰å”¯ä¸€çš„IDæ ‡è¯†è‡ªå·±èº«ä»½ã€‚Partitionæ˜¯å­˜æ”¾åœ¨BrokerèŠ‚ç‚¹ä¸Šçš„ï¼Œä¸€ä¸ªPartitionå¯¹åº”ä¸€ä¸ªBrokerï¼Œä¸€ä¸ªBrokerå¯èƒ½å­˜æ”¾ç€å¤šä¸ªPartition\né’ˆå¯¹äºä¸€ä¸ªTopicä¸‹çš„å¤šä¸ªPartitionï¼Œéœ€è¦å…ˆéšæœºé€‰å–ä¸€ä¸ªBrokerï¼ˆæ¯”å¦‚æ˜¯Broker10ï¼‰å­˜æ”¾Partition_0ï¼Œæ¥ç€æŒ‰ç…§Brokerçš„IDé¡ºåºä¾æ¬¡å­˜æ”¾Partitionï¼Œå³Broker11å­˜æ”¾Partition_1ã€Broker12å­˜æ”¾Partition_2ï¼Œä»¥æ­¤ç±»æ¨ã€‚\n\nå‰æ–‡æåŠäº†ï¼Œæ¶ˆè´¹è€…åœ¨å‘é€æ¶ˆæ¯æ—¶å¯ä»¥æŒ‡å®šKeyï¼Œç›¸å½“äºå°†æ¶ˆæ¯å‘é€åˆ°æŒ‡å®šçš„Partitionä¸Šã€‚é‚£ä¹ˆå®¢æˆ·ç«¯æ˜¯å¦‚ä½•åœ¨Kafkaé›†ç¾¤ä¸­å¿«é€Ÿæ‰¾åˆ°ç›®æ ‡Partitionæ‰€åœ¨çš„BrokerèŠ‚ç‚¹å‘¢ï¼Ÿ\né€šå¸¸å®¢æˆ·ç«¯è¿æ¥é›†ç¾¤æœ‰ä¸‰ç§æ–¹å¼ï¼š\n1. å¼•å…¥ä»£ç†ï¼Œä»£ç†å’Œä¼—å¤šBrokeræ‰“äº¤é“\n2. é‡å®šå‘ï¼Œå®¢æˆ·ç«¯å‘é€å‘½ä»¤åˆ°æŸä¸€ä¸ªèŠ‚ç‚¹ä¸Šï¼Œå¦‚æœè¯¥èŠ‚ç‚¹ä¸æ˜¯ç›®æ ‡èŠ‚ç‚¹ï¼Œé‚£ä¹ˆè¯¥èŠ‚ç‚¹ä¼šå‘ŠçŸ¥å®¢æˆ·ç«¯æœ¨ç¬”å“¦èŠ‚ç‚¹å…·ä½“åœ°å€ï¼ˆRedisï¼‰\n3. æŸ¥è¯¢è·¯ç”±è¡¨ï¼Œå®¢æˆ·ç«¯å…ˆæŸ¥è¯¢è·¯ç”±è¡¨ï¼Œç›´æ¥å‘ç›®æ ‡èŠ‚ç‚¹å‘é€è¯·æ±‚å‘½ä»¤ï¼ˆKafkaï¼‰\n\nKafkaé€‰æ‹©ç¬¬ä¸‰ç§æ–¹å¼çš„ä¸€ä¸ªå¥‘æœºæ˜¯ï¼Œåœ¨Kafkaé›†ç¾¤ä¸­ï¼Œæ¯ä¸€ä¸ªBrokeréƒ½æ”¯æŒå®¢æˆ·ç«¯æŸ¥è¯¢Kafkaé›†ç¾¤çš„ä¿¡æ¯ï¼Œå³æ¯ä¸€ä¸ªBrokeréƒ½çŸ¥æ™“å…¶ä»–Brokerçš„ä¿¡æ¯ã€‚è¿™äº›ä¿¡æ¯éƒ½è¢«ç»´æŠ¤åœ¨æ¯ä¸€ä¸ªBrokerçš„è·¯ç”±è¡¨ä¸­ï¼Œäº†è§£äº†è¿™ä¸€ç‚¹ï¼Œå®¢æˆ·ç«¯å‘é€è¯»å†™å‘½ä»¤çš„è¿‡ç¨‹å°±å‘¼ä¹‹æ¬²å‡ºäº†ï¼š\n1. ä»»æ„è®¿é—®ä¸€å°Broker\n2. ä»è¿™å°Brokerä¸­è·å–è·¯ç”±è¡¨\n3. æ ¹æ®è§„åˆ™æ‰¾åˆ°ç›®æ ‡Partitionï¼Œåœ¨è·¯ç”±è¡¨ä¸­æ‰¾åˆ°å“ªä¸ªBrokerä¸Šå­˜æœ‰ç›®æ ‡Partitionï¼Œæœ€åå‘é€è¯»å†™å‘½ä»¤\n\t1. æ‰¾Partitionçš„è§„åˆ™å°±æ˜¯ä¸Šæ–‡è®²çš„**è½®è¯¢æˆ–å“ˆå¸ŒKey**è§„åˆ™\n\n## ç”Ÿäº§è€…Producer\n\nç”Ÿäº§è€…å‘é€ä¸€æ¡æ¶ˆæ¯éœ€è¦å†ç»ä¸‰ä¸ªæ­¥éª¤ï¼š\n- æ„å»ºæ¶ˆæ¯ï¼šå°†éœ€è¦å‘é€çš„ä¿¡æ¯æ‰“åŒ…æˆKafkaæ¶ˆæ¯ç»“æ„\n- åºåˆ—åŒ–æ¶ˆæ¯ï¼šå°†æ¶ˆæ¯åºåˆ—åŒ–æˆäºŒè¿›åˆ¶æ•°æ®ï¼Œä»¥ä¾¿åœ¨ç½‘ç»œä¸­ä¼ è¾“\n- å¯»æ‰¾Brokerï¼šæ ¹æ®è§„åˆ™æ‰¾åˆ°ç›®æ ‡åˆ†åŒºï¼Œæ¥ç€ä¾æ®è·¯ç”±è¡¨å°†æ¶ˆæ¯å‘é€åˆ°Partitionå¯¹åº”çš„Broker\n\n**æ„å»ºæ¶ˆæ¯**\nç”Ÿäº§è€…éœ€è¦å°†å‘é€çš„ä¿¡æ¯æ‰“åŒ…æˆKafkaæ¶ˆæ¯ç»“æ„ï¼Œæ¥ä¸‹æ¥å°±è¯¦ç»†çœ‹çœ‹æ¶ˆæ¯ç»“æ„çš„å…·ä½“ç»„æˆï¼š\n![image.png](https://raw.githubusercontent.com/lyydsheep/pic/main/20250105102410.png)\n\n- Keyï¼šæ ¹æ®Keyçš„å“ˆå¸Œå€¼ï¼ˆå–æ¨¡ï¼‰ç¡®å®šå‘é€åˆ°Topicä¸‹çš„å“ªä¸€ä¸ªPartitionä¸Šï¼Œä¸€èˆ¬æ˜¯å­—ç¬¦ä¸²ç±»å‹ï¼Œæœ€ç»ˆä¼šè¢«åºåˆ—åŒ–ä¸ºäºŒè¿›åˆ¶æ•°æ®\n- Valueï¼šå®é™…å‘é€çš„æ•°æ®\n- Compression Typeï¼šæŒ‡å®šå‹ç¼©ç®—æ³•ï¼Œè¯¥å­—æ®µè¡¨æ˜é‡‡ç”¨ä»€ä¹ˆå‹ç¼©ç®—æ³•å¯¹æ•°æ®è¿›è¡Œå‹ç¼©ï¼Œæšä¸¾å€¼ï¼šNoneã€gzipã€lz4ç­‰\n- Headerï¼šç”Ÿäº§è€…é¢å¤–æƒ³ä¼ è¾“çš„æ•°æ®å°±æ”¾åœ¨Headerä¸­ï¼Œæ¯”å¦‚TraceID\n- Partition+Offsetï¼šè¯¥å­—æ®µåœ¨ç”Ÿäº§å‡ºæ¥çš„æ—¶å€™æ˜¯ç©ºçš„ï¼Œæ¶ˆæ¯å‘é€åˆ°KafkaæœåŠ¡ç«¯åæ‰ä¼šå°†å…·ä½“çš„åˆ†åŒºã€åç§»é‡å†™å…¥è¯¥å­—æ®µã€‚Topic + Partition + Offsetå”¯ä¸€ç¡®å®šä¸€æ¡æ¶ˆæ¯\n\n**åºåˆ—åŒ–**\nåºåˆ—åŒ–å°±æ˜¯å°†æ¶ˆæ¯ä»å¸¸è§„ç±»å‹è½¬æ¢è‡³äºŒè¿›åˆ¶ç±»å‹ï¼Œä»¥åœ¨ç½‘ç»œä¸­ä¼ è¾“\n\n**å‘é€æ¨¡å¼**\nåœ¨Goã€Javaçš„SDKä¸­æä¾›äº†ä¸‰ç§æ¶ˆæ¯å‘é€æ¨¡å¼ï¼š\n1. åŒæ­¥å‘é€ï¼Œç”Ÿäº§è€…å‘é€æ¶ˆæ¯åï¼Œæ‰§è¡Œé˜»å¡æ“ä½œï¼Œç­‰å¾…KafkaæœåŠ¡ç«¯è¿”å›å‘é€æ¶ˆæ¯æˆåŠŸæˆ–å¼‚å¸¸ç»“æœã€‚é€‚ç”¨äºç”Ÿäº§è€…éœ€è¦ç¡®ä¿æˆåŠŸå‘é€æ¶ˆæ¯æ‰èƒ½æ‰§è¡Œåç»­æ“ä½œçš„åœºæ™¯ã€‚\n2. å‘äº†å°±å¿˜ï¼Œç”Ÿäº§è€…å‘å®Œæ¶ˆæ¯å°±ç»§ç»­æ‰§è¡Œåç»­æ“ä½œï¼Œä¸ç†ä¼šæ¶ˆæ¯æ˜¯å¦å‘é€æˆåŠŸï¼Œä¹Ÿä¸é‡‡å–æªæ–½åº”å¯¹å‘é€å¼‚å¸¸\n3. å¼‚æ­¥å‘é€ï¼Œç”Ÿäº§è€…å‘é€æ¶ˆæ¯çš„åŒæ—¶æ³¨å†Œå›è°ƒå‡½æ•°ï¼Œä¸æ‰§è¡Œé˜»å¡æ“ä½œï¼Œè€Œæ˜¯ç»§ç»­æ‰§è¡Œåç»­çš„æ“ä½œã€‚å½“KafkaæœåŠ¡ç«¯è¿”å›å‘é€æ¶ˆæ¯çš„ç»“æœåï¼Œæ‰§è¡Œå¯¹åº”å›è°ƒå‡½æ•°çš„å†…å®¹\n\nä¸‰ç§å‘é€æ¨¡å¼å®é™…ä¸Šå°±æ˜¯**é«˜æ€§èƒ½å’Œå¯é æ€§**ä¹‹é—´çš„æƒè¡¡ã€‚åŒæ­¥å‘é€æ¨¡å¼å¯é æ€§å¼ºï¼Œä½†æ˜¯æ•ˆç‡ä¸é«˜ï¼Œé€‚ç”¨äºä¿æŒæ•°æ®ä¸€è‡´æ€§çš„åœºæ™¯ï¼›å‘äº†å°±å¿˜æ€§èƒ½é«˜ï¼Œå¯æ˜¯ä¸ä¿è¯å¯é æ€§ï¼Œå› æ­¤é€‚åˆåœ¨è¦æ±‚é«˜æ€§èƒ½çš„åœºæ™¯ä¸‹ä½¿ç”¨ï¼›å¼‚æ­¥å‘é€å°±æ˜¯åœ¨äºŒè€…ä¹‹é—´çš„æŠ˜ä¸­åŠæ³•ï¼Œä½¿ç”¨äºåœ¨éœ€è¦æ—¶å¤„ç†æ¶ˆæ¯å‘é€å¤±è´¥çš„æƒ…å†µ\n\n## æ¶ˆè´¹è€…Consumer\nå’Œç”Ÿäº§è€…ä¸€æ ·ï¼Œæ¶ˆè´¹è€…ä¹Ÿéœ€è¦é›†æˆKafkaå®¢æˆ·ç«¯åº“ï¼Œé€šè¿‡æ¥å£å‘Brokerè·å–æ¶ˆæ¯è¿›è¡Œæ¶ˆè´¹\n![image.png](https://raw.githubusercontent.com/lyydsheep/pic/main/20250105141657.png)\né€šè¿‡ä¸Šå›¾å¯å¾—å‡ºä¸€ä¸‹ç»“è®ºï¼š\n1. ä¸åŒçš„æ¶ˆè´¹è€…å¯ä»¥åœ¨åŒä¸€æ—¶åˆ»å¯¹åŒä¸€Topicè¿›è¡Œæ¶ˆè´¹\n2. ä¸€ä¸ªæ¶ˆè´¹è€…å¯ä»¥åœ¨åŒä¸€æ—¶åˆ»å¯¹ä¸€ä¸ªTopicä¸‹çš„ä¸åŒPartitionè¿›è¡Œæ¶ˆè´¹\n3. ä¸€ä¸ªæ¶ˆè´¹è€…åŒæ—¶æ¶ˆè´¹å¤šä¸ªPartitionæ˜¯æ— æ³•ä¿è¯æ¶ˆæ¯æœ‰åºæ€§çš„\n4. ä¸€ä¸ªæ¶ˆè´¹è€…åªæ¶ˆè´¹ä¸€ä¸ªPartitionï¼Œæ¶ˆè´¹é¡ºåºå³ç”Ÿäº§é¡ºåºï¼Œæ˜¯æœ‰åºçš„\n\n**æ‹‰è¿˜æ˜¯æ¨**ï¼Ÿ\næ¶ˆè´¹è€…æ¶ˆè´¹æ¶ˆæ¯æ˜¯é€šè¿‡**æ‹‰æ¨¡å¼**è¿›è¡Œçš„ï¼Œä¹Ÿå°±æ˜¯è¯´ï¼Œæ¶ˆè´¹è€…å…ˆå‘Brokerå‘é€æ‹‰å–æ¶ˆæ¯çš„ä¿¡å·ï¼Œæ¥ç€Brokerå†å°†æ¶ˆæ¯å‘é€ç»™æ¶ˆè´¹è€…ï¼Œè€Œä¸æ˜¯Brokerä¸»åŠ¨å‘æ¶ˆè´¹è€…æ¨é€æ¶ˆæ¯ã€‚\né€‰æ‹©è¿™ç§æ‹‰æ¨¡å¼çš„ä¸»è¦åŸå› åœ¨äºï¼Œæ¶ˆè´¹è€…å¯ä»¥æ ¹æ®è‡ªèº«çš„èµ„æºåˆ©ç”¨ç‡ï¼ˆCPUã€å†…å­˜ç­‰ï¼‰é€‚æ—¶åœ°å‘Brokeræ‹‰å–æ¶ˆæ¯ï¼Œè°ƒèŠ‚æ¶ˆè´¹é€Ÿåº¦ï¼Œé¿å…å› æ¶ˆè´¹é€Ÿåº¦ä¸åˆé€‚å¯¼è‡´èµ„æºæµªè´¹æˆ–è¶…è½½\n\n**æ¶ˆè´¹è€…Offset**\nåœ¨Partitionä¸­ï¼Œä½äºOffsetä¹‹å‰çš„æ¶ˆæ¯éƒ½å·²ç»è¢«æ¶ˆè´¹è¿‡äº†ï¼Œè€Œä¹‹åçš„æ¶ˆæ¯åˆ™æ²¡æœ‰è¢«æ¶ˆè´¹ã€‚æ¶ˆè´¹è€…ç»„æ¯æ¶ˆè´¹å®Œä¸€ä¸ªæ¶ˆæ¯åï¼Œå°±å‘Brokeræä¾›è¯¥æ¶ˆæ¯çš„Offsetï¼Œè¡¨ç¤ºè¯¥æ¶ˆæ¯å·²ç»æ¶ˆè´¹è¿‡äº†ã€‚æ¶ˆè´¹è€…ä¸‹ä¸€æ¬¡æ‹‰å–çš„æ¶ˆæ¯å°±æ˜¯Partitionä¸­Offsetçš„ä¸‹ä¸€ä½ã€‚æ¶ˆè´¹è€…å®Œæˆæ¶ˆè´¹åï¼Œå°±å°†è¯¥æ¶ˆæ¯çš„â€œPartition + Offsetâ€å­—æ®µä¿¡æ¯å‘é€ç»™Brokerï¼Œç”±Brokerè´Ÿè´£æ›´æ–°å¯¹åº”Partitionçš„Offset\n![image.png](https://raw.githubusercontent.com/lyydsheep/pic/main/20250105144221.png)\n\n**ä¸»åŠ¨æäº¤å’Œè¢«åŠ¨æäº¤**\næ¶ˆè´¹è€…ç»„æäº¤Offsetåˆ†ä¸ºä¸¤ç§æ–¹å¼ï¼š\n - è¢«åŠ¨æäº¤\n - ä¸»åŠ¨æäº¤\nè¢«åŠ¨æäº¤å°±æ˜¯å®šæ—¶å‘¨æœŸæ€§åœ°å‘Brokeræäº¤æœ€æ–°å·²å¤„ç†çš„æ¶ˆæ¯ã€‚ä½†æ˜¯è¿™ç§æäº¤æ–¹å¼å­˜åœ¨ä¸€è‡´æ€§é—®é¢˜ï¼Œä¾‹å¦‚æ¶ˆè´¹è€…æ­£åœ¨å¤„ç†offsetä¸º5çš„æ¶ˆæ¯ï¼Œæ­¤æ—¶å‘ç”Ÿäº†è¢«åŠ¨æäº¤ï¼Œéœ€è¦å‘ŠçŸ¥Brokerå°†Offsetæ›´æ–°ä¸º5ï¼Œä½†å®é™…ä¸Šoffsetä¸º5çš„æ¶ˆæ¯è¿˜æ²¡æœ‰å®Œå…¨å¤„ç†å®Œã€‚å¦‚æœæ­¤æ—¶å‘ç”Ÿäº†å´©æºƒé‡å¯ï¼Œé‚£ä¹ˆè¯¥æ¶ˆæ¯å°±ä¼šè¢«ä¸¢å¤±ã€‚\n\næ‰‹åŠ¨æäº¤åˆ™æ˜¯ä¸€ç§æ›´ä¸ºç¨³å¦¥çš„æ–¹å¼ï¼Œå½“æŸæ¡æ¶ˆæ¯å½»åº•å¤„ç†å¥½åï¼Œå†ä¸»åŠ¨å‘Brokeræäº¤æ¶ˆæ¯ï¼Œé¿å…å‡ºç°ä¸ä¸€è‡´çš„æƒ…å†µã€‚\n![image.png](https://raw.githubusercontent.com/lyydsheep/pic/main/20250105150142.png)\n\n**æ¶ˆè´¹è€…ç»„ConsumerGroup**\næ¶ˆè´¹è€…ç»„å®è´¨å°±æ˜¯ç”±å¤šä¸ªæ¶ˆè´¹è€…ç»„æˆçš„é›†åˆï¼Œä¸€ä¸ªæ¶ˆè´¹è€…ç»„ç”±ä¸€ä¸ªGroupIDå”¯ä¸€æ ‡è¯†ã€‚\nå¤šä¸ªæ¶ˆè´¹è€…ç»„æˆæ¶ˆè´¹è€…ç»„ï¼Œé‚£ä¹ˆè¿™äº›æ¶ˆè´¹è€…å¿…é¡»æœ‰ä¸€äº›çº¦æŸï¼š\n- åœ¨åŒä¸€ä¸ªæ¶ˆè´¹è€…ç»„ä¸­ï¼Œä¸€ä¸ªPartitionåªèƒ½åˆ†é…ä¸€ä¸ªæ¶ˆè´¹è€…\n- åŒä¸€ä¸ªæ¶ˆè´¹è€…ç»„ä¸­ï¼Œå¯ä»¥åˆ†æ´¾å¤šä¸ªæ¶ˆè´¹è€…\n- ä¸åŒæ¶ˆè´¹è€…ç»„å¯ä»¥åŒæ—¶æ¶ˆè´¹åŒä¸€ä¸ªTopic\næ¶ˆè´¹è€…ç»„åœ¨æ¶ˆè´¹è€…æ–¹é¢è¿›è¡Œäº†æ°´å¹³æ‰©å®¹ï¼Œæé«˜äº†æ¶ˆè´¹èƒ½åŠ›ã€‚\n\næ¶ˆè´¹è€…ç»„å’‹çœ¼ä¸€çœ‹æ²¡å¤šå¤§ç”¨å¤„ï¼Œå®é™…ä¸Šï¼Œæ¶ˆè´¹è€…ç»„å¸¦æ¥çš„æœ€å¤§ä¾¿åˆ©åœ¨äºå¯¹åˆ†åŒºçš„å°è£…æ€§ï¼Œä¸€ä¸ªæ¶ˆè´¹è€…ç»„å¯ä»¥è‡ªåŠ¨å®Œæˆ**Re balance**æ“ä½œï¼Œä½¿å¾—Partitionå¯¹äºæ¶ˆè´¹è€…æ˜¯é€æ˜çš„ã€‚åä¹‹ï¼Œæ¶ˆè´¹è€…æ¯æ¬¡æ‹‰å–æ¶ˆæ¯éƒ½è¦æŒ‡å®šPartitionï¼Œè¿™å°±å¯¼è‡´Partitionå’Œæ¶ˆè´¹è€…è€¦åˆåœ¨ä¸€å—ï¼ŒPartitionæ•°é‡å‘ç”Ÿå˜åŠ¨ï¼Œæ¶ˆè´¹è€…æ–¹é¢çš„ä»£ç å°±è¦éšä¹‹å˜åŠ¨\n\n**æ¶ˆè´¹è€…ç»„åˆ†åŒºåˆ†é…ç­–ç•¥**\n partition.assignment.strategyå­—æ®µå¯ä»¥é…ç½®æ¶ˆè´¹è€…ç»„ä¸­å¤šä¸ªæ¶ˆè´¹è€…å¯¹äºåˆ†åŒºåˆ†é…çš„è§„åˆ™ï¼š\n - Range Assignorï¼šåŸºäºèŒƒå›´çš„åˆ†é…ç­–ç•¥\n - Round Robin Assignorï¼šåŸºäºè½®è¯¢çš„åˆ†é…ç­–ç•¥\n - Sticky Assignorï¼šä¼˜å…ˆä¿æŒå½“å‰çš„åˆ†é…çŠ¶æ€ï¼Œå°½é‡å‡å°‘Rebalanceè¿‡ç¨‹ä¸­åˆ†åŒºçš„ç§»åŠ¨\n - CooperativeSticky Assignorï¼šåŸºæœ¬å’ŒSticky Assignorç­–ç•¥ä¸€è‡´ï¼Œä½†æ˜¯åŒºåˆ«åœ¨äºè¯¥åè®®å°†åŸæ¥ä¸€æ¬¡è¡Œå¯¹ä¸€å¤§ç‰‡åˆ†åŒºè¿›è¡ŒRebalanceæ”¹ä¸ºå¤šæ¬¡å°è§„æ¨¡çš„Rebalanceæ“ä½œï¼Œå³æ¸è¿›å¼Rebalance\n\n## Rebalanceæœºåˆ¶\n Rebalanceæœºåˆ¶ç”¨äºç¡®ä¿æ•°æ®åœ¨æ¶ˆè´¹è€…ç»„ä¸­å°½å¯èƒ½åœ°è´Ÿè½½å‡è¡¡\n è§¦å‘Rebalanceçš„ä¸‰ä¸ªæ—¶æœºï¼š\n - åŠ å…¥æ–°çš„æ¶ˆè´¹è€…\n - æ¶ˆè´¹è€…å‡å°‘ï¼Œä¸è®ºæ˜¯æ­£å¸¸å…³é—­è¿˜æ˜¯å´©æºƒ\n - Topicä¸‹çš„Partitionæ•°é‡å‘ç”Ÿå˜åŒ–\n\n**å†å¹³è¡¡çš„æ­¥éª¤**\nå†å¹³è¡¡æ“ä½œéœ€è¦ç»å†äº”ä¸ªé˜¶æ®µï¼š\n1. æš‚åœæ¶ˆè´¹ï¼Œæ¶ˆè´¹è€…éœ€è¦æš‚åœæ­£åœ¨è¿›è¡Œçš„æ¶ˆè´¹ï¼Œé˜²æ­¢é‡æ–°åˆ†é…è¿‡ç¨‹ä¸­å‡ºç°æ•°æ®ä¸¢å¤±æˆ–é‡å¤é—®é¢˜\n2. è§¦å‘å†åˆ†é…ï¼Œç”±æ¶ˆè´¹è€…ç»„åè°ƒå™¨Group Coordinatorï¼ˆé€šå¸¸æ˜¯ä¸€ä¸ªBrokerï¼‰è§¦å‘å†å¹³è¡¡\n3. åˆ†é…åˆ†åŒºï¼Œæ¶ˆè´¹è€…é…åˆåè°ƒå™¨æ ¹æ®å½“å‰æ¶ˆè´¹è€…å’Œåˆ†åŒºæ•°é‡ï¼Œé‡æ–°åˆ†é…ä¸»é¢˜çš„åˆ†åŒº\n4. è·å–åˆ†é…ä¿¡æ¯ï¼Œé‡æ–°åˆ†é…å®Œæˆåï¼Œæ¶ˆè´¹è€…ä¼šä»åè°ƒå™¨æ‹¿åˆ°æ–°çš„åˆ†åŒºåˆ†é…æƒ…å†µ\n5. æ¢å¤æ¶ˆè´¹ï¼Œæ¶ˆè´¹è€…æ”¶åˆ°æ–°çš„åˆ†é…åï¼Œæ¢å¤æ¶ˆè´¹ï¼Œå¼€å§‹å¤„ç†æ–°åˆ†åŒº\n\nä¸Šæ–‡æåˆ°æœ‰å››ç§æ¶ˆè´¹ç»„åˆ†åŒºåˆ†é…ç­–ç•¥ï¼Œè¿™å››ç§åˆ†é…ç­–ç•¥å¯ä»¥ä¾æ®æ˜¯å¦äº§ç”ŸSTWé—®é¢˜åˆ†ä¸ºEagerå’ŒIncrementalä¸¤ç§å†å¹³è¡¡ç­–ç•¥ã€‚å…¶ä¸­å‰ä¸‰ç§æ–¹æ¡ˆéƒ½æ˜¯Eagerç­–ç•¥ï¼Œå› ä¸ºè¿™ä¸‰ç§åˆ†é…ç­–ç•¥åœ¨æš‚åœæ¶ˆè´¹è€…é˜¶æ®µä¼šåœæ­¢æ‰€æœ‰çš„æ¶ˆè´¹è¡Œä¸ºï¼Œè€ŒCooperative Stickyæ–¹å¼åˆ™åªä¼šæš‚åœéƒ¨åˆ†æ¶ˆè´¹è€…ï¼Œæœªè¢«æš‚åœçš„æ¶ˆè´¹è€…ä»èƒ½ç»§ç»­æ¶ˆè´¹è¡Œä¸ºï¼Œä½†ä»£ä»·æ˜¯Rebalanceçš„æ—¶é—´è¢«å»¶é•¿\n\n**Group Coordinatoræ˜¯ä»€ä¹ˆ**ï¼Ÿ\n","source":"_posts/Kafkaç†è®ºçŸ¥è¯†.md","raw":"## æ•´ä½“æ¶æ„\nå®è§‚ä¸Šå¯ä»¥å°†Kafkaåˆ†æˆä¸‰ä¸ªéƒ¨åˆ†ï¼šç”Ÿäº§è€…ã€ä¸­é—´æœåŠ¡å±‚ã€æ¶ˆè´¹è€…\nä¸­é—´æœåŠ¡å±‚ç›¸å½“äºä¸€ä¸ªâ€œæ¶ˆæ¯ä¸­è½¬ç«™â€ï¼Œä½†ä¸åŒä¹‹å¤„åœ¨äºï¼Œä¸­é—´æœåŠ¡å±‚ä¼šå°†æ¶ˆæ¯æŒä¹…åŒ–å­˜å‚¨\n\nä¸­é—´æœåŠ¡å±‚ç”±å¤šä¸ªéƒ¨ä»¶æ„æˆï¼š\n- brokerï¼šå¯ä»¥ç†è§£ä¸ºæ˜¯ä¸€ä¸ªèŠ‚ç‚¹ï¼Œå³è¿è¡ŒKafkaç¨‹åºçš„æœåŠ¡å™¨\n- topicï¼šå¯¹æ¶ˆæ¯è¿›è¡Œé€»è¾‘åˆ†ç±»çš„ç²—ç²’åº¦å•ä½ï¼Œå¯ç”¨äºå®ç°è´Ÿè½½å‡è¡¡ã€æ¶ˆæ¯å¹¶è¡Œå¤„ç†ã€‚æ¶ˆè´¹è€…è®¢é˜…æŸä¸€ä¸ªä¸»é¢˜è¿›è¡Œæ¶ˆè´¹ã€‚ç”Ÿäº§è€…å‘æŒ‡å®šçš„ä¸»é¢˜å†™å…¥æ¶ˆæ¯\n- partitionï¼šæ¶ˆæ¯ä¸Šç‰©ç†ä¸Šå­˜å‚¨çš„ç©ºé—´ï¼Œä¸€ä¸ªpartitionå¯¹åº”ç€ä¸€ä¸ªtopicï¼Œä¸€ä¸ªtopicå¯ä»¥æœ‰å¤šä¸ªpartitionã€‚partitionå¯¹äºç”Ÿäº§è€…å’Œæ¶ˆè´¹è€…æ˜¯é€æ˜çš„ã€æ— æ³•æ„ŸçŸ¥çš„ã€‚\n\t- æ¯ä¸ªpartitionå­˜å‚¨ç€æœ‰åºã€ä¸å¯å˜çš„æ¶ˆæ¯åºåˆ—\n\t- partitionå¯è¢«ç‹¬ç«‹è¯»å†™\n\nbrokerã€topicã€partitionä¸‰è€…ä¹‹é—´çš„å…³ç³»å¦‚ä¸‹ï¼š\n\n![image.png](https://raw.githubusercontent.com/lyydsheep/pic/main/20250104150207.png)\n## Topic\nåœ¨Kafkaä¸­ï¼ŒTopicå°±æ˜¯ä¸€ä¸ªä¸»é¢˜ï¼Œå±äºé€»è¾‘ä¸Šçš„æ¦‚å¿µï¼Œå¹¶ä¸å­˜åœ¨ä»»ä½•ä¸€å°ç‰©ç†è®¾å¤‡ä¸Šã€‚ä½œä¸ºä½¿ç”¨è€…ï¼Œæˆ‘ä»¬å¯ä»¥å°†åŒä¸šåŠ¡çš„æ¶ˆæ¯æ”¾å…¥åŒä¸€ä¸ªtopicï¼Œä¾‹å¦‚ç§’æ€ä¸šåŠ¡ã€å”®ç¥¨ä¸šåŠ¡ç­‰ï¼Œé€šè¿‡è¿™ä¸ªé€»è¾‘ä¸Šçš„æ¦‚å¿µï¼Œå¯ä»¥ç²—ç²’åº¦åœ°å°†æ•°æ®æ¶ˆæ¯è¿›è¡Œåˆ†ç‰‡ï¼Œåˆ†é—¨åˆ«ç±»åœ°å¤„ç†æ¶ˆæ¯ã€‚\n\n## Partition\nå¯¹æ•°æ®è¿›è¡Œé€»è¾‘Topicåˆ†åŒºåï¼Œä¸€ä¸ªä¸šåŠ¡çš„æ•°æ®é‡å¯èƒ½ä»ç„¶åºå¤§ï¼Œä¸ºäº†å¯¹æ•°æ®è¿›ä¸€æ­¥åˆ†è€Œæ²»ä¹‹ï¼Œè®¾è®¡Kafkaçš„å¤§ä½¬å†³å®šå°†Topicçš„æ•°æ®å®é™…ç‰©ç†å­˜å‚¨åœ¨ä¸€ä¸ªä¸ªPartitionä¸­ã€‚Partitionå°±ç›¸å½“äºå¯¹ç²—ç²’åº¦åˆ’åˆ†çš„æ•°æ®å†è¿›è¡Œä¸€æ¬¡ç»†ç²’åº¦åŒºåˆ†ã€‚ç”±äºTopicæ˜¯ä¸€ä¸ªé€»è¾‘ä¸Šçš„æ¦‚å¿µï¼Œå¹¶ä¸å­˜åœ¨äºæŸä¸€ä¸ªå…·ä½“çš„brokerä¸Šï¼Œå› æ­¤åœ¨é›†ç¾¤æ¨¡å¼ä¸‹ï¼ŒåŒä¸€ä¸ªTopicä¸‹çš„å¤šä¸ªPartitionæ˜¯ç‹¬ç«‹çš„ï¼Œå®Œå…¨å¯ä»¥åœ¨ä¸åŒçš„brokerä¸Šã€‚\n\nåˆ†ç‰‡çš„å¥½å¤„ï¼š\n- æé«˜å†™å…¥æ€§èƒ½ï¼Œä¸åŒçš„partitionåˆ†å¸ƒåœ¨ä¸åŒçš„brokerä¸Šï¼Œå¯ä»¥å®ç°å¹¶è¡Œå†™å…¥ï¼Œæé«˜äº†ç³»ç»Ÿååé‡\n- æé«˜æ¶ˆè´¹è€…å¹¶å‘åº¦ï¼Œå› ä¸ºæœ‰äº†ä¸åŒçš„åˆ†ç‰‡ï¼Œä¸åŒçš„æ¶ˆè´¹è€…å¯ä»¥å¯¹ä¸åŒçš„åˆ†ç‰‡åŒæ—¶æ¶ˆè´¹\n- æé«˜äº†Kafkaæ°´å¹³æ‰©å±•èƒ½åŠ›\n- æé«˜äº†ç³»ç»Ÿçš„å®¹é”™èƒ½åŠ›ï¼Œå¼•å…¥partitionåï¼ŒåŒä¸€ä¸ª Topicä¸‹ä¸åŒpartitionä¸­çš„æ•°æ®è§£è€¦åˆï¼Œå³ä½¿ä¸€ä¸ªpartitionå´©æºƒäº†ï¼Œä¹Ÿä¸å½±å“å…¶ä»–partitionè¿ä½œ\n\nä¸€ä¸ªPartitionå°±ç›¸å½“äºä¸€ä¸ªé˜Ÿåˆ—ï¼Œæœ€æ–°çš„æ•°æ®è¢«å†™åœ¨é˜Ÿåˆ—çš„æœ«å°¾ï¼Œå³åŒä¸€ä¸ªPartitionä¸‹çš„æ•°æ®æ˜¯æœ‰åºçš„ï¼Œä½†ç»¼åˆæ¥çœ‹ï¼ŒåŒä¸€ä¸ªTopicä¸‹çš„æ‰€æœ‰Partitionä¸­çš„æ•°æ®æ˜¯æ— åºçš„\n![image.png](https://raw.githubusercontent.com/lyydsheep/pic/main/20250104192916.png)\n\nç”±äºPartitionå¯¹äºç”Ÿäº§è€…æ˜¯é€æ˜çš„ï¼Œé‚£ä¹ˆç”Ÿäº§è€…å‘ä¸€ä¸ªTopicå†™å…¥æ•°æ®ï¼Œæ•°æ®æœ€ç»ˆä¼šæµå‘ä½•å¤„å‘¢ï¼Ÿ\nå¦‚æœç”Ÿäº§è€…å‘Topicå‘é€æ¶ˆæ¯æ—¶æ²¡æœ‰æŒ‡å®šKeyï¼Œé‚£ä¹ˆKafkaæœåŠ¡å°±ä¼šé»˜è®¤é‡‡å–**è½®è¯¢Partition**çš„æ–¹å¼å°†æ•°æ®å†™å…¥åˆ°Partitionä¸­ã€‚\nå¦‚æœç”Ÿäº§è€…æŒ‡å®šäº†å‘é€çš„Keyï¼Œé‚£ä¹ˆæ¶ˆæ¯å°±ä¼šè¢«å†™å…¥åˆ°å°†Keyè¿›è¡Œå“ˆå¸Œè¿‡åå¯¹åº”çš„Partitionä¸­\n\n## Broker\nBrokerå®é™…å°±æ˜¯ä¸€ä¸ªè¿è¡ŒKafkaç¨‹åºçš„æœåŠ¡å™¨èŠ‚ç‚¹ï¼ŒBrokeréœ€è¦æä¾›å¦‚ä¸‹åŠŸèƒ½ï¼š\n1. æ¥å—æ¥è‡ªå®¢æˆ·ç«¯çš„è¿æ¥\n2. æ”¯æŒå®¢æˆ·ç«¯æŸ¥è¯¢Kafkaé›†ç¾¤çš„ä¿¡æ¯ï¼Œæ¯”å¦‚æŸ¥è¯¢å…¶ä»–Brokerä¿¡æ¯\n3. å“åº”æ¥è‡ªå®¢æˆ·ç«¯çš„å‘½ä»¤è¯·æ±‚\n4. å­˜å‚¨æ¶ˆæ¯ï¼Œå³å°†æ¶ˆæ¯æŒä¹…åŒ–å­˜å‚¨åœ¨æœ¬åœ°æœåŠ¡å™¨ä¸Š\n\nåœ¨é›†ç¾¤éƒ¨ç½²æ¨¡å¼ä¸‹ï¼Œæ¯ä¸€ä¸ªBrokeréƒ½æœ‰å”¯ä¸€çš„IDæ ‡è¯†è‡ªå·±èº«ä»½ã€‚Partitionæ˜¯å­˜æ”¾åœ¨BrokerèŠ‚ç‚¹ä¸Šçš„ï¼Œä¸€ä¸ªPartitionå¯¹åº”ä¸€ä¸ªBrokerï¼Œä¸€ä¸ªBrokerå¯èƒ½å­˜æ”¾ç€å¤šä¸ªPartition\né’ˆå¯¹äºä¸€ä¸ªTopicä¸‹çš„å¤šä¸ªPartitionï¼Œéœ€è¦å…ˆéšæœºé€‰å–ä¸€ä¸ªBrokerï¼ˆæ¯”å¦‚æ˜¯Broker10ï¼‰å­˜æ”¾Partition_0ï¼Œæ¥ç€æŒ‰ç…§Brokerçš„IDé¡ºåºä¾æ¬¡å­˜æ”¾Partitionï¼Œå³Broker11å­˜æ”¾Partition_1ã€Broker12å­˜æ”¾Partition_2ï¼Œä»¥æ­¤ç±»æ¨ã€‚\n\nå‰æ–‡æåŠäº†ï¼Œæ¶ˆè´¹è€…åœ¨å‘é€æ¶ˆæ¯æ—¶å¯ä»¥æŒ‡å®šKeyï¼Œç›¸å½“äºå°†æ¶ˆæ¯å‘é€åˆ°æŒ‡å®šçš„Partitionä¸Šã€‚é‚£ä¹ˆå®¢æˆ·ç«¯æ˜¯å¦‚ä½•åœ¨Kafkaé›†ç¾¤ä¸­å¿«é€Ÿæ‰¾åˆ°ç›®æ ‡Partitionæ‰€åœ¨çš„BrokerèŠ‚ç‚¹å‘¢ï¼Ÿ\né€šå¸¸å®¢æˆ·ç«¯è¿æ¥é›†ç¾¤æœ‰ä¸‰ç§æ–¹å¼ï¼š\n1. å¼•å…¥ä»£ç†ï¼Œä»£ç†å’Œä¼—å¤šBrokeræ‰“äº¤é“\n2. é‡å®šå‘ï¼Œå®¢æˆ·ç«¯å‘é€å‘½ä»¤åˆ°æŸä¸€ä¸ªèŠ‚ç‚¹ä¸Šï¼Œå¦‚æœè¯¥èŠ‚ç‚¹ä¸æ˜¯ç›®æ ‡èŠ‚ç‚¹ï¼Œé‚£ä¹ˆè¯¥èŠ‚ç‚¹ä¼šå‘ŠçŸ¥å®¢æˆ·ç«¯æœ¨ç¬”å“¦èŠ‚ç‚¹å…·ä½“åœ°å€ï¼ˆRedisï¼‰\n3. æŸ¥è¯¢è·¯ç”±è¡¨ï¼Œå®¢æˆ·ç«¯å…ˆæŸ¥è¯¢è·¯ç”±è¡¨ï¼Œç›´æ¥å‘ç›®æ ‡èŠ‚ç‚¹å‘é€è¯·æ±‚å‘½ä»¤ï¼ˆKafkaï¼‰\n\nKafkaé€‰æ‹©ç¬¬ä¸‰ç§æ–¹å¼çš„ä¸€ä¸ªå¥‘æœºæ˜¯ï¼Œåœ¨Kafkaé›†ç¾¤ä¸­ï¼Œæ¯ä¸€ä¸ªBrokeréƒ½æ”¯æŒå®¢æˆ·ç«¯æŸ¥è¯¢Kafkaé›†ç¾¤çš„ä¿¡æ¯ï¼Œå³æ¯ä¸€ä¸ªBrokeréƒ½çŸ¥æ™“å…¶ä»–Brokerçš„ä¿¡æ¯ã€‚è¿™äº›ä¿¡æ¯éƒ½è¢«ç»´æŠ¤åœ¨æ¯ä¸€ä¸ªBrokerçš„è·¯ç”±è¡¨ä¸­ï¼Œäº†è§£äº†è¿™ä¸€ç‚¹ï¼Œå®¢æˆ·ç«¯å‘é€è¯»å†™å‘½ä»¤çš„è¿‡ç¨‹å°±å‘¼ä¹‹æ¬²å‡ºäº†ï¼š\n1. ä»»æ„è®¿é—®ä¸€å°Broker\n2. ä»è¿™å°Brokerä¸­è·å–è·¯ç”±è¡¨\n3. æ ¹æ®è§„åˆ™æ‰¾åˆ°ç›®æ ‡Partitionï¼Œåœ¨è·¯ç”±è¡¨ä¸­æ‰¾åˆ°å“ªä¸ªBrokerä¸Šå­˜æœ‰ç›®æ ‡Partitionï¼Œæœ€åå‘é€è¯»å†™å‘½ä»¤\n\t1. æ‰¾Partitionçš„è§„åˆ™å°±æ˜¯ä¸Šæ–‡è®²çš„**è½®è¯¢æˆ–å“ˆå¸ŒKey**è§„åˆ™\n\n## ç”Ÿäº§è€…Producer\n\nç”Ÿäº§è€…å‘é€ä¸€æ¡æ¶ˆæ¯éœ€è¦å†ç»ä¸‰ä¸ªæ­¥éª¤ï¼š\n- æ„å»ºæ¶ˆæ¯ï¼šå°†éœ€è¦å‘é€çš„ä¿¡æ¯æ‰“åŒ…æˆKafkaæ¶ˆæ¯ç»“æ„\n- åºåˆ—åŒ–æ¶ˆæ¯ï¼šå°†æ¶ˆæ¯åºåˆ—åŒ–æˆäºŒè¿›åˆ¶æ•°æ®ï¼Œä»¥ä¾¿åœ¨ç½‘ç»œä¸­ä¼ è¾“\n- å¯»æ‰¾Brokerï¼šæ ¹æ®è§„åˆ™æ‰¾åˆ°ç›®æ ‡åˆ†åŒºï¼Œæ¥ç€ä¾æ®è·¯ç”±è¡¨å°†æ¶ˆæ¯å‘é€åˆ°Partitionå¯¹åº”çš„Broker\n\n**æ„å»ºæ¶ˆæ¯**\nç”Ÿäº§è€…éœ€è¦å°†å‘é€çš„ä¿¡æ¯æ‰“åŒ…æˆKafkaæ¶ˆæ¯ç»“æ„ï¼Œæ¥ä¸‹æ¥å°±è¯¦ç»†çœ‹çœ‹æ¶ˆæ¯ç»“æ„çš„å…·ä½“ç»„æˆï¼š\n![image.png](https://raw.githubusercontent.com/lyydsheep/pic/main/20250105102410.png)\n\n- Keyï¼šæ ¹æ®Keyçš„å“ˆå¸Œå€¼ï¼ˆå–æ¨¡ï¼‰ç¡®å®šå‘é€åˆ°Topicä¸‹çš„å“ªä¸€ä¸ªPartitionä¸Šï¼Œä¸€èˆ¬æ˜¯å­—ç¬¦ä¸²ç±»å‹ï¼Œæœ€ç»ˆä¼šè¢«åºåˆ—åŒ–ä¸ºäºŒè¿›åˆ¶æ•°æ®\n- Valueï¼šå®é™…å‘é€çš„æ•°æ®\n- Compression Typeï¼šæŒ‡å®šå‹ç¼©ç®—æ³•ï¼Œè¯¥å­—æ®µè¡¨æ˜é‡‡ç”¨ä»€ä¹ˆå‹ç¼©ç®—æ³•å¯¹æ•°æ®è¿›è¡Œå‹ç¼©ï¼Œæšä¸¾å€¼ï¼šNoneã€gzipã€lz4ç­‰\n- Headerï¼šç”Ÿäº§è€…é¢å¤–æƒ³ä¼ è¾“çš„æ•°æ®å°±æ”¾åœ¨Headerä¸­ï¼Œæ¯”å¦‚TraceID\n- Partition+Offsetï¼šè¯¥å­—æ®µåœ¨ç”Ÿäº§å‡ºæ¥çš„æ—¶å€™æ˜¯ç©ºçš„ï¼Œæ¶ˆæ¯å‘é€åˆ°KafkaæœåŠ¡ç«¯åæ‰ä¼šå°†å…·ä½“çš„åˆ†åŒºã€åç§»é‡å†™å…¥è¯¥å­—æ®µã€‚Topic + Partition + Offsetå”¯ä¸€ç¡®å®šä¸€æ¡æ¶ˆæ¯\n\n**åºåˆ—åŒ–**\nåºåˆ—åŒ–å°±æ˜¯å°†æ¶ˆæ¯ä»å¸¸è§„ç±»å‹è½¬æ¢è‡³äºŒè¿›åˆ¶ç±»å‹ï¼Œä»¥åœ¨ç½‘ç»œä¸­ä¼ è¾“\n\n**å‘é€æ¨¡å¼**\nåœ¨Goã€Javaçš„SDKä¸­æä¾›äº†ä¸‰ç§æ¶ˆæ¯å‘é€æ¨¡å¼ï¼š\n1. åŒæ­¥å‘é€ï¼Œç”Ÿäº§è€…å‘é€æ¶ˆæ¯åï¼Œæ‰§è¡Œé˜»å¡æ“ä½œï¼Œç­‰å¾…KafkaæœåŠ¡ç«¯è¿”å›å‘é€æ¶ˆæ¯æˆåŠŸæˆ–å¼‚å¸¸ç»“æœã€‚é€‚ç”¨äºç”Ÿäº§è€…éœ€è¦ç¡®ä¿æˆåŠŸå‘é€æ¶ˆæ¯æ‰èƒ½æ‰§è¡Œåç»­æ“ä½œçš„åœºæ™¯ã€‚\n2. å‘äº†å°±å¿˜ï¼Œç”Ÿäº§è€…å‘å®Œæ¶ˆæ¯å°±ç»§ç»­æ‰§è¡Œåç»­æ“ä½œï¼Œä¸ç†ä¼šæ¶ˆæ¯æ˜¯å¦å‘é€æˆåŠŸï¼Œä¹Ÿä¸é‡‡å–æªæ–½åº”å¯¹å‘é€å¼‚å¸¸\n3. å¼‚æ­¥å‘é€ï¼Œç”Ÿäº§è€…å‘é€æ¶ˆæ¯çš„åŒæ—¶æ³¨å†Œå›è°ƒå‡½æ•°ï¼Œä¸æ‰§è¡Œé˜»å¡æ“ä½œï¼Œè€Œæ˜¯ç»§ç»­æ‰§è¡Œåç»­çš„æ“ä½œã€‚å½“KafkaæœåŠ¡ç«¯è¿”å›å‘é€æ¶ˆæ¯çš„ç»“æœåï¼Œæ‰§è¡Œå¯¹åº”å›è°ƒå‡½æ•°çš„å†…å®¹\n\nä¸‰ç§å‘é€æ¨¡å¼å®é™…ä¸Šå°±æ˜¯**é«˜æ€§èƒ½å’Œå¯é æ€§**ä¹‹é—´çš„æƒè¡¡ã€‚åŒæ­¥å‘é€æ¨¡å¼å¯é æ€§å¼ºï¼Œä½†æ˜¯æ•ˆç‡ä¸é«˜ï¼Œé€‚ç”¨äºä¿æŒæ•°æ®ä¸€è‡´æ€§çš„åœºæ™¯ï¼›å‘äº†å°±å¿˜æ€§èƒ½é«˜ï¼Œå¯æ˜¯ä¸ä¿è¯å¯é æ€§ï¼Œå› æ­¤é€‚åˆåœ¨è¦æ±‚é«˜æ€§èƒ½çš„åœºæ™¯ä¸‹ä½¿ç”¨ï¼›å¼‚æ­¥å‘é€å°±æ˜¯åœ¨äºŒè€…ä¹‹é—´çš„æŠ˜ä¸­åŠæ³•ï¼Œä½¿ç”¨äºåœ¨éœ€è¦æ—¶å¤„ç†æ¶ˆæ¯å‘é€å¤±è´¥çš„æƒ…å†µ\n\n## æ¶ˆè´¹è€…Consumer\nå’Œç”Ÿäº§è€…ä¸€æ ·ï¼Œæ¶ˆè´¹è€…ä¹Ÿéœ€è¦é›†æˆKafkaå®¢æˆ·ç«¯åº“ï¼Œé€šè¿‡æ¥å£å‘Brokerè·å–æ¶ˆæ¯è¿›è¡Œæ¶ˆè´¹\n![image.png](https://raw.githubusercontent.com/lyydsheep/pic/main/20250105141657.png)\né€šè¿‡ä¸Šå›¾å¯å¾—å‡ºä¸€ä¸‹ç»“è®ºï¼š\n1. ä¸åŒçš„æ¶ˆè´¹è€…å¯ä»¥åœ¨åŒä¸€æ—¶åˆ»å¯¹åŒä¸€Topicè¿›è¡Œæ¶ˆè´¹\n2. ä¸€ä¸ªæ¶ˆè´¹è€…å¯ä»¥åœ¨åŒä¸€æ—¶åˆ»å¯¹ä¸€ä¸ªTopicä¸‹çš„ä¸åŒPartitionè¿›è¡Œæ¶ˆè´¹\n3. ä¸€ä¸ªæ¶ˆè´¹è€…åŒæ—¶æ¶ˆè´¹å¤šä¸ªPartitionæ˜¯æ— æ³•ä¿è¯æ¶ˆæ¯æœ‰åºæ€§çš„\n4. ä¸€ä¸ªæ¶ˆè´¹è€…åªæ¶ˆè´¹ä¸€ä¸ªPartitionï¼Œæ¶ˆè´¹é¡ºåºå³ç”Ÿäº§é¡ºåºï¼Œæ˜¯æœ‰åºçš„\n\n**æ‹‰è¿˜æ˜¯æ¨**ï¼Ÿ\næ¶ˆè´¹è€…æ¶ˆè´¹æ¶ˆæ¯æ˜¯é€šè¿‡**æ‹‰æ¨¡å¼**è¿›è¡Œçš„ï¼Œä¹Ÿå°±æ˜¯è¯´ï¼Œæ¶ˆè´¹è€…å…ˆå‘Brokerå‘é€æ‹‰å–æ¶ˆæ¯çš„ä¿¡å·ï¼Œæ¥ç€Brokerå†å°†æ¶ˆæ¯å‘é€ç»™æ¶ˆè´¹è€…ï¼Œè€Œä¸æ˜¯Brokerä¸»åŠ¨å‘æ¶ˆè´¹è€…æ¨é€æ¶ˆæ¯ã€‚\né€‰æ‹©è¿™ç§æ‹‰æ¨¡å¼çš„ä¸»è¦åŸå› åœ¨äºï¼Œæ¶ˆè´¹è€…å¯ä»¥æ ¹æ®è‡ªèº«çš„èµ„æºåˆ©ç”¨ç‡ï¼ˆCPUã€å†…å­˜ç­‰ï¼‰é€‚æ—¶åœ°å‘Brokeræ‹‰å–æ¶ˆæ¯ï¼Œè°ƒèŠ‚æ¶ˆè´¹é€Ÿåº¦ï¼Œé¿å…å› æ¶ˆè´¹é€Ÿåº¦ä¸åˆé€‚å¯¼è‡´èµ„æºæµªè´¹æˆ–è¶…è½½\n\n**æ¶ˆè´¹è€…Offset**\nåœ¨Partitionä¸­ï¼Œä½äºOffsetä¹‹å‰çš„æ¶ˆæ¯éƒ½å·²ç»è¢«æ¶ˆè´¹è¿‡äº†ï¼Œè€Œä¹‹åçš„æ¶ˆæ¯åˆ™æ²¡æœ‰è¢«æ¶ˆè´¹ã€‚æ¶ˆè´¹è€…ç»„æ¯æ¶ˆè´¹å®Œä¸€ä¸ªæ¶ˆæ¯åï¼Œå°±å‘Brokeræä¾›è¯¥æ¶ˆæ¯çš„Offsetï¼Œè¡¨ç¤ºè¯¥æ¶ˆæ¯å·²ç»æ¶ˆè´¹è¿‡äº†ã€‚æ¶ˆè´¹è€…ä¸‹ä¸€æ¬¡æ‹‰å–çš„æ¶ˆæ¯å°±æ˜¯Partitionä¸­Offsetçš„ä¸‹ä¸€ä½ã€‚æ¶ˆè´¹è€…å®Œæˆæ¶ˆè´¹åï¼Œå°±å°†è¯¥æ¶ˆæ¯çš„â€œPartition + Offsetâ€å­—æ®µä¿¡æ¯å‘é€ç»™Brokerï¼Œç”±Brokerè´Ÿè´£æ›´æ–°å¯¹åº”Partitionçš„Offset\n![image.png](https://raw.githubusercontent.com/lyydsheep/pic/main/20250105144221.png)\n\n**ä¸»åŠ¨æäº¤å’Œè¢«åŠ¨æäº¤**\næ¶ˆè´¹è€…ç»„æäº¤Offsetåˆ†ä¸ºä¸¤ç§æ–¹å¼ï¼š\n - è¢«åŠ¨æäº¤\n - ä¸»åŠ¨æäº¤\nè¢«åŠ¨æäº¤å°±æ˜¯å®šæ—¶å‘¨æœŸæ€§åœ°å‘Brokeræäº¤æœ€æ–°å·²å¤„ç†çš„æ¶ˆæ¯ã€‚ä½†æ˜¯è¿™ç§æäº¤æ–¹å¼å­˜åœ¨ä¸€è‡´æ€§é—®é¢˜ï¼Œä¾‹å¦‚æ¶ˆè´¹è€…æ­£åœ¨å¤„ç†offsetä¸º5çš„æ¶ˆæ¯ï¼Œæ­¤æ—¶å‘ç”Ÿäº†è¢«åŠ¨æäº¤ï¼Œéœ€è¦å‘ŠçŸ¥Brokerå°†Offsetæ›´æ–°ä¸º5ï¼Œä½†å®é™…ä¸Šoffsetä¸º5çš„æ¶ˆæ¯è¿˜æ²¡æœ‰å®Œå…¨å¤„ç†å®Œã€‚å¦‚æœæ­¤æ—¶å‘ç”Ÿäº†å´©æºƒé‡å¯ï¼Œé‚£ä¹ˆè¯¥æ¶ˆæ¯å°±ä¼šè¢«ä¸¢å¤±ã€‚\n\næ‰‹åŠ¨æäº¤åˆ™æ˜¯ä¸€ç§æ›´ä¸ºç¨³å¦¥çš„æ–¹å¼ï¼Œå½“æŸæ¡æ¶ˆæ¯å½»åº•å¤„ç†å¥½åï¼Œå†ä¸»åŠ¨å‘Brokeræäº¤æ¶ˆæ¯ï¼Œé¿å…å‡ºç°ä¸ä¸€è‡´çš„æƒ…å†µã€‚\n![image.png](https://raw.githubusercontent.com/lyydsheep/pic/main/20250105150142.png)\n\n**æ¶ˆè´¹è€…ç»„ConsumerGroup**\næ¶ˆè´¹è€…ç»„å®è´¨å°±æ˜¯ç”±å¤šä¸ªæ¶ˆè´¹è€…ç»„æˆçš„é›†åˆï¼Œä¸€ä¸ªæ¶ˆè´¹è€…ç»„ç”±ä¸€ä¸ªGroupIDå”¯ä¸€æ ‡è¯†ã€‚\nå¤šä¸ªæ¶ˆè´¹è€…ç»„æˆæ¶ˆè´¹è€…ç»„ï¼Œé‚£ä¹ˆè¿™äº›æ¶ˆè´¹è€…å¿…é¡»æœ‰ä¸€äº›çº¦æŸï¼š\n- åœ¨åŒä¸€ä¸ªæ¶ˆè´¹è€…ç»„ä¸­ï¼Œä¸€ä¸ªPartitionåªèƒ½åˆ†é…ä¸€ä¸ªæ¶ˆè´¹è€…\n- åŒä¸€ä¸ªæ¶ˆè´¹è€…ç»„ä¸­ï¼Œå¯ä»¥åˆ†æ´¾å¤šä¸ªæ¶ˆè´¹è€…\n- ä¸åŒæ¶ˆè´¹è€…ç»„å¯ä»¥åŒæ—¶æ¶ˆè´¹åŒä¸€ä¸ªTopic\næ¶ˆè´¹è€…ç»„åœ¨æ¶ˆè´¹è€…æ–¹é¢è¿›è¡Œäº†æ°´å¹³æ‰©å®¹ï¼Œæé«˜äº†æ¶ˆè´¹èƒ½åŠ›ã€‚\n\næ¶ˆè´¹è€…ç»„å’‹çœ¼ä¸€çœ‹æ²¡å¤šå¤§ç”¨å¤„ï¼Œå®é™…ä¸Šï¼Œæ¶ˆè´¹è€…ç»„å¸¦æ¥çš„æœ€å¤§ä¾¿åˆ©åœ¨äºå¯¹åˆ†åŒºçš„å°è£…æ€§ï¼Œä¸€ä¸ªæ¶ˆè´¹è€…ç»„å¯ä»¥è‡ªåŠ¨å®Œæˆ**Re balance**æ“ä½œï¼Œä½¿å¾—Partitionå¯¹äºæ¶ˆè´¹è€…æ˜¯é€æ˜çš„ã€‚åä¹‹ï¼Œæ¶ˆè´¹è€…æ¯æ¬¡æ‹‰å–æ¶ˆæ¯éƒ½è¦æŒ‡å®šPartitionï¼Œè¿™å°±å¯¼è‡´Partitionå’Œæ¶ˆè´¹è€…è€¦åˆåœ¨ä¸€å—ï¼ŒPartitionæ•°é‡å‘ç”Ÿå˜åŠ¨ï¼Œæ¶ˆè´¹è€…æ–¹é¢çš„ä»£ç å°±è¦éšä¹‹å˜åŠ¨\n\n**æ¶ˆè´¹è€…ç»„åˆ†åŒºåˆ†é…ç­–ç•¥**\n partition.assignment.strategyå­—æ®µå¯ä»¥é…ç½®æ¶ˆè´¹è€…ç»„ä¸­å¤šä¸ªæ¶ˆè´¹è€…å¯¹äºåˆ†åŒºåˆ†é…çš„è§„åˆ™ï¼š\n - Range Assignorï¼šåŸºäºèŒƒå›´çš„åˆ†é…ç­–ç•¥\n - Round Robin Assignorï¼šåŸºäºè½®è¯¢çš„åˆ†é…ç­–ç•¥\n - Sticky Assignorï¼šä¼˜å…ˆä¿æŒå½“å‰çš„åˆ†é…çŠ¶æ€ï¼Œå°½é‡å‡å°‘Rebalanceè¿‡ç¨‹ä¸­åˆ†åŒºçš„ç§»åŠ¨\n - CooperativeSticky Assignorï¼šåŸºæœ¬å’ŒSticky Assignorç­–ç•¥ä¸€è‡´ï¼Œä½†æ˜¯åŒºåˆ«åœ¨äºè¯¥åè®®å°†åŸæ¥ä¸€æ¬¡è¡Œå¯¹ä¸€å¤§ç‰‡åˆ†åŒºè¿›è¡ŒRebalanceæ”¹ä¸ºå¤šæ¬¡å°è§„æ¨¡çš„Rebalanceæ“ä½œï¼Œå³æ¸è¿›å¼Rebalance\n\n## Rebalanceæœºåˆ¶\n Rebalanceæœºåˆ¶ç”¨äºç¡®ä¿æ•°æ®åœ¨æ¶ˆè´¹è€…ç»„ä¸­å°½å¯èƒ½åœ°è´Ÿè½½å‡è¡¡\n è§¦å‘Rebalanceçš„ä¸‰ä¸ªæ—¶æœºï¼š\n - åŠ å…¥æ–°çš„æ¶ˆè´¹è€…\n - æ¶ˆè´¹è€…å‡å°‘ï¼Œä¸è®ºæ˜¯æ­£å¸¸å…³é—­è¿˜æ˜¯å´©æºƒ\n - Topicä¸‹çš„Partitionæ•°é‡å‘ç”Ÿå˜åŒ–\n\n**å†å¹³è¡¡çš„æ­¥éª¤**\nå†å¹³è¡¡æ“ä½œéœ€è¦ç»å†äº”ä¸ªé˜¶æ®µï¼š\n1. æš‚åœæ¶ˆè´¹ï¼Œæ¶ˆè´¹è€…éœ€è¦æš‚åœæ­£åœ¨è¿›è¡Œçš„æ¶ˆè´¹ï¼Œé˜²æ­¢é‡æ–°åˆ†é…è¿‡ç¨‹ä¸­å‡ºç°æ•°æ®ä¸¢å¤±æˆ–é‡å¤é—®é¢˜\n2. è§¦å‘å†åˆ†é…ï¼Œç”±æ¶ˆè´¹è€…ç»„åè°ƒå™¨Group Coordinatorï¼ˆé€šå¸¸æ˜¯ä¸€ä¸ªBrokerï¼‰è§¦å‘å†å¹³è¡¡\n3. åˆ†é…åˆ†åŒºï¼Œæ¶ˆè´¹è€…é…åˆåè°ƒå™¨æ ¹æ®å½“å‰æ¶ˆè´¹è€…å’Œåˆ†åŒºæ•°é‡ï¼Œé‡æ–°åˆ†é…ä¸»é¢˜çš„åˆ†åŒº\n4. è·å–åˆ†é…ä¿¡æ¯ï¼Œé‡æ–°åˆ†é…å®Œæˆåï¼Œæ¶ˆè´¹è€…ä¼šä»åè°ƒå™¨æ‹¿åˆ°æ–°çš„åˆ†åŒºåˆ†é…æƒ…å†µ\n5. æ¢å¤æ¶ˆè´¹ï¼Œæ¶ˆè´¹è€…æ”¶åˆ°æ–°çš„åˆ†é…åï¼Œæ¢å¤æ¶ˆè´¹ï¼Œå¼€å§‹å¤„ç†æ–°åˆ†åŒº\n\nä¸Šæ–‡æåˆ°æœ‰å››ç§æ¶ˆè´¹ç»„åˆ†åŒºåˆ†é…ç­–ç•¥ï¼Œè¿™å››ç§åˆ†é…ç­–ç•¥å¯ä»¥ä¾æ®æ˜¯å¦äº§ç”ŸSTWé—®é¢˜åˆ†ä¸ºEagerå’ŒIncrementalä¸¤ç§å†å¹³è¡¡ç­–ç•¥ã€‚å…¶ä¸­å‰ä¸‰ç§æ–¹æ¡ˆéƒ½æ˜¯Eagerç­–ç•¥ï¼Œå› ä¸ºè¿™ä¸‰ç§åˆ†é…ç­–ç•¥åœ¨æš‚åœæ¶ˆè´¹è€…é˜¶æ®µä¼šåœæ­¢æ‰€æœ‰çš„æ¶ˆè´¹è¡Œä¸ºï¼Œè€ŒCooperative Stickyæ–¹å¼åˆ™åªä¼šæš‚åœéƒ¨åˆ†æ¶ˆè´¹è€…ï¼Œæœªè¢«æš‚åœçš„æ¶ˆè´¹è€…ä»èƒ½ç»§ç»­æ¶ˆè´¹è¡Œä¸ºï¼Œä½†ä»£ä»·æ˜¯Rebalanceçš„æ—¶é—´è¢«å»¶é•¿\n\n**Group Coordinatoræ˜¯ä»€ä¹ˆ**ï¼Ÿ\n","slug":"Kafkaç†è®ºçŸ¥è¯†","published":1,"date":"2025-01-04T06:32:27.252Z","updated":"2025-01-05T11:56:39.329Z","title":"","comments":1,"layout":"post","photos":[],"_id":"cm6c7md6g0005a5t2c2cn5dff","content":"<h2 id=\"æ•´ä½“æ¶æ„\"><a href=\"#æ•´ä½“æ¶æ„\" class=\"headerlink\" title=\"æ•´ä½“æ¶æ„\"></a>æ•´ä½“æ¶æ„</h2><p>å®è§‚ä¸Šå¯ä»¥å°†Kafkaåˆ†æˆä¸‰ä¸ªéƒ¨åˆ†ï¼šç”Ÿäº§è€…ã€ä¸­é—´æœåŠ¡å±‚ã€æ¶ˆè´¹è€…<br>ä¸­é—´æœåŠ¡å±‚ç›¸å½“äºä¸€ä¸ªâ€œæ¶ˆæ¯ä¸­è½¬ç«™â€ï¼Œä½†ä¸åŒä¹‹å¤„åœ¨äºï¼Œä¸­é—´æœåŠ¡å±‚ä¼šå°†æ¶ˆæ¯æŒä¹…åŒ–å­˜å‚¨</p>\n<p>ä¸­é—´æœåŠ¡å±‚ç”±å¤šä¸ªéƒ¨ä»¶æ„æˆï¼š</p>\n<ul>\n<li>brokerï¼šå¯ä»¥ç†è§£ä¸ºæ˜¯ä¸€ä¸ªèŠ‚ç‚¹ï¼Œå³è¿è¡ŒKafkaç¨‹åºçš„æœåŠ¡å™¨</li>\n<li>topicï¼šå¯¹æ¶ˆæ¯è¿›è¡Œé€»è¾‘åˆ†ç±»çš„ç²—ç²’åº¦å•ä½ï¼Œå¯ç”¨äºå®ç°è´Ÿè½½å‡è¡¡ã€æ¶ˆæ¯å¹¶è¡Œå¤„ç†ã€‚æ¶ˆè´¹è€…è®¢é˜…æŸä¸€ä¸ªä¸»é¢˜è¿›è¡Œæ¶ˆè´¹ã€‚ç”Ÿäº§è€…å‘æŒ‡å®šçš„ä¸»é¢˜å†™å…¥æ¶ˆæ¯</li>\n<li>partitionï¼šæ¶ˆæ¯ä¸Šç‰©ç†ä¸Šå­˜å‚¨çš„ç©ºé—´ï¼Œä¸€ä¸ªpartitionå¯¹åº”ç€ä¸€ä¸ªtopicï¼Œä¸€ä¸ªtopicå¯ä»¥æœ‰å¤šä¸ªpartitionã€‚partitionå¯¹äºç”Ÿäº§è€…å’Œæ¶ˆè´¹è€…æ˜¯é€æ˜çš„ã€æ— æ³•æ„ŸçŸ¥çš„ã€‚<ul>\n<li>æ¯ä¸ªpartitionå­˜å‚¨ç€æœ‰åºã€ä¸å¯å˜çš„æ¶ˆæ¯åºåˆ—</li>\n<li>partitionå¯è¢«ç‹¬ç«‹è¯»å†™</li>\n</ul>\n</li>\n</ul>\n<p>brokerã€topicã€partitionä¸‰è€…ä¹‹é—´çš„å…³ç³»å¦‚ä¸‹ï¼š</p>\n<p><img src=\"https://raw.githubusercontent.com/lyydsheep/pic/main/20250104150207.png\" alt=\"image.png\"></p>\n<h2 id=\"Topic\"><a href=\"#Topic\" class=\"headerlink\" title=\"Topic\"></a>Topic</h2><p>åœ¨Kafkaä¸­ï¼ŒTopicå°±æ˜¯ä¸€ä¸ªä¸»é¢˜ï¼Œå±äºé€»è¾‘ä¸Šçš„æ¦‚å¿µï¼Œå¹¶ä¸å­˜åœ¨ä»»ä½•ä¸€å°ç‰©ç†è®¾å¤‡ä¸Šã€‚ä½œä¸ºä½¿ç”¨è€…ï¼Œæˆ‘ä»¬å¯ä»¥å°†åŒä¸šåŠ¡çš„æ¶ˆæ¯æ”¾å…¥åŒä¸€ä¸ªtopicï¼Œä¾‹å¦‚ç§’æ€ä¸šåŠ¡ã€å”®ç¥¨ä¸šåŠ¡ç­‰ï¼Œé€šè¿‡è¿™ä¸ªé€»è¾‘ä¸Šçš„æ¦‚å¿µï¼Œå¯ä»¥ç²—ç²’åº¦åœ°å°†æ•°æ®æ¶ˆæ¯è¿›è¡Œåˆ†ç‰‡ï¼Œåˆ†é—¨åˆ«ç±»åœ°å¤„ç†æ¶ˆæ¯ã€‚</p>\n<h2 id=\"Partition\"><a href=\"#Partition\" class=\"headerlink\" title=\"Partition\"></a>Partition</h2><p>å¯¹æ•°æ®è¿›è¡Œé€»è¾‘Topicåˆ†åŒºåï¼Œä¸€ä¸ªä¸šåŠ¡çš„æ•°æ®é‡å¯èƒ½ä»ç„¶åºå¤§ï¼Œä¸ºäº†å¯¹æ•°æ®è¿›ä¸€æ­¥åˆ†è€Œæ²»ä¹‹ï¼Œè®¾è®¡Kafkaçš„å¤§ä½¬å†³å®šå°†Topicçš„æ•°æ®å®é™…ç‰©ç†å­˜å‚¨åœ¨ä¸€ä¸ªä¸ªPartitionä¸­ã€‚Partitionå°±ç›¸å½“äºå¯¹ç²—ç²’åº¦åˆ’åˆ†çš„æ•°æ®å†è¿›è¡Œä¸€æ¬¡ç»†ç²’åº¦åŒºåˆ†ã€‚ç”±äºTopicæ˜¯ä¸€ä¸ªé€»è¾‘ä¸Šçš„æ¦‚å¿µï¼Œå¹¶ä¸å­˜åœ¨äºæŸä¸€ä¸ªå…·ä½“çš„brokerä¸Šï¼Œå› æ­¤åœ¨é›†ç¾¤æ¨¡å¼ä¸‹ï¼ŒåŒä¸€ä¸ªTopicä¸‹çš„å¤šä¸ªPartitionæ˜¯ç‹¬ç«‹çš„ï¼Œå®Œå…¨å¯ä»¥åœ¨ä¸åŒçš„brokerä¸Šã€‚</p>\n<p>åˆ†ç‰‡çš„å¥½å¤„ï¼š</p>\n<ul>\n<li>æé«˜å†™å…¥æ€§èƒ½ï¼Œä¸åŒçš„partitionåˆ†å¸ƒåœ¨ä¸åŒçš„brokerä¸Šï¼Œå¯ä»¥å®ç°å¹¶è¡Œå†™å…¥ï¼Œæé«˜äº†ç³»ç»Ÿååé‡</li>\n<li>æé«˜æ¶ˆè´¹è€…å¹¶å‘åº¦ï¼Œå› ä¸ºæœ‰äº†ä¸åŒçš„åˆ†ç‰‡ï¼Œä¸åŒçš„æ¶ˆè´¹è€…å¯ä»¥å¯¹ä¸åŒçš„åˆ†ç‰‡åŒæ—¶æ¶ˆè´¹</li>\n<li>æé«˜äº†Kafkaæ°´å¹³æ‰©å±•èƒ½åŠ›</li>\n<li>æé«˜äº†ç³»ç»Ÿçš„å®¹é”™èƒ½åŠ›ï¼Œå¼•å…¥partitionåï¼ŒåŒä¸€ä¸ª Topicä¸‹ä¸åŒpartitionä¸­çš„æ•°æ®è§£è€¦åˆï¼Œå³ä½¿ä¸€ä¸ªpartitionå´©æºƒäº†ï¼Œä¹Ÿä¸å½±å“å…¶ä»–partitionè¿ä½œ</li>\n</ul>\n<p>ä¸€ä¸ªPartitionå°±ç›¸å½“äºä¸€ä¸ªé˜Ÿåˆ—ï¼Œæœ€æ–°çš„æ•°æ®è¢«å†™åœ¨é˜Ÿåˆ—çš„æœ«å°¾ï¼Œå³åŒä¸€ä¸ªPartitionä¸‹çš„æ•°æ®æ˜¯æœ‰åºçš„ï¼Œä½†ç»¼åˆæ¥çœ‹ï¼ŒåŒä¸€ä¸ªTopicä¸‹çš„æ‰€æœ‰Partitionä¸­çš„æ•°æ®æ˜¯æ— åºçš„<br><img src=\"https://raw.githubusercontent.com/lyydsheep/pic/main/20250104192916.png\" alt=\"image.png\"></p>\n<p>ç”±äºPartitionå¯¹äºç”Ÿäº§è€…æ˜¯é€æ˜çš„ï¼Œé‚£ä¹ˆç”Ÿäº§è€…å‘ä¸€ä¸ªTopicå†™å…¥æ•°æ®ï¼Œæ•°æ®æœ€ç»ˆä¼šæµå‘ä½•å¤„å‘¢ï¼Ÿ<br>å¦‚æœç”Ÿäº§è€…å‘Topicå‘é€æ¶ˆæ¯æ—¶æ²¡æœ‰æŒ‡å®šKeyï¼Œé‚£ä¹ˆKafkaæœåŠ¡å°±ä¼šé»˜è®¤é‡‡å–<strong>è½®è¯¢Partition</strong>çš„æ–¹å¼å°†æ•°æ®å†™å…¥åˆ°Partitionä¸­ã€‚<br>å¦‚æœç”Ÿäº§è€…æŒ‡å®šäº†å‘é€çš„Keyï¼Œé‚£ä¹ˆæ¶ˆæ¯å°±ä¼šè¢«å†™å…¥åˆ°å°†Keyè¿›è¡Œå“ˆå¸Œè¿‡åå¯¹åº”çš„Partitionä¸­</p>\n<h2 id=\"Broker\"><a href=\"#Broker\" class=\"headerlink\" title=\"Broker\"></a>Broker</h2><p>Brokerå®é™…å°±æ˜¯ä¸€ä¸ªè¿è¡ŒKafkaç¨‹åºçš„æœåŠ¡å™¨èŠ‚ç‚¹ï¼ŒBrokeréœ€è¦æä¾›å¦‚ä¸‹åŠŸèƒ½ï¼š</p>\n<ol>\n<li>æ¥å—æ¥è‡ªå®¢æˆ·ç«¯çš„è¿æ¥</li>\n<li>æ”¯æŒå®¢æˆ·ç«¯æŸ¥è¯¢Kafkaé›†ç¾¤çš„ä¿¡æ¯ï¼Œæ¯”å¦‚æŸ¥è¯¢å…¶ä»–Brokerä¿¡æ¯</li>\n<li>å“åº”æ¥è‡ªå®¢æˆ·ç«¯çš„å‘½ä»¤è¯·æ±‚</li>\n<li>å­˜å‚¨æ¶ˆæ¯ï¼Œå³å°†æ¶ˆæ¯æŒä¹…åŒ–å­˜å‚¨åœ¨æœ¬åœ°æœåŠ¡å™¨ä¸Š</li>\n</ol>\n<p>åœ¨é›†ç¾¤éƒ¨ç½²æ¨¡å¼ä¸‹ï¼Œæ¯ä¸€ä¸ªBrokeréƒ½æœ‰å”¯ä¸€çš„IDæ ‡è¯†è‡ªå·±èº«ä»½ã€‚Partitionæ˜¯å­˜æ”¾åœ¨BrokerèŠ‚ç‚¹ä¸Šçš„ï¼Œä¸€ä¸ªPartitionå¯¹åº”ä¸€ä¸ªBrokerï¼Œä¸€ä¸ªBrokerå¯èƒ½å­˜æ”¾ç€å¤šä¸ªPartition<br>é’ˆå¯¹äºä¸€ä¸ªTopicä¸‹çš„å¤šä¸ªPartitionï¼Œéœ€è¦å…ˆéšæœºé€‰å–ä¸€ä¸ªBrokerï¼ˆæ¯”å¦‚æ˜¯Broker10ï¼‰å­˜æ”¾Partition_0ï¼Œæ¥ç€æŒ‰ç…§Brokerçš„IDé¡ºåºä¾æ¬¡å­˜æ”¾Partitionï¼Œå³Broker11å­˜æ”¾Partition_1ã€Broker12å­˜æ”¾Partition_2ï¼Œä»¥æ­¤ç±»æ¨ã€‚</p>\n<p>å‰æ–‡æåŠäº†ï¼Œæ¶ˆè´¹è€…åœ¨å‘é€æ¶ˆæ¯æ—¶å¯ä»¥æŒ‡å®šKeyï¼Œç›¸å½“äºå°†æ¶ˆæ¯å‘é€åˆ°æŒ‡å®šçš„Partitionä¸Šã€‚é‚£ä¹ˆå®¢æˆ·ç«¯æ˜¯å¦‚ä½•åœ¨Kafkaé›†ç¾¤ä¸­å¿«é€Ÿæ‰¾åˆ°ç›®æ ‡Partitionæ‰€åœ¨çš„BrokerèŠ‚ç‚¹å‘¢ï¼Ÿ<br>é€šå¸¸å®¢æˆ·ç«¯è¿æ¥é›†ç¾¤æœ‰ä¸‰ç§æ–¹å¼ï¼š</p>\n<ol>\n<li>å¼•å…¥ä»£ç†ï¼Œä»£ç†å’Œä¼—å¤šBrokeræ‰“äº¤é“</li>\n<li>é‡å®šå‘ï¼Œå®¢æˆ·ç«¯å‘é€å‘½ä»¤åˆ°æŸä¸€ä¸ªèŠ‚ç‚¹ä¸Šï¼Œå¦‚æœè¯¥èŠ‚ç‚¹ä¸æ˜¯ç›®æ ‡èŠ‚ç‚¹ï¼Œé‚£ä¹ˆè¯¥èŠ‚ç‚¹ä¼šå‘ŠçŸ¥å®¢æˆ·ç«¯æœ¨ç¬”å“¦èŠ‚ç‚¹å…·ä½“åœ°å€ï¼ˆRedisï¼‰</li>\n<li>æŸ¥è¯¢è·¯ç”±è¡¨ï¼Œå®¢æˆ·ç«¯å…ˆæŸ¥è¯¢è·¯ç”±è¡¨ï¼Œç›´æ¥å‘ç›®æ ‡èŠ‚ç‚¹å‘é€è¯·æ±‚å‘½ä»¤ï¼ˆKafkaï¼‰</li>\n</ol>\n<p>Kafkaé€‰æ‹©ç¬¬ä¸‰ç§æ–¹å¼çš„ä¸€ä¸ªå¥‘æœºæ˜¯ï¼Œåœ¨Kafkaé›†ç¾¤ä¸­ï¼Œæ¯ä¸€ä¸ªBrokeréƒ½æ”¯æŒå®¢æˆ·ç«¯æŸ¥è¯¢Kafkaé›†ç¾¤çš„ä¿¡æ¯ï¼Œå³æ¯ä¸€ä¸ªBrokeréƒ½çŸ¥æ™“å…¶ä»–Brokerçš„ä¿¡æ¯ã€‚è¿™äº›ä¿¡æ¯éƒ½è¢«ç»´æŠ¤åœ¨æ¯ä¸€ä¸ªBrokerçš„è·¯ç”±è¡¨ä¸­ï¼Œäº†è§£äº†è¿™ä¸€ç‚¹ï¼Œå®¢æˆ·ç«¯å‘é€è¯»å†™å‘½ä»¤çš„è¿‡ç¨‹å°±å‘¼ä¹‹æ¬²å‡ºäº†ï¼š</p>\n<ol>\n<li>ä»»æ„è®¿é—®ä¸€å°Broker</li>\n<li>ä»è¿™å°Brokerä¸­è·å–è·¯ç”±è¡¨</li>\n<li>æ ¹æ®è§„åˆ™æ‰¾åˆ°ç›®æ ‡Partitionï¼Œåœ¨è·¯ç”±è¡¨ä¸­æ‰¾åˆ°å“ªä¸ªBrokerä¸Šå­˜æœ‰ç›®æ ‡Partitionï¼Œæœ€åå‘é€è¯»å†™å‘½ä»¤<ol>\n<li>æ‰¾Partitionçš„è§„åˆ™å°±æ˜¯ä¸Šæ–‡è®²çš„<strong>è½®è¯¢æˆ–å“ˆå¸ŒKey</strong>è§„åˆ™</li>\n</ol>\n</li>\n</ol>\n<h2 id=\"ç”Ÿäº§è€…Producer\"><a href=\"#ç”Ÿäº§è€…Producer\" class=\"headerlink\" title=\"ç”Ÿäº§è€…Producer\"></a>ç”Ÿäº§è€…Producer</h2><p>ç”Ÿäº§è€…å‘é€ä¸€æ¡æ¶ˆæ¯éœ€è¦å†ç»ä¸‰ä¸ªæ­¥éª¤ï¼š</p>\n<ul>\n<li>æ„å»ºæ¶ˆæ¯ï¼šå°†éœ€è¦å‘é€çš„ä¿¡æ¯æ‰“åŒ…æˆKafkaæ¶ˆæ¯ç»“æ„</li>\n<li>åºåˆ—åŒ–æ¶ˆæ¯ï¼šå°†æ¶ˆæ¯åºåˆ—åŒ–æˆäºŒè¿›åˆ¶æ•°æ®ï¼Œä»¥ä¾¿åœ¨ç½‘ç»œä¸­ä¼ è¾“</li>\n<li>å¯»æ‰¾Brokerï¼šæ ¹æ®è§„åˆ™æ‰¾åˆ°ç›®æ ‡åˆ†åŒºï¼Œæ¥ç€ä¾æ®è·¯ç”±è¡¨å°†æ¶ˆæ¯å‘é€åˆ°Partitionå¯¹åº”çš„Broker</li>\n</ul>\n<p><strong>æ„å»ºæ¶ˆæ¯</strong><br>ç”Ÿäº§è€…éœ€è¦å°†å‘é€çš„ä¿¡æ¯æ‰“åŒ…æˆKafkaæ¶ˆæ¯ç»“æ„ï¼Œæ¥ä¸‹æ¥å°±è¯¦ç»†çœ‹çœ‹æ¶ˆæ¯ç»“æ„çš„å…·ä½“ç»„æˆï¼š<br><img src=\"https://raw.githubusercontent.com/lyydsheep/pic/main/20250105102410.png\" alt=\"image.png\"></p>\n<ul>\n<li>Keyï¼šæ ¹æ®Keyçš„å“ˆå¸Œå€¼ï¼ˆå–æ¨¡ï¼‰ç¡®å®šå‘é€åˆ°Topicä¸‹çš„å“ªä¸€ä¸ªPartitionä¸Šï¼Œä¸€èˆ¬æ˜¯å­—ç¬¦ä¸²ç±»å‹ï¼Œæœ€ç»ˆä¼šè¢«åºåˆ—åŒ–ä¸ºäºŒè¿›åˆ¶æ•°æ®</li>\n<li>Valueï¼šå®é™…å‘é€çš„æ•°æ®</li>\n<li>Compression Typeï¼šæŒ‡å®šå‹ç¼©ç®—æ³•ï¼Œè¯¥å­—æ®µè¡¨æ˜é‡‡ç”¨ä»€ä¹ˆå‹ç¼©ç®—æ³•å¯¹æ•°æ®è¿›è¡Œå‹ç¼©ï¼Œæšä¸¾å€¼ï¼šNoneã€gzipã€lz4ç­‰</li>\n<li>Headerï¼šç”Ÿäº§è€…é¢å¤–æƒ³ä¼ è¾“çš„æ•°æ®å°±æ”¾åœ¨Headerä¸­ï¼Œæ¯”å¦‚TraceID</li>\n<li>Partition+Offsetï¼šè¯¥å­—æ®µåœ¨ç”Ÿäº§å‡ºæ¥çš„æ—¶å€™æ˜¯ç©ºçš„ï¼Œæ¶ˆæ¯å‘é€åˆ°KafkaæœåŠ¡ç«¯åæ‰ä¼šå°†å…·ä½“çš„åˆ†åŒºã€åç§»é‡å†™å…¥è¯¥å­—æ®µã€‚Topic + Partition + Offsetå”¯ä¸€ç¡®å®šä¸€æ¡æ¶ˆæ¯</li>\n</ul>\n<p><strong>åºåˆ—åŒ–</strong><br>åºåˆ—åŒ–å°±æ˜¯å°†æ¶ˆæ¯ä»å¸¸è§„ç±»å‹è½¬æ¢è‡³äºŒè¿›åˆ¶ç±»å‹ï¼Œä»¥åœ¨ç½‘ç»œä¸­ä¼ è¾“</p>\n<p><strong>å‘é€æ¨¡å¼</strong><br>åœ¨Goã€Javaçš„SDKä¸­æä¾›äº†ä¸‰ç§æ¶ˆæ¯å‘é€æ¨¡å¼ï¼š</p>\n<ol>\n<li>åŒæ­¥å‘é€ï¼Œç”Ÿäº§è€…å‘é€æ¶ˆæ¯åï¼Œæ‰§è¡Œé˜»å¡æ“ä½œï¼Œç­‰å¾…KafkaæœåŠ¡ç«¯è¿”å›å‘é€æ¶ˆæ¯æˆåŠŸæˆ–å¼‚å¸¸ç»“æœã€‚é€‚ç”¨äºç”Ÿäº§è€…éœ€è¦ç¡®ä¿æˆåŠŸå‘é€æ¶ˆæ¯æ‰èƒ½æ‰§è¡Œåç»­æ“ä½œçš„åœºæ™¯ã€‚</li>\n<li>å‘äº†å°±å¿˜ï¼Œç”Ÿäº§è€…å‘å®Œæ¶ˆæ¯å°±ç»§ç»­æ‰§è¡Œåç»­æ“ä½œï¼Œä¸ç†ä¼šæ¶ˆæ¯æ˜¯å¦å‘é€æˆåŠŸï¼Œä¹Ÿä¸é‡‡å–æªæ–½åº”å¯¹å‘é€å¼‚å¸¸</li>\n<li>å¼‚æ­¥å‘é€ï¼Œç”Ÿäº§è€…å‘é€æ¶ˆæ¯çš„åŒæ—¶æ³¨å†Œå›è°ƒå‡½æ•°ï¼Œä¸æ‰§è¡Œé˜»å¡æ“ä½œï¼Œè€Œæ˜¯ç»§ç»­æ‰§è¡Œåç»­çš„æ“ä½œã€‚å½“KafkaæœåŠ¡ç«¯è¿”å›å‘é€æ¶ˆæ¯çš„ç»“æœåï¼Œæ‰§è¡Œå¯¹åº”å›è°ƒå‡½æ•°çš„å†…å®¹</li>\n</ol>\n<p>ä¸‰ç§å‘é€æ¨¡å¼å®é™…ä¸Šå°±æ˜¯<strong>é«˜æ€§èƒ½å’Œå¯é æ€§</strong>ä¹‹é—´çš„æƒè¡¡ã€‚åŒæ­¥å‘é€æ¨¡å¼å¯é æ€§å¼ºï¼Œä½†æ˜¯æ•ˆç‡ä¸é«˜ï¼Œé€‚ç”¨äºä¿æŒæ•°æ®ä¸€è‡´æ€§çš„åœºæ™¯ï¼›å‘äº†å°±å¿˜æ€§èƒ½é«˜ï¼Œå¯æ˜¯ä¸ä¿è¯å¯é æ€§ï¼Œå› æ­¤é€‚åˆåœ¨è¦æ±‚é«˜æ€§èƒ½çš„åœºæ™¯ä¸‹ä½¿ç”¨ï¼›å¼‚æ­¥å‘é€å°±æ˜¯åœ¨äºŒè€…ä¹‹é—´çš„æŠ˜ä¸­åŠæ³•ï¼Œä½¿ç”¨äºåœ¨éœ€è¦æ—¶å¤„ç†æ¶ˆæ¯å‘é€å¤±è´¥çš„æƒ…å†µ</p>\n<h2 id=\"æ¶ˆè´¹è€…Consumer\"><a href=\"#æ¶ˆè´¹è€…Consumer\" class=\"headerlink\" title=\"æ¶ˆè´¹è€…Consumer\"></a>æ¶ˆè´¹è€…Consumer</h2><p>å’Œç”Ÿäº§è€…ä¸€æ ·ï¼Œæ¶ˆè´¹è€…ä¹Ÿéœ€è¦é›†æˆKafkaå®¢æˆ·ç«¯åº“ï¼Œé€šè¿‡æ¥å£å‘Brokerè·å–æ¶ˆæ¯è¿›è¡Œæ¶ˆè´¹<br><img src=\"https://raw.githubusercontent.com/lyydsheep/pic/main/20250105141657.png\" alt=\"image.png\"><br>é€šè¿‡ä¸Šå›¾å¯å¾—å‡ºä¸€ä¸‹ç»“è®ºï¼š</p>\n<ol>\n<li>ä¸åŒçš„æ¶ˆè´¹è€…å¯ä»¥åœ¨åŒä¸€æ—¶åˆ»å¯¹åŒä¸€Topicè¿›è¡Œæ¶ˆè´¹</li>\n<li>ä¸€ä¸ªæ¶ˆè´¹è€…å¯ä»¥åœ¨åŒä¸€æ—¶åˆ»å¯¹ä¸€ä¸ªTopicä¸‹çš„ä¸åŒPartitionè¿›è¡Œæ¶ˆè´¹</li>\n<li>ä¸€ä¸ªæ¶ˆè´¹è€…åŒæ—¶æ¶ˆè´¹å¤šä¸ªPartitionæ˜¯æ— æ³•ä¿è¯æ¶ˆæ¯æœ‰åºæ€§çš„</li>\n<li>ä¸€ä¸ªæ¶ˆè´¹è€…åªæ¶ˆè´¹ä¸€ä¸ªPartitionï¼Œæ¶ˆè´¹é¡ºåºå³ç”Ÿäº§é¡ºåºï¼Œæ˜¯æœ‰åºçš„</li>\n</ol>\n<p><strong>æ‹‰è¿˜æ˜¯æ¨</strong>ï¼Ÿ<br>æ¶ˆè´¹è€…æ¶ˆè´¹æ¶ˆæ¯æ˜¯é€šè¿‡<strong>æ‹‰æ¨¡å¼</strong>è¿›è¡Œçš„ï¼Œä¹Ÿå°±æ˜¯è¯´ï¼Œæ¶ˆè´¹è€…å…ˆå‘Brokerå‘é€æ‹‰å–æ¶ˆæ¯çš„ä¿¡å·ï¼Œæ¥ç€Brokerå†å°†æ¶ˆæ¯å‘é€ç»™æ¶ˆè´¹è€…ï¼Œè€Œä¸æ˜¯Brokerä¸»åŠ¨å‘æ¶ˆè´¹è€…æ¨é€æ¶ˆæ¯ã€‚<br>é€‰æ‹©è¿™ç§æ‹‰æ¨¡å¼çš„ä¸»è¦åŸå› åœ¨äºï¼Œæ¶ˆè´¹è€…å¯ä»¥æ ¹æ®è‡ªèº«çš„èµ„æºåˆ©ç”¨ç‡ï¼ˆCPUã€å†…å­˜ç­‰ï¼‰é€‚æ—¶åœ°å‘Brokeræ‹‰å–æ¶ˆæ¯ï¼Œè°ƒèŠ‚æ¶ˆè´¹é€Ÿåº¦ï¼Œé¿å…å› æ¶ˆè´¹é€Ÿåº¦ä¸åˆé€‚å¯¼è‡´èµ„æºæµªè´¹æˆ–è¶…è½½</p>\n<p><strong>æ¶ˆè´¹è€…Offset</strong><br>åœ¨Partitionä¸­ï¼Œä½äºOffsetä¹‹å‰çš„æ¶ˆæ¯éƒ½å·²ç»è¢«æ¶ˆè´¹è¿‡äº†ï¼Œè€Œä¹‹åçš„æ¶ˆæ¯åˆ™æ²¡æœ‰è¢«æ¶ˆè´¹ã€‚æ¶ˆè´¹è€…ç»„æ¯æ¶ˆè´¹å®Œä¸€ä¸ªæ¶ˆæ¯åï¼Œå°±å‘Brokeræä¾›è¯¥æ¶ˆæ¯çš„Offsetï¼Œè¡¨ç¤ºè¯¥æ¶ˆæ¯å·²ç»æ¶ˆè´¹è¿‡äº†ã€‚æ¶ˆè´¹è€…ä¸‹ä¸€æ¬¡æ‹‰å–çš„æ¶ˆæ¯å°±æ˜¯Partitionä¸­Offsetçš„ä¸‹ä¸€ä½ã€‚æ¶ˆè´¹è€…å®Œæˆæ¶ˆè´¹åï¼Œå°±å°†è¯¥æ¶ˆæ¯çš„â€œPartition + Offsetâ€å­—æ®µä¿¡æ¯å‘é€ç»™Brokerï¼Œç”±Brokerè´Ÿè´£æ›´æ–°å¯¹åº”Partitionçš„Offset<br><img src=\"https://raw.githubusercontent.com/lyydsheep/pic/main/20250105144221.png\" alt=\"image.png\"></p>\n<p><strong>ä¸»åŠ¨æäº¤å’Œè¢«åŠ¨æäº¤</strong><br>æ¶ˆè´¹è€…ç»„æäº¤Offsetåˆ†ä¸ºä¸¤ç§æ–¹å¼ï¼š</p>\n<ul>\n<li>è¢«åŠ¨æäº¤</li>\n<li>ä¸»åŠ¨æäº¤<br>è¢«åŠ¨æäº¤å°±æ˜¯å®šæ—¶å‘¨æœŸæ€§åœ°å‘Brokeræäº¤æœ€æ–°å·²å¤„ç†çš„æ¶ˆæ¯ã€‚ä½†æ˜¯è¿™ç§æäº¤æ–¹å¼å­˜åœ¨ä¸€è‡´æ€§é—®é¢˜ï¼Œä¾‹å¦‚æ¶ˆè´¹è€…æ­£åœ¨å¤„ç†offsetä¸º5çš„æ¶ˆæ¯ï¼Œæ­¤æ—¶å‘ç”Ÿäº†è¢«åŠ¨æäº¤ï¼Œéœ€è¦å‘ŠçŸ¥Brokerå°†Offsetæ›´æ–°ä¸º5ï¼Œä½†å®é™…ä¸Šoffsetä¸º5çš„æ¶ˆæ¯è¿˜æ²¡æœ‰å®Œå…¨å¤„ç†å®Œã€‚å¦‚æœæ­¤æ—¶å‘ç”Ÿäº†å´©æºƒé‡å¯ï¼Œé‚£ä¹ˆè¯¥æ¶ˆæ¯å°±ä¼šè¢«ä¸¢å¤±ã€‚</li>\n</ul>\n<p>æ‰‹åŠ¨æäº¤åˆ™æ˜¯ä¸€ç§æ›´ä¸ºç¨³å¦¥çš„æ–¹å¼ï¼Œå½“æŸæ¡æ¶ˆæ¯å½»åº•å¤„ç†å¥½åï¼Œå†ä¸»åŠ¨å‘Brokeræäº¤æ¶ˆæ¯ï¼Œé¿å…å‡ºç°ä¸ä¸€è‡´çš„æƒ…å†µã€‚<br><img src=\"https://raw.githubusercontent.com/lyydsheep/pic/main/20250105150142.png\" alt=\"image.png\"></p>\n<p><strong>æ¶ˆè´¹è€…ç»„ConsumerGroup</strong><br>æ¶ˆè´¹è€…ç»„å®è´¨å°±æ˜¯ç”±å¤šä¸ªæ¶ˆè´¹è€…ç»„æˆçš„é›†åˆï¼Œä¸€ä¸ªæ¶ˆè´¹è€…ç»„ç”±ä¸€ä¸ªGroupIDå”¯ä¸€æ ‡è¯†ã€‚<br>å¤šä¸ªæ¶ˆè´¹è€…ç»„æˆæ¶ˆè´¹è€…ç»„ï¼Œé‚£ä¹ˆè¿™äº›æ¶ˆè´¹è€…å¿…é¡»æœ‰ä¸€äº›çº¦æŸï¼š</p>\n<ul>\n<li>åœ¨åŒä¸€ä¸ªæ¶ˆè´¹è€…ç»„ä¸­ï¼Œä¸€ä¸ªPartitionåªèƒ½åˆ†é…ä¸€ä¸ªæ¶ˆè´¹è€…</li>\n<li>åŒä¸€ä¸ªæ¶ˆè´¹è€…ç»„ä¸­ï¼Œå¯ä»¥åˆ†æ´¾å¤šä¸ªæ¶ˆè´¹è€…</li>\n<li>ä¸åŒæ¶ˆè´¹è€…ç»„å¯ä»¥åŒæ—¶æ¶ˆè´¹åŒä¸€ä¸ªTopic<br>æ¶ˆè´¹è€…ç»„åœ¨æ¶ˆè´¹è€…æ–¹é¢è¿›è¡Œäº†æ°´å¹³æ‰©å®¹ï¼Œæé«˜äº†æ¶ˆè´¹èƒ½åŠ›ã€‚</li>\n</ul>\n<p>æ¶ˆè´¹è€…ç»„å’‹çœ¼ä¸€çœ‹æ²¡å¤šå¤§ç”¨å¤„ï¼Œå®é™…ä¸Šï¼Œæ¶ˆè´¹è€…ç»„å¸¦æ¥çš„æœ€å¤§ä¾¿åˆ©åœ¨äºå¯¹åˆ†åŒºçš„å°è£…æ€§ï¼Œä¸€ä¸ªæ¶ˆè´¹è€…ç»„å¯ä»¥è‡ªåŠ¨å®Œæˆ<strong>Re balance</strong>æ“ä½œï¼Œä½¿å¾—Partitionå¯¹äºæ¶ˆè´¹è€…æ˜¯é€æ˜çš„ã€‚åä¹‹ï¼Œæ¶ˆè´¹è€…æ¯æ¬¡æ‹‰å–æ¶ˆæ¯éƒ½è¦æŒ‡å®šPartitionï¼Œè¿™å°±å¯¼è‡´Partitionå’Œæ¶ˆè´¹è€…è€¦åˆåœ¨ä¸€å—ï¼ŒPartitionæ•°é‡å‘ç”Ÿå˜åŠ¨ï¼Œæ¶ˆè´¹è€…æ–¹é¢çš„ä»£ç å°±è¦éšä¹‹å˜åŠ¨</p>\n<p><strong>æ¶ˆè´¹è€…ç»„åˆ†åŒºåˆ†é…ç­–ç•¥</strong><br> partition.assignment.strategyå­—æ®µå¯ä»¥é…ç½®æ¶ˆè´¹è€…ç»„ä¸­å¤šä¸ªæ¶ˆè´¹è€…å¯¹äºåˆ†åŒºåˆ†é…çš„è§„åˆ™ï¼š</p>\n<ul>\n<li>Range Assignorï¼šåŸºäºèŒƒå›´çš„åˆ†é…ç­–ç•¥</li>\n<li>Round Robin Assignorï¼šåŸºäºè½®è¯¢çš„åˆ†é…ç­–ç•¥</li>\n<li>Sticky Assignorï¼šä¼˜å…ˆä¿æŒå½“å‰çš„åˆ†é…çŠ¶æ€ï¼Œå°½é‡å‡å°‘Rebalanceè¿‡ç¨‹ä¸­åˆ†åŒºçš„ç§»åŠ¨</li>\n<li>CooperativeSticky Assignorï¼šåŸºæœ¬å’ŒSticky Assignorç­–ç•¥ä¸€è‡´ï¼Œä½†æ˜¯åŒºåˆ«åœ¨äºè¯¥åè®®å°†åŸæ¥ä¸€æ¬¡è¡Œå¯¹ä¸€å¤§ç‰‡åˆ†åŒºè¿›è¡ŒRebalanceæ”¹ä¸ºå¤šæ¬¡å°è§„æ¨¡çš„Rebalanceæ“ä½œï¼Œå³æ¸è¿›å¼Rebalance</li>\n</ul>\n<h2 id=\"Rebalanceæœºåˆ¶\"><a href=\"#Rebalanceæœºåˆ¶\" class=\"headerlink\" title=\"Rebalanceæœºåˆ¶\"></a>Rebalanceæœºåˆ¶</h2><p> Rebalanceæœºåˆ¶ç”¨äºç¡®ä¿æ•°æ®åœ¨æ¶ˆè´¹è€…ç»„ä¸­å°½å¯èƒ½åœ°è´Ÿè½½å‡è¡¡<br> è§¦å‘Rebalanceçš„ä¸‰ä¸ªæ—¶æœºï¼š</p>\n<ul>\n<li>åŠ å…¥æ–°çš„æ¶ˆè´¹è€…</li>\n<li>æ¶ˆè´¹è€…å‡å°‘ï¼Œä¸è®ºæ˜¯æ­£å¸¸å…³é—­è¿˜æ˜¯å´©æºƒ</li>\n<li>Topicä¸‹çš„Partitionæ•°é‡å‘ç”Ÿå˜åŒ–</li>\n</ul>\n<p><strong>å†å¹³è¡¡çš„æ­¥éª¤</strong><br>å†å¹³è¡¡æ“ä½œéœ€è¦ç»å†äº”ä¸ªé˜¶æ®µï¼š</p>\n<ol>\n<li>æš‚åœæ¶ˆè´¹ï¼Œæ¶ˆè´¹è€…éœ€è¦æš‚åœæ­£åœ¨è¿›è¡Œçš„æ¶ˆè´¹ï¼Œé˜²æ­¢é‡æ–°åˆ†é…è¿‡ç¨‹ä¸­å‡ºç°æ•°æ®ä¸¢å¤±æˆ–é‡å¤é—®é¢˜</li>\n<li>è§¦å‘å†åˆ†é…ï¼Œç”±æ¶ˆè´¹è€…ç»„åè°ƒå™¨Group Coordinatorï¼ˆé€šå¸¸æ˜¯ä¸€ä¸ªBrokerï¼‰è§¦å‘å†å¹³è¡¡</li>\n<li>åˆ†é…åˆ†åŒºï¼Œæ¶ˆè´¹è€…é…åˆåè°ƒå™¨æ ¹æ®å½“å‰æ¶ˆè´¹è€…å’Œåˆ†åŒºæ•°é‡ï¼Œé‡æ–°åˆ†é…ä¸»é¢˜çš„åˆ†åŒº</li>\n<li>è·å–åˆ†é…ä¿¡æ¯ï¼Œé‡æ–°åˆ†é…å®Œæˆåï¼Œæ¶ˆè´¹è€…ä¼šä»åè°ƒå™¨æ‹¿åˆ°æ–°çš„åˆ†åŒºåˆ†é…æƒ…å†µ</li>\n<li>æ¢å¤æ¶ˆè´¹ï¼Œæ¶ˆè´¹è€…æ”¶åˆ°æ–°çš„åˆ†é…åï¼Œæ¢å¤æ¶ˆè´¹ï¼Œå¼€å§‹å¤„ç†æ–°åˆ†åŒº</li>\n</ol>\n<p>ä¸Šæ–‡æåˆ°æœ‰å››ç§æ¶ˆè´¹ç»„åˆ†åŒºåˆ†é…ç­–ç•¥ï¼Œè¿™å››ç§åˆ†é…ç­–ç•¥å¯ä»¥ä¾æ®æ˜¯å¦äº§ç”ŸSTWé—®é¢˜åˆ†ä¸ºEagerå’ŒIncrementalä¸¤ç§å†å¹³è¡¡ç­–ç•¥ã€‚å…¶ä¸­å‰ä¸‰ç§æ–¹æ¡ˆéƒ½æ˜¯Eagerç­–ç•¥ï¼Œå› ä¸ºè¿™ä¸‰ç§åˆ†é…ç­–ç•¥åœ¨æš‚åœæ¶ˆè´¹è€…é˜¶æ®µä¼šåœæ­¢æ‰€æœ‰çš„æ¶ˆè´¹è¡Œä¸ºï¼Œè€ŒCooperative Stickyæ–¹å¼åˆ™åªä¼šæš‚åœéƒ¨åˆ†æ¶ˆè´¹è€…ï¼Œæœªè¢«æš‚åœçš„æ¶ˆè´¹è€…ä»èƒ½ç»§ç»­æ¶ˆè´¹è¡Œä¸ºï¼Œä½†ä»£ä»·æ˜¯Rebalanceçš„æ—¶é—´è¢«å»¶é•¿</p>\n<p><strong>Group Coordinatoræ˜¯ä»€ä¹ˆ</strong>ï¼Ÿ</p>\n","excerpt":"","more":"<h2 id=\"æ•´ä½“æ¶æ„\"><a href=\"#æ•´ä½“æ¶æ„\" class=\"headerlink\" title=\"æ•´ä½“æ¶æ„\"></a>æ•´ä½“æ¶æ„</h2><p>å®è§‚ä¸Šå¯ä»¥å°†Kafkaåˆ†æˆä¸‰ä¸ªéƒ¨åˆ†ï¼šç”Ÿäº§è€…ã€ä¸­é—´æœåŠ¡å±‚ã€æ¶ˆè´¹è€…<br>ä¸­é—´æœåŠ¡å±‚ç›¸å½“äºä¸€ä¸ªâ€œæ¶ˆæ¯ä¸­è½¬ç«™â€ï¼Œä½†ä¸åŒä¹‹å¤„åœ¨äºï¼Œä¸­é—´æœåŠ¡å±‚ä¼šå°†æ¶ˆæ¯æŒä¹…åŒ–å­˜å‚¨</p>\n<p>ä¸­é—´æœåŠ¡å±‚ç”±å¤šä¸ªéƒ¨ä»¶æ„æˆï¼š</p>\n<ul>\n<li>brokerï¼šå¯ä»¥ç†è§£ä¸ºæ˜¯ä¸€ä¸ªèŠ‚ç‚¹ï¼Œå³è¿è¡ŒKafkaç¨‹åºçš„æœåŠ¡å™¨</li>\n<li>topicï¼šå¯¹æ¶ˆæ¯è¿›è¡Œé€»è¾‘åˆ†ç±»çš„ç²—ç²’åº¦å•ä½ï¼Œå¯ç”¨äºå®ç°è´Ÿè½½å‡è¡¡ã€æ¶ˆæ¯å¹¶è¡Œå¤„ç†ã€‚æ¶ˆè´¹è€…è®¢é˜…æŸä¸€ä¸ªä¸»é¢˜è¿›è¡Œæ¶ˆè´¹ã€‚ç”Ÿäº§è€…å‘æŒ‡å®šçš„ä¸»é¢˜å†™å…¥æ¶ˆæ¯</li>\n<li>partitionï¼šæ¶ˆæ¯ä¸Šç‰©ç†ä¸Šå­˜å‚¨çš„ç©ºé—´ï¼Œä¸€ä¸ªpartitionå¯¹åº”ç€ä¸€ä¸ªtopicï¼Œä¸€ä¸ªtopicå¯ä»¥æœ‰å¤šä¸ªpartitionã€‚partitionå¯¹äºç”Ÿäº§è€…å’Œæ¶ˆè´¹è€…æ˜¯é€æ˜çš„ã€æ— æ³•æ„ŸçŸ¥çš„ã€‚<ul>\n<li>æ¯ä¸ªpartitionå­˜å‚¨ç€æœ‰åºã€ä¸å¯å˜çš„æ¶ˆæ¯åºåˆ—</li>\n<li>partitionå¯è¢«ç‹¬ç«‹è¯»å†™</li>\n</ul>\n</li>\n</ul>\n<p>brokerã€topicã€partitionä¸‰è€…ä¹‹é—´çš„å…³ç³»å¦‚ä¸‹ï¼š</p>\n<p><img src=\"https://raw.githubusercontent.com/lyydsheep/pic/main/20250104150207.png\" alt=\"image.png\"></p>\n<h2 id=\"Topic\"><a href=\"#Topic\" class=\"headerlink\" title=\"Topic\"></a>Topic</h2><p>åœ¨Kafkaä¸­ï¼ŒTopicå°±æ˜¯ä¸€ä¸ªä¸»é¢˜ï¼Œå±äºé€»è¾‘ä¸Šçš„æ¦‚å¿µï¼Œå¹¶ä¸å­˜åœ¨ä»»ä½•ä¸€å°ç‰©ç†è®¾å¤‡ä¸Šã€‚ä½œä¸ºä½¿ç”¨è€…ï¼Œæˆ‘ä»¬å¯ä»¥å°†åŒä¸šåŠ¡çš„æ¶ˆæ¯æ”¾å…¥åŒä¸€ä¸ªtopicï¼Œä¾‹å¦‚ç§’æ€ä¸šåŠ¡ã€å”®ç¥¨ä¸šåŠ¡ç­‰ï¼Œé€šè¿‡è¿™ä¸ªé€»è¾‘ä¸Šçš„æ¦‚å¿µï¼Œå¯ä»¥ç²—ç²’åº¦åœ°å°†æ•°æ®æ¶ˆæ¯è¿›è¡Œåˆ†ç‰‡ï¼Œåˆ†é—¨åˆ«ç±»åœ°å¤„ç†æ¶ˆæ¯ã€‚</p>\n<h2 id=\"Partition\"><a href=\"#Partition\" class=\"headerlink\" title=\"Partition\"></a>Partition</h2><p>å¯¹æ•°æ®è¿›è¡Œé€»è¾‘Topicåˆ†åŒºåï¼Œä¸€ä¸ªä¸šåŠ¡çš„æ•°æ®é‡å¯èƒ½ä»ç„¶åºå¤§ï¼Œä¸ºäº†å¯¹æ•°æ®è¿›ä¸€æ­¥åˆ†è€Œæ²»ä¹‹ï¼Œè®¾è®¡Kafkaçš„å¤§ä½¬å†³å®šå°†Topicçš„æ•°æ®å®é™…ç‰©ç†å­˜å‚¨åœ¨ä¸€ä¸ªä¸ªPartitionä¸­ã€‚Partitionå°±ç›¸å½“äºå¯¹ç²—ç²’åº¦åˆ’åˆ†çš„æ•°æ®å†è¿›è¡Œä¸€æ¬¡ç»†ç²’åº¦åŒºåˆ†ã€‚ç”±äºTopicæ˜¯ä¸€ä¸ªé€»è¾‘ä¸Šçš„æ¦‚å¿µï¼Œå¹¶ä¸å­˜åœ¨äºæŸä¸€ä¸ªå…·ä½“çš„brokerä¸Šï¼Œå› æ­¤åœ¨é›†ç¾¤æ¨¡å¼ä¸‹ï¼ŒåŒä¸€ä¸ªTopicä¸‹çš„å¤šä¸ªPartitionæ˜¯ç‹¬ç«‹çš„ï¼Œå®Œå…¨å¯ä»¥åœ¨ä¸åŒçš„brokerä¸Šã€‚</p>\n<p>åˆ†ç‰‡çš„å¥½å¤„ï¼š</p>\n<ul>\n<li>æé«˜å†™å…¥æ€§èƒ½ï¼Œä¸åŒçš„partitionåˆ†å¸ƒåœ¨ä¸åŒçš„brokerä¸Šï¼Œå¯ä»¥å®ç°å¹¶è¡Œå†™å…¥ï¼Œæé«˜äº†ç³»ç»Ÿååé‡</li>\n<li>æé«˜æ¶ˆè´¹è€…å¹¶å‘åº¦ï¼Œå› ä¸ºæœ‰äº†ä¸åŒçš„åˆ†ç‰‡ï¼Œä¸åŒçš„æ¶ˆè´¹è€…å¯ä»¥å¯¹ä¸åŒçš„åˆ†ç‰‡åŒæ—¶æ¶ˆè´¹</li>\n<li>æé«˜äº†Kafkaæ°´å¹³æ‰©å±•èƒ½åŠ›</li>\n<li>æé«˜äº†ç³»ç»Ÿçš„å®¹é”™èƒ½åŠ›ï¼Œå¼•å…¥partitionåï¼ŒåŒä¸€ä¸ª Topicä¸‹ä¸åŒpartitionä¸­çš„æ•°æ®è§£è€¦åˆï¼Œå³ä½¿ä¸€ä¸ªpartitionå´©æºƒäº†ï¼Œä¹Ÿä¸å½±å“å…¶ä»–partitionè¿ä½œ</li>\n</ul>\n<p>ä¸€ä¸ªPartitionå°±ç›¸å½“äºä¸€ä¸ªé˜Ÿåˆ—ï¼Œæœ€æ–°çš„æ•°æ®è¢«å†™åœ¨é˜Ÿåˆ—çš„æœ«å°¾ï¼Œå³åŒä¸€ä¸ªPartitionä¸‹çš„æ•°æ®æ˜¯æœ‰åºçš„ï¼Œä½†ç»¼åˆæ¥çœ‹ï¼ŒåŒä¸€ä¸ªTopicä¸‹çš„æ‰€æœ‰Partitionä¸­çš„æ•°æ®æ˜¯æ— åºçš„<br><img src=\"https://raw.githubusercontent.com/lyydsheep/pic/main/20250104192916.png\" alt=\"image.png\"></p>\n<p>ç”±äºPartitionå¯¹äºç”Ÿäº§è€…æ˜¯é€æ˜çš„ï¼Œé‚£ä¹ˆç”Ÿäº§è€…å‘ä¸€ä¸ªTopicå†™å…¥æ•°æ®ï¼Œæ•°æ®æœ€ç»ˆä¼šæµå‘ä½•å¤„å‘¢ï¼Ÿ<br>å¦‚æœç”Ÿäº§è€…å‘Topicå‘é€æ¶ˆæ¯æ—¶æ²¡æœ‰æŒ‡å®šKeyï¼Œé‚£ä¹ˆKafkaæœåŠ¡å°±ä¼šé»˜è®¤é‡‡å–<strong>è½®è¯¢Partition</strong>çš„æ–¹å¼å°†æ•°æ®å†™å…¥åˆ°Partitionä¸­ã€‚<br>å¦‚æœç”Ÿäº§è€…æŒ‡å®šäº†å‘é€çš„Keyï¼Œé‚£ä¹ˆæ¶ˆæ¯å°±ä¼šè¢«å†™å…¥åˆ°å°†Keyè¿›è¡Œå“ˆå¸Œè¿‡åå¯¹åº”çš„Partitionä¸­</p>\n<h2 id=\"Broker\"><a href=\"#Broker\" class=\"headerlink\" title=\"Broker\"></a>Broker</h2><p>Brokerå®é™…å°±æ˜¯ä¸€ä¸ªè¿è¡ŒKafkaç¨‹åºçš„æœåŠ¡å™¨èŠ‚ç‚¹ï¼ŒBrokeréœ€è¦æä¾›å¦‚ä¸‹åŠŸèƒ½ï¼š</p>\n<ol>\n<li>æ¥å—æ¥è‡ªå®¢æˆ·ç«¯çš„è¿æ¥</li>\n<li>æ”¯æŒå®¢æˆ·ç«¯æŸ¥è¯¢Kafkaé›†ç¾¤çš„ä¿¡æ¯ï¼Œæ¯”å¦‚æŸ¥è¯¢å…¶ä»–Brokerä¿¡æ¯</li>\n<li>å“åº”æ¥è‡ªå®¢æˆ·ç«¯çš„å‘½ä»¤è¯·æ±‚</li>\n<li>å­˜å‚¨æ¶ˆæ¯ï¼Œå³å°†æ¶ˆæ¯æŒä¹…åŒ–å­˜å‚¨åœ¨æœ¬åœ°æœåŠ¡å™¨ä¸Š</li>\n</ol>\n<p>åœ¨é›†ç¾¤éƒ¨ç½²æ¨¡å¼ä¸‹ï¼Œæ¯ä¸€ä¸ªBrokeréƒ½æœ‰å”¯ä¸€çš„IDæ ‡è¯†è‡ªå·±èº«ä»½ã€‚Partitionæ˜¯å­˜æ”¾åœ¨BrokerèŠ‚ç‚¹ä¸Šçš„ï¼Œä¸€ä¸ªPartitionå¯¹åº”ä¸€ä¸ªBrokerï¼Œä¸€ä¸ªBrokerå¯èƒ½å­˜æ”¾ç€å¤šä¸ªPartition<br>é’ˆå¯¹äºä¸€ä¸ªTopicä¸‹çš„å¤šä¸ªPartitionï¼Œéœ€è¦å…ˆéšæœºé€‰å–ä¸€ä¸ªBrokerï¼ˆæ¯”å¦‚æ˜¯Broker10ï¼‰å­˜æ”¾Partition_0ï¼Œæ¥ç€æŒ‰ç…§Brokerçš„IDé¡ºåºä¾æ¬¡å­˜æ”¾Partitionï¼Œå³Broker11å­˜æ”¾Partition_1ã€Broker12å­˜æ”¾Partition_2ï¼Œä»¥æ­¤ç±»æ¨ã€‚</p>\n<p>å‰æ–‡æåŠäº†ï¼Œæ¶ˆè´¹è€…åœ¨å‘é€æ¶ˆæ¯æ—¶å¯ä»¥æŒ‡å®šKeyï¼Œç›¸å½“äºå°†æ¶ˆæ¯å‘é€åˆ°æŒ‡å®šçš„Partitionä¸Šã€‚é‚£ä¹ˆå®¢æˆ·ç«¯æ˜¯å¦‚ä½•åœ¨Kafkaé›†ç¾¤ä¸­å¿«é€Ÿæ‰¾åˆ°ç›®æ ‡Partitionæ‰€åœ¨çš„BrokerèŠ‚ç‚¹å‘¢ï¼Ÿ<br>é€šå¸¸å®¢æˆ·ç«¯è¿æ¥é›†ç¾¤æœ‰ä¸‰ç§æ–¹å¼ï¼š</p>\n<ol>\n<li>å¼•å…¥ä»£ç†ï¼Œä»£ç†å’Œä¼—å¤šBrokeræ‰“äº¤é“</li>\n<li>é‡å®šå‘ï¼Œå®¢æˆ·ç«¯å‘é€å‘½ä»¤åˆ°æŸä¸€ä¸ªèŠ‚ç‚¹ä¸Šï¼Œå¦‚æœè¯¥èŠ‚ç‚¹ä¸æ˜¯ç›®æ ‡èŠ‚ç‚¹ï¼Œé‚£ä¹ˆè¯¥èŠ‚ç‚¹ä¼šå‘ŠçŸ¥å®¢æˆ·ç«¯æœ¨ç¬”å“¦èŠ‚ç‚¹å…·ä½“åœ°å€ï¼ˆRedisï¼‰</li>\n<li>æŸ¥è¯¢è·¯ç”±è¡¨ï¼Œå®¢æˆ·ç«¯å…ˆæŸ¥è¯¢è·¯ç”±è¡¨ï¼Œç›´æ¥å‘ç›®æ ‡èŠ‚ç‚¹å‘é€è¯·æ±‚å‘½ä»¤ï¼ˆKafkaï¼‰</li>\n</ol>\n<p>Kafkaé€‰æ‹©ç¬¬ä¸‰ç§æ–¹å¼çš„ä¸€ä¸ªå¥‘æœºæ˜¯ï¼Œåœ¨Kafkaé›†ç¾¤ä¸­ï¼Œæ¯ä¸€ä¸ªBrokeréƒ½æ”¯æŒå®¢æˆ·ç«¯æŸ¥è¯¢Kafkaé›†ç¾¤çš„ä¿¡æ¯ï¼Œå³æ¯ä¸€ä¸ªBrokeréƒ½çŸ¥æ™“å…¶ä»–Brokerçš„ä¿¡æ¯ã€‚è¿™äº›ä¿¡æ¯éƒ½è¢«ç»´æŠ¤åœ¨æ¯ä¸€ä¸ªBrokerçš„è·¯ç”±è¡¨ä¸­ï¼Œäº†è§£äº†è¿™ä¸€ç‚¹ï¼Œå®¢æˆ·ç«¯å‘é€è¯»å†™å‘½ä»¤çš„è¿‡ç¨‹å°±å‘¼ä¹‹æ¬²å‡ºäº†ï¼š</p>\n<ol>\n<li>ä»»æ„è®¿é—®ä¸€å°Broker</li>\n<li>ä»è¿™å°Brokerä¸­è·å–è·¯ç”±è¡¨</li>\n<li>æ ¹æ®è§„åˆ™æ‰¾åˆ°ç›®æ ‡Partitionï¼Œåœ¨è·¯ç”±è¡¨ä¸­æ‰¾åˆ°å“ªä¸ªBrokerä¸Šå­˜æœ‰ç›®æ ‡Partitionï¼Œæœ€åå‘é€è¯»å†™å‘½ä»¤<ol>\n<li>æ‰¾Partitionçš„è§„åˆ™å°±æ˜¯ä¸Šæ–‡è®²çš„<strong>è½®è¯¢æˆ–å“ˆå¸ŒKey</strong>è§„åˆ™</li>\n</ol>\n</li>\n</ol>\n<h2 id=\"ç”Ÿäº§è€…Producer\"><a href=\"#ç”Ÿäº§è€…Producer\" class=\"headerlink\" title=\"ç”Ÿäº§è€…Producer\"></a>ç”Ÿäº§è€…Producer</h2><p>ç”Ÿäº§è€…å‘é€ä¸€æ¡æ¶ˆæ¯éœ€è¦å†ç»ä¸‰ä¸ªæ­¥éª¤ï¼š</p>\n<ul>\n<li>æ„å»ºæ¶ˆæ¯ï¼šå°†éœ€è¦å‘é€çš„ä¿¡æ¯æ‰“åŒ…æˆKafkaæ¶ˆæ¯ç»“æ„</li>\n<li>åºåˆ—åŒ–æ¶ˆæ¯ï¼šå°†æ¶ˆæ¯åºåˆ—åŒ–æˆäºŒè¿›åˆ¶æ•°æ®ï¼Œä»¥ä¾¿åœ¨ç½‘ç»œä¸­ä¼ è¾“</li>\n<li>å¯»æ‰¾Brokerï¼šæ ¹æ®è§„åˆ™æ‰¾åˆ°ç›®æ ‡åˆ†åŒºï¼Œæ¥ç€ä¾æ®è·¯ç”±è¡¨å°†æ¶ˆæ¯å‘é€åˆ°Partitionå¯¹åº”çš„Broker</li>\n</ul>\n<p><strong>æ„å»ºæ¶ˆæ¯</strong><br>ç”Ÿäº§è€…éœ€è¦å°†å‘é€çš„ä¿¡æ¯æ‰“åŒ…æˆKafkaæ¶ˆæ¯ç»“æ„ï¼Œæ¥ä¸‹æ¥å°±è¯¦ç»†çœ‹çœ‹æ¶ˆæ¯ç»“æ„çš„å…·ä½“ç»„æˆï¼š<br><img src=\"https://raw.githubusercontent.com/lyydsheep/pic/main/20250105102410.png\" alt=\"image.png\"></p>\n<ul>\n<li>Keyï¼šæ ¹æ®Keyçš„å“ˆå¸Œå€¼ï¼ˆå–æ¨¡ï¼‰ç¡®å®šå‘é€åˆ°Topicä¸‹çš„å“ªä¸€ä¸ªPartitionä¸Šï¼Œä¸€èˆ¬æ˜¯å­—ç¬¦ä¸²ç±»å‹ï¼Œæœ€ç»ˆä¼šè¢«åºåˆ—åŒ–ä¸ºäºŒè¿›åˆ¶æ•°æ®</li>\n<li>Valueï¼šå®é™…å‘é€çš„æ•°æ®</li>\n<li>Compression Typeï¼šæŒ‡å®šå‹ç¼©ç®—æ³•ï¼Œè¯¥å­—æ®µè¡¨æ˜é‡‡ç”¨ä»€ä¹ˆå‹ç¼©ç®—æ³•å¯¹æ•°æ®è¿›è¡Œå‹ç¼©ï¼Œæšä¸¾å€¼ï¼šNoneã€gzipã€lz4ç­‰</li>\n<li>Headerï¼šç”Ÿäº§è€…é¢å¤–æƒ³ä¼ è¾“çš„æ•°æ®å°±æ”¾åœ¨Headerä¸­ï¼Œæ¯”å¦‚TraceID</li>\n<li>Partition+Offsetï¼šè¯¥å­—æ®µåœ¨ç”Ÿäº§å‡ºæ¥çš„æ—¶å€™æ˜¯ç©ºçš„ï¼Œæ¶ˆæ¯å‘é€åˆ°KafkaæœåŠ¡ç«¯åæ‰ä¼šå°†å…·ä½“çš„åˆ†åŒºã€åç§»é‡å†™å…¥è¯¥å­—æ®µã€‚Topic + Partition + Offsetå”¯ä¸€ç¡®å®šä¸€æ¡æ¶ˆæ¯</li>\n</ul>\n<p><strong>åºåˆ—åŒ–</strong><br>åºåˆ—åŒ–å°±æ˜¯å°†æ¶ˆæ¯ä»å¸¸è§„ç±»å‹è½¬æ¢è‡³äºŒè¿›åˆ¶ç±»å‹ï¼Œä»¥åœ¨ç½‘ç»œä¸­ä¼ è¾“</p>\n<p><strong>å‘é€æ¨¡å¼</strong><br>åœ¨Goã€Javaçš„SDKä¸­æä¾›äº†ä¸‰ç§æ¶ˆæ¯å‘é€æ¨¡å¼ï¼š</p>\n<ol>\n<li>åŒæ­¥å‘é€ï¼Œç”Ÿäº§è€…å‘é€æ¶ˆæ¯åï¼Œæ‰§è¡Œé˜»å¡æ“ä½œï¼Œç­‰å¾…KafkaæœåŠ¡ç«¯è¿”å›å‘é€æ¶ˆæ¯æˆåŠŸæˆ–å¼‚å¸¸ç»“æœã€‚é€‚ç”¨äºç”Ÿäº§è€…éœ€è¦ç¡®ä¿æˆåŠŸå‘é€æ¶ˆæ¯æ‰èƒ½æ‰§è¡Œåç»­æ“ä½œçš„åœºæ™¯ã€‚</li>\n<li>å‘äº†å°±å¿˜ï¼Œç”Ÿäº§è€…å‘å®Œæ¶ˆæ¯å°±ç»§ç»­æ‰§è¡Œåç»­æ“ä½œï¼Œä¸ç†ä¼šæ¶ˆæ¯æ˜¯å¦å‘é€æˆåŠŸï¼Œä¹Ÿä¸é‡‡å–æªæ–½åº”å¯¹å‘é€å¼‚å¸¸</li>\n<li>å¼‚æ­¥å‘é€ï¼Œç”Ÿäº§è€…å‘é€æ¶ˆæ¯çš„åŒæ—¶æ³¨å†Œå›è°ƒå‡½æ•°ï¼Œä¸æ‰§è¡Œé˜»å¡æ“ä½œï¼Œè€Œæ˜¯ç»§ç»­æ‰§è¡Œåç»­çš„æ“ä½œã€‚å½“KafkaæœåŠ¡ç«¯è¿”å›å‘é€æ¶ˆæ¯çš„ç»“æœåï¼Œæ‰§è¡Œå¯¹åº”å›è°ƒå‡½æ•°çš„å†…å®¹</li>\n</ol>\n<p>ä¸‰ç§å‘é€æ¨¡å¼å®é™…ä¸Šå°±æ˜¯<strong>é«˜æ€§èƒ½å’Œå¯é æ€§</strong>ä¹‹é—´çš„æƒè¡¡ã€‚åŒæ­¥å‘é€æ¨¡å¼å¯é æ€§å¼ºï¼Œä½†æ˜¯æ•ˆç‡ä¸é«˜ï¼Œé€‚ç”¨äºä¿æŒæ•°æ®ä¸€è‡´æ€§çš„åœºæ™¯ï¼›å‘äº†å°±å¿˜æ€§èƒ½é«˜ï¼Œå¯æ˜¯ä¸ä¿è¯å¯é æ€§ï¼Œå› æ­¤é€‚åˆåœ¨è¦æ±‚é«˜æ€§èƒ½çš„åœºæ™¯ä¸‹ä½¿ç”¨ï¼›å¼‚æ­¥å‘é€å°±æ˜¯åœ¨äºŒè€…ä¹‹é—´çš„æŠ˜ä¸­åŠæ³•ï¼Œä½¿ç”¨äºåœ¨éœ€è¦æ—¶å¤„ç†æ¶ˆæ¯å‘é€å¤±è´¥çš„æƒ…å†µ</p>\n<h2 id=\"æ¶ˆè´¹è€…Consumer\"><a href=\"#æ¶ˆè´¹è€…Consumer\" class=\"headerlink\" title=\"æ¶ˆè´¹è€…Consumer\"></a>æ¶ˆè´¹è€…Consumer</h2><p>å’Œç”Ÿäº§è€…ä¸€æ ·ï¼Œæ¶ˆè´¹è€…ä¹Ÿéœ€è¦é›†æˆKafkaå®¢æˆ·ç«¯åº“ï¼Œé€šè¿‡æ¥å£å‘Brokerè·å–æ¶ˆæ¯è¿›è¡Œæ¶ˆè´¹<br><img src=\"https://raw.githubusercontent.com/lyydsheep/pic/main/20250105141657.png\" alt=\"image.png\"><br>é€šè¿‡ä¸Šå›¾å¯å¾—å‡ºä¸€ä¸‹ç»“è®ºï¼š</p>\n<ol>\n<li>ä¸åŒçš„æ¶ˆè´¹è€…å¯ä»¥åœ¨åŒä¸€æ—¶åˆ»å¯¹åŒä¸€Topicè¿›è¡Œæ¶ˆè´¹</li>\n<li>ä¸€ä¸ªæ¶ˆè´¹è€…å¯ä»¥åœ¨åŒä¸€æ—¶åˆ»å¯¹ä¸€ä¸ªTopicä¸‹çš„ä¸åŒPartitionè¿›è¡Œæ¶ˆè´¹</li>\n<li>ä¸€ä¸ªæ¶ˆè´¹è€…åŒæ—¶æ¶ˆè´¹å¤šä¸ªPartitionæ˜¯æ— æ³•ä¿è¯æ¶ˆæ¯æœ‰åºæ€§çš„</li>\n<li>ä¸€ä¸ªæ¶ˆè´¹è€…åªæ¶ˆè´¹ä¸€ä¸ªPartitionï¼Œæ¶ˆè´¹é¡ºåºå³ç”Ÿäº§é¡ºåºï¼Œæ˜¯æœ‰åºçš„</li>\n</ol>\n<p><strong>æ‹‰è¿˜æ˜¯æ¨</strong>ï¼Ÿ<br>æ¶ˆè´¹è€…æ¶ˆè´¹æ¶ˆæ¯æ˜¯é€šè¿‡<strong>æ‹‰æ¨¡å¼</strong>è¿›è¡Œçš„ï¼Œä¹Ÿå°±æ˜¯è¯´ï¼Œæ¶ˆè´¹è€…å…ˆå‘Brokerå‘é€æ‹‰å–æ¶ˆæ¯çš„ä¿¡å·ï¼Œæ¥ç€Brokerå†å°†æ¶ˆæ¯å‘é€ç»™æ¶ˆè´¹è€…ï¼Œè€Œä¸æ˜¯Brokerä¸»åŠ¨å‘æ¶ˆè´¹è€…æ¨é€æ¶ˆæ¯ã€‚<br>é€‰æ‹©è¿™ç§æ‹‰æ¨¡å¼çš„ä¸»è¦åŸå› åœ¨äºï¼Œæ¶ˆè´¹è€…å¯ä»¥æ ¹æ®è‡ªèº«çš„èµ„æºåˆ©ç”¨ç‡ï¼ˆCPUã€å†…å­˜ç­‰ï¼‰é€‚æ—¶åœ°å‘Brokeræ‹‰å–æ¶ˆæ¯ï¼Œè°ƒèŠ‚æ¶ˆè´¹é€Ÿåº¦ï¼Œé¿å…å› æ¶ˆè´¹é€Ÿåº¦ä¸åˆé€‚å¯¼è‡´èµ„æºæµªè´¹æˆ–è¶…è½½</p>\n<p><strong>æ¶ˆè´¹è€…Offset</strong><br>åœ¨Partitionä¸­ï¼Œä½äºOffsetä¹‹å‰çš„æ¶ˆæ¯éƒ½å·²ç»è¢«æ¶ˆè´¹è¿‡äº†ï¼Œè€Œä¹‹åçš„æ¶ˆæ¯åˆ™æ²¡æœ‰è¢«æ¶ˆè´¹ã€‚æ¶ˆè´¹è€…ç»„æ¯æ¶ˆè´¹å®Œä¸€ä¸ªæ¶ˆæ¯åï¼Œå°±å‘Brokeræä¾›è¯¥æ¶ˆæ¯çš„Offsetï¼Œè¡¨ç¤ºè¯¥æ¶ˆæ¯å·²ç»æ¶ˆè´¹è¿‡äº†ã€‚æ¶ˆè´¹è€…ä¸‹ä¸€æ¬¡æ‹‰å–çš„æ¶ˆæ¯å°±æ˜¯Partitionä¸­Offsetçš„ä¸‹ä¸€ä½ã€‚æ¶ˆè´¹è€…å®Œæˆæ¶ˆè´¹åï¼Œå°±å°†è¯¥æ¶ˆæ¯çš„â€œPartition + Offsetâ€å­—æ®µä¿¡æ¯å‘é€ç»™Brokerï¼Œç”±Brokerè´Ÿè´£æ›´æ–°å¯¹åº”Partitionçš„Offset<br><img src=\"https://raw.githubusercontent.com/lyydsheep/pic/main/20250105144221.png\" alt=\"image.png\"></p>\n<p><strong>ä¸»åŠ¨æäº¤å’Œè¢«åŠ¨æäº¤</strong><br>æ¶ˆè´¹è€…ç»„æäº¤Offsetåˆ†ä¸ºä¸¤ç§æ–¹å¼ï¼š</p>\n<ul>\n<li>è¢«åŠ¨æäº¤</li>\n<li>ä¸»åŠ¨æäº¤<br>è¢«åŠ¨æäº¤å°±æ˜¯å®šæ—¶å‘¨æœŸæ€§åœ°å‘Brokeræäº¤æœ€æ–°å·²å¤„ç†çš„æ¶ˆæ¯ã€‚ä½†æ˜¯è¿™ç§æäº¤æ–¹å¼å­˜åœ¨ä¸€è‡´æ€§é—®é¢˜ï¼Œä¾‹å¦‚æ¶ˆè´¹è€…æ­£åœ¨å¤„ç†offsetä¸º5çš„æ¶ˆæ¯ï¼Œæ­¤æ—¶å‘ç”Ÿäº†è¢«åŠ¨æäº¤ï¼Œéœ€è¦å‘ŠçŸ¥Brokerå°†Offsetæ›´æ–°ä¸º5ï¼Œä½†å®é™…ä¸Šoffsetä¸º5çš„æ¶ˆæ¯è¿˜æ²¡æœ‰å®Œå…¨å¤„ç†å®Œã€‚å¦‚æœæ­¤æ—¶å‘ç”Ÿäº†å´©æºƒé‡å¯ï¼Œé‚£ä¹ˆè¯¥æ¶ˆæ¯å°±ä¼šè¢«ä¸¢å¤±ã€‚</li>\n</ul>\n<p>æ‰‹åŠ¨æäº¤åˆ™æ˜¯ä¸€ç§æ›´ä¸ºç¨³å¦¥çš„æ–¹å¼ï¼Œå½“æŸæ¡æ¶ˆæ¯å½»åº•å¤„ç†å¥½åï¼Œå†ä¸»åŠ¨å‘Brokeræäº¤æ¶ˆæ¯ï¼Œé¿å…å‡ºç°ä¸ä¸€è‡´çš„æƒ…å†µã€‚<br><img src=\"https://raw.githubusercontent.com/lyydsheep/pic/main/20250105150142.png\" alt=\"image.png\"></p>\n<p><strong>æ¶ˆè´¹è€…ç»„ConsumerGroup</strong><br>æ¶ˆè´¹è€…ç»„å®è´¨å°±æ˜¯ç”±å¤šä¸ªæ¶ˆè´¹è€…ç»„æˆçš„é›†åˆï¼Œä¸€ä¸ªæ¶ˆè´¹è€…ç»„ç”±ä¸€ä¸ªGroupIDå”¯ä¸€æ ‡è¯†ã€‚<br>å¤šä¸ªæ¶ˆè´¹è€…ç»„æˆæ¶ˆè´¹è€…ç»„ï¼Œé‚£ä¹ˆè¿™äº›æ¶ˆè´¹è€…å¿…é¡»æœ‰ä¸€äº›çº¦æŸï¼š</p>\n<ul>\n<li>åœ¨åŒä¸€ä¸ªæ¶ˆè´¹è€…ç»„ä¸­ï¼Œä¸€ä¸ªPartitionåªèƒ½åˆ†é…ä¸€ä¸ªæ¶ˆè´¹è€…</li>\n<li>åŒä¸€ä¸ªæ¶ˆè´¹è€…ç»„ä¸­ï¼Œå¯ä»¥åˆ†æ´¾å¤šä¸ªæ¶ˆè´¹è€…</li>\n<li>ä¸åŒæ¶ˆè´¹è€…ç»„å¯ä»¥åŒæ—¶æ¶ˆè´¹åŒä¸€ä¸ªTopic<br>æ¶ˆè´¹è€…ç»„åœ¨æ¶ˆè´¹è€…æ–¹é¢è¿›è¡Œäº†æ°´å¹³æ‰©å®¹ï¼Œæé«˜äº†æ¶ˆè´¹èƒ½åŠ›ã€‚</li>\n</ul>\n<p>æ¶ˆè´¹è€…ç»„å’‹çœ¼ä¸€çœ‹æ²¡å¤šå¤§ç”¨å¤„ï¼Œå®é™…ä¸Šï¼Œæ¶ˆè´¹è€…ç»„å¸¦æ¥çš„æœ€å¤§ä¾¿åˆ©åœ¨äºå¯¹åˆ†åŒºçš„å°è£…æ€§ï¼Œä¸€ä¸ªæ¶ˆè´¹è€…ç»„å¯ä»¥è‡ªåŠ¨å®Œæˆ<strong>Re balance</strong>æ“ä½œï¼Œä½¿å¾—Partitionå¯¹äºæ¶ˆè´¹è€…æ˜¯é€æ˜çš„ã€‚åä¹‹ï¼Œæ¶ˆè´¹è€…æ¯æ¬¡æ‹‰å–æ¶ˆæ¯éƒ½è¦æŒ‡å®šPartitionï¼Œè¿™å°±å¯¼è‡´Partitionå’Œæ¶ˆè´¹è€…è€¦åˆåœ¨ä¸€å—ï¼ŒPartitionæ•°é‡å‘ç”Ÿå˜åŠ¨ï¼Œæ¶ˆè´¹è€…æ–¹é¢çš„ä»£ç å°±è¦éšä¹‹å˜åŠ¨</p>\n<p><strong>æ¶ˆè´¹è€…ç»„åˆ†åŒºåˆ†é…ç­–ç•¥</strong><br> partition.assignment.strategyå­—æ®µå¯ä»¥é…ç½®æ¶ˆè´¹è€…ç»„ä¸­å¤šä¸ªæ¶ˆè´¹è€…å¯¹äºåˆ†åŒºåˆ†é…çš„è§„åˆ™ï¼š</p>\n<ul>\n<li>Range Assignorï¼šåŸºäºèŒƒå›´çš„åˆ†é…ç­–ç•¥</li>\n<li>Round Robin Assignorï¼šåŸºäºè½®è¯¢çš„åˆ†é…ç­–ç•¥</li>\n<li>Sticky Assignorï¼šä¼˜å…ˆä¿æŒå½“å‰çš„åˆ†é…çŠ¶æ€ï¼Œå°½é‡å‡å°‘Rebalanceè¿‡ç¨‹ä¸­åˆ†åŒºçš„ç§»åŠ¨</li>\n<li>CooperativeSticky Assignorï¼šåŸºæœ¬å’ŒSticky Assignorç­–ç•¥ä¸€è‡´ï¼Œä½†æ˜¯åŒºåˆ«åœ¨äºè¯¥åè®®å°†åŸæ¥ä¸€æ¬¡è¡Œå¯¹ä¸€å¤§ç‰‡åˆ†åŒºè¿›è¡ŒRebalanceæ”¹ä¸ºå¤šæ¬¡å°è§„æ¨¡çš„Rebalanceæ“ä½œï¼Œå³æ¸è¿›å¼Rebalance</li>\n</ul>\n<h2 id=\"Rebalanceæœºåˆ¶\"><a href=\"#Rebalanceæœºåˆ¶\" class=\"headerlink\" title=\"Rebalanceæœºåˆ¶\"></a>Rebalanceæœºåˆ¶</h2><p> Rebalanceæœºåˆ¶ç”¨äºç¡®ä¿æ•°æ®åœ¨æ¶ˆè´¹è€…ç»„ä¸­å°½å¯èƒ½åœ°è´Ÿè½½å‡è¡¡<br> è§¦å‘Rebalanceçš„ä¸‰ä¸ªæ—¶æœºï¼š</p>\n<ul>\n<li>åŠ å…¥æ–°çš„æ¶ˆè´¹è€…</li>\n<li>æ¶ˆè´¹è€…å‡å°‘ï¼Œä¸è®ºæ˜¯æ­£å¸¸å…³é—­è¿˜æ˜¯å´©æºƒ</li>\n<li>Topicä¸‹çš„Partitionæ•°é‡å‘ç”Ÿå˜åŒ–</li>\n</ul>\n<p><strong>å†å¹³è¡¡çš„æ­¥éª¤</strong><br>å†å¹³è¡¡æ“ä½œéœ€è¦ç»å†äº”ä¸ªé˜¶æ®µï¼š</p>\n<ol>\n<li>æš‚åœæ¶ˆè´¹ï¼Œæ¶ˆè´¹è€…éœ€è¦æš‚åœæ­£åœ¨è¿›è¡Œçš„æ¶ˆè´¹ï¼Œé˜²æ­¢é‡æ–°åˆ†é…è¿‡ç¨‹ä¸­å‡ºç°æ•°æ®ä¸¢å¤±æˆ–é‡å¤é—®é¢˜</li>\n<li>è§¦å‘å†åˆ†é…ï¼Œç”±æ¶ˆè´¹è€…ç»„åè°ƒå™¨Group Coordinatorï¼ˆé€šå¸¸æ˜¯ä¸€ä¸ªBrokerï¼‰è§¦å‘å†å¹³è¡¡</li>\n<li>åˆ†é…åˆ†åŒºï¼Œæ¶ˆè´¹è€…é…åˆåè°ƒå™¨æ ¹æ®å½“å‰æ¶ˆè´¹è€…å’Œåˆ†åŒºæ•°é‡ï¼Œé‡æ–°åˆ†é…ä¸»é¢˜çš„åˆ†åŒº</li>\n<li>è·å–åˆ†é…ä¿¡æ¯ï¼Œé‡æ–°åˆ†é…å®Œæˆåï¼Œæ¶ˆè´¹è€…ä¼šä»åè°ƒå™¨æ‹¿åˆ°æ–°çš„åˆ†åŒºåˆ†é…æƒ…å†µ</li>\n<li>æ¢å¤æ¶ˆè´¹ï¼Œæ¶ˆè´¹è€…æ”¶åˆ°æ–°çš„åˆ†é…åï¼Œæ¢å¤æ¶ˆè´¹ï¼Œå¼€å§‹å¤„ç†æ–°åˆ†åŒº</li>\n</ol>\n<p>ä¸Šæ–‡æåˆ°æœ‰å››ç§æ¶ˆè´¹ç»„åˆ†åŒºåˆ†é…ç­–ç•¥ï¼Œè¿™å››ç§åˆ†é…ç­–ç•¥å¯ä»¥ä¾æ®æ˜¯å¦äº§ç”ŸSTWé—®é¢˜åˆ†ä¸ºEagerå’ŒIncrementalä¸¤ç§å†å¹³è¡¡ç­–ç•¥ã€‚å…¶ä¸­å‰ä¸‰ç§æ–¹æ¡ˆéƒ½æ˜¯Eagerç­–ç•¥ï¼Œå› ä¸ºè¿™ä¸‰ç§åˆ†é…ç­–ç•¥åœ¨æš‚åœæ¶ˆè´¹è€…é˜¶æ®µä¼šåœæ­¢æ‰€æœ‰çš„æ¶ˆè´¹è¡Œä¸ºï¼Œè€ŒCooperative Stickyæ–¹å¼åˆ™åªä¼šæš‚åœéƒ¨åˆ†æ¶ˆè´¹è€…ï¼Œæœªè¢«æš‚åœçš„æ¶ˆè´¹è€…ä»èƒ½ç»§ç»­æ¶ˆè´¹è¡Œä¸ºï¼Œä½†ä»£ä»·æ˜¯Rebalanceçš„æ—¶é—´è¢«å»¶é•¿</p>\n<p><strong>Group Coordinatoræ˜¯ä»€ä¹ˆ</strong>ï¼Ÿ</p>\n"},{"description":"é»˜è®¤æ”¯æŒæµç¨‹å›¾ï¼Œtabsé¢æ¿ï¼Œå¾…åŠåˆ—è¡¨ï¼Œä½œå“é¡µé¢","publish":false,"_content":"\n# å†…ç½®ç¬¬ä¸‰æ–¹æ’ä»¶èƒ½åŠ›\n\néƒ¨åˆ†å†…ç½®ç»„ä»¶ï¼ˆæ’ä»¶ï¼‰ï¼Œæ¥æº [vitepress.yiov.top](https://vitepress.yiov.top/plugin.html) æ¨è\n\n## oml2d - çœ‹æ¿å¨˜é›†æˆ\n* Typeï¼š[oml2dOptions](https://oml2d.com/options/Options.html)\n\nä¸ºç½‘ç«™æä¾›ä¸€ä¸ª Live2D çœ‹æ¿ç»„ä»¶ã€‚\n\n:::tip ä¸€ç‚¹è¯´æ˜\né€šè¿‡å†…ç½® [oh-my-live2d](https://oml2d.com) å®ç°, å¯ä»¥é€šè¿‡ `oml2d` é€‰é¡¹é…ç½®ã€‚\n\né€šè¿‡è¿™ä¸ªèƒ½åŠ›å¯ä»¥å¿«é€ŸåŠ å…¥å¹¶å®šåˆ¶å±äºè‡ªå·±çš„çœ‹æ¿å¨˜, å¼€å¯åªéœ€è¦ä¸ºå…¶ä¼ é€’ä¸€ä¸ª [é…ç½®é€‰é¡¹](https://oml2d.com/options/Options.html) å³å¯\n:::\n\nä»¥ä¸‹æ˜¯ä¸€ä¸ªç®€å•çš„ä½¿ç”¨ç¤ºä¾‹ï¼Œå½“æ¨¡å‹åŠ è½½æˆåŠŸæ—¶å®ƒå°†å‡ºç°åœ¨æ‚¨ç½‘ç«™çš„å·¦ä¸‹è§’ã€‚\n\n```ts\nconst blogTheme = getThemeConfig({\n  oml2d: {\n    mobileDisplay: true,\n    models: [\n      {\n        path: 'https://registry.npmmirror.com/oml2d-models/latest/files/models/Senko_Normals/senko.model3.json'\n      }\n    ]\n  }\n})\n```\næ•ˆæœå›¾å¦‚ä¸‹\n\n![](https://loclink-1259720482.cos.ap-beijing.myqcloud.com/image/%E5%BD%95%E5%B1%8F2024-03-11%2023.51.51.gif)\n\nä¹‹åæ‚¨è¿˜å¯ä»¥å‰å¾€[é…ç½®é€‰é¡¹](https://oml2d.com/options/Options.html)æŸ¥é˜…æ›´å¤šè‡ªå®šä¹‰å†…å®¹\n\n:::tip ç‰ˆæœ¬è¯´æ˜\nç”±äºæ—¶é—´åŸå› ï¼Œä¸»é¢˜å†…ç½®çš„ç‰ˆæœ¬ä¸ä¸€å®šéƒ½æ˜¯æœ€æ–°çš„ï¼Œå¯ä»¥é€šè¿‡ `resolutions` é…ç½®æŒ‡å®šè¦ä½¿ç”¨çš„ç‰ˆæœ¬ã€‚\n\nä¸‹é¢æ˜¯ä½¿ç”¨ç¤ºä¾‹ï¼Œé…ç½®åœ¨ `package.json` ä¸­ï¼Œå…¶å®ƒä¾èµ–è¦†ç›–ç‰ˆæœ¬ä¹Ÿæ˜¯è¿™æ ·æ“ä½œã€‚\n```json\n{\n  \"resolutions\": {\n    \"oh-my-live2d\": \"^0.17.0\"\n  }\n}\n```\n:::\n\n## task-checkbox\n* Type: `boolean | TaskCheckbox`\n\næ”¯æŒæ¸²æŸ“ markdown ä»»åŠ¡åˆ—è¡¨ï¼Œå†…ç½® [markdown-it-task-checkbox](https://github.com/linsir/markdown-it-task-checkbox) æ’ä»¶æä¾›æ”¯æŒ\n\n* [ ] ğŸ¥” TODO\n* [ ] çœŸä¸æˆ³\n* [x] å†…ç½®ä»»åŠ¡åˆ—è¡¨\n\nè¯­æ³•å¦‚ä¸‹\n```md\n* [ ] ğŸ¥” TODO\n* [ ] çœŸä¸æˆ³\n* [x] å†…ç½®ä»»åŠ¡åˆ—è¡¨\n```\n\né»˜è®¤å¼€å¯ï¼Œä½ å¯ä»¥è¿›ä¸€æ­¥é…ç½®\n\n:::code-group\n```ts [â‘  å…³é—­]\nconst blogTheme = getThemeConfig({\n  taskCheckbox: false\n})\n```\n```ts [â‘¡ è¿›ä¸€æ­¥é…ç½®]\nconst blogTheme = getThemeConfig({\n  taskCheckbox: {\n    // refer https://github.com/linsir/markdown-it-task-checkbox for options\n  }\n})\n```\n```ts [â‘¢ type]\ninterface TaskCheckbox {\n  disabled?: boolean\n  divWrap?: boolean\n  divClass?: string\n  idPrefix?: string\n  ulClass?: string\n  liClass?: string\n}\n```\n:::\n\n## timeline\n* Type: `boolean`\n* default: `true`\n\næä¾› markdown æ—¶é—´çº¿è¯­æ³•ï¼Œåœ¨ vitepress ä¸­ä½¿ç”¨ markdown æ¸²æŸ“æ—¶é—´çº¿ï¼ˆæ—¶é—´è½´ï¼‰æ ·å¼ã€‚\n\n:::tip ä¸€ç‚¹è¯´æ˜\nå†…ç½® [vitepress-markdown-timeline](https://github.com/HanochMa/vitepress-markdown-timeline) å®ç°\n:::\n\næ•ˆæœå¦‚ä¸‹\n\n::: timeline 2023-05-24\n- **do some thing1**\n- do some thing2\n:::\n\n::: timeline 2023-05-23\ndo some thing3\ndo some thing4\n:::\n\nè¯­æ³•å¦‚ä¸‹\n```md\n::: timeline 2023-05-24\n- **do some thing1**\n- do some thing2\n:::\n\n::: timeline 2023-05-23\ndo some thing3\ndo some thing4\n:::\n```\n\n:::code-group\n```ts [å…³é—­]\nconst blogTheme = getThemeConfig({\n  timeline: false\n})\n```\n:::\n## tabs\n* Type: `boolean`\n\næ”¯æŒå±€éƒ¨çš„`tabs`é¢æ¿ï¼Œ**é»˜è®¤å¼€å¯**\n\n:::details æˆ‘ä¹‹å‰æ‰‹åŠ¨å®‰è£…é…ç½®äº†æ€ä¹ˆåŠï¼Ÿ\nâ‘  package.json ä¸­ç§»é™¤ vitepress-plugin-tabs ä¾èµ–\n\nâ‘¡ .vitepress/theme/index.ts ä¸­ç§»é™¤æ³¨å†Œçš„ç»„ä»¶`enhanceAppWithTabs`\n\nâ‘¢ ï¼ˆå¯é€‰ï¼‰`getThemeConfig` ä¸­ç§»é™¤é…ç½®é¡¹`tabs`\n:::\n:::tip ä¸€ç‚¹è¯´æ˜\nåŸºäº [vitepress-plugin-tabs@0.2.0](https://www.npmjs.com/package/vitepress-plugin-tabs) å†…ç½®å®ç°\n:::\n\næ•ˆæœå¦‚ä¸‹\n\n:::=tabs\n::tab1\nä¸€äº›å†…å®¹\n\nä¸€äº›å†…å®¹\n\nä¸€äº›å†…å®¹\n\n::tab2\nä¸€äº›å†…å®¹ ã€‚ã€‚ã€‚\n:::\n\nç®€å•çš„ä½¿ç”¨æ–¹å¼å¦‚ä¸‹ï¼ˆæ•ˆæœå¦‚ä¸Šé¢çš„ç¤ºä¾‹ï¼‰\n\n```md\n:::=tabs\n::tab1\nä¸€äº›å†…å®¹\n\nä¸€äº›å†…å®¹\n\nä¸€äº›å†…å®¹\n\n::tab2\nä¸€äº›å†…å®¹ ã€‚ã€‚ã€‚\n:::\n```\n\nå…±äº«çŠ¶æ€çš„ä½¿ç”¨æ–¹å¼å¦‚ä¸‹\n\n```md\n:::=tabs=ab\n::a\na content\n\n::b\nb content\n:::\n\n:::=tabs=ab\n::a\na content 2\n\n::b\nb content 2\n:::\n```\n\n\n:::=tabs=ab\n::a\na content\n\n::b\nb content\n:::\n\n:::=tabs=ab\n::a\na content 2\n\n::b\nb content 2\n:::\n\nä¸éœ€è¦ä¹Ÿå¯ä»¥å…³é—­\n\n```ts\n// .vitepress/blog-theme.ts\nconst blogTheme = getThemeConfig({\n  tabs: false\n})\n```\n\n## Mermaid - å›¾è¡¨\n* Type: `boolean`|`object`\n\n>é€šè¿‡è§£æç±» Markdown çš„æ–‡æœ¬è¯­æ³•æ¥å®ç°å›¾è¡¨çš„åˆ›å»ºå’ŒåŠ¨æ€ä¿®æ”¹ã€‚\n\n:::tip ä¸€ç‚¹è¯´æ˜\nåŸºäº [vitepress-plugin-mermaid](https://github.com/emersonbottero/vitepress-plugin-mermaid) å®ç°\n:::\n\nç®€å•è¯­æ³•å¦‚ä¸‹ï¼Œè¯¦ç»†æµç¨‹å›¾è¯­æ³•è§ [Mermaid ä¸­æ–‡æ–‡æ¡£](https://github.com/mermaid-js/mermaid/blob/develop/README.zh-CN.md)\n\n<pre>\n```mermaid\nflowchart TD\n  Start --> Stop\n```\n</pre>\n\n\næ•ˆæœå¦‚ä¸‹\n\n```mermaid\nflowchart TD\n  Start --> Stop\n```\n\n**é»˜è®¤å…³é—­**ï¼Œå¯ä»¥é€šè¿‡è®¾ç½® `mermaid: true` å¼€å¯ï¼Œæˆ–è¿›è¡Œè¿›ä¸€æ­¥é…ç½®ã€‚\n\n:::code-group\n```ts [â‘  å¼€å¯]\nconst blogTheme = getThemeConfig({\n  mermaid: true\n})\n```\n```ts [â‘¡ è¿›ä¸€æ­¥é…ç½®]\nconst blogTheme = getThemeConfig({\n  mermaid: {\n    // refer https://mermaid.js.org/config/setup/modules/mermaidAPI.html#mermaidapi-configuration-defaults for options\n  }\n})\n```\n:::\n\nä¸‹é¢çœ‹ä¸€ä¸‹å®˜æ–¹å…¶å®ƒæ¡ˆä¾‹\n\n**æ—¶åºå›¾**\n```mermaid\nsequenceDiagram\nAlice->>John: Hello John, how are you?\nloop Healthcheck\n    John->>John: Fight against hypochondria\nend\nNote right of John: Rational thoughts!\nJohn-->>Alice: Great!\nJohn->>Bob: How about you?\nBob-->>John: Jolly good!\n```\n\n**ç”˜ç‰¹å›¾**\n```mermaid\ngantt\n    section Section\n    Completed :done,    des1, 2014-01-06,2014-01-08\n    Active        :active,  des2, 2014-01-07, 3d\n    Parallel 1   :         des3, after des1, 1d\n    Parallel 2   :         des4, after des1, 1d\n    Parallel 3   :         des5, after des3, 1d\n    Parallel 4   :         des6, after des4, 1d\n```\n\n\n## UserWorksPage\n* Type: `UserWorks`\n\nç”¨äºä½œå“åˆ—è¡¨å±•ç¤º\n\næ•ˆæœå¦‚ä¸‹ï¼Œè¯¦è§ [ä¸ªäººä½œå“å±•ç¤º](https://theme.sugarat.top/work.html)\n\n![](https://img.cdn.sugarat.top/mdImg/MTY4NzA4ODczMzkwNg==687088733906)\n\næ–°å»ºä¸€ä¸ª`works.md`æ–‡ä»¶ï¼Œæ”¾å…¥ä»¥ä¸‹å†…å®¹\n\n```md\n---\nlayout: page\ntitle: ä¸ªäººä½œå“å±•ç¤º\nsidebar: false\noutline: [2,3]\nsticky: 1\n---\n<UserWorksPage />\n```\n\nå†…å®¹é…ç½®æ–¹å¼å¦‚ä¸‹\n\n::: code-group\n\n```ts [default]\nconst blogTheme = getThemeConfig({\n  works: {\n    title: 'ä¸ªäººé¡¹ç›®/çº¿ä¸Šä½œå“',\n    description: 'è®°å½•å¼€å‘çš„ç‚¹ç‚¹æ»´æ»´',\n    topTitle: 'ä¸¾äº›ğŸŒ°',\n    list: [\n      {\n        title: 'åšå®¢ä¸»é¢˜ @sugarat/theme',\n        description: 'åŸºäº vitepress å®ç°çš„åšå®¢ä¸»é¢˜',\n        time: {\n          start: '2023/01/29'\n        },\n        github: {\n          owner: 'ATQQ',\n          repo: 'sugar-blog',\n          branch: 'master',\n          path: 'packages/theme'\n        },\n        status: {\n          text: 'è‡ªå®šä¹‰badge'\n        },\n        url: 'https://theme.sugarat.top',\n        cover:\n          'https://img.cdn.sugarat.top/mdImg/MTY3MzE3MDUxOTMwMw==673170519303',\n        tags: ['Vitepress', 'Vue'],\n        links: [\n          {\n            title: 'ä¸€ä¸ªç®€çº¦é£çš„VitePressåšå®¢ä¸»é¢˜',\n            url: 'https://juejin.cn/post/7196517835380293693'\n          }\n        ]\n      }\n    ]\n  }\n})\n```\n\n```ts [type]\ninterface UserWorks {\n  title: string\n  description?: string\n  topTitle?: string\n  list: UserWork[]\n}\ninterface UserWork {\n  title: string\n  description: string\n  time:\n  | string\n  | {\n    start: string\n    end?: string\n    lastupdate?: string\n  }\n  status?: {\n    text: string\n    type?: 'tip' | 'warning' | 'danger'\n  }\n  url?: string\n  github?:\n  | string\n  | {\n    owner: string\n    repo: string\n    branch?: string\n    path?: string\n  }\n  cover?:\n  | string\n  | string[]\n  | {\n    urls: string[]\n    layout?: 'swiper' | 'list'\n  }\n  links?: {\n    title: string\n    url: string\n  }[]\n  tags?: string[]\n  top?: number\n}\n```\n\n:::\n","source":"_posts/component.md","raw":"---\ndescription: é»˜è®¤æ”¯æŒæµç¨‹å›¾ï¼Œtabsé¢æ¿ï¼Œå¾…åŠåˆ—è¡¨ï¼Œä½œå“é¡µé¢\npublish: false\n---\n\n# å†…ç½®ç¬¬ä¸‰æ–¹æ’ä»¶èƒ½åŠ›\n\néƒ¨åˆ†å†…ç½®ç»„ä»¶ï¼ˆæ’ä»¶ï¼‰ï¼Œæ¥æº [vitepress.yiov.top](https://vitepress.yiov.top/plugin.html) æ¨è\n\n## oml2d - çœ‹æ¿å¨˜é›†æˆ\n* Typeï¼š[oml2dOptions](https://oml2d.com/options/Options.html)\n\nä¸ºç½‘ç«™æä¾›ä¸€ä¸ª Live2D çœ‹æ¿ç»„ä»¶ã€‚\n\n:::tip ä¸€ç‚¹è¯´æ˜\né€šè¿‡å†…ç½® [oh-my-live2d](https://oml2d.com) å®ç°, å¯ä»¥é€šè¿‡ `oml2d` é€‰é¡¹é…ç½®ã€‚\n\né€šè¿‡è¿™ä¸ªèƒ½åŠ›å¯ä»¥å¿«é€ŸåŠ å…¥å¹¶å®šåˆ¶å±äºè‡ªå·±çš„çœ‹æ¿å¨˜, å¼€å¯åªéœ€è¦ä¸ºå…¶ä¼ é€’ä¸€ä¸ª [é…ç½®é€‰é¡¹](https://oml2d.com/options/Options.html) å³å¯\n:::\n\nä»¥ä¸‹æ˜¯ä¸€ä¸ªç®€å•çš„ä½¿ç”¨ç¤ºä¾‹ï¼Œå½“æ¨¡å‹åŠ è½½æˆåŠŸæ—¶å®ƒå°†å‡ºç°åœ¨æ‚¨ç½‘ç«™çš„å·¦ä¸‹è§’ã€‚\n\n```ts\nconst blogTheme = getThemeConfig({\n  oml2d: {\n    mobileDisplay: true,\n    models: [\n      {\n        path: 'https://registry.npmmirror.com/oml2d-models/latest/files/models/Senko_Normals/senko.model3.json'\n      }\n    ]\n  }\n})\n```\næ•ˆæœå›¾å¦‚ä¸‹\n\n![](https://loclink-1259720482.cos.ap-beijing.myqcloud.com/image/%E5%BD%95%E5%B1%8F2024-03-11%2023.51.51.gif)\n\nä¹‹åæ‚¨è¿˜å¯ä»¥å‰å¾€[é…ç½®é€‰é¡¹](https://oml2d.com/options/Options.html)æŸ¥é˜…æ›´å¤šè‡ªå®šä¹‰å†…å®¹\n\n:::tip ç‰ˆæœ¬è¯´æ˜\nç”±äºæ—¶é—´åŸå› ï¼Œä¸»é¢˜å†…ç½®çš„ç‰ˆæœ¬ä¸ä¸€å®šéƒ½æ˜¯æœ€æ–°çš„ï¼Œå¯ä»¥é€šè¿‡ `resolutions` é…ç½®æŒ‡å®šè¦ä½¿ç”¨çš„ç‰ˆæœ¬ã€‚\n\nä¸‹é¢æ˜¯ä½¿ç”¨ç¤ºä¾‹ï¼Œé…ç½®åœ¨ `package.json` ä¸­ï¼Œå…¶å®ƒä¾èµ–è¦†ç›–ç‰ˆæœ¬ä¹Ÿæ˜¯è¿™æ ·æ“ä½œã€‚\n```json\n{\n  \"resolutions\": {\n    \"oh-my-live2d\": \"^0.17.0\"\n  }\n}\n```\n:::\n\n## task-checkbox\n* Type: `boolean | TaskCheckbox`\n\næ”¯æŒæ¸²æŸ“ markdown ä»»åŠ¡åˆ—è¡¨ï¼Œå†…ç½® [markdown-it-task-checkbox](https://github.com/linsir/markdown-it-task-checkbox) æ’ä»¶æä¾›æ”¯æŒ\n\n* [ ] ğŸ¥” TODO\n* [ ] çœŸä¸æˆ³\n* [x] å†…ç½®ä»»åŠ¡åˆ—è¡¨\n\nè¯­æ³•å¦‚ä¸‹\n```md\n* [ ] ğŸ¥” TODO\n* [ ] çœŸä¸æˆ³\n* [x] å†…ç½®ä»»åŠ¡åˆ—è¡¨\n```\n\né»˜è®¤å¼€å¯ï¼Œä½ å¯ä»¥è¿›ä¸€æ­¥é…ç½®\n\n:::code-group\n```ts [â‘  å…³é—­]\nconst blogTheme = getThemeConfig({\n  taskCheckbox: false\n})\n```\n```ts [â‘¡ è¿›ä¸€æ­¥é…ç½®]\nconst blogTheme = getThemeConfig({\n  taskCheckbox: {\n    // refer https://github.com/linsir/markdown-it-task-checkbox for options\n  }\n})\n```\n```ts [â‘¢ type]\ninterface TaskCheckbox {\n  disabled?: boolean\n  divWrap?: boolean\n  divClass?: string\n  idPrefix?: string\n  ulClass?: string\n  liClass?: string\n}\n```\n:::\n\n## timeline\n* Type: `boolean`\n* default: `true`\n\næä¾› markdown æ—¶é—´çº¿è¯­æ³•ï¼Œåœ¨ vitepress ä¸­ä½¿ç”¨ markdown æ¸²æŸ“æ—¶é—´çº¿ï¼ˆæ—¶é—´è½´ï¼‰æ ·å¼ã€‚\n\n:::tip ä¸€ç‚¹è¯´æ˜\nå†…ç½® [vitepress-markdown-timeline](https://github.com/HanochMa/vitepress-markdown-timeline) å®ç°\n:::\n\næ•ˆæœå¦‚ä¸‹\n\n::: timeline 2023-05-24\n- **do some thing1**\n- do some thing2\n:::\n\n::: timeline 2023-05-23\ndo some thing3\ndo some thing4\n:::\n\nè¯­æ³•å¦‚ä¸‹\n```md\n::: timeline 2023-05-24\n- **do some thing1**\n- do some thing2\n:::\n\n::: timeline 2023-05-23\ndo some thing3\ndo some thing4\n:::\n```\n\n:::code-group\n```ts [å…³é—­]\nconst blogTheme = getThemeConfig({\n  timeline: false\n})\n```\n:::\n## tabs\n* Type: `boolean`\n\næ”¯æŒå±€éƒ¨çš„`tabs`é¢æ¿ï¼Œ**é»˜è®¤å¼€å¯**\n\n:::details æˆ‘ä¹‹å‰æ‰‹åŠ¨å®‰è£…é…ç½®äº†æ€ä¹ˆåŠï¼Ÿ\nâ‘  package.json ä¸­ç§»é™¤ vitepress-plugin-tabs ä¾èµ–\n\nâ‘¡ .vitepress/theme/index.ts ä¸­ç§»é™¤æ³¨å†Œçš„ç»„ä»¶`enhanceAppWithTabs`\n\nâ‘¢ ï¼ˆå¯é€‰ï¼‰`getThemeConfig` ä¸­ç§»é™¤é…ç½®é¡¹`tabs`\n:::\n:::tip ä¸€ç‚¹è¯´æ˜\nåŸºäº [vitepress-plugin-tabs@0.2.0](https://www.npmjs.com/package/vitepress-plugin-tabs) å†…ç½®å®ç°\n:::\n\næ•ˆæœå¦‚ä¸‹\n\n:::=tabs\n::tab1\nä¸€äº›å†…å®¹\n\nä¸€äº›å†…å®¹\n\nä¸€äº›å†…å®¹\n\n::tab2\nä¸€äº›å†…å®¹ ã€‚ã€‚ã€‚\n:::\n\nç®€å•çš„ä½¿ç”¨æ–¹å¼å¦‚ä¸‹ï¼ˆæ•ˆæœå¦‚ä¸Šé¢çš„ç¤ºä¾‹ï¼‰\n\n```md\n:::=tabs\n::tab1\nä¸€äº›å†…å®¹\n\nä¸€äº›å†…å®¹\n\nä¸€äº›å†…å®¹\n\n::tab2\nä¸€äº›å†…å®¹ ã€‚ã€‚ã€‚\n:::\n```\n\nå…±äº«çŠ¶æ€çš„ä½¿ç”¨æ–¹å¼å¦‚ä¸‹\n\n```md\n:::=tabs=ab\n::a\na content\n\n::b\nb content\n:::\n\n:::=tabs=ab\n::a\na content 2\n\n::b\nb content 2\n:::\n```\n\n\n:::=tabs=ab\n::a\na content\n\n::b\nb content\n:::\n\n:::=tabs=ab\n::a\na content 2\n\n::b\nb content 2\n:::\n\nä¸éœ€è¦ä¹Ÿå¯ä»¥å…³é—­\n\n```ts\n// .vitepress/blog-theme.ts\nconst blogTheme = getThemeConfig({\n  tabs: false\n})\n```\n\n## Mermaid - å›¾è¡¨\n* Type: `boolean`|`object`\n\n>é€šè¿‡è§£æç±» Markdown çš„æ–‡æœ¬è¯­æ³•æ¥å®ç°å›¾è¡¨çš„åˆ›å»ºå’ŒåŠ¨æ€ä¿®æ”¹ã€‚\n\n:::tip ä¸€ç‚¹è¯´æ˜\nåŸºäº [vitepress-plugin-mermaid](https://github.com/emersonbottero/vitepress-plugin-mermaid) å®ç°\n:::\n\nç®€å•è¯­æ³•å¦‚ä¸‹ï¼Œè¯¦ç»†æµç¨‹å›¾è¯­æ³•è§ [Mermaid ä¸­æ–‡æ–‡æ¡£](https://github.com/mermaid-js/mermaid/blob/develop/README.zh-CN.md)\n\n<pre>\n```mermaid\nflowchart TD\n  Start --> Stop\n```\n</pre>\n\n\næ•ˆæœå¦‚ä¸‹\n\n```mermaid\nflowchart TD\n  Start --> Stop\n```\n\n**é»˜è®¤å…³é—­**ï¼Œå¯ä»¥é€šè¿‡è®¾ç½® `mermaid: true` å¼€å¯ï¼Œæˆ–è¿›è¡Œè¿›ä¸€æ­¥é…ç½®ã€‚\n\n:::code-group\n```ts [â‘  å¼€å¯]\nconst blogTheme = getThemeConfig({\n  mermaid: true\n})\n```\n```ts [â‘¡ è¿›ä¸€æ­¥é…ç½®]\nconst blogTheme = getThemeConfig({\n  mermaid: {\n    // refer https://mermaid.js.org/config/setup/modules/mermaidAPI.html#mermaidapi-configuration-defaults for options\n  }\n})\n```\n:::\n\nä¸‹é¢çœ‹ä¸€ä¸‹å®˜æ–¹å…¶å®ƒæ¡ˆä¾‹\n\n**æ—¶åºå›¾**\n```mermaid\nsequenceDiagram\nAlice->>John: Hello John, how are you?\nloop Healthcheck\n    John->>John: Fight against hypochondria\nend\nNote right of John: Rational thoughts!\nJohn-->>Alice: Great!\nJohn->>Bob: How about you?\nBob-->>John: Jolly good!\n```\n\n**ç”˜ç‰¹å›¾**\n```mermaid\ngantt\n    section Section\n    Completed :done,    des1, 2014-01-06,2014-01-08\n    Active        :active,  des2, 2014-01-07, 3d\n    Parallel 1   :         des3, after des1, 1d\n    Parallel 2   :         des4, after des1, 1d\n    Parallel 3   :         des5, after des3, 1d\n    Parallel 4   :         des6, after des4, 1d\n```\n\n\n## UserWorksPage\n* Type: `UserWorks`\n\nç”¨äºä½œå“åˆ—è¡¨å±•ç¤º\n\næ•ˆæœå¦‚ä¸‹ï¼Œè¯¦è§ [ä¸ªäººä½œå“å±•ç¤º](https://theme.sugarat.top/work.html)\n\n![](https://img.cdn.sugarat.top/mdImg/MTY4NzA4ODczMzkwNg==687088733906)\n\næ–°å»ºä¸€ä¸ª`works.md`æ–‡ä»¶ï¼Œæ”¾å…¥ä»¥ä¸‹å†…å®¹\n\n```md\n---\nlayout: page\ntitle: ä¸ªäººä½œå“å±•ç¤º\nsidebar: false\noutline: [2,3]\nsticky: 1\n---\n<UserWorksPage />\n```\n\nå†…å®¹é…ç½®æ–¹å¼å¦‚ä¸‹\n\n::: code-group\n\n```ts [default]\nconst blogTheme = getThemeConfig({\n  works: {\n    title: 'ä¸ªäººé¡¹ç›®/çº¿ä¸Šä½œå“',\n    description: 'è®°å½•å¼€å‘çš„ç‚¹ç‚¹æ»´æ»´',\n    topTitle: 'ä¸¾äº›ğŸŒ°',\n    list: [\n      {\n        title: 'åšå®¢ä¸»é¢˜ @sugarat/theme',\n        description: 'åŸºäº vitepress å®ç°çš„åšå®¢ä¸»é¢˜',\n        time: {\n          start: '2023/01/29'\n        },\n        github: {\n          owner: 'ATQQ',\n          repo: 'sugar-blog',\n          branch: 'master',\n          path: 'packages/theme'\n        },\n        status: {\n          text: 'è‡ªå®šä¹‰badge'\n        },\n        url: 'https://theme.sugarat.top',\n        cover:\n          'https://img.cdn.sugarat.top/mdImg/MTY3MzE3MDUxOTMwMw==673170519303',\n        tags: ['Vitepress', 'Vue'],\n        links: [\n          {\n            title: 'ä¸€ä¸ªç®€çº¦é£çš„VitePressåšå®¢ä¸»é¢˜',\n            url: 'https://juejin.cn/post/7196517835380293693'\n          }\n        ]\n      }\n    ]\n  }\n})\n```\n\n```ts [type]\ninterface UserWorks {\n  title: string\n  description?: string\n  topTitle?: string\n  list: UserWork[]\n}\ninterface UserWork {\n  title: string\n  description: string\n  time:\n  | string\n  | {\n    start: string\n    end?: string\n    lastupdate?: string\n  }\n  status?: {\n    text: string\n    type?: 'tip' | 'warning' | 'danger'\n  }\n  url?: string\n  github?:\n  | string\n  | {\n    owner: string\n    repo: string\n    branch?: string\n    path?: string\n  }\n  cover?:\n  | string\n  | string[]\n  | {\n    urls: string[]\n    layout?: 'swiper' | 'list'\n  }\n  links?: {\n    title: string\n    url: string\n  }[]\n  tags?: string[]\n  top?: number\n}\n```\n\n:::\n","slug":"component","published":1,"date":"2024-12-27T11:03:15.343Z","updated":"2024-12-27T11:03:15.343Z","title":"","comments":1,"layout":"post","photos":[],"_id":"cm6c7md6g0006a5t2f9co6cx2","content":"<h1 id=\"å†…ç½®ç¬¬ä¸‰æ–¹æ’ä»¶èƒ½åŠ›\"><a href=\"#å†…ç½®ç¬¬ä¸‰æ–¹æ’ä»¶èƒ½åŠ›\" class=\"headerlink\" title=\"å†…ç½®ç¬¬ä¸‰æ–¹æ’ä»¶èƒ½åŠ›\"></a>å†…ç½®ç¬¬ä¸‰æ–¹æ’ä»¶èƒ½åŠ›</h1><p>éƒ¨åˆ†å†…ç½®ç»„ä»¶ï¼ˆæ’ä»¶ï¼‰ï¼Œæ¥æº <a href=\"https://vitepress.yiov.top/plugin.html\">vitepress.yiov.top</a> æ¨è</p>\n<h2 id=\"oml2d-çœ‹æ¿å¨˜é›†æˆ\"><a href=\"#oml2d-çœ‹æ¿å¨˜é›†æˆ\" class=\"headerlink\" title=\"oml2d - çœ‹æ¿å¨˜é›†æˆ\"></a>oml2d - çœ‹æ¿å¨˜é›†æˆ</h2><ul>\n<li>Typeï¼š<a href=\"https://oml2d.com/options/Options.html\">oml2dOptions</a></li>\n</ul>\n<p>ä¸ºç½‘ç«™æä¾›ä¸€ä¸ª Live2D çœ‹æ¿ç»„ä»¶ã€‚</p>\n<p>:::tip ä¸€ç‚¹è¯´æ˜<br>é€šè¿‡å†…ç½® <a href=\"https://oml2d.com/\">oh-my-live2d</a> å®ç°, å¯ä»¥é€šè¿‡ <code>oml2d</code> é€‰é¡¹é…ç½®ã€‚</p>\n<p>é€šè¿‡è¿™ä¸ªèƒ½åŠ›å¯ä»¥å¿«é€ŸåŠ å…¥å¹¶å®šåˆ¶å±äºè‡ªå·±çš„çœ‹æ¿å¨˜, å¼€å¯åªéœ€è¦ä¸ºå…¶ä¼ é€’ä¸€ä¸ª <a href=\"https://oml2d.com/options/Options.html\">é…ç½®é€‰é¡¹</a> å³å¯<br>:::</p>\n<p>ä»¥ä¸‹æ˜¯ä¸€ä¸ªç®€å•çš„ä½¿ç”¨ç¤ºä¾‹ï¼Œå½“æ¨¡å‹åŠ è½½æˆåŠŸæ—¶å®ƒå°†å‡ºç°åœ¨æ‚¨ç½‘ç«™çš„å·¦ä¸‹è§’ã€‚</p>\n<figure class=\"highlight ts\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">const</span> blogTheme = <span class=\"title function_\">getThemeConfig</span>(&#123;</span><br><span class=\"line\">  <span class=\"attr\">oml2d</span>: &#123;</span><br><span class=\"line\">    <span class=\"attr\">mobileDisplay</span>: <span class=\"literal\">true</span>,</span><br><span class=\"line\">    <span class=\"attr\">models</span>: [</span><br><span class=\"line\">      &#123;</span><br><span class=\"line\">        <span class=\"attr\">path</span>: <span class=\"string\">&#x27;https://registry.npmmirror.com/oml2d-models/latest/files/models/Senko_Normals/senko.model3.json&#x27;</span></span><br><span class=\"line\">      &#125;</span><br><span class=\"line\">    ]</span><br><span class=\"line\">  &#125;</span><br><span class=\"line\">&#125;)</span><br></pre></td></tr></table></figure>\n<p>æ•ˆæœå›¾å¦‚ä¸‹</p>\n<p><img src=\"https://loclink-1259720482.cos.ap-beijing.myqcloud.com/image/%E5%BD%95%E5%B1%8F2024-03-11%2023.51.51.gif\"></p>\n<p>ä¹‹åæ‚¨è¿˜å¯ä»¥å‰å¾€<a href=\"https://oml2d.com/options/Options.html\">é…ç½®é€‰é¡¹</a>æŸ¥é˜…æ›´å¤šè‡ªå®šä¹‰å†…å®¹</p>\n<p>:::tip ç‰ˆæœ¬è¯´æ˜<br>ç”±äºæ—¶é—´åŸå› ï¼Œä¸»é¢˜å†…ç½®çš„ç‰ˆæœ¬ä¸ä¸€å®šéƒ½æ˜¯æœ€æ–°çš„ï¼Œå¯ä»¥é€šè¿‡ <code>resolutions</code> é…ç½®æŒ‡å®šè¦ä½¿ç”¨çš„ç‰ˆæœ¬ã€‚</p>\n<p>ä¸‹é¢æ˜¯ä½¿ç”¨ç¤ºä¾‹ï¼Œé…ç½®åœ¨ <code>package.json</code> ä¸­ï¼Œå…¶å®ƒä¾èµ–è¦†ç›–ç‰ˆæœ¬ä¹Ÿæ˜¯è¿™æ ·æ“ä½œã€‚</p>\n<figure class=\"highlight json\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"punctuation\">&#123;</span></span><br><span class=\"line\">  <span class=\"attr\">&quot;resolutions&quot;</span><span class=\"punctuation\">:</span> <span class=\"punctuation\">&#123;</span></span><br><span class=\"line\">    <span class=\"attr\">&quot;oh-my-live2d&quot;</span><span class=\"punctuation\">:</span> <span class=\"string\">&quot;^0.17.0&quot;</span></span><br><span class=\"line\">  <span class=\"punctuation\">&#125;</span></span><br><span class=\"line\"><span class=\"punctuation\">&#125;</span></span><br></pre></td></tr></table></figure>\n<p>:::</p>\n<h2 id=\"task-checkbox\"><a href=\"#task-checkbox\" class=\"headerlink\" title=\"task-checkbox\"></a>task-checkbox</h2><ul>\n<li>Type: <code>boolean | TaskCheckbox</code></li>\n</ul>\n<p>æ”¯æŒæ¸²æŸ“ markdown ä»»åŠ¡åˆ—è¡¨ï¼Œå†…ç½® <a href=\"https://github.com/linsir/markdown-it-task-checkbox\">markdown-it-task-checkbox</a> æ’ä»¶æä¾›æ”¯æŒ</p>\n<ul>\n<li><input disabled=\"\" type=\"checkbox\"> ğŸ¥” TODO</li>\n<li><input disabled=\"\" type=\"checkbox\"> çœŸä¸æˆ³</li>\n<li><input checked=\"\" disabled=\"\" type=\"checkbox\"> å†…ç½®ä»»åŠ¡åˆ—è¡¨</li>\n</ul>\n<p>è¯­æ³•å¦‚ä¸‹</p>\n<figure class=\"highlight md\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"bullet\">*</span> [ ] ğŸ¥” TODO</span><br><span class=\"line\"><span class=\"bullet\">*</span> [ ] çœŸä¸æˆ³</span><br><span class=\"line\"><span class=\"bullet\">*</span> [x] å†…ç½®ä»»åŠ¡åˆ—è¡¨</span><br></pre></td></tr></table></figure>\n\n<p>é»˜è®¤å¼€å¯ï¼Œä½ å¯ä»¥è¿›ä¸€æ­¥é…ç½®</p>\n<p>:::code-group</p>\n<figure class=\"highlight ts\"><figcaption><span>[â‘  å…³é—­]</span></figcaption><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">const</span> blogTheme = <span class=\"title function_\">getThemeConfig</span>(&#123;</span><br><span class=\"line\">  <span class=\"attr\">taskCheckbox</span>: <span class=\"literal\">false</span></span><br><span class=\"line\">&#125;)</span><br></pre></td></tr></table></figure>\n<figure class=\"highlight ts\"><figcaption><span>[â‘¡ è¿›ä¸€æ­¥é…ç½®]</span></figcaption><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">const</span> blogTheme = <span class=\"title function_\">getThemeConfig</span>(&#123;</span><br><span class=\"line\">  <span class=\"attr\">taskCheckbox</span>: &#123;</span><br><span class=\"line\">    <span class=\"comment\">// refer https://github.com/linsir/markdown-it-task-checkbox for options</span></span><br><span class=\"line\">  &#125;</span><br><span class=\"line\">&#125;)</span><br></pre></td></tr></table></figure>\n<figure class=\"highlight ts\"><figcaption><span>[â‘¢ type]</span></figcaption><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">interface</span> <span class=\"title class_\">TaskCheckbox</span> &#123;</span><br><span class=\"line\">  <span class=\"attr\">disabled</span>?: <span class=\"built_in\">boolean</span></span><br><span class=\"line\">  <span class=\"attr\">divWrap</span>?: <span class=\"built_in\">boolean</span></span><br><span class=\"line\">  <span class=\"attr\">divClass</span>?: <span class=\"built_in\">string</span></span><br><span class=\"line\">  <span class=\"attr\">idPrefix</span>?: <span class=\"built_in\">string</span></span><br><span class=\"line\">  <span class=\"attr\">ulClass</span>?: <span class=\"built_in\">string</span></span><br><span class=\"line\">  <span class=\"attr\">liClass</span>?: <span class=\"built_in\">string</span></span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n<p>:::</p>\n<h2 id=\"timeline\"><a href=\"#timeline\" class=\"headerlink\" title=\"timeline\"></a>timeline</h2><ul>\n<li>Type: <code>boolean</code></li>\n<li>default: <code>true</code></li>\n</ul>\n<p>æä¾› markdown æ—¶é—´çº¿è¯­æ³•ï¼Œåœ¨ vitepress ä¸­ä½¿ç”¨ markdown æ¸²æŸ“æ—¶é—´çº¿ï¼ˆæ—¶é—´è½´ï¼‰æ ·å¼ã€‚</p>\n<p>:::tip ä¸€ç‚¹è¯´æ˜<br>å†…ç½® <a href=\"https://github.com/HanochMa/vitepress-markdown-timeline\">vitepress-markdown-timeline</a> å®ç°<br>:::</p>\n<p>æ•ˆæœå¦‚ä¸‹</p>\n<p>::: timeline 2023-05-24</p>\n<ul>\n<li><strong>do some thing1</strong></li>\n<li>do some thing2<br>:::</li>\n</ul>\n<p>::: timeline 2023-05-23<br>do some thing3<br>do some thing4<br>:::</p>\n<p>è¯­æ³•å¦‚ä¸‹</p>\n<figure class=\"highlight md\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">::: timeline 2023-05-24</span><br><span class=\"line\"><span class=\"bullet\">-</span> <span class=\"strong\">**do some thing1**</span></span><br><span class=\"line\"><span class=\"bullet\">-</span> do some thing2</span><br><span class=\"line\">:::</span><br><span class=\"line\"></span><br><span class=\"line\">::: timeline 2023-05-23</span><br><span class=\"line\">do some thing3</span><br><span class=\"line\">do some thing4</span><br><span class=\"line\">:::</span><br></pre></td></tr></table></figure>\n\n<p>:::code-group</p>\n<figure class=\"highlight ts\"><figcaption><span>[å…³é—­]</span></figcaption><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">const</span> blogTheme = <span class=\"title function_\">getThemeConfig</span>(&#123;</span><br><span class=\"line\">  <span class=\"attr\">timeline</span>: <span class=\"literal\">false</span></span><br><span class=\"line\">&#125;)</span><br></pre></td></tr></table></figure>\n<p>:::</p>\n<h2 id=\"tabs\"><a href=\"#tabs\" class=\"headerlink\" title=\"tabs\"></a>tabs</h2><ul>\n<li>Type: <code>boolean</code></li>\n</ul>\n<p>æ”¯æŒå±€éƒ¨çš„<code>tabs</code>é¢æ¿ï¼Œ<strong>é»˜è®¤å¼€å¯</strong></p>\n<p>:::details æˆ‘ä¹‹å‰æ‰‹åŠ¨å®‰è£…é…ç½®äº†æ€ä¹ˆåŠï¼Ÿ<br>â‘  package.json ä¸­ç§»é™¤ vitepress-plugin-tabs ä¾èµ–</p>\n<p>â‘¡ .vitepress&#x2F;theme&#x2F;index.ts ä¸­ç§»é™¤æ³¨å†Œçš„ç»„ä»¶<code>enhanceAppWithTabs</code></p>\n<p>â‘¢ ï¼ˆå¯é€‰ï¼‰<code>getThemeConfig</code> ä¸­ç§»é™¤é…ç½®é¡¹<code>tabs</code><br>:::<br>:::tip ä¸€ç‚¹è¯´æ˜<br>åŸºäº <a href=\"https://www.npmjs.com/package/vitepress-plugin-tabs\">vitepress-plugin-tabs@0.2.0</a> å†…ç½®å®ç°<br>:::</p>\n<p>æ•ˆæœå¦‚ä¸‹</p>\n<p>:::&#x3D;tabs<br>::tab1<br>ä¸€äº›å†…å®¹</p>\n<p>ä¸€äº›å†…å®¹</p>\n<p>ä¸€äº›å†…å®¹</p>\n<p>::tab2<br>ä¸€äº›å†…å®¹ ã€‚ã€‚ã€‚<br>:::</p>\n<p>ç®€å•çš„ä½¿ç”¨æ–¹å¼å¦‚ä¸‹ï¼ˆæ•ˆæœå¦‚ä¸Šé¢çš„ç¤ºä¾‹ï¼‰</p>\n<figure class=\"highlight md\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">:::=tabs</span><br><span class=\"line\">::tab1</span><br><span class=\"line\">ä¸€äº›å†…å®¹</span><br><span class=\"line\"></span><br><span class=\"line\">ä¸€äº›å†…å®¹</span><br><span class=\"line\"></span><br><span class=\"line\">ä¸€äº›å†…å®¹</span><br><span class=\"line\"></span><br><span class=\"line\">::tab2</span><br><span class=\"line\">ä¸€äº›å†…å®¹ ã€‚ã€‚ã€‚</span><br><span class=\"line\">:::</span><br></pre></td></tr></table></figure>\n\n<p>å…±äº«çŠ¶æ€çš„ä½¿ç”¨æ–¹å¼å¦‚ä¸‹</p>\n<figure class=\"highlight md\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">:::=tabs=ab</span><br><span class=\"line\">::a</span><br><span class=\"line\">a content</span><br><span class=\"line\"></span><br><span class=\"line\">::b</span><br><span class=\"line\">b content</span><br><span class=\"line\">:::</span><br><span class=\"line\"></span><br><span class=\"line\">:::=tabs=ab</span><br><span class=\"line\">::a</span><br><span class=\"line\">a content 2</span><br><span class=\"line\"></span><br><span class=\"line\">::b</span><br><span class=\"line\">b content 2</span><br><span class=\"line\">:::</span><br></pre></td></tr></table></figure>\n\n\n<p>:::&#x3D;tabs&#x3D;ab<br>::a<br>a content</p>\n<p>::b<br>b content<br>:::</p>\n<p>:::&#x3D;tabs&#x3D;ab<br>::a<br>a content 2</p>\n<p>::b<br>b content 2<br>:::</p>\n<p>ä¸éœ€è¦ä¹Ÿå¯ä»¥å…³é—­</p>\n<figure class=\"highlight ts\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\">// .vitepress/blog-theme.ts</span></span><br><span class=\"line\"><span class=\"keyword\">const</span> blogTheme = <span class=\"title function_\">getThemeConfig</span>(&#123;</span><br><span class=\"line\">  <span class=\"attr\">tabs</span>: <span class=\"literal\">false</span></span><br><span class=\"line\">&#125;)</span><br></pre></td></tr></table></figure>\n\n<h2 id=\"Mermaid-å›¾è¡¨\"><a href=\"#Mermaid-å›¾è¡¨\" class=\"headerlink\" title=\"Mermaid - å›¾è¡¨\"></a>Mermaid - å›¾è¡¨</h2><ul>\n<li>Type: <code>boolean</code>|<code>object</code></li>\n</ul>\n<blockquote>\n<p>é€šè¿‡è§£æç±» Markdown çš„æ–‡æœ¬è¯­æ³•æ¥å®ç°å›¾è¡¨çš„åˆ›å»ºå’ŒåŠ¨æ€ä¿®æ”¹ã€‚</p>\n</blockquote>\n<p>:::tip ä¸€ç‚¹è¯´æ˜<br>åŸºäº <a href=\"https://github.com/emersonbottero/vitepress-plugin-mermaid\">vitepress-plugin-mermaid</a> å®ç°<br>:::</p>\n<p>ç®€å•è¯­æ³•å¦‚ä¸‹ï¼Œè¯¦ç»†æµç¨‹å›¾è¯­æ³•è§ <a href=\"https://github.com/mermaid-js/mermaid/blob/develop/README.zh-CN.md\">Mermaid ä¸­æ–‡æ–‡æ¡£</a></p>\n<pre>\n<figure class=\"highlight plaintext\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">flowchart TD</span><br><span class=\"line\">  Start --&gt; Stop</span><br></pre></td></tr></table></figure>\n</pre>\n\n\n<p>æ•ˆæœå¦‚ä¸‹</p>\n<figure class=\"highlight plaintext\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">flowchart TD</span><br><span class=\"line\">  Start --&gt; Stop</span><br></pre></td></tr></table></figure>\n\n<p><strong>é»˜è®¤å…³é—­</strong>ï¼Œå¯ä»¥é€šè¿‡è®¾ç½® <code>mermaid: true</code> å¼€å¯ï¼Œæˆ–è¿›è¡Œè¿›ä¸€æ­¥é…ç½®ã€‚</p>\n<p>:::code-group</p>\n<figure class=\"highlight ts\"><figcaption><span>[â‘  å¼€å¯]</span></figcaption><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">const</span> blogTheme = <span class=\"title function_\">getThemeConfig</span>(&#123;</span><br><span class=\"line\">  <span class=\"attr\">mermaid</span>: <span class=\"literal\">true</span></span><br><span class=\"line\">&#125;)</span><br></pre></td></tr></table></figure>\n<figure class=\"highlight ts\"><figcaption><span>[â‘¡ è¿›ä¸€æ­¥é…ç½®]</span></figcaption><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">const</span> blogTheme = <span class=\"title function_\">getThemeConfig</span>(&#123;</span><br><span class=\"line\">  <span class=\"attr\">mermaid</span>: &#123;</span><br><span class=\"line\">    <span class=\"comment\">// refer https://mermaid.js.org/config/setup/modules/mermaidAPI.html#mermaidapi-configuration-defaults for options</span></span><br><span class=\"line\">  &#125;</span><br><span class=\"line\">&#125;)</span><br></pre></td></tr></table></figure>\n<p>:::</p>\n<p>ä¸‹é¢çœ‹ä¸€ä¸‹å®˜æ–¹å…¶å®ƒæ¡ˆä¾‹</p>\n<p><strong>æ—¶åºå›¾</strong></p>\n<figure class=\"highlight plaintext\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">sequenceDiagram</span><br><span class=\"line\">Alice-&gt;&gt;John: Hello John, how are you?</span><br><span class=\"line\">loop Healthcheck</span><br><span class=\"line\">    John-&gt;&gt;John: Fight against hypochondria</span><br><span class=\"line\">end</span><br><span class=\"line\">Note right of John: Rational thoughts!</span><br><span class=\"line\">John--&gt;&gt;Alice: Great!</span><br><span class=\"line\">John-&gt;&gt;Bob: How about you?</span><br><span class=\"line\">Bob--&gt;&gt;John: Jolly good!</span><br></pre></td></tr></table></figure>\n\n<p><strong>ç”˜ç‰¹å›¾</strong></p>\n<figure class=\"highlight plaintext\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">gantt</span><br><span class=\"line\">    section Section</span><br><span class=\"line\">    Completed :done,    des1, 2014-01-06,2014-01-08</span><br><span class=\"line\">    Active        :active,  des2, 2014-01-07, 3d</span><br><span class=\"line\">    Parallel 1   :         des3, after des1, 1d</span><br><span class=\"line\">    Parallel 2   :         des4, after des1, 1d</span><br><span class=\"line\">    Parallel 3   :         des5, after des3, 1d</span><br><span class=\"line\">    Parallel 4   :         des6, after des4, 1d</span><br></pre></td></tr></table></figure>\n\n\n<h2 id=\"UserWorksPage\"><a href=\"#UserWorksPage\" class=\"headerlink\" title=\"UserWorksPage\"></a>UserWorksPage</h2><ul>\n<li>Type: <code>UserWorks</code></li>\n</ul>\n<p>ç”¨äºä½œå“åˆ—è¡¨å±•ç¤º</p>\n<p>æ•ˆæœå¦‚ä¸‹ï¼Œè¯¦è§ <a href=\"https://theme.sugarat.top/work.html\">ä¸ªäººä½œå“å±•ç¤º</a></p>\n<p><img src=\"https://img.cdn.sugarat.top/mdImg/MTY4NzA4ODczMzkwNg==687088733906\"></p>\n<p>æ–°å»ºä¸€ä¸ª<code>works.md</code>æ–‡ä»¶ï¼Œæ”¾å…¥ä»¥ä¸‹å†…å®¹</p>\n<figure class=\"highlight md\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">---</span><br><span class=\"line\">layout: page</span><br><span class=\"line\">title: ä¸ªäººä½œå“å±•ç¤º</span><br><span class=\"line\">sidebar: false</span><br><span class=\"line\">outline: [2,3]</span><br><span class=\"line\"><span class=\"section\">sticky: 1</span></span><br><span class=\"line\"><span class=\"section\">---</span></span><br><span class=\"line\"><span class=\"language-xml\"><span class=\"tag\">&lt;<span class=\"name\">UserWorksPage</span> /&gt;</span></span></span><br></pre></td></tr></table></figure>\n\n<p>å†…å®¹é…ç½®æ–¹å¼å¦‚ä¸‹</p>\n<p>::: code-group</p>\n<figure class=\"highlight ts\"><figcaption><span>[default]</span></figcaption><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br><span class=\"line\">31</span><br><span class=\"line\">32</span><br><span class=\"line\">33</span><br><span class=\"line\">34</span><br><span class=\"line\">35</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">const</span> blogTheme = <span class=\"title function_\">getThemeConfig</span>(&#123;</span><br><span class=\"line\">  <span class=\"attr\">works</span>: &#123;</span><br><span class=\"line\">    <span class=\"attr\">title</span>: <span class=\"string\">&#x27;ä¸ªäººé¡¹ç›®/çº¿ä¸Šä½œå“&#x27;</span>,</span><br><span class=\"line\">    <span class=\"attr\">description</span>: <span class=\"string\">&#x27;è®°å½•å¼€å‘çš„ç‚¹ç‚¹æ»´æ»´&#x27;</span>,</span><br><span class=\"line\">    <span class=\"attr\">topTitle</span>: <span class=\"string\">&#x27;ä¸¾äº›ğŸŒ°&#x27;</span>,</span><br><span class=\"line\">    <span class=\"attr\">list</span>: [</span><br><span class=\"line\">      &#123;</span><br><span class=\"line\">        <span class=\"attr\">title</span>: <span class=\"string\">&#x27;åšå®¢ä¸»é¢˜ @sugarat/theme&#x27;</span>,</span><br><span class=\"line\">        <span class=\"attr\">description</span>: <span class=\"string\">&#x27;åŸºäº vitepress å®ç°çš„åšå®¢ä¸»é¢˜&#x27;</span>,</span><br><span class=\"line\">        <span class=\"attr\">time</span>: &#123;</span><br><span class=\"line\">          <span class=\"attr\">start</span>: <span class=\"string\">&#x27;2023/01/29&#x27;</span></span><br><span class=\"line\">        &#125;,</span><br><span class=\"line\">        <span class=\"attr\">github</span>: &#123;</span><br><span class=\"line\">          <span class=\"attr\">owner</span>: <span class=\"string\">&#x27;ATQQ&#x27;</span>,</span><br><span class=\"line\">          <span class=\"attr\">repo</span>: <span class=\"string\">&#x27;sugar-blog&#x27;</span>,</span><br><span class=\"line\">          <span class=\"attr\">branch</span>: <span class=\"string\">&#x27;master&#x27;</span>,</span><br><span class=\"line\">          <span class=\"attr\">path</span>: <span class=\"string\">&#x27;packages/theme&#x27;</span></span><br><span class=\"line\">        &#125;,</span><br><span class=\"line\">        <span class=\"attr\">status</span>: &#123;</span><br><span class=\"line\">          <span class=\"attr\">text</span>: <span class=\"string\">&#x27;è‡ªå®šä¹‰badge&#x27;</span></span><br><span class=\"line\">        &#125;,</span><br><span class=\"line\">        <span class=\"attr\">url</span>: <span class=\"string\">&#x27;https://theme.sugarat.top&#x27;</span>,</span><br><span class=\"line\">        <span class=\"attr\">cover</span>:</span><br><span class=\"line\">          <span class=\"string\">&#x27;https://img.cdn.sugarat.top/mdImg/MTY3MzE3MDUxOTMwMw==673170519303&#x27;</span>,</span><br><span class=\"line\">        <span class=\"attr\">tags</span>: [<span class=\"string\">&#x27;Vitepress&#x27;</span>, <span class=\"string\">&#x27;Vue&#x27;</span>],</span><br><span class=\"line\">        <span class=\"attr\">links</span>: [</span><br><span class=\"line\">          &#123;</span><br><span class=\"line\">            <span class=\"attr\">title</span>: <span class=\"string\">&#x27;ä¸€ä¸ªç®€çº¦é£çš„VitePressåšå®¢ä¸»é¢˜&#x27;</span>,</span><br><span class=\"line\">            <span class=\"attr\">url</span>: <span class=\"string\">&#x27;https://juejin.cn/post/7196517835380293693&#x27;</span></span><br><span class=\"line\">          &#125;</span><br><span class=\"line\">        ]</span><br><span class=\"line\">      &#125;</span><br><span class=\"line\">    ]</span><br><span class=\"line\">  &#125;</span><br><span class=\"line\">&#125;)</span><br></pre></td></tr></table></figure>\n\n<figure class=\"highlight ts\"><figcaption><span>[type]</span></figcaption><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br><span class=\"line\">31</span><br><span class=\"line\">32</span><br><span class=\"line\">33</span><br><span class=\"line\">34</span><br><span class=\"line\">35</span><br><span class=\"line\">36</span><br><span class=\"line\">37</span><br><span class=\"line\">38</span><br><span class=\"line\">39</span><br><span class=\"line\">40</span><br><span class=\"line\">41</span><br><span class=\"line\">42</span><br><span class=\"line\">43</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">interface</span> <span class=\"title class_\">UserWorks</span> &#123;</span><br><span class=\"line\">  <span class=\"attr\">title</span>: <span class=\"built_in\">string</span></span><br><span class=\"line\">  <span class=\"attr\">description</span>?: <span class=\"built_in\">string</span></span><br><span class=\"line\">  <span class=\"attr\">topTitle</span>?: <span class=\"built_in\">string</span></span><br><span class=\"line\">  <span class=\"attr\">list</span>: <span class=\"title class_\">UserWork</span>[]</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"><span class=\"keyword\">interface</span> <span class=\"title class_\">UserWork</span> &#123;</span><br><span class=\"line\">  <span class=\"attr\">title</span>: <span class=\"built_in\">string</span></span><br><span class=\"line\">  <span class=\"attr\">description</span>: <span class=\"built_in\">string</span></span><br><span class=\"line\">  <span class=\"attr\">time</span>:</span><br><span class=\"line\">  | <span class=\"built_in\">string</span></span><br><span class=\"line\">  | &#123;</span><br><span class=\"line\">    <span class=\"attr\">start</span>: <span class=\"built_in\">string</span></span><br><span class=\"line\">    <span class=\"attr\">end</span>?: <span class=\"built_in\">string</span></span><br><span class=\"line\">    <span class=\"attr\">lastupdate</span>?: <span class=\"built_in\">string</span></span><br><span class=\"line\">  &#125;</span><br><span class=\"line\">  <span class=\"attr\">status</span>?: &#123;</span><br><span class=\"line\">    <span class=\"attr\">text</span>: <span class=\"built_in\">string</span></span><br><span class=\"line\">    <span class=\"attr\">type</span>?: <span class=\"string\">&#x27;tip&#x27;</span> | <span class=\"string\">&#x27;warning&#x27;</span> | <span class=\"string\">&#x27;danger&#x27;</span></span><br><span class=\"line\">  &#125;</span><br><span class=\"line\">  <span class=\"attr\">url</span>?: <span class=\"built_in\">string</span></span><br><span class=\"line\">  <span class=\"attr\">github</span>?:</span><br><span class=\"line\">  | <span class=\"built_in\">string</span></span><br><span class=\"line\">  | &#123;</span><br><span class=\"line\">    <span class=\"attr\">owner</span>: <span class=\"built_in\">string</span></span><br><span class=\"line\">    <span class=\"attr\">repo</span>: <span class=\"built_in\">string</span></span><br><span class=\"line\">    <span class=\"attr\">branch</span>?: <span class=\"built_in\">string</span></span><br><span class=\"line\">    <span class=\"attr\">path</span>?: <span class=\"built_in\">string</span></span><br><span class=\"line\">  &#125;</span><br><span class=\"line\">  <span class=\"attr\">cover</span>?:</span><br><span class=\"line\">  | <span class=\"built_in\">string</span></span><br><span class=\"line\">  | <span class=\"built_in\">string</span>[]</span><br><span class=\"line\">  | &#123;</span><br><span class=\"line\">    <span class=\"attr\">urls</span>: <span class=\"built_in\">string</span>[]</span><br><span class=\"line\">    <span class=\"attr\">layout</span>?: <span class=\"string\">&#x27;swiper&#x27;</span> | <span class=\"string\">&#x27;list&#x27;</span></span><br><span class=\"line\">  &#125;</span><br><span class=\"line\">  <span class=\"attr\">links</span>?: &#123;</span><br><span class=\"line\">    <span class=\"attr\">title</span>: <span class=\"built_in\">string</span></span><br><span class=\"line\">    <span class=\"attr\">url</span>: <span class=\"built_in\">string</span></span><br><span class=\"line\">  &#125;[]</span><br><span class=\"line\">  <span class=\"attr\">tags</span>?: <span class=\"built_in\">string</span>[]</span><br><span class=\"line\">  <span class=\"attr\">top</span>?: <span class=\"built_in\">number</span></span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n\n<p>:::</p>\n","excerpt":"","more":"<h1 id=\"å†…ç½®ç¬¬ä¸‰æ–¹æ’ä»¶èƒ½åŠ›\"><a href=\"#å†…ç½®ç¬¬ä¸‰æ–¹æ’ä»¶èƒ½åŠ›\" class=\"headerlink\" title=\"å†…ç½®ç¬¬ä¸‰æ–¹æ’ä»¶èƒ½åŠ›\"></a>å†…ç½®ç¬¬ä¸‰æ–¹æ’ä»¶èƒ½åŠ›</h1><p>éƒ¨åˆ†å†…ç½®ç»„ä»¶ï¼ˆæ’ä»¶ï¼‰ï¼Œæ¥æº <a href=\"https://vitepress.yiov.top/plugin.html\">vitepress.yiov.top</a> æ¨è</p>\n<h2 id=\"oml2d-çœ‹æ¿å¨˜é›†æˆ\"><a href=\"#oml2d-çœ‹æ¿å¨˜é›†æˆ\" class=\"headerlink\" title=\"oml2d - çœ‹æ¿å¨˜é›†æˆ\"></a>oml2d - çœ‹æ¿å¨˜é›†æˆ</h2><ul>\n<li>Typeï¼š<a href=\"https://oml2d.com/options/Options.html\">oml2dOptions</a></li>\n</ul>\n<p>ä¸ºç½‘ç«™æä¾›ä¸€ä¸ª Live2D çœ‹æ¿ç»„ä»¶ã€‚</p>\n<p>:::tip ä¸€ç‚¹è¯´æ˜<br>é€šè¿‡å†…ç½® <a href=\"https://oml2d.com/\">oh-my-live2d</a> å®ç°, å¯ä»¥é€šè¿‡ <code>oml2d</code> é€‰é¡¹é…ç½®ã€‚</p>\n<p>é€šè¿‡è¿™ä¸ªèƒ½åŠ›å¯ä»¥å¿«é€ŸåŠ å…¥å¹¶å®šåˆ¶å±äºè‡ªå·±çš„çœ‹æ¿å¨˜, å¼€å¯åªéœ€è¦ä¸ºå…¶ä¼ é€’ä¸€ä¸ª <a href=\"https://oml2d.com/options/Options.html\">é…ç½®é€‰é¡¹</a> å³å¯<br>:::</p>\n<p>ä»¥ä¸‹æ˜¯ä¸€ä¸ªç®€å•çš„ä½¿ç”¨ç¤ºä¾‹ï¼Œå½“æ¨¡å‹åŠ è½½æˆåŠŸæ—¶å®ƒå°†å‡ºç°åœ¨æ‚¨ç½‘ç«™çš„å·¦ä¸‹è§’ã€‚</p>\n<figure class=\"highlight ts\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">const</span> blogTheme = <span class=\"title function_\">getThemeConfig</span>(&#123;</span><br><span class=\"line\">  <span class=\"attr\">oml2d</span>: &#123;</span><br><span class=\"line\">    <span class=\"attr\">mobileDisplay</span>: <span class=\"literal\">true</span>,</span><br><span class=\"line\">    <span class=\"attr\">models</span>: [</span><br><span class=\"line\">      &#123;</span><br><span class=\"line\">        <span class=\"attr\">path</span>: <span class=\"string\">&#x27;https://registry.npmmirror.com/oml2d-models/latest/files/models/Senko_Normals/senko.model3.json&#x27;</span></span><br><span class=\"line\">      &#125;</span><br><span class=\"line\">    ]</span><br><span class=\"line\">  &#125;</span><br><span class=\"line\">&#125;)</span><br></pre></td></tr></table></figure>\n<p>æ•ˆæœå›¾å¦‚ä¸‹</p>\n<p><img src=\"https://loclink-1259720482.cos.ap-beijing.myqcloud.com/image/%E5%BD%95%E5%B1%8F2024-03-11%2023.51.51.gif\"></p>\n<p>ä¹‹åæ‚¨è¿˜å¯ä»¥å‰å¾€<a href=\"https://oml2d.com/options/Options.html\">é…ç½®é€‰é¡¹</a>æŸ¥é˜…æ›´å¤šè‡ªå®šä¹‰å†…å®¹</p>\n<p>:::tip ç‰ˆæœ¬è¯´æ˜<br>ç”±äºæ—¶é—´åŸå› ï¼Œä¸»é¢˜å†…ç½®çš„ç‰ˆæœ¬ä¸ä¸€å®šéƒ½æ˜¯æœ€æ–°çš„ï¼Œå¯ä»¥é€šè¿‡ <code>resolutions</code> é…ç½®æŒ‡å®šè¦ä½¿ç”¨çš„ç‰ˆæœ¬ã€‚</p>\n<p>ä¸‹é¢æ˜¯ä½¿ç”¨ç¤ºä¾‹ï¼Œé…ç½®åœ¨ <code>package.json</code> ä¸­ï¼Œå…¶å®ƒä¾èµ–è¦†ç›–ç‰ˆæœ¬ä¹Ÿæ˜¯è¿™æ ·æ“ä½œã€‚</p>\n<figure class=\"highlight json\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"punctuation\">&#123;</span></span><br><span class=\"line\">  <span class=\"attr\">&quot;resolutions&quot;</span><span class=\"punctuation\">:</span> <span class=\"punctuation\">&#123;</span></span><br><span class=\"line\">    <span class=\"attr\">&quot;oh-my-live2d&quot;</span><span class=\"punctuation\">:</span> <span class=\"string\">&quot;^0.17.0&quot;</span></span><br><span class=\"line\">  <span class=\"punctuation\">&#125;</span></span><br><span class=\"line\"><span class=\"punctuation\">&#125;</span></span><br></pre></td></tr></table></figure>\n<p>:::</p>\n<h2 id=\"task-checkbox\"><a href=\"#task-checkbox\" class=\"headerlink\" title=\"task-checkbox\"></a>task-checkbox</h2><ul>\n<li>Type: <code>boolean | TaskCheckbox</code></li>\n</ul>\n<p>æ”¯æŒæ¸²æŸ“ markdown ä»»åŠ¡åˆ—è¡¨ï¼Œå†…ç½® <a href=\"https://github.com/linsir/markdown-it-task-checkbox\">markdown-it-task-checkbox</a> æ’ä»¶æä¾›æ”¯æŒ</p>\n<ul>\n<li><input disabled=\"\" type=\"checkbox\"> ğŸ¥” TODO</li>\n<li><input disabled=\"\" type=\"checkbox\"> çœŸä¸æˆ³</li>\n<li><input checked=\"\" disabled=\"\" type=\"checkbox\"> å†…ç½®ä»»åŠ¡åˆ—è¡¨</li>\n</ul>\n<p>è¯­æ³•å¦‚ä¸‹</p>\n<figure class=\"highlight md\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"bullet\">*</span> [ ] ğŸ¥” TODO</span><br><span class=\"line\"><span class=\"bullet\">*</span> [ ] çœŸä¸æˆ³</span><br><span class=\"line\"><span class=\"bullet\">*</span> [x] å†…ç½®ä»»åŠ¡åˆ—è¡¨</span><br></pre></td></tr></table></figure>\n\n<p>é»˜è®¤å¼€å¯ï¼Œä½ å¯ä»¥è¿›ä¸€æ­¥é…ç½®</p>\n<p>:::code-group</p>\n<figure class=\"highlight ts\"><figcaption><span>[â‘  å…³é—­]</span></figcaption><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">const</span> blogTheme = <span class=\"title function_\">getThemeConfig</span>(&#123;</span><br><span class=\"line\">  <span class=\"attr\">taskCheckbox</span>: <span class=\"literal\">false</span></span><br><span class=\"line\">&#125;)</span><br></pre></td></tr></table></figure>\n<figure class=\"highlight ts\"><figcaption><span>[â‘¡ è¿›ä¸€æ­¥é…ç½®]</span></figcaption><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">const</span> blogTheme = <span class=\"title function_\">getThemeConfig</span>(&#123;</span><br><span class=\"line\">  <span class=\"attr\">taskCheckbox</span>: &#123;</span><br><span class=\"line\">    <span class=\"comment\">// refer https://github.com/linsir/markdown-it-task-checkbox for options</span></span><br><span class=\"line\">  &#125;</span><br><span class=\"line\">&#125;)</span><br></pre></td></tr></table></figure>\n<figure class=\"highlight ts\"><figcaption><span>[â‘¢ type]</span></figcaption><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">interface</span> <span class=\"title class_\">TaskCheckbox</span> &#123;</span><br><span class=\"line\">  <span class=\"attr\">disabled</span>?: <span class=\"built_in\">boolean</span></span><br><span class=\"line\">  <span class=\"attr\">divWrap</span>?: <span class=\"built_in\">boolean</span></span><br><span class=\"line\">  <span class=\"attr\">divClass</span>?: <span class=\"built_in\">string</span></span><br><span class=\"line\">  <span class=\"attr\">idPrefix</span>?: <span class=\"built_in\">string</span></span><br><span class=\"line\">  <span class=\"attr\">ulClass</span>?: <span class=\"built_in\">string</span></span><br><span class=\"line\">  <span class=\"attr\">liClass</span>?: <span class=\"built_in\">string</span></span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n<p>:::</p>\n<h2 id=\"timeline\"><a href=\"#timeline\" class=\"headerlink\" title=\"timeline\"></a>timeline</h2><ul>\n<li>Type: <code>boolean</code></li>\n<li>default: <code>true</code></li>\n</ul>\n<p>æä¾› markdown æ—¶é—´çº¿è¯­æ³•ï¼Œåœ¨ vitepress ä¸­ä½¿ç”¨ markdown æ¸²æŸ“æ—¶é—´çº¿ï¼ˆæ—¶é—´è½´ï¼‰æ ·å¼ã€‚</p>\n<p>:::tip ä¸€ç‚¹è¯´æ˜<br>å†…ç½® <a href=\"https://github.com/HanochMa/vitepress-markdown-timeline\">vitepress-markdown-timeline</a> å®ç°<br>:::</p>\n<p>æ•ˆæœå¦‚ä¸‹</p>\n<p>::: timeline 2023-05-24</p>\n<ul>\n<li><strong>do some thing1</strong></li>\n<li>do some thing2<br>:::</li>\n</ul>\n<p>::: timeline 2023-05-23<br>do some thing3<br>do some thing4<br>:::</p>\n<p>è¯­æ³•å¦‚ä¸‹</p>\n<figure class=\"highlight md\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">::: timeline 2023-05-24</span><br><span class=\"line\"><span class=\"bullet\">-</span> <span class=\"strong\">**do some thing1**</span></span><br><span class=\"line\"><span class=\"bullet\">-</span> do some thing2</span><br><span class=\"line\">:::</span><br><span class=\"line\"></span><br><span class=\"line\">::: timeline 2023-05-23</span><br><span class=\"line\">do some thing3</span><br><span class=\"line\">do some thing4</span><br><span class=\"line\">:::</span><br></pre></td></tr></table></figure>\n\n<p>:::code-group</p>\n<figure class=\"highlight ts\"><figcaption><span>[å…³é—­]</span></figcaption><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">const</span> blogTheme = <span class=\"title function_\">getThemeConfig</span>(&#123;</span><br><span class=\"line\">  <span class=\"attr\">timeline</span>: <span class=\"literal\">false</span></span><br><span class=\"line\">&#125;)</span><br></pre></td></tr></table></figure>\n<p>:::</p>\n<h2 id=\"tabs\"><a href=\"#tabs\" class=\"headerlink\" title=\"tabs\"></a>tabs</h2><ul>\n<li>Type: <code>boolean</code></li>\n</ul>\n<p>æ”¯æŒå±€éƒ¨çš„<code>tabs</code>é¢æ¿ï¼Œ<strong>é»˜è®¤å¼€å¯</strong></p>\n<p>:::details æˆ‘ä¹‹å‰æ‰‹åŠ¨å®‰è£…é…ç½®äº†æ€ä¹ˆåŠï¼Ÿ<br>â‘  package.json ä¸­ç§»é™¤ vitepress-plugin-tabs ä¾èµ–</p>\n<p>â‘¡ .vitepress&#x2F;theme&#x2F;index.ts ä¸­ç§»é™¤æ³¨å†Œçš„ç»„ä»¶<code>enhanceAppWithTabs</code></p>\n<p>â‘¢ ï¼ˆå¯é€‰ï¼‰<code>getThemeConfig</code> ä¸­ç§»é™¤é…ç½®é¡¹<code>tabs</code><br>:::<br>:::tip ä¸€ç‚¹è¯´æ˜<br>åŸºäº <a href=\"https://www.npmjs.com/package/vitepress-plugin-tabs\">vitepress-plugin-tabs@0.2.0</a> å†…ç½®å®ç°<br>:::</p>\n<p>æ•ˆæœå¦‚ä¸‹</p>\n<p>:::&#x3D;tabs<br>::tab1<br>ä¸€äº›å†…å®¹</p>\n<p>ä¸€äº›å†…å®¹</p>\n<p>ä¸€äº›å†…å®¹</p>\n<p>::tab2<br>ä¸€äº›å†…å®¹ ã€‚ã€‚ã€‚<br>:::</p>\n<p>ç®€å•çš„ä½¿ç”¨æ–¹å¼å¦‚ä¸‹ï¼ˆæ•ˆæœå¦‚ä¸Šé¢çš„ç¤ºä¾‹ï¼‰</p>\n<figure class=\"highlight md\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">:::=tabs</span><br><span class=\"line\">::tab1</span><br><span class=\"line\">ä¸€äº›å†…å®¹</span><br><span class=\"line\"></span><br><span class=\"line\">ä¸€äº›å†…å®¹</span><br><span class=\"line\"></span><br><span class=\"line\">ä¸€äº›å†…å®¹</span><br><span class=\"line\"></span><br><span class=\"line\">::tab2</span><br><span class=\"line\">ä¸€äº›å†…å®¹ ã€‚ã€‚ã€‚</span><br><span class=\"line\">:::</span><br></pre></td></tr></table></figure>\n\n<p>å…±äº«çŠ¶æ€çš„ä½¿ç”¨æ–¹å¼å¦‚ä¸‹</p>\n<figure class=\"highlight md\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">:::=tabs=ab</span><br><span class=\"line\">::a</span><br><span class=\"line\">a content</span><br><span class=\"line\"></span><br><span class=\"line\">::b</span><br><span class=\"line\">b content</span><br><span class=\"line\">:::</span><br><span class=\"line\"></span><br><span class=\"line\">:::=tabs=ab</span><br><span class=\"line\">::a</span><br><span class=\"line\">a content 2</span><br><span class=\"line\"></span><br><span class=\"line\">::b</span><br><span class=\"line\">b content 2</span><br><span class=\"line\">:::</span><br></pre></td></tr></table></figure>\n\n\n<p>:::&#x3D;tabs&#x3D;ab<br>::a<br>a content</p>\n<p>::b<br>b content<br>:::</p>\n<p>:::&#x3D;tabs&#x3D;ab<br>::a<br>a content 2</p>\n<p>::b<br>b content 2<br>:::</p>\n<p>ä¸éœ€è¦ä¹Ÿå¯ä»¥å…³é—­</p>\n<figure class=\"highlight ts\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\">// .vitepress/blog-theme.ts</span></span><br><span class=\"line\"><span class=\"keyword\">const</span> blogTheme = <span class=\"title function_\">getThemeConfig</span>(&#123;</span><br><span class=\"line\">  <span class=\"attr\">tabs</span>: <span class=\"literal\">false</span></span><br><span class=\"line\">&#125;)</span><br></pre></td></tr></table></figure>\n\n<h2 id=\"Mermaid-å›¾è¡¨\"><a href=\"#Mermaid-å›¾è¡¨\" class=\"headerlink\" title=\"Mermaid - å›¾è¡¨\"></a>Mermaid - å›¾è¡¨</h2><ul>\n<li>Type: <code>boolean</code>|<code>object</code></li>\n</ul>\n<blockquote>\n<p>é€šè¿‡è§£æç±» Markdown çš„æ–‡æœ¬è¯­æ³•æ¥å®ç°å›¾è¡¨çš„åˆ›å»ºå’ŒåŠ¨æ€ä¿®æ”¹ã€‚</p>\n</blockquote>\n<p>:::tip ä¸€ç‚¹è¯´æ˜<br>åŸºäº <a href=\"https://github.com/emersonbottero/vitepress-plugin-mermaid\">vitepress-plugin-mermaid</a> å®ç°<br>:::</p>\n<p>ç®€å•è¯­æ³•å¦‚ä¸‹ï¼Œè¯¦ç»†æµç¨‹å›¾è¯­æ³•è§ <a href=\"https://github.com/mermaid-js/mermaid/blob/develop/README.zh-CN.md\">Mermaid ä¸­æ–‡æ–‡æ¡£</a></p>\n<pre>\n<figure class=\"highlight plaintext\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">flowchart TD</span><br><span class=\"line\">  Start --&gt; Stop</span><br></pre></td></tr></table></figure>\n</pre>\n\n\n<p>æ•ˆæœå¦‚ä¸‹</p>\n<figure class=\"highlight plaintext\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">flowchart TD</span><br><span class=\"line\">  Start --&gt; Stop</span><br></pre></td></tr></table></figure>\n\n<p><strong>é»˜è®¤å…³é—­</strong>ï¼Œå¯ä»¥é€šè¿‡è®¾ç½® <code>mermaid: true</code> å¼€å¯ï¼Œæˆ–è¿›è¡Œè¿›ä¸€æ­¥é…ç½®ã€‚</p>\n<p>:::code-group</p>\n<figure class=\"highlight ts\"><figcaption><span>[â‘  å¼€å¯]</span></figcaption><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">const</span> blogTheme = <span class=\"title function_\">getThemeConfig</span>(&#123;</span><br><span class=\"line\">  <span class=\"attr\">mermaid</span>: <span class=\"literal\">true</span></span><br><span class=\"line\">&#125;)</span><br></pre></td></tr></table></figure>\n<figure class=\"highlight ts\"><figcaption><span>[â‘¡ è¿›ä¸€æ­¥é…ç½®]</span></figcaption><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">const</span> blogTheme = <span class=\"title function_\">getThemeConfig</span>(&#123;</span><br><span class=\"line\">  <span class=\"attr\">mermaid</span>: &#123;</span><br><span class=\"line\">    <span class=\"comment\">// refer https://mermaid.js.org/config/setup/modules/mermaidAPI.html#mermaidapi-configuration-defaults for options</span></span><br><span class=\"line\">  &#125;</span><br><span class=\"line\">&#125;)</span><br></pre></td></tr></table></figure>\n<p>:::</p>\n<p>ä¸‹é¢çœ‹ä¸€ä¸‹å®˜æ–¹å…¶å®ƒæ¡ˆä¾‹</p>\n<p><strong>æ—¶åºå›¾</strong></p>\n<figure class=\"highlight plaintext\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">sequenceDiagram</span><br><span class=\"line\">Alice-&gt;&gt;John: Hello John, how are you?</span><br><span class=\"line\">loop Healthcheck</span><br><span class=\"line\">    John-&gt;&gt;John: Fight against hypochondria</span><br><span class=\"line\">end</span><br><span class=\"line\">Note right of John: Rational thoughts!</span><br><span class=\"line\">John--&gt;&gt;Alice: Great!</span><br><span class=\"line\">John-&gt;&gt;Bob: How about you?</span><br><span class=\"line\">Bob--&gt;&gt;John: Jolly good!</span><br></pre></td></tr></table></figure>\n\n<p><strong>ç”˜ç‰¹å›¾</strong></p>\n<figure class=\"highlight plaintext\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">gantt</span><br><span class=\"line\">    section Section</span><br><span class=\"line\">    Completed :done,    des1, 2014-01-06,2014-01-08</span><br><span class=\"line\">    Active        :active,  des2, 2014-01-07, 3d</span><br><span class=\"line\">    Parallel 1   :         des3, after des1, 1d</span><br><span class=\"line\">    Parallel 2   :         des4, after des1, 1d</span><br><span class=\"line\">    Parallel 3   :         des5, after des3, 1d</span><br><span class=\"line\">    Parallel 4   :         des6, after des4, 1d</span><br></pre></td></tr></table></figure>\n\n\n<h2 id=\"UserWorksPage\"><a href=\"#UserWorksPage\" class=\"headerlink\" title=\"UserWorksPage\"></a>UserWorksPage</h2><ul>\n<li>Type: <code>UserWorks</code></li>\n</ul>\n<p>ç”¨äºä½œå“åˆ—è¡¨å±•ç¤º</p>\n<p>æ•ˆæœå¦‚ä¸‹ï¼Œè¯¦è§ <a href=\"https://theme.sugarat.top/work.html\">ä¸ªäººä½œå“å±•ç¤º</a></p>\n<p><img src=\"https://img.cdn.sugarat.top/mdImg/MTY4NzA4ODczMzkwNg==687088733906\"></p>\n<p>æ–°å»ºä¸€ä¸ª<code>works.md</code>æ–‡ä»¶ï¼Œæ”¾å…¥ä»¥ä¸‹å†…å®¹</p>\n<figure class=\"highlight md\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">---</span><br><span class=\"line\">layout: page</span><br><span class=\"line\">title: ä¸ªäººä½œå“å±•ç¤º</span><br><span class=\"line\">sidebar: false</span><br><span class=\"line\">outline: [2,3]</span><br><span class=\"line\"><span class=\"section\">sticky: 1</span></span><br><span class=\"line\"><span class=\"section\">---</span></span><br><span class=\"line\"><span class=\"language-xml\"><span class=\"tag\">&lt;<span class=\"name\">UserWorksPage</span> /&gt;</span></span></span><br></pre></td></tr></table></figure>\n\n<p>å†…å®¹é…ç½®æ–¹å¼å¦‚ä¸‹</p>\n<p>::: code-group</p>\n<figure class=\"highlight ts\"><figcaption><span>[default]</span></figcaption><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br><span class=\"line\">31</span><br><span class=\"line\">32</span><br><span class=\"line\">33</span><br><span class=\"line\">34</span><br><span class=\"line\">35</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">const</span> blogTheme = <span class=\"title function_\">getThemeConfig</span>(&#123;</span><br><span class=\"line\">  <span class=\"attr\">works</span>: &#123;</span><br><span class=\"line\">    <span class=\"attr\">title</span>: <span class=\"string\">&#x27;ä¸ªäººé¡¹ç›®/çº¿ä¸Šä½œå“&#x27;</span>,</span><br><span class=\"line\">    <span class=\"attr\">description</span>: <span class=\"string\">&#x27;è®°å½•å¼€å‘çš„ç‚¹ç‚¹æ»´æ»´&#x27;</span>,</span><br><span class=\"line\">    <span class=\"attr\">topTitle</span>: <span class=\"string\">&#x27;ä¸¾äº›ğŸŒ°&#x27;</span>,</span><br><span class=\"line\">    <span class=\"attr\">list</span>: [</span><br><span class=\"line\">      &#123;</span><br><span class=\"line\">        <span class=\"attr\">title</span>: <span class=\"string\">&#x27;åšå®¢ä¸»é¢˜ @sugarat/theme&#x27;</span>,</span><br><span class=\"line\">        <span class=\"attr\">description</span>: <span class=\"string\">&#x27;åŸºäº vitepress å®ç°çš„åšå®¢ä¸»é¢˜&#x27;</span>,</span><br><span class=\"line\">        <span class=\"attr\">time</span>: &#123;</span><br><span class=\"line\">          <span class=\"attr\">start</span>: <span class=\"string\">&#x27;2023/01/29&#x27;</span></span><br><span class=\"line\">        &#125;,</span><br><span class=\"line\">        <span class=\"attr\">github</span>: &#123;</span><br><span class=\"line\">          <span class=\"attr\">owner</span>: <span class=\"string\">&#x27;ATQQ&#x27;</span>,</span><br><span class=\"line\">          <span class=\"attr\">repo</span>: <span class=\"string\">&#x27;sugar-blog&#x27;</span>,</span><br><span class=\"line\">          <span class=\"attr\">branch</span>: <span class=\"string\">&#x27;master&#x27;</span>,</span><br><span class=\"line\">          <span class=\"attr\">path</span>: <span class=\"string\">&#x27;packages/theme&#x27;</span></span><br><span class=\"line\">        &#125;,</span><br><span class=\"line\">        <span class=\"attr\">status</span>: &#123;</span><br><span class=\"line\">          <span class=\"attr\">text</span>: <span class=\"string\">&#x27;è‡ªå®šä¹‰badge&#x27;</span></span><br><span class=\"line\">        &#125;,</span><br><span class=\"line\">        <span class=\"attr\">url</span>: <span class=\"string\">&#x27;https://theme.sugarat.top&#x27;</span>,</span><br><span class=\"line\">        <span class=\"attr\">cover</span>:</span><br><span class=\"line\">          <span class=\"string\">&#x27;https://img.cdn.sugarat.top/mdImg/MTY3MzE3MDUxOTMwMw==673170519303&#x27;</span>,</span><br><span class=\"line\">        <span class=\"attr\">tags</span>: [<span class=\"string\">&#x27;Vitepress&#x27;</span>, <span class=\"string\">&#x27;Vue&#x27;</span>],</span><br><span class=\"line\">        <span class=\"attr\">links</span>: [</span><br><span class=\"line\">          &#123;</span><br><span class=\"line\">            <span class=\"attr\">title</span>: <span class=\"string\">&#x27;ä¸€ä¸ªç®€çº¦é£çš„VitePressåšå®¢ä¸»é¢˜&#x27;</span>,</span><br><span class=\"line\">            <span class=\"attr\">url</span>: <span class=\"string\">&#x27;https://juejin.cn/post/7196517835380293693&#x27;</span></span><br><span class=\"line\">          &#125;</span><br><span class=\"line\">        ]</span><br><span class=\"line\">      &#125;</span><br><span class=\"line\">    ]</span><br><span class=\"line\">  &#125;</span><br><span class=\"line\">&#125;)</span><br></pre></td></tr></table></figure>\n\n<figure class=\"highlight ts\"><figcaption><span>[type]</span></figcaption><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br><span class=\"line\">31</span><br><span class=\"line\">32</span><br><span class=\"line\">33</span><br><span class=\"line\">34</span><br><span class=\"line\">35</span><br><span class=\"line\">36</span><br><span class=\"line\">37</span><br><span class=\"line\">38</span><br><span class=\"line\">39</span><br><span class=\"line\">40</span><br><span class=\"line\">41</span><br><span class=\"line\">42</span><br><span class=\"line\">43</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">interface</span> <span class=\"title class_\">UserWorks</span> &#123;</span><br><span class=\"line\">  <span class=\"attr\">title</span>: <span class=\"built_in\">string</span></span><br><span class=\"line\">  <span class=\"attr\">description</span>?: <span class=\"built_in\">string</span></span><br><span class=\"line\">  <span class=\"attr\">topTitle</span>?: <span class=\"built_in\">string</span></span><br><span class=\"line\">  <span class=\"attr\">list</span>: <span class=\"title class_\">UserWork</span>[]</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"><span class=\"keyword\">interface</span> <span class=\"title class_\">UserWork</span> &#123;</span><br><span class=\"line\">  <span class=\"attr\">title</span>: <span class=\"built_in\">string</span></span><br><span class=\"line\">  <span class=\"attr\">description</span>: <span class=\"built_in\">string</span></span><br><span class=\"line\">  <span class=\"attr\">time</span>:</span><br><span class=\"line\">  | <span class=\"built_in\">string</span></span><br><span class=\"line\">  | &#123;</span><br><span class=\"line\">    <span class=\"attr\">start</span>: <span class=\"built_in\">string</span></span><br><span class=\"line\">    <span class=\"attr\">end</span>?: <span class=\"built_in\">string</span></span><br><span class=\"line\">    <span class=\"attr\">lastupdate</span>?: <span class=\"built_in\">string</span></span><br><span class=\"line\">  &#125;</span><br><span class=\"line\">  <span class=\"attr\">status</span>?: &#123;</span><br><span class=\"line\">    <span class=\"attr\">text</span>: <span class=\"built_in\">string</span></span><br><span class=\"line\">    <span class=\"attr\">type</span>?: <span class=\"string\">&#x27;tip&#x27;</span> | <span class=\"string\">&#x27;warning&#x27;</span> | <span class=\"string\">&#x27;danger&#x27;</span></span><br><span class=\"line\">  &#125;</span><br><span class=\"line\">  <span class=\"attr\">url</span>?: <span class=\"built_in\">string</span></span><br><span class=\"line\">  <span class=\"attr\">github</span>?:</span><br><span class=\"line\">  | <span class=\"built_in\">string</span></span><br><span class=\"line\">  | &#123;</span><br><span class=\"line\">    <span class=\"attr\">owner</span>: <span class=\"built_in\">string</span></span><br><span class=\"line\">    <span class=\"attr\">repo</span>: <span class=\"built_in\">string</span></span><br><span class=\"line\">    <span class=\"attr\">branch</span>?: <span class=\"built_in\">string</span></span><br><span class=\"line\">    <span class=\"attr\">path</span>?: <span class=\"built_in\">string</span></span><br><span class=\"line\">  &#125;</span><br><span class=\"line\">  <span class=\"attr\">cover</span>?:</span><br><span class=\"line\">  | <span class=\"built_in\">string</span></span><br><span class=\"line\">  | <span class=\"built_in\">string</span>[]</span><br><span class=\"line\">  | &#123;</span><br><span class=\"line\">    <span class=\"attr\">urls</span>: <span class=\"built_in\">string</span>[]</span><br><span class=\"line\">    <span class=\"attr\">layout</span>?: <span class=\"string\">&#x27;swiper&#x27;</span> | <span class=\"string\">&#x27;list&#x27;</span></span><br><span class=\"line\">  &#125;</span><br><span class=\"line\">  <span class=\"attr\">links</span>?: &#123;</span><br><span class=\"line\">    <span class=\"attr\">title</span>: <span class=\"built_in\">string</span></span><br><span class=\"line\">    <span class=\"attr\">url</span>: <span class=\"built_in\">string</span></span><br><span class=\"line\">  &#125;[]</span><br><span class=\"line\">  <span class=\"attr\">tags</span>?: <span class=\"built_in\">string</span>[]</span><br><span class=\"line\">  <span class=\"attr\">top</span>?: <span class=\"built_in\">number</span></span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n\n<p>:::</p>\n"},{"title":"Gitå­¦ä¹ ç¬”è®°","publish":true,"description":"æµ…å­¦Gitç¬”è®°","date":"2024-09-15T02:48:00.000Z","sticky":2,"_content":"\n# GitåŸºç¡€\n\n> æ¨èä¸¤ä¸ªå­¦ä¹ Gitçš„ç½‘ç«™\n>\n> [Gitåœ¨çº¿ç»ƒä¹ ](https://learngitbranching.js.org/?locale=zh_CN)\n>\n> [Gitç§‘æ™®è§†é¢‘](https://www.bilibili.com/video/BV1HM411377j/?spm_id_from=333.337.search-card.all.click&vd_source=a15269894d9b8114cb5f9bb663d22be9)\n>\n> â€œæƒŸæ‰‹ç†Ÿå°”â€\n\n## æœ€å°é…ç½®\n\n- é…ç½®userä¿¡æ¯\n\n  - é…ç½®user.name:`git config --global user.name 'lyydsheep'`\n\n  - é…ç½®user.email:`git config --global user.email '2230561977@qq.com'`\n\n  - ```Go\n    //æ˜¾ç¤ºä¸åŒçº§åˆ«çš„é…ç½®ä¿¡æ¯\n    git config --list --local\n    git config --list --global\n    git config --list --system\n    ```\n\n## æ–°å»ºä»“åº“\n\nåœ¨gitä¸­æœ‰ä¸¤ç§æ–°å»ºä»“åº“çš„æ–¹å¼\n\n- `git init`ï¼šåœ¨æœ¬åœ°æ–°å»ºä¸€ä¸ªä»“åº“\n- `git clone url`ï¼šä»è¿œç¨‹æœåŠ¡å™¨ä¸Šå…‹éš†ä¸€ä¸ªä»“åº“\n\n## å·¥ä½œåŒºå’Œç¼“å­˜åŒº\n\n![image-20240915102716820](https://raw.githubusercontent.com/lyydsheep/pic/main/202409151027874.png)\n\n## æ·»åŠ å’Œæäº¤æ–‡ä»¶\n\n- `git status`ï¼šæŸ¥çœ‹ä»“åº“çŠ¶æ€\n- `git add`ï¼šæ·»åŠ åˆ°æš‚å­˜åŒº\n    - å¯ä»¥ä½¿ç”¨é€šé…ç¬¦ï¼š`git add *.txt`\n    - ä¹Ÿå¯ä»¥ä½¿ç”¨ç›®å½•ï¼š`git add .`\n- `git commit`ï¼šåªæäº¤**æš‚å­˜åŒº**ä¸­çš„å†…å®¹ï¼Œä¸ä¼šæäº¤**å·¥ä½œåŒº**çš„å†…å®¹\n- `git log`ï¼šæŸ¥çœ‹ä»“åº“å†å²æäº¤è®°å½•\n    - `git log --oneline`ï¼šç®€æ´åœ°å‘ˆç°æ—¥å¿—\n\n## git resetå›é€€ç‰ˆæœ¬\n\nä½¿ç”¨`git reset`å‘½ä»¤å¯ä»¥å›é€€åˆ°æŒ‡å®šçš„æäº¤ç‰ˆæœ¬ï¼Œ`git reset`æœ‰ä¸‰ç§æ¨¡å¼\n\n- `git reset --soft xxx`ï¼šå›é€€åˆ°xxxç‰ˆæœ¬ï¼Œä¸”ä¿å­˜xxxç‰ˆæœ¬ä¹‹åçš„å·¥ä½œåŒºå’Œæš‚å­˜åŒºçš„ä¿®æ”¹\n- `git reset --hard xxx`ï¼šå›é€€åˆ°xxxç‰ˆæœ¬ï¼Œå¹¶åˆ é™¤xxxç‰ˆæœ¬ä¹‹åå·¥ä½œåŒºå’Œæš‚å­˜åŒºçš„ä¿®æ”¹\n- `git reset --mixed xxx`ï¼šå›é€€åˆ°xxxç‰ˆæœ¬ï¼Œåªä¿ç•™xxxç‰ˆæœ¬ä¹‹åå·¥ä½œåŒºçš„ä¿®æ”¹\n\n![img](https://raw.githubusercontent.com/lyydsheep/pic/main/202409151025720.png)\n\n## ä½¿ç”¨git diffæŸ¥çœ‹å·®å¼‚\n\n- `git diff`å‘½ä»¤å¯ä»¥å¯¹ä¸¤ä¸ªä¸œè¥¿è¿›è¡Œæ¯”è¾ƒï¼Œç”¨äºæŸ¥çœ‹å·®å¼‚\n  - å¯ä»¥æ˜¯å·¥ä½œåŒºã€æš‚å­˜åŒºã€æœ¬åœ°ä»“åº“ä¹‹é—´çš„å·®å¼‚\n  - å¯ä»¥æ˜¯ä¸åŒç‰ˆæœ¬ä¹‹é—´çš„å·®å¼‚\n  - ä¹Ÿå¯ä»¥æ˜¯ä¸åŒåˆ†æ”¯ä¹‹é—´çš„å·®å¼‚\n\n![img](https://raw.githubusercontent.com/lyydsheep/pic/main/202409151024958.png)\n\n- `git diff`ï¼šé»˜è®¤æŸ¥**çœ‹å·¥ä½œåŒº**å’Œ**æš‚å­˜åŒº**ä¹‹é—´çš„å·®å¼‚\n- `git diff HEAD`ï¼šæŸ¥çœ‹**å·¥ä½œåŒºã€æš‚å­˜åŒº**å’Œ**æœ¬åœ°ä»“åº“**çš„å·®å¼‚\n- `git diff cached`ï¼šæŸ¥çœ‹**æš‚å­˜åŒº**å’Œ**æœ¬åœ°ä»“åº“**ä¹‹é—´çš„å·®å¼‚\n- `git diff <commit_hash> <commit_hash>`æˆ–è€…`git diff HEAD~ HEAD`ï¼šæŸ¥çœ‹**ä¸åŒæäº¤**ä¹‹é—´çš„å·®å¼‚\n- `git diff <branch_name> <branch_name>`ï¼šæ¯”è¾ƒ**ä¸åŒåˆ†æ”¯**ä¹‹é—´çš„å·®å¼‚\n\n![img](https://raw.githubusercontent.com/lyydsheep/pic/main/202409151025464.png)\n\n## ä½¿ç”¨git rmåˆ é™¤æ–‡ä»¶\n\n- `git rm <file_name>`ï¼š**ä¸€æ¬¡æ€§å°†æ–‡ä»¶ä»å·¥ä½œåŒºå’Œæš‚å­˜åŒºä¸­åˆ é™¤**\n\n![img](https://raw.githubusercontent.com/lyydsheep/pic/main/202409151025557.png)\n\n## .gitignoreå¿½ç•¥æ–‡ä»¶\n\nåœ¨.gitignoreæ–‡ä»¶ä¸­å†™å…¥åŒ¹é…ç¬¦ï¼Œgitä¼šå¿½ç•¥å¯¹è¢«åŒ¹é…ä¸Šçš„æ–‡ä»¶çš„ç®¡ç†\n\n## SSHé…ç½®å’Œå…‹éš†ä»“åº“\n\n[å¦‚ä½•åœ¨åŒä¸€ç”µè„‘ä¸Šç”Ÿæˆé…ç½®å¤šä¸ªssh key å…¬é’¥ ç§é’¥ï¼ˆä¿å§†çº§æ•™ç¨‹ï¼‰](https://juejin.cn/post/7085718883079815176)\n\n- åœ¨`.ssh`æ–‡ä»¶å¤¹ä¸‹ï¼Œä½¿ç”¨`ssh-keygen -t rsa -b 4096`ç”Ÿæˆç§é’¥æ–‡ä»¶å’Œå…¬é’¥æ–‡ä»¶\n  - å°†å…¬é’¥æ–‡ä»¶çš„ä¿¡æ¯é…ç½®åˆ°GitHubä¸Š\n  - ä¿å­˜å¥½ç§é’¥æ–‡ä»¶ä¸­çš„ä¿¡æ¯\n- `git clone repo-address`ï¼šå…‹éš†ä¸€ä¸ªè¿œç¨‹ä»“åº“\n- `git push <remote> <branch>`ï¼šæ¨é€æ›´æ–°å†…å®¹\n- `git pull <remote>`ï¼šæ‹‰å–æ›´æ–°å†…å®¹\n\n## å…³è”æœ¬åœ°ä»“åº“å’Œè¿œç¨‹ä»“åº“\n\n- æ·»åŠ è¿œç¨‹ä»“åº“\n  - `git remote add è¿œç¨‹ä»“åº“å è¿œç¨‹ä»“åº“åœ°å€`\n  - `git push -u è¿œç¨‹ä»“åº“å è¿œç¨‹ä»“åº“åˆ†æ”¯`\n- æŸ¥çœ‹è¿œç¨‹ä»“åº“\n  - `git remote -v`\n- æ‹‰å–è¿œç¨‹ä»“åº“å†…å®¹\n  - `git pull è¿œç¨‹ä»“åº“å è¿œç¨‹ä»“åº“åˆ†æ”¯:æœ¬åœ°ä»“åº“åˆ†æ”¯`\n\n## åˆ†æ”¯åŸºæœ¬æ“ä½œ\n\n- æŸ¥çœ‹åˆ†æ”¯åˆ—è¡¨ï¼š`git branch`\n- åˆ›å»ºåˆ†æ”¯ï¼š`git branch <name>`\n- åˆ‡æ¢åˆ†æ”¯ï¼š`git switch <name>`\n- åˆå¹¶åˆ†æ”¯ï¼š`git merge <name>`ï¼Œå°†`<name>`åˆ†æ”¯åˆå¹¶åˆ°å½“å‰çš„åˆ†æ”¯\n- åˆ é™¤åˆ†æ”¯ï¼š\n  - `git branch -d <name>`ï¼šåˆ é™¤å·²åˆå¹¶çš„åˆ†æ”¯\n  - `git branch -D <name>`ï¼šå¼ºåˆ¶åˆ é™¤åˆ†æ”¯\n\n\n\n## rebaseå’Œmerge\n\n- `git rebase`ï¼š\n  - ä¼˜ç‚¹ï¼šä¸ä¼šæ–°å¢é¢å¤–çš„æäº¤è®°å½•ï¼Œå½¢æˆçº¿æ€§å†å²ï¼Œæ¯”è¾ƒç›´è§‚å’Œå¹²å‡€\n  - ç¼ºç‚¹ï¼šä¼šæ”¹å˜æäº¤å†å²ï¼Œæ”¹å˜äº†å½“å‰åˆ†æ”¯branch outèŠ‚ç‚¹ï¼Œé¿å…åœ¨å…±äº«åˆ†æ”¯ä½¿ç”¨\n  - ä¾‹å¦‚å½“å‰åœ¨mainåˆ†æ”¯ä¸‹ï¼š\n    - `git rebase dev`ï¼šå°†mainåˆ†æ”¯çš„ä¿®æ”¹å«æ¥åˆ°devåˆ†æ”¯åé¢\n    - ![img](https://raw.githubusercontent.com/lyydsheep/pic/main/202409151025165.png)\n- `git merge`ï¼š\n  - ä¼˜ç‚¹ï¼šä¸ä¼šç ´ååŸåˆ†æ”¯çš„æäº¤è®°å½•ï¼Œæ–¹ä¾¿å›æº¯å’ŒæŸ¥çœ‹\n  - ç¼ºç‚¹ï¼šä¼šäº§ç”Ÿé¢å¤–çš„æäº¤èŠ‚ç‚¹ï¼Œåˆ†æ”¯å›¾æ¯”è¾ƒå¤æ‚\n  - ä¾‹å¦‚å½“å‰åœ¨mainåˆ†æ”¯ä¸‹ï¼š\n    - `gie merge dev`ï¼šåˆå¹¶devåˆ†æ”¯çš„ä¿®æ”¹\n\n# Gitå’ŒGitHubæ“ä½œæŒ‡å—\n\n## åˆå§‹åŒ–ä»“åº“å¹¶ç®€å•é…ç½®\n\n> å¯¹ä»“åº“è¿›è¡Œåˆå§‹åŒ–\n\n- ä½¿ç”¨`git init`å®Œæˆå¯¹ä»“åº“çš„åˆå§‹åŒ–æ“ä½œ\n\n> å¯¹ä»“åº“è¿›è¡Œç®€å•é…ç½®\n\n- ä½¿ç”¨`git config --global user.name \"lyydsheep\"`è®¾ç½®ä»“åº“çš„ç”¨æˆ·å\n- åŒæ ·åœ°ï¼Œå¯ä»¥ä¸ºä»“åº“é…ç½®é‚®ç®±`git config --global user.email \"2230561977@qq.com\"`\n  - é€šè¿‡å‘½ä»¤`git config --global --list `å°±å¯ä»¥**æŸ¥çœ‹**æˆ‘ä»¬ä¸ºè¯¥ä»“åº“è¿›è¡Œçš„é…ç½®\n\nå…³äº`system`ã€ `global`ã€`local`\n\n- system-ç³»ç»Ÿçº§: åœ¨gitå®‰è£…ä»¥åï¼Œgitçš„é»˜è®¤é…ç½®é¡¹éƒ½åœ¨è¿™é‡Œ\n- global-å…¨å±€çº§ï¼šç™»å½•ç”¨æˆ·å…¨å±€çº§åˆ«çš„gité…ç½®\n- local -ä»“åº“çº§: å¯¹ä¸åŒçš„ä»“åº“è¿›è¡Œè‡ªå®šä¹‰é…ç½®\n\nä¸‰ä¸ªå…³é”®å­—æ‰€èƒ½é…ç½®çš„**å±æ€§é›†åˆæ˜¯ä¸€æ ·çš„ï¼Œ**ä¸åŒåœ¨äº**ä¼˜å…ˆçº§**\n\n```\nlocal > global > system\n```\n\n> ä¸ºä»“åº“åˆ›å»ºä¸€ä¸ªåˆ†æ”¯\n\n- ä½¿ç”¨`git branch -M main`å°±èƒ½ä¸ºä»“åº“åˆ›å»ºä¸€ä¸ªmainåˆ†æ”¯\n\n## æœ€ç®€å•çš„Gitå·¥ä½œæµç¨‹ï¼šå·¥ä½œåŒºã€æš‚å­˜åŒºã€ä»“åº“\n\n**ç›¸å…³å‘½ä»¤**\n\n- Git statusï¼šç”¨äºæŸ¥çœ‹å½“å‰ä»“åº“çš„çŠ¶æ€\n- Git add filename:å°†filenameæ–‡ä»¶æ·»åŠ è‡³æš‚å­˜åŒº\n  - å•ä¸ªæ·»åŠ å¤ªæ…¢äº†ï¼Œä¸å¦‚ä½¿ç”¨`Git add .`å°†**æ‰€æœ‰**ä¿®æ”¹è¿‡çš„æ–‡ä»¶æ·»åŠ è‡³æš‚å­˜åŒº\n- Git commit -m \"comment\":å°†æš‚å­˜åŒºçš„æ–‡ä»¶æäº¤è‡³ä»“åº“ä¸­\n  - -m \"comment\":æ˜¯ä¸ºè¿™æ¬¡æäº¤è¿›è¡Œæ³¨é‡Š\n- Git log:æŸ¥çœ‹å†å²æäº¤è®°å½•\n\n> å‘½ä»¤ä¸æ–‡ä»¶çŠ¶æ€å˜åŒ–è¿‡ç¨‹\n\n![img](https://raw.githubusercontent.com/lyydsheep/pic/main/202409151024558.png)\n\n## å°†æœ¬åœ°ä»“åº“åŒæ­¥åˆ°è¿œç¨‹GitHubä»“åº“\n\nä¸ºä»€ä¹ˆé€‰æ‹©`SSH`åè®®è€Œä¸æ˜¯`HTTPS`åè®®ï¼Ÿ\n\n- ä½¿ç”¨`HTTPS`åè®®å¯èƒ½åœ¨æ—¥åä½¿ç”¨è¿‡ç¨‹ä¸­éœ€è¦**å¤šæ¬¡**è¾“å…¥ç”¨æˆ·åå’Œå¯†ç ï¼Œè¾ƒéº»çƒ¦\n- `SSH`åè®®**ä»…éœ€ç¬¬ä¸€æ¬¡**é…ç½®å¥½å…¬ç§é’¥ï¼Œä»Šåå°±æ— éœ€å†è¾“å…¥ç”¨æˆ·åå’Œå¯†ç \n\nå…·ä½“æ­¥éª¤ï¼š\n\n1. ä¸ºæœ¬åœ°ä»“åº“åˆ›å»ºä¸€ä¸ªè¿œç¨‹çš„GitHubä»“åº“ \n   - åœ¨GitHubç½‘é¡µä¸Šnewä¸€ä¸ªä»“åº“\n   - é€šè¿‡`git remote add origin ``git@github.com``:lyydsheep/learn_gogogogo.git`å‘½ä»¤å¯ä»¥å°†æœ¬åœ°ä»“åº“å’Œè¿œç¨‹ä»“åº“è¿›è¡Œå…³è”\n   -  ä½¿ç”¨`git remote`å¯ä»¥æŸ¥çœ‹è¿œç¨‹ä»“åº“çš„åç§°\n2. é…ç½®å…¬ç§é’¥ï¼Œè·å–`push`è¿œç¨‹ä»“åº“çš„æƒé™\n   -  ä½¿ç”¨`ssh-keygen -t rsa -C \"2230561977@qq.com\"`å‘½ä»¤ç”Ÿæˆå…¬ç§é’¥ \n   - å°†å…¬é’¥çš„å…·ä½“å†…å®¹å¤åˆ¶åˆ°`ssh and GPG keys`æ¨¡å—ä¸­\n     - `Settings` -> `ssh and GPG keys` -> `New SSH key`\n\n![img](https://raw.githubusercontent.com/lyydsheep/pic/main/202409151024035.png)\n\n![img](https://raw.githubusercontent.com/lyydsheep/pic/main/202409151024012.png)\n\n1. ä½¿ç”¨`git push -u origin main`å‘½ä»¤å°†æœ¬åœ°æ–‡ä»¶æ¨é€è‡³è¿œç¨‹ä»“åº“\n     - å‰ææ˜¯**æœ¬åœ°ä»“åº“è¦æœ‰**`main`**åˆ†æ”¯**\n\n\n![img](https://raw.githubusercontent.com/lyydsheep/pic/main/202409151024373.png)\n\n[åœ¨Golandä¸­ä½¿ç”¨Gitè¿›è¡Œåä½œå¼€å‘çš„æµç¨‹ | é’è®­è¥ç¬”è®° - æ˜é‡‘](https://juejin.cn/post/7196266492269199419)\n\n**go** mod init åº”ç”¨åç§° å°±æ˜¯åœ¨åº”ç”¨åç§°çš„æ ¹ç›®å½•ä¸‹ï¼Œç”Ÿæˆä¸€ä¸ª**go**.modæ–‡ä»¶ã€‚\n\n![img](https://raw.githubusercontent.com/lyydsheep/pic/main/202409151024647.png)","source":"_posts/gitå­¦ä¹ ç¬”è®°.md","raw":"---\ntitle: Gitå­¦ä¹ ç¬”è®°\npublish: true\ndescription: æµ…å­¦Gitç¬”è®°\ndate: 2024-09-15 10:48:00\ntag: Git\nsticky: 2\n---\n\n# GitåŸºç¡€\n\n> æ¨èä¸¤ä¸ªå­¦ä¹ Gitçš„ç½‘ç«™\n>\n> [Gitåœ¨çº¿ç»ƒä¹ ](https://learngitbranching.js.org/?locale=zh_CN)\n>\n> [Gitç§‘æ™®è§†é¢‘](https://www.bilibili.com/video/BV1HM411377j/?spm_id_from=333.337.search-card.all.click&vd_source=a15269894d9b8114cb5f9bb663d22be9)\n>\n> â€œæƒŸæ‰‹ç†Ÿå°”â€\n\n## æœ€å°é…ç½®\n\n- é…ç½®userä¿¡æ¯\n\n  - é…ç½®user.name:`git config --global user.name 'lyydsheep'`\n\n  - é…ç½®user.email:`git config --global user.email '2230561977@qq.com'`\n\n  - ```Go\n    //æ˜¾ç¤ºä¸åŒçº§åˆ«çš„é…ç½®ä¿¡æ¯\n    git config --list --local\n    git config --list --global\n    git config --list --system\n    ```\n\n## æ–°å»ºä»“åº“\n\nåœ¨gitä¸­æœ‰ä¸¤ç§æ–°å»ºä»“åº“çš„æ–¹å¼\n\n- `git init`ï¼šåœ¨æœ¬åœ°æ–°å»ºä¸€ä¸ªä»“åº“\n- `git clone url`ï¼šä»è¿œç¨‹æœåŠ¡å™¨ä¸Šå…‹éš†ä¸€ä¸ªä»“åº“\n\n## å·¥ä½œåŒºå’Œç¼“å­˜åŒº\n\n![image-20240915102716820](https://raw.githubusercontent.com/lyydsheep/pic/main/202409151027874.png)\n\n## æ·»åŠ å’Œæäº¤æ–‡ä»¶\n\n- `git status`ï¼šæŸ¥çœ‹ä»“åº“çŠ¶æ€\n- `git add`ï¼šæ·»åŠ åˆ°æš‚å­˜åŒº\n    - å¯ä»¥ä½¿ç”¨é€šé…ç¬¦ï¼š`git add *.txt`\n    - ä¹Ÿå¯ä»¥ä½¿ç”¨ç›®å½•ï¼š`git add .`\n- `git commit`ï¼šåªæäº¤**æš‚å­˜åŒº**ä¸­çš„å†…å®¹ï¼Œä¸ä¼šæäº¤**å·¥ä½œåŒº**çš„å†…å®¹\n- `git log`ï¼šæŸ¥çœ‹ä»“åº“å†å²æäº¤è®°å½•\n    - `git log --oneline`ï¼šç®€æ´åœ°å‘ˆç°æ—¥å¿—\n\n## git resetå›é€€ç‰ˆæœ¬\n\nä½¿ç”¨`git reset`å‘½ä»¤å¯ä»¥å›é€€åˆ°æŒ‡å®šçš„æäº¤ç‰ˆæœ¬ï¼Œ`git reset`æœ‰ä¸‰ç§æ¨¡å¼\n\n- `git reset --soft xxx`ï¼šå›é€€åˆ°xxxç‰ˆæœ¬ï¼Œä¸”ä¿å­˜xxxç‰ˆæœ¬ä¹‹åçš„å·¥ä½œåŒºå’Œæš‚å­˜åŒºçš„ä¿®æ”¹\n- `git reset --hard xxx`ï¼šå›é€€åˆ°xxxç‰ˆæœ¬ï¼Œå¹¶åˆ é™¤xxxç‰ˆæœ¬ä¹‹åå·¥ä½œåŒºå’Œæš‚å­˜åŒºçš„ä¿®æ”¹\n- `git reset --mixed xxx`ï¼šå›é€€åˆ°xxxç‰ˆæœ¬ï¼Œåªä¿ç•™xxxç‰ˆæœ¬ä¹‹åå·¥ä½œåŒºçš„ä¿®æ”¹\n\n![img](https://raw.githubusercontent.com/lyydsheep/pic/main/202409151025720.png)\n\n## ä½¿ç”¨git diffæŸ¥çœ‹å·®å¼‚\n\n- `git diff`å‘½ä»¤å¯ä»¥å¯¹ä¸¤ä¸ªä¸œè¥¿è¿›è¡Œæ¯”è¾ƒï¼Œç”¨äºæŸ¥çœ‹å·®å¼‚\n  - å¯ä»¥æ˜¯å·¥ä½œåŒºã€æš‚å­˜åŒºã€æœ¬åœ°ä»“åº“ä¹‹é—´çš„å·®å¼‚\n  - å¯ä»¥æ˜¯ä¸åŒç‰ˆæœ¬ä¹‹é—´çš„å·®å¼‚\n  - ä¹Ÿå¯ä»¥æ˜¯ä¸åŒåˆ†æ”¯ä¹‹é—´çš„å·®å¼‚\n\n![img](https://raw.githubusercontent.com/lyydsheep/pic/main/202409151024958.png)\n\n- `git diff`ï¼šé»˜è®¤æŸ¥**çœ‹å·¥ä½œåŒº**å’Œ**æš‚å­˜åŒº**ä¹‹é—´çš„å·®å¼‚\n- `git diff HEAD`ï¼šæŸ¥çœ‹**å·¥ä½œåŒºã€æš‚å­˜åŒº**å’Œ**æœ¬åœ°ä»“åº“**çš„å·®å¼‚\n- `git diff cached`ï¼šæŸ¥çœ‹**æš‚å­˜åŒº**å’Œ**æœ¬åœ°ä»“åº“**ä¹‹é—´çš„å·®å¼‚\n- `git diff <commit_hash> <commit_hash>`æˆ–è€…`git diff HEAD~ HEAD`ï¼šæŸ¥çœ‹**ä¸åŒæäº¤**ä¹‹é—´çš„å·®å¼‚\n- `git diff <branch_name> <branch_name>`ï¼šæ¯”è¾ƒ**ä¸åŒåˆ†æ”¯**ä¹‹é—´çš„å·®å¼‚\n\n![img](https://raw.githubusercontent.com/lyydsheep/pic/main/202409151025464.png)\n\n## ä½¿ç”¨git rmåˆ é™¤æ–‡ä»¶\n\n- `git rm <file_name>`ï¼š**ä¸€æ¬¡æ€§å°†æ–‡ä»¶ä»å·¥ä½œåŒºå’Œæš‚å­˜åŒºä¸­åˆ é™¤**\n\n![img](https://raw.githubusercontent.com/lyydsheep/pic/main/202409151025557.png)\n\n## .gitignoreå¿½ç•¥æ–‡ä»¶\n\nåœ¨.gitignoreæ–‡ä»¶ä¸­å†™å…¥åŒ¹é…ç¬¦ï¼Œgitä¼šå¿½ç•¥å¯¹è¢«åŒ¹é…ä¸Šçš„æ–‡ä»¶çš„ç®¡ç†\n\n## SSHé…ç½®å’Œå…‹éš†ä»“åº“\n\n[å¦‚ä½•åœ¨åŒä¸€ç”µè„‘ä¸Šç”Ÿæˆé…ç½®å¤šä¸ªssh key å…¬é’¥ ç§é’¥ï¼ˆä¿å§†çº§æ•™ç¨‹ï¼‰](https://juejin.cn/post/7085718883079815176)\n\n- åœ¨`.ssh`æ–‡ä»¶å¤¹ä¸‹ï¼Œä½¿ç”¨`ssh-keygen -t rsa -b 4096`ç”Ÿæˆç§é’¥æ–‡ä»¶å’Œå…¬é’¥æ–‡ä»¶\n  - å°†å…¬é’¥æ–‡ä»¶çš„ä¿¡æ¯é…ç½®åˆ°GitHubä¸Š\n  - ä¿å­˜å¥½ç§é’¥æ–‡ä»¶ä¸­çš„ä¿¡æ¯\n- `git clone repo-address`ï¼šå…‹éš†ä¸€ä¸ªè¿œç¨‹ä»“åº“\n- `git push <remote> <branch>`ï¼šæ¨é€æ›´æ–°å†…å®¹\n- `git pull <remote>`ï¼šæ‹‰å–æ›´æ–°å†…å®¹\n\n## å…³è”æœ¬åœ°ä»“åº“å’Œè¿œç¨‹ä»“åº“\n\n- æ·»åŠ è¿œç¨‹ä»“åº“\n  - `git remote add è¿œç¨‹ä»“åº“å è¿œç¨‹ä»“åº“åœ°å€`\n  - `git push -u è¿œç¨‹ä»“åº“å è¿œç¨‹ä»“åº“åˆ†æ”¯`\n- æŸ¥çœ‹è¿œç¨‹ä»“åº“\n  - `git remote -v`\n- æ‹‰å–è¿œç¨‹ä»“åº“å†…å®¹\n  - `git pull è¿œç¨‹ä»“åº“å è¿œç¨‹ä»“åº“åˆ†æ”¯:æœ¬åœ°ä»“åº“åˆ†æ”¯`\n\n## åˆ†æ”¯åŸºæœ¬æ“ä½œ\n\n- æŸ¥çœ‹åˆ†æ”¯åˆ—è¡¨ï¼š`git branch`\n- åˆ›å»ºåˆ†æ”¯ï¼š`git branch <name>`\n- åˆ‡æ¢åˆ†æ”¯ï¼š`git switch <name>`\n- åˆå¹¶åˆ†æ”¯ï¼š`git merge <name>`ï¼Œå°†`<name>`åˆ†æ”¯åˆå¹¶åˆ°å½“å‰çš„åˆ†æ”¯\n- åˆ é™¤åˆ†æ”¯ï¼š\n  - `git branch -d <name>`ï¼šåˆ é™¤å·²åˆå¹¶çš„åˆ†æ”¯\n  - `git branch -D <name>`ï¼šå¼ºåˆ¶åˆ é™¤åˆ†æ”¯\n\n\n\n## rebaseå’Œmerge\n\n- `git rebase`ï¼š\n  - ä¼˜ç‚¹ï¼šä¸ä¼šæ–°å¢é¢å¤–çš„æäº¤è®°å½•ï¼Œå½¢æˆçº¿æ€§å†å²ï¼Œæ¯”è¾ƒç›´è§‚å’Œå¹²å‡€\n  - ç¼ºç‚¹ï¼šä¼šæ”¹å˜æäº¤å†å²ï¼Œæ”¹å˜äº†å½“å‰åˆ†æ”¯branch outèŠ‚ç‚¹ï¼Œé¿å…åœ¨å…±äº«åˆ†æ”¯ä½¿ç”¨\n  - ä¾‹å¦‚å½“å‰åœ¨mainåˆ†æ”¯ä¸‹ï¼š\n    - `git rebase dev`ï¼šå°†mainåˆ†æ”¯çš„ä¿®æ”¹å«æ¥åˆ°devåˆ†æ”¯åé¢\n    - ![img](https://raw.githubusercontent.com/lyydsheep/pic/main/202409151025165.png)\n- `git merge`ï¼š\n  - ä¼˜ç‚¹ï¼šä¸ä¼šç ´ååŸåˆ†æ”¯çš„æäº¤è®°å½•ï¼Œæ–¹ä¾¿å›æº¯å’ŒæŸ¥çœ‹\n  - ç¼ºç‚¹ï¼šä¼šäº§ç”Ÿé¢å¤–çš„æäº¤èŠ‚ç‚¹ï¼Œåˆ†æ”¯å›¾æ¯”è¾ƒå¤æ‚\n  - ä¾‹å¦‚å½“å‰åœ¨mainåˆ†æ”¯ä¸‹ï¼š\n    - `gie merge dev`ï¼šåˆå¹¶devåˆ†æ”¯çš„ä¿®æ”¹\n\n# Gitå’ŒGitHubæ“ä½œæŒ‡å—\n\n## åˆå§‹åŒ–ä»“åº“å¹¶ç®€å•é…ç½®\n\n> å¯¹ä»“åº“è¿›è¡Œåˆå§‹åŒ–\n\n- ä½¿ç”¨`git init`å®Œæˆå¯¹ä»“åº“çš„åˆå§‹åŒ–æ“ä½œ\n\n> å¯¹ä»“åº“è¿›è¡Œç®€å•é…ç½®\n\n- ä½¿ç”¨`git config --global user.name \"lyydsheep\"`è®¾ç½®ä»“åº“çš„ç”¨æˆ·å\n- åŒæ ·åœ°ï¼Œå¯ä»¥ä¸ºä»“åº“é…ç½®é‚®ç®±`git config --global user.email \"2230561977@qq.com\"`\n  - é€šè¿‡å‘½ä»¤`git config --global --list `å°±å¯ä»¥**æŸ¥çœ‹**æˆ‘ä»¬ä¸ºè¯¥ä»“åº“è¿›è¡Œçš„é…ç½®\n\nå…³äº`system`ã€ `global`ã€`local`\n\n- system-ç³»ç»Ÿçº§: åœ¨gitå®‰è£…ä»¥åï¼Œgitçš„é»˜è®¤é…ç½®é¡¹éƒ½åœ¨è¿™é‡Œ\n- global-å…¨å±€çº§ï¼šç™»å½•ç”¨æˆ·å…¨å±€çº§åˆ«çš„gité…ç½®\n- local -ä»“åº“çº§: å¯¹ä¸åŒçš„ä»“åº“è¿›è¡Œè‡ªå®šä¹‰é…ç½®\n\nä¸‰ä¸ªå…³é”®å­—æ‰€èƒ½é…ç½®çš„**å±æ€§é›†åˆæ˜¯ä¸€æ ·çš„ï¼Œ**ä¸åŒåœ¨äº**ä¼˜å…ˆçº§**\n\n```\nlocal > global > system\n```\n\n> ä¸ºä»“åº“åˆ›å»ºä¸€ä¸ªåˆ†æ”¯\n\n- ä½¿ç”¨`git branch -M main`å°±èƒ½ä¸ºä»“åº“åˆ›å»ºä¸€ä¸ªmainåˆ†æ”¯\n\n## æœ€ç®€å•çš„Gitå·¥ä½œæµç¨‹ï¼šå·¥ä½œåŒºã€æš‚å­˜åŒºã€ä»“åº“\n\n**ç›¸å…³å‘½ä»¤**\n\n- Git statusï¼šç”¨äºæŸ¥çœ‹å½“å‰ä»“åº“çš„çŠ¶æ€\n- Git add filename:å°†filenameæ–‡ä»¶æ·»åŠ è‡³æš‚å­˜åŒº\n  - å•ä¸ªæ·»åŠ å¤ªæ…¢äº†ï¼Œä¸å¦‚ä½¿ç”¨`Git add .`å°†**æ‰€æœ‰**ä¿®æ”¹è¿‡çš„æ–‡ä»¶æ·»åŠ è‡³æš‚å­˜åŒº\n- Git commit -m \"comment\":å°†æš‚å­˜åŒºçš„æ–‡ä»¶æäº¤è‡³ä»“åº“ä¸­\n  - -m \"comment\":æ˜¯ä¸ºè¿™æ¬¡æäº¤è¿›è¡Œæ³¨é‡Š\n- Git log:æŸ¥çœ‹å†å²æäº¤è®°å½•\n\n> å‘½ä»¤ä¸æ–‡ä»¶çŠ¶æ€å˜åŒ–è¿‡ç¨‹\n\n![img](https://raw.githubusercontent.com/lyydsheep/pic/main/202409151024558.png)\n\n## å°†æœ¬åœ°ä»“åº“åŒæ­¥åˆ°è¿œç¨‹GitHubä»“åº“\n\nä¸ºä»€ä¹ˆé€‰æ‹©`SSH`åè®®è€Œä¸æ˜¯`HTTPS`åè®®ï¼Ÿ\n\n- ä½¿ç”¨`HTTPS`åè®®å¯èƒ½åœ¨æ—¥åä½¿ç”¨è¿‡ç¨‹ä¸­éœ€è¦**å¤šæ¬¡**è¾“å…¥ç”¨æˆ·åå’Œå¯†ç ï¼Œè¾ƒéº»çƒ¦\n- `SSH`åè®®**ä»…éœ€ç¬¬ä¸€æ¬¡**é…ç½®å¥½å…¬ç§é’¥ï¼Œä»Šåå°±æ— éœ€å†è¾“å…¥ç”¨æˆ·åå’Œå¯†ç \n\nå…·ä½“æ­¥éª¤ï¼š\n\n1. ä¸ºæœ¬åœ°ä»“åº“åˆ›å»ºä¸€ä¸ªè¿œç¨‹çš„GitHubä»“åº“ \n   - åœ¨GitHubç½‘é¡µä¸Šnewä¸€ä¸ªä»“åº“\n   - é€šè¿‡`git remote add origin ``git@github.com``:lyydsheep/learn_gogogogo.git`å‘½ä»¤å¯ä»¥å°†æœ¬åœ°ä»“åº“å’Œè¿œç¨‹ä»“åº“è¿›è¡Œå…³è”\n   -  ä½¿ç”¨`git remote`å¯ä»¥æŸ¥çœ‹è¿œç¨‹ä»“åº“çš„åç§°\n2. é…ç½®å…¬ç§é’¥ï¼Œè·å–`push`è¿œç¨‹ä»“åº“çš„æƒé™\n   -  ä½¿ç”¨`ssh-keygen -t rsa -C \"2230561977@qq.com\"`å‘½ä»¤ç”Ÿæˆå…¬ç§é’¥ \n   - å°†å…¬é’¥çš„å…·ä½“å†…å®¹å¤åˆ¶åˆ°`ssh and GPG keys`æ¨¡å—ä¸­\n     - `Settings` -> `ssh and GPG keys` -> `New SSH key`\n\n![img](https://raw.githubusercontent.com/lyydsheep/pic/main/202409151024035.png)\n\n![img](https://raw.githubusercontent.com/lyydsheep/pic/main/202409151024012.png)\n\n1. ä½¿ç”¨`git push -u origin main`å‘½ä»¤å°†æœ¬åœ°æ–‡ä»¶æ¨é€è‡³è¿œç¨‹ä»“åº“\n     - å‰ææ˜¯**æœ¬åœ°ä»“åº“è¦æœ‰**`main`**åˆ†æ”¯**\n\n\n![img](https://raw.githubusercontent.com/lyydsheep/pic/main/202409151024373.png)\n\n[åœ¨Golandä¸­ä½¿ç”¨Gitè¿›è¡Œåä½œå¼€å‘çš„æµç¨‹ | é’è®­è¥ç¬”è®° - æ˜é‡‘](https://juejin.cn/post/7196266492269199419)\n\n**go** mod init åº”ç”¨åç§° å°±æ˜¯åœ¨åº”ç”¨åç§°çš„æ ¹ç›®å½•ä¸‹ï¼Œç”Ÿæˆä¸€ä¸ª**go**.modæ–‡ä»¶ã€‚\n\n![img](https://raw.githubusercontent.com/lyydsheep/pic/main/202409151024647.png)","slug":"gitå­¦ä¹ ç¬”è®°","published":1,"updated":"2024-12-27T11:03:15.343Z","comments":1,"layout":"post","photos":[],"_id":"cm6c7md6h0008a5t29qz25cih","content":"<h1 id=\"GitåŸºç¡€\"><a href=\"#GitåŸºç¡€\" class=\"headerlink\" title=\"GitåŸºç¡€\"></a>GitåŸºç¡€</h1><blockquote>\n<p>æ¨èä¸¤ä¸ªå­¦ä¹ Gitçš„ç½‘ç«™</p>\n<p><a href=\"https://learngitbranching.js.org/?locale=zh_CN\">Gitåœ¨çº¿ç»ƒä¹ </a></p>\n<p><a href=\"https://www.bilibili.com/video/BV1HM411377j/?spm_id_from=333.337.search-card.all.click&vd_source=a15269894d9b8114cb5f9bb663d22be9\">Gitç§‘æ™®è§†é¢‘</a></p>\n<p>â€œæƒŸæ‰‹ç†Ÿå°”â€</p>\n</blockquote>\n<h2 id=\"æœ€å°é…ç½®\"><a href=\"#æœ€å°é…ç½®\" class=\"headerlink\" title=\"æœ€å°é…ç½®\"></a>æœ€å°é…ç½®</h2><ul>\n<li><p>é…ç½®userä¿¡æ¯</p>\n<ul>\n<li><p>é…ç½®user.name:<code>git config --global user.name &#39;lyydsheep&#39;</code></p>\n</li>\n<li><p>é…ç½®user.email:<code>git config --global user.email &#39;2230561977@qq.com&#39;</code></p>\n</li>\n<li><pre><code class=\"Go\">//æ˜¾ç¤ºä¸åŒçº§åˆ«çš„é…ç½®ä¿¡æ¯\ngit config --list --local\ngit config --list --global\ngit config --list --system\n<figure class=\"highlight plaintext\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br><span class=\"line\">31</span><br><span class=\"line\">32</span><br><span class=\"line\">33</span><br><span class=\"line\">34</span><br><span class=\"line\">35</span><br><span class=\"line\">36</span><br><span class=\"line\">37</span><br><span class=\"line\">38</span><br><span class=\"line\">39</span><br><span class=\"line\">40</span><br><span class=\"line\">41</span><br><span class=\"line\">42</span><br><span class=\"line\">43</span><br><span class=\"line\">44</span><br><span class=\"line\">45</span><br><span class=\"line\">46</span><br><span class=\"line\">47</span><br><span class=\"line\">48</span><br><span class=\"line\">49</span><br><span class=\"line\">50</span><br><span class=\"line\">51</span><br><span class=\"line\">52</span><br><span class=\"line\">53</span><br><span class=\"line\">54</span><br><span class=\"line\">55</span><br><span class=\"line\">56</span><br><span class=\"line\">57</span><br><span class=\"line\">58</span><br><span class=\"line\">59</span><br><span class=\"line\">60</span><br><span class=\"line\">61</span><br><span class=\"line\">62</span><br><span class=\"line\">63</span><br><span class=\"line\">64</span><br><span class=\"line\">65</span><br><span class=\"line\">66</span><br><span class=\"line\">67</span><br><span class=\"line\">68</span><br><span class=\"line\">69</span><br><span class=\"line\">70</span><br><span class=\"line\">71</span><br><span class=\"line\">72</span><br><span class=\"line\">73</span><br><span class=\"line\">74</span><br><span class=\"line\">75</span><br><span class=\"line\">76</span><br><span class=\"line\">77</span><br><span class=\"line\">78</span><br><span class=\"line\">79</span><br><span class=\"line\">80</span><br><span class=\"line\">81</span><br><span class=\"line\">82</span><br><span class=\"line\">83</span><br><span class=\"line\">84</span><br><span class=\"line\">85</span><br><span class=\"line\">86</span><br><span class=\"line\">87</span><br><span class=\"line\">88</span><br><span class=\"line\">89</span><br><span class=\"line\">90</span><br><span class=\"line\">91</span><br><span class=\"line\">92</span><br><span class=\"line\">93</span><br><span class=\"line\">94</span><br><span class=\"line\">95</span><br><span class=\"line\">96</span><br><span class=\"line\">97</span><br><span class=\"line\">98</span><br><span class=\"line\">99</span><br><span class=\"line\">100</span><br><span class=\"line\">101</span><br><span class=\"line\">102</span><br><span class=\"line\">103</span><br><span class=\"line\">104</span><br><span class=\"line\">105</span><br><span class=\"line\">106</span><br><span class=\"line\">107</span><br><span class=\"line\">108</span><br><span class=\"line\">109</span><br><span class=\"line\">110</span><br><span class=\"line\">111</span><br><span class=\"line\">112</span><br><span class=\"line\">113</span><br><span class=\"line\">114</span><br><span class=\"line\">115</span><br><span class=\"line\">116</span><br><span class=\"line\">117</span><br><span class=\"line\">118</span><br><span class=\"line\">119</span><br><span class=\"line\">120</span><br><span class=\"line\">121</span><br><span class=\"line\">122</span><br><span class=\"line\">123</span><br><span class=\"line\">124</span><br><span class=\"line\">125</span><br><span class=\"line\">126</span><br><span class=\"line\">127</span><br><span class=\"line\">128</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"></span><br><span class=\"line\">## æ–°å»ºä»“åº“</span><br><span class=\"line\"></span><br><span class=\"line\">åœ¨gitä¸­æœ‰ä¸¤ç§æ–°å»ºä»“åº“çš„æ–¹å¼</span><br><span class=\"line\"></span><br><span class=\"line\">- `git init`ï¼šåœ¨æœ¬åœ°æ–°å»ºä¸€ä¸ªä»“åº“</span><br><span class=\"line\">- `git clone url`ï¼šä»è¿œç¨‹æœåŠ¡å™¨ä¸Šå…‹éš†ä¸€ä¸ªä»“åº“</span><br><span class=\"line\"></span><br><span class=\"line\">## å·¥ä½œåŒºå’Œç¼“å­˜åŒº</span><br><span class=\"line\"></span><br><span class=\"line\">![image-20240915102716820](https://raw.githubusercontent.com/lyydsheep/pic/main/202409151027874.png)</span><br><span class=\"line\"></span><br><span class=\"line\">## æ·»åŠ å’Œæäº¤æ–‡ä»¶</span><br><span class=\"line\"></span><br><span class=\"line\">- `git status`ï¼šæŸ¥çœ‹ä»“åº“çŠ¶æ€</span><br><span class=\"line\">- `git add`ï¼šæ·»åŠ åˆ°æš‚å­˜åŒº</span><br><span class=\"line\">    - å¯ä»¥ä½¿ç”¨é€šé…ç¬¦ï¼š`git add *.txt`</span><br><span class=\"line\">    - ä¹Ÿå¯ä»¥ä½¿ç”¨ç›®å½•ï¼š`git add .`</span><br><span class=\"line\">- `git commit`ï¼šåªæäº¤**æš‚å­˜åŒº**ä¸­çš„å†…å®¹ï¼Œä¸ä¼šæäº¤**å·¥ä½œåŒº**çš„å†…å®¹</span><br><span class=\"line\">- `git log`ï¼šæŸ¥çœ‹ä»“åº“å†å²æäº¤è®°å½•</span><br><span class=\"line\">    - `git log --oneline`ï¼šç®€æ´åœ°å‘ˆç°æ—¥å¿—</span><br><span class=\"line\"></span><br><span class=\"line\">## git resetå›é€€ç‰ˆæœ¬</span><br><span class=\"line\"></span><br><span class=\"line\">ä½¿ç”¨`git reset`å‘½ä»¤å¯ä»¥å›é€€åˆ°æŒ‡å®šçš„æäº¤ç‰ˆæœ¬ï¼Œ`git reset`æœ‰ä¸‰ç§æ¨¡å¼</span><br><span class=\"line\"></span><br><span class=\"line\">- `git reset --soft xxx`ï¼šå›é€€åˆ°xxxç‰ˆæœ¬ï¼Œä¸”ä¿å­˜xxxç‰ˆæœ¬ä¹‹åçš„å·¥ä½œåŒºå’Œæš‚å­˜åŒºçš„ä¿®æ”¹</span><br><span class=\"line\">- `git reset --hard xxx`ï¼šå›é€€åˆ°xxxç‰ˆæœ¬ï¼Œå¹¶åˆ é™¤xxxç‰ˆæœ¬ä¹‹åå·¥ä½œåŒºå’Œæš‚å­˜åŒºçš„ä¿®æ”¹</span><br><span class=\"line\">- `git reset --mixed xxx`ï¼šå›é€€åˆ°xxxç‰ˆæœ¬ï¼Œåªä¿ç•™xxxç‰ˆæœ¬ä¹‹åå·¥ä½œåŒºçš„ä¿®æ”¹</span><br><span class=\"line\"></span><br><span class=\"line\">![img](https://raw.githubusercontent.com/lyydsheep/pic/main/202409151025720.png)</span><br><span class=\"line\"></span><br><span class=\"line\">## ä½¿ç”¨git diffæŸ¥çœ‹å·®å¼‚</span><br><span class=\"line\"></span><br><span class=\"line\">- `git diff`å‘½ä»¤å¯ä»¥å¯¹ä¸¤ä¸ªä¸œè¥¿è¿›è¡Œæ¯”è¾ƒï¼Œç”¨äºæŸ¥çœ‹å·®å¼‚</span><br><span class=\"line\">  - å¯ä»¥æ˜¯å·¥ä½œåŒºã€æš‚å­˜åŒºã€æœ¬åœ°ä»“åº“ä¹‹é—´çš„å·®å¼‚</span><br><span class=\"line\">  - å¯ä»¥æ˜¯ä¸åŒç‰ˆæœ¬ä¹‹é—´çš„å·®å¼‚</span><br><span class=\"line\">  - ä¹Ÿå¯ä»¥æ˜¯ä¸åŒåˆ†æ”¯ä¹‹é—´çš„å·®å¼‚</span><br><span class=\"line\"></span><br><span class=\"line\">![img](https://raw.githubusercontent.com/lyydsheep/pic/main/202409151024958.png)</span><br><span class=\"line\"></span><br><span class=\"line\">- `git diff`ï¼šé»˜è®¤æŸ¥**çœ‹å·¥ä½œåŒº**å’Œ**æš‚å­˜åŒº**ä¹‹é—´çš„å·®å¼‚</span><br><span class=\"line\">- `git diff HEAD`ï¼šæŸ¥çœ‹**å·¥ä½œåŒºã€æš‚å­˜åŒº**å’Œ**æœ¬åœ°ä»“åº“**çš„å·®å¼‚</span><br><span class=\"line\">- `git diff cached`ï¼šæŸ¥çœ‹**æš‚å­˜åŒº**å’Œ**æœ¬åœ°ä»“åº“**ä¹‹é—´çš„å·®å¼‚</span><br><span class=\"line\">- `git diff &lt;commit_hash&gt; &lt;commit_hash&gt;`æˆ–è€…`git diff HEAD~ HEAD`ï¼šæŸ¥çœ‹**ä¸åŒæäº¤**ä¹‹é—´çš„å·®å¼‚</span><br><span class=\"line\">- `git diff &lt;branch_name&gt; &lt;branch_name&gt;`ï¼šæ¯”è¾ƒ**ä¸åŒåˆ†æ”¯**ä¹‹é—´çš„å·®å¼‚</span><br><span class=\"line\"></span><br><span class=\"line\">![img](https://raw.githubusercontent.com/lyydsheep/pic/main/202409151025464.png)</span><br><span class=\"line\"></span><br><span class=\"line\">## ä½¿ç”¨git rmåˆ é™¤æ–‡ä»¶</span><br><span class=\"line\"></span><br><span class=\"line\">- `git rm &lt;file_name&gt;`ï¼š**ä¸€æ¬¡æ€§å°†æ–‡ä»¶ä»å·¥ä½œåŒºå’Œæš‚å­˜åŒºä¸­åˆ é™¤**</span><br><span class=\"line\"></span><br><span class=\"line\">![img](https://raw.githubusercontent.com/lyydsheep/pic/main/202409151025557.png)</span><br><span class=\"line\"></span><br><span class=\"line\">## .gitignoreå¿½ç•¥æ–‡ä»¶</span><br><span class=\"line\"></span><br><span class=\"line\">åœ¨.gitignoreæ–‡ä»¶ä¸­å†™å…¥åŒ¹é…ç¬¦ï¼Œgitä¼šå¿½ç•¥å¯¹è¢«åŒ¹é…ä¸Šçš„æ–‡ä»¶çš„ç®¡ç†</span><br><span class=\"line\"></span><br><span class=\"line\">## SSHé…ç½®å’Œå…‹éš†ä»“åº“</span><br><span class=\"line\"></span><br><span class=\"line\">[å¦‚ä½•åœ¨åŒä¸€ç”µè„‘ä¸Šç”Ÿæˆé…ç½®å¤šä¸ªssh key å…¬é’¥ ç§é’¥ï¼ˆä¿å§†çº§æ•™ç¨‹ï¼‰](https://juejin.cn/post/7085718883079815176)</span><br><span class=\"line\"></span><br><span class=\"line\">- åœ¨`.ssh`æ–‡ä»¶å¤¹ä¸‹ï¼Œä½¿ç”¨`ssh-keygen -t rsa -b 4096`ç”Ÿæˆç§é’¥æ–‡ä»¶å’Œå…¬é’¥æ–‡ä»¶</span><br><span class=\"line\">  - å°†å…¬é’¥æ–‡ä»¶çš„ä¿¡æ¯é…ç½®åˆ°GitHubä¸Š</span><br><span class=\"line\">  - ä¿å­˜å¥½ç§é’¥æ–‡ä»¶ä¸­çš„ä¿¡æ¯</span><br><span class=\"line\">- `git clone repo-address`ï¼šå…‹éš†ä¸€ä¸ªè¿œç¨‹ä»“åº“</span><br><span class=\"line\">- `git push &lt;remote&gt; &lt;branch&gt;`ï¼šæ¨é€æ›´æ–°å†…å®¹</span><br><span class=\"line\">- `git pull &lt;remote&gt;`ï¼šæ‹‰å–æ›´æ–°å†…å®¹</span><br><span class=\"line\"></span><br><span class=\"line\">## å…³è”æœ¬åœ°ä»“åº“å’Œè¿œç¨‹ä»“åº“</span><br><span class=\"line\"></span><br><span class=\"line\">- æ·»åŠ è¿œç¨‹ä»“åº“</span><br><span class=\"line\">  - `git remote add è¿œç¨‹ä»“åº“å è¿œç¨‹ä»“åº“åœ°å€`</span><br><span class=\"line\">  - `git push -u è¿œç¨‹ä»“åº“å è¿œç¨‹ä»“åº“åˆ†æ”¯`</span><br><span class=\"line\">- æŸ¥çœ‹è¿œç¨‹ä»“åº“</span><br><span class=\"line\">  - `git remote -v`</span><br><span class=\"line\">- æ‹‰å–è¿œç¨‹ä»“åº“å†…å®¹</span><br><span class=\"line\">  - `git pull è¿œç¨‹ä»“åº“å è¿œç¨‹ä»“åº“åˆ†æ”¯:æœ¬åœ°ä»“åº“åˆ†æ”¯`</span><br><span class=\"line\"></span><br><span class=\"line\">## åˆ†æ”¯åŸºæœ¬æ“ä½œ</span><br><span class=\"line\"></span><br><span class=\"line\">- æŸ¥çœ‹åˆ†æ”¯åˆ—è¡¨ï¼š`git branch`</span><br><span class=\"line\">- åˆ›å»ºåˆ†æ”¯ï¼š`git branch &lt;name&gt;`</span><br><span class=\"line\">- åˆ‡æ¢åˆ†æ”¯ï¼š`git switch &lt;name&gt;`</span><br><span class=\"line\">- åˆå¹¶åˆ†æ”¯ï¼š`git merge &lt;name&gt;`ï¼Œå°†`&lt;name&gt;`åˆ†æ”¯åˆå¹¶åˆ°å½“å‰çš„åˆ†æ”¯</span><br><span class=\"line\">- åˆ é™¤åˆ†æ”¯ï¼š</span><br><span class=\"line\">  - `git branch -d &lt;name&gt;`ï¼šåˆ é™¤å·²åˆå¹¶çš„åˆ†æ”¯</span><br><span class=\"line\">  - `git branch -D &lt;name&gt;`ï¼šå¼ºåˆ¶åˆ é™¤åˆ†æ”¯</span><br><span class=\"line\"></span><br><span class=\"line\"></span><br><span class=\"line\"></span><br><span class=\"line\">## rebaseå’Œmerge</span><br><span class=\"line\"></span><br><span class=\"line\">- `git rebase`ï¼š</span><br><span class=\"line\">  - ä¼˜ç‚¹ï¼šä¸ä¼šæ–°å¢é¢å¤–çš„æäº¤è®°å½•ï¼Œå½¢æˆçº¿æ€§å†å²ï¼Œæ¯”è¾ƒç›´è§‚å’Œå¹²å‡€</span><br><span class=\"line\">  - ç¼ºç‚¹ï¼šä¼šæ”¹å˜æäº¤å†å²ï¼Œæ”¹å˜äº†å½“å‰åˆ†æ”¯branch outèŠ‚ç‚¹ï¼Œé¿å…åœ¨å…±äº«åˆ†æ”¯ä½¿ç”¨</span><br><span class=\"line\">  - ä¾‹å¦‚å½“å‰åœ¨mainåˆ†æ”¯ä¸‹ï¼š</span><br><span class=\"line\">    - `git rebase dev`ï¼šå°†mainåˆ†æ”¯çš„ä¿®æ”¹å«æ¥åˆ°devåˆ†æ”¯åé¢</span><br><span class=\"line\">    - ![img](https://raw.githubusercontent.com/lyydsheep/pic/main/202409151025165.png)</span><br><span class=\"line\">- `git merge`ï¼š</span><br><span class=\"line\">  - ä¼˜ç‚¹ï¼šä¸ä¼šç ´ååŸåˆ†æ”¯çš„æäº¤è®°å½•ï¼Œæ–¹ä¾¿å›æº¯å’ŒæŸ¥çœ‹</span><br><span class=\"line\">  - ç¼ºç‚¹ï¼šä¼šäº§ç”Ÿé¢å¤–çš„æäº¤èŠ‚ç‚¹ï¼Œåˆ†æ”¯å›¾æ¯”è¾ƒå¤æ‚</span><br><span class=\"line\">  - ä¾‹å¦‚å½“å‰åœ¨mainåˆ†æ”¯ä¸‹ï¼š</span><br><span class=\"line\">    - `gie merge dev`ï¼šåˆå¹¶devåˆ†æ”¯çš„ä¿®æ”¹</span><br><span class=\"line\"></span><br><span class=\"line\"># Gitå’ŒGitHubæ“ä½œæŒ‡å—</span><br><span class=\"line\"></span><br><span class=\"line\">## åˆå§‹åŒ–ä»“åº“å¹¶ç®€å•é…ç½®</span><br><span class=\"line\"></span><br><span class=\"line\">&gt; å¯¹ä»“åº“è¿›è¡Œåˆå§‹åŒ–</span><br><span class=\"line\"></span><br><span class=\"line\">- ä½¿ç”¨`git init`å®Œæˆå¯¹ä»“åº“çš„åˆå§‹åŒ–æ“ä½œ</span><br><span class=\"line\"></span><br><span class=\"line\">&gt; å¯¹ä»“åº“è¿›è¡Œç®€å•é…ç½®</span><br><span class=\"line\"></span><br><span class=\"line\">- ä½¿ç”¨`git config --global user.name &quot;lyydsheep&quot;`è®¾ç½®ä»“åº“çš„ç”¨æˆ·å</span><br><span class=\"line\">- åŒæ ·åœ°ï¼Œå¯ä»¥ä¸ºä»“åº“é…ç½®é‚®ç®±`git config --global user.email &quot;2230561977@qq.com&quot;`</span><br><span class=\"line\">  - é€šè¿‡å‘½ä»¤`git config --global --list `å°±å¯ä»¥**æŸ¥çœ‹**æˆ‘ä»¬ä¸ºè¯¥ä»“åº“è¿›è¡Œçš„é…ç½®</span><br><span class=\"line\"></span><br><span class=\"line\">å…³äº`system`ã€ `global`ã€`local`</span><br><span class=\"line\"></span><br><span class=\"line\">- system-ç³»ç»Ÿçº§: åœ¨gitå®‰è£…ä»¥åï¼Œgitçš„é»˜è®¤é…ç½®é¡¹éƒ½åœ¨è¿™é‡Œ</span><br><span class=\"line\">- global-å…¨å±€çº§ï¼šç™»å½•ç”¨æˆ·å…¨å±€çº§åˆ«çš„gité…ç½®</span><br><span class=\"line\">- local -ä»“åº“çº§: å¯¹ä¸åŒçš„ä»“åº“è¿›è¡Œè‡ªå®šä¹‰é…ç½®</span><br><span class=\"line\"></span><br><span class=\"line\">ä¸‰ä¸ªå…³é”®å­—æ‰€èƒ½é…ç½®çš„**å±æ€§é›†åˆæ˜¯ä¸€æ ·çš„ï¼Œ**ä¸åŒåœ¨äº**ä¼˜å…ˆçº§**</span><br><span class=\"line\"></span><br></pre></td></tr></table></figure>\n</code></pre>\n</li>\n</ul>\n</li>\n</ul>\n<p>local &gt; global &gt; system</p>\n<pre><code>\n&gt; ä¸ºä»“åº“åˆ›å»ºä¸€ä¸ªåˆ†æ”¯\n\n- ä½¿ç”¨`git branch -M main`å°±èƒ½ä¸ºä»“åº“åˆ›å»ºä¸€ä¸ªmainåˆ†æ”¯\n\n## æœ€ç®€å•çš„Gitå·¥ä½œæµç¨‹ï¼šå·¥ä½œåŒºã€æš‚å­˜åŒºã€ä»“åº“\n\n**ç›¸å…³å‘½ä»¤**\n\n- Git statusï¼šç”¨äºæŸ¥çœ‹å½“å‰ä»“åº“çš„çŠ¶æ€\n- Git add filename:å°†filenameæ–‡ä»¶æ·»åŠ è‡³æš‚å­˜åŒº\n  - å•ä¸ªæ·»åŠ å¤ªæ…¢äº†ï¼Œä¸å¦‚ä½¿ç”¨`Git add .`å°†**æ‰€æœ‰**ä¿®æ”¹è¿‡çš„æ–‡ä»¶æ·»åŠ è‡³æš‚å­˜åŒº\n- Git commit -m &quot;comment&quot;:å°†æš‚å­˜åŒºçš„æ–‡ä»¶æäº¤è‡³ä»“åº“ä¸­\n  - -m &quot;comment&quot;:æ˜¯ä¸ºè¿™æ¬¡æäº¤è¿›è¡Œæ³¨é‡Š\n- Git log:æŸ¥çœ‹å†å²æäº¤è®°å½•\n\n&gt; å‘½ä»¤ä¸æ–‡ä»¶çŠ¶æ€å˜åŒ–è¿‡ç¨‹\n\n![img](https://raw.githubusercontent.com/lyydsheep/pic/main/202409151024558.png)\n\n## å°†æœ¬åœ°ä»“åº“åŒæ­¥åˆ°è¿œç¨‹GitHubä»“åº“\n\nä¸ºä»€ä¹ˆé€‰æ‹©`SSH`åè®®è€Œä¸æ˜¯`HTTPS`åè®®ï¼Ÿ\n\n- ä½¿ç”¨`HTTPS`åè®®å¯èƒ½åœ¨æ—¥åä½¿ç”¨è¿‡ç¨‹ä¸­éœ€è¦**å¤šæ¬¡**è¾“å…¥ç”¨æˆ·åå’Œå¯†ç ï¼Œè¾ƒéº»çƒ¦\n- `SSH`åè®®**ä»…éœ€ç¬¬ä¸€æ¬¡**é…ç½®å¥½å…¬ç§é’¥ï¼Œä»Šåå°±æ— éœ€å†è¾“å…¥ç”¨æˆ·åå’Œå¯†ç \n\nå…·ä½“æ­¥éª¤ï¼š\n\n1. ä¸ºæœ¬åœ°ä»“åº“åˆ›å»ºä¸€ä¸ªè¿œç¨‹çš„GitHubä»“åº“ \n   - åœ¨GitHubç½‘é¡µä¸Šnewä¸€ä¸ªä»“åº“\n   - é€šè¿‡`git remote add origin ``git@github.com``:lyydsheep/learn_gogogogo.git`å‘½ä»¤å¯ä»¥å°†æœ¬åœ°ä»“åº“å’Œè¿œç¨‹ä»“åº“è¿›è¡Œå…³è”\n   -  ä½¿ç”¨`git remote`å¯ä»¥æŸ¥çœ‹è¿œç¨‹ä»“åº“çš„åç§°\n2. é…ç½®å…¬ç§é’¥ï¼Œè·å–`push`è¿œç¨‹ä»“åº“çš„æƒé™\n   -  ä½¿ç”¨`ssh-keygen -t rsa -C &quot;2230561977@qq.com&quot;`å‘½ä»¤ç”Ÿæˆå…¬ç§é’¥ \n   - å°†å…¬é’¥çš„å…·ä½“å†…å®¹å¤åˆ¶åˆ°`ssh and GPG keys`æ¨¡å—ä¸­\n     - `Settings` -&gt; `ssh and GPG keys` -&gt; `New SSH key`\n\n![img](https://raw.githubusercontent.com/lyydsheep/pic/main/202409151024035.png)\n\n![img](https://raw.githubusercontent.com/lyydsheep/pic/main/202409151024012.png)\n\n1. ä½¿ç”¨`git push -u origin main`å‘½ä»¤å°†æœ¬åœ°æ–‡ä»¶æ¨é€è‡³è¿œç¨‹ä»“åº“\n     - å‰ææ˜¯**æœ¬åœ°ä»“åº“è¦æœ‰**`main`**åˆ†æ”¯**\n\n\n![img](https://raw.githubusercontent.com/lyydsheep/pic/main/202409151024373.png)\n\n[åœ¨Golandä¸­ä½¿ç”¨Gitè¿›è¡Œåä½œå¼€å‘çš„æµç¨‹ | é’è®­è¥ç¬”è®° - æ˜é‡‘](https://juejin.cn/post/7196266492269199419)\n\n**go** mod init åº”ç”¨åç§° å°±æ˜¯åœ¨åº”ç”¨åç§°çš„æ ¹ç›®å½•ä¸‹ï¼Œç”Ÿæˆä¸€ä¸ª**go**.modæ–‡ä»¶ã€‚\n\n![img](https://raw.githubusercontent.com/lyydsheep/pic/main/202409151024647.png)\n</code></pre>\n","excerpt":"","more":"<h1 id=\"GitåŸºç¡€\"><a href=\"#GitåŸºç¡€\" class=\"headerlink\" title=\"GitåŸºç¡€\"></a>GitåŸºç¡€</h1><blockquote>\n<p>æ¨èä¸¤ä¸ªå­¦ä¹ Gitçš„ç½‘ç«™</p>\n<p><a href=\"https://learngitbranching.js.org/?locale=zh_CN\">Gitåœ¨çº¿ç»ƒä¹ </a></p>\n<p><a href=\"https://www.bilibili.com/video/BV1HM411377j/?spm_id_from=333.337.search-card.all.click&vd_source=a15269894d9b8114cb5f9bb663d22be9\">Gitç§‘æ™®è§†é¢‘</a></p>\n<p>â€œæƒŸæ‰‹ç†Ÿå°”â€</p>\n</blockquote>\n<h2 id=\"æœ€å°é…ç½®\"><a href=\"#æœ€å°é…ç½®\" class=\"headerlink\" title=\"æœ€å°é…ç½®\"></a>æœ€å°é…ç½®</h2><ul>\n<li><p>é…ç½®userä¿¡æ¯</p>\n<ul>\n<li><p>é…ç½®user.name:<code>git config --global user.name &#39;lyydsheep&#39;</code></p>\n</li>\n<li><p>é…ç½®user.email:<code>git config --global user.email &#39;2230561977@qq.com&#39;</code></p>\n</li>\n<li><pre><code class=\"Go\">//æ˜¾ç¤ºä¸åŒçº§åˆ«çš„é…ç½®ä¿¡æ¯\ngit config --list --local\ngit config --list --global\ngit config --list --system\n<figure class=\"highlight plaintext\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br><span class=\"line\">31</span><br><span class=\"line\">32</span><br><span class=\"line\">33</span><br><span class=\"line\">34</span><br><span class=\"line\">35</span><br><span class=\"line\">36</span><br><span class=\"line\">37</span><br><span class=\"line\">38</span><br><span class=\"line\">39</span><br><span class=\"line\">40</span><br><span class=\"line\">41</span><br><span class=\"line\">42</span><br><span class=\"line\">43</span><br><span class=\"line\">44</span><br><span class=\"line\">45</span><br><span class=\"line\">46</span><br><span class=\"line\">47</span><br><span class=\"line\">48</span><br><span class=\"line\">49</span><br><span class=\"line\">50</span><br><span class=\"line\">51</span><br><span class=\"line\">52</span><br><span class=\"line\">53</span><br><span class=\"line\">54</span><br><span class=\"line\">55</span><br><span class=\"line\">56</span><br><span class=\"line\">57</span><br><span class=\"line\">58</span><br><span class=\"line\">59</span><br><span class=\"line\">60</span><br><span class=\"line\">61</span><br><span class=\"line\">62</span><br><span class=\"line\">63</span><br><span class=\"line\">64</span><br><span class=\"line\">65</span><br><span class=\"line\">66</span><br><span class=\"line\">67</span><br><span class=\"line\">68</span><br><span class=\"line\">69</span><br><span class=\"line\">70</span><br><span class=\"line\">71</span><br><span class=\"line\">72</span><br><span class=\"line\">73</span><br><span class=\"line\">74</span><br><span class=\"line\">75</span><br><span class=\"line\">76</span><br><span class=\"line\">77</span><br><span class=\"line\">78</span><br><span class=\"line\">79</span><br><span class=\"line\">80</span><br><span class=\"line\">81</span><br><span class=\"line\">82</span><br><span class=\"line\">83</span><br><span class=\"line\">84</span><br><span class=\"line\">85</span><br><span class=\"line\">86</span><br><span class=\"line\">87</span><br><span class=\"line\">88</span><br><span class=\"line\">89</span><br><span class=\"line\">90</span><br><span class=\"line\">91</span><br><span class=\"line\">92</span><br><span class=\"line\">93</span><br><span class=\"line\">94</span><br><span class=\"line\">95</span><br><span class=\"line\">96</span><br><span class=\"line\">97</span><br><span class=\"line\">98</span><br><span class=\"line\">99</span><br><span class=\"line\">100</span><br><span class=\"line\">101</span><br><span class=\"line\">102</span><br><span class=\"line\">103</span><br><span class=\"line\">104</span><br><span class=\"line\">105</span><br><span class=\"line\">106</span><br><span class=\"line\">107</span><br><span class=\"line\">108</span><br><span class=\"line\">109</span><br><span class=\"line\">110</span><br><span class=\"line\">111</span><br><span class=\"line\">112</span><br><span class=\"line\">113</span><br><span class=\"line\">114</span><br><span class=\"line\">115</span><br><span class=\"line\">116</span><br><span class=\"line\">117</span><br><span class=\"line\">118</span><br><span class=\"line\">119</span><br><span class=\"line\">120</span><br><span class=\"line\">121</span><br><span class=\"line\">122</span><br><span class=\"line\">123</span><br><span class=\"line\">124</span><br><span class=\"line\">125</span><br><span class=\"line\">126</span><br><span class=\"line\">127</span><br><span class=\"line\">128</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"></span><br><span class=\"line\">## æ–°å»ºä»“åº“</span><br><span class=\"line\"></span><br><span class=\"line\">åœ¨gitä¸­æœ‰ä¸¤ç§æ–°å»ºä»“åº“çš„æ–¹å¼</span><br><span class=\"line\"></span><br><span class=\"line\">- `git init`ï¼šåœ¨æœ¬åœ°æ–°å»ºä¸€ä¸ªä»“åº“</span><br><span class=\"line\">- `git clone url`ï¼šä»è¿œç¨‹æœåŠ¡å™¨ä¸Šå…‹éš†ä¸€ä¸ªä»“åº“</span><br><span class=\"line\"></span><br><span class=\"line\">## å·¥ä½œåŒºå’Œç¼“å­˜åŒº</span><br><span class=\"line\"></span><br><span class=\"line\">![image-20240915102716820](https://raw.githubusercontent.com/lyydsheep/pic/main/202409151027874.png)</span><br><span class=\"line\"></span><br><span class=\"line\">## æ·»åŠ å’Œæäº¤æ–‡ä»¶</span><br><span class=\"line\"></span><br><span class=\"line\">- `git status`ï¼šæŸ¥çœ‹ä»“åº“çŠ¶æ€</span><br><span class=\"line\">- `git add`ï¼šæ·»åŠ åˆ°æš‚å­˜åŒº</span><br><span class=\"line\">    - å¯ä»¥ä½¿ç”¨é€šé…ç¬¦ï¼š`git add *.txt`</span><br><span class=\"line\">    - ä¹Ÿå¯ä»¥ä½¿ç”¨ç›®å½•ï¼š`git add .`</span><br><span class=\"line\">- `git commit`ï¼šåªæäº¤**æš‚å­˜åŒº**ä¸­çš„å†…å®¹ï¼Œä¸ä¼šæäº¤**å·¥ä½œåŒº**çš„å†…å®¹</span><br><span class=\"line\">- `git log`ï¼šæŸ¥çœ‹ä»“åº“å†å²æäº¤è®°å½•</span><br><span class=\"line\">    - `git log --oneline`ï¼šç®€æ´åœ°å‘ˆç°æ—¥å¿—</span><br><span class=\"line\"></span><br><span class=\"line\">## git resetå›é€€ç‰ˆæœ¬</span><br><span class=\"line\"></span><br><span class=\"line\">ä½¿ç”¨`git reset`å‘½ä»¤å¯ä»¥å›é€€åˆ°æŒ‡å®šçš„æäº¤ç‰ˆæœ¬ï¼Œ`git reset`æœ‰ä¸‰ç§æ¨¡å¼</span><br><span class=\"line\"></span><br><span class=\"line\">- `git reset --soft xxx`ï¼šå›é€€åˆ°xxxç‰ˆæœ¬ï¼Œä¸”ä¿å­˜xxxç‰ˆæœ¬ä¹‹åçš„å·¥ä½œåŒºå’Œæš‚å­˜åŒºçš„ä¿®æ”¹</span><br><span class=\"line\">- `git reset --hard xxx`ï¼šå›é€€åˆ°xxxç‰ˆæœ¬ï¼Œå¹¶åˆ é™¤xxxç‰ˆæœ¬ä¹‹åå·¥ä½œåŒºå’Œæš‚å­˜åŒºçš„ä¿®æ”¹</span><br><span class=\"line\">- `git reset --mixed xxx`ï¼šå›é€€åˆ°xxxç‰ˆæœ¬ï¼Œåªä¿ç•™xxxç‰ˆæœ¬ä¹‹åå·¥ä½œåŒºçš„ä¿®æ”¹</span><br><span class=\"line\"></span><br><span class=\"line\">![img](https://raw.githubusercontent.com/lyydsheep/pic/main/202409151025720.png)</span><br><span class=\"line\"></span><br><span class=\"line\">## ä½¿ç”¨git diffæŸ¥çœ‹å·®å¼‚</span><br><span class=\"line\"></span><br><span class=\"line\">- `git diff`å‘½ä»¤å¯ä»¥å¯¹ä¸¤ä¸ªä¸œè¥¿è¿›è¡Œæ¯”è¾ƒï¼Œç”¨äºæŸ¥çœ‹å·®å¼‚</span><br><span class=\"line\">  - å¯ä»¥æ˜¯å·¥ä½œåŒºã€æš‚å­˜åŒºã€æœ¬åœ°ä»“åº“ä¹‹é—´çš„å·®å¼‚</span><br><span class=\"line\">  - å¯ä»¥æ˜¯ä¸åŒç‰ˆæœ¬ä¹‹é—´çš„å·®å¼‚</span><br><span class=\"line\">  - ä¹Ÿå¯ä»¥æ˜¯ä¸åŒåˆ†æ”¯ä¹‹é—´çš„å·®å¼‚</span><br><span class=\"line\"></span><br><span class=\"line\">![img](https://raw.githubusercontent.com/lyydsheep/pic/main/202409151024958.png)</span><br><span class=\"line\"></span><br><span class=\"line\">- `git diff`ï¼šé»˜è®¤æŸ¥**çœ‹å·¥ä½œåŒº**å’Œ**æš‚å­˜åŒº**ä¹‹é—´çš„å·®å¼‚</span><br><span class=\"line\">- `git diff HEAD`ï¼šæŸ¥çœ‹**å·¥ä½œåŒºã€æš‚å­˜åŒº**å’Œ**æœ¬åœ°ä»“åº“**çš„å·®å¼‚</span><br><span class=\"line\">- `git diff cached`ï¼šæŸ¥çœ‹**æš‚å­˜åŒº**å’Œ**æœ¬åœ°ä»“åº“**ä¹‹é—´çš„å·®å¼‚</span><br><span class=\"line\">- `git diff &lt;commit_hash&gt; &lt;commit_hash&gt;`æˆ–è€…`git diff HEAD~ HEAD`ï¼šæŸ¥çœ‹**ä¸åŒæäº¤**ä¹‹é—´çš„å·®å¼‚</span><br><span class=\"line\">- `git diff &lt;branch_name&gt; &lt;branch_name&gt;`ï¼šæ¯”è¾ƒ**ä¸åŒåˆ†æ”¯**ä¹‹é—´çš„å·®å¼‚</span><br><span class=\"line\"></span><br><span class=\"line\">![img](https://raw.githubusercontent.com/lyydsheep/pic/main/202409151025464.png)</span><br><span class=\"line\"></span><br><span class=\"line\">## ä½¿ç”¨git rmåˆ é™¤æ–‡ä»¶</span><br><span class=\"line\"></span><br><span class=\"line\">- `git rm &lt;file_name&gt;`ï¼š**ä¸€æ¬¡æ€§å°†æ–‡ä»¶ä»å·¥ä½œåŒºå’Œæš‚å­˜åŒºä¸­åˆ é™¤**</span><br><span class=\"line\"></span><br><span class=\"line\">![img](https://raw.githubusercontent.com/lyydsheep/pic/main/202409151025557.png)</span><br><span class=\"line\"></span><br><span class=\"line\">## .gitignoreå¿½ç•¥æ–‡ä»¶</span><br><span class=\"line\"></span><br><span class=\"line\">åœ¨.gitignoreæ–‡ä»¶ä¸­å†™å…¥åŒ¹é…ç¬¦ï¼Œgitä¼šå¿½ç•¥å¯¹è¢«åŒ¹é…ä¸Šçš„æ–‡ä»¶çš„ç®¡ç†</span><br><span class=\"line\"></span><br><span class=\"line\">## SSHé…ç½®å’Œå…‹éš†ä»“åº“</span><br><span class=\"line\"></span><br><span class=\"line\">[å¦‚ä½•åœ¨åŒä¸€ç”µè„‘ä¸Šç”Ÿæˆé…ç½®å¤šä¸ªssh key å…¬é’¥ ç§é’¥ï¼ˆä¿å§†çº§æ•™ç¨‹ï¼‰](https://juejin.cn/post/7085718883079815176)</span><br><span class=\"line\"></span><br><span class=\"line\">- åœ¨`.ssh`æ–‡ä»¶å¤¹ä¸‹ï¼Œä½¿ç”¨`ssh-keygen -t rsa -b 4096`ç”Ÿæˆç§é’¥æ–‡ä»¶å’Œå…¬é’¥æ–‡ä»¶</span><br><span class=\"line\">  - å°†å…¬é’¥æ–‡ä»¶çš„ä¿¡æ¯é…ç½®åˆ°GitHubä¸Š</span><br><span class=\"line\">  - ä¿å­˜å¥½ç§é’¥æ–‡ä»¶ä¸­çš„ä¿¡æ¯</span><br><span class=\"line\">- `git clone repo-address`ï¼šå…‹éš†ä¸€ä¸ªè¿œç¨‹ä»“åº“</span><br><span class=\"line\">- `git push &lt;remote&gt; &lt;branch&gt;`ï¼šæ¨é€æ›´æ–°å†…å®¹</span><br><span class=\"line\">- `git pull &lt;remote&gt;`ï¼šæ‹‰å–æ›´æ–°å†…å®¹</span><br><span class=\"line\"></span><br><span class=\"line\">## å…³è”æœ¬åœ°ä»“åº“å’Œè¿œç¨‹ä»“åº“</span><br><span class=\"line\"></span><br><span class=\"line\">- æ·»åŠ è¿œç¨‹ä»“åº“</span><br><span class=\"line\">  - `git remote add è¿œç¨‹ä»“åº“å è¿œç¨‹ä»“åº“åœ°å€`</span><br><span class=\"line\">  - `git push -u è¿œç¨‹ä»“åº“å è¿œç¨‹ä»“åº“åˆ†æ”¯`</span><br><span class=\"line\">- æŸ¥çœ‹è¿œç¨‹ä»“åº“</span><br><span class=\"line\">  - `git remote -v`</span><br><span class=\"line\">- æ‹‰å–è¿œç¨‹ä»“åº“å†…å®¹</span><br><span class=\"line\">  - `git pull è¿œç¨‹ä»“åº“å è¿œç¨‹ä»“åº“åˆ†æ”¯:æœ¬åœ°ä»“åº“åˆ†æ”¯`</span><br><span class=\"line\"></span><br><span class=\"line\">## åˆ†æ”¯åŸºæœ¬æ“ä½œ</span><br><span class=\"line\"></span><br><span class=\"line\">- æŸ¥çœ‹åˆ†æ”¯åˆ—è¡¨ï¼š`git branch`</span><br><span class=\"line\">- åˆ›å»ºåˆ†æ”¯ï¼š`git branch &lt;name&gt;`</span><br><span class=\"line\">- åˆ‡æ¢åˆ†æ”¯ï¼š`git switch &lt;name&gt;`</span><br><span class=\"line\">- åˆå¹¶åˆ†æ”¯ï¼š`git merge &lt;name&gt;`ï¼Œå°†`&lt;name&gt;`åˆ†æ”¯åˆå¹¶åˆ°å½“å‰çš„åˆ†æ”¯</span><br><span class=\"line\">- åˆ é™¤åˆ†æ”¯ï¼š</span><br><span class=\"line\">  - `git branch -d &lt;name&gt;`ï¼šåˆ é™¤å·²åˆå¹¶çš„åˆ†æ”¯</span><br><span class=\"line\">  - `git branch -D &lt;name&gt;`ï¼šå¼ºåˆ¶åˆ é™¤åˆ†æ”¯</span><br><span class=\"line\"></span><br><span class=\"line\"></span><br><span class=\"line\"></span><br><span class=\"line\">## rebaseå’Œmerge</span><br><span class=\"line\"></span><br><span class=\"line\">- `git rebase`ï¼š</span><br><span class=\"line\">  - ä¼˜ç‚¹ï¼šä¸ä¼šæ–°å¢é¢å¤–çš„æäº¤è®°å½•ï¼Œå½¢æˆçº¿æ€§å†å²ï¼Œæ¯”è¾ƒç›´è§‚å’Œå¹²å‡€</span><br><span class=\"line\">  - ç¼ºç‚¹ï¼šä¼šæ”¹å˜æäº¤å†å²ï¼Œæ”¹å˜äº†å½“å‰åˆ†æ”¯branch outèŠ‚ç‚¹ï¼Œé¿å…åœ¨å…±äº«åˆ†æ”¯ä½¿ç”¨</span><br><span class=\"line\">  - ä¾‹å¦‚å½“å‰åœ¨mainåˆ†æ”¯ä¸‹ï¼š</span><br><span class=\"line\">    - `git rebase dev`ï¼šå°†mainåˆ†æ”¯çš„ä¿®æ”¹å«æ¥åˆ°devåˆ†æ”¯åé¢</span><br><span class=\"line\">    - ![img](https://raw.githubusercontent.com/lyydsheep/pic/main/202409151025165.png)</span><br><span class=\"line\">- `git merge`ï¼š</span><br><span class=\"line\">  - ä¼˜ç‚¹ï¼šä¸ä¼šç ´ååŸåˆ†æ”¯çš„æäº¤è®°å½•ï¼Œæ–¹ä¾¿å›æº¯å’ŒæŸ¥çœ‹</span><br><span class=\"line\">  - ç¼ºç‚¹ï¼šä¼šäº§ç”Ÿé¢å¤–çš„æäº¤èŠ‚ç‚¹ï¼Œåˆ†æ”¯å›¾æ¯”è¾ƒå¤æ‚</span><br><span class=\"line\">  - ä¾‹å¦‚å½“å‰åœ¨mainåˆ†æ”¯ä¸‹ï¼š</span><br><span class=\"line\">    - `gie merge dev`ï¼šåˆå¹¶devåˆ†æ”¯çš„ä¿®æ”¹</span><br><span class=\"line\"></span><br><span class=\"line\"># Gitå’ŒGitHubæ“ä½œæŒ‡å—</span><br><span class=\"line\"></span><br><span class=\"line\">## åˆå§‹åŒ–ä»“åº“å¹¶ç®€å•é…ç½®</span><br><span class=\"line\"></span><br><span class=\"line\">&gt; å¯¹ä»“åº“è¿›è¡Œåˆå§‹åŒ–</span><br><span class=\"line\"></span><br><span class=\"line\">- ä½¿ç”¨`git init`å®Œæˆå¯¹ä»“åº“çš„åˆå§‹åŒ–æ“ä½œ</span><br><span class=\"line\"></span><br><span class=\"line\">&gt; å¯¹ä»“åº“è¿›è¡Œç®€å•é…ç½®</span><br><span class=\"line\"></span><br><span class=\"line\">- ä½¿ç”¨`git config --global user.name &quot;lyydsheep&quot;`è®¾ç½®ä»“åº“çš„ç”¨æˆ·å</span><br><span class=\"line\">- åŒæ ·åœ°ï¼Œå¯ä»¥ä¸ºä»“åº“é…ç½®é‚®ç®±`git config --global user.email &quot;2230561977@qq.com&quot;`</span><br><span class=\"line\">  - é€šè¿‡å‘½ä»¤`git config --global --list `å°±å¯ä»¥**æŸ¥çœ‹**æˆ‘ä»¬ä¸ºè¯¥ä»“åº“è¿›è¡Œçš„é…ç½®</span><br><span class=\"line\"></span><br><span class=\"line\">å…³äº`system`ã€ `global`ã€`local`</span><br><span class=\"line\"></span><br><span class=\"line\">- system-ç³»ç»Ÿçº§: åœ¨gitå®‰è£…ä»¥åï¼Œgitçš„é»˜è®¤é…ç½®é¡¹éƒ½åœ¨è¿™é‡Œ</span><br><span class=\"line\">- global-å…¨å±€çº§ï¼šç™»å½•ç”¨æˆ·å…¨å±€çº§åˆ«çš„gité…ç½®</span><br><span class=\"line\">- local -ä»“åº“çº§: å¯¹ä¸åŒçš„ä»“åº“è¿›è¡Œè‡ªå®šä¹‰é…ç½®</span><br><span class=\"line\"></span><br><span class=\"line\">ä¸‰ä¸ªå…³é”®å­—æ‰€èƒ½é…ç½®çš„**å±æ€§é›†åˆæ˜¯ä¸€æ ·çš„ï¼Œ**ä¸åŒåœ¨äº**ä¼˜å…ˆçº§**</span><br><span class=\"line\"></span><br></pre></td></tr></table></figure>\n</code></pre>\n</li>\n</ul>\n</li>\n</ul>\n<p>local &gt; global &gt; system</p>\n<pre><code>\n&gt; ä¸ºä»“åº“åˆ›å»ºä¸€ä¸ªåˆ†æ”¯\n\n- ä½¿ç”¨`git branch -M main`å°±èƒ½ä¸ºä»“åº“åˆ›å»ºä¸€ä¸ªmainåˆ†æ”¯\n\n## æœ€ç®€å•çš„Gitå·¥ä½œæµç¨‹ï¼šå·¥ä½œåŒºã€æš‚å­˜åŒºã€ä»“åº“\n\n**ç›¸å…³å‘½ä»¤**\n\n- Git statusï¼šç”¨äºæŸ¥çœ‹å½“å‰ä»“åº“çš„çŠ¶æ€\n- Git add filename:å°†filenameæ–‡ä»¶æ·»åŠ è‡³æš‚å­˜åŒº\n  - å•ä¸ªæ·»åŠ å¤ªæ…¢äº†ï¼Œä¸å¦‚ä½¿ç”¨`Git add .`å°†**æ‰€æœ‰**ä¿®æ”¹è¿‡çš„æ–‡ä»¶æ·»åŠ è‡³æš‚å­˜åŒº\n- Git commit -m &quot;comment&quot;:å°†æš‚å­˜åŒºçš„æ–‡ä»¶æäº¤è‡³ä»“åº“ä¸­\n  - -m &quot;comment&quot;:æ˜¯ä¸ºè¿™æ¬¡æäº¤è¿›è¡Œæ³¨é‡Š\n- Git log:æŸ¥çœ‹å†å²æäº¤è®°å½•\n\n&gt; å‘½ä»¤ä¸æ–‡ä»¶çŠ¶æ€å˜åŒ–è¿‡ç¨‹\n\n![img](https://raw.githubusercontent.com/lyydsheep/pic/main/202409151024558.png)\n\n## å°†æœ¬åœ°ä»“åº“åŒæ­¥åˆ°è¿œç¨‹GitHubä»“åº“\n\nä¸ºä»€ä¹ˆé€‰æ‹©`SSH`åè®®è€Œä¸æ˜¯`HTTPS`åè®®ï¼Ÿ\n\n- ä½¿ç”¨`HTTPS`åè®®å¯èƒ½åœ¨æ—¥åä½¿ç”¨è¿‡ç¨‹ä¸­éœ€è¦**å¤šæ¬¡**è¾“å…¥ç”¨æˆ·åå’Œå¯†ç ï¼Œè¾ƒéº»çƒ¦\n- `SSH`åè®®**ä»…éœ€ç¬¬ä¸€æ¬¡**é…ç½®å¥½å…¬ç§é’¥ï¼Œä»Šåå°±æ— éœ€å†è¾“å…¥ç”¨æˆ·åå’Œå¯†ç \n\nå…·ä½“æ­¥éª¤ï¼š\n\n1. ä¸ºæœ¬åœ°ä»“åº“åˆ›å»ºä¸€ä¸ªè¿œç¨‹çš„GitHubä»“åº“ \n   - åœ¨GitHubç½‘é¡µä¸Šnewä¸€ä¸ªä»“åº“\n   - é€šè¿‡`git remote add origin ``git@github.com``:lyydsheep/learn_gogogogo.git`å‘½ä»¤å¯ä»¥å°†æœ¬åœ°ä»“åº“å’Œè¿œç¨‹ä»“åº“è¿›è¡Œå…³è”\n   -  ä½¿ç”¨`git remote`å¯ä»¥æŸ¥çœ‹è¿œç¨‹ä»“åº“çš„åç§°\n2. é…ç½®å…¬ç§é’¥ï¼Œè·å–`push`è¿œç¨‹ä»“åº“çš„æƒé™\n   -  ä½¿ç”¨`ssh-keygen -t rsa -C &quot;2230561977@qq.com&quot;`å‘½ä»¤ç”Ÿæˆå…¬ç§é’¥ \n   - å°†å…¬é’¥çš„å…·ä½“å†…å®¹å¤åˆ¶åˆ°`ssh and GPG keys`æ¨¡å—ä¸­\n     - `Settings` -&gt; `ssh and GPG keys` -&gt; `New SSH key`\n\n![img](https://raw.githubusercontent.com/lyydsheep/pic/main/202409151024035.png)\n\n![img](https://raw.githubusercontent.com/lyydsheep/pic/main/202409151024012.png)\n\n1. ä½¿ç”¨`git push -u origin main`å‘½ä»¤å°†æœ¬åœ°æ–‡ä»¶æ¨é€è‡³è¿œç¨‹ä»“åº“\n     - å‰ææ˜¯**æœ¬åœ°ä»“åº“è¦æœ‰**`main`**åˆ†æ”¯**\n\n\n![img](https://raw.githubusercontent.com/lyydsheep/pic/main/202409151024373.png)\n\n[åœ¨Golandä¸­ä½¿ç”¨Gitè¿›è¡Œåä½œå¼€å‘çš„æµç¨‹ | é’è®­è¥ç¬”è®° - æ˜é‡‘](https://juejin.cn/post/7196266492269199419)\n\n**go** mod init åº”ç”¨åç§° å°±æ˜¯åœ¨åº”ç”¨åç§°çš„æ ¹ç›®å½•ä¸‹ï¼Œç”Ÿæˆä¸€ä¸ª**go**.modæ–‡ä»¶ã€‚\n\n![img](https://raw.githubusercontent.com/lyydsheep/pic/main/202409151024647.png)\n</code></pre>\n"},{"title":"goroutineã€channel","publish":true,"description":"è®°å½•ä¸€äº›æœ‰å…³goroutineçš„çŸ¥è¯†ç‚¹","date":"2024-09-26T16:00:00.000Z","sticky":2,"_content":"\n# goroutine\n\ngoroutineæ˜¯Goè¯­è¨€ä¸­çš„è½»é‡çº§çº¿ç¨‹çš„å®ç°ï¼Œç”±**Goè¿è¡Œæ—¶ç®¡ç†**ï¼Œæ˜¯Goç¨‹åºä¸­æœ€å°çš„å¹¶å‘æ‰§è¡Œå•ä½ã€‚å¹¶ä¸”ä¼ ç»Ÿæ„ä¹‰ä¸Šçš„åç¨‹æ˜¯ä¸æ”¯æŒå¹¶å‘çš„ï¼Œè€Œ**goroutineæ”¯æŒå¹¶å‘**ï¼ŒåŒæ—¶goroutineå¯ä»¥è¿è¡Œåœ¨ä¸€ä¸ªæˆ–å¤šä¸ªçº¿ç¨‹ä¸Š\n\n**goroutineå¤§å°ä¸º2kbï¼Œå¯ä»¥åŠ¨æ€å¢å¤§**\n\n## ç®€è¿°\n\n### goroutineçš„è¿è¡Œæœºåˆ¶\n\nåœ¨Goç¨‹åºä¸­ï¼Œ`main`å‡½æ•°æ˜¯ç¨‹åºçš„å…¥å£ï¼Œå½“ç¨‹åºå¼€å§‹æ‰§è¡Œ`main`å‡½æ•°æ—¶ï¼Œå°±ä¼šåˆ›å»ºä¸€ä¸ª**ä¸»goroutine**ï¼Œè¿™ä¸ªä¸»goroutineæ˜¯**å…¨å±€å”¯ä¸€çš„**å¹¶ä¸”ä»£è¡¨ç€æ•´ä¸ªGoç¨‹åºçš„ç”Ÿå‘½å‘¨æœŸ\n\nåœ¨ä»£ç ä¸­ï¼Œå¯ä»¥ä½¿ç”¨`go`å…³é”®å­—è½»æ¾åˆ›å»ºå‡ºä¸€ä¸ªgoroutine\n\nğŸŒ°ï¼š\n\n```go\nfunc sum(a, b int) {\n    println(a+b)\n}\n\nfunc main() {\n    go sum(1, 2)\n}\n```\n\nåœ¨ä¸Šè¿°ä»£ç ä¸­ï¼Œ**`go`å…³é”®å­—+å‡½æ•°è°ƒç”¨**è¡¨ç¤ºåˆ›å»ºä¸€ä¸ªgoroutineå¹¶åœ¨è¿™ä¸ªgoroutineä¸­è¿è¡Œ`sum`å‡½æ•°ã€‚ä½†ä¸Šè¿°ä»£ç çš„è¿è¡Œç»“æœå¹¶ä¸ä¼šç¬¦åˆæˆ‘ä»¬çš„é¢„æœŸï¼Œè¿™æ˜¯å› ä¸º**goroutineçš„è¿è¡Œæœºåˆ¶æ˜¯ï¼šåœ¨ä¸»Goroutineç»“æŸä¹‹åï¼Œå…¶ä»–æ‰€æœ‰çš„goroutineéƒ½ä¼šç›´æ¥é€€å‡º**ï¼Œä¸Šè¿°ä»£ç ä¸­çš„ä¸»goroutineç»“æŸçš„æ¯”å­goroutineæ›´å¿«ï¼Œæ‰€ä»¥æ§åˆ¶å°ä¼šæ²¡æœ‰ä»»ä½•è¾“å‡ºğŸ˜‚\n\n### goroutineçš„ç‰¹ç‚¹\n\n- æ˜¯ä¸€ç§è½»é‡çº§â€œçº¿ç¨‹â€ï¼Œç±»ä¼¼äºåç¨‹\n- **éæŠ¢å å¼ï¼ˆå³ä¸ä¼šè¢«ä¸­æ–­ï¼‰å¤šä»»åŠ¡å¤„ç†ï¼Œæœ‰åç¨‹ä¸»åŠ¨äº¤å‡ºè¿è¡ŒæƒåŠ›**\n- ç¼–è¯‘å™¨/è§£é‡Šå™¨/è™šæ‹Ÿæœºå±‚é¢çš„å¤šä»»åŠ¡ï¼ˆä¸æ‡‚ğŸ™ƒï¼‰\n- å¤šä¸ªåç¨‹å¯ä»¥åœ¨ä¸€ä¸ªæˆ–å¤šä¸ªçº¿ç¨‹ä¸Šè¿è¡Œ\n\nç”±äºgoroutineæ˜¯éæŠ¢å å¼çš„ï¼Œä¸€ä¸ªgoroutineå¯èƒ½ä¼šåœ¨ä¸€ä¸‹æ—¶æœºä¸»åŠ¨äº¤å‡ºè¿è¡ŒæƒåŠ›\n\n- I/Oï¼Œselect\n- channel\n- ç­‰å¾…é”\n- å‡½æ•°è°ƒç”¨\n- runtime.Gosched()\n\n### WaitGroupï¼šå¤šä¸ªgoroutineå¹¶å‘æ‰§è¡Œ\n\nå‰æ–‡é˜è¿°äº†å½“ä¸»goroutineç»“æŸä¹‹åï¼Œå…¶ä»–çš„goroutineéƒ½ä¼šè¢«å¼ºåˆ¶ç»“æŸã€‚ä½†æ˜¯å¾ˆå¤šæƒ…å†µä¸‹ï¼Œä¸»goroutineéœ€è¦åœ¨å…¶ä»–goroutineç»“æŸä¹‹åå†ç»“æŸï¼Œä¸€ç§å¾ˆç®€å•çš„æ–¹æ³•å°±æ˜¯è®©ä¸»goroutineç¡å‡ ç§’\n\n```go\ntime.Sleep(time.Second)\n```\n\nå¦ä¸€ç§æ›´ä¼˜é›…çš„æ–¹æ³•å°±æ˜¯ä½¿ç”¨`sync.WaitGroup`ç»“æ„ä½“ï¼Œå®ç°å¤šä¸ªgoroutineçš„åŒæ­¥\n\n`sync.WaitGroup`ç»“æ„ä½“æœ‰ä¸‰ä¸ªæ–¹æ³•\n\n- `Add(delta)`ï¼šå‘å†…éƒ¨è®¡æ•°å™¨ä¸­æ·»åŠ å¢é‡`delta`ï¼Œå…¶ä¸­`delta`å¯æ­£å¯è´Ÿ\n  - ä¸€èˆ¬åœ¨å¯åŠ¨goroutineä¹‹å‰è°ƒç”¨\n- `Done()`ï¼šä½¿å†…éƒ¨è®¡æ•°å™¨`-1`ï¼Œç›¸å½“äº`Add(-1)`\n  - ä¸€èˆ¬åœ¨goroutineå³å°†ç»“æŸæ—¶æ‰§è¡Œï¼Œå¯é…åˆ`defer`å…³é”®å­—å…±åŒä½¿ç”¨\n- `Wait()`ï¼šé˜»å¡å½“å‰goroutineç›´è‡³å†…éƒ¨è®¡æ•°å™¨å‡å°‘è‡³0\n\nâš ï¸ï¼šè°ƒç”¨`Wait()` å‡½æ•°å¯èƒ½å¯¼è‡´æ­»é”ï¼Œé€ æˆç¨‹åºå´©æºƒ\n\n## Goå¹¶å‘çš„å®ç°åŸç†\n\n> DO NOT COMMUNICATE BY SHARING MEMORY; INSTEAD, SHARE MEMORY BY COMMUNICATING. \n\nåœ¨Goä¸­æœ‰ä¸¤ç§å¹¶å‘å½¢å¼ï¼šä¼ ç»Ÿå…±äº«å†…å­˜çš„æ–¹å¼å’ŒCSPï¼ˆ`communicating sequential processes`ï¼‰å¹¶å‘æ¨¡å‹\n\n### å…±äº«å†…å­˜\n\nåœ¨å¤šä¸ªçº¿ç¨‹å…±äº«å†…å­˜ä»¥å…±äº«æ•°æ®çš„æ¨¡å¼ä¸‹ï¼Œé€šè¿‡**åŠ é”**å®ç°å¹¶å‘å®‰å…¨\n\nåœ¨Goä¸­æœ‰ä¸¤ç§é”ï¼š**äº’æ–¥é”ï¼ˆMutexï¼‰**ã€**è¯»å†™é”ï¼ˆRWMutexï¼‰**\n\nä¸¤ç§é”çš„ä½¿ç”¨æ–¹å¼å¦‚ä¸‹ï¼š\n\n```go\n// Mutex\n\tvar mux sync.Mutex\n\tmux.Lock()\n\t// do something\n\tmux.Unlock()\n\n// RWMutx\n\tvar mux sync.RWMutex\n\tmux.RLock()\n\t// å…è®¸å¤šä¸ªè¯»è€…\n\tmux.RUnlock()\n\tmux.Lock()\n\t// åªæœ‰ä¸€ä¸ªå†™è€…\n\tmux.Unlock()\n```\n\nåŒºåˆ«ï¼šåªæœ‰ä¸€ä¸ªgoroutineèƒ½æ‹¿åˆ°**äº’æ–¥é”**ï¼Œå…¶ä»–goroutineåˆ™ä¼šè¢«é˜»å¡ï¼›å…è®¸æœ‰å¤šä¸ªgoroutineæ‹¿åˆ°**è¯»é”**ï¼Œè€Œåªæœ‰ä¸€ä¸ªgoroutineèƒ½æ‹¿åˆ°**å†™é”**\n\nâš ï¸ï¼šå¦‚æœå°†å¸¦æœ‰é”ç»“æ„çš„å˜é‡èµ‹å€¼ç»™å…¶ä»–å˜é‡ï¼Œ**é”çš„çŠ¶æ€ä¼šè¢«å¤åˆ¶**\n\n```go\nfunc main() {\n\tvar mux sync.Mutex\n\tvar wg sync.WaitGroup\n\tdefer mux.Unlock()\n\tmux.Lock()\n\twg.Add(1)\n\tgo func(mux sync.Mutex) {\n\t\tdefer func() {\n\t\t\tmux.Unlock()\n\t\t\twg.Done()\n\t\t}()\n\t\tmux.Lock() // deadlock\n\t}(mux)\n\twg.Wait()\n}\n```\n\n\n\n### channel\n\nç®€å•åœ°è¯´ï¼Œchannelå°±æ˜¯**æ”¶å‘æ•°æ®çš„é€šé“**\n\nå£°æ˜ä¸€ä¸ªchannelè¦ä½¿ç”¨`make`å‡½æ•°è¿›è¡Œ**åˆå§‹åŒ–**ï¼Œå¦åˆ™å£°æ˜å‡ºæ¥çš„channelä¸º`nil`\n\n```go\nvar ch chan int\nvar ch [size]chan int\n\nch = make(chan int, size)\n```\n\n#### å¸¸è§çš„ä½¿ç”¨æ–¹æ³•\n\nğŸ•ï¼š\n\n```go\nch <- 1 // å†™å…¥ä¸€ä¸ªæ•°æ®\nv := <-ch // è¯»å–ä¸€ä¸ªæ•°æ®\n```\n\nâš ï¸ï¼šå¦‚æœchannelæ²¡æœ‰ç¼“å†²åŒºï¼Œé‚£ä¹ˆå†™æ•°æ®å’Œè¯»æ•°æ®å¿…å®šæ˜¯æˆå¯¹å‡ºç°çš„\n\n```go\nclose(ch) // å…³é—­é€šé“\n```\n\nå½“å…³é—­é€šé“ä¹‹åï¼Œ**ä¸èƒ½å†å‘é€šé“ä¸­å†™æ•°æ®ï¼Œä½†æ˜¯èƒ½ä»é€šé“ä¸­è¯»æ•°æ®ï¼Œå¦‚æœé€šé“ä¸­è¿˜æœ‰å€¼åˆ™è¯»å‡ºå¯¹åº”çš„å€¼ï¼Œå¦åˆ™è¯»å‡ºé›¶å€¼**\n\nè¿™å°±å¯¼è‡´ä¸€ä¸ªé—®é¢˜ï¼šå½“æˆ‘è¯»å‡ºé›¶å€¼æ—¶ï¼Œæ— æ³•åˆ¤æ–­å‡ºè¿™æ˜¯å› ä¸º**é€šé“å…³é—­è¿˜æ˜¯å†™å…¥çš„å€¼ç¡®ç¡®å®å®å°±æ˜¯é›¶å€¼**\n\nğŸ•‘ï¼šæ•…éœ€è¦ä½¿ç”¨é€šé“çš„**åˆ¤å®šè¯»æ³•**ï¼š\n\n```go\nval, ok := <-ch\nif ok {\n    fmt.Printf(\"get val %d\\n\", val)\n} else {\n    fmt.Println(\"closed\")\n}\n```\n\nå½“ç®¡é“å…³é—­ä¸”è¯»å–å®Œæ¯•åï¼Œokä¸º`false`\n\nğŸ•’ï¼šæœ‰çš„æ—¶å€™æŸä¸€ä¸ªgoroutineéœ€è¦ä¸€ç›´ç›‘å¬ç€ç®¡é“ä¸­çš„æ•°æ®ï¼Œåªè¦ç®¡é“ä¸­æœ‰æ•°æ®å°±ç«‹é©¬è¯»å–å‡ºæ¥ï¼Œç›´è‡³ç®¡é“å…³é—­\n\nåœ¨Goä¸­å¯ä»¥ä½¿ç”¨`fro range`åšåˆ°æŒç»­ç›‘å¬ç®¡é“ä¸­çš„æ•°æ®\n\n```go\nfunc main() {\n\tch := make(chan int)\n\tgo func() {\n\t\tfor v := range ch {\n\t\t\tfmt.Println(v)\n\t\t}\n\t}()\n\ttime.Sleep(time.Second)\n\tch <- 1\n\ttime.Sleep(time.Second)\n\tch <- 2\n\tclose(ch)\n\ttime.Sleep(time.Second)\n}\n```\n\n### åŒå‘channelå’Œå•å‘channel\n\nchannelå¯ä»¥æ ¹æ®å…¶åŠŸèƒ½åˆ’åˆ†ä¸º**åŒå‘channelå’Œå•å‘channel**ï¼Œå…¶ä¸­åŒå‘channelæ—¢å¯ä»¥è¯»åˆå¯ä»¥å†™ï¼Œè€Œå•å‘channelè¦ä¹ˆåªè¯»ï¼Œè¦ä¹ˆåªå†™\n\nå¯ä»¥é€šè¿‡**ç±»å‹åˆ«å**çš„æ–¹å¼å®šä¹‰å•å‘channel\n\nğŸŒ°ï¼š\n\n```go\ntype RChannel = <-chan int\ntype WChannel = chan<- int\n\nfunc main() {\n\tch := make(chan int)\n\tgo func() {\n\t\tvar w WChannel\n\t\tw = ch\n\t\tw <- 1\n\t}()\n\tgo func() {\n\t\tvar r RChannel\n\t\tr = ch\n\t\tfmt.Println(<-r)\n\t}()\n\ttime.Sleep(time.Second)\n}\n```\n\n### æœ‰ç¼“å†²channelå’Œæ— ç¼“å†²channel\n\næ— ç¼“å†²channelå¯ä»¥ç†è§£ä¸ºæ˜¯**åŒæ­¥æ¨¡å¼**ï¼Œå³ä¸€ä¸ªå†™ï¼Œå¦ä¸€ä¸ªç«‹é©¬è¯»ï¼Œå¦‚æœæ²¡æœ‰è¯»è€…ï¼Œå†™è€…ä¹Ÿä¼šè¢«é˜»å¡\n\næœ‰ç¼“å†²channelåˆ™å¯ä»¥ä½œä¸º**å¼‚æ­¥æ¨¡å¼**ï¼Œåœ¨ç¼“å†²åŒºæœªæ»¡çš„æƒ…å†µä¸‹ï¼Œå³ä½¿æ²¡æœ‰è¯»è€…ï¼Œå†™è€…ä¹Ÿèƒ½å‘é€šé“ä¸­å†™å…¥æ•°æ®\n\nä½†å½“ç¼“å†²åŒºæ»¡äº†åï¼Œå†™è€…æƒ³è¦ç»§ç»­å†™å…¥æ•°æ®åˆ™ä¼šè¢«é˜»å¡ï¼Œé€€åŒ–æˆ**åŒæ­¥æ¨¡å¼**\n\n### æ€»ç»“\n\n- å…³é—­ä¸€ä¸ªæœªåˆå§‹åŒ–çš„channelä¼šäº§ç”Ÿpanic\n- channelåªèƒ½å…³é—­ä¸€æ¬¡ï¼Œå¯¹åŒä¸€channelå¤šæ¬¡å…³é—­ä¼šå‘ç”Ÿpanic\n- å‘ä¸€ä¸ªå·²ç»å…³é—­çš„channelå†™å…¥æ•°æ®ï¼Œä¼šå‘ç”Ÿpanic\n- ä»ä¸€ä¸ªå·²ç»å…³é—­çš„channelè¯»å–æ•°æ®ï¼Œä¼šè¯»å‡ºç¼“å†²åŒºä¸­çš„å€¼ï¼Œå½“ç¼“å†²åŒºæ²¡æœ‰æ•°æ®ï¼ˆæˆ–æ²¡æœ‰ç¼“å†²åŒºï¼‰æ—¶ï¼Œåˆ™ä¼šè¯»å‡ºå¯¹åº”ç±»å‹çš„é›¶å€¼\n- channelçš„è¯»ç«¯å’Œå†™ç«¯éƒ½å¯ä»¥ç”±å¤šä¸ªgoroutineæ“ä½œï¼Œå½“å†™ç«¯è¢«ä¸€ä¸ªgoroutineå…³é—­æ—¶ï¼Œè¯»ç«¯çš„å¤šä¸ªgoroutineéƒ½ä¼šæ”¶åˆ°ç®¡é“å…³é—­çš„æ¶ˆæ¯\n- channelæ˜¯å¹¶å‘å®‰å…¨çš„\n","source":"_posts/goroutine.md","raw":"---\ntitle: goroutineã€channel\npublish: true\ndescription: è®°å½•ä¸€äº›æœ‰å…³goroutineçš„çŸ¥è¯†ç‚¹\ndate: 2024-09-27\ntag: Golang\nsticky: 2\n---\n\n# goroutine\n\ngoroutineæ˜¯Goè¯­è¨€ä¸­çš„è½»é‡çº§çº¿ç¨‹çš„å®ç°ï¼Œç”±**Goè¿è¡Œæ—¶ç®¡ç†**ï¼Œæ˜¯Goç¨‹åºä¸­æœ€å°çš„å¹¶å‘æ‰§è¡Œå•ä½ã€‚å¹¶ä¸”ä¼ ç»Ÿæ„ä¹‰ä¸Šçš„åç¨‹æ˜¯ä¸æ”¯æŒå¹¶å‘çš„ï¼Œè€Œ**goroutineæ”¯æŒå¹¶å‘**ï¼ŒåŒæ—¶goroutineå¯ä»¥è¿è¡Œåœ¨ä¸€ä¸ªæˆ–å¤šä¸ªçº¿ç¨‹ä¸Š\n\n**goroutineå¤§å°ä¸º2kbï¼Œå¯ä»¥åŠ¨æ€å¢å¤§**\n\n## ç®€è¿°\n\n### goroutineçš„è¿è¡Œæœºåˆ¶\n\nåœ¨Goç¨‹åºä¸­ï¼Œ`main`å‡½æ•°æ˜¯ç¨‹åºçš„å…¥å£ï¼Œå½“ç¨‹åºå¼€å§‹æ‰§è¡Œ`main`å‡½æ•°æ—¶ï¼Œå°±ä¼šåˆ›å»ºä¸€ä¸ª**ä¸»goroutine**ï¼Œè¿™ä¸ªä¸»goroutineæ˜¯**å…¨å±€å”¯ä¸€çš„**å¹¶ä¸”ä»£è¡¨ç€æ•´ä¸ªGoç¨‹åºçš„ç”Ÿå‘½å‘¨æœŸ\n\nåœ¨ä»£ç ä¸­ï¼Œå¯ä»¥ä½¿ç”¨`go`å…³é”®å­—è½»æ¾åˆ›å»ºå‡ºä¸€ä¸ªgoroutine\n\nğŸŒ°ï¼š\n\n```go\nfunc sum(a, b int) {\n    println(a+b)\n}\n\nfunc main() {\n    go sum(1, 2)\n}\n```\n\nåœ¨ä¸Šè¿°ä»£ç ä¸­ï¼Œ**`go`å…³é”®å­—+å‡½æ•°è°ƒç”¨**è¡¨ç¤ºåˆ›å»ºä¸€ä¸ªgoroutineå¹¶åœ¨è¿™ä¸ªgoroutineä¸­è¿è¡Œ`sum`å‡½æ•°ã€‚ä½†ä¸Šè¿°ä»£ç çš„è¿è¡Œç»“æœå¹¶ä¸ä¼šç¬¦åˆæˆ‘ä»¬çš„é¢„æœŸï¼Œè¿™æ˜¯å› ä¸º**goroutineçš„è¿è¡Œæœºåˆ¶æ˜¯ï¼šåœ¨ä¸»Goroutineç»“æŸä¹‹åï¼Œå…¶ä»–æ‰€æœ‰çš„goroutineéƒ½ä¼šç›´æ¥é€€å‡º**ï¼Œä¸Šè¿°ä»£ç ä¸­çš„ä¸»goroutineç»“æŸçš„æ¯”å­goroutineæ›´å¿«ï¼Œæ‰€ä»¥æ§åˆ¶å°ä¼šæ²¡æœ‰ä»»ä½•è¾“å‡ºğŸ˜‚\n\n### goroutineçš„ç‰¹ç‚¹\n\n- æ˜¯ä¸€ç§è½»é‡çº§â€œçº¿ç¨‹â€ï¼Œç±»ä¼¼äºåç¨‹\n- **éæŠ¢å å¼ï¼ˆå³ä¸ä¼šè¢«ä¸­æ–­ï¼‰å¤šä»»åŠ¡å¤„ç†ï¼Œæœ‰åç¨‹ä¸»åŠ¨äº¤å‡ºè¿è¡ŒæƒåŠ›**\n- ç¼–è¯‘å™¨/è§£é‡Šå™¨/è™šæ‹Ÿæœºå±‚é¢çš„å¤šä»»åŠ¡ï¼ˆä¸æ‡‚ğŸ™ƒï¼‰\n- å¤šä¸ªåç¨‹å¯ä»¥åœ¨ä¸€ä¸ªæˆ–å¤šä¸ªçº¿ç¨‹ä¸Šè¿è¡Œ\n\nç”±äºgoroutineæ˜¯éæŠ¢å å¼çš„ï¼Œä¸€ä¸ªgoroutineå¯èƒ½ä¼šåœ¨ä¸€ä¸‹æ—¶æœºä¸»åŠ¨äº¤å‡ºè¿è¡ŒæƒåŠ›\n\n- I/Oï¼Œselect\n- channel\n- ç­‰å¾…é”\n- å‡½æ•°è°ƒç”¨\n- runtime.Gosched()\n\n### WaitGroupï¼šå¤šä¸ªgoroutineå¹¶å‘æ‰§è¡Œ\n\nå‰æ–‡é˜è¿°äº†å½“ä¸»goroutineç»“æŸä¹‹åï¼Œå…¶ä»–çš„goroutineéƒ½ä¼šè¢«å¼ºåˆ¶ç»“æŸã€‚ä½†æ˜¯å¾ˆå¤šæƒ…å†µä¸‹ï¼Œä¸»goroutineéœ€è¦åœ¨å…¶ä»–goroutineç»“æŸä¹‹åå†ç»“æŸï¼Œä¸€ç§å¾ˆç®€å•çš„æ–¹æ³•å°±æ˜¯è®©ä¸»goroutineç¡å‡ ç§’\n\n```go\ntime.Sleep(time.Second)\n```\n\nå¦ä¸€ç§æ›´ä¼˜é›…çš„æ–¹æ³•å°±æ˜¯ä½¿ç”¨`sync.WaitGroup`ç»“æ„ä½“ï¼Œå®ç°å¤šä¸ªgoroutineçš„åŒæ­¥\n\n`sync.WaitGroup`ç»“æ„ä½“æœ‰ä¸‰ä¸ªæ–¹æ³•\n\n- `Add(delta)`ï¼šå‘å†…éƒ¨è®¡æ•°å™¨ä¸­æ·»åŠ å¢é‡`delta`ï¼Œå…¶ä¸­`delta`å¯æ­£å¯è´Ÿ\n  - ä¸€èˆ¬åœ¨å¯åŠ¨goroutineä¹‹å‰è°ƒç”¨\n- `Done()`ï¼šä½¿å†…éƒ¨è®¡æ•°å™¨`-1`ï¼Œç›¸å½“äº`Add(-1)`\n  - ä¸€èˆ¬åœ¨goroutineå³å°†ç»“æŸæ—¶æ‰§è¡Œï¼Œå¯é…åˆ`defer`å…³é”®å­—å…±åŒä½¿ç”¨\n- `Wait()`ï¼šé˜»å¡å½“å‰goroutineç›´è‡³å†…éƒ¨è®¡æ•°å™¨å‡å°‘è‡³0\n\nâš ï¸ï¼šè°ƒç”¨`Wait()` å‡½æ•°å¯èƒ½å¯¼è‡´æ­»é”ï¼Œé€ æˆç¨‹åºå´©æºƒ\n\n## Goå¹¶å‘çš„å®ç°åŸç†\n\n> DO NOT COMMUNICATE BY SHARING MEMORY; INSTEAD, SHARE MEMORY BY COMMUNICATING. \n\nåœ¨Goä¸­æœ‰ä¸¤ç§å¹¶å‘å½¢å¼ï¼šä¼ ç»Ÿå…±äº«å†…å­˜çš„æ–¹å¼å’ŒCSPï¼ˆ`communicating sequential processes`ï¼‰å¹¶å‘æ¨¡å‹\n\n### å…±äº«å†…å­˜\n\nåœ¨å¤šä¸ªçº¿ç¨‹å…±äº«å†…å­˜ä»¥å…±äº«æ•°æ®çš„æ¨¡å¼ä¸‹ï¼Œé€šè¿‡**åŠ é”**å®ç°å¹¶å‘å®‰å…¨\n\nåœ¨Goä¸­æœ‰ä¸¤ç§é”ï¼š**äº’æ–¥é”ï¼ˆMutexï¼‰**ã€**è¯»å†™é”ï¼ˆRWMutexï¼‰**\n\nä¸¤ç§é”çš„ä½¿ç”¨æ–¹å¼å¦‚ä¸‹ï¼š\n\n```go\n// Mutex\n\tvar mux sync.Mutex\n\tmux.Lock()\n\t// do something\n\tmux.Unlock()\n\n// RWMutx\n\tvar mux sync.RWMutex\n\tmux.RLock()\n\t// å…è®¸å¤šä¸ªè¯»è€…\n\tmux.RUnlock()\n\tmux.Lock()\n\t// åªæœ‰ä¸€ä¸ªå†™è€…\n\tmux.Unlock()\n```\n\nåŒºåˆ«ï¼šåªæœ‰ä¸€ä¸ªgoroutineèƒ½æ‹¿åˆ°**äº’æ–¥é”**ï¼Œå…¶ä»–goroutineåˆ™ä¼šè¢«é˜»å¡ï¼›å…è®¸æœ‰å¤šä¸ªgoroutineæ‹¿åˆ°**è¯»é”**ï¼Œè€Œåªæœ‰ä¸€ä¸ªgoroutineèƒ½æ‹¿åˆ°**å†™é”**\n\nâš ï¸ï¼šå¦‚æœå°†å¸¦æœ‰é”ç»“æ„çš„å˜é‡èµ‹å€¼ç»™å…¶ä»–å˜é‡ï¼Œ**é”çš„çŠ¶æ€ä¼šè¢«å¤åˆ¶**\n\n```go\nfunc main() {\n\tvar mux sync.Mutex\n\tvar wg sync.WaitGroup\n\tdefer mux.Unlock()\n\tmux.Lock()\n\twg.Add(1)\n\tgo func(mux sync.Mutex) {\n\t\tdefer func() {\n\t\t\tmux.Unlock()\n\t\t\twg.Done()\n\t\t}()\n\t\tmux.Lock() // deadlock\n\t}(mux)\n\twg.Wait()\n}\n```\n\n\n\n### channel\n\nç®€å•åœ°è¯´ï¼Œchannelå°±æ˜¯**æ”¶å‘æ•°æ®çš„é€šé“**\n\nå£°æ˜ä¸€ä¸ªchannelè¦ä½¿ç”¨`make`å‡½æ•°è¿›è¡Œ**åˆå§‹åŒ–**ï¼Œå¦åˆ™å£°æ˜å‡ºæ¥çš„channelä¸º`nil`\n\n```go\nvar ch chan int\nvar ch [size]chan int\n\nch = make(chan int, size)\n```\n\n#### å¸¸è§çš„ä½¿ç”¨æ–¹æ³•\n\nğŸ•ï¼š\n\n```go\nch <- 1 // å†™å…¥ä¸€ä¸ªæ•°æ®\nv := <-ch // è¯»å–ä¸€ä¸ªæ•°æ®\n```\n\nâš ï¸ï¼šå¦‚æœchannelæ²¡æœ‰ç¼“å†²åŒºï¼Œé‚£ä¹ˆå†™æ•°æ®å’Œè¯»æ•°æ®å¿…å®šæ˜¯æˆå¯¹å‡ºç°çš„\n\n```go\nclose(ch) // å…³é—­é€šé“\n```\n\nå½“å…³é—­é€šé“ä¹‹åï¼Œ**ä¸èƒ½å†å‘é€šé“ä¸­å†™æ•°æ®ï¼Œä½†æ˜¯èƒ½ä»é€šé“ä¸­è¯»æ•°æ®ï¼Œå¦‚æœé€šé“ä¸­è¿˜æœ‰å€¼åˆ™è¯»å‡ºå¯¹åº”çš„å€¼ï¼Œå¦åˆ™è¯»å‡ºé›¶å€¼**\n\nè¿™å°±å¯¼è‡´ä¸€ä¸ªé—®é¢˜ï¼šå½“æˆ‘è¯»å‡ºé›¶å€¼æ—¶ï¼Œæ— æ³•åˆ¤æ–­å‡ºè¿™æ˜¯å› ä¸º**é€šé“å…³é—­è¿˜æ˜¯å†™å…¥çš„å€¼ç¡®ç¡®å®å®å°±æ˜¯é›¶å€¼**\n\nğŸ•‘ï¼šæ•…éœ€è¦ä½¿ç”¨é€šé“çš„**åˆ¤å®šè¯»æ³•**ï¼š\n\n```go\nval, ok := <-ch\nif ok {\n    fmt.Printf(\"get val %d\\n\", val)\n} else {\n    fmt.Println(\"closed\")\n}\n```\n\nå½“ç®¡é“å…³é—­ä¸”è¯»å–å®Œæ¯•åï¼Œokä¸º`false`\n\nğŸ•’ï¼šæœ‰çš„æ—¶å€™æŸä¸€ä¸ªgoroutineéœ€è¦ä¸€ç›´ç›‘å¬ç€ç®¡é“ä¸­çš„æ•°æ®ï¼Œåªè¦ç®¡é“ä¸­æœ‰æ•°æ®å°±ç«‹é©¬è¯»å–å‡ºæ¥ï¼Œç›´è‡³ç®¡é“å…³é—­\n\nåœ¨Goä¸­å¯ä»¥ä½¿ç”¨`fro range`åšåˆ°æŒç»­ç›‘å¬ç®¡é“ä¸­çš„æ•°æ®\n\n```go\nfunc main() {\n\tch := make(chan int)\n\tgo func() {\n\t\tfor v := range ch {\n\t\t\tfmt.Println(v)\n\t\t}\n\t}()\n\ttime.Sleep(time.Second)\n\tch <- 1\n\ttime.Sleep(time.Second)\n\tch <- 2\n\tclose(ch)\n\ttime.Sleep(time.Second)\n}\n```\n\n### åŒå‘channelå’Œå•å‘channel\n\nchannelå¯ä»¥æ ¹æ®å…¶åŠŸèƒ½åˆ’åˆ†ä¸º**åŒå‘channelå’Œå•å‘channel**ï¼Œå…¶ä¸­åŒå‘channelæ—¢å¯ä»¥è¯»åˆå¯ä»¥å†™ï¼Œè€Œå•å‘channelè¦ä¹ˆåªè¯»ï¼Œè¦ä¹ˆåªå†™\n\nå¯ä»¥é€šè¿‡**ç±»å‹åˆ«å**çš„æ–¹å¼å®šä¹‰å•å‘channel\n\nğŸŒ°ï¼š\n\n```go\ntype RChannel = <-chan int\ntype WChannel = chan<- int\n\nfunc main() {\n\tch := make(chan int)\n\tgo func() {\n\t\tvar w WChannel\n\t\tw = ch\n\t\tw <- 1\n\t}()\n\tgo func() {\n\t\tvar r RChannel\n\t\tr = ch\n\t\tfmt.Println(<-r)\n\t}()\n\ttime.Sleep(time.Second)\n}\n```\n\n### æœ‰ç¼“å†²channelå’Œæ— ç¼“å†²channel\n\næ— ç¼“å†²channelå¯ä»¥ç†è§£ä¸ºæ˜¯**åŒæ­¥æ¨¡å¼**ï¼Œå³ä¸€ä¸ªå†™ï¼Œå¦ä¸€ä¸ªç«‹é©¬è¯»ï¼Œå¦‚æœæ²¡æœ‰è¯»è€…ï¼Œå†™è€…ä¹Ÿä¼šè¢«é˜»å¡\n\næœ‰ç¼“å†²channelåˆ™å¯ä»¥ä½œä¸º**å¼‚æ­¥æ¨¡å¼**ï¼Œåœ¨ç¼“å†²åŒºæœªæ»¡çš„æƒ…å†µä¸‹ï¼Œå³ä½¿æ²¡æœ‰è¯»è€…ï¼Œå†™è€…ä¹Ÿèƒ½å‘é€šé“ä¸­å†™å…¥æ•°æ®\n\nä½†å½“ç¼“å†²åŒºæ»¡äº†åï¼Œå†™è€…æƒ³è¦ç»§ç»­å†™å…¥æ•°æ®åˆ™ä¼šè¢«é˜»å¡ï¼Œé€€åŒ–æˆ**åŒæ­¥æ¨¡å¼**\n\n### æ€»ç»“\n\n- å…³é—­ä¸€ä¸ªæœªåˆå§‹åŒ–çš„channelä¼šäº§ç”Ÿpanic\n- channelåªèƒ½å…³é—­ä¸€æ¬¡ï¼Œå¯¹åŒä¸€channelå¤šæ¬¡å…³é—­ä¼šå‘ç”Ÿpanic\n- å‘ä¸€ä¸ªå·²ç»å…³é—­çš„channelå†™å…¥æ•°æ®ï¼Œä¼šå‘ç”Ÿpanic\n- ä»ä¸€ä¸ªå·²ç»å…³é—­çš„channelè¯»å–æ•°æ®ï¼Œä¼šè¯»å‡ºç¼“å†²åŒºä¸­çš„å€¼ï¼Œå½“ç¼“å†²åŒºæ²¡æœ‰æ•°æ®ï¼ˆæˆ–æ²¡æœ‰ç¼“å†²åŒºï¼‰æ—¶ï¼Œåˆ™ä¼šè¯»å‡ºå¯¹åº”ç±»å‹çš„é›¶å€¼\n- channelçš„è¯»ç«¯å’Œå†™ç«¯éƒ½å¯ä»¥ç”±å¤šä¸ªgoroutineæ“ä½œï¼Œå½“å†™ç«¯è¢«ä¸€ä¸ªgoroutineå…³é—­æ—¶ï¼Œè¯»ç«¯çš„å¤šä¸ªgoroutineéƒ½ä¼šæ”¶åˆ°ç®¡é“å…³é—­çš„æ¶ˆæ¯\n- channelæ˜¯å¹¶å‘å®‰å…¨çš„\n","slug":"goroutine","published":1,"updated":"2024-12-27T11:03:15.343Z","comments":1,"layout":"post","photos":[],"_id":"cm6c7md6h0009a5t29ppedzne","content":"<h1 id=\"goroutine\"><a href=\"#goroutine\" class=\"headerlink\" title=\"goroutine\"></a>goroutine</h1><p>goroutineæ˜¯Goè¯­è¨€ä¸­çš„è½»é‡çº§çº¿ç¨‹çš„å®ç°ï¼Œç”±<strong>Goè¿è¡Œæ—¶ç®¡ç†</strong>ï¼Œæ˜¯Goç¨‹åºä¸­æœ€å°çš„å¹¶å‘æ‰§è¡Œå•ä½ã€‚å¹¶ä¸”ä¼ ç»Ÿæ„ä¹‰ä¸Šçš„åç¨‹æ˜¯ä¸æ”¯æŒå¹¶å‘çš„ï¼Œè€Œ<strong>goroutineæ”¯æŒå¹¶å‘</strong>ï¼ŒåŒæ—¶goroutineå¯ä»¥è¿è¡Œåœ¨ä¸€ä¸ªæˆ–å¤šä¸ªçº¿ç¨‹ä¸Š</p>\n<p><strong>goroutineå¤§å°ä¸º2kbï¼Œå¯ä»¥åŠ¨æ€å¢å¤§</strong></p>\n<h2 id=\"ç®€è¿°\"><a href=\"#ç®€è¿°\" class=\"headerlink\" title=\"ç®€è¿°\"></a>ç®€è¿°</h2><h3 id=\"goroutineçš„è¿è¡Œæœºåˆ¶\"><a href=\"#goroutineçš„è¿è¡Œæœºåˆ¶\" class=\"headerlink\" title=\"goroutineçš„è¿è¡Œæœºåˆ¶\"></a>goroutineçš„è¿è¡Œæœºåˆ¶</h3><p>åœ¨Goç¨‹åºä¸­ï¼Œ<code>main</code>å‡½æ•°æ˜¯ç¨‹åºçš„å…¥å£ï¼Œå½“ç¨‹åºå¼€å§‹æ‰§è¡Œ<code>main</code>å‡½æ•°æ—¶ï¼Œå°±ä¼šåˆ›å»ºä¸€ä¸ª<strong>ä¸»goroutine</strong>ï¼Œè¿™ä¸ªä¸»goroutineæ˜¯<strong>å…¨å±€å”¯ä¸€çš„</strong>å¹¶ä¸”ä»£è¡¨ç€æ•´ä¸ªGoç¨‹åºçš„ç”Ÿå‘½å‘¨æœŸ</p>\n<p>åœ¨ä»£ç ä¸­ï¼Œå¯ä»¥ä½¿ç”¨<code>go</code>å…³é”®å­—è½»æ¾åˆ›å»ºå‡ºä¸€ä¸ªgoroutine</p>\n<p>ğŸŒ°ï¼š</p>\n<figure class=\"highlight go\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"function\"><span class=\"keyword\">func</span> <span class=\"title\">sum</span><span class=\"params\">(a, b <span class=\"type\">int</span>)</span></span> &#123;</span><br><span class=\"line\">    <span class=\"built_in\">println</span>(a+b)</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"function\"><span class=\"keyword\">func</span> <span class=\"title\">main</span><span class=\"params\">()</span></span> &#123;</span><br><span class=\"line\">    <span class=\"keyword\">go</span> sum(<span class=\"number\">1</span>, <span class=\"number\">2</span>)</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n\n<p>åœ¨ä¸Šè¿°ä»£ç ä¸­ï¼Œ**<code>go</code>å…³é”®å­—+å‡½æ•°è°ƒç”¨<strong>è¡¨ç¤ºåˆ›å»ºä¸€ä¸ªgoroutineå¹¶åœ¨è¿™ä¸ªgoroutineä¸­è¿è¡Œ<code>sum</code>å‡½æ•°ã€‚ä½†ä¸Šè¿°ä»£ç çš„è¿è¡Œç»“æœå¹¶ä¸ä¼šç¬¦åˆæˆ‘ä»¬çš„é¢„æœŸï¼Œè¿™æ˜¯å› ä¸º</strong>goroutineçš„è¿è¡Œæœºåˆ¶æ˜¯ï¼šåœ¨ä¸»Goroutineç»“æŸä¹‹åï¼Œå…¶ä»–æ‰€æœ‰çš„goroutineéƒ½ä¼šç›´æ¥é€€å‡º**ï¼Œä¸Šè¿°ä»£ç ä¸­çš„ä¸»goroutineç»“æŸçš„æ¯”å­goroutineæ›´å¿«ï¼Œæ‰€ä»¥æ§åˆ¶å°ä¼šæ²¡æœ‰ä»»ä½•è¾“å‡ºğŸ˜‚</p>\n<h3 id=\"goroutineçš„ç‰¹ç‚¹\"><a href=\"#goroutineçš„ç‰¹ç‚¹\" class=\"headerlink\" title=\"goroutineçš„ç‰¹ç‚¹\"></a>goroutineçš„ç‰¹ç‚¹</h3><ul>\n<li>æ˜¯ä¸€ç§è½»é‡çº§â€œçº¿ç¨‹â€ï¼Œç±»ä¼¼äºåç¨‹</li>\n<li><strong>éæŠ¢å å¼ï¼ˆå³ä¸ä¼šè¢«ä¸­æ–­ï¼‰å¤šä»»åŠ¡å¤„ç†ï¼Œæœ‰åç¨‹ä¸»åŠ¨äº¤å‡ºè¿è¡ŒæƒåŠ›</strong></li>\n<li>ç¼–è¯‘å™¨&#x2F;è§£é‡Šå™¨&#x2F;è™šæ‹Ÿæœºå±‚é¢çš„å¤šä»»åŠ¡ï¼ˆä¸æ‡‚ğŸ™ƒï¼‰</li>\n<li>å¤šä¸ªåç¨‹å¯ä»¥åœ¨ä¸€ä¸ªæˆ–å¤šä¸ªçº¿ç¨‹ä¸Šè¿è¡Œ</li>\n</ul>\n<p>ç”±äºgoroutineæ˜¯éæŠ¢å å¼çš„ï¼Œä¸€ä¸ªgoroutineå¯èƒ½ä¼šåœ¨ä¸€ä¸‹æ—¶æœºä¸»åŠ¨äº¤å‡ºè¿è¡ŒæƒåŠ›</p>\n<ul>\n<li>I&#x2F;Oï¼Œselect</li>\n<li>channel</li>\n<li>ç­‰å¾…é”</li>\n<li>å‡½æ•°è°ƒç”¨</li>\n<li>runtime.Gosched()</li>\n</ul>\n<h3 id=\"WaitGroupï¼šå¤šä¸ªgoroutineå¹¶å‘æ‰§è¡Œ\"><a href=\"#WaitGroupï¼šå¤šä¸ªgoroutineå¹¶å‘æ‰§è¡Œ\" class=\"headerlink\" title=\"WaitGroupï¼šå¤šä¸ªgoroutineå¹¶å‘æ‰§è¡Œ\"></a>WaitGroupï¼šå¤šä¸ªgoroutineå¹¶å‘æ‰§è¡Œ</h3><p>å‰æ–‡é˜è¿°äº†å½“ä¸»goroutineç»“æŸä¹‹åï¼Œå…¶ä»–çš„goroutineéƒ½ä¼šè¢«å¼ºåˆ¶ç»“æŸã€‚ä½†æ˜¯å¾ˆå¤šæƒ…å†µä¸‹ï¼Œä¸»goroutineéœ€è¦åœ¨å…¶ä»–goroutineç»“æŸä¹‹åå†ç»“æŸï¼Œä¸€ç§å¾ˆç®€å•çš„æ–¹æ³•å°±æ˜¯è®©ä¸»goroutineç¡å‡ ç§’</p>\n<figure class=\"highlight go\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">time.Sleep(time.Second)</span><br></pre></td></tr></table></figure>\n\n<p>å¦ä¸€ç§æ›´ä¼˜é›…çš„æ–¹æ³•å°±æ˜¯ä½¿ç”¨<code>sync.WaitGroup</code>ç»“æ„ä½“ï¼Œå®ç°å¤šä¸ªgoroutineçš„åŒæ­¥</p>\n<p><code>sync.WaitGroup</code>ç»“æ„ä½“æœ‰ä¸‰ä¸ªæ–¹æ³•</p>\n<ul>\n<li><code>Add(delta)</code>ï¼šå‘å†…éƒ¨è®¡æ•°å™¨ä¸­æ·»åŠ å¢é‡<code>delta</code>ï¼Œå…¶ä¸­<code>delta</code>å¯æ­£å¯è´Ÿ<ul>\n<li>ä¸€èˆ¬åœ¨å¯åŠ¨goroutineä¹‹å‰è°ƒç”¨</li>\n</ul>\n</li>\n<li><code>Done()</code>ï¼šä½¿å†…éƒ¨è®¡æ•°å™¨<code>-1</code>ï¼Œç›¸å½“äº<code>Add(-1)</code><ul>\n<li>ä¸€èˆ¬åœ¨goroutineå³å°†ç»“æŸæ—¶æ‰§è¡Œï¼Œå¯é…åˆ<code>defer</code>å…³é”®å­—å…±åŒä½¿ç”¨</li>\n</ul>\n</li>\n<li><code>Wait()</code>ï¼šé˜»å¡å½“å‰goroutineç›´è‡³å†…éƒ¨è®¡æ•°å™¨å‡å°‘è‡³0</li>\n</ul>\n<p>âš ï¸ï¼šè°ƒç”¨<code>Wait()</code> å‡½æ•°å¯èƒ½å¯¼è‡´æ­»é”ï¼Œé€ æˆç¨‹åºå´©æºƒ</p>\n<h2 id=\"Goå¹¶å‘çš„å®ç°åŸç†\"><a href=\"#Goå¹¶å‘çš„å®ç°åŸç†\" class=\"headerlink\" title=\"Goå¹¶å‘çš„å®ç°åŸç†\"></a>Goå¹¶å‘çš„å®ç°åŸç†</h2><blockquote>\n<p>DO NOT COMMUNICATE BY SHARING MEMORY; INSTEAD, SHARE MEMORY BY COMMUNICATING. </p>\n</blockquote>\n<p>åœ¨Goä¸­æœ‰ä¸¤ç§å¹¶å‘å½¢å¼ï¼šä¼ ç»Ÿå…±äº«å†…å­˜çš„æ–¹å¼å’ŒCSPï¼ˆ<code>communicating sequential processes</code>ï¼‰å¹¶å‘æ¨¡å‹</p>\n<h3 id=\"å…±äº«å†…å­˜\"><a href=\"#å…±äº«å†…å­˜\" class=\"headerlink\" title=\"å…±äº«å†…å­˜\"></a>å…±äº«å†…å­˜</h3><p>åœ¨å¤šä¸ªçº¿ç¨‹å…±äº«å†…å­˜ä»¥å…±äº«æ•°æ®çš„æ¨¡å¼ä¸‹ï¼Œé€šè¿‡<strong>åŠ é”</strong>å®ç°å¹¶å‘å®‰å…¨</p>\n<p>åœ¨Goä¸­æœ‰ä¸¤ç§é”ï¼š<strong>äº’æ–¥é”ï¼ˆMutexï¼‰</strong>ã€<strong>è¯»å†™é”ï¼ˆRWMutexï¼‰</strong></p>\n<p>ä¸¤ç§é”çš„ä½¿ç”¨æ–¹å¼å¦‚ä¸‹ï¼š</p>\n<figure class=\"highlight go\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\">// Mutex</span></span><br><span class=\"line\">\t<span class=\"keyword\">var</span> mux sync.Mutex</span><br><span class=\"line\">\tmux.Lock()</span><br><span class=\"line\">\t<span class=\"comment\">// do something</span></span><br><span class=\"line\">\tmux.Unlock()</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\">// RWMutx</span></span><br><span class=\"line\">\t<span class=\"keyword\">var</span> mux sync.RWMutex</span><br><span class=\"line\">\tmux.RLock()</span><br><span class=\"line\">\t<span class=\"comment\">// å…è®¸å¤šä¸ªè¯»è€…</span></span><br><span class=\"line\">\tmux.RUnlock()</span><br><span class=\"line\">\tmux.Lock()</span><br><span class=\"line\">\t<span class=\"comment\">// åªæœ‰ä¸€ä¸ªå†™è€…</span></span><br><span class=\"line\">\tmux.Unlock()</span><br></pre></td></tr></table></figure>\n\n<p>åŒºåˆ«ï¼šåªæœ‰ä¸€ä¸ªgoroutineèƒ½æ‹¿åˆ°<strong>äº’æ–¥é”</strong>ï¼Œå…¶ä»–goroutineåˆ™ä¼šè¢«é˜»å¡ï¼›å…è®¸æœ‰å¤šä¸ªgoroutineæ‹¿åˆ°<strong>è¯»é”</strong>ï¼Œè€Œåªæœ‰ä¸€ä¸ªgoroutineèƒ½æ‹¿åˆ°<strong>å†™é”</strong></p>\n<p>âš ï¸ï¼šå¦‚æœå°†å¸¦æœ‰é”ç»“æ„çš„å˜é‡èµ‹å€¼ç»™å…¶ä»–å˜é‡ï¼Œ<strong>é”çš„çŠ¶æ€ä¼šè¢«å¤åˆ¶</strong></p>\n<figure class=\"highlight go\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"function\"><span class=\"keyword\">func</span> <span class=\"title\">main</span><span class=\"params\">()</span></span> &#123;</span><br><span class=\"line\">\t<span class=\"keyword\">var</span> mux sync.Mutex</span><br><span class=\"line\">\t<span class=\"keyword\">var</span> wg sync.WaitGroup</span><br><span class=\"line\">\t<span class=\"keyword\">defer</span> mux.Unlock()</span><br><span class=\"line\">\tmux.Lock()</span><br><span class=\"line\">\twg.Add(<span class=\"number\">1</span>)</span><br><span class=\"line\">\t<span class=\"keyword\">go</span> <span class=\"function\"><span class=\"keyword\">func</span><span class=\"params\">(mux sync.Mutex)</span></span> &#123;</span><br><span class=\"line\">\t\t<span class=\"keyword\">defer</span> <span class=\"function\"><span class=\"keyword\">func</span><span class=\"params\">()</span></span> &#123;</span><br><span class=\"line\">\t\t\tmux.Unlock()</span><br><span class=\"line\">\t\t\twg.Done()</span><br><span class=\"line\">\t\t&#125;()</span><br><span class=\"line\">\t\tmux.Lock() <span class=\"comment\">// deadlock</span></span><br><span class=\"line\">\t&#125;(mux)</span><br><span class=\"line\">\twg.Wait()</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n\n\n\n<h3 id=\"channel\"><a href=\"#channel\" class=\"headerlink\" title=\"channel\"></a>channel</h3><p>ç®€å•åœ°è¯´ï¼Œchannelå°±æ˜¯<strong>æ”¶å‘æ•°æ®çš„é€šé“</strong></p>\n<p>å£°æ˜ä¸€ä¸ªchannelè¦ä½¿ç”¨<code>make</code>å‡½æ•°è¿›è¡Œ<strong>åˆå§‹åŒ–</strong>ï¼Œå¦åˆ™å£°æ˜å‡ºæ¥çš„channelä¸º<code>nil</code></p>\n<figure class=\"highlight go\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">var</span> ch <span class=\"keyword\">chan</span> <span class=\"type\">int</span></span><br><span class=\"line\"><span class=\"keyword\">var</span> ch [size]<span class=\"keyword\">chan</span> <span class=\"type\">int</span></span><br><span class=\"line\"></span><br><span class=\"line\">ch = <span class=\"built_in\">make</span>(<span class=\"keyword\">chan</span> <span class=\"type\">int</span>, size)</span><br></pre></td></tr></table></figure>\n\n<h4 id=\"å¸¸è§çš„ä½¿ç”¨æ–¹æ³•\"><a href=\"#å¸¸è§çš„ä½¿ç”¨æ–¹æ³•\" class=\"headerlink\" title=\"å¸¸è§çš„ä½¿ç”¨æ–¹æ³•\"></a>å¸¸è§çš„ä½¿ç”¨æ–¹æ³•</h4><p>ğŸ•ï¼š</p>\n<figure class=\"highlight go\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">ch &lt;- <span class=\"number\">1</span> <span class=\"comment\">// å†™å…¥ä¸€ä¸ªæ•°æ®</span></span><br><span class=\"line\">v := &lt;-ch <span class=\"comment\">// è¯»å–ä¸€ä¸ªæ•°æ®</span></span><br></pre></td></tr></table></figure>\n\n<p>âš ï¸ï¼šå¦‚æœchannelæ²¡æœ‰ç¼“å†²åŒºï¼Œé‚£ä¹ˆå†™æ•°æ®å’Œè¯»æ•°æ®å¿…å®šæ˜¯æˆå¯¹å‡ºç°çš„</p>\n<figure class=\"highlight go\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"built_in\">close</span>(ch) <span class=\"comment\">// å…³é—­é€šé“</span></span><br></pre></td></tr></table></figure>\n\n<p>å½“å…³é—­é€šé“ä¹‹åï¼Œ<strong>ä¸èƒ½å†å‘é€šé“ä¸­å†™æ•°æ®ï¼Œä½†æ˜¯èƒ½ä»é€šé“ä¸­è¯»æ•°æ®ï¼Œå¦‚æœé€šé“ä¸­è¿˜æœ‰å€¼åˆ™è¯»å‡ºå¯¹åº”çš„å€¼ï¼Œå¦åˆ™è¯»å‡ºé›¶å€¼</strong></p>\n<p>è¿™å°±å¯¼è‡´ä¸€ä¸ªé—®é¢˜ï¼šå½“æˆ‘è¯»å‡ºé›¶å€¼æ—¶ï¼Œæ— æ³•åˆ¤æ–­å‡ºè¿™æ˜¯å› ä¸º<strong>é€šé“å…³é—­è¿˜æ˜¯å†™å…¥çš„å€¼ç¡®ç¡®å®å®å°±æ˜¯é›¶å€¼</strong></p>\n<p>ğŸ•‘ï¼šæ•…éœ€è¦ä½¿ç”¨é€šé“çš„<strong>åˆ¤å®šè¯»æ³•</strong>ï¼š</p>\n<figure class=\"highlight go\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">val, ok := &lt;-ch</span><br><span class=\"line\"><span class=\"keyword\">if</span> ok &#123;</span><br><span class=\"line\">    fmt.Printf(<span class=\"string\">&quot;get val %d\\n&quot;</span>, val)</span><br><span class=\"line\">&#125; <span class=\"keyword\">else</span> &#123;</span><br><span class=\"line\">    fmt.Println(<span class=\"string\">&quot;closed&quot;</span>)</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n\n<p>å½“ç®¡é“å…³é—­ä¸”è¯»å–å®Œæ¯•åï¼Œokä¸º<code>false</code></p>\n<p>ğŸ•’ï¼šæœ‰çš„æ—¶å€™æŸä¸€ä¸ªgoroutineéœ€è¦ä¸€ç›´ç›‘å¬ç€ç®¡é“ä¸­çš„æ•°æ®ï¼Œåªè¦ç®¡é“ä¸­æœ‰æ•°æ®å°±ç«‹é©¬è¯»å–å‡ºæ¥ï¼Œç›´è‡³ç®¡é“å…³é—­</p>\n<p>åœ¨Goä¸­å¯ä»¥ä½¿ç”¨<code>fro range</code>åšåˆ°æŒç»­ç›‘å¬ç®¡é“ä¸­çš„æ•°æ®</p>\n<figure class=\"highlight go\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"function\"><span class=\"keyword\">func</span> <span class=\"title\">main</span><span class=\"params\">()</span></span> &#123;</span><br><span class=\"line\">\tch := <span class=\"built_in\">make</span>(<span class=\"keyword\">chan</span> <span class=\"type\">int</span>)</span><br><span class=\"line\">\t<span class=\"keyword\">go</span> <span class=\"function\"><span class=\"keyword\">func</span><span class=\"params\">()</span></span> &#123;</span><br><span class=\"line\">\t\t<span class=\"keyword\">for</span> v := <span class=\"keyword\">range</span> ch &#123;</span><br><span class=\"line\">\t\t\tfmt.Println(v)</span><br><span class=\"line\">\t\t&#125;</span><br><span class=\"line\">\t&#125;()</span><br><span class=\"line\">\ttime.Sleep(time.Second)</span><br><span class=\"line\">\tch &lt;- <span class=\"number\">1</span></span><br><span class=\"line\">\ttime.Sleep(time.Second)</span><br><span class=\"line\">\tch &lt;- <span class=\"number\">2</span></span><br><span class=\"line\">\t<span class=\"built_in\">close</span>(ch)</span><br><span class=\"line\">\ttime.Sleep(time.Second)</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n\n<h3 id=\"åŒå‘channelå’Œå•å‘channel\"><a href=\"#åŒå‘channelå’Œå•å‘channel\" class=\"headerlink\" title=\"åŒå‘channelå’Œå•å‘channel\"></a>åŒå‘channelå’Œå•å‘channel</h3><p>channelå¯ä»¥æ ¹æ®å…¶åŠŸèƒ½åˆ’åˆ†ä¸º<strong>åŒå‘channelå’Œå•å‘channel</strong>ï¼Œå…¶ä¸­åŒå‘channelæ—¢å¯ä»¥è¯»åˆå¯ä»¥å†™ï¼Œè€Œå•å‘channelè¦ä¹ˆåªè¯»ï¼Œè¦ä¹ˆåªå†™</p>\n<p>å¯ä»¥é€šè¿‡<strong>ç±»å‹åˆ«å</strong>çš„æ–¹å¼å®šä¹‰å•å‘channel</p>\n<p>ğŸŒ°ï¼š</p>\n<figure class=\"highlight go\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">type</span> RChannel = &lt;-<span class=\"keyword\">chan</span> <span class=\"type\">int</span></span><br><span class=\"line\"><span class=\"keyword\">type</span> WChannel = <span class=\"keyword\">chan</span>&lt;- <span class=\"type\">int</span></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"function\"><span class=\"keyword\">func</span> <span class=\"title\">main</span><span class=\"params\">()</span></span> &#123;</span><br><span class=\"line\">\tch := <span class=\"built_in\">make</span>(<span class=\"keyword\">chan</span> <span class=\"type\">int</span>)</span><br><span class=\"line\">\t<span class=\"keyword\">go</span> <span class=\"function\"><span class=\"keyword\">func</span><span class=\"params\">()</span></span> &#123;</span><br><span class=\"line\">\t\t<span class=\"keyword\">var</span> w WChannel</span><br><span class=\"line\">\t\tw = ch</span><br><span class=\"line\">\t\tw &lt;- <span class=\"number\">1</span></span><br><span class=\"line\">\t&#125;()</span><br><span class=\"line\">\t<span class=\"keyword\">go</span> <span class=\"function\"><span class=\"keyword\">func</span><span class=\"params\">()</span></span> &#123;</span><br><span class=\"line\">\t\t<span class=\"keyword\">var</span> r RChannel</span><br><span class=\"line\">\t\tr = ch</span><br><span class=\"line\">\t\tfmt.Println(&lt;-r)</span><br><span class=\"line\">\t&#125;()</span><br><span class=\"line\">\ttime.Sleep(time.Second)</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n\n<h3 id=\"æœ‰ç¼“å†²channelå’Œæ— ç¼“å†²channel\"><a href=\"#æœ‰ç¼“å†²channelå’Œæ— ç¼“å†²channel\" class=\"headerlink\" title=\"æœ‰ç¼“å†²channelå’Œæ— ç¼“å†²channel\"></a>æœ‰ç¼“å†²channelå’Œæ— ç¼“å†²channel</h3><p>æ— ç¼“å†²channelå¯ä»¥ç†è§£ä¸ºæ˜¯<strong>åŒæ­¥æ¨¡å¼</strong>ï¼Œå³ä¸€ä¸ªå†™ï¼Œå¦ä¸€ä¸ªç«‹é©¬è¯»ï¼Œå¦‚æœæ²¡æœ‰è¯»è€…ï¼Œå†™è€…ä¹Ÿä¼šè¢«é˜»å¡</p>\n<p>æœ‰ç¼“å†²channelåˆ™å¯ä»¥ä½œä¸º<strong>å¼‚æ­¥æ¨¡å¼</strong>ï¼Œåœ¨ç¼“å†²åŒºæœªæ»¡çš„æƒ…å†µä¸‹ï¼Œå³ä½¿æ²¡æœ‰è¯»è€…ï¼Œå†™è€…ä¹Ÿèƒ½å‘é€šé“ä¸­å†™å…¥æ•°æ®</p>\n<p>ä½†å½“ç¼“å†²åŒºæ»¡äº†åï¼Œå†™è€…æƒ³è¦ç»§ç»­å†™å…¥æ•°æ®åˆ™ä¼šè¢«é˜»å¡ï¼Œé€€åŒ–æˆ<strong>åŒæ­¥æ¨¡å¼</strong></p>\n<h3 id=\"æ€»ç»“\"><a href=\"#æ€»ç»“\" class=\"headerlink\" title=\"æ€»ç»“\"></a>æ€»ç»“</h3><ul>\n<li>å…³é—­ä¸€ä¸ªæœªåˆå§‹åŒ–çš„channelä¼šäº§ç”Ÿpanic</li>\n<li>channelåªèƒ½å…³é—­ä¸€æ¬¡ï¼Œå¯¹åŒä¸€channelå¤šæ¬¡å…³é—­ä¼šå‘ç”Ÿpanic</li>\n<li>å‘ä¸€ä¸ªå·²ç»å…³é—­çš„channelå†™å…¥æ•°æ®ï¼Œä¼šå‘ç”Ÿpanic</li>\n<li>ä»ä¸€ä¸ªå·²ç»å…³é—­çš„channelè¯»å–æ•°æ®ï¼Œä¼šè¯»å‡ºç¼“å†²åŒºä¸­çš„å€¼ï¼Œå½“ç¼“å†²åŒºæ²¡æœ‰æ•°æ®ï¼ˆæˆ–æ²¡æœ‰ç¼“å†²åŒºï¼‰æ—¶ï¼Œåˆ™ä¼šè¯»å‡ºå¯¹åº”ç±»å‹çš„é›¶å€¼</li>\n<li>channelçš„è¯»ç«¯å’Œå†™ç«¯éƒ½å¯ä»¥ç”±å¤šä¸ªgoroutineæ“ä½œï¼Œå½“å†™ç«¯è¢«ä¸€ä¸ªgoroutineå…³é—­æ—¶ï¼Œè¯»ç«¯çš„å¤šä¸ªgoroutineéƒ½ä¼šæ”¶åˆ°ç®¡é“å…³é—­çš„æ¶ˆæ¯</li>\n<li>channelæ˜¯å¹¶å‘å®‰å…¨çš„</li>\n</ul>\n","excerpt":"","more":"<h1 id=\"goroutine\"><a href=\"#goroutine\" class=\"headerlink\" title=\"goroutine\"></a>goroutine</h1><p>goroutineæ˜¯Goè¯­è¨€ä¸­çš„è½»é‡çº§çº¿ç¨‹çš„å®ç°ï¼Œç”±<strong>Goè¿è¡Œæ—¶ç®¡ç†</strong>ï¼Œæ˜¯Goç¨‹åºä¸­æœ€å°çš„å¹¶å‘æ‰§è¡Œå•ä½ã€‚å¹¶ä¸”ä¼ ç»Ÿæ„ä¹‰ä¸Šçš„åç¨‹æ˜¯ä¸æ”¯æŒå¹¶å‘çš„ï¼Œè€Œ<strong>goroutineæ”¯æŒå¹¶å‘</strong>ï¼ŒåŒæ—¶goroutineå¯ä»¥è¿è¡Œåœ¨ä¸€ä¸ªæˆ–å¤šä¸ªçº¿ç¨‹ä¸Š</p>\n<p><strong>goroutineå¤§å°ä¸º2kbï¼Œå¯ä»¥åŠ¨æ€å¢å¤§</strong></p>\n<h2 id=\"ç®€è¿°\"><a href=\"#ç®€è¿°\" class=\"headerlink\" title=\"ç®€è¿°\"></a>ç®€è¿°</h2><h3 id=\"goroutineçš„è¿è¡Œæœºåˆ¶\"><a href=\"#goroutineçš„è¿è¡Œæœºåˆ¶\" class=\"headerlink\" title=\"goroutineçš„è¿è¡Œæœºåˆ¶\"></a>goroutineçš„è¿è¡Œæœºåˆ¶</h3><p>åœ¨Goç¨‹åºä¸­ï¼Œ<code>main</code>å‡½æ•°æ˜¯ç¨‹åºçš„å…¥å£ï¼Œå½“ç¨‹åºå¼€å§‹æ‰§è¡Œ<code>main</code>å‡½æ•°æ—¶ï¼Œå°±ä¼šåˆ›å»ºä¸€ä¸ª<strong>ä¸»goroutine</strong>ï¼Œè¿™ä¸ªä¸»goroutineæ˜¯<strong>å…¨å±€å”¯ä¸€çš„</strong>å¹¶ä¸”ä»£è¡¨ç€æ•´ä¸ªGoç¨‹åºçš„ç”Ÿå‘½å‘¨æœŸ</p>\n<p>åœ¨ä»£ç ä¸­ï¼Œå¯ä»¥ä½¿ç”¨<code>go</code>å…³é”®å­—è½»æ¾åˆ›å»ºå‡ºä¸€ä¸ªgoroutine</p>\n<p>ğŸŒ°ï¼š</p>\n<figure class=\"highlight go\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"function\"><span class=\"keyword\">func</span> <span class=\"title\">sum</span><span class=\"params\">(a, b <span class=\"type\">int</span>)</span></span> &#123;</span><br><span class=\"line\">    <span class=\"built_in\">println</span>(a+b)</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"function\"><span class=\"keyword\">func</span> <span class=\"title\">main</span><span class=\"params\">()</span></span> &#123;</span><br><span class=\"line\">    <span class=\"keyword\">go</span> sum(<span class=\"number\">1</span>, <span class=\"number\">2</span>)</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n\n<p>åœ¨ä¸Šè¿°ä»£ç ä¸­ï¼Œ**<code>go</code>å…³é”®å­—+å‡½æ•°è°ƒç”¨<strong>è¡¨ç¤ºåˆ›å»ºä¸€ä¸ªgoroutineå¹¶åœ¨è¿™ä¸ªgoroutineä¸­è¿è¡Œ<code>sum</code>å‡½æ•°ã€‚ä½†ä¸Šè¿°ä»£ç çš„è¿è¡Œç»“æœå¹¶ä¸ä¼šç¬¦åˆæˆ‘ä»¬çš„é¢„æœŸï¼Œè¿™æ˜¯å› ä¸º</strong>goroutineçš„è¿è¡Œæœºåˆ¶æ˜¯ï¼šåœ¨ä¸»Goroutineç»“æŸä¹‹åï¼Œå…¶ä»–æ‰€æœ‰çš„goroutineéƒ½ä¼šç›´æ¥é€€å‡º**ï¼Œä¸Šè¿°ä»£ç ä¸­çš„ä¸»goroutineç»“æŸçš„æ¯”å­goroutineæ›´å¿«ï¼Œæ‰€ä»¥æ§åˆ¶å°ä¼šæ²¡æœ‰ä»»ä½•è¾“å‡ºğŸ˜‚</p>\n<h3 id=\"goroutineçš„ç‰¹ç‚¹\"><a href=\"#goroutineçš„ç‰¹ç‚¹\" class=\"headerlink\" title=\"goroutineçš„ç‰¹ç‚¹\"></a>goroutineçš„ç‰¹ç‚¹</h3><ul>\n<li>æ˜¯ä¸€ç§è½»é‡çº§â€œçº¿ç¨‹â€ï¼Œç±»ä¼¼äºåç¨‹</li>\n<li><strong>éæŠ¢å å¼ï¼ˆå³ä¸ä¼šè¢«ä¸­æ–­ï¼‰å¤šä»»åŠ¡å¤„ç†ï¼Œæœ‰åç¨‹ä¸»åŠ¨äº¤å‡ºè¿è¡ŒæƒåŠ›</strong></li>\n<li>ç¼–è¯‘å™¨&#x2F;è§£é‡Šå™¨&#x2F;è™šæ‹Ÿæœºå±‚é¢çš„å¤šä»»åŠ¡ï¼ˆä¸æ‡‚ğŸ™ƒï¼‰</li>\n<li>å¤šä¸ªåç¨‹å¯ä»¥åœ¨ä¸€ä¸ªæˆ–å¤šä¸ªçº¿ç¨‹ä¸Šè¿è¡Œ</li>\n</ul>\n<p>ç”±äºgoroutineæ˜¯éæŠ¢å å¼çš„ï¼Œä¸€ä¸ªgoroutineå¯èƒ½ä¼šåœ¨ä¸€ä¸‹æ—¶æœºä¸»åŠ¨äº¤å‡ºè¿è¡ŒæƒåŠ›</p>\n<ul>\n<li>I&#x2F;Oï¼Œselect</li>\n<li>channel</li>\n<li>ç­‰å¾…é”</li>\n<li>å‡½æ•°è°ƒç”¨</li>\n<li>runtime.Gosched()</li>\n</ul>\n<h3 id=\"WaitGroupï¼šå¤šä¸ªgoroutineå¹¶å‘æ‰§è¡Œ\"><a href=\"#WaitGroupï¼šå¤šä¸ªgoroutineå¹¶å‘æ‰§è¡Œ\" class=\"headerlink\" title=\"WaitGroupï¼šå¤šä¸ªgoroutineå¹¶å‘æ‰§è¡Œ\"></a>WaitGroupï¼šå¤šä¸ªgoroutineå¹¶å‘æ‰§è¡Œ</h3><p>å‰æ–‡é˜è¿°äº†å½“ä¸»goroutineç»“æŸä¹‹åï¼Œå…¶ä»–çš„goroutineéƒ½ä¼šè¢«å¼ºåˆ¶ç»“æŸã€‚ä½†æ˜¯å¾ˆå¤šæƒ…å†µä¸‹ï¼Œä¸»goroutineéœ€è¦åœ¨å…¶ä»–goroutineç»“æŸä¹‹åå†ç»“æŸï¼Œä¸€ç§å¾ˆç®€å•çš„æ–¹æ³•å°±æ˜¯è®©ä¸»goroutineç¡å‡ ç§’</p>\n<figure class=\"highlight go\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">time.Sleep(time.Second)</span><br></pre></td></tr></table></figure>\n\n<p>å¦ä¸€ç§æ›´ä¼˜é›…çš„æ–¹æ³•å°±æ˜¯ä½¿ç”¨<code>sync.WaitGroup</code>ç»“æ„ä½“ï¼Œå®ç°å¤šä¸ªgoroutineçš„åŒæ­¥</p>\n<p><code>sync.WaitGroup</code>ç»“æ„ä½“æœ‰ä¸‰ä¸ªæ–¹æ³•</p>\n<ul>\n<li><code>Add(delta)</code>ï¼šå‘å†…éƒ¨è®¡æ•°å™¨ä¸­æ·»åŠ å¢é‡<code>delta</code>ï¼Œå…¶ä¸­<code>delta</code>å¯æ­£å¯è´Ÿ<ul>\n<li>ä¸€èˆ¬åœ¨å¯åŠ¨goroutineä¹‹å‰è°ƒç”¨</li>\n</ul>\n</li>\n<li><code>Done()</code>ï¼šä½¿å†…éƒ¨è®¡æ•°å™¨<code>-1</code>ï¼Œç›¸å½“äº<code>Add(-1)</code><ul>\n<li>ä¸€èˆ¬åœ¨goroutineå³å°†ç»“æŸæ—¶æ‰§è¡Œï¼Œå¯é…åˆ<code>defer</code>å…³é”®å­—å…±åŒä½¿ç”¨</li>\n</ul>\n</li>\n<li><code>Wait()</code>ï¼šé˜»å¡å½“å‰goroutineç›´è‡³å†…éƒ¨è®¡æ•°å™¨å‡å°‘è‡³0</li>\n</ul>\n<p>âš ï¸ï¼šè°ƒç”¨<code>Wait()</code> å‡½æ•°å¯èƒ½å¯¼è‡´æ­»é”ï¼Œé€ æˆç¨‹åºå´©æºƒ</p>\n<h2 id=\"Goå¹¶å‘çš„å®ç°åŸç†\"><a href=\"#Goå¹¶å‘çš„å®ç°åŸç†\" class=\"headerlink\" title=\"Goå¹¶å‘çš„å®ç°åŸç†\"></a>Goå¹¶å‘çš„å®ç°åŸç†</h2><blockquote>\n<p>DO NOT COMMUNICATE BY SHARING MEMORY; INSTEAD, SHARE MEMORY BY COMMUNICATING. </p>\n</blockquote>\n<p>åœ¨Goä¸­æœ‰ä¸¤ç§å¹¶å‘å½¢å¼ï¼šä¼ ç»Ÿå…±äº«å†…å­˜çš„æ–¹å¼å’ŒCSPï¼ˆ<code>communicating sequential processes</code>ï¼‰å¹¶å‘æ¨¡å‹</p>\n<h3 id=\"å…±äº«å†…å­˜\"><a href=\"#å…±äº«å†…å­˜\" class=\"headerlink\" title=\"å…±äº«å†…å­˜\"></a>å…±äº«å†…å­˜</h3><p>åœ¨å¤šä¸ªçº¿ç¨‹å…±äº«å†…å­˜ä»¥å…±äº«æ•°æ®çš„æ¨¡å¼ä¸‹ï¼Œé€šè¿‡<strong>åŠ é”</strong>å®ç°å¹¶å‘å®‰å…¨</p>\n<p>åœ¨Goä¸­æœ‰ä¸¤ç§é”ï¼š<strong>äº’æ–¥é”ï¼ˆMutexï¼‰</strong>ã€<strong>è¯»å†™é”ï¼ˆRWMutexï¼‰</strong></p>\n<p>ä¸¤ç§é”çš„ä½¿ç”¨æ–¹å¼å¦‚ä¸‹ï¼š</p>\n<figure class=\"highlight go\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\">// Mutex</span></span><br><span class=\"line\">\t<span class=\"keyword\">var</span> mux sync.Mutex</span><br><span class=\"line\">\tmux.Lock()</span><br><span class=\"line\">\t<span class=\"comment\">// do something</span></span><br><span class=\"line\">\tmux.Unlock()</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\">// RWMutx</span></span><br><span class=\"line\">\t<span class=\"keyword\">var</span> mux sync.RWMutex</span><br><span class=\"line\">\tmux.RLock()</span><br><span class=\"line\">\t<span class=\"comment\">// å…è®¸å¤šä¸ªè¯»è€…</span></span><br><span class=\"line\">\tmux.RUnlock()</span><br><span class=\"line\">\tmux.Lock()</span><br><span class=\"line\">\t<span class=\"comment\">// åªæœ‰ä¸€ä¸ªå†™è€…</span></span><br><span class=\"line\">\tmux.Unlock()</span><br></pre></td></tr></table></figure>\n\n<p>åŒºåˆ«ï¼šåªæœ‰ä¸€ä¸ªgoroutineèƒ½æ‹¿åˆ°<strong>äº’æ–¥é”</strong>ï¼Œå…¶ä»–goroutineåˆ™ä¼šè¢«é˜»å¡ï¼›å…è®¸æœ‰å¤šä¸ªgoroutineæ‹¿åˆ°<strong>è¯»é”</strong>ï¼Œè€Œåªæœ‰ä¸€ä¸ªgoroutineèƒ½æ‹¿åˆ°<strong>å†™é”</strong></p>\n<p>âš ï¸ï¼šå¦‚æœå°†å¸¦æœ‰é”ç»“æ„çš„å˜é‡èµ‹å€¼ç»™å…¶ä»–å˜é‡ï¼Œ<strong>é”çš„çŠ¶æ€ä¼šè¢«å¤åˆ¶</strong></p>\n<figure class=\"highlight go\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"function\"><span class=\"keyword\">func</span> <span class=\"title\">main</span><span class=\"params\">()</span></span> &#123;</span><br><span class=\"line\">\t<span class=\"keyword\">var</span> mux sync.Mutex</span><br><span class=\"line\">\t<span class=\"keyword\">var</span> wg sync.WaitGroup</span><br><span class=\"line\">\t<span class=\"keyword\">defer</span> mux.Unlock()</span><br><span class=\"line\">\tmux.Lock()</span><br><span class=\"line\">\twg.Add(<span class=\"number\">1</span>)</span><br><span class=\"line\">\t<span class=\"keyword\">go</span> <span class=\"function\"><span class=\"keyword\">func</span><span class=\"params\">(mux sync.Mutex)</span></span> &#123;</span><br><span class=\"line\">\t\t<span class=\"keyword\">defer</span> <span class=\"function\"><span class=\"keyword\">func</span><span class=\"params\">()</span></span> &#123;</span><br><span class=\"line\">\t\t\tmux.Unlock()</span><br><span class=\"line\">\t\t\twg.Done()</span><br><span class=\"line\">\t\t&#125;()</span><br><span class=\"line\">\t\tmux.Lock() <span class=\"comment\">// deadlock</span></span><br><span class=\"line\">\t&#125;(mux)</span><br><span class=\"line\">\twg.Wait()</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n\n\n\n<h3 id=\"channel\"><a href=\"#channel\" class=\"headerlink\" title=\"channel\"></a>channel</h3><p>ç®€å•åœ°è¯´ï¼Œchannelå°±æ˜¯<strong>æ”¶å‘æ•°æ®çš„é€šé“</strong></p>\n<p>å£°æ˜ä¸€ä¸ªchannelè¦ä½¿ç”¨<code>make</code>å‡½æ•°è¿›è¡Œ<strong>åˆå§‹åŒ–</strong>ï¼Œå¦åˆ™å£°æ˜å‡ºæ¥çš„channelä¸º<code>nil</code></p>\n<figure class=\"highlight go\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">var</span> ch <span class=\"keyword\">chan</span> <span class=\"type\">int</span></span><br><span class=\"line\"><span class=\"keyword\">var</span> ch [size]<span class=\"keyword\">chan</span> <span class=\"type\">int</span></span><br><span class=\"line\"></span><br><span class=\"line\">ch = <span class=\"built_in\">make</span>(<span class=\"keyword\">chan</span> <span class=\"type\">int</span>, size)</span><br></pre></td></tr></table></figure>\n\n<h4 id=\"å¸¸è§çš„ä½¿ç”¨æ–¹æ³•\"><a href=\"#å¸¸è§çš„ä½¿ç”¨æ–¹æ³•\" class=\"headerlink\" title=\"å¸¸è§çš„ä½¿ç”¨æ–¹æ³•\"></a>å¸¸è§çš„ä½¿ç”¨æ–¹æ³•</h4><p>ğŸ•ï¼š</p>\n<figure class=\"highlight go\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">ch &lt;- <span class=\"number\">1</span> <span class=\"comment\">// å†™å…¥ä¸€ä¸ªæ•°æ®</span></span><br><span class=\"line\">v := &lt;-ch <span class=\"comment\">// è¯»å–ä¸€ä¸ªæ•°æ®</span></span><br></pre></td></tr></table></figure>\n\n<p>âš ï¸ï¼šå¦‚æœchannelæ²¡æœ‰ç¼“å†²åŒºï¼Œé‚£ä¹ˆå†™æ•°æ®å’Œè¯»æ•°æ®å¿…å®šæ˜¯æˆå¯¹å‡ºç°çš„</p>\n<figure class=\"highlight go\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"built_in\">close</span>(ch) <span class=\"comment\">// å…³é—­é€šé“</span></span><br></pre></td></tr></table></figure>\n\n<p>å½“å…³é—­é€šé“ä¹‹åï¼Œ<strong>ä¸èƒ½å†å‘é€šé“ä¸­å†™æ•°æ®ï¼Œä½†æ˜¯èƒ½ä»é€šé“ä¸­è¯»æ•°æ®ï¼Œå¦‚æœé€šé“ä¸­è¿˜æœ‰å€¼åˆ™è¯»å‡ºå¯¹åº”çš„å€¼ï¼Œå¦åˆ™è¯»å‡ºé›¶å€¼</strong></p>\n<p>è¿™å°±å¯¼è‡´ä¸€ä¸ªé—®é¢˜ï¼šå½“æˆ‘è¯»å‡ºé›¶å€¼æ—¶ï¼Œæ— æ³•åˆ¤æ–­å‡ºè¿™æ˜¯å› ä¸º<strong>é€šé“å…³é—­è¿˜æ˜¯å†™å…¥çš„å€¼ç¡®ç¡®å®å®å°±æ˜¯é›¶å€¼</strong></p>\n<p>ğŸ•‘ï¼šæ•…éœ€è¦ä½¿ç”¨é€šé“çš„<strong>åˆ¤å®šè¯»æ³•</strong>ï¼š</p>\n<figure class=\"highlight go\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">val, ok := &lt;-ch</span><br><span class=\"line\"><span class=\"keyword\">if</span> ok &#123;</span><br><span class=\"line\">    fmt.Printf(<span class=\"string\">&quot;get val %d\\n&quot;</span>, val)</span><br><span class=\"line\">&#125; <span class=\"keyword\">else</span> &#123;</span><br><span class=\"line\">    fmt.Println(<span class=\"string\">&quot;closed&quot;</span>)</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n\n<p>å½“ç®¡é“å…³é—­ä¸”è¯»å–å®Œæ¯•åï¼Œokä¸º<code>false</code></p>\n<p>ğŸ•’ï¼šæœ‰çš„æ—¶å€™æŸä¸€ä¸ªgoroutineéœ€è¦ä¸€ç›´ç›‘å¬ç€ç®¡é“ä¸­çš„æ•°æ®ï¼Œåªè¦ç®¡é“ä¸­æœ‰æ•°æ®å°±ç«‹é©¬è¯»å–å‡ºæ¥ï¼Œç›´è‡³ç®¡é“å…³é—­</p>\n<p>åœ¨Goä¸­å¯ä»¥ä½¿ç”¨<code>fro range</code>åšåˆ°æŒç»­ç›‘å¬ç®¡é“ä¸­çš„æ•°æ®</p>\n<figure class=\"highlight go\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"function\"><span class=\"keyword\">func</span> <span class=\"title\">main</span><span class=\"params\">()</span></span> &#123;</span><br><span class=\"line\">\tch := <span class=\"built_in\">make</span>(<span class=\"keyword\">chan</span> <span class=\"type\">int</span>)</span><br><span class=\"line\">\t<span class=\"keyword\">go</span> <span class=\"function\"><span class=\"keyword\">func</span><span class=\"params\">()</span></span> &#123;</span><br><span class=\"line\">\t\t<span class=\"keyword\">for</span> v := <span class=\"keyword\">range</span> ch &#123;</span><br><span class=\"line\">\t\t\tfmt.Println(v)</span><br><span class=\"line\">\t\t&#125;</span><br><span class=\"line\">\t&#125;()</span><br><span class=\"line\">\ttime.Sleep(time.Second)</span><br><span class=\"line\">\tch &lt;- <span class=\"number\">1</span></span><br><span class=\"line\">\ttime.Sleep(time.Second)</span><br><span class=\"line\">\tch &lt;- <span class=\"number\">2</span></span><br><span class=\"line\">\t<span class=\"built_in\">close</span>(ch)</span><br><span class=\"line\">\ttime.Sleep(time.Second)</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n\n<h3 id=\"åŒå‘channelå’Œå•å‘channel\"><a href=\"#åŒå‘channelå’Œå•å‘channel\" class=\"headerlink\" title=\"åŒå‘channelå’Œå•å‘channel\"></a>åŒå‘channelå’Œå•å‘channel</h3><p>channelå¯ä»¥æ ¹æ®å…¶åŠŸèƒ½åˆ’åˆ†ä¸º<strong>åŒå‘channelå’Œå•å‘channel</strong>ï¼Œå…¶ä¸­åŒå‘channelæ—¢å¯ä»¥è¯»åˆå¯ä»¥å†™ï¼Œè€Œå•å‘channelè¦ä¹ˆåªè¯»ï¼Œè¦ä¹ˆåªå†™</p>\n<p>å¯ä»¥é€šè¿‡<strong>ç±»å‹åˆ«å</strong>çš„æ–¹å¼å®šä¹‰å•å‘channel</p>\n<p>ğŸŒ°ï¼š</p>\n<figure class=\"highlight go\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">type</span> RChannel = &lt;-<span class=\"keyword\">chan</span> <span class=\"type\">int</span></span><br><span class=\"line\"><span class=\"keyword\">type</span> WChannel = <span class=\"keyword\">chan</span>&lt;- <span class=\"type\">int</span></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"function\"><span class=\"keyword\">func</span> <span class=\"title\">main</span><span class=\"params\">()</span></span> &#123;</span><br><span class=\"line\">\tch := <span class=\"built_in\">make</span>(<span class=\"keyword\">chan</span> <span class=\"type\">int</span>)</span><br><span class=\"line\">\t<span class=\"keyword\">go</span> <span class=\"function\"><span class=\"keyword\">func</span><span class=\"params\">()</span></span> &#123;</span><br><span class=\"line\">\t\t<span class=\"keyword\">var</span> w WChannel</span><br><span class=\"line\">\t\tw = ch</span><br><span class=\"line\">\t\tw &lt;- <span class=\"number\">1</span></span><br><span class=\"line\">\t&#125;()</span><br><span class=\"line\">\t<span class=\"keyword\">go</span> <span class=\"function\"><span class=\"keyword\">func</span><span class=\"params\">()</span></span> &#123;</span><br><span class=\"line\">\t\t<span class=\"keyword\">var</span> r RChannel</span><br><span class=\"line\">\t\tr = ch</span><br><span class=\"line\">\t\tfmt.Println(&lt;-r)</span><br><span class=\"line\">\t&#125;()</span><br><span class=\"line\">\ttime.Sleep(time.Second)</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n\n<h3 id=\"æœ‰ç¼“å†²channelå’Œæ— ç¼“å†²channel\"><a href=\"#æœ‰ç¼“å†²channelå’Œæ— ç¼“å†²channel\" class=\"headerlink\" title=\"æœ‰ç¼“å†²channelå’Œæ— ç¼“å†²channel\"></a>æœ‰ç¼“å†²channelå’Œæ— ç¼“å†²channel</h3><p>æ— ç¼“å†²channelå¯ä»¥ç†è§£ä¸ºæ˜¯<strong>åŒæ­¥æ¨¡å¼</strong>ï¼Œå³ä¸€ä¸ªå†™ï¼Œå¦ä¸€ä¸ªç«‹é©¬è¯»ï¼Œå¦‚æœæ²¡æœ‰è¯»è€…ï¼Œå†™è€…ä¹Ÿä¼šè¢«é˜»å¡</p>\n<p>æœ‰ç¼“å†²channelåˆ™å¯ä»¥ä½œä¸º<strong>å¼‚æ­¥æ¨¡å¼</strong>ï¼Œåœ¨ç¼“å†²åŒºæœªæ»¡çš„æƒ…å†µä¸‹ï¼Œå³ä½¿æ²¡æœ‰è¯»è€…ï¼Œå†™è€…ä¹Ÿèƒ½å‘é€šé“ä¸­å†™å…¥æ•°æ®</p>\n<p>ä½†å½“ç¼“å†²åŒºæ»¡äº†åï¼Œå†™è€…æƒ³è¦ç»§ç»­å†™å…¥æ•°æ®åˆ™ä¼šè¢«é˜»å¡ï¼Œé€€åŒ–æˆ<strong>åŒæ­¥æ¨¡å¼</strong></p>\n<h3 id=\"æ€»ç»“\"><a href=\"#æ€»ç»“\" class=\"headerlink\" title=\"æ€»ç»“\"></a>æ€»ç»“</h3><ul>\n<li>å…³é—­ä¸€ä¸ªæœªåˆå§‹åŒ–çš„channelä¼šäº§ç”Ÿpanic</li>\n<li>channelåªèƒ½å…³é—­ä¸€æ¬¡ï¼Œå¯¹åŒä¸€channelå¤šæ¬¡å…³é—­ä¼šå‘ç”Ÿpanic</li>\n<li>å‘ä¸€ä¸ªå·²ç»å…³é—­çš„channelå†™å…¥æ•°æ®ï¼Œä¼šå‘ç”Ÿpanic</li>\n<li>ä»ä¸€ä¸ªå·²ç»å…³é—­çš„channelè¯»å–æ•°æ®ï¼Œä¼šè¯»å‡ºç¼“å†²åŒºä¸­çš„å€¼ï¼Œå½“ç¼“å†²åŒºæ²¡æœ‰æ•°æ®ï¼ˆæˆ–æ²¡æœ‰ç¼“å†²åŒºï¼‰æ—¶ï¼Œåˆ™ä¼šè¯»å‡ºå¯¹åº”ç±»å‹çš„é›¶å€¼</li>\n<li>channelçš„è¯»ç«¯å’Œå†™ç«¯éƒ½å¯ä»¥ç”±å¤šä¸ªgoroutineæ“ä½œï¼Œå½“å†™ç«¯è¢«ä¸€ä¸ªgoroutineå…³é—­æ—¶ï¼Œè¯»ç«¯çš„å¤šä¸ªgoroutineéƒ½ä¼šæ”¶åˆ°ç®¡é“å…³é—­çš„æ¶ˆæ¯</li>\n<li>channelæ˜¯å¹¶å‘å®‰å…¨çš„</li>\n</ul>\n"},{"top":3,"publish":false,"_content":"# æ›´å¤šèƒ½åŠ›\n\nä¸»é¢˜è¿˜æä¾›äº†è®¸å¤šå¼€ç®±å³ç”¨çš„èƒ½åŠ›ï¼Œè¯¦è§æ–‡æ¡£ https://theme.sugarat.top\n\n* [ä¸»é¢˜é…ç½®ï¼šé¦–é¡µ&æ–‡ç« ](https://theme.sugarat.top/config/frontmatter.html) - ä¸»é¢˜æä¾›çš„ä¸€äº› `frontmatter`\n* [ä¸»é¢˜é…ç½®ï¼šå…¨å±€](https://theme.sugarat.top/config/global.html) - ä¸»é¢˜æä¾›çš„é¢å¤–èƒ½åŠ›\n* [ä¸»é¢˜é…ç½®ï¼šæ ·å¼](https://theme.sugarat.top/config/style.html) - è‡ªå®šä¹‰åšå®¢æ ·å¼ä»‹ç»\n* [ä¸»é¢˜é…ç½®ï¼šç»„ä»¶èƒ½åŠ›](https://theme.sugarat.top/config/component.html) - è‡ªå®šä¹‰åšå®¢æ ·å¼ä»‹ç»","source":"_posts/more.md","raw":"---\ntop: 3\npublish: false\n---\n# æ›´å¤šèƒ½åŠ›\n\nä¸»é¢˜è¿˜æä¾›äº†è®¸å¤šå¼€ç®±å³ç”¨çš„èƒ½åŠ›ï¼Œè¯¦è§æ–‡æ¡£ https://theme.sugarat.top\n\n* [ä¸»é¢˜é…ç½®ï¼šé¦–é¡µ&æ–‡ç« ](https://theme.sugarat.top/config/frontmatter.html) - ä¸»é¢˜æä¾›çš„ä¸€äº› `frontmatter`\n* [ä¸»é¢˜é…ç½®ï¼šå…¨å±€](https://theme.sugarat.top/config/global.html) - ä¸»é¢˜æä¾›çš„é¢å¤–èƒ½åŠ›\n* [ä¸»é¢˜é…ç½®ï¼šæ ·å¼](https://theme.sugarat.top/config/style.html) - è‡ªå®šä¹‰åšå®¢æ ·å¼ä»‹ç»\n* [ä¸»é¢˜é…ç½®ï¼šç»„ä»¶èƒ½åŠ›](https://theme.sugarat.top/config/component.html) - è‡ªå®šä¹‰åšå®¢æ ·å¼ä»‹ç»","slug":"more","published":1,"date":"2024-12-27T11:03:15.344Z","updated":"2024-12-27T11:03:15.344Z","title":"","comments":1,"layout":"post","photos":[],"_id":"cm6c7md6h000ba5t298167woj","content":"<h1 id=\"æ›´å¤šèƒ½åŠ›\"><a href=\"#æ›´å¤šèƒ½åŠ›\" class=\"headerlink\" title=\"æ›´å¤šèƒ½åŠ›\"></a>æ›´å¤šèƒ½åŠ›</h1><p>ä¸»é¢˜è¿˜æä¾›äº†è®¸å¤šå¼€ç®±å³ç”¨çš„èƒ½åŠ›ï¼Œè¯¦è§æ–‡æ¡£ <a href=\"https://theme.sugarat.top/\">https://theme.sugarat.top</a></p>\n<ul>\n<li><a href=\"https://theme.sugarat.top/config/frontmatter.html\">ä¸»é¢˜é…ç½®ï¼šé¦–é¡µ&amp;æ–‡ç« </a> - ä¸»é¢˜æä¾›çš„ä¸€äº› <code>frontmatter</code></li>\n<li><a href=\"https://theme.sugarat.top/config/global.html\">ä¸»é¢˜é…ç½®ï¼šå…¨å±€</a> - ä¸»é¢˜æä¾›çš„é¢å¤–èƒ½åŠ›</li>\n<li><a href=\"https://theme.sugarat.top/config/style.html\">ä¸»é¢˜é…ç½®ï¼šæ ·å¼</a> - è‡ªå®šä¹‰åšå®¢æ ·å¼ä»‹ç»</li>\n<li><a href=\"https://theme.sugarat.top/config/component.html\">ä¸»é¢˜é…ç½®ï¼šç»„ä»¶èƒ½åŠ›</a> - è‡ªå®šä¹‰åšå®¢æ ·å¼ä»‹ç»</li>\n</ul>\n","excerpt":"","more":"<h1 id=\"æ›´å¤šèƒ½åŠ›\"><a href=\"#æ›´å¤šèƒ½åŠ›\" class=\"headerlink\" title=\"æ›´å¤šèƒ½åŠ›\"></a>æ›´å¤šèƒ½åŠ›</h1><p>ä¸»é¢˜è¿˜æä¾›äº†è®¸å¤šå¼€ç®±å³ç”¨çš„èƒ½åŠ›ï¼Œè¯¦è§æ–‡æ¡£ <a href=\"https://theme.sugarat.top/\">https://theme.sugarat.top</a></p>\n<ul>\n<li><a href=\"https://theme.sugarat.top/config/frontmatter.html\">ä¸»é¢˜é…ç½®ï¼šé¦–é¡µ&amp;æ–‡ç« </a> - ä¸»é¢˜æä¾›çš„ä¸€äº› <code>frontmatter</code></li>\n<li><a href=\"https://theme.sugarat.top/config/global.html\">ä¸»é¢˜é…ç½®ï¼šå…¨å±€</a> - ä¸»é¢˜æä¾›çš„é¢å¤–èƒ½åŠ›</li>\n<li><a href=\"https://theme.sugarat.top/config/style.html\">ä¸»é¢˜é…ç½®ï¼šæ ·å¼</a> - è‡ªå®šä¹‰åšå®¢æ ·å¼ä»‹ç»</li>\n<li><a href=\"https://theme.sugarat.top/config/component.html\">ä¸»é¢˜é…ç½®ï¼šç»„ä»¶èƒ½åŠ›</a> - è‡ªå®šä¹‰åšå®¢æ ·å¼ä»‹ç»</li>\n</ul>\n"},{"description":"ä»‹ç»ä¸€ä¸‹è‡ªå®šä¹‰ä¸»é¢˜çš„éƒ¨åˆ†æ ·å¼","title":"ğŸ”§ ä¸»é¢˜æ ·å¼å®šåˆ¶","readingTime":false,"recommend":3,"publish":false,"_content":"\n# æ ·å¼é…ç½®\næ ·å¼è‡ªå®šä¹‰ï¼Œå‚è€ƒ[å®˜æ–¹æ–‡æ¡£æ€è·¯](https://vitepress.dev/guide/extending-default-theme#customizing-css)\n\nåœ¨ `.vitepress/theme/index.ts` ä¸­å¼•å…¥è‡ªå®šä¹‰çš„æ ·å¼æ–‡ä»¶ï¼Œè¦†ç›–é»˜è®¤ä¸»é¢˜æ ·å¼å³å¯\n\nä¾‹å¦‚:\n\nåšå®¢æ¨¡æ¿é‡Œï¼Œæä¾›äº†ä¸€ä¸ªå¦‚ä¸‹ä¾‹å­\n\n```ts\n// .vitepress/theme/index.ts\nimport BlogTheme from '@sugarat/theme'\n\n// è‡ªå®šä¹‰æ ·å¼é‡è½½ // [!code focus]\nimport './style.scss' // [!code focus]\n\nexport default BlogTheme\n```\n\né‡Œé¢æœ‰å¦‚ä¸‹å†…å®¹\n```scss\n.VPHome {\n  // è‡ªå®šä¹‰é¦–é¡µèƒŒæ™¯å›¾\n  &::before {\n    // å›¾ç‰‡æ¥æºï¼šhttps://zhuanlan.zhihu.com/p/54060187\n    background-image: url(./assets/bg.webp);\n    background-size: cover;\n  }\n  // å®šä¹‰é®ç½©æ ·å¼\n  background: radial-gradient(\n    ellipse,\n    rgba(var(--bg-gradient-home), 1) 0%,\n    rgba(var(--bg-gradient-home), 0) 150%\n  );\n}\n```\nè§£é™¤æ–‡ä»¶`index.ts` ä¸­`import './style.scss'` æ³¨é‡Šåï¼Œå°±èƒ½çœ‹åˆ°æ¨¡æ¿é¦–é¡µèƒŒæ™¯å›¾å‘ç”Ÿäº†å˜åŒ–\n\n![](https://img.cdn.sugarat.top/mdImg/MTY3Njk5MTAzODkzOQ==676991038939)\n\n## é¦–é¡µèƒŒæ™¯\n```scss\n.VPHome {// [!code focus]\n  &::before {// [!code focus]\n    background-image: url(./assets/bg.webp); // [!code focus]\n    background-size: cover; // [!code focus]\n  } // [!code focus]\n} // [!code focus]\n\n.VPHome {\n  // å®šä¹‰é®ç½©æ ·å¼ï¼Œæ§åˆ¶å›¾ç‰‡å±•ç¤ºçš„ç¨‹åº¦\n  background: radial-gradient(\n    ellipse,\n    rgba(var(--bg-gradient-home), 1) 0%,\n    rgba(var(--bg-gradient-home), 0) 150%\n  );\n}\n```\n\n## ç½®é¡¶æ ·å¼\nå¯ä»¥è‡ªè¡Œä¿®æ”¹ç½®é¡¶iconçš„æ ·å¼\n```scss\n.blog-item .pin.pin::before {\n  // ä¿®æ”¹é¢œè‰²\n  background-image: linear-gradient(red, red);\n}\n```\n![](https://img.cdn.sugarat.top/mdImg/MTY3NzA3OTExMjgxMA==677079112810)\n\n```scss\n// éšè—ç½®é¡¶çš„icon\n.blog-item .pin.pin::before {\n  display: none;\n}\n```\n![](https://img.cdn.sugarat.top/mdImg/MTY3NzA3OTIwODAzNg==677079208036)\n\n\n## ä¸»é¢˜è‰²\nvitepress æœ€æ–°çš„é»˜è®¤ä¸»é¢˜è‰²åç´«è‰²ï¼Œçœ‹ç€æ„Ÿè§‰æœ‰ç‚¹ä¸ä¹ æƒ¯\n\n![](https://img.cdn.sugarat.top/mdImg/MTY5MTkyODQ0ODUzOQ==691928448539)\n\nä¸»é¢˜åŒ…å†…ç½®äº†ä¸€äº›ä¸»é¢˜è‰²ï¼Œå¯ä»¥è‡ªè¡Œé€‰æ‹©ï¼Œè¯¦è§[å…¨å±€é…ç½®:themeColor](https://theme.sugarat.top/config/global.html#themecolor)\n\nå¦‚æœå†…ç½®çš„ä¸æ»¡è¶³è¦æ±‚ï¼Œä¹Ÿå¯ä»¥è¿›è¡Œè‡ªå®šä¹‰ï¼Œè‡ªå®šä¹‰çš„æ–¹å¼æ˜¯é€šè¿‡è¦†ç›–å˜é‡çš„æ–¹å¼\n\nä¾‹å¦‚å¯ä»¥åˆ›å»º`user-theme.css`æ–‡ä»¶ï¼Œå†…å®¹å¦‚ä¸‹\n```css\n/* æ‰€æœ‰å˜é‡ï¼šhttps://github.com/vuejs/vitepress/blob/main/src/client/theme-default/styles/vars.css */\n/* è‡ªå®šä¹‰ä¸»é¢˜è‰²ç¤ºä¾‹ï¼Œå¦‚ä¸‹ */\n\n/* æµ…è‰²æ¨¡å¼ä½¿ç”¨çš„å˜é‡ */\nhtml[theme] {\n  --vp-c-user-1:red;\n  --vp-c-user-2:blue;\n  --vp-c-user-3:green;\n  --vp-c-user-soft:rgba(255,0,0,.5);\n}\n\n/* æ·±è‰²æ¨¡å¼ä½¿ç”¨çš„å˜é‡ */\nhtml[theme].dark {\n  --vp-c-user-1:yellow;\n  --vp-c-user-2:purple;\n  --vp-c-user-3:orange;\n  --vp-c-user-soft:rgba(255,255,0,.5);\n}\n\n/* è¦†ç›–é»˜è®¤å˜é‡ */\nhtml[theme],html[theme].dark {\n  --vp-c-brand-1: var(--vp-c-user-1);\n  --vp-c-brand-2: var(--vp-c-user-2);\n  --vp-c-brand-3: var(--vp-c-user-3);\n  --vp-c-brand-soft: var(--vp-c-user-soft);\n}\n```\nå°†å…¶å¼•å…¥åˆ°`.vitepress/theme/index.ts`ä¸­å³å¯\n\n```ts\nimport BlogTheme from '@sugarat/theme'\n\n// å¯¼å…¥è‡ªå®šä¹‰ä¸»é¢˜è‰² // [!code focus]\nimport './user-theme.css' // [!code focus]\n\nexport default BlogTheme\n```\n\n## More\n... wait a moment","source":"_posts/style.md","raw":"---\ndescription: ä»‹ç»ä¸€ä¸‹è‡ªå®šä¹‰ä¸»é¢˜çš„éƒ¨åˆ†æ ·å¼\ntitle: ğŸ”§ ä¸»é¢˜æ ·å¼å®šåˆ¶\nreadingTime: false\ntag:\n - é…ç½®\nrecommend: 3\npublish: false\n---\n\n# æ ·å¼é…ç½®\næ ·å¼è‡ªå®šä¹‰ï¼Œå‚è€ƒ[å®˜æ–¹æ–‡æ¡£æ€è·¯](https://vitepress.dev/guide/extending-default-theme#customizing-css)\n\nåœ¨ `.vitepress/theme/index.ts` ä¸­å¼•å…¥è‡ªå®šä¹‰çš„æ ·å¼æ–‡ä»¶ï¼Œè¦†ç›–é»˜è®¤ä¸»é¢˜æ ·å¼å³å¯\n\nä¾‹å¦‚:\n\nåšå®¢æ¨¡æ¿é‡Œï¼Œæä¾›äº†ä¸€ä¸ªå¦‚ä¸‹ä¾‹å­\n\n```ts\n// .vitepress/theme/index.ts\nimport BlogTheme from '@sugarat/theme'\n\n// è‡ªå®šä¹‰æ ·å¼é‡è½½ // [!code focus]\nimport './style.scss' // [!code focus]\n\nexport default BlogTheme\n```\n\né‡Œé¢æœ‰å¦‚ä¸‹å†…å®¹\n```scss\n.VPHome {\n  // è‡ªå®šä¹‰é¦–é¡µèƒŒæ™¯å›¾\n  &::before {\n    // å›¾ç‰‡æ¥æºï¼šhttps://zhuanlan.zhihu.com/p/54060187\n    background-image: url(./assets/bg.webp);\n    background-size: cover;\n  }\n  // å®šä¹‰é®ç½©æ ·å¼\n  background: radial-gradient(\n    ellipse,\n    rgba(var(--bg-gradient-home), 1) 0%,\n    rgba(var(--bg-gradient-home), 0) 150%\n  );\n}\n```\nè§£é™¤æ–‡ä»¶`index.ts` ä¸­`import './style.scss'` æ³¨é‡Šåï¼Œå°±èƒ½çœ‹åˆ°æ¨¡æ¿é¦–é¡µèƒŒæ™¯å›¾å‘ç”Ÿäº†å˜åŒ–\n\n![](https://img.cdn.sugarat.top/mdImg/MTY3Njk5MTAzODkzOQ==676991038939)\n\n## é¦–é¡µèƒŒæ™¯\n```scss\n.VPHome {// [!code focus]\n  &::before {// [!code focus]\n    background-image: url(./assets/bg.webp); // [!code focus]\n    background-size: cover; // [!code focus]\n  } // [!code focus]\n} // [!code focus]\n\n.VPHome {\n  // å®šä¹‰é®ç½©æ ·å¼ï¼Œæ§åˆ¶å›¾ç‰‡å±•ç¤ºçš„ç¨‹åº¦\n  background: radial-gradient(\n    ellipse,\n    rgba(var(--bg-gradient-home), 1) 0%,\n    rgba(var(--bg-gradient-home), 0) 150%\n  );\n}\n```\n\n## ç½®é¡¶æ ·å¼\nå¯ä»¥è‡ªè¡Œä¿®æ”¹ç½®é¡¶iconçš„æ ·å¼\n```scss\n.blog-item .pin.pin::before {\n  // ä¿®æ”¹é¢œè‰²\n  background-image: linear-gradient(red, red);\n}\n```\n![](https://img.cdn.sugarat.top/mdImg/MTY3NzA3OTExMjgxMA==677079112810)\n\n```scss\n// éšè—ç½®é¡¶çš„icon\n.blog-item .pin.pin::before {\n  display: none;\n}\n```\n![](https://img.cdn.sugarat.top/mdImg/MTY3NzA3OTIwODAzNg==677079208036)\n\n\n## ä¸»é¢˜è‰²\nvitepress æœ€æ–°çš„é»˜è®¤ä¸»é¢˜è‰²åç´«è‰²ï¼Œçœ‹ç€æ„Ÿè§‰æœ‰ç‚¹ä¸ä¹ æƒ¯\n\n![](https://img.cdn.sugarat.top/mdImg/MTY5MTkyODQ0ODUzOQ==691928448539)\n\nä¸»é¢˜åŒ…å†…ç½®äº†ä¸€äº›ä¸»é¢˜è‰²ï¼Œå¯ä»¥è‡ªè¡Œé€‰æ‹©ï¼Œè¯¦è§[å…¨å±€é…ç½®:themeColor](https://theme.sugarat.top/config/global.html#themecolor)\n\nå¦‚æœå†…ç½®çš„ä¸æ»¡è¶³è¦æ±‚ï¼Œä¹Ÿå¯ä»¥è¿›è¡Œè‡ªå®šä¹‰ï¼Œè‡ªå®šä¹‰çš„æ–¹å¼æ˜¯é€šè¿‡è¦†ç›–å˜é‡çš„æ–¹å¼\n\nä¾‹å¦‚å¯ä»¥åˆ›å»º`user-theme.css`æ–‡ä»¶ï¼Œå†…å®¹å¦‚ä¸‹\n```css\n/* æ‰€æœ‰å˜é‡ï¼šhttps://github.com/vuejs/vitepress/blob/main/src/client/theme-default/styles/vars.css */\n/* è‡ªå®šä¹‰ä¸»é¢˜è‰²ç¤ºä¾‹ï¼Œå¦‚ä¸‹ */\n\n/* æµ…è‰²æ¨¡å¼ä½¿ç”¨çš„å˜é‡ */\nhtml[theme] {\n  --vp-c-user-1:red;\n  --vp-c-user-2:blue;\n  --vp-c-user-3:green;\n  --vp-c-user-soft:rgba(255,0,0,.5);\n}\n\n/* æ·±è‰²æ¨¡å¼ä½¿ç”¨çš„å˜é‡ */\nhtml[theme].dark {\n  --vp-c-user-1:yellow;\n  --vp-c-user-2:purple;\n  --vp-c-user-3:orange;\n  --vp-c-user-soft:rgba(255,255,0,.5);\n}\n\n/* è¦†ç›–é»˜è®¤å˜é‡ */\nhtml[theme],html[theme].dark {\n  --vp-c-brand-1: var(--vp-c-user-1);\n  --vp-c-brand-2: var(--vp-c-user-2);\n  --vp-c-brand-3: var(--vp-c-user-3);\n  --vp-c-brand-soft: var(--vp-c-user-soft);\n}\n```\nå°†å…¶å¼•å…¥åˆ°`.vitepress/theme/index.ts`ä¸­å³å¯\n\n```ts\nimport BlogTheme from '@sugarat/theme'\n\n// å¯¼å…¥è‡ªå®šä¹‰ä¸»é¢˜è‰² // [!code focus]\nimport './user-theme.css' // [!code focus]\n\nexport default BlogTheme\n```\n\n## More\n... wait a moment","slug":"style","published":1,"date":"2024-12-27T11:03:15.344Z","updated":"2024-12-27T11:03:15.344Z","comments":1,"layout":"post","photos":[],"_id":"cm6c7md6h000ca5t2a1jdepaq","content":"<h1 id=\"æ ·å¼é…ç½®\"><a href=\"#æ ·å¼é…ç½®\" class=\"headerlink\" title=\"æ ·å¼é…ç½®\"></a>æ ·å¼é…ç½®</h1><p>æ ·å¼è‡ªå®šä¹‰ï¼Œå‚è€ƒ<a href=\"https://vitepress.dev/guide/extending-default-theme#customizing-css\">å®˜æ–¹æ–‡æ¡£æ€è·¯</a></p>\n<p>åœ¨ <code>.vitepress/theme/index.ts</code> ä¸­å¼•å…¥è‡ªå®šä¹‰çš„æ ·å¼æ–‡ä»¶ï¼Œè¦†ç›–é»˜è®¤ä¸»é¢˜æ ·å¼å³å¯</p>\n<p>ä¾‹å¦‚:</p>\n<p>åšå®¢æ¨¡æ¿é‡Œï¼Œæä¾›äº†ä¸€ä¸ªå¦‚ä¸‹ä¾‹å­</p>\n<figure class=\"highlight ts\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\">// .vitepress/theme/index.ts</span></span><br><span class=\"line\"><span class=\"keyword\">import</span> <span class=\"title class_\">BlogTheme</span> <span class=\"keyword\">from</span> <span class=\"string\">&#x27;@sugarat/theme&#x27;</span></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\">// è‡ªå®šä¹‰æ ·å¼é‡è½½ // [!code focus]</span></span><br><span class=\"line\"><span class=\"keyword\">import</span> <span class=\"string\">&#x27;./style.scss&#x27;</span> <span class=\"comment\">// [!code focus]</span></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"keyword\">export</span> <span class=\"keyword\">default</span> <span class=\"title class_\">BlogTheme</span></span><br></pre></td></tr></table></figure>\n\n<p>é‡Œé¢æœ‰å¦‚ä¸‹å†…å®¹</p>\n<figure class=\"highlight scss\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"selector-class\">.VPHome</span> &#123;</span><br><span class=\"line\">  <span class=\"comment\">// è‡ªå®šä¹‰é¦–é¡µèƒŒæ™¯å›¾</span></span><br><span class=\"line\">  &amp;<span class=\"selector-pseudo\">::before</span> &#123;</span><br><span class=\"line\">    <span class=\"comment\">// å›¾ç‰‡æ¥æºï¼šhttps://zhuanlan.zhihu.com/p/54060187</span></span><br><span class=\"line\">    <span class=\"attribute\">background-image</span>: <span class=\"built_in\">url</span>(./assets/bg.webp);</span><br><span class=\"line\">    <span class=\"attribute\">background-size</span>: cover;</span><br><span class=\"line\">  &#125;</span><br><span class=\"line\">  <span class=\"comment\">// å®šä¹‰é®ç½©æ ·å¼</span></span><br><span class=\"line\">  <span class=\"attribute\">background</span>: <span class=\"built_in\">radial-gradient</span>(</span><br><span class=\"line\">    ellipse,</span><br><span class=\"line\">    <span class=\"built_in\">rgba</span>(<span class=\"built_in\">var</span>(--bg-gradient-home), <span class=\"number\">1</span>) <span class=\"number\">0%</span>,</span><br><span class=\"line\">    <span class=\"built_in\">rgba</span>(<span class=\"built_in\">var</span>(--bg-gradient-home), <span class=\"number\">0</span>) <span class=\"number\">150%</span></span><br><span class=\"line\">  );</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n<p>è§£é™¤æ–‡ä»¶<code>index.ts</code> ä¸­<code>import &#39;./style.scss&#39;</code> æ³¨é‡Šåï¼Œå°±èƒ½çœ‹åˆ°æ¨¡æ¿é¦–é¡µèƒŒæ™¯å›¾å‘ç”Ÿäº†å˜åŒ–</p>\n<p><img src=\"https://img.cdn.sugarat.top/mdImg/MTY3Njk5MTAzODkzOQ==676991038939\"></p>\n<h2 id=\"é¦–é¡µèƒŒæ™¯\"><a href=\"#é¦–é¡µèƒŒæ™¯\" class=\"headerlink\" title=\"é¦–é¡µèƒŒæ™¯\"></a>é¦–é¡µèƒŒæ™¯</h2><figure class=\"highlight scss\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"selector-class\">.VPHome</span> &#123;<span class=\"comment\">// [!code focus]</span></span><br><span class=\"line\">  &amp;<span class=\"selector-pseudo\">::before</span> &#123;<span class=\"comment\">// [!code focus]</span></span><br><span class=\"line\">    <span class=\"attribute\">background-image</span>: <span class=\"built_in\">url</span>(./assets/bg.webp); <span class=\"comment\">// [!code focus]</span></span><br><span class=\"line\">    <span class=\"attribute\">background-size</span>: cover; <span class=\"comment\">// [!code focus]</span></span><br><span class=\"line\">  &#125; <span class=\"comment\">// [!code focus]</span></span><br><span class=\"line\">&#125; <span class=\"comment\">// [!code focus]</span></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"selector-class\">.VPHome</span> &#123;</span><br><span class=\"line\">  <span class=\"comment\">// å®šä¹‰é®ç½©æ ·å¼ï¼Œæ§åˆ¶å›¾ç‰‡å±•ç¤ºçš„ç¨‹åº¦</span></span><br><span class=\"line\">  <span class=\"attribute\">background</span>: <span class=\"built_in\">radial-gradient</span>(</span><br><span class=\"line\">    ellipse,</span><br><span class=\"line\">    <span class=\"built_in\">rgba</span>(<span class=\"built_in\">var</span>(--bg-gradient-home), <span class=\"number\">1</span>) <span class=\"number\">0%</span>,</span><br><span class=\"line\">    <span class=\"built_in\">rgba</span>(<span class=\"built_in\">var</span>(--bg-gradient-home), <span class=\"number\">0</span>) <span class=\"number\">150%</span></span><br><span class=\"line\">  );</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n\n<h2 id=\"ç½®é¡¶æ ·å¼\"><a href=\"#ç½®é¡¶æ ·å¼\" class=\"headerlink\" title=\"ç½®é¡¶æ ·å¼\"></a>ç½®é¡¶æ ·å¼</h2><p>å¯ä»¥è‡ªè¡Œä¿®æ”¹ç½®é¡¶iconçš„æ ·å¼</p>\n<figure class=\"highlight scss\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"selector-class\">.blog-item</span> <span class=\"selector-class\">.pin</span><span class=\"selector-class\">.pin</span><span class=\"selector-pseudo\">::before</span> &#123;</span><br><span class=\"line\">  <span class=\"comment\">// ä¿®æ”¹é¢œè‰²</span></span><br><span class=\"line\">  <span class=\"attribute\">background-image</span>: <span class=\"built_in\">linear-gradient</span>(red, red);</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n<p><img src=\"https://img.cdn.sugarat.top/mdImg/MTY3NzA3OTExMjgxMA==677079112810\"></p>\n<figure class=\"highlight scss\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\">// éšè—ç½®é¡¶çš„icon</span></span><br><span class=\"line\"><span class=\"selector-class\">.blog-item</span> <span class=\"selector-class\">.pin</span><span class=\"selector-class\">.pin</span><span class=\"selector-pseudo\">::before</span> &#123;</span><br><span class=\"line\">  <span class=\"attribute\">display</span>: none;</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n<p><img src=\"https://img.cdn.sugarat.top/mdImg/MTY3NzA3OTIwODAzNg==677079208036\"></p>\n<h2 id=\"ä¸»é¢˜è‰²\"><a href=\"#ä¸»é¢˜è‰²\" class=\"headerlink\" title=\"ä¸»é¢˜è‰²\"></a>ä¸»é¢˜è‰²</h2><p>vitepress æœ€æ–°çš„é»˜è®¤ä¸»é¢˜è‰²åç´«è‰²ï¼Œçœ‹ç€æ„Ÿè§‰æœ‰ç‚¹ä¸ä¹ æƒ¯</p>\n<p><img src=\"https://img.cdn.sugarat.top/mdImg/MTY5MTkyODQ0ODUzOQ==691928448539\"></p>\n<p>ä¸»é¢˜åŒ…å†…ç½®äº†ä¸€äº›ä¸»é¢˜è‰²ï¼Œå¯ä»¥è‡ªè¡Œé€‰æ‹©ï¼Œè¯¦è§<a href=\"https://theme.sugarat.top/config/global.html#themecolor\">å…¨å±€é…ç½®:themeColor</a></p>\n<p>å¦‚æœå†…ç½®çš„ä¸æ»¡è¶³è¦æ±‚ï¼Œä¹Ÿå¯ä»¥è¿›è¡Œè‡ªå®šä¹‰ï¼Œè‡ªå®šä¹‰çš„æ–¹å¼æ˜¯é€šè¿‡è¦†ç›–å˜é‡çš„æ–¹å¼</p>\n<p>ä¾‹å¦‚å¯ä»¥åˆ›å»º<code>user-theme.css</code>æ–‡ä»¶ï¼Œå†…å®¹å¦‚ä¸‹</p>\n<figure class=\"highlight css\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\">/* æ‰€æœ‰å˜é‡ï¼šhttps://github.com/vuejs/vitepress/blob/main/src/client/theme-default/styles/vars.css */</span></span><br><span class=\"line\"><span class=\"comment\">/* è‡ªå®šä¹‰ä¸»é¢˜è‰²ç¤ºä¾‹ï¼Œå¦‚ä¸‹ */</span></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\">/* æµ…è‰²æ¨¡å¼ä½¿ç”¨çš„å˜é‡ */</span></span><br><span class=\"line\"><span class=\"selector-tag\">html</span><span class=\"selector-attr\">[theme]</span> &#123;</span><br><span class=\"line\">  <span class=\"attr\">--vp-c-user-1</span>:red;</span><br><span class=\"line\">  <span class=\"attr\">--vp-c-user-2</span>:blue;</span><br><span class=\"line\">  <span class=\"attr\">--vp-c-user-3</span>:green;</span><br><span class=\"line\">  <span class=\"attr\">--vp-c-user-soft</span>:<span class=\"built_in\">rgba</span>(<span class=\"number\">255</span>,<span class=\"number\">0</span>,<span class=\"number\">0</span>,.<span class=\"number\">5</span>);</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\">/* æ·±è‰²æ¨¡å¼ä½¿ç”¨çš„å˜é‡ */</span></span><br><span class=\"line\"><span class=\"selector-tag\">html</span><span class=\"selector-attr\">[theme]</span><span class=\"selector-class\">.dark</span> &#123;</span><br><span class=\"line\">  <span class=\"attr\">--vp-c-user-1</span>:yellow;</span><br><span class=\"line\">  <span class=\"attr\">--vp-c-user-2</span>:purple;</span><br><span class=\"line\">  <span class=\"attr\">--vp-c-user-3</span>:orange;</span><br><span class=\"line\">  <span class=\"attr\">--vp-c-user-soft</span>:<span class=\"built_in\">rgba</span>(<span class=\"number\">255</span>,<span class=\"number\">255</span>,<span class=\"number\">0</span>,.<span class=\"number\">5</span>);</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\">/* è¦†ç›–é»˜è®¤å˜é‡ */</span></span><br><span class=\"line\"><span class=\"selector-tag\">html</span><span class=\"selector-attr\">[theme]</span>,<span class=\"selector-tag\">html</span><span class=\"selector-attr\">[theme]</span><span class=\"selector-class\">.dark</span> &#123;</span><br><span class=\"line\">  <span class=\"attr\">--vp-c-brand-1</span>: <span class=\"built_in\">var</span>(--vp-c-user-<span class=\"number\">1</span>);</span><br><span class=\"line\">  <span class=\"attr\">--vp-c-brand-2</span>: <span class=\"built_in\">var</span>(--vp-c-user-<span class=\"number\">2</span>);</span><br><span class=\"line\">  <span class=\"attr\">--vp-c-brand-3</span>: <span class=\"built_in\">var</span>(--vp-c-user-<span class=\"number\">3</span>);</span><br><span class=\"line\">  <span class=\"attr\">--vp-c-brand-soft</span>: <span class=\"built_in\">var</span>(--vp-c-user-soft);</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n<p>å°†å…¶å¼•å…¥åˆ°<code>.vitepress/theme/index.ts</code>ä¸­å³å¯</p>\n<figure class=\"highlight ts\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">import</span> <span class=\"title class_\">BlogTheme</span> <span class=\"keyword\">from</span> <span class=\"string\">&#x27;@sugarat/theme&#x27;</span></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\">// å¯¼å…¥è‡ªå®šä¹‰ä¸»é¢˜è‰² // [!code focus]</span></span><br><span class=\"line\"><span class=\"keyword\">import</span> <span class=\"string\">&#x27;./user-theme.css&#x27;</span> <span class=\"comment\">// [!code focus]</span></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"keyword\">export</span> <span class=\"keyword\">default</span> <span class=\"title class_\">BlogTheme</span></span><br></pre></td></tr></table></figure>\n\n<h2 id=\"More\"><a href=\"#More\" class=\"headerlink\" title=\"More\"></a>More</h2><p>â€¦ wait a moment</p>\n","excerpt":"","more":"<h1 id=\"æ ·å¼é…ç½®\"><a href=\"#æ ·å¼é…ç½®\" class=\"headerlink\" title=\"æ ·å¼é…ç½®\"></a>æ ·å¼é…ç½®</h1><p>æ ·å¼è‡ªå®šä¹‰ï¼Œå‚è€ƒ<a href=\"https://vitepress.dev/guide/extending-default-theme#customizing-css\">å®˜æ–¹æ–‡æ¡£æ€è·¯</a></p>\n<p>åœ¨ <code>.vitepress/theme/index.ts</code> ä¸­å¼•å…¥è‡ªå®šä¹‰çš„æ ·å¼æ–‡ä»¶ï¼Œè¦†ç›–é»˜è®¤ä¸»é¢˜æ ·å¼å³å¯</p>\n<p>ä¾‹å¦‚:</p>\n<p>åšå®¢æ¨¡æ¿é‡Œï¼Œæä¾›äº†ä¸€ä¸ªå¦‚ä¸‹ä¾‹å­</p>\n<figure class=\"highlight ts\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\">// .vitepress/theme/index.ts</span></span><br><span class=\"line\"><span class=\"keyword\">import</span> <span class=\"title class_\">BlogTheme</span> <span class=\"keyword\">from</span> <span class=\"string\">&#x27;@sugarat/theme&#x27;</span></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\">// è‡ªå®šä¹‰æ ·å¼é‡è½½ // [!code focus]</span></span><br><span class=\"line\"><span class=\"keyword\">import</span> <span class=\"string\">&#x27;./style.scss&#x27;</span> <span class=\"comment\">// [!code focus]</span></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"keyword\">export</span> <span class=\"keyword\">default</span> <span class=\"title class_\">BlogTheme</span></span><br></pre></td></tr></table></figure>\n\n<p>é‡Œé¢æœ‰å¦‚ä¸‹å†…å®¹</p>\n<figure class=\"highlight scss\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"selector-class\">.VPHome</span> &#123;</span><br><span class=\"line\">  <span class=\"comment\">// è‡ªå®šä¹‰é¦–é¡µèƒŒæ™¯å›¾</span></span><br><span class=\"line\">  &amp;<span class=\"selector-pseudo\">::before</span> &#123;</span><br><span class=\"line\">    <span class=\"comment\">// å›¾ç‰‡æ¥æºï¼šhttps://zhuanlan.zhihu.com/p/54060187</span></span><br><span class=\"line\">    <span class=\"attribute\">background-image</span>: <span class=\"built_in\">url</span>(./assets/bg.webp);</span><br><span class=\"line\">    <span class=\"attribute\">background-size</span>: cover;</span><br><span class=\"line\">  &#125;</span><br><span class=\"line\">  <span class=\"comment\">// å®šä¹‰é®ç½©æ ·å¼</span></span><br><span class=\"line\">  <span class=\"attribute\">background</span>: <span class=\"built_in\">radial-gradient</span>(</span><br><span class=\"line\">    ellipse,</span><br><span class=\"line\">    <span class=\"built_in\">rgba</span>(<span class=\"built_in\">var</span>(--bg-gradient-home), <span class=\"number\">1</span>) <span class=\"number\">0%</span>,</span><br><span class=\"line\">    <span class=\"built_in\">rgba</span>(<span class=\"built_in\">var</span>(--bg-gradient-home), <span class=\"number\">0</span>) <span class=\"number\">150%</span></span><br><span class=\"line\">  );</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n<p>è§£é™¤æ–‡ä»¶<code>index.ts</code> ä¸­<code>import &#39;./style.scss&#39;</code> æ³¨é‡Šåï¼Œå°±èƒ½çœ‹åˆ°æ¨¡æ¿é¦–é¡µèƒŒæ™¯å›¾å‘ç”Ÿäº†å˜åŒ–</p>\n<p><img src=\"https://img.cdn.sugarat.top/mdImg/MTY3Njk5MTAzODkzOQ==676991038939\"></p>\n<h2 id=\"é¦–é¡µèƒŒæ™¯\"><a href=\"#é¦–é¡µèƒŒæ™¯\" class=\"headerlink\" title=\"é¦–é¡µèƒŒæ™¯\"></a>é¦–é¡µèƒŒæ™¯</h2><figure class=\"highlight scss\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"selector-class\">.VPHome</span> &#123;<span class=\"comment\">// [!code focus]</span></span><br><span class=\"line\">  &amp;<span class=\"selector-pseudo\">::before</span> &#123;<span class=\"comment\">// [!code focus]</span></span><br><span class=\"line\">    <span class=\"attribute\">background-image</span>: <span class=\"built_in\">url</span>(./assets/bg.webp); <span class=\"comment\">// [!code focus]</span></span><br><span class=\"line\">    <span class=\"attribute\">background-size</span>: cover; <span class=\"comment\">// [!code focus]</span></span><br><span class=\"line\">  &#125; <span class=\"comment\">// [!code focus]</span></span><br><span class=\"line\">&#125; <span class=\"comment\">// [!code focus]</span></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"selector-class\">.VPHome</span> &#123;</span><br><span class=\"line\">  <span class=\"comment\">// å®šä¹‰é®ç½©æ ·å¼ï¼Œæ§åˆ¶å›¾ç‰‡å±•ç¤ºçš„ç¨‹åº¦</span></span><br><span class=\"line\">  <span class=\"attribute\">background</span>: <span class=\"built_in\">radial-gradient</span>(</span><br><span class=\"line\">    ellipse,</span><br><span class=\"line\">    <span class=\"built_in\">rgba</span>(<span class=\"built_in\">var</span>(--bg-gradient-home), <span class=\"number\">1</span>) <span class=\"number\">0%</span>,</span><br><span class=\"line\">    <span class=\"built_in\">rgba</span>(<span class=\"built_in\">var</span>(--bg-gradient-home), <span class=\"number\">0</span>) <span class=\"number\">150%</span></span><br><span class=\"line\">  );</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n\n<h2 id=\"ç½®é¡¶æ ·å¼\"><a href=\"#ç½®é¡¶æ ·å¼\" class=\"headerlink\" title=\"ç½®é¡¶æ ·å¼\"></a>ç½®é¡¶æ ·å¼</h2><p>å¯ä»¥è‡ªè¡Œä¿®æ”¹ç½®é¡¶iconçš„æ ·å¼</p>\n<figure class=\"highlight scss\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"selector-class\">.blog-item</span> <span class=\"selector-class\">.pin</span><span class=\"selector-class\">.pin</span><span class=\"selector-pseudo\">::before</span> &#123;</span><br><span class=\"line\">  <span class=\"comment\">// ä¿®æ”¹é¢œè‰²</span></span><br><span class=\"line\">  <span class=\"attribute\">background-image</span>: <span class=\"built_in\">linear-gradient</span>(red, red);</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n<p><img src=\"https://img.cdn.sugarat.top/mdImg/MTY3NzA3OTExMjgxMA==677079112810\"></p>\n<figure class=\"highlight scss\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\">// éšè—ç½®é¡¶çš„icon</span></span><br><span class=\"line\"><span class=\"selector-class\">.blog-item</span> <span class=\"selector-class\">.pin</span><span class=\"selector-class\">.pin</span><span class=\"selector-pseudo\">::before</span> &#123;</span><br><span class=\"line\">  <span class=\"attribute\">display</span>: none;</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n<p><img src=\"https://img.cdn.sugarat.top/mdImg/MTY3NzA3OTIwODAzNg==677079208036\"></p>\n<h2 id=\"ä¸»é¢˜è‰²\"><a href=\"#ä¸»é¢˜è‰²\" class=\"headerlink\" title=\"ä¸»é¢˜è‰²\"></a>ä¸»é¢˜è‰²</h2><p>vitepress æœ€æ–°çš„é»˜è®¤ä¸»é¢˜è‰²åç´«è‰²ï¼Œçœ‹ç€æ„Ÿè§‰æœ‰ç‚¹ä¸ä¹ æƒ¯</p>\n<p><img src=\"https://img.cdn.sugarat.top/mdImg/MTY5MTkyODQ0ODUzOQ==691928448539\"></p>\n<p>ä¸»é¢˜åŒ…å†…ç½®äº†ä¸€äº›ä¸»é¢˜è‰²ï¼Œå¯ä»¥è‡ªè¡Œé€‰æ‹©ï¼Œè¯¦è§<a href=\"https://theme.sugarat.top/config/global.html#themecolor\">å…¨å±€é…ç½®:themeColor</a></p>\n<p>å¦‚æœå†…ç½®çš„ä¸æ»¡è¶³è¦æ±‚ï¼Œä¹Ÿå¯ä»¥è¿›è¡Œè‡ªå®šä¹‰ï¼Œè‡ªå®šä¹‰çš„æ–¹å¼æ˜¯é€šè¿‡è¦†ç›–å˜é‡çš„æ–¹å¼</p>\n<p>ä¾‹å¦‚å¯ä»¥åˆ›å»º<code>user-theme.css</code>æ–‡ä»¶ï¼Œå†…å®¹å¦‚ä¸‹</p>\n<figure class=\"highlight css\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\">/* æ‰€æœ‰å˜é‡ï¼šhttps://github.com/vuejs/vitepress/blob/main/src/client/theme-default/styles/vars.css */</span></span><br><span class=\"line\"><span class=\"comment\">/* è‡ªå®šä¹‰ä¸»é¢˜è‰²ç¤ºä¾‹ï¼Œå¦‚ä¸‹ */</span></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\">/* æµ…è‰²æ¨¡å¼ä½¿ç”¨çš„å˜é‡ */</span></span><br><span class=\"line\"><span class=\"selector-tag\">html</span><span class=\"selector-attr\">[theme]</span> &#123;</span><br><span class=\"line\">  <span class=\"attr\">--vp-c-user-1</span>:red;</span><br><span class=\"line\">  <span class=\"attr\">--vp-c-user-2</span>:blue;</span><br><span class=\"line\">  <span class=\"attr\">--vp-c-user-3</span>:green;</span><br><span class=\"line\">  <span class=\"attr\">--vp-c-user-soft</span>:<span class=\"built_in\">rgba</span>(<span class=\"number\">255</span>,<span class=\"number\">0</span>,<span class=\"number\">0</span>,.<span class=\"number\">5</span>);</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\">/* æ·±è‰²æ¨¡å¼ä½¿ç”¨çš„å˜é‡ */</span></span><br><span class=\"line\"><span class=\"selector-tag\">html</span><span class=\"selector-attr\">[theme]</span><span class=\"selector-class\">.dark</span> &#123;</span><br><span class=\"line\">  <span class=\"attr\">--vp-c-user-1</span>:yellow;</span><br><span class=\"line\">  <span class=\"attr\">--vp-c-user-2</span>:purple;</span><br><span class=\"line\">  <span class=\"attr\">--vp-c-user-3</span>:orange;</span><br><span class=\"line\">  <span class=\"attr\">--vp-c-user-soft</span>:<span class=\"built_in\">rgba</span>(<span class=\"number\">255</span>,<span class=\"number\">255</span>,<span class=\"number\">0</span>,.<span class=\"number\">5</span>);</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\">/* è¦†ç›–é»˜è®¤å˜é‡ */</span></span><br><span class=\"line\"><span class=\"selector-tag\">html</span><span class=\"selector-attr\">[theme]</span>,<span class=\"selector-tag\">html</span><span class=\"selector-attr\">[theme]</span><span class=\"selector-class\">.dark</span> &#123;</span><br><span class=\"line\">  <span class=\"attr\">--vp-c-brand-1</span>: <span class=\"built_in\">var</span>(--vp-c-user-<span class=\"number\">1</span>);</span><br><span class=\"line\">  <span class=\"attr\">--vp-c-brand-2</span>: <span class=\"built_in\">var</span>(--vp-c-user-<span class=\"number\">2</span>);</span><br><span class=\"line\">  <span class=\"attr\">--vp-c-brand-3</span>: <span class=\"built_in\">var</span>(--vp-c-user-<span class=\"number\">3</span>);</span><br><span class=\"line\">  <span class=\"attr\">--vp-c-brand-soft</span>: <span class=\"built_in\">var</span>(--vp-c-user-soft);</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n<p>å°†å…¶å¼•å…¥åˆ°<code>.vitepress/theme/index.ts</code>ä¸­å³å¯</p>\n<figure class=\"highlight ts\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">import</span> <span class=\"title class_\">BlogTheme</span> <span class=\"keyword\">from</span> <span class=\"string\">&#x27;@sugarat/theme&#x27;</span></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\">// å¯¼å…¥è‡ªå®šä¹‰ä¸»é¢˜è‰² // [!code focus]</span></span><br><span class=\"line\"><span class=\"keyword\">import</span> <span class=\"string\">&#x27;./user-theme.css&#x27;</span> <span class=\"comment\">// [!code focus]</span></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"keyword\">export</span> <span class=\"keyword\">default</span> <span class=\"title class_\">BlogTheme</span></span><br></pre></td></tr></table></figure>\n\n<h2 id=\"More\"><a href=\"#More\" class=\"headerlink\" title=\"More\"></a>More</h2><p>â€¦ wait a moment</p>\n"},{"title":"ã€ŠGoè¯­è¨€ç²¾è¿›ä¹‹è·¯ã€‹é˜…è¯»ç¬”è®°","description":"è®°å½•ã€ŠGoè¯­è¨€ç²¾è¿›ä¹‹è·¯ã€‹ä¸€äº›æœ‰æ„æ€çš„çŸ¥è¯†ç‚¹","_content":"\n# ã€ŠGoè¯­è¨€ç²¾è¿›ä¹‹è·¯ã€‹é˜…è¯»ç¬”è®°\n\n## ç¬¬10æ¡ï¼šä½¿ç”¨iotaå®ç°æšä¸¾å¸¸é‡\n\n- Goçš„**const**è¯­æ³•æä¾›äº†â€œéšå¼é‡å¤å‰ä¸€ä¸ªéç©ºè¡¨è¾¾å¼â€çš„æœºåˆ¶\n\n  - ```go\n    const (\n    \tApple, Banana = 11, 22\n    \tStrawberry, Grape\n    \tPear, Watermelon\n    )\n    \n    // ç­‰ä»·äº\n    \n    const (\n    \tApple, Banana = 11, 22\n    \tStrawberry, Grape = 11, 22\n    \tPear, Watermelon = 11, 22\n    )\n    ```\n\n- iotaè¡¨ç¤ºconstå£°æ˜å—ä¸­æ¯ä¸ªå¸¸é‡æ‰€å¤„ä½ç½®åœ¨å—ä¸­çš„åç§»é‡\n\n  - é…åˆ**éšå¼é‡å¤éç©ºè¡¨è¾¾å¼**æœºåˆ¶ï¼Œå¯ä»¥å®ç°ä¸€äº›å¾ˆç¥å¥‡çš„æ•ˆæœ\n\n  - ```go\n    const (\n    \ta = 1 << iota\t// 1\n    \tb\t\t\t\t// 2\n    \tc\t\t\t\t// 4\n    \td = iota\t\t// 3\n    \te = 1 << iota\t// 16\n    )\n    \n    // å¯ä»¥æ•ˆä»¿æ ‡å‡†åº“ä¸­çš„ä»£ç ï¼Œç•¥è¿‡ä¸€äº›iotaå€¼\n    // $GOROOT/src/syscall/net_js.go go 1.12.7\n    const (\n        _ = iota\n        IPV6_V6ONLY\n        SOMAXCONN\n        SO_ERROR\n    )\n    ```\n\nGoå¼•å…¥iotaæœ‰ä»¥ä¸‹å¥½å¤„ï¼š\n\n1. iotaä½¿å¾—ç»´æŠ¤æšä¸¾å¸¸é‡åˆ—è¡¨æ›´å®¹æ˜“\n2. æ›´ä¸ºçµæ´»çš„å½¢å¼ä¸ºæšä¸¾å¸¸é‡èµ‹åˆå€¼\n\n## ç¬¬12æ¡ï¼šä½¿ç”¨å¤åˆå­—é¢å€¼ä½œä¸ºå¤„ç½®æ„é€ å™¨\n\n- é€šè¿‡**`filed:value`æ ¼å¼**çš„å¤åˆå­—é¢å€¼è¿›è¡Œ**ç»“æ„ä½“ç±»å‹**å˜é‡åˆå€¼æ„é€ ã€‚æœªæ˜¾ç¤ºæŒ‡æ˜çš„ç»“æ„ä½“å­—æ®µå°†é‡‡ç”¨å…¶å¯¹åº”ç±»å‹çš„é›¶å€¼\n\n```go\nerr = &net.DNSConfigError{err}\n\tæ›¿æ¢ä¸º\nerr = &net.DNSConfigError{Error: err}\n```\n\n- é€šè¿‡`index:value`æ ¼å¼ä¸ºæ•°ç»„/åˆ‡ç‰‡ä¸­éè¿ç»­çš„å…ƒç´ èµ‹äºˆåˆå§‹å€¼\n\n```go\nvar data = []int{0:-10, 1:-5, 2:0, 3:1, 7:7}\n```\n\n- ä½¿ç”¨`key:value`å½¢å¼çš„å¤åˆå­—é¢å€¼ä¸ºmapç±»å‹å˜é‡èµ‹åˆå€¼\n\n```go\nm := map[string]int{\"k\":1, \"kk\":2}\n```\n\n## ç¬¬13æ¡ï¼šäº†è§£åˆ‡ç‰‡å®ç°åŸç†å¹¶é«˜æ•ˆä½¿ç”¨\n\n- **åˆ‡ç‰‡æ˜¯æ•°ç»„çš„â€œæè¿°ç¬¦â€**\n\n```go\n//$GOROOT/src/runtime/slice.go\n\ntype slice struct {\n    array unsafe.Pointer\n    len int\n    cap int\n}\n```\n\nå­—æ®µ`len`å–å†³äºåˆ‡ç‰‡â€œçª—å£â€ï¼ˆåŒ…å«å…ƒç´ ä¸ªæ•°ï¼‰çš„å¤§å°\n\nå­—æ®µ`cap`å–å†³äºåº•å±‚æ•°ç»„çš„å¤§å°\n\nä½¿ç”¨`cap`å‚æ•°åˆ›å»ºåˆ‡ç‰‡å¯ä»¥æå‡appendçš„å¹³å‡æ“ä½œæ€§èƒ½ï¼Œå‡å°‘æˆ–å› åŠ¨æ€æ‰©å®¹å¸¦æ¥çš„æ€§èƒ½æŸè€—\n\n## ç¬¬14æ¡ï¼šäº†è§£mapå®ç°åŸç†å¹¶é«˜æ•ˆä½¿ç”¨\n\nmapè¡¨ç¤ºä¸€ç»„æ— åºçš„é”®å€¼å¯¹ï¼Œå…¶ä¸­valueçš„ç±»å‹æ²¡æœ‰é™åˆ¶ï¼Œä½†æ˜¯keyçš„ç±»å‹å¿…é¡»èƒ½å¤Ÿè¿›è¡Œ**==**å’Œ**!=**æ“ä½œã€‚å› æ­¤ï¼Œå‡½æ•°ã€mapã€åˆ‡ç‰‡ç±»å‹ä¸èƒ½ä½œä¸ºmapçš„key\n\nmap**ä¸æ”¯æŒ**â€œé›¶å€¼å¯ç”¨â€ï¼Œæœªæ˜¾ç¤ºèµ‹å€¼æ—¶ï¼Œmapç±»å‹çš„å˜é‡çš„å€¼ä¸ºnilã€‚å¯¹å¤„äºé›¶å€¼çŠ¶æ€çš„mapå˜é‡è¿›è¡Œæ“ä½œä¼šå¯¼è‡´è¿è¡Œæ—¶panic\n\nå’Œåˆ‡ç‰‡ä¸€æ ·ï¼Œmapä¹Ÿæ˜¯å¼•ç”¨ç±»å‹ã€‚å½“å‡½æ•°å‚æ•°ç±»å‹æ˜¯mapæ—¶ï¼Œå‚æ•°ä¼ é€’æŸè€—å¾ˆå°ï¼Œå¹¶ä¸”å‡½æ•°å†…éƒ¨å¯¹mapè¿›è¡Œçš„ä¿®æ”¹æ˜¯åœ¨å¤–éƒ¨å¯è§çš„\n\n**æ€»æ˜¯ä½¿ç”¨â€œcomma okâ€æƒ¯ç”¨æ³•è¯»å–mapä¸­çš„å…ƒç´ **\n\néå†mapæ—¶ï¼ŒGoè¿è¡Œæ—¶ä¼šéšæœºåˆå§‹åŒ–è¿­ä»£å™¨çš„èµ·å§‹ä½ç½®ã€‚å› æ­¤ï¼Œå¤šæ¬¡éå†mapå¾—åˆ°çš„é”®å€¼å¯¹æ¬¡åºå¯èƒ½ä¸ä¸€è‡´ã€‚è¦æƒ³ä¿è¯éå†é”®å€¼å¯¹çš„æ¬¡åºå›ºå®šï¼Œå¯ä»¥å…ˆç”¨ä¸€ä¸ªåˆ‡ç‰‡ä¿å­˜å¥½æ‰€æœ‰çš„keyï¼Œç„¶åå†é€šè¿‡éå†åˆ‡ç‰‡è¾¾åˆ°æœ‰åºéå†mapçš„ç›®çš„\n\n**mapçš„å†…éƒ¨å®ç°**\n\nruntime.hmapç±»å‹æ˜¯è¯­æ³•å±‚é¢mapç±»å‹çš„è¿è¡Œæ—¶å¯¹åº”ç±»å‹ï¼Œhmapå¯ä»¥ç†è§£ä¸ºæ˜¯mapç±»å‹çš„**æè¿°ç¬¦**ï¼ŒåŒ…å«äº†mapç±»å‹æ“ä½œæ‰€éœ€çš„æ‰€æœ‰ä¿¡æ¯\n\n![image-20241112195112007](https://raw.githubusercontent.com/lyydsheep/pic/main/202411121951048.png)\n\n- countï¼šå½“å‰mapä¸­çš„å…ƒç´ ä¸ªæ•°\n- flagsï¼šå½“å‰mapæ‰€å¤„çš„çŠ¶æ€\n  - iterator\n  - oldIterator\n  - hashWriting\n  - sameSizeGrow\n- noverflowï¼šoverflow bucketçš„å¤§çº¦æ•°é‡\n- hash0ï¼šå“ˆå¸Œå‡½æ•°ç§å­\n- bucketsï¼šæŒ‡å‘bucketæ•°ç»„çš„æŒ‡é’ˆ\n- oldbucketsï¼šåœ¨mapæ‰©å®¹é˜¶æ®µæŒ‡å‘å‰ä¸€ä¸ªbucketæ•°ç»„çš„æŒ‡é’ˆ\n- nevacuateï¼šåœ¨mapæ‰©å®¹é˜¶æ®µå……å½“æ‰©å®¹è¿›åº¦è®¡æ•°å™¨\n- extraï¼šå¯é€‰å­—æ®µ\n\nGoè¿è¡Œæ—¶ä¼šå°†mapçš„keyé€šè¿‡å“ˆå¸Œå‡½æ•°å¾—å‡ºä¸€ä¸ªå“ˆå¸Œå€¼ï¼Œæ¥ç€åˆ©ç”¨å“ˆå¸Œå€¼çš„**ä½ä½ï¼ˆé»˜è®¤æ˜¯ä½8ä½ï¼‰**æ‰¾åˆ°å¯¹åº”çš„bucketï¼Œç„¶åå†æ‹¿ç€å“ˆå¸Œå€¼å‰©ä¸‹çš„æ•°å€¼åœ¨bucketä¸­çš„æ‰¾åˆ°ç›®æ ‡æˆ–ç©ºé—²æ§½ä½ï¼ˆslotï¼‰ã€‚hashcodeä¸­çš„é«˜ä½åŒºå°±å­˜å‚¨åœ¨bucketä¸­çš„**tophashåŒºåŸŸ**\n\nGoè¿è¡Œæ—¶ä¼šä¸ºmapç±»å‹ç”Ÿæˆruntime.maptypeå®ä¾‹ï¼Œè¿™ä¸ªå®ä¾‹åŒ…å«äº†mapç±»å‹çš„æ‰€æœ‰å…ƒä¿¡æ¯ã€‚æ ¹æ®è¿™äº›å…ƒä¿¡æ¯ï¼ŒGoè¿è¡Œæ—¶å¯ä»¥ç¡®å®škeyçš„ç±»å‹å’Œå¤§å°ä»¥åŠæ„å»ºvalueåŒºåŸŸ\n\n```go\ntype maptype struct {\n    typ _type\n    key *_type\n    elem *_type\n    bucket *_type\t// è¡¨ç¤ºhash bucketçš„å†…éƒ¨ç±»å‹\n    keysize uint8\t// keyçš„å¤§å°\n    elemsize uint8\t// elemçš„å¤§å°\n    bucketsize uint16\t//bucketçš„å¤§å°\n    flags uint32\n}\n```\n\nGoè¿è¡Œæ—¶é‡‡ç”¨äº†å°†keyå’Œvalueåˆ†å¼€å­˜å‚¨è€Œä¸æ˜¯é€‰æ‹©keyå’Œvalueç´§å¯†ç›¸æ¥çš„å­˜å‚¨æ–¹å¼ã€‚è™½ç„¶è¿™å¸¦æ¥äº†ç®—æ³•å®ç°ä¸Šçš„å¤æ‚æ€§ï¼Œä½†å´å‡å°‘äº†**å†…å­˜å¯¹é½**å¸¦æ¥çš„å†…å­˜ç©ºé—´æŸè€—\n\n![image-20241112204508526](https://raw.githubusercontent.com/lyydsheep/pic/main/202411122045610.png)\n\nmapæè¿°ç¬¦runtime.hmapè‡ªèº«æ˜¯æœ‰çŠ¶æ€çš„ï¼Œå¹¶ä¸”æ²¡æœ‰å¯¹çŠ¶æ€è¿›è¡Œå¹¶å‘ä¿æŠ¤ï¼Œæ‰€ä»¥mapä¸æ˜¯å¹¶å‘å®‰å…¨çš„æ•°æ®ç»“æ„ã€‚å½“å¤šä¸ªgoroutineåŒæ—¶å¯¹ä¸€ä¸ªmapè¿›è¡Œè¯»å†™æ“ä½œæ—¶ï¼Œä¼šè¯±å‘panicï¼Œå¯¼è‡´ç¨‹åºå´©æºƒã€‚\n\nè€ƒè™‘åˆ°mapä¼šè‡ªåŠ¨æ‰©å®¹ï¼Œbucketåœ°å€ä¼šä¸æ–­å˜åŒ–ï¼Œå› æ­¤Goä¸å…è®¸è·å–mapä¸­valueçš„åœ°å€ï¼Œå¹¶ä¸”è¿™ä¸ªçº¦æŸæ˜¯åœ¨ç¼–è¯‘æœŸé—´å°±ä¼šç”Ÿæ•ˆçš„\n\n## ç¬¬15æ¡ï¼šç†è§£stringå®ç°åŸç†æ¯”é«˜æ•ˆä½¿ç”¨\n\n- stringç±»å‹çš„æ•°æ®æ˜¯ä¸å¯å˜çš„\n- é›¶å€¼å¯ç”¨\n- è·å–é•¿åº¦æ—¶é—´å¤æ‚åº¦ä¸º$$O(1)$$\n- æ”¯æŒé€šè¿‡`+ / += `è¿ç®—ç¬¦æ‹¼æ¥å­—ç¬¦ä¸²\n- æ”¯æŒå„ç§æ¯”è¾ƒè¿ç®—ç¬¦\n- å¯¹éASCIIç åŸç”Ÿæ”¯æŒ\n- åŸç”Ÿæ”¯æŒå¤šè¡Œå­—ç¬¦ä¸²\n","source":"_posts/ã€ŠGoè¯­è¨€ç²¾è¿›ä¹‹è·¯ã€‹é˜…è¯»ç¬”è®°.md","raw":"---\ntitle: ã€ŠGoè¯­è¨€ç²¾è¿›ä¹‹è·¯ã€‹é˜…è¯»ç¬”è®°\ndescription: è®°å½•ã€ŠGoè¯­è¨€ç²¾è¿›ä¹‹è·¯ã€‹ä¸€äº›æœ‰æ„æ€çš„çŸ¥è¯†ç‚¹\ntag: Go\n---\n\n# ã€ŠGoè¯­è¨€ç²¾è¿›ä¹‹è·¯ã€‹é˜…è¯»ç¬”è®°\n\n## ç¬¬10æ¡ï¼šä½¿ç”¨iotaå®ç°æšä¸¾å¸¸é‡\n\n- Goçš„**const**è¯­æ³•æä¾›äº†â€œéšå¼é‡å¤å‰ä¸€ä¸ªéç©ºè¡¨è¾¾å¼â€çš„æœºåˆ¶\n\n  - ```go\n    const (\n    \tApple, Banana = 11, 22\n    \tStrawberry, Grape\n    \tPear, Watermelon\n    )\n    \n    // ç­‰ä»·äº\n    \n    const (\n    \tApple, Banana = 11, 22\n    \tStrawberry, Grape = 11, 22\n    \tPear, Watermelon = 11, 22\n    )\n    ```\n\n- iotaè¡¨ç¤ºconstå£°æ˜å—ä¸­æ¯ä¸ªå¸¸é‡æ‰€å¤„ä½ç½®åœ¨å—ä¸­çš„åç§»é‡\n\n  - é…åˆ**éšå¼é‡å¤éç©ºè¡¨è¾¾å¼**æœºåˆ¶ï¼Œå¯ä»¥å®ç°ä¸€äº›å¾ˆç¥å¥‡çš„æ•ˆæœ\n\n  - ```go\n    const (\n    \ta = 1 << iota\t// 1\n    \tb\t\t\t\t// 2\n    \tc\t\t\t\t// 4\n    \td = iota\t\t// 3\n    \te = 1 << iota\t// 16\n    )\n    \n    // å¯ä»¥æ•ˆä»¿æ ‡å‡†åº“ä¸­çš„ä»£ç ï¼Œç•¥è¿‡ä¸€äº›iotaå€¼\n    // $GOROOT/src/syscall/net_js.go go 1.12.7\n    const (\n        _ = iota\n        IPV6_V6ONLY\n        SOMAXCONN\n        SO_ERROR\n    )\n    ```\n\nGoå¼•å…¥iotaæœ‰ä»¥ä¸‹å¥½å¤„ï¼š\n\n1. iotaä½¿å¾—ç»´æŠ¤æšä¸¾å¸¸é‡åˆ—è¡¨æ›´å®¹æ˜“\n2. æ›´ä¸ºçµæ´»çš„å½¢å¼ä¸ºæšä¸¾å¸¸é‡èµ‹åˆå€¼\n\n## ç¬¬12æ¡ï¼šä½¿ç”¨å¤åˆå­—é¢å€¼ä½œä¸ºå¤„ç½®æ„é€ å™¨\n\n- é€šè¿‡**`filed:value`æ ¼å¼**çš„å¤åˆå­—é¢å€¼è¿›è¡Œ**ç»“æ„ä½“ç±»å‹**å˜é‡åˆå€¼æ„é€ ã€‚æœªæ˜¾ç¤ºæŒ‡æ˜çš„ç»“æ„ä½“å­—æ®µå°†é‡‡ç”¨å…¶å¯¹åº”ç±»å‹çš„é›¶å€¼\n\n```go\nerr = &net.DNSConfigError{err}\n\tæ›¿æ¢ä¸º\nerr = &net.DNSConfigError{Error: err}\n```\n\n- é€šè¿‡`index:value`æ ¼å¼ä¸ºæ•°ç»„/åˆ‡ç‰‡ä¸­éè¿ç»­çš„å…ƒç´ èµ‹äºˆåˆå§‹å€¼\n\n```go\nvar data = []int{0:-10, 1:-5, 2:0, 3:1, 7:7}\n```\n\n- ä½¿ç”¨`key:value`å½¢å¼çš„å¤åˆå­—é¢å€¼ä¸ºmapç±»å‹å˜é‡èµ‹åˆå€¼\n\n```go\nm := map[string]int{\"k\":1, \"kk\":2}\n```\n\n## ç¬¬13æ¡ï¼šäº†è§£åˆ‡ç‰‡å®ç°åŸç†å¹¶é«˜æ•ˆä½¿ç”¨\n\n- **åˆ‡ç‰‡æ˜¯æ•°ç»„çš„â€œæè¿°ç¬¦â€**\n\n```go\n//$GOROOT/src/runtime/slice.go\n\ntype slice struct {\n    array unsafe.Pointer\n    len int\n    cap int\n}\n```\n\nå­—æ®µ`len`å–å†³äºåˆ‡ç‰‡â€œçª—å£â€ï¼ˆåŒ…å«å…ƒç´ ä¸ªæ•°ï¼‰çš„å¤§å°\n\nå­—æ®µ`cap`å–å†³äºåº•å±‚æ•°ç»„çš„å¤§å°\n\nä½¿ç”¨`cap`å‚æ•°åˆ›å»ºåˆ‡ç‰‡å¯ä»¥æå‡appendçš„å¹³å‡æ“ä½œæ€§èƒ½ï¼Œå‡å°‘æˆ–å› åŠ¨æ€æ‰©å®¹å¸¦æ¥çš„æ€§èƒ½æŸè€—\n\n## ç¬¬14æ¡ï¼šäº†è§£mapå®ç°åŸç†å¹¶é«˜æ•ˆä½¿ç”¨\n\nmapè¡¨ç¤ºä¸€ç»„æ— åºçš„é”®å€¼å¯¹ï¼Œå…¶ä¸­valueçš„ç±»å‹æ²¡æœ‰é™åˆ¶ï¼Œä½†æ˜¯keyçš„ç±»å‹å¿…é¡»èƒ½å¤Ÿè¿›è¡Œ**==**å’Œ**!=**æ“ä½œã€‚å› æ­¤ï¼Œå‡½æ•°ã€mapã€åˆ‡ç‰‡ç±»å‹ä¸èƒ½ä½œä¸ºmapçš„key\n\nmap**ä¸æ”¯æŒ**â€œé›¶å€¼å¯ç”¨â€ï¼Œæœªæ˜¾ç¤ºèµ‹å€¼æ—¶ï¼Œmapç±»å‹çš„å˜é‡çš„å€¼ä¸ºnilã€‚å¯¹å¤„äºé›¶å€¼çŠ¶æ€çš„mapå˜é‡è¿›è¡Œæ“ä½œä¼šå¯¼è‡´è¿è¡Œæ—¶panic\n\nå’Œåˆ‡ç‰‡ä¸€æ ·ï¼Œmapä¹Ÿæ˜¯å¼•ç”¨ç±»å‹ã€‚å½“å‡½æ•°å‚æ•°ç±»å‹æ˜¯mapæ—¶ï¼Œå‚æ•°ä¼ é€’æŸè€—å¾ˆå°ï¼Œå¹¶ä¸”å‡½æ•°å†…éƒ¨å¯¹mapè¿›è¡Œçš„ä¿®æ”¹æ˜¯åœ¨å¤–éƒ¨å¯è§çš„\n\n**æ€»æ˜¯ä½¿ç”¨â€œcomma okâ€æƒ¯ç”¨æ³•è¯»å–mapä¸­çš„å…ƒç´ **\n\néå†mapæ—¶ï¼ŒGoè¿è¡Œæ—¶ä¼šéšæœºåˆå§‹åŒ–è¿­ä»£å™¨çš„èµ·å§‹ä½ç½®ã€‚å› æ­¤ï¼Œå¤šæ¬¡éå†mapå¾—åˆ°çš„é”®å€¼å¯¹æ¬¡åºå¯èƒ½ä¸ä¸€è‡´ã€‚è¦æƒ³ä¿è¯éå†é”®å€¼å¯¹çš„æ¬¡åºå›ºå®šï¼Œå¯ä»¥å…ˆç”¨ä¸€ä¸ªåˆ‡ç‰‡ä¿å­˜å¥½æ‰€æœ‰çš„keyï¼Œç„¶åå†é€šè¿‡éå†åˆ‡ç‰‡è¾¾åˆ°æœ‰åºéå†mapçš„ç›®çš„\n\n**mapçš„å†…éƒ¨å®ç°**\n\nruntime.hmapç±»å‹æ˜¯è¯­æ³•å±‚é¢mapç±»å‹çš„è¿è¡Œæ—¶å¯¹åº”ç±»å‹ï¼Œhmapå¯ä»¥ç†è§£ä¸ºæ˜¯mapç±»å‹çš„**æè¿°ç¬¦**ï¼ŒåŒ…å«äº†mapç±»å‹æ“ä½œæ‰€éœ€çš„æ‰€æœ‰ä¿¡æ¯\n\n![image-20241112195112007](https://raw.githubusercontent.com/lyydsheep/pic/main/202411121951048.png)\n\n- countï¼šå½“å‰mapä¸­çš„å…ƒç´ ä¸ªæ•°\n- flagsï¼šå½“å‰mapæ‰€å¤„çš„çŠ¶æ€\n  - iterator\n  - oldIterator\n  - hashWriting\n  - sameSizeGrow\n- noverflowï¼šoverflow bucketçš„å¤§çº¦æ•°é‡\n- hash0ï¼šå“ˆå¸Œå‡½æ•°ç§å­\n- bucketsï¼šæŒ‡å‘bucketæ•°ç»„çš„æŒ‡é’ˆ\n- oldbucketsï¼šåœ¨mapæ‰©å®¹é˜¶æ®µæŒ‡å‘å‰ä¸€ä¸ªbucketæ•°ç»„çš„æŒ‡é’ˆ\n- nevacuateï¼šåœ¨mapæ‰©å®¹é˜¶æ®µå……å½“æ‰©å®¹è¿›åº¦è®¡æ•°å™¨\n- extraï¼šå¯é€‰å­—æ®µ\n\nGoè¿è¡Œæ—¶ä¼šå°†mapçš„keyé€šè¿‡å“ˆå¸Œå‡½æ•°å¾—å‡ºä¸€ä¸ªå“ˆå¸Œå€¼ï¼Œæ¥ç€åˆ©ç”¨å“ˆå¸Œå€¼çš„**ä½ä½ï¼ˆé»˜è®¤æ˜¯ä½8ä½ï¼‰**æ‰¾åˆ°å¯¹åº”çš„bucketï¼Œç„¶åå†æ‹¿ç€å“ˆå¸Œå€¼å‰©ä¸‹çš„æ•°å€¼åœ¨bucketä¸­çš„æ‰¾åˆ°ç›®æ ‡æˆ–ç©ºé—²æ§½ä½ï¼ˆslotï¼‰ã€‚hashcodeä¸­çš„é«˜ä½åŒºå°±å­˜å‚¨åœ¨bucketä¸­çš„**tophashåŒºåŸŸ**\n\nGoè¿è¡Œæ—¶ä¼šä¸ºmapç±»å‹ç”Ÿæˆruntime.maptypeå®ä¾‹ï¼Œè¿™ä¸ªå®ä¾‹åŒ…å«äº†mapç±»å‹çš„æ‰€æœ‰å…ƒä¿¡æ¯ã€‚æ ¹æ®è¿™äº›å…ƒä¿¡æ¯ï¼ŒGoè¿è¡Œæ—¶å¯ä»¥ç¡®å®škeyçš„ç±»å‹å’Œå¤§å°ä»¥åŠæ„å»ºvalueåŒºåŸŸ\n\n```go\ntype maptype struct {\n    typ _type\n    key *_type\n    elem *_type\n    bucket *_type\t// è¡¨ç¤ºhash bucketçš„å†…éƒ¨ç±»å‹\n    keysize uint8\t// keyçš„å¤§å°\n    elemsize uint8\t// elemçš„å¤§å°\n    bucketsize uint16\t//bucketçš„å¤§å°\n    flags uint32\n}\n```\n\nGoè¿è¡Œæ—¶é‡‡ç”¨äº†å°†keyå’Œvalueåˆ†å¼€å­˜å‚¨è€Œä¸æ˜¯é€‰æ‹©keyå’Œvalueç´§å¯†ç›¸æ¥çš„å­˜å‚¨æ–¹å¼ã€‚è™½ç„¶è¿™å¸¦æ¥äº†ç®—æ³•å®ç°ä¸Šçš„å¤æ‚æ€§ï¼Œä½†å´å‡å°‘äº†**å†…å­˜å¯¹é½**å¸¦æ¥çš„å†…å­˜ç©ºé—´æŸè€—\n\n![image-20241112204508526](https://raw.githubusercontent.com/lyydsheep/pic/main/202411122045610.png)\n\nmapæè¿°ç¬¦runtime.hmapè‡ªèº«æ˜¯æœ‰çŠ¶æ€çš„ï¼Œå¹¶ä¸”æ²¡æœ‰å¯¹çŠ¶æ€è¿›è¡Œå¹¶å‘ä¿æŠ¤ï¼Œæ‰€ä»¥mapä¸æ˜¯å¹¶å‘å®‰å…¨çš„æ•°æ®ç»“æ„ã€‚å½“å¤šä¸ªgoroutineåŒæ—¶å¯¹ä¸€ä¸ªmapè¿›è¡Œè¯»å†™æ“ä½œæ—¶ï¼Œä¼šè¯±å‘panicï¼Œå¯¼è‡´ç¨‹åºå´©æºƒã€‚\n\nè€ƒè™‘åˆ°mapä¼šè‡ªåŠ¨æ‰©å®¹ï¼Œbucketåœ°å€ä¼šä¸æ–­å˜åŒ–ï¼Œå› æ­¤Goä¸å…è®¸è·å–mapä¸­valueçš„åœ°å€ï¼Œå¹¶ä¸”è¿™ä¸ªçº¦æŸæ˜¯åœ¨ç¼–è¯‘æœŸé—´å°±ä¼šç”Ÿæ•ˆçš„\n\n## ç¬¬15æ¡ï¼šç†è§£stringå®ç°åŸç†æ¯”é«˜æ•ˆä½¿ç”¨\n\n- stringç±»å‹çš„æ•°æ®æ˜¯ä¸å¯å˜çš„\n- é›¶å€¼å¯ç”¨\n- è·å–é•¿åº¦æ—¶é—´å¤æ‚åº¦ä¸º$$O(1)$$\n- æ”¯æŒé€šè¿‡`+ / += `è¿ç®—ç¬¦æ‹¼æ¥å­—ç¬¦ä¸²\n- æ”¯æŒå„ç§æ¯”è¾ƒè¿ç®—ç¬¦\n- å¯¹éASCIIç åŸç”Ÿæ”¯æŒ\n- åŸç”Ÿæ”¯æŒå¤šè¡Œå­—ç¬¦ä¸²\n","slug":"ã€ŠGoè¯­è¨€ç²¾è¿›ä¹‹è·¯ã€‹é˜…è¯»ç¬”è®°","published":1,"date":"2024-12-27T11:03:15.344Z","updated":"2024-12-27T11:03:15.344Z","comments":1,"layout":"post","photos":[],"_id":"cm6c7md6h000da5t2cs692rgb","content":"<h1 id=\"ã€ŠGoè¯­è¨€ç²¾è¿›ä¹‹è·¯ã€‹é˜…è¯»ç¬”è®°\"><a href=\"#ã€ŠGoè¯­è¨€ç²¾è¿›ä¹‹è·¯ã€‹é˜…è¯»ç¬”è®°\" class=\"headerlink\" title=\"ã€ŠGoè¯­è¨€ç²¾è¿›ä¹‹è·¯ã€‹é˜…è¯»ç¬”è®°\"></a>ã€ŠGoè¯­è¨€ç²¾è¿›ä¹‹è·¯ã€‹é˜…è¯»ç¬”è®°</h1><h2 id=\"ç¬¬10æ¡ï¼šä½¿ç”¨iotaå®ç°æšä¸¾å¸¸é‡\"><a href=\"#ç¬¬10æ¡ï¼šä½¿ç”¨iotaå®ç°æšä¸¾å¸¸é‡\" class=\"headerlink\" title=\"ç¬¬10æ¡ï¼šä½¿ç”¨iotaå®ç°æšä¸¾å¸¸é‡\"></a>ç¬¬10æ¡ï¼šä½¿ç”¨iotaå®ç°æšä¸¾å¸¸é‡</h2><ul>\n<li><p>Goçš„<strong>const</strong>è¯­æ³•æä¾›äº†â€œéšå¼é‡å¤å‰ä¸€ä¸ªéç©ºè¡¨è¾¾å¼â€çš„æœºåˆ¶</p>\n<ul>\n<li><pre><code class=\"go\">const (\n    Apple, Banana = 11, 22\n    Strawberry, Grape\n    Pear, Watermelon\n)\n\n// ç­‰ä»·äº\n\nconst (\n    Apple, Banana = 11, 22\n    Strawberry, Grape = 11, 22\n    Pear, Watermelon = 11, 22\n)\n<figure class=\"highlight plaintext\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"></span><br><span class=\"line\">- iotaè¡¨ç¤ºconstå£°æ˜å—ä¸­æ¯ä¸ªå¸¸é‡æ‰€å¤„ä½ç½®åœ¨å—ä¸­çš„åç§»é‡</span><br><span class=\"line\"></span><br><span class=\"line\">  - é…åˆ**éšå¼é‡å¤éç©ºè¡¨è¾¾å¼**æœºåˆ¶ï¼Œå¯ä»¥å®ç°ä¸€äº›å¾ˆç¥å¥‡çš„æ•ˆæœ</span><br><span class=\"line\"></span><br><span class=\"line\">  - ```go</span><br><span class=\"line\">    const (</span><br><span class=\"line\">    \ta = 1 &lt;&lt; iota\t// 1</span><br><span class=\"line\">    \tb\t\t\t\t// 2</span><br><span class=\"line\">    \tc\t\t\t\t// 4</span><br><span class=\"line\">    \td = iota\t\t// 3</span><br><span class=\"line\">    \te = 1 &lt;&lt; iota\t// 16</span><br><span class=\"line\">    )</span><br><span class=\"line\">    </span><br><span class=\"line\">    // å¯ä»¥æ•ˆä»¿æ ‡å‡†åº“ä¸­çš„ä»£ç ï¼Œç•¥è¿‡ä¸€äº›iotaå€¼</span><br><span class=\"line\">    // $GOROOT/src/syscall/net_js.go go 1.12.7</span><br><span class=\"line\">    const (</span><br><span class=\"line\">        _ = iota</span><br><span class=\"line\">        IPV6_V6ONLY</span><br><span class=\"line\">        SOMAXCONN</span><br><span class=\"line\">        SO_ERROR</span><br><span class=\"line\">    )</span><br></pre></td></tr></table></figure>\n</code></pre>\n</li>\n</ul>\n</li>\n</ul>\n<p>Goå¼•å…¥iotaæœ‰ä»¥ä¸‹å¥½å¤„ï¼š</p>\n<ol>\n<li>iotaä½¿å¾—ç»´æŠ¤æšä¸¾å¸¸é‡åˆ—è¡¨æ›´å®¹æ˜“</li>\n<li>æ›´ä¸ºçµæ´»çš„å½¢å¼ä¸ºæšä¸¾å¸¸é‡èµ‹åˆå€¼</li>\n</ol>\n<h2 id=\"ç¬¬12æ¡ï¼šä½¿ç”¨å¤åˆå­—é¢å€¼ä½œä¸ºå¤„ç½®æ„é€ å™¨\"><a href=\"#ç¬¬12æ¡ï¼šä½¿ç”¨å¤åˆå­—é¢å€¼ä½œä¸ºå¤„ç½®æ„é€ å™¨\" class=\"headerlink\" title=\"ç¬¬12æ¡ï¼šä½¿ç”¨å¤åˆå­—é¢å€¼ä½œä¸ºå¤„ç½®æ„é€ å™¨\"></a>ç¬¬12æ¡ï¼šä½¿ç”¨å¤åˆå­—é¢å€¼ä½œä¸ºå¤„ç½®æ„é€ å™¨</h2><ul>\n<li>é€šè¿‡**<code>filed:value</code>æ ¼å¼<strong>çš„å¤åˆå­—é¢å€¼è¿›è¡Œ</strong>ç»“æ„ä½“ç±»å‹**å˜é‡åˆå€¼æ„é€ ã€‚æœªæ˜¾ç¤ºæŒ‡æ˜çš„ç»“æ„ä½“å­—æ®µå°†é‡‡ç”¨å…¶å¯¹åº”ç±»å‹çš„é›¶å€¼</li>\n</ul>\n<figure class=\"highlight go\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">err = &amp;net.DNSConfigError&#123;err&#125;</span><br><span class=\"line\">\tæ›¿æ¢ä¸º</span><br><span class=\"line\">err = &amp;net.DNSConfigError&#123;Error: err&#125;</span><br></pre></td></tr></table></figure>\n\n<ul>\n<li>é€šè¿‡<code>index:value</code>æ ¼å¼ä¸ºæ•°ç»„&#x2F;åˆ‡ç‰‡ä¸­éè¿ç»­çš„å…ƒç´ èµ‹äºˆåˆå§‹å€¼</li>\n</ul>\n<figure class=\"highlight go\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">var</span> data = []<span class=\"type\">int</span>&#123;<span class=\"number\">0</span>:<span class=\"number\">-10</span>, <span class=\"number\">1</span>:<span class=\"number\">-5</span>, <span class=\"number\">2</span>:<span class=\"number\">0</span>, <span class=\"number\">3</span>:<span class=\"number\">1</span>, <span class=\"number\">7</span>:<span class=\"number\">7</span>&#125;</span><br></pre></td></tr></table></figure>\n\n<ul>\n<li>ä½¿ç”¨<code>key:value</code>å½¢å¼çš„å¤åˆå­—é¢å€¼ä¸ºmapç±»å‹å˜é‡èµ‹åˆå€¼</li>\n</ul>\n<figure class=\"highlight go\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">m := <span class=\"keyword\">map</span>[<span class=\"type\">string</span>]<span class=\"type\">int</span>&#123;<span class=\"string\">&quot;k&quot;</span>:<span class=\"number\">1</span>, <span class=\"string\">&quot;kk&quot;</span>:<span class=\"number\">2</span>&#125;</span><br></pre></td></tr></table></figure>\n\n<h2 id=\"ç¬¬13æ¡ï¼šäº†è§£åˆ‡ç‰‡å®ç°åŸç†å¹¶é«˜æ•ˆä½¿ç”¨\"><a href=\"#ç¬¬13æ¡ï¼šäº†è§£åˆ‡ç‰‡å®ç°åŸç†å¹¶é«˜æ•ˆä½¿ç”¨\" class=\"headerlink\" title=\"ç¬¬13æ¡ï¼šäº†è§£åˆ‡ç‰‡å®ç°åŸç†å¹¶é«˜æ•ˆä½¿ç”¨\"></a>ç¬¬13æ¡ï¼šäº†è§£åˆ‡ç‰‡å®ç°åŸç†å¹¶é«˜æ•ˆä½¿ç”¨</h2><ul>\n<li><strong>åˆ‡ç‰‡æ˜¯æ•°ç»„çš„â€œæè¿°ç¬¦â€</strong></li>\n</ul>\n<figure class=\"highlight go\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\">//$GOROOT/src/runtime/slice.go</span></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"keyword\">type</span> slice <span class=\"keyword\">struct</span> &#123;</span><br><span class=\"line\">    array unsafe.Pointer</span><br><span class=\"line\">    <span class=\"built_in\">len</span> <span class=\"type\">int</span></span><br><span class=\"line\">    <span class=\"built_in\">cap</span> <span class=\"type\">int</span></span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n\n<p>å­—æ®µ<code>len</code>å–å†³äºåˆ‡ç‰‡â€œçª—å£â€ï¼ˆåŒ…å«å…ƒç´ ä¸ªæ•°ï¼‰çš„å¤§å°</p>\n<p>å­—æ®µ<code>cap</code>å–å†³äºåº•å±‚æ•°ç»„çš„å¤§å°</p>\n<p>ä½¿ç”¨<code>cap</code>å‚æ•°åˆ›å»ºåˆ‡ç‰‡å¯ä»¥æå‡appendçš„å¹³å‡æ“ä½œæ€§èƒ½ï¼Œå‡å°‘æˆ–å› åŠ¨æ€æ‰©å®¹å¸¦æ¥çš„æ€§èƒ½æŸè€—</p>\n<h2 id=\"ç¬¬14æ¡ï¼šäº†è§£mapå®ç°åŸç†å¹¶é«˜æ•ˆä½¿ç”¨\"><a href=\"#ç¬¬14æ¡ï¼šäº†è§£mapå®ç°åŸç†å¹¶é«˜æ•ˆä½¿ç”¨\" class=\"headerlink\" title=\"ç¬¬14æ¡ï¼šäº†è§£mapå®ç°åŸç†å¹¶é«˜æ•ˆä½¿ç”¨\"></a>ç¬¬14æ¡ï¼šäº†è§£mapå®ç°åŸç†å¹¶é«˜æ•ˆä½¿ç”¨</h2><p>mapè¡¨ç¤ºä¸€ç»„æ— åºçš„é”®å€¼å¯¹ï¼Œå…¶ä¸­valueçš„ç±»å‹æ²¡æœ‰é™åˆ¶ï¼Œä½†æ˜¯keyçš„ç±»å‹å¿…é¡»èƒ½å¤Ÿè¿›è¡Œ**&#x3D;&#x3D;<strong>å’Œ</strong>!&#x3D;**æ“ä½œã€‚å› æ­¤ï¼Œå‡½æ•°ã€mapã€åˆ‡ç‰‡ç±»å‹ä¸èƒ½ä½œä¸ºmapçš„key</p>\n<p>map<strong>ä¸æ”¯æŒ</strong>â€œé›¶å€¼å¯ç”¨â€ï¼Œæœªæ˜¾ç¤ºèµ‹å€¼æ—¶ï¼Œmapç±»å‹çš„å˜é‡çš„å€¼ä¸ºnilã€‚å¯¹å¤„äºé›¶å€¼çŠ¶æ€çš„mapå˜é‡è¿›è¡Œæ“ä½œä¼šå¯¼è‡´è¿è¡Œæ—¶panic</p>\n<p>å’Œåˆ‡ç‰‡ä¸€æ ·ï¼Œmapä¹Ÿæ˜¯å¼•ç”¨ç±»å‹ã€‚å½“å‡½æ•°å‚æ•°ç±»å‹æ˜¯mapæ—¶ï¼Œå‚æ•°ä¼ é€’æŸè€—å¾ˆå°ï¼Œå¹¶ä¸”å‡½æ•°å†…éƒ¨å¯¹mapè¿›è¡Œçš„ä¿®æ”¹æ˜¯åœ¨å¤–éƒ¨å¯è§çš„</p>\n<p><strong>æ€»æ˜¯ä½¿ç”¨â€œcomma okâ€æƒ¯ç”¨æ³•è¯»å–mapä¸­çš„å…ƒç´ </strong></p>\n<p>éå†mapæ—¶ï¼ŒGoè¿è¡Œæ—¶ä¼šéšæœºåˆå§‹åŒ–è¿­ä»£å™¨çš„èµ·å§‹ä½ç½®ã€‚å› æ­¤ï¼Œå¤šæ¬¡éå†mapå¾—åˆ°çš„é”®å€¼å¯¹æ¬¡åºå¯èƒ½ä¸ä¸€è‡´ã€‚è¦æƒ³ä¿è¯éå†é”®å€¼å¯¹çš„æ¬¡åºå›ºå®šï¼Œå¯ä»¥å…ˆç”¨ä¸€ä¸ªåˆ‡ç‰‡ä¿å­˜å¥½æ‰€æœ‰çš„keyï¼Œç„¶åå†é€šè¿‡éå†åˆ‡ç‰‡è¾¾åˆ°æœ‰åºéå†mapçš„ç›®çš„</p>\n<p><strong>mapçš„å†…éƒ¨å®ç°</strong></p>\n<p>runtime.hmapç±»å‹æ˜¯è¯­æ³•å±‚é¢mapç±»å‹çš„è¿è¡Œæ—¶å¯¹åº”ç±»å‹ï¼Œhmapå¯ä»¥ç†è§£ä¸ºæ˜¯mapç±»å‹çš„<strong>æè¿°ç¬¦</strong>ï¼ŒåŒ…å«äº†mapç±»å‹æ“ä½œæ‰€éœ€çš„æ‰€æœ‰ä¿¡æ¯</p>\n<p><img src=\"https://raw.githubusercontent.com/lyydsheep/pic/main/202411121951048.png\" alt=\"image-20241112195112007\"></p>\n<ul>\n<li>countï¼šå½“å‰mapä¸­çš„å…ƒç´ ä¸ªæ•°</li>\n<li>flagsï¼šå½“å‰mapæ‰€å¤„çš„çŠ¶æ€<ul>\n<li>iterator</li>\n<li>oldIterator</li>\n<li>hashWriting</li>\n<li>sameSizeGrow</li>\n</ul>\n</li>\n<li>noverflowï¼šoverflow bucketçš„å¤§çº¦æ•°é‡</li>\n<li>hash0ï¼šå“ˆå¸Œå‡½æ•°ç§å­</li>\n<li>bucketsï¼šæŒ‡å‘bucketæ•°ç»„çš„æŒ‡é’ˆ</li>\n<li>oldbucketsï¼šåœ¨mapæ‰©å®¹é˜¶æ®µæŒ‡å‘å‰ä¸€ä¸ªbucketæ•°ç»„çš„æŒ‡é’ˆ</li>\n<li>nevacuateï¼šåœ¨mapæ‰©å®¹é˜¶æ®µå……å½“æ‰©å®¹è¿›åº¦è®¡æ•°å™¨</li>\n<li>extraï¼šå¯é€‰å­—æ®µ</li>\n</ul>\n<p>Goè¿è¡Œæ—¶ä¼šå°†mapçš„keyé€šè¿‡å“ˆå¸Œå‡½æ•°å¾—å‡ºä¸€ä¸ªå“ˆå¸Œå€¼ï¼Œæ¥ç€åˆ©ç”¨å“ˆå¸Œå€¼çš„<strong>ä½ä½ï¼ˆé»˜è®¤æ˜¯ä½8ä½ï¼‰</strong>æ‰¾åˆ°å¯¹åº”çš„bucketï¼Œç„¶åå†æ‹¿ç€å“ˆå¸Œå€¼å‰©ä¸‹çš„æ•°å€¼åœ¨bucketä¸­çš„æ‰¾åˆ°ç›®æ ‡æˆ–ç©ºé—²æ§½ä½ï¼ˆslotï¼‰ã€‚hashcodeä¸­çš„é«˜ä½åŒºå°±å­˜å‚¨åœ¨bucketä¸­çš„<strong>tophashåŒºåŸŸ</strong></p>\n<p>Goè¿è¡Œæ—¶ä¼šä¸ºmapç±»å‹ç”Ÿæˆruntime.maptypeå®ä¾‹ï¼Œè¿™ä¸ªå®ä¾‹åŒ…å«äº†mapç±»å‹çš„æ‰€æœ‰å…ƒä¿¡æ¯ã€‚æ ¹æ®è¿™äº›å…ƒä¿¡æ¯ï¼ŒGoè¿è¡Œæ—¶å¯ä»¥ç¡®å®škeyçš„ç±»å‹å’Œå¤§å°ä»¥åŠæ„å»ºvalueåŒºåŸŸ</p>\n<figure class=\"highlight go\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">type</span> maptype <span class=\"keyword\">struct</span> &#123;</span><br><span class=\"line\">    typ _type</span><br><span class=\"line\">    key *_type</span><br><span class=\"line\">    elem *_type</span><br><span class=\"line\">    bucket *_type\t<span class=\"comment\">// è¡¨ç¤ºhash bucketçš„å†…éƒ¨ç±»å‹</span></span><br><span class=\"line\">    keysize <span class=\"type\">uint8</span>\t<span class=\"comment\">// keyçš„å¤§å°</span></span><br><span class=\"line\">    elemsize <span class=\"type\">uint8</span>\t<span class=\"comment\">// elemçš„å¤§å°</span></span><br><span class=\"line\">    bucketsize <span class=\"type\">uint16</span>\t<span class=\"comment\">//bucketçš„å¤§å°</span></span><br><span class=\"line\">    flags <span class=\"type\">uint32</span></span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n\n<p>Goè¿è¡Œæ—¶é‡‡ç”¨äº†å°†keyå’Œvalueåˆ†å¼€å­˜å‚¨è€Œä¸æ˜¯é€‰æ‹©keyå’Œvalueç´§å¯†ç›¸æ¥çš„å­˜å‚¨æ–¹å¼ã€‚è™½ç„¶è¿™å¸¦æ¥äº†ç®—æ³•å®ç°ä¸Šçš„å¤æ‚æ€§ï¼Œä½†å´å‡å°‘äº†<strong>å†…å­˜å¯¹é½</strong>å¸¦æ¥çš„å†…å­˜ç©ºé—´æŸè€—</p>\n<p><img src=\"https://raw.githubusercontent.com/lyydsheep/pic/main/202411122045610.png\" alt=\"image-20241112204508526\"></p>\n<p>mapæè¿°ç¬¦runtime.hmapè‡ªèº«æ˜¯æœ‰çŠ¶æ€çš„ï¼Œå¹¶ä¸”æ²¡æœ‰å¯¹çŠ¶æ€è¿›è¡Œå¹¶å‘ä¿æŠ¤ï¼Œæ‰€ä»¥mapä¸æ˜¯å¹¶å‘å®‰å…¨çš„æ•°æ®ç»“æ„ã€‚å½“å¤šä¸ªgoroutineåŒæ—¶å¯¹ä¸€ä¸ªmapè¿›è¡Œè¯»å†™æ“ä½œæ—¶ï¼Œä¼šè¯±å‘panicï¼Œå¯¼è‡´ç¨‹åºå´©æºƒã€‚</p>\n<p>è€ƒè™‘åˆ°mapä¼šè‡ªåŠ¨æ‰©å®¹ï¼Œbucketåœ°å€ä¼šä¸æ–­å˜åŒ–ï¼Œå› æ­¤Goä¸å…è®¸è·å–mapä¸­valueçš„åœ°å€ï¼Œå¹¶ä¸”è¿™ä¸ªçº¦æŸæ˜¯åœ¨ç¼–è¯‘æœŸé—´å°±ä¼šç”Ÿæ•ˆçš„</p>\n<h2 id=\"ç¬¬15æ¡ï¼šç†è§£stringå®ç°åŸç†æ¯”é«˜æ•ˆä½¿ç”¨\"><a href=\"#ç¬¬15æ¡ï¼šç†è§£stringå®ç°åŸç†æ¯”é«˜æ•ˆä½¿ç”¨\" class=\"headerlink\" title=\"ç¬¬15æ¡ï¼šç†è§£stringå®ç°åŸç†æ¯”é«˜æ•ˆä½¿ç”¨\"></a>ç¬¬15æ¡ï¼šç†è§£stringå®ç°åŸç†æ¯”é«˜æ•ˆä½¿ç”¨</h2><ul>\n<li>stringç±»å‹çš„æ•°æ®æ˜¯ä¸å¯å˜çš„</li>\n<li>é›¶å€¼å¯ç”¨</li>\n<li>è·å–é•¿åº¦æ—¶é—´å¤æ‚åº¦ä¸º$$O(1)$$</li>\n<li>æ”¯æŒé€šè¿‡<code>+ / += </code>è¿ç®—ç¬¦æ‹¼æ¥å­—ç¬¦ä¸²</li>\n<li>æ”¯æŒå„ç§æ¯”è¾ƒè¿ç®—ç¬¦</li>\n<li>å¯¹éASCIIç åŸç”Ÿæ”¯æŒ</li>\n<li>åŸç”Ÿæ”¯æŒå¤šè¡Œå­—ç¬¦ä¸²</li>\n</ul>\n","excerpt":"","more":"<h1 id=\"ã€ŠGoè¯­è¨€ç²¾è¿›ä¹‹è·¯ã€‹é˜…è¯»ç¬”è®°\"><a href=\"#ã€ŠGoè¯­è¨€ç²¾è¿›ä¹‹è·¯ã€‹é˜…è¯»ç¬”è®°\" class=\"headerlink\" title=\"ã€ŠGoè¯­è¨€ç²¾è¿›ä¹‹è·¯ã€‹é˜…è¯»ç¬”è®°\"></a>ã€ŠGoè¯­è¨€ç²¾è¿›ä¹‹è·¯ã€‹é˜…è¯»ç¬”è®°</h1><h2 id=\"ç¬¬10æ¡ï¼šä½¿ç”¨iotaå®ç°æšä¸¾å¸¸é‡\"><a href=\"#ç¬¬10æ¡ï¼šä½¿ç”¨iotaå®ç°æšä¸¾å¸¸é‡\" class=\"headerlink\" title=\"ç¬¬10æ¡ï¼šä½¿ç”¨iotaå®ç°æšä¸¾å¸¸é‡\"></a>ç¬¬10æ¡ï¼šä½¿ç”¨iotaå®ç°æšä¸¾å¸¸é‡</h2><ul>\n<li><p>Goçš„<strong>const</strong>è¯­æ³•æä¾›äº†â€œéšå¼é‡å¤å‰ä¸€ä¸ªéç©ºè¡¨è¾¾å¼â€çš„æœºåˆ¶</p>\n<ul>\n<li><pre><code class=\"go\">const (\n    Apple, Banana = 11, 22\n    Strawberry, Grape\n    Pear, Watermelon\n)\n\n// ç­‰ä»·äº\n\nconst (\n    Apple, Banana = 11, 22\n    Strawberry, Grape = 11, 22\n    Pear, Watermelon = 11, 22\n)\n<figure class=\"highlight plaintext\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"></span><br><span class=\"line\">- iotaè¡¨ç¤ºconstå£°æ˜å—ä¸­æ¯ä¸ªå¸¸é‡æ‰€å¤„ä½ç½®åœ¨å—ä¸­çš„åç§»é‡</span><br><span class=\"line\"></span><br><span class=\"line\">  - é…åˆ**éšå¼é‡å¤éç©ºè¡¨è¾¾å¼**æœºåˆ¶ï¼Œå¯ä»¥å®ç°ä¸€äº›å¾ˆç¥å¥‡çš„æ•ˆæœ</span><br><span class=\"line\"></span><br><span class=\"line\">  - ```go</span><br><span class=\"line\">    const (</span><br><span class=\"line\">    \ta = 1 &lt;&lt; iota\t// 1</span><br><span class=\"line\">    \tb\t\t\t\t// 2</span><br><span class=\"line\">    \tc\t\t\t\t// 4</span><br><span class=\"line\">    \td = iota\t\t// 3</span><br><span class=\"line\">    \te = 1 &lt;&lt; iota\t// 16</span><br><span class=\"line\">    )</span><br><span class=\"line\">    </span><br><span class=\"line\">    // å¯ä»¥æ•ˆä»¿æ ‡å‡†åº“ä¸­çš„ä»£ç ï¼Œç•¥è¿‡ä¸€äº›iotaå€¼</span><br><span class=\"line\">    // $GOROOT/src/syscall/net_js.go go 1.12.7</span><br><span class=\"line\">    const (</span><br><span class=\"line\">        _ = iota</span><br><span class=\"line\">        IPV6_V6ONLY</span><br><span class=\"line\">        SOMAXCONN</span><br><span class=\"line\">        SO_ERROR</span><br><span class=\"line\">    )</span><br></pre></td></tr></table></figure>\n</code></pre>\n</li>\n</ul>\n</li>\n</ul>\n<p>Goå¼•å…¥iotaæœ‰ä»¥ä¸‹å¥½å¤„ï¼š</p>\n<ol>\n<li>iotaä½¿å¾—ç»´æŠ¤æšä¸¾å¸¸é‡åˆ—è¡¨æ›´å®¹æ˜“</li>\n<li>æ›´ä¸ºçµæ´»çš„å½¢å¼ä¸ºæšä¸¾å¸¸é‡èµ‹åˆå€¼</li>\n</ol>\n<h2 id=\"ç¬¬12æ¡ï¼šä½¿ç”¨å¤åˆå­—é¢å€¼ä½œä¸ºå¤„ç½®æ„é€ å™¨\"><a href=\"#ç¬¬12æ¡ï¼šä½¿ç”¨å¤åˆå­—é¢å€¼ä½œä¸ºå¤„ç½®æ„é€ å™¨\" class=\"headerlink\" title=\"ç¬¬12æ¡ï¼šä½¿ç”¨å¤åˆå­—é¢å€¼ä½œä¸ºå¤„ç½®æ„é€ å™¨\"></a>ç¬¬12æ¡ï¼šä½¿ç”¨å¤åˆå­—é¢å€¼ä½œä¸ºå¤„ç½®æ„é€ å™¨</h2><ul>\n<li>é€šè¿‡**<code>filed:value</code>æ ¼å¼<strong>çš„å¤åˆå­—é¢å€¼è¿›è¡Œ</strong>ç»“æ„ä½“ç±»å‹**å˜é‡åˆå€¼æ„é€ ã€‚æœªæ˜¾ç¤ºæŒ‡æ˜çš„ç»“æ„ä½“å­—æ®µå°†é‡‡ç”¨å…¶å¯¹åº”ç±»å‹çš„é›¶å€¼</li>\n</ul>\n<figure class=\"highlight go\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">err = &amp;net.DNSConfigError&#123;err&#125;</span><br><span class=\"line\">\tæ›¿æ¢ä¸º</span><br><span class=\"line\">err = &amp;net.DNSConfigError&#123;Error: err&#125;</span><br></pre></td></tr></table></figure>\n\n<ul>\n<li>é€šè¿‡<code>index:value</code>æ ¼å¼ä¸ºæ•°ç»„&#x2F;åˆ‡ç‰‡ä¸­éè¿ç»­çš„å…ƒç´ èµ‹äºˆåˆå§‹å€¼</li>\n</ul>\n<figure class=\"highlight go\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">var</span> data = []<span class=\"type\">int</span>&#123;<span class=\"number\">0</span>:<span class=\"number\">-10</span>, <span class=\"number\">1</span>:<span class=\"number\">-5</span>, <span class=\"number\">2</span>:<span class=\"number\">0</span>, <span class=\"number\">3</span>:<span class=\"number\">1</span>, <span class=\"number\">7</span>:<span class=\"number\">7</span>&#125;</span><br></pre></td></tr></table></figure>\n\n<ul>\n<li>ä½¿ç”¨<code>key:value</code>å½¢å¼çš„å¤åˆå­—é¢å€¼ä¸ºmapç±»å‹å˜é‡èµ‹åˆå€¼</li>\n</ul>\n<figure class=\"highlight go\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">m := <span class=\"keyword\">map</span>[<span class=\"type\">string</span>]<span class=\"type\">int</span>&#123;<span class=\"string\">&quot;k&quot;</span>:<span class=\"number\">1</span>, <span class=\"string\">&quot;kk&quot;</span>:<span class=\"number\">2</span>&#125;</span><br></pre></td></tr></table></figure>\n\n<h2 id=\"ç¬¬13æ¡ï¼šäº†è§£åˆ‡ç‰‡å®ç°åŸç†å¹¶é«˜æ•ˆä½¿ç”¨\"><a href=\"#ç¬¬13æ¡ï¼šäº†è§£åˆ‡ç‰‡å®ç°åŸç†å¹¶é«˜æ•ˆä½¿ç”¨\" class=\"headerlink\" title=\"ç¬¬13æ¡ï¼šäº†è§£åˆ‡ç‰‡å®ç°åŸç†å¹¶é«˜æ•ˆä½¿ç”¨\"></a>ç¬¬13æ¡ï¼šäº†è§£åˆ‡ç‰‡å®ç°åŸç†å¹¶é«˜æ•ˆä½¿ç”¨</h2><ul>\n<li><strong>åˆ‡ç‰‡æ˜¯æ•°ç»„çš„â€œæè¿°ç¬¦â€</strong></li>\n</ul>\n<figure class=\"highlight go\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\">//$GOROOT/src/runtime/slice.go</span></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"keyword\">type</span> slice <span class=\"keyword\">struct</span> &#123;</span><br><span class=\"line\">    array unsafe.Pointer</span><br><span class=\"line\">    <span class=\"built_in\">len</span> <span class=\"type\">int</span></span><br><span class=\"line\">    <span class=\"built_in\">cap</span> <span class=\"type\">int</span></span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n\n<p>å­—æ®µ<code>len</code>å–å†³äºåˆ‡ç‰‡â€œçª—å£â€ï¼ˆåŒ…å«å…ƒç´ ä¸ªæ•°ï¼‰çš„å¤§å°</p>\n<p>å­—æ®µ<code>cap</code>å–å†³äºåº•å±‚æ•°ç»„çš„å¤§å°</p>\n<p>ä½¿ç”¨<code>cap</code>å‚æ•°åˆ›å»ºåˆ‡ç‰‡å¯ä»¥æå‡appendçš„å¹³å‡æ“ä½œæ€§èƒ½ï¼Œå‡å°‘æˆ–å› åŠ¨æ€æ‰©å®¹å¸¦æ¥çš„æ€§èƒ½æŸè€—</p>\n<h2 id=\"ç¬¬14æ¡ï¼šäº†è§£mapå®ç°åŸç†å¹¶é«˜æ•ˆä½¿ç”¨\"><a href=\"#ç¬¬14æ¡ï¼šäº†è§£mapå®ç°åŸç†å¹¶é«˜æ•ˆä½¿ç”¨\" class=\"headerlink\" title=\"ç¬¬14æ¡ï¼šäº†è§£mapå®ç°åŸç†å¹¶é«˜æ•ˆä½¿ç”¨\"></a>ç¬¬14æ¡ï¼šäº†è§£mapå®ç°åŸç†å¹¶é«˜æ•ˆä½¿ç”¨</h2><p>mapè¡¨ç¤ºä¸€ç»„æ— åºçš„é”®å€¼å¯¹ï¼Œå…¶ä¸­valueçš„ç±»å‹æ²¡æœ‰é™åˆ¶ï¼Œä½†æ˜¯keyçš„ç±»å‹å¿…é¡»èƒ½å¤Ÿè¿›è¡Œ**&#x3D;&#x3D;<strong>å’Œ</strong>!&#x3D;**æ“ä½œã€‚å› æ­¤ï¼Œå‡½æ•°ã€mapã€åˆ‡ç‰‡ç±»å‹ä¸èƒ½ä½œä¸ºmapçš„key</p>\n<p>map<strong>ä¸æ”¯æŒ</strong>â€œé›¶å€¼å¯ç”¨â€ï¼Œæœªæ˜¾ç¤ºèµ‹å€¼æ—¶ï¼Œmapç±»å‹çš„å˜é‡çš„å€¼ä¸ºnilã€‚å¯¹å¤„äºé›¶å€¼çŠ¶æ€çš„mapå˜é‡è¿›è¡Œæ“ä½œä¼šå¯¼è‡´è¿è¡Œæ—¶panic</p>\n<p>å’Œåˆ‡ç‰‡ä¸€æ ·ï¼Œmapä¹Ÿæ˜¯å¼•ç”¨ç±»å‹ã€‚å½“å‡½æ•°å‚æ•°ç±»å‹æ˜¯mapæ—¶ï¼Œå‚æ•°ä¼ é€’æŸè€—å¾ˆå°ï¼Œå¹¶ä¸”å‡½æ•°å†…éƒ¨å¯¹mapè¿›è¡Œçš„ä¿®æ”¹æ˜¯åœ¨å¤–éƒ¨å¯è§çš„</p>\n<p><strong>æ€»æ˜¯ä½¿ç”¨â€œcomma okâ€æƒ¯ç”¨æ³•è¯»å–mapä¸­çš„å…ƒç´ </strong></p>\n<p>éå†mapæ—¶ï¼ŒGoè¿è¡Œæ—¶ä¼šéšæœºåˆå§‹åŒ–è¿­ä»£å™¨çš„èµ·å§‹ä½ç½®ã€‚å› æ­¤ï¼Œå¤šæ¬¡éå†mapå¾—åˆ°çš„é”®å€¼å¯¹æ¬¡åºå¯èƒ½ä¸ä¸€è‡´ã€‚è¦æƒ³ä¿è¯éå†é”®å€¼å¯¹çš„æ¬¡åºå›ºå®šï¼Œå¯ä»¥å…ˆç”¨ä¸€ä¸ªåˆ‡ç‰‡ä¿å­˜å¥½æ‰€æœ‰çš„keyï¼Œç„¶åå†é€šè¿‡éå†åˆ‡ç‰‡è¾¾åˆ°æœ‰åºéå†mapçš„ç›®çš„</p>\n<p><strong>mapçš„å†…éƒ¨å®ç°</strong></p>\n<p>runtime.hmapç±»å‹æ˜¯è¯­æ³•å±‚é¢mapç±»å‹çš„è¿è¡Œæ—¶å¯¹åº”ç±»å‹ï¼Œhmapå¯ä»¥ç†è§£ä¸ºæ˜¯mapç±»å‹çš„<strong>æè¿°ç¬¦</strong>ï¼ŒåŒ…å«äº†mapç±»å‹æ“ä½œæ‰€éœ€çš„æ‰€æœ‰ä¿¡æ¯</p>\n<p><img src=\"https://raw.githubusercontent.com/lyydsheep/pic/main/202411121951048.png\" alt=\"image-20241112195112007\"></p>\n<ul>\n<li>countï¼šå½“å‰mapä¸­çš„å…ƒç´ ä¸ªæ•°</li>\n<li>flagsï¼šå½“å‰mapæ‰€å¤„çš„çŠ¶æ€<ul>\n<li>iterator</li>\n<li>oldIterator</li>\n<li>hashWriting</li>\n<li>sameSizeGrow</li>\n</ul>\n</li>\n<li>noverflowï¼šoverflow bucketçš„å¤§çº¦æ•°é‡</li>\n<li>hash0ï¼šå“ˆå¸Œå‡½æ•°ç§å­</li>\n<li>bucketsï¼šæŒ‡å‘bucketæ•°ç»„çš„æŒ‡é’ˆ</li>\n<li>oldbucketsï¼šåœ¨mapæ‰©å®¹é˜¶æ®µæŒ‡å‘å‰ä¸€ä¸ªbucketæ•°ç»„çš„æŒ‡é’ˆ</li>\n<li>nevacuateï¼šåœ¨mapæ‰©å®¹é˜¶æ®µå……å½“æ‰©å®¹è¿›åº¦è®¡æ•°å™¨</li>\n<li>extraï¼šå¯é€‰å­—æ®µ</li>\n</ul>\n<p>Goè¿è¡Œæ—¶ä¼šå°†mapçš„keyé€šè¿‡å“ˆå¸Œå‡½æ•°å¾—å‡ºä¸€ä¸ªå“ˆå¸Œå€¼ï¼Œæ¥ç€åˆ©ç”¨å“ˆå¸Œå€¼çš„<strong>ä½ä½ï¼ˆé»˜è®¤æ˜¯ä½8ä½ï¼‰</strong>æ‰¾åˆ°å¯¹åº”çš„bucketï¼Œç„¶åå†æ‹¿ç€å“ˆå¸Œå€¼å‰©ä¸‹çš„æ•°å€¼åœ¨bucketä¸­çš„æ‰¾åˆ°ç›®æ ‡æˆ–ç©ºé—²æ§½ä½ï¼ˆslotï¼‰ã€‚hashcodeä¸­çš„é«˜ä½åŒºå°±å­˜å‚¨åœ¨bucketä¸­çš„<strong>tophashåŒºåŸŸ</strong></p>\n<p>Goè¿è¡Œæ—¶ä¼šä¸ºmapç±»å‹ç”Ÿæˆruntime.maptypeå®ä¾‹ï¼Œè¿™ä¸ªå®ä¾‹åŒ…å«äº†mapç±»å‹çš„æ‰€æœ‰å…ƒä¿¡æ¯ã€‚æ ¹æ®è¿™äº›å…ƒä¿¡æ¯ï¼ŒGoè¿è¡Œæ—¶å¯ä»¥ç¡®å®škeyçš„ç±»å‹å’Œå¤§å°ä»¥åŠæ„å»ºvalueåŒºåŸŸ</p>\n<figure class=\"highlight go\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">type</span> maptype <span class=\"keyword\">struct</span> &#123;</span><br><span class=\"line\">    typ _type</span><br><span class=\"line\">    key *_type</span><br><span class=\"line\">    elem *_type</span><br><span class=\"line\">    bucket *_type\t<span class=\"comment\">// è¡¨ç¤ºhash bucketçš„å†…éƒ¨ç±»å‹</span></span><br><span class=\"line\">    keysize <span class=\"type\">uint8</span>\t<span class=\"comment\">// keyçš„å¤§å°</span></span><br><span class=\"line\">    elemsize <span class=\"type\">uint8</span>\t<span class=\"comment\">// elemçš„å¤§å°</span></span><br><span class=\"line\">    bucketsize <span class=\"type\">uint16</span>\t<span class=\"comment\">//bucketçš„å¤§å°</span></span><br><span class=\"line\">    flags <span class=\"type\">uint32</span></span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n\n<p>Goè¿è¡Œæ—¶é‡‡ç”¨äº†å°†keyå’Œvalueåˆ†å¼€å­˜å‚¨è€Œä¸æ˜¯é€‰æ‹©keyå’Œvalueç´§å¯†ç›¸æ¥çš„å­˜å‚¨æ–¹å¼ã€‚è™½ç„¶è¿™å¸¦æ¥äº†ç®—æ³•å®ç°ä¸Šçš„å¤æ‚æ€§ï¼Œä½†å´å‡å°‘äº†<strong>å†…å­˜å¯¹é½</strong>å¸¦æ¥çš„å†…å­˜ç©ºé—´æŸè€—</p>\n<p><img src=\"https://raw.githubusercontent.com/lyydsheep/pic/main/202411122045610.png\" alt=\"image-20241112204508526\"></p>\n<p>mapæè¿°ç¬¦runtime.hmapè‡ªèº«æ˜¯æœ‰çŠ¶æ€çš„ï¼Œå¹¶ä¸”æ²¡æœ‰å¯¹çŠ¶æ€è¿›è¡Œå¹¶å‘ä¿æŠ¤ï¼Œæ‰€ä»¥mapä¸æ˜¯å¹¶å‘å®‰å…¨çš„æ•°æ®ç»“æ„ã€‚å½“å¤šä¸ªgoroutineåŒæ—¶å¯¹ä¸€ä¸ªmapè¿›è¡Œè¯»å†™æ“ä½œæ—¶ï¼Œä¼šè¯±å‘panicï¼Œå¯¼è‡´ç¨‹åºå´©æºƒã€‚</p>\n<p>è€ƒè™‘åˆ°mapä¼šè‡ªåŠ¨æ‰©å®¹ï¼Œbucketåœ°å€ä¼šä¸æ–­å˜åŒ–ï¼Œå› æ­¤Goä¸å…è®¸è·å–mapä¸­valueçš„åœ°å€ï¼Œå¹¶ä¸”è¿™ä¸ªçº¦æŸæ˜¯åœ¨ç¼–è¯‘æœŸé—´å°±ä¼šç”Ÿæ•ˆçš„</p>\n<h2 id=\"ç¬¬15æ¡ï¼šç†è§£stringå®ç°åŸç†æ¯”é«˜æ•ˆä½¿ç”¨\"><a href=\"#ç¬¬15æ¡ï¼šç†è§£stringå®ç°åŸç†æ¯”é«˜æ•ˆä½¿ç”¨\" class=\"headerlink\" title=\"ç¬¬15æ¡ï¼šç†è§£stringå®ç°åŸç†æ¯”é«˜æ•ˆä½¿ç”¨\"></a>ç¬¬15æ¡ï¼šç†è§£stringå®ç°åŸç†æ¯”é«˜æ•ˆä½¿ç”¨</h2><ul>\n<li>stringç±»å‹çš„æ•°æ®æ˜¯ä¸å¯å˜çš„</li>\n<li>é›¶å€¼å¯ç”¨</li>\n<li>è·å–é•¿åº¦æ—¶é—´å¤æ‚åº¦ä¸º$$O(1)$$</li>\n<li>æ”¯æŒé€šè¿‡<code>+ / += </code>è¿ç®—ç¬¦æ‹¼æ¥å­—ç¬¦ä¸²</li>\n<li>æ”¯æŒå„ç§æ¯”è¾ƒè¿ç®—ç¬¦</li>\n<li>å¯¹éASCIIç åŸç”Ÿæ”¯æŒ</li>\n<li>åŸç”Ÿæ”¯æŒå¤šè¡Œå­—ç¬¦ä¸²</li>\n</ul>\n"},{"title":"ä»–ä»¬çœ¼ä¸­çš„ç®€å†","_content":"- æ³¨æ„æŠ•é€’å²—ä½ï¼Œåˆ‡å¿Œâ€œä¸€ä»½ç®€å†æŠ•å¤©ä¸‹â€\n","source":"_posts/ä»–ä»¬çœ¼ä¸­çš„ç®€å†.md","raw":"---\ntitle: ä»–ä»¬çœ¼ä¸­çš„ç®€å†\n---\n- æ³¨æ„æŠ•é€’å²—ä½ï¼Œåˆ‡å¿Œâ€œä¸€ä»½ç®€å†æŠ•å¤©ä¸‹â€\n","slug":"ä»–ä»¬çœ¼ä¸­çš„ç®€å†","published":1,"date":"2025-01-25T13:16:28.409Z","updated":"2025-01-25T13:16:28.409Z","_id":"cm6c7md6i000ga5t2gja4dtqr","comments":1,"layout":"post","photos":[],"content":"<ul>\n<li>æ³¨æ„æŠ•é€’å²—ä½ï¼Œåˆ‡å¿Œâ€œä¸€ä»½ç®€å†æŠ•å¤©ä¸‹â€</li>\n</ul>\n","excerpt":"","more":"<ul>\n<li>æ³¨æ„æŠ•é€’å²—ä½ï¼Œåˆ‡å¿Œâ€œä¸€ä»½ç®€å†æŠ•å¤©ä¸‹â€</li>\n</ul>\n"},{"title":"ä¼˜è´¨å¥½æ–‡åˆé›†","publish":true,"description":"æ”¶è—ä¸€äº›ä¼˜è´¨å¥½æ–‡","date":"2024-12-11T16:00:00.000Z","_content":"\n# ä¼˜è´¨å¥½æ–‡åˆé›† \n\n* [ ] [ä¸‡å­—é•¿æ–‡è¯¦ç»†åˆ†äº«Redisçš„å¸¸è§ä¸šåŠ¡åœºæ™¯](https://mp.weixin.qq.com/s/srkd73bS2n3mjIADLVg72A)\n\n* [ ] [â€œæ„ä¹‰â€ä¸é©¬æ‹‰æ¾](https://mp.weixin.qq.com/s/cc5Thv-umTnApcC8aaQJNw)\n\n* [ ] [æ¶ˆæ¯é˜Ÿåˆ—é€‰å‹](https://mp.weixin.qq.com/s/jWKHAic4Tt4Ohsj4pTmYFw)\n\n* [x] [æ·˜å®æ•°æ®åº“ï¼Œä¸»é”®å¦‚ä½•è®¾è®¡çš„?](https://cloud.tencent.com/developer/article/2163702)\n\n* [ ] [å¦‚ä½•å°½å¯èƒ½å¿«åœ°ä¸Šåä¸€ä¸ªä¸šåŠ¡oré¡¹ç›®](https://mp.weixin.qq.com/s/I-876sJiI-XFRdDkvJV_mg)\n\té˜…è¯»è¦ç‚¹è®°å½•ï¼š\n\t- å°½å¯èƒ½å…¨é¢åœ°æœé›†é¡¹ç›®èµ„æ–™\n\t\t- æ–°äººç©ºé—´èµ„æ–™\n\t\t- ç³»ç»Ÿè¯¦ç»†èµ„æ–™ï¼Œå³ä½¿ä¸æ˜¯è‡ªå·±è´Ÿè´£çš„æ¨¡å—\n\t- æ¢³ç†é¢†åŸŸæ•°æ®æ¨¡å‹\n\t\t- ææ¸…æ¥šæ¯ä¸€ä¸ªæ•°æ®æ¨¡å‹çš„è®¾è®¡ï¼šå±æ€§åŠå…¶å«ä¹‰ã€æœ¬èº«ä»£è¡¨äº†ä»€ä¹ˆã€æ•°æ®æ¨¡å‹ä¹‹é—´çš„å…³ç³»\n\t\t- ç”»[ERå›¾](https://zq99299.github.io/mysql-tutorial/ali-new-retail/03/02.html)æˆ–å…¶ä»–å›¾è¾…åŠ©ç†æ¸…æ€è·¯\n\t- ç†è§£é¡¹ç›®ç»“æ„åŠä¸šåŠ¡é€»è¾‘\n\t\t- MVCã€DDDï¼Œææ¸…æ¥šå…¥å£å±‚ã€æ ¸å¿ƒé€»è¾‘å±‚ã€æ•°æ®äº¤äº’å±‚åœ¨å“ªé‡Œ\n\t\t- é€ä¸ªäº†è§£æ•°æ®æ¨¡å‹åœ¨ç³»ç»Ÿå†…å¯¹äºçš„ä¸šåŠ¡é€»è¾‘å®ç°\n\t\t\t- å¯ä»¥ä½œä½œä¸šåŠ¡æµç¨‹å›¾æ¥æ¢³ç†ï¼ˆå¯ä»¥çœ‹å°æŠ¥ç«¥ï¼‰\n\n* [ ] [38ä»¶ç¨‹åºå‘˜åº”è¯¥çŸ¥é“çš„äº‹å„¿](https://mp.weixin.qq.com/s/tz6V7AIBcxQcuwvp_pRgCQ)\n\té˜…è¯»è®°å½•\n\t- å¯¹æŠ€æœ¯å€ºâ€œé›¶å®¹å¿â€ï¼Œæœ‰äº›äº‹åªæœ‰é›¶æ¬¡å’Œæ— æ•°æ¬¡\n\t- åˆ†æéœ€æ±‚èƒŒåçš„æ„ä¹‰\n\t\t- æ ¹æ®â€œç¬¬ä¸€æ€§åŸç†â€ï¼Œæˆ‘ä»¬åº”è¯¥ä»æœ¬è´¨å‡ºå‘è¿›è¡Œæ€è€ƒã€‚ç”¨æˆ·çš„éœ€æ±‚å¿…ç„¶æ˜¯æƒ³è¾¾åˆ°æŸç§ç›®çš„ï¼ˆå³ç½—é©¬ï¼‰ï¼Œä½†æ˜¯ç”¨æˆ·é€‰æ‹©çš„è·¯æœªå¿…æ˜¯æœ€å¥½çš„ï¼Œæ¡æ¡å¤§è·¯é€šç½—é©¬ï¼Œé‚£ä¹ˆæˆ‘ä»¬ä½œä¸ºå¼€å‘è€…çŸ¥é“äº†ç½—é©¬åœ¨å“ªå„¿ï¼Œæ˜¯ä¸æ˜¯å¯ä»¥æ‰¾å‡ºä¸€æ¡æ›´å¥½çš„è·¯å‘¢ï¼Ÿ\n\t\t- å¦‚æœä¸èƒ½ï¼Œé‚£å°±è€ƒè™‘Say noå§\n\t\t- \n\n* [ ] [Redisä¹Ÿå¯ä»¥æ˜¯æˆæœ¬ä¼˜åŒ–åˆ©å™¨](https://mp.weixin.qq.com/s/bBqeGkKxCp0xEQjmaG1JPQ)\n","source":"_posts/ä¼˜è´¨å¥½æ–‡åˆé›†.md","raw":"---\ntitle: ä¼˜è´¨å¥½æ–‡åˆé›†\npublish: true\ndescription: æ”¶è—ä¸€äº›ä¼˜è´¨å¥½æ–‡\ndate: 2024-12-12\ntags:\n  - ä¼˜è´¨æ–‡ç« \n---\n\n# ä¼˜è´¨å¥½æ–‡åˆé›† \n\n* [ ] [ä¸‡å­—é•¿æ–‡è¯¦ç»†åˆ†äº«Redisçš„å¸¸è§ä¸šåŠ¡åœºæ™¯](https://mp.weixin.qq.com/s/srkd73bS2n3mjIADLVg72A)\n\n* [ ] [â€œæ„ä¹‰â€ä¸é©¬æ‹‰æ¾](https://mp.weixin.qq.com/s/cc5Thv-umTnApcC8aaQJNw)\n\n* [ ] [æ¶ˆæ¯é˜Ÿåˆ—é€‰å‹](https://mp.weixin.qq.com/s/jWKHAic4Tt4Ohsj4pTmYFw)\n\n* [x] [æ·˜å®æ•°æ®åº“ï¼Œä¸»é”®å¦‚ä½•è®¾è®¡çš„?](https://cloud.tencent.com/developer/article/2163702)\n\n* [ ] [å¦‚ä½•å°½å¯èƒ½å¿«åœ°ä¸Šåä¸€ä¸ªä¸šåŠ¡oré¡¹ç›®](https://mp.weixin.qq.com/s/I-876sJiI-XFRdDkvJV_mg)\n\té˜…è¯»è¦ç‚¹è®°å½•ï¼š\n\t- å°½å¯èƒ½å…¨é¢åœ°æœé›†é¡¹ç›®èµ„æ–™\n\t\t- æ–°äººç©ºé—´èµ„æ–™\n\t\t- ç³»ç»Ÿè¯¦ç»†èµ„æ–™ï¼Œå³ä½¿ä¸æ˜¯è‡ªå·±è´Ÿè´£çš„æ¨¡å—\n\t- æ¢³ç†é¢†åŸŸæ•°æ®æ¨¡å‹\n\t\t- ææ¸…æ¥šæ¯ä¸€ä¸ªæ•°æ®æ¨¡å‹çš„è®¾è®¡ï¼šå±æ€§åŠå…¶å«ä¹‰ã€æœ¬èº«ä»£è¡¨äº†ä»€ä¹ˆã€æ•°æ®æ¨¡å‹ä¹‹é—´çš„å…³ç³»\n\t\t- ç”»[ERå›¾](https://zq99299.github.io/mysql-tutorial/ali-new-retail/03/02.html)æˆ–å…¶ä»–å›¾è¾…åŠ©ç†æ¸…æ€è·¯\n\t- ç†è§£é¡¹ç›®ç»“æ„åŠä¸šåŠ¡é€»è¾‘\n\t\t- MVCã€DDDï¼Œææ¸…æ¥šå…¥å£å±‚ã€æ ¸å¿ƒé€»è¾‘å±‚ã€æ•°æ®äº¤äº’å±‚åœ¨å“ªé‡Œ\n\t\t- é€ä¸ªäº†è§£æ•°æ®æ¨¡å‹åœ¨ç³»ç»Ÿå†…å¯¹äºçš„ä¸šåŠ¡é€»è¾‘å®ç°\n\t\t\t- å¯ä»¥ä½œä½œä¸šåŠ¡æµç¨‹å›¾æ¥æ¢³ç†ï¼ˆå¯ä»¥çœ‹å°æŠ¥ç«¥ï¼‰\n\n* [ ] [38ä»¶ç¨‹åºå‘˜åº”è¯¥çŸ¥é“çš„äº‹å„¿](https://mp.weixin.qq.com/s/tz6V7AIBcxQcuwvp_pRgCQ)\n\té˜…è¯»è®°å½•\n\t- å¯¹æŠ€æœ¯å€ºâ€œé›¶å®¹å¿â€ï¼Œæœ‰äº›äº‹åªæœ‰é›¶æ¬¡å’Œæ— æ•°æ¬¡\n\t- åˆ†æéœ€æ±‚èƒŒåçš„æ„ä¹‰\n\t\t- æ ¹æ®â€œç¬¬ä¸€æ€§åŸç†â€ï¼Œæˆ‘ä»¬åº”è¯¥ä»æœ¬è´¨å‡ºå‘è¿›è¡Œæ€è€ƒã€‚ç”¨æˆ·çš„éœ€æ±‚å¿…ç„¶æ˜¯æƒ³è¾¾åˆ°æŸç§ç›®çš„ï¼ˆå³ç½—é©¬ï¼‰ï¼Œä½†æ˜¯ç”¨æˆ·é€‰æ‹©çš„è·¯æœªå¿…æ˜¯æœ€å¥½çš„ï¼Œæ¡æ¡å¤§è·¯é€šç½—é©¬ï¼Œé‚£ä¹ˆæˆ‘ä»¬ä½œä¸ºå¼€å‘è€…çŸ¥é“äº†ç½—é©¬åœ¨å“ªå„¿ï¼Œæ˜¯ä¸æ˜¯å¯ä»¥æ‰¾å‡ºä¸€æ¡æ›´å¥½çš„è·¯å‘¢ï¼Ÿ\n\t\t- å¦‚æœä¸èƒ½ï¼Œé‚£å°±è€ƒè™‘Say noå§\n\t\t- \n\n* [ ] [Redisä¹Ÿå¯ä»¥æ˜¯æˆæœ¬ä¼˜åŒ–åˆ©å™¨](https://mp.weixin.qq.com/s/bBqeGkKxCp0xEQjmaG1JPQ)\n","slug":"ä¼˜è´¨å¥½æ–‡åˆé›†","published":1,"updated":"2024-12-27T11:03:15.344Z","comments":1,"layout":"post","photos":[],"_id":"cm6c7md6i000ha5t27jvj6lzt","content":"<h1 id=\"ä¼˜è´¨å¥½æ–‡åˆé›†\"><a href=\"#ä¼˜è´¨å¥½æ–‡åˆé›†\" class=\"headerlink\" title=\"ä¼˜è´¨å¥½æ–‡åˆé›†\"></a>ä¼˜è´¨å¥½æ–‡åˆé›†</h1><ul>\n<li><p><input disabled=\"\" type=\"checkbox\"> \n<a href=\"https://mp.weixin.qq.com/s/srkd73bS2n3mjIADLVg72A\">ä¸‡å­—é•¿æ–‡è¯¦ç»†åˆ†äº«Redisçš„å¸¸è§ä¸šåŠ¡åœºæ™¯</a></p>\n</li>\n<li><p><input disabled=\"\" type=\"checkbox\"> \n<a href=\"https://mp.weixin.qq.com/s/cc5Thv-umTnApcC8aaQJNw\">â€œæ„ä¹‰â€ä¸é©¬æ‹‰æ¾</a></p>\n</li>\n<li><p><input disabled=\"\" type=\"checkbox\"> \n<a href=\"https://mp.weixin.qq.com/s/jWKHAic4Tt4Ohsj4pTmYFw\">æ¶ˆæ¯é˜Ÿåˆ—é€‰å‹</a></p>\n</li>\n<li><p><input checked=\"\" disabled=\"\" type=\"checkbox\"> \n<a href=\"https://cloud.tencent.com/developer/article/2163702\">æ·˜å®æ•°æ®åº“ï¼Œä¸»é”®å¦‚ä½•è®¾è®¡çš„?</a></p>\n</li>\n<li><p><input disabled=\"\" type=\"checkbox\"> \n<a href=\"https://mp.weixin.qq.com/s/I-876sJiI-XFRdDkvJV_mg\">å¦‚ä½•å°½å¯èƒ½å¿«åœ°ä¸Šåä¸€ä¸ªä¸šåŠ¡oré¡¹ç›®</a><br>  é˜…è¯»è¦ç‚¹è®°å½•ï¼š</p>\n<ul>\n<li>å°½å¯èƒ½å…¨é¢åœ°æœé›†é¡¹ç›®èµ„æ–™<ul>\n<li>æ–°äººç©ºé—´èµ„æ–™</li>\n<li>ç³»ç»Ÿè¯¦ç»†èµ„æ–™ï¼Œå³ä½¿ä¸æ˜¯è‡ªå·±è´Ÿè´£çš„æ¨¡å—</li>\n</ul>\n</li>\n<li>æ¢³ç†é¢†åŸŸæ•°æ®æ¨¡å‹<ul>\n<li>ææ¸…æ¥šæ¯ä¸€ä¸ªæ•°æ®æ¨¡å‹çš„è®¾è®¡ï¼šå±æ€§åŠå…¶å«ä¹‰ã€æœ¬èº«ä»£è¡¨äº†ä»€ä¹ˆã€æ•°æ®æ¨¡å‹ä¹‹é—´çš„å…³ç³»</li>\n<li>ç”»<a href=\"https://zq99299.github.io/mysql-tutorial/ali-new-retail/03/02.html\">ERå›¾</a>æˆ–å…¶ä»–å›¾è¾…åŠ©ç†æ¸…æ€è·¯</li>\n</ul>\n</li>\n<li>ç†è§£é¡¹ç›®ç»“æ„åŠä¸šåŠ¡é€»è¾‘<ul>\n<li>MVCã€DDDï¼Œææ¸…æ¥šå…¥å£å±‚ã€æ ¸å¿ƒé€»è¾‘å±‚ã€æ•°æ®äº¤äº’å±‚åœ¨å“ªé‡Œ</li>\n<li>é€ä¸ªäº†è§£æ•°æ®æ¨¡å‹åœ¨ç³»ç»Ÿå†…å¯¹äºçš„ä¸šåŠ¡é€»è¾‘å®ç°<ul>\n<li>å¯ä»¥ä½œä½œä¸šåŠ¡æµç¨‹å›¾æ¥æ¢³ç†ï¼ˆå¯ä»¥çœ‹å°æŠ¥ç«¥ï¼‰</li>\n</ul>\n</li>\n</ul>\n</li>\n</ul>\n</li>\n<li><p><input disabled=\"\" type=\"checkbox\"> \n<a href=\"https://mp.weixin.qq.com/s/tz6V7AIBcxQcuwvp_pRgCQ\">38ä»¶ç¨‹åºå‘˜åº”è¯¥çŸ¥é“çš„äº‹å„¿</a><br>  é˜…è¯»è®°å½•</p>\n<ul>\n<li>å¯¹æŠ€æœ¯å€ºâ€œé›¶å®¹å¿â€ï¼Œæœ‰äº›äº‹åªæœ‰é›¶æ¬¡å’Œæ— æ•°æ¬¡</li>\n<li><h2 id=\"åˆ†æéœ€æ±‚èƒŒåçš„æ„ä¹‰-æ ¹æ®â€œç¬¬ä¸€æ€§åŸç†â€ï¼Œæˆ‘ä»¬åº”è¯¥ä»æœ¬è´¨å‡ºå‘è¿›è¡Œæ€è€ƒã€‚ç”¨æˆ·çš„éœ€æ±‚å¿…ç„¶æ˜¯æƒ³è¾¾åˆ°æŸç§ç›®çš„ï¼ˆå³ç½—é©¬ï¼‰ï¼Œä½†æ˜¯ç”¨æˆ·é€‰æ‹©çš„è·¯æœªå¿…æ˜¯æœ€å¥½çš„ï¼Œæ¡æ¡å¤§è·¯é€šç½—é©¬ï¼Œé‚£ä¹ˆæˆ‘ä»¬ä½œä¸ºå¼€å‘è€…çŸ¥é“äº†ç½—é©¬åœ¨å“ªå„¿ï¼Œæ˜¯ä¸æ˜¯å¯ä»¥æ‰¾å‡ºä¸€æ¡æ›´å¥½çš„è·¯å‘¢ï¼Ÿ-å¦‚æœä¸èƒ½ï¼Œé‚£å°±è€ƒè™‘Say-noå§\"><a href=\"#åˆ†æéœ€æ±‚èƒŒåçš„æ„ä¹‰-æ ¹æ®â€œç¬¬ä¸€æ€§åŸç†â€ï¼Œæˆ‘ä»¬åº”è¯¥ä»æœ¬è´¨å‡ºå‘è¿›è¡Œæ€è€ƒã€‚ç”¨æˆ·çš„éœ€æ±‚å¿…ç„¶æ˜¯æƒ³è¾¾åˆ°æŸç§ç›®çš„ï¼ˆå³ç½—é©¬ï¼‰ï¼Œä½†æ˜¯ç”¨æˆ·é€‰æ‹©çš„è·¯æœªå¿…æ˜¯æœ€å¥½çš„ï¼Œæ¡æ¡å¤§è·¯é€šç½—é©¬ï¼Œé‚£ä¹ˆæˆ‘ä»¬ä½œä¸ºå¼€å‘è€…çŸ¥é“äº†ç½—é©¬åœ¨å“ªå„¿ï¼Œæ˜¯ä¸æ˜¯å¯ä»¥æ‰¾å‡ºä¸€æ¡æ›´å¥½çš„è·¯å‘¢ï¼Ÿ-å¦‚æœä¸èƒ½ï¼Œé‚£å°±è€ƒè™‘Say-noå§\" class=\"headerlink\" title=\"åˆ†æéœ€æ±‚èƒŒåçš„æ„ä¹‰  - æ ¹æ®â€œç¬¬ä¸€æ€§åŸç†â€ï¼Œæˆ‘ä»¬åº”è¯¥ä»æœ¬è´¨å‡ºå‘è¿›è¡Œæ€è€ƒã€‚ç”¨æˆ·çš„éœ€æ±‚å¿…ç„¶æ˜¯æƒ³è¾¾åˆ°æŸç§ç›®çš„ï¼ˆå³ç½—é©¬ï¼‰ï¼Œä½†æ˜¯ç”¨æˆ·é€‰æ‹©çš„è·¯æœªå¿…æ˜¯æœ€å¥½çš„ï¼Œæ¡æ¡å¤§è·¯é€šç½—é©¬ï¼Œé‚£ä¹ˆæˆ‘ä»¬ä½œä¸ºå¼€å‘è€…çŸ¥é“äº†ç½—é©¬åœ¨å“ªå„¿ï¼Œæ˜¯ä¸æ˜¯å¯ä»¥æ‰¾å‡ºä¸€æ¡æ›´å¥½çš„è·¯å‘¢ï¼Ÿ  - å¦‚æœä¸èƒ½ï¼Œé‚£å°±è€ƒè™‘Say noå§\"></a>åˆ†æéœ€æ±‚èƒŒåçš„æ„ä¹‰<br>  - æ ¹æ®â€œç¬¬ä¸€æ€§åŸç†â€ï¼Œæˆ‘ä»¬åº”è¯¥ä»æœ¬è´¨å‡ºå‘è¿›è¡Œæ€è€ƒã€‚ç”¨æˆ·çš„éœ€æ±‚å¿…ç„¶æ˜¯æƒ³è¾¾åˆ°æŸç§ç›®çš„ï¼ˆå³ç½—é©¬ï¼‰ï¼Œä½†æ˜¯ç”¨æˆ·é€‰æ‹©çš„è·¯æœªå¿…æ˜¯æœ€å¥½çš„ï¼Œæ¡æ¡å¤§è·¯é€šç½—é©¬ï¼Œé‚£ä¹ˆæˆ‘ä»¬ä½œä¸ºå¼€å‘è€…çŸ¥é“äº†ç½—é©¬åœ¨å“ªå„¿ï¼Œæ˜¯ä¸æ˜¯å¯ä»¥æ‰¾å‡ºä¸€æ¡æ›´å¥½çš„è·¯å‘¢ï¼Ÿ<br>  - å¦‚æœä¸èƒ½ï¼Œé‚£å°±è€ƒè™‘Say noå§</h2></li>\n</ul>\n</li>\n<li><p><input disabled=\"\" type=\"checkbox\"> \n<a href=\"https://mp.weixin.qq.com/s/bBqeGkKxCp0xEQjmaG1JPQ\">Redisä¹Ÿå¯ä»¥æ˜¯æˆæœ¬ä¼˜åŒ–åˆ©å™¨</a></p>\n</li>\n</ul>\n","excerpt":"","more":"<h1 id=\"ä¼˜è´¨å¥½æ–‡åˆé›†\"><a href=\"#ä¼˜è´¨å¥½æ–‡åˆé›†\" class=\"headerlink\" title=\"ä¼˜è´¨å¥½æ–‡åˆé›†\"></a>ä¼˜è´¨å¥½æ–‡åˆé›†</h1><ul>\n<li><p><input disabled=\"\" type=\"checkbox\"> \n<a href=\"https://mp.weixin.qq.com/s/srkd73bS2n3mjIADLVg72A\">ä¸‡å­—é•¿æ–‡è¯¦ç»†åˆ†äº«Redisçš„å¸¸è§ä¸šåŠ¡åœºæ™¯</a></p>\n</li>\n<li><p><input disabled=\"\" type=\"checkbox\"> \n<a href=\"https://mp.weixin.qq.com/s/cc5Thv-umTnApcC8aaQJNw\">â€œæ„ä¹‰â€ä¸é©¬æ‹‰æ¾</a></p>\n</li>\n<li><p><input disabled=\"\" type=\"checkbox\"> \n<a href=\"https://mp.weixin.qq.com/s/jWKHAic4Tt4Ohsj4pTmYFw\">æ¶ˆæ¯é˜Ÿåˆ—é€‰å‹</a></p>\n</li>\n<li><p><input checked=\"\" disabled=\"\" type=\"checkbox\"> \n<a href=\"https://cloud.tencent.com/developer/article/2163702\">æ·˜å®æ•°æ®åº“ï¼Œä¸»é”®å¦‚ä½•è®¾è®¡çš„?</a></p>\n</li>\n<li><p><input disabled=\"\" type=\"checkbox\"> \n<a href=\"https://mp.weixin.qq.com/s/I-876sJiI-XFRdDkvJV_mg\">å¦‚ä½•å°½å¯èƒ½å¿«åœ°ä¸Šåä¸€ä¸ªä¸šåŠ¡oré¡¹ç›®</a><br>  é˜…è¯»è¦ç‚¹è®°å½•ï¼š</p>\n<ul>\n<li>å°½å¯èƒ½å…¨é¢åœ°æœé›†é¡¹ç›®èµ„æ–™<ul>\n<li>æ–°äººç©ºé—´èµ„æ–™</li>\n<li>ç³»ç»Ÿè¯¦ç»†èµ„æ–™ï¼Œå³ä½¿ä¸æ˜¯è‡ªå·±è´Ÿè´£çš„æ¨¡å—</li>\n</ul>\n</li>\n<li>æ¢³ç†é¢†åŸŸæ•°æ®æ¨¡å‹<ul>\n<li>ææ¸…æ¥šæ¯ä¸€ä¸ªæ•°æ®æ¨¡å‹çš„è®¾è®¡ï¼šå±æ€§åŠå…¶å«ä¹‰ã€æœ¬èº«ä»£è¡¨äº†ä»€ä¹ˆã€æ•°æ®æ¨¡å‹ä¹‹é—´çš„å…³ç³»</li>\n<li>ç”»<a href=\"https://zq99299.github.io/mysql-tutorial/ali-new-retail/03/02.html\">ERå›¾</a>æˆ–å…¶ä»–å›¾è¾…åŠ©ç†æ¸…æ€è·¯</li>\n</ul>\n</li>\n<li>ç†è§£é¡¹ç›®ç»“æ„åŠä¸šåŠ¡é€»è¾‘<ul>\n<li>MVCã€DDDï¼Œææ¸…æ¥šå…¥å£å±‚ã€æ ¸å¿ƒé€»è¾‘å±‚ã€æ•°æ®äº¤äº’å±‚åœ¨å“ªé‡Œ</li>\n<li>é€ä¸ªäº†è§£æ•°æ®æ¨¡å‹åœ¨ç³»ç»Ÿå†…å¯¹äºçš„ä¸šåŠ¡é€»è¾‘å®ç°<ul>\n<li>å¯ä»¥ä½œä½œä¸šåŠ¡æµç¨‹å›¾æ¥æ¢³ç†ï¼ˆå¯ä»¥çœ‹å°æŠ¥ç«¥ï¼‰</li>\n</ul>\n</li>\n</ul>\n</li>\n</ul>\n</li>\n<li><p><input disabled=\"\" type=\"checkbox\"> \n<a href=\"https://mp.weixin.qq.com/s/tz6V7AIBcxQcuwvp_pRgCQ\">38ä»¶ç¨‹åºå‘˜åº”è¯¥çŸ¥é“çš„äº‹å„¿</a><br>  é˜…è¯»è®°å½•</p>\n<ul>\n<li>å¯¹æŠ€æœ¯å€ºâ€œé›¶å®¹å¿â€ï¼Œæœ‰äº›äº‹åªæœ‰é›¶æ¬¡å’Œæ— æ•°æ¬¡</li>\n<li><h2 id=\"åˆ†æéœ€æ±‚èƒŒåçš„æ„ä¹‰-æ ¹æ®â€œç¬¬ä¸€æ€§åŸç†â€ï¼Œæˆ‘ä»¬åº”è¯¥ä»æœ¬è´¨å‡ºå‘è¿›è¡Œæ€è€ƒã€‚ç”¨æˆ·çš„éœ€æ±‚å¿…ç„¶æ˜¯æƒ³è¾¾åˆ°æŸç§ç›®çš„ï¼ˆå³ç½—é©¬ï¼‰ï¼Œä½†æ˜¯ç”¨æˆ·é€‰æ‹©çš„è·¯æœªå¿…æ˜¯æœ€å¥½çš„ï¼Œæ¡æ¡å¤§è·¯é€šç½—é©¬ï¼Œé‚£ä¹ˆæˆ‘ä»¬ä½œä¸ºå¼€å‘è€…çŸ¥é“äº†ç½—é©¬åœ¨å“ªå„¿ï¼Œæ˜¯ä¸æ˜¯å¯ä»¥æ‰¾å‡ºä¸€æ¡æ›´å¥½çš„è·¯å‘¢ï¼Ÿ-å¦‚æœä¸èƒ½ï¼Œé‚£å°±è€ƒè™‘Say-noå§\"><a href=\"#åˆ†æéœ€æ±‚èƒŒåçš„æ„ä¹‰-æ ¹æ®â€œç¬¬ä¸€æ€§åŸç†â€ï¼Œæˆ‘ä»¬åº”è¯¥ä»æœ¬è´¨å‡ºå‘è¿›è¡Œæ€è€ƒã€‚ç”¨æˆ·çš„éœ€æ±‚å¿…ç„¶æ˜¯æƒ³è¾¾åˆ°æŸç§ç›®çš„ï¼ˆå³ç½—é©¬ï¼‰ï¼Œä½†æ˜¯ç”¨æˆ·é€‰æ‹©çš„è·¯æœªå¿…æ˜¯æœ€å¥½çš„ï¼Œæ¡æ¡å¤§è·¯é€šç½—é©¬ï¼Œé‚£ä¹ˆæˆ‘ä»¬ä½œä¸ºå¼€å‘è€…çŸ¥é“äº†ç½—é©¬åœ¨å“ªå„¿ï¼Œæ˜¯ä¸æ˜¯å¯ä»¥æ‰¾å‡ºä¸€æ¡æ›´å¥½çš„è·¯å‘¢ï¼Ÿ-å¦‚æœä¸èƒ½ï¼Œé‚£å°±è€ƒè™‘Say-noå§\" class=\"headerlink\" title=\"åˆ†æéœ€æ±‚èƒŒåçš„æ„ä¹‰  - æ ¹æ®â€œç¬¬ä¸€æ€§åŸç†â€ï¼Œæˆ‘ä»¬åº”è¯¥ä»æœ¬è´¨å‡ºå‘è¿›è¡Œæ€è€ƒã€‚ç”¨æˆ·çš„éœ€æ±‚å¿…ç„¶æ˜¯æƒ³è¾¾åˆ°æŸç§ç›®çš„ï¼ˆå³ç½—é©¬ï¼‰ï¼Œä½†æ˜¯ç”¨æˆ·é€‰æ‹©çš„è·¯æœªå¿…æ˜¯æœ€å¥½çš„ï¼Œæ¡æ¡å¤§è·¯é€šç½—é©¬ï¼Œé‚£ä¹ˆæˆ‘ä»¬ä½œä¸ºå¼€å‘è€…çŸ¥é“äº†ç½—é©¬åœ¨å“ªå„¿ï¼Œæ˜¯ä¸æ˜¯å¯ä»¥æ‰¾å‡ºä¸€æ¡æ›´å¥½çš„è·¯å‘¢ï¼Ÿ  - å¦‚æœä¸èƒ½ï¼Œé‚£å°±è€ƒè™‘Say noå§\"></a>åˆ†æéœ€æ±‚èƒŒåçš„æ„ä¹‰<br>  - æ ¹æ®â€œç¬¬ä¸€æ€§åŸç†â€ï¼Œæˆ‘ä»¬åº”è¯¥ä»æœ¬è´¨å‡ºå‘è¿›è¡Œæ€è€ƒã€‚ç”¨æˆ·çš„éœ€æ±‚å¿…ç„¶æ˜¯æƒ³è¾¾åˆ°æŸç§ç›®çš„ï¼ˆå³ç½—é©¬ï¼‰ï¼Œä½†æ˜¯ç”¨æˆ·é€‰æ‹©çš„è·¯æœªå¿…æ˜¯æœ€å¥½çš„ï¼Œæ¡æ¡å¤§è·¯é€šç½—é©¬ï¼Œé‚£ä¹ˆæˆ‘ä»¬ä½œä¸ºå¼€å‘è€…çŸ¥é“äº†ç½—é©¬åœ¨å“ªå„¿ï¼Œæ˜¯ä¸æ˜¯å¯ä»¥æ‰¾å‡ºä¸€æ¡æ›´å¥½çš„è·¯å‘¢ï¼Ÿ<br>  - å¦‚æœä¸èƒ½ï¼Œé‚£å°±è€ƒè™‘Say noå§</h2></li>\n</ul>\n</li>\n<li><p><input disabled=\"\" type=\"checkbox\"> \n<a href=\"https://mp.weixin.qq.com/s/bBqeGkKxCp0xEQjmaG1JPQ\">Redisä¹Ÿå¯ä»¥æ˜¯æˆæœ¬ä¼˜åŒ–åˆ©å™¨</a></p>\n</li>\n</ul>\n"},{"description":"ä¸€äº›ã€Šè®¾è®¡æ¨¡å¼ä¹‹ç¾ã€‹çš„é˜…è¯»ç¬”è®°/æ‘˜æŠ„","_content":"# ã€Šè®¾è®¡æ¨¡å¼ä¹‹ç¾ã€‹é˜…è¯»ç¬”è®°\n\n![image-20241108191510420](https://raw.githubusercontent.com/lyydsheep/pic/main/202411081915460.png)\n\n## é¢å‘å¯¹è±¡\n\n### ç†è®ºäºŒï¼šå°è£…ã€æŠ½è±¡ã€ç»§æ‰¿ã€å¤šæ€\n\n#### å°è£…ï¼ˆEncapsulationï¼‰\n\nå°è£…ä¹Ÿå«åšä¿¡æ¯éšè—æˆ–æ•°æ®è®¿é—®ä¿æŠ¤ã€‚ç±»é€šè¿‡æš´éœ²æœ‰é™çš„å¯è®¿é—®æ¥å£ï¼Œæˆæƒå¤–éƒ¨ä»…èƒ½é€šè¿‡ç±»æä¾›çš„æ–¹æ³•æ¥è®¿é—®å†…éƒ¨çš„æ•°æ®ã€‚\n\nğŸŒ°ï¼š\n\n```go\ntype Wallet struct {\n\tid           string\n\tcreateTime   int64\n\tbalance      int64\n\tmodifiedTime int64\n}\n\nfunc (w *Wallet) increaseBalance(increaseAmount int64) error {\n\tif increaseAmount < 0 {\n\t\treturn errors.New(\"...\")\n\t}\n\tw.balance += increaseAmount\n\tw.modifiedTime = time.Now().UnixMilli()\n\treturn nil\n}\n```\n\nå°è£…çš„ä½œç”¨ä¸»è¦ä½“ç°åœ¨ä¸¤æ–¹é¢ï¼š\n\n- å¢åŠ æ•°æ®çš„è®¿é—®æƒé™ï¼Œé˜²æ­¢ä½¿ç”¨è€…ç›´æ¥å¯¹å†…éƒ¨æ•°æ®è¿›è¡Œæ— æ£€æŸ¥ä¿®æ”¹\n- æé«˜ç±»çš„æ˜“ç”¨æ€§ï¼Œåªå°†å…³é”®æ–¹æ³•æš´éœ²ç»™ä½¿ç”¨è€…ï¼Œé™ä½ä½¿ç”¨è€…çš„æ“ä½œè´Ÿæ‹…\n\n#### æŠ½è±¡ï¼ˆAbstractionï¼‰\n\næŠ½è±¡è®²ç©¶å¦‚ä½•éšè—**æ–¹æ³•å…·ä½“å®ç°ç»†èŠ‚**ï¼Œè®©è°ƒç”¨è€…åªéœ€è¦å…³å¿ƒå¦‚ä½•ä½¿ç”¨æ–¹æ³•ï¼Œå¹¶ä¸éœ€è¦æ–¹æ³•å†…éƒ¨æ˜¯å¦‚ä½•å®ç°çš„\n\n#### ç»§æ‰¿ï¼ˆInheritanceï¼‰\n\n> ç»§æ‰¿è¿™ä¸ªç‰¹æ€§ä¹Ÿæ˜¯ä¸€ä¸ªéå¸¸æœ‰äº‰è®®çš„ç‰¹æ€§\n\n**å°‘ç”¨ç»§æ‰¿ï¼Œå¤šç”¨ç»„åˆ**\n\n#### å¤šæ€ï¼ˆPolymorphismï¼‰\n\næŠ½è±¡åœ°ç†è§£ï¼ŒåŒä¸€ä¸ªæ–¹æ³•å‘ˆç°å‡ºä¸åŒçš„è¡Œä¸ºå°±æ˜¯å¤šæ€ã€‚åœ¨Goè¯­è¨€ä¸­çš„æ¥å£å¯ä»¥å®Œå…¨æ”¯æŒé¸­å­ç±»å‹ï¼Œå¯ä»¥è¢«ç”¨äºå¤šæ€çš„å…·ä½“å®ç°ã€‚\n\nå¤šæ€ç‰¹æ€§å¯ä»¥æé«˜ä»£ç çš„å¯æ‰©å±•ä¸‹å’Œå¤ç”¨æ€§\n\n### ç†è®ºä¸‰ã€å››ï¼šé¢å‘å¯¹è±¡å’Œé¢å‘è¿‡ç¨‹\n\né¢å‘å¯¹è±¡ï¼šä»¥ç±»å’Œå¯¹è±¡ä½œä¸ºç»„ç»‡ä»£ç çš„åŸºæœ¬å•å…ƒï¼Œå¹¶å°†å°è£…ã€æŠ½è±¡ã€ç»§æ‰¿ã€å¤šå°å››ä¸ªç‰¹æ€§ä½œä¸ºä»£ç è®¾è®¡å’Œå®ç°çš„åŸºçŸ³\n\né¢å‘è¿‡ç¨‹ï¼šä»¥è¿‡ç¨‹ï¼ˆå‡½æ•°ã€æ–¹æ³•ï¼‰ä½œä¸ºç»„ç»‡ä»£ç çš„åŸºæœ¬å•å…ƒï¼Œä»¥æ•°æ®ä¸æ–¹æ³•ç›¸åˆ†ç¦»ä¸ºæœ€ä¸»è¦çš„ç‰¹ç‚¹\n\n**é¢å‘å¯¹è±¡ç¼–ç¨‹**æ˜¯ä»¥ç±»ä¸ºæ€è€ƒå¯¹è±¡ã€‚åœ¨è¿›è¡Œé¢å‘å¯¹è±¡ç¼–ç¨‹çš„æ—¶å€™ï¼Œå¹¶ä¸æ˜¯ä¸€ä¸Šæ¥å°±å»æ€è€ƒå¦‚ä½•å°†å¤æ‚çš„æµç¨‹æ‹†è§£ä¸ºä¸€ä¸ªä¸€ä¸ªæ–¹æ³•ï¼Œ**è€Œæ˜¯é‡‡ç”¨æ›²çº¿æ•‘å›½çš„æ–¹å¼ï¼Œå…ˆå»æ€è€ƒå¦‚ä½•ç»™ä¸šåŠ¡å»ºæ¨¡ã€å¦‚ä½•å°†éœ€æ±‚ç¿»è¯‘ä¸ºç±»ã€å¦‚ä½•å»ºç«‹ç±»ä¸ç±»ä¹‹é—´çš„äº¤äº’å…³ç³»**ã€‚å½“æˆ‘ä»¬æœ‰ç±»çš„è®¾è®¡ä¹‹åï¼Œå°±èƒ½åƒæ­ç§¯æœ¨ä¸€æ ·ï¼ŒæŒ‰ç…§å¤„ç†æµç¨‹ï¼Œå°†ç±»ç»„è£…æˆæ•´ä¸ªç¨‹åº\n\n**OOPé£æ ¼çš„ä»£ç æ›´æ˜“ç»´æŠ¤ã€æ˜“å¤ç”¨ã€æ˜“æ‰©å±•**ï¼ˆå°è£…ã€ç»§æ‰¿ã€æŠ½è±¡ã€å¤šæ€ï¼‰\n","source":"_posts/ã€Šè®¾è®¡æ¨¡å¼ä¹‹ç¾ã€‹é˜…è¯»ç¬”è®°.md","raw":"---\ndescription: ä¸€äº›ã€Šè®¾è®¡æ¨¡å¼ä¹‹ç¾ã€‹çš„é˜…è¯»ç¬”è®°/æ‘˜æŠ„\ntag: è®¾è®¡æ¨¡å¼\n---\n# ã€Šè®¾è®¡æ¨¡å¼ä¹‹ç¾ã€‹é˜…è¯»ç¬”è®°\n\n![image-20241108191510420](https://raw.githubusercontent.com/lyydsheep/pic/main/202411081915460.png)\n\n## é¢å‘å¯¹è±¡\n\n### ç†è®ºäºŒï¼šå°è£…ã€æŠ½è±¡ã€ç»§æ‰¿ã€å¤šæ€\n\n#### å°è£…ï¼ˆEncapsulationï¼‰\n\nå°è£…ä¹Ÿå«åšä¿¡æ¯éšè—æˆ–æ•°æ®è®¿é—®ä¿æŠ¤ã€‚ç±»é€šè¿‡æš´éœ²æœ‰é™çš„å¯è®¿é—®æ¥å£ï¼Œæˆæƒå¤–éƒ¨ä»…èƒ½é€šè¿‡ç±»æä¾›çš„æ–¹æ³•æ¥è®¿é—®å†…éƒ¨çš„æ•°æ®ã€‚\n\nğŸŒ°ï¼š\n\n```go\ntype Wallet struct {\n\tid           string\n\tcreateTime   int64\n\tbalance      int64\n\tmodifiedTime int64\n}\n\nfunc (w *Wallet) increaseBalance(increaseAmount int64) error {\n\tif increaseAmount < 0 {\n\t\treturn errors.New(\"...\")\n\t}\n\tw.balance += increaseAmount\n\tw.modifiedTime = time.Now().UnixMilli()\n\treturn nil\n}\n```\n\nå°è£…çš„ä½œç”¨ä¸»è¦ä½“ç°åœ¨ä¸¤æ–¹é¢ï¼š\n\n- å¢åŠ æ•°æ®çš„è®¿é—®æƒé™ï¼Œé˜²æ­¢ä½¿ç”¨è€…ç›´æ¥å¯¹å†…éƒ¨æ•°æ®è¿›è¡Œæ— æ£€æŸ¥ä¿®æ”¹\n- æé«˜ç±»çš„æ˜“ç”¨æ€§ï¼Œåªå°†å…³é”®æ–¹æ³•æš´éœ²ç»™ä½¿ç”¨è€…ï¼Œé™ä½ä½¿ç”¨è€…çš„æ“ä½œè´Ÿæ‹…\n\n#### æŠ½è±¡ï¼ˆAbstractionï¼‰\n\næŠ½è±¡è®²ç©¶å¦‚ä½•éšè—**æ–¹æ³•å…·ä½“å®ç°ç»†èŠ‚**ï¼Œè®©è°ƒç”¨è€…åªéœ€è¦å…³å¿ƒå¦‚ä½•ä½¿ç”¨æ–¹æ³•ï¼Œå¹¶ä¸éœ€è¦æ–¹æ³•å†…éƒ¨æ˜¯å¦‚ä½•å®ç°çš„\n\n#### ç»§æ‰¿ï¼ˆInheritanceï¼‰\n\n> ç»§æ‰¿è¿™ä¸ªç‰¹æ€§ä¹Ÿæ˜¯ä¸€ä¸ªéå¸¸æœ‰äº‰è®®çš„ç‰¹æ€§\n\n**å°‘ç”¨ç»§æ‰¿ï¼Œå¤šç”¨ç»„åˆ**\n\n#### å¤šæ€ï¼ˆPolymorphismï¼‰\n\næŠ½è±¡åœ°ç†è§£ï¼ŒåŒä¸€ä¸ªæ–¹æ³•å‘ˆç°å‡ºä¸åŒçš„è¡Œä¸ºå°±æ˜¯å¤šæ€ã€‚åœ¨Goè¯­è¨€ä¸­çš„æ¥å£å¯ä»¥å®Œå…¨æ”¯æŒé¸­å­ç±»å‹ï¼Œå¯ä»¥è¢«ç”¨äºå¤šæ€çš„å…·ä½“å®ç°ã€‚\n\nå¤šæ€ç‰¹æ€§å¯ä»¥æé«˜ä»£ç çš„å¯æ‰©å±•ä¸‹å’Œå¤ç”¨æ€§\n\n### ç†è®ºä¸‰ã€å››ï¼šé¢å‘å¯¹è±¡å’Œé¢å‘è¿‡ç¨‹\n\né¢å‘å¯¹è±¡ï¼šä»¥ç±»å’Œå¯¹è±¡ä½œä¸ºç»„ç»‡ä»£ç çš„åŸºæœ¬å•å…ƒï¼Œå¹¶å°†å°è£…ã€æŠ½è±¡ã€ç»§æ‰¿ã€å¤šå°å››ä¸ªç‰¹æ€§ä½œä¸ºä»£ç è®¾è®¡å’Œå®ç°çš„åŸºçŸ³\n\né¢å‘è¿‡ç¨‹ï¼šä»¥è¿‡ç¨‹ï¼ˆå‡½æ•°ã€æ–¹æ³•ï¼‰ä½œä¸ºç»„ç»‡ä»£ç çš„åŸºæœ¬å•å…ƒï¼Œä»¥æ•°æ®ä¸æ–¹æ³•ç›¸åˆ†ç¦»ä¸ºæœ€ä¸»è¦çš„ç‰¹ç‚¹\n\n**é¢å‘å¯¹è±¡ç¼–ç¨‹**æ˜¯ä»¥ç±»ä¸ºæ€è€ƒå¯¹è±¡ã€‚åœ¨è¿›è¡Œé¢å‘å¯¹è±¡ç¼–ç¨‹çš„æ—¶å€™ï¼Œå¹¶ä¸æ˜¯ä¸€ä¸Šæ¥å°±å»æ€è€ƒå¦‚ä½•å°†å¤æ‚çš„æµç¨‹æ‹†è§£ä¸ºä¸€ä¸ªä¸€ä¸ªæ–¹æ³•ï¼Œ**è€Œæ˜¯é‡‡ç”¨æ›²çº¿æ•‘å›½çš„æ–¹å¼ï¼Œå…ˆå»æ€è€ƒå¦‚ä½•ç»™ä¸šåŠ¡å»ºæ¨¡ã€å¦‚ä½•å°†éœ€æ±‚ç¿»è¯‘ä¸ºç±»ã€å¦‚ä½•å»ºç«‹ç±»ä¸ç±»ä¹‹é—´çš„äº¤äº’å…³ç³»**ã€‚å½“æˆ‘ä»¬æœ‰ç±»çš„è®¾è®¡ä¹‹åï¼Œå°±èƒ½åƒæ­ç§¯æœ¨ä¸€æ ·ï¼ŒæŒ‰ç…§å¤„ç†æµç¨‹ï¼Œå°†ç±»ç»„è£…æˆæ•´ä¸ªç¨‹åº\n\n**OOPé£æ ¼çš„ä»£ç æ›´æ˜“ç»´æŠ¤ã€æ˜“å¤ç”¨ã€æ˜“æ‰©å±•**ï¼ˆå°è£…ã€ç»§æ‰¿ã€æŠ½è±¡ã€å¤šæ€ï¼‰\n","slug":"ã€Šè®¾è®¡æ¨¡å¼ä¹‹ç¾ã€‹é˜…è¯»ç¬”è®°","published":1,"date":"2024-12-27T11:03:15.344Z","updated":"2024-12-27T11:03:15.344Z","title":"","comments":1,"layout":"post","photos":[],"_id":"cm6c7md6i000ja5t21uba1ks8","content":"<h1 id=\"ã€Šè®¾è®¡æ¨¡å¼ä¹‹ç¾ã€‹é˜…è¯»ç¬”è®°\"><a href=\"#ã€Šè®¾è®¡æ¨¡å¼ä¹‹ç¾ã€‹é˜…è¯»ç¬”è®°\" class=\"headerlink\" title=\"ã€Šè®¾è®¡æ¨¡å¼ä¹‹ç¾ã€‹é˜…è¯»ç¬”è®°\"></a>ã€Šè®¾è®¡æ¨¡å¼ä¹‹ç¾ã€‹é˜…è¯»ç¬”è®°</h1><p><img src=\"https://raw.githubusercontent.com/lyydsheep/pic/main/202411081915460.png\" alt=\"image-20241108191510420\"></p>\n<h2 id=\"é¢å‘å¯¹è±¡\"><a href=\"#é¢å‘å¯¹è±¡\" class=\"headerlink\" title=\"é¢å‘å¯¹è±¡\"></a>é¢å‘å¯¹è±¡</h2><h3 id=\"ç†è®ºäºŒï¼šå°è£…ã€æŠ½è±¡ã€ç»§æ‰¿ã€å¤šæ€\"><a href=\"#ç†è®ºäºŒï¼šå°è£…ã€æŠ½è±¡ã€ç»§æ‰¿ã€å¤šæ€\" class=\"headerlink\" title=\"ç†è®ºäºŒï¼šå°è£…ã€æŠ½è±¡ã€ç»§æ‰¿ã€å¤šæ€\"></a>ç†è®ºäºŒï¼šå°è£…ã€æŠ½è±¡ã€ç»§æ‰¿ã€å¤šæ€</h3><h4 id=\"å°è£…ï¼ˆEncapsulationï¼‰\"><a href=\"#å°è£…ï¼ˆEncapsulationï¼‰\" class=\"headerlink\" title=\"å°è£…ï¼ˆEncapsulationï¼‰\"></a>å°è£…ï¼ˆEncapsulationï¼‰</h4><p>å°è£…ä¹Ÿå«åšä¿¡æ¯éšè—æˆ–æ•°æ®è®¿é—®ä¿æŠ¤ã€‚ç±»é€šè¿‡æš´éœ²æœ‰é™çš„å¯è®¿é—®æ¥å£ï¼Œæˆæƒå¤–éƒ¨ä»…èƒ½é€šè¿‡ç±»æä¾›çš„æ–¹æ³•æ¥è®¿é—®å†…éƒ¨çš„æ•°æ®ã€‚</p>\n<p>ğŸŒ°ï¼š</p>\n<figure class=\"highlight go\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">type</span> Wallet <span class=\"keyword\">struct</span> &#123;</span><br><span class=\"line\">\tid           <span class=\"type\">string</span></span><br><span class=\"line\">\tcreateTime   <span class=\"type\">int64</span></span><br><span class=\"line\">\tbalance      <span class=\"type\">int64</span></span><br><span class=\"line\">\tmodifiedTime <span class=\"type\">int64</span></span><br><span class=\"line\">&#125;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"function\"><span class=\"keyword\">func</span> <span class=\"params\">(w *Wallet)</span></span> increaseBalance(increaseAmount <span class=\"type\">int64</span>) <span class=\"type\">error</span> &#123;</span><br><span class=\"line\">\t<span class=\"keyword\">if</span> increaseAmount &lt; <span class=\"number\">0</span> &#123;</span><br><span class=\"line\">\t\t<span class=\"keyword\">return</span> errors.New(<span class=\"string\">&quot;...&quot;</span>)</span><br><span class=\"line\">\t&#125;</span><br><span class=\"line\">\tw.balance += increaseAmount</span><br><span class=\"line\">\tw.modifiedTime = time.Now().UnixMilli()</span><br><span class=\"line\">\t<span class=\"keyword\">return</span> <span class=\"literal\">nil</span></span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n\n<p>å°è£…çš„ä½œç”¨ä¸»è¦ä½“ç°åœ¨ä¸¤æ–¹é¢ï¼š</p>\n<ul>\n<li>å¢åŠ æ•°æ®çš„è®¿é—®æƒé™ï¼Œé˜²æ­¢ä½¿ç”¨è€…ç›´æ¥å¯¹å†…éƒ¨æ•°æ®è¿›è¡Œæ— æ£€æŸ¥ä¿®æ”¹</li>\n<li>æé«˜ç±»çš„æ˜“ç”¨æ€§ï¼Œåªå°†å…³é”®æ–¹æ³•æš´éœ²ç»™ä½¿ç”¨è€…ï¼Œé™ä½ä½¿ç”¨è€…çš„æ“ä½œè´Ÿæ‹…</li>\n</ul>\n<h4 id=\"æŠ½è±¡ï¼ˆAbstractionï¼‰\"><a href=\"#æŠ½è±¡ï¼ˆAbstractionï¼‰\" class=\"headerlink\" title=\"æŠ½è±¡ï¼ˆAbstractionï¼‰\"></a>æŠ½è±¡ï¼ˆAbstractionï¼‰</h4><p>æŠ½è±¡è®²ç©¶å¦‚ä½•éšè—<strong>æ–¹æ³•å…·ä½“å®ç°ç»†èŠ‚</strong>ï¼Œè®©è°ƒç”¨è€…åªéœ€è¦å…³å¿ƒå¦‚ä½•ä½¿ç”¨æ–¹æ³•ï¼Œå¹¶ä¸éœ€è¦æ–¹æ³•å†…éƒ¨æ˜¯å¦‚ä½•å®ç°çš„</p>\n<h4 id=\"ç»§æ‰¿ï¼ˆInheritanceï¼‰\"><a href=\"#ç»§æ‰¿ï¼ˆInheritanceï¼‰\" class=\"headerlink\" title=\"ç»§æ‰¿ï¼ˆInheritanceï¼‰\"></a>ç»§æ‰¿ï¼ˆInheritanceï¼‰</h4><blockquote>\n<p>ç»§æ‰¿è¿™ä¸ªç‰¹æ€§ä¹Ÿæ˜¯ä¸€ä¸ªéå¸¸æœ‰äº‰è®®çš„ç‰¹æ€§</p>\n</blockquote>\n<p><strong>å°‘ç”¨ç»§æ‰¿ï¼Œå¤šç”¨ç»„åˆ</strong></p>\n<h4 id=\"å¤šæ€ï¼ˆPolymorphismï¼‰\"><a href=\"#å¤šæ€ï¼ˆPolymorphismï¼‰\" class=\"headerlink\" title=\"å¤šæ€ï¼ˆPolymorphismï¼‰\"></a>å¤šæ€ï¼ˆPolymorphismï¼‰</h4><p>æŠ½è±¡åœ°ç†è§£ï¼ŒåŒä¸€ä¸ªæ–¹æ³•å‘ˆç°å‡ºä¸åŒçš„è¡Œä¸ºå°±æ˜¯å¤šæ€ã€‚åœ¨Goè¯­è¨€ä¸­çš„æ¥å£å¯ä»¥å®Œå…¨æ”¯æŒé¸­å­ç±»å‹ï¼Œå¯ä»¥è¢«ç”¨äºå¤šæ€çš„å…·ä½“å®ç°ã€‚</p>\n<p>å¤šæ€ç‰¹æ€§å¯ä»¥æé«˜ä»£ç çš„å¯æ‰©å±•ä¸‹å’Œå¤ç”¨æ€§</p>\n<h3 id=\"ç†è®ºä¸‰ã€å››ï¼šé¢å‘å¯¹è±¡å’Œé¢å‘è¿‡ç¨‹\"><a href=\"#ç†è®ºä¸‰ã€å››ï¼šé¢å‘å¯¹è±¡å’Œé¢å‘è¿‡ç¨‹\" class=\"headerlink\" title=\"ç†è®ºä¸‰ã€å››ï¼šé¢å‘å¯¹è±¡å’Œé¢å‘è¿‡ç¨‹\"></a>ç†è®ºä¸‰ã€å››ï¼šé¢å‘å¯¹è±¡å’Œé¢å‘è¿‡ç¨‹</h3><p>é¢å‘å¯¹è±¡ï¼šä»¥ç±»å’Œå¯¹è±¡ä½œä¸ºç»„ç»‡ä»£ç çš„åŸºæœ¬å•å…ƒï¼Œå¹¶å°†å°è£…ã€æŠ½è±¡ã€ç»§æ‰¿ã€å¤šå°å››ä¸ªç‰¹æ€§ä½œä¸ºä»£ç è®¾è®¡å’Œå®ç°çš„åŸºçŸ³</p>\n<p>é¢å‘è¿‡ç¨‹ï¼šä»¥è¿‡ç¨‹ï¼ˆå‡½æ•°ã€æ–¹æ³•ï¼‰ä½œä¸ºç»„ç»‡ä»£ç çš„åŸºæœ¬å•å…ƒï¼Œä»¥æ•°æ®ä¸æ–¹æ³•ç›¸åˆ†ç¦»ä¸ºæœ€ä¸»è¦çš„ç‰¹ç‚¹</p>\n<p><strong>é¢å‘å¯¹è±¡ç¼–ç¨‹</strong>æ˜¯ä»¥ç±»ä¸ºæ€è€ƒå¯¹è±¡ã€‚åœ¨è¿›è¡Œé¢å‘å¯¹è±¡ç¼–ç¨‹çš„æ—¶å€™ï¼Œå¹¶ä¸æ˜¯ä¸€ä¸Šæ¥å°±å»æ€è€ƒå¦‚ä½•å°†å¤æ‚çš„æµç¨‹æ‹†è§£ä¸ºä¸€ä¸ªä¸€ä¸ªæ–¹æ³•ï¼Œ<strong>è€Œæ˜¯é‡‡ç”¨æ›²çº¿æ•‘å›½çš„æ–¹å¼ï¼Œå…ˆå»æ€è€ƒå¦‚ä½•ç»™ä¸šåŠ¡å»ºæ¨¡ã€å¦‚ä½•å°†éœ€æ±‚ç¿»è¯‘ä¸ºç±»ã€å¦‚ä½•å»ºç«‹ç±»ä¸ç±»ä¹‹é—´çš„äº¤äº’å…³ç³»</strong>ã€‚å½“æˆ‘ä»¬æœ‰ç±»çš„è®¾è®¡ä¹‹åï¼Œå°±èƒ½åƒæ­ç§¯æœ¨ä¸€æ ·ï¼ŒæŒ‰ç…§å¤„ç†æµç¨‹ï¼Œå°†ç±»ç»„è£…æˆæ•´ä¸ªç¨‹åº</p>\n<p><strong>OOPé£æ ¼çš„ä»£ç æ›´æ˜“ç»´æŠ¤ã€æ˜“å¤ç”¨ã€æ˜“æ‰©å±•</strong>ï¼ˆå°è£…ã€ç»§æ‰¿ã€æŠ½è±¡ã€å¤šæ€ï¼‰</p>\n","excerpt":"","more":"<h1 id=\"ã€Šè®¾è®¡æ¨¡å¼ä¹‹ç¾ã€‹é˜…è¯»ç¬”è®°\"><a href=\"#ã€Šè®¾è®¡æ¨¡å¼ä¹‹ç¾ã€‹é˜…è¯»ç¬”è®°\" class=\"headerlink\" title=\"ã€Šè®¾è®¡æ¨¡å¼ä¹‹ç¾ã€‹é˜…è¯»ç¬”è®°\"></a>ã€Šè®¾è®¡æ¨¡å¼ä¹‹ç¾ã€‹é˜…è¯»ç¬”è®°</h1><p><img src=\"https://raw.githubusercontent.com/lyydsheep/pic/main/202411081915460.png\" alt=\"image-20241108191510420\"></p>\n<h2 id=\"é¢å‘å¯¹è±¡\"><a href=\"#é¢å‘å¯¹è±¡\" class=\"headerlink\" title=\"é¢å‘å¯¹è±¡\"></a>é¢å‘å¯¹è±¡</h2><h3 id=\"ç†è®ºäºŒï¼šå°è£…ã€æŠ½è±¡ã€ç»§æ‰¿ã€å¤šæ€\"><a href=\"#ç†è®ºäºŒï¼šå°è£…ã€æŠ½è±¡ã€ç»§æ‰¿ã€å¤šæ€\" class=\"headerlink\" title=\"ç†è®ºäºŒï¼šå°è£…ã€æŠ½è±¡ã€ç»§æ‰¿ã€å¤šæ€\"></a>ç†è®ºäºŒï¼šå°è£…ã€æŠ½è±¡ã€ç»§æ‰¿ã€å¤šæ€</h3><h4 id=\"å°è£…ï¼ˆEncapsulationï¼‰\"><a href=\"#å°è£…ï¼ˆEncapsulationï¼‰\" class=\"headerlink\" title=\"å°è£…ï¼ˆEncapsulationï¼‰\"></a>å°è£…ï¼ˆEncapsulationï¼‰</h4><p>å°è£…ä¹Ÿå«åšä¿¡æ¯éšè—æˆ–æ•°æ®è®¿é—®ä¿æŠ¤ã€‚ç±»é€šè¿‡æš´éœ²æœ‰é™çš„å¯è®¿é—®æ¥å£ï¼Œæˆæƒå¤–éƒ¨ä»…èƒ½é€šè¿‡ç±»æä¾›çš„æ–¹æ³•æ¥è®¿é—®å†…éƒ¨çš„æ•°æ®ã€‚</p>\n<p>ğŸŒ°ï¼š</p>\n<figure class=\"highlight go\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">type</span> Wallet <span class=\"keyword\">struct</span> &#123;</span><br><span class=\"line\">\tid           <span class=\"type\">string</span></span><br><span class=\"line\">\tcreateTime   <span class=\"type\">int64</span></span><br><span class=\"line\">\tbalance      <span class=\"type\">int64</span></span><br><span class=\"line\">\tmodifiedTime <span class=\"type\">int64</span></span><br><span class=\"line\">&#125;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"function\"><span class=\"keyword\">func</span> <span class=\"params\">(w *Wallet)</span></span> increaseBalance(increaseAmount <span class=\"type\">int64</span>) <span class=\"type\">error</span> &#123;</span><br><span class=\"line\">\t<span class=\"keyword\">if</span> increaseAmount &lt; <span class=\"number\">0</span> &#123;</span><br><span class=\"line\">\t\t<span class=\"keyword\">return</span> errors.New(<span class=\"string\">&quot;...&quot;</span>)</span><br><span class=\"line\">\t&#125;</span><br><span class=\"line\">\tw.balance += increaseAmount</span><br><span class=\"line\">\tw.modifiedTime = time.Now().UnixMilli()</span><br><span class=\"line\">\t<span class=\"keyword\">return</span> <span class=\"literal\">nil</span></span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n\n<p>å°è£…çš„ä½œç”¨ä¸»è¦ä½“ç°åœ¨ä¸¤æ–¹é¢ï¼š</p>\n<ul>\n<li>å¢åŠ æ•°æ®çš„è®¿é—®æƒé™ï¼Œé˜²æ­¢ä½¿ç”¨è€…ç›´æ¥å¯¹å†…éƒ¨æ•°æ®è¿›è¡Œæ— æ£€æŸ¥ä¿®æ”¹</li>\n<li>æé«˜ç±»çš„æ˜“ç”¨æ€§ï¼Œåªå°†å…³é”®æ–¹æ³•æš´éœ²ç»™ä½¿ç”¨è€…ï¼Œé™ä½ä½¿ç”¨è€…çš„æ“ä½œè´Ÿæ‹…</li>\n</ul>\n<h4 id=\"æŠ½è±¡ï¼ˆAbstractionï¼‰\"><a href=\"#æŠ½è±¡ï¼ˆAbstractionï¼‰\" class=\"headerlink\" title=\"æŠ½è±¡ï¼ˆAbstractionï¼‰\"></a>æŠ½è±¡ï¼ˆAbstractionï¼‰</h4><p>æŠ½è±¡è®²ç©¶å¦‚ä½•éšè—<strong>æ–¹æ³•å…·ä½“å®ç°ç»†èŠ‚</strong>ï¼Œè®©è°ƒç”¨è€…åªéœ€è¦å…³å¿ƒå¦‚ä½•ä½¿ç”¨æ–¹æ³•ï¼Œå¹¶ä¸éœ€è¦æ–¹æ³•å†…éƒ¨æ˜¯å¦‚ä½•å®ç°çš„</p>\n<h4 id=\"ç»§æ‰¿ï¼ˆInheritanceï¼‰\"><a href=\"#ç»§æ‰¿ï¼ˆInheritanceï¼‰\" class=\"headerlink\" title=\"ç»§æ‰¿ï¼ˆInheritanceï¼‰\"></a>ç»§æ‰¿ï¼ˆInheritanceï¼‰</h4><blockquote>\n<p>ç»§æ‰¿è¿™ä¸ªç‰¹æ€§ä¹Ÿæ˜¯ä¸€ä¸ªéå¸¸æœ‰äº‰è®®çš„ç‰¹æ€§</p>\n</blockquote>\n<p><strong>å°‘ç”¨ç»§æ‰¿ï¼Œå¤šç”¨ç»„åˆ</strong></p>\n<h4 id=\"å¤šæ€ï¼ˆPolymorphismï¼‰\"><a href=\"#å¤šæ€ï¼ˆPolymorphismï¼‰\" class=\"headerlink\" title=\"å¤šæ€ï¼ˆPolymorphismï¼‰\"></a>å¤šæ€ï¼ˆPolymorphismï¼‰</h4><p>æŠ½è±¡åœ°ç†è§£ï¼ŒåŒä¸€ä¸ªæ–¹æ³•å‘ˆç°å‡ºä¸åŒçš„è¡Œä¸ºå°±æ˜¯å¤šæ€ã€‚åœ¨Goè¯­è¨€ä¸­çš„æ¥å£å¯ä»¥å®Œå…¨æ”¯æŒé¸­å­ç±»å‹ï¼Œå¯ä»¥è¢«ç”¨äºå¤šæ€çš„å…·ä½“å®ç°ã€‚</p>\n<p>å¤šæ€ç‰¹æ€§å¯ä»¥æé«˜ä»£ç çš„å¯æ‰©å±•ä¸‹å’Œå¤ç”¨æ€§</p>\n<h3 id=\"ç†è®ºä¸‰ã€å››ï¼šé¢å‘å¯¹è±¡å’Œé¢å‘è¿‡ç¨‹\"><a href=\"#ç†è®ºä¸‰ã€å››ï¼šé¢å‘å¯¹è±¡å’Œé¢å‘è¿‡ç¨‹\" class=\"headerlink\" title=\"ç†è®ºä¸‰ã€å››ï¼šé¢å‘å¯¹è±¡å’Œé¢å‘è¿‡ç¨‹\"></a>ç†è®ºä¸‰ã€å››ï¼šé¢å‘å¯¹è±¡å’Œé¢å‘è¿‡ç¨‹</h3><p>é¢å‘å¯¹è±¡ï¼šä»¥ç±»å’Œå¯¹è±¡ä½œä¸ºç»„ç»‡ä»£ç çš„åŸºæœ¬å•å…ƒï¼Œå¹¶å°†å°è£…ã€æŠ½è±¡ã€ç»§æ‰¿ã€å¤šå°å››ä¸ªç‰¹æ€§ä½œä¸ºä»£ç è®¾è®¡å’Œå®ç°çš„åŸºçŸ³</p>\n<p>é¢å‘è¿‡ç¨‹ï¼šä»¥è¿‡ç¨‹ï¼ˆå‡½æ•°ã€æ–¹æ³•ï¼‰ä½œä¸ºç»„ç»‡ä»£ç çš„åŸºæœ¬å•å…ƒï¼Œä»¥æ•°æ®ä¸æ–¹æ³•ç›¸åˆ†ç¦»ä¸ºæœ€ä¸»è¦çš„ç‰¹ç‚¹</p>\n<p><strong>é¢å‘å¯¹è±¡ç¼–ç¨‹</strong>æ˜¯ä»¥ç±»ä¸ºæ€è€ƒå¯¹è±¡ã€‚åœ¨è¿›è¡Œé¢å‘å¯¹è±¡ç¼–ç¨‹çš„æ—¶å€™ï¼Œå¹¶ä¸æ˜¯ä¸€ä¸Šæ¥å°±å»æ€è€ƒå¦‚ä½•å°†å¤æ‚çš„æµç¨‹æ‹†è§£ä¸ºä¸€ä¸ªä¸€ä¸ªæ–¹æ³•ï¼Œ<strong>è€Œæ˜¯é‡‡ç”¨æ›²çº¿æ•‘å›½çš„æ–¹å¼ï¼Œå…ˆå»æ€è€ƒå¦‚ä½•ç»™ä¸šåŠ¡å»ºæ¨¡ã€å¦‚ä½•å°†éœ€æ±‚ç¿»è¯‘ä¸ºç±»ã€å¦‚ä½•å»ºç«‹ç±»ä¸ç±»ä¹‹é—´çš„äº¤äº’å…³ç³»</strong>ã€‚å½“æˆ‘ä»¬æœ‰ç±»çš„è®¾è®¡ä¹‹åï¼Œå°±èƒ½åƒæ­ç§¯æœ¨ä¸€æ ·ï¼ŒæŒ‰ç…§å¤„ç†æµç¨‹ï¼Œå°†ç±»ç»„è£…æˆæ•´ä¸ªç¨‹åº</p>\n<p><strong>OOPé£æ ¼çš„ä»£ç æ›´æ˜“ç»´æŠ¤ã€æ˜“å¤ç”¨ã€æ˜“æ‰©å±•</strong>ï¼ˆå°è£…ã€ç»§æ‰¿ã€æŠ½è±¡ã€å¤šæ€ï¼‰</p>\n"},{"title":"TCPã€UDPçŸ¥è¯†ç‚¹","publish":true,"description":"è®°å½•äº†ä¸€äº›TCPã€UDPçŸ¥è¯†ç‚¹","date":"2024-09-14T10:29:00.000Z","sticky":2,"_content":"\n# TCPã€UDP\n\n## TCPç²˜åŒ…æ‹†åŒ…\n\n> ä¸ºä»€ä¹ˆä¼šæœ‰TCPç²˜åŒ…ï¼Ÿåº”ç”¨å±‚æ˜¯å¦‚ä½•è§£å†³TCPç²˜åŒ…çš„é—®é¢˜ï¼Ÿ\n\n### ä»€ä¹ˆæ˜¯TCPç²˜åŒ…\n\nTCPç²˜åŒ…å°±æ˜¯æŒ‡å‘é€æ–¹å‘é€çš„è‹¥å¹²ä¸ªæ•°æ®åŒ…åˆ°è¾¾æ¥æ”¶æ–¹æ—¶ç²˜æˆäº†ä¸€åŒ…ï¼Œä»æ¥å—ç¼“å†²åŒºçœ‹ï¼Œè‹¥å¹²ä¸ªæ•°æ®åŒ…é¦–ä½ç›¸è¿ï¼Œå¥½åƒæ˜¯ç²˜åœ¨äº†ä¸€å—å„¿ã€‚TCPç²˜åŒ…çš„åŸå› å¯èƒ½æ˜¯æ¥è‡ªå‘é€æ–¹ï¼Œä¹Ÿå¯èƒ½æ¥è‡ªæ¥æ”¶æ–¹ã€‚\n\n### TCPç²˜åŒ…çš„åŸå› \n\n1. å‘é€æ–¹çš„åŸå› \n\nTCPé»˜è®¤ä½¿ç”¨**Nagle**ç®—æ³•ï¼ˆç”¨äºå‡è½»ç½‘ç»œè´Ÿæ‹…ï¼Œæé«˜æ•°æ®ä¼ è¾“çš„æ•ˆç‡ï¼‰ï¼Œè€ŒNagleç®—æ³•ä¸»è¦å·¥ä½œæœ‰è¿™ä¹ˆä¸¤ä¸ªï¼š\n\n- åªæœ‰ä¸Šä¸€ä¸ªåˆ†ç»„å¾—åˆ°ç¡®è®¤ï¼Œæ‰ä¼šå‘é€ä¸‹ä¸€ä¸ªåˆ†ç»„çš„æ•°æ®åŒ…\n- æ”¶é›†å¤šä¸ªå°åˆ†ç»„ï¼Œç´¯è®¡æ•°æ®é‡ï¼Œåœ¨ä¸€ä¸ªç¡®è®¤åˆ°æ¥åä¸€å—å‘é€\n\nå‘é€æ–¹ç”±äºä½¿ç”¨äº†**Nagle**ç®—æ³•ï¼Œæ‰ä¼šå¯¼è‡´TCPç²˜åŒ…çš„ç°è±¡\n\n2. æ¥æ”¶æ–¹çš„åŸå› \n\nä¸€èˆ¬æƒ…å†µä¸‹ï¼Œæ¥æ”¶æ–¹æ”¶åˆ°æ•°æ®åŒ…æ—¶ï¼Œå¹¶ä¸ä¼šç«‹é©¬äº¤ä»˜ç»™åº”ç”¨å±‚è¿›è¡Œå¤„ç†ï¼Œè€Œæ˜¯æ”¾åœ¨**ç¼“å†²çª—å£**ä¸­ï¼Œç„¶ååº”ç”¨ç¨‹åºå†ä»ç¼“å†²çª—å£ä¸­è¯»å–æ”¶åˆ°çš„åˆ†ç»„ã€‚å¦‚æœåº”ç”¨ç¨‹åºçš„è¯»å–é€Ÿåº¦è¿œå°äºæ•°æ®çš„ç¼“å­˜é€Ÿåº¦ï¼Œé‚£ä¹ˆå°±ä¼šæœ‰å¤šä¸ªåŒ…è¢«ç¼“å­˜åœ¨çª—å£ä¸­ï¼Œæ­¤æ—¶åº”ç”¨ç¨‹åºå°±å¯èƒ½ä¼šè¯»å–åˆ°é¦–ä½ç²˜åœ¨ä¸€èµ·çš„æ•°æ®åŒ…\n\n### å¦‚ä½•è§£å†³TCPç²˜åŒ…\n\nå¯¹äºå‘é€æ–¹ï¼Œå¯ä»¥é€šè¿‡å…³é—­Nagleç®—æ³•æ¥è§£å†³\n\nå¯¹äºæ¥æ”¶æ–¹ï¼Œåªèƒ½ä¾é åº”ç”¨å±‚æ¥è§£å†³\n\nå¯¹äºåº”ç”¨ç¨‹åºï¼Œä¸€èˆ¬æœ‰ä¸¤ç§æ–¹æ³•æ¥åŒºåˆ«ä¸€å¤§å¨çš„æ•°æ®åˆ†åˆ«ç”±å“ªä¸ªåˆ†ç»„æ„æˆï¼š\n\n- **æ ¼å¼åŒ–æ•°æ®**ï¼šæ¯æ¡æ•°æ®éƒ½æœ‰å›ºå®šçš„æ ¼å¼ï¼Œä¾‹å¦‚å¤§åé¼é¼çš„Redisåœ¨æ•°æ®äº¤äº’æ—¶å°±ç”¨`\\n`æ¥åŒºåˆ†æ¯ä¸€ä¸ªæ•°æ®åˆ†ç»„\n- **å‘é€é•¿åº¦**ï¼šå‘é€æ¯æ¡æ•°æ®æ—¶ï¼Œå°†æ•°æ®çš„é•¿åº¦ä¸€å¹¶å‘é€ï¼Œä¾‹å¦‚HTTPåè®®ä¸­çš„`Content-Length`å­—æ®µ\n\n### UDPæœ‰æœ¨æœ‰ç²˜åŒ…é—®é¢˜\n\nTCPé‡‡ç”¨äº†**åŸºäºæµçš„ä¼ è¾“**ï¼ŒåŸºäºæµçš„ä¼ è¾“ä¸è®¤ä¸ºæ¶ˆæ¯æ˜¯ä¸€æ¡ä¸€æ¡çš„ï¼Œæ˜¯æ— ä¿æŠ¤æ¶ˆæ¯è¾¹ç•Œçš„\n\nè€ŒUDPåˆ™æ˜¯**é¢å‘æ¶ˆæ¯ä¼ è¾“**çš„ï¼Œæ˜¯æœ‰ä¿æŠ¤æ¶ˆæ¯è¾¹ç•Œçš„ï¼Œæ¥æ”¶æ–¹åªèƒ½ä¸€æ¬¡åªèƒ½æ¥å—ä¸€æ¡ç‹¬ç«‹çš„æ¶ˆæ¯ï¼Œæ‰€ä»¥**ä¸å­˜åœ¨ç²˜åŒ…é—®é¢˜**\n\n## TPCå¼‚å¸¸\n\nå¦‚æœ**å®¢æˆ·ç«¯è¿›ç¨‹å´©æºƒ**ï¼Œå®¢æˆ·ç«¯çš„è¿›ç¨‹åœ¨å‘ç”Ÿå¥”æºƒæ—¶ï¼Œå†…æ ¸ä¼šå‘é€FINæŠ¥æ–‡ï¼Œä¸æœåŠ¡ç«¯è¿›è¡Œå››æ¬¡æŒ¥æ‰‹\n\nå¦‚æœ**å®¢æˆ·ç«¯ä¸»æœºå®•æœº**ï¼Œå®¢æˆ·ç«¯ä¸ä¼šå‘é€FINæŠ¥æ–‡ï¼Œåç»­æƒ…å†µéœ€è¦æ ¹æ®æœåŠ¡ç«¯çš„è¡Œä¸ºæ¥åˆ¤æ–­\n\n- å¦‚æœæœåŠ¡ç«¯**ä¼šå‘é€æ•°æ®**ï¼Œç”±äºå®¢æˆ·ç«¯å·²ç»å®•æœºï¼ŒæœåŠ¡ç«¯æ”¶ä¸åˆ°å“åº”æŠ¥æ–‡ï¼Œäºæ˜¯ä¼šè¿›è¡Œè¶…æ—¶é‡ä¼ ï¼Œå½“é‡ä¼ æ€»é—´éš”æ—¶é•¿è¶…è¿‡ä¸€å®šé˜ˆå€¼åï¼Œä¼šæ–­å¼€TCPè¿æ¥\n- å¦‚æœæœåŠ¡ç«¯ä¸ä¼šå‘é€æ•°æ®ï¼Œåˆ™éœ€è¦çœ‹çœ‹æœåŠ¡ç«¯**æ˜¯å¦å¼€å¯äº†TCP keepaliveæœºåˆ¶**\n  - å¦‚æœå¼€å¯äº†TCP keepaliveæœºåˆ¶ï¼ŒæœåŠ¡ç«¯é€šè¿‡å‘é€æ¢æµ‹æŠ¥æ–‡å‘ç°å®¢æˆ·ç«¯å·²ç»æ¶ˆäº¡ï¼Œåˆ™ä¼šæ–­å¼€è‡ªèº«çš„TCPè¿æ¥\n  - å¦‚æœæ²¡æœ‰å¼€å¯ï¼ŒæœåŠ¡ç«¯çš„TCPè¿æ¥ä¼šä¸€ç›´å­˜åœ¨ï¼Œå¹¶ä¸”ä¿æŒç€ESTABLISHEDçŠ¶æ€\n\n## HTTP Keep-Aliveå’ŒTCP Keepalive\n\n### HTTP Keep-Alive\n\nHTTPåè®®åŸºäºTCPä¼ è¾“åè®®å®ç°ï¼Œé‡‡ç”¨**è¯·æ±‚ã€åº”ç­”**æ¨¡å¼è¿›è¡Œä¿¡æ¯äº¤äº’ã€‚ä¹Ÿå°±æ˜¯è¯´ï¼Œæ¯ä¸€æ¬¡çš„æ•°æ®ä¼ è¾“éƒ½è¦ç»å†è¿™å››ä¸ªè¿‡ç¨‹ï¼šå»ºç«‹TCPè¿æ¥  -->  è¯·æ±‚æ•°æ®èµ„æº  -->  å“åº”æ•°æ®èµ„æº  -->  æ–­å¼€TCPè¿æ¥ï¼ˆå³HTTPçŸ­è¿æ¥ï¼‰\n\nä½†ç°å¦‚ä»Šï¼Œä¸€ä¸ªHTMLé¡µé¢å°±å¯èƒ½åŒ…å«äº†ä¸Šç™¾ä¸ªæ•°æ®èµ„æºï¼Œä¹Ÿå°±æ˜¯è¯´è‡³å°‘å¾—å»ºç«‹å‡ ç™¾ä¸ªTCPè¿æ¥æ‰èƒ½æŠŠä¸€ä¸ªç½‘é¡µåŠ è½½å‡ºæ¥ã€‚å¦‚æ­¤æµ®èºçš„æ—¶ä»£ï¼Œå¦‚æ­¤å¤¸å¼ çš„ç½‘ç»œå»¶è¿Ÿï¼Œç”¨æˆ·ä½“éªŒè‚¯å®šå¼‚å¸¸ç³Ÿç³•\n\nä¸€ä¸ªå¾ˆç›´æ¥çš„æƒ³æ³•å°±æ˜¯æ‰€æœ‰çš„è¯·æ±‚åº”ç­”èµ„æºéƒ½å…±ç”¨ä¸€ä¸ªTCPè¿æ¥ï¼Œè¿™æ ·å°±çœå»äº†å¾ˆå¤šå»ºç«‹ã€æ–­å¼€TCPè¿æ¥çš„æ—¶é—´ã€‚è€Œåœ¨å®é™…åº”ç”¨ä¸­ï¼Œå°±æ˜¯ä½¿ç”¨**HTTP Keep-Alive**å®ç°è¿™ä¸ªåŠŸèƒ½çš„ï¼Œå¯ä»¥ä½¿ç”¨åŒä¸€ä¸ªTCPè¿æ¥æ¥å‘é€å’Œæ¥æ”¶å¤šä¸ªHTTPè¯·æ±‚/åº”ç­”ï¼Œé¿å…è¿æ¥å»ºç«‹å’Œé‡Šæ”¾çš„å¼€é”€ï¼Œå³**HTTPé•¿è¿æ¥**\n\nHTTPé•¿è¿æ¥çš„ä¸€ä¸ªç‰¹ç‚¹å°±æ˜¯ï¼š**åªè¦ä¸€ç«¯æ²¡æœ‰æ˜ç¡®æ–­å¼€è¿æ¥ï¼Œå°±ä¿æŒTCPè¿æ¥çŠ¶æ€**\n\n### TCP Keepalive\n\nTCP Keepaliveæœºåˆ¶å°±æ˜¯**TCPè¿æ¥çš„ä¿æ´»æœºåˆ¶**ï¼Œå½“è¿æ¥çš„åŒæ–¹å¾ˆé•¿ä¸€æ®µæ—¶é—´æ²¡æœ‰é€šä¿¡ï¼ˆè¿›è¡Œæ•°æ®çš„äº¤äº’ï¼‰ï¼Œè¾¾åˆ°è§¦å‘TCPä¿æ´»æœºåˆ¶çš„æ¡ä»¶ï¼Œé‚£ä¹ˆ**å†…æ ¸**ä¸­çš„TCPåè®®æ ˆå°±ä¼šå‘é€æ¢æµ‹æŠ¥æ–‡\n\n- å¦‚æœå¯¹ç«¯ç¨‹åºæ­£å¸¸è¿è¡Œï¼Œæ¥æ”¶åˆ°æ¢æµ‹æŠ¥æ–‡åä¼šæ­£å¸¸å“åº”ï¼ŒTCPä¿æ´»æ—¶é—´å°†è¢«é‡ç½®\n- å¦‚æœå¯¹ç«¯ä¸»æœºå®•æœºï¼ˆæ³¨æ„**ä¸æ˜¯è¿›ç¨‹å´©æºƒ**ï¼Œå› ä¸ºå½“æ“ä½œç³»ç»Ÿå›æ”¶å´©æºƒçš„è¿›ç¨‹æ—¶ï¼Œä¼šå‘é€FINæŠ¥æ–‡æ¥æ–­å¼€TCPè¿æ¥ã€‚è€Œä¸»æœºå®•æœºåˆ™æ˜¯å¯¹ç«¯ä¸å¯çŸ¥çš„ï¼Œéœ€è¦é€šè¿‡ä¿æ´»æœºåˆ¶æ¥æ¢æµ‹æ˜¯å¦æ˜¯çœŸçš„å®•æœºï¼‰ï¼Œæˆ–å…¶ä»–åŸå› å¯¼è‡´æ¢æµ‹æŠ¥æ–‡æ— æ³•æ­£å¸¸å¾—åˆ°å“åº”ï¼Œé‡å¤å‡ æ¬¡ï¼Œ**è¾¾åˆ°é‡å‘é˜ˆå€¼åï¼Œå°±æŠ¥å‘ŠTCPè¿æ¥æ­»äº¡ï¼Œéœ€è¦æ–­å¼€è¯¥TCPè¿æ¥**\n\n## UDP vs TCP\n\n> å¼„æ¸…æ¥šUDPå’ŒTCPçš„åŒºåˆ«å’Œåº”ç”¨åœºæ™¯ï¼Œè‡³å°‘è¦è®°å¿†3ä¸ªåŒºåˆ«\n\n- è¿æ¥\n  - TCPè¦æ±‚åœ¨å‘é€æ–¹å’Œæ¥æ”¶æ–¹é€šä¿¡ä¹‹å‰å»ºç«‹ä¸€ä¸ªTCPè¿æ¥ï¼Œæ˜¯é¢å‘è¿æ¥çš„åè®®\n  - UDPæ˜¯æ— è¿æ¥åè®®\n- ä¿è¯æ•°æ®ä¼ è¾“çš„é¡ºåº\n  - åœ¨TCPä¸­ï¼Œç”±äºäº‹å…ˆå»ºç«‹äº†ä¸€æ¡è‰¯å¥½çš„è¿æ¥ï¼Œæ¥æ”¶æ–¹å°†é¡ºåºåœ°æ¥æ”¶æ•°æ®åŒ…\n  - è€Œåœ¨UDPä¸­ï¼Œæ¥æ”¶æ–¹ä»¥æ— åºçš„æ–¹å¼æ¥æ”¶æ•°æ®åŒ…\n- å¯é æ€§\n  - æ¯å½“æ¥æ”¶æ–¹é€šè¿‡TCPè¿æ¥æ¥æ”¶åˆ°æ•°æ®åŒ…åï¼Œéƒ½ä¼šå‘å‘é€æ–¹å‘é€ä¸€ä¸ªå“åº”åŒ…ï¼Œæ˜ç¡®ä¸éœ€è¦é‡ä¼ è¿™ä¸ªæ•°æ®åŒ…\n  - UDPæ˜¯å°½åŠ›è€Œä¸ºçš„ï¼Œåªèƒ½ä¾èµ–äºé«˜å±‚åè®®å®ç°å¯é ä¼ è¾“ï¼Œä¾‹å¦‚[QUIC](https://en.wikipedia.org/wiki/QUIC)åè®®\n- é”™è¯¯æ£€æŸ¥\n  - TCPä¸­æœ‰å¹¿æ³›çš„é”™è¯¯æ£€æŸ¥è§„åˆ™ï¼Œ\n  - è€ŒUDPä¸­åªæœ‰åŸºæœ¬çš„æ ¡éªŒå’Œé”™è¯¯æ£€æŸ¥æŠ€æœ¯\n- ä¼ è¾“æ–¹æ³•\n  - åœ¨TCPä¸­ï¼Œæ•°æ®ä»¥å­—èŠ‚æµçš„å½¢å¼ä¼ è¾“\n  - è€Œåœ¨UDPä¸­ï¼Œæ•°æ®æ˜¯ä»¥ä¸€ä¸ªä¸€ä¸ªæ•°æ®åŒ…çš„å½¢å¼å‘é€çš„\n- å¹¿æ’­\n  - TCPä¸æ”¯æŒå¹¿æ’­ï¼Œå› ä¸ºTCPåè®®è¦æ±‚å‘é€æ–¹å’Œæ¥æ”¶æ–¹å»ºç«‹ä¸€æ¡è¿æ¥ï¼Œåœ¨å‘é€åæ–­å¼€è¿æ¥\n  - UDPæ”¯æŒå¹¿æ’­\n- TCPå’ŒUDPå¸¸è§ä½¿ç”¨åœºæ™¯\n  - TCPï¼šHTTPSã€HTTPã€SMTPã€FTP\n  - UDPï¼šDNSã€è§†é¢‘æµã€è§†é¢‘ç”µè¯ã€è¯­éŸ³æœåŠ¡\n","source":"_posts/ä¼ è¾“å±‚çŸ¥è¯†ç‚¹.md","raw":"---\ntitle: TCPã€UDPçŸ¥è¯†ç‚¹\npublish: true\ndescription: è®°å½•äº†ä¸€äº›TCPã€UDPçŸ¥è¯†ç‚¹\ndate: 2024-09-14 18:29:00\ntag: è®¡ç®—æœºç½‘ç»œ\nsticky: 2\n---\n\n# TCPã€UDP\n\n## TCPç²˜åŒ…æ‹†åŒ…\n\n> ä¸ºä»€ä¹ˆä¼šæœ‰TCPç²˜åŒ…ï¼Ÿåº”ç”¨å±‚æ˜¯å¦‚ä½•è§£å†³TCPç²˜åŒ…çš„é—®é¢˜ï¼Ÿ\n\n### ä»€ä¹ˆæ˜¯TCPç²˜åŒ…\n\nTCPç²˜åŒ…å°±æ˜¯æŒ‡å‘é€æ–¹å‘é€çš„è‹¥å¹²ä¸ªæ•°æ®åŒ…åˆ°è¾¾æ¥æ”¶æ–¹æ—¶ç²˜æˆäº†ä¸€åŒ…ï¼Œä»æ¥å—ç¼“å†²åŒºçœ‹ï¼Œè‹¥å¹²ä¸ªæ•°æ®åŒ…é¦–ä½ç›¸è¿ï¼Œå¥½åƒæ˜¯ç²˜åœ¨äº†ä¸€å—å„¿ã€‚TCPç²˜åŒ…çš„åŸå› å¯èƒ½æ˜¯æ¥è‡ªå‘é€æ–¹ï¼Œä¹Ÿå¯èƒ½æ¥è‡ªæ¥æ”¶æ–¹ã€‚\n\n### TCPç²˜åŒ…çš„åŸå› \n\n1. å‘é€æ–¹çš„åŸå› \n\nTCPé»˜è®¤ä½¿ç”¨**Nagle**ç®—æ³•ï¼ˆç”¨äºå‡è½»ç½‘ç»œè´Ÿæ‹…ï¼Œæé«˜æ•°æ®ä¼ è¾“çš„æ•ˆç‡ï¼‰ï¼Œè€ŒNagleç®—æ³•ä¸»è¦å·¥ä½œæœ‰è¿™ä¹ˆä¸¤ä¸ªï¼š\n\n- åªæœ‰ä¸Šä¸€ä¸ªåˆ†ç»„å¾—åˆ°ç¡®è®¤ï¼Œæ‰ä¼šå‘é€ä¸‹ä¸€ä¸ªåˆ†ç»„çš„æ•°æ®åŒ…\n- æ”¶é›†å¤šä¸ªå°åˆ†ç»„ï¼Œç´¯è®¡æ•°æ®é‡ï¼Œåœ¨ä¸€ä¸ªç¡®è®¤åˆ°æ¥åä¸€å—å‘é€\n\nå‘é€æ–¹ç”±äºä½¿ç”¨äº†**Nagle**ç®—æ³•ï¼Œæ‰ä¼šå¯¼è‡´TCPç²˜åŒ…çš„ç°è±¡\n\n2. æ¥æ”¶æ–¹çš„åŸå› \n\nä¸€èˆ¬æƒ…å†µä¸‹ï¼Œæ¥æ”¶æ–¹æ”¶åˆ°æ•°æ®åŒ…æ—¶ï¼Œå¹¶ä¸ä¼šç«‹é©¬äº¤ä»˜ç»™åº”ç”¨å±‚è¿›è¡Œå¤„ç†ï¼Œè€Œæ˜¯æ”¾åœ¨**ç¼“å†²çª—å£**ä¸­ï¼Œç„¶ååº”ç”¨ç¨‹åºå†ä»ç¼“å†²çª—å£ä¸­è¯»å–æ”¶åˆ°çš„åˆ†ç»„ã€‚å¦‚æœåº”ç”¨ç¨‹åºçš„è¯»å–é€Ÿåº¦è¿œå°äºæ•°æ®çš„ç¼“å­˜é€Ÿåº¦ï¼Œé‚£ä¹ˆå°±ä¼šæœ‰å¤šä¸ªåŒ…è¢«ç¼“å­˜åœ¨çª—å£ä¸­ï¼Œæ­¤æ—¶åº”ç”¨ç¨‹åºå°±å¯èƒ½ä¼šè¯»å–åˆ°é¦–ä½ç²˜åœ¨ä¸€èµ·çš„æ•°æ®åŒ…\n\n### å¦‚ä½•è§£å†³TCPç²˜åŒ…\n\nå¯¹äºå‘é€æ–¹ï¼Œå¯ä»¥é€šè¿‡å…³é—­Nagleç®—æ³•æ¥è§£å†³\n\nå¯¹äºæ¥æ”¶æ–¹ï¼Œåªèƒ½ä¾é åº”ç”¨å±‚æ¥è§£å†³\n\nå¯¹äºåº”ç”¨ç¨‹åºï¼Œä¸€èˆ¬æœ‰ä¸¤ç§æ–¹æ³•æ¥åŒºåˆ«ä¸€å¤§å¨çš„æ•°æ®åˆ†åˆ«ç”±å“ªä¸ªåˆ†ç»„æ„æˆï¼š\n\n- **æ ¼å¼åŒ–æ•°æ®**ï¼šæ¯æ¡æ•°æ®éƒ½æœ‰å›ºå®šçš„æ ¼å¼ï¼Œä¾‹å¦‚å¤§åé¼é¼çš„Redisåœ¨æ•°æ®äº¤äº’æ—¶å°±ç”¨`\\n`æ¥åŒºåˆ†æ¯ä¸€ä¸ªæ•°æ®åˆ†ç»„\n- **å‘é€é•¿åº¦**ï¼šå‘é€æ¯æ¡æ•°æ®æ—¶ï¼Œå°†æ•°æ®çš„é•¿åº¦ä¸€å¹¶å‘é€ï¼Œä¾‹å¦‚HTTPåè®®ä¸­çš„`Content-Length`å­—æ®µ\n\n### UDPæœ‰æœ¨æœ‰ç²˜åŒ…é—®é¢˜\n\nTCPé‡‡ç”¨äº†**åŸºäºæµçš„ä¼ è¾“**ï¼ŒåŸºäºæµçš„ä¼ è¾“ä¸è®¤ä¸ºæ¶ˆæ¯æ˜¯ä¸€æ¡ä¸€æ¡çš„ï¼Œæ˜¯æ— ä¿æŠ¤æ¶ˆæ¯è¾¹ç•Œçš„\n\nè€ŒUDPåˆ™æ˜¯**é¢å‘æ¶ˆæ¯ä¼ è¾“**çš„ï¼Œæ˜¯æœ‰ä¿æŠ¤æ¶ˆæ¯è¾¹ç•Œçš„ï¼Œæ¥æ”¶æ–¹åªèƒ½ä¸€æ¬¡åªèƒ½æ¥å—ä¸€æ¡ç‹¬ç«‹çš„æ¶ˆæ¯ï¼Œæ‰€ä»¥**ä¸å­˜åœ¨ç²˜åŒ…é—®é¢˜**\n\n## TPCå¼‚å¸¸\n\nå¦‚æœ**å®¢æˆ·ç«¯è¿›ç¨‹å´©æºƒ**ï¼Œå®¢æˆ·ç«¯çš„è¿›ç¨‹åœ¨å‘ç”Ÿå¥”æºƒæ—¶ï¼Œå†…æ ¸ä¼šå‘é€FINæŠ¥æ–‡ï¼Œä¸æœåŠ¡ç«¯è¿›è¡Œå››æ¬¡æŒ¥æ‰‹\n\nå¦‚æœ**å®¢æˆ·ç«¯ä¸»æœºå®•æœº**ï¼Œå®¢æˆ·ç«¯ä¸ä¼šå‘é€FINæŠ¥æ–‡ï¼Œåç»­æƒ…å†µéœ€è¦æ ¹æ®æœåŠ¡ç«¯çš„è¡Œä¸ºæ¥åˆ¤æ–­\n\n- å¦‚æœæœåŠ¡ç«¯**ä¼šå‘é€æ•°æ®**ï¼Œç”±äºå®¢æˆ·ç«¯å·²ç»å®•æœºï¼ŒæœåŠ¡ç«¯æ”¶ä¸åˆ°å“åº”æŠ¥æ–‡ï¼Œäºæ˜¯ä¼šè¿›è¡Œè¶…æ—¶é‡ä¼ ï¼Œå½“é‡ä¼ æ€»é—´éš”æ—¶é•¿è¶…è¿‡ä¸€å®šé˜ˆå€¼åï¼Œä¼šæ–­å¼€TCPè¿æ¥\n- å¦‚æœæœåŠ¡ç«¯ä¸ä¼šå‘é€æ•°æ®ï¼Œåˆ™éœ€è¦çœ‹çœ‹æœåŠ¡ç«¯**æ˜¯å¦å¼€å¯äº†TCP keepaliveæœºåˆ¶**\n  - å¦‚æœå¼€å¯äº†TCP keepaliveæœºåˆ¶ï¼ŒæœåŠ¡ç«¯é€šè¿‡å‘é€æ¢æµ‹æŠ¥æ–‡å‘ç°å®¢æˆ·ç«¯å·²ç»æ¶ˆäº¡ï¼Œåˆ™ä¼šæ–­å¼€è‡ªèº«çš„TCPè¿æ¥\n  - å¦‚æœæ²¡æœ‰å¼€å¯ï¼ŒæœåŠ¡ç«¯çš„TCPè¿æ¥ä¼šä¸€ç›´å­˜åœ¨ï¼Œå¹¶ä¸”ä¿æŒç€ESTABLISHEDçŠ¶æ€\n\n## HTTP Keep-Aliveå’ŒTCP Keepalive\n\n### HTTP Keep-Alive\n\nHTTPåè®®åŸºäºTCPä¼ è¾“åè®®å®ç°ï¼Œé‡‡ç”¨**è¯·æ±‚ã€åº”ç­”**æ¨¡å¼è¿›è¡Œä¿¡æ¯äº¤äº’ã€‚ä¹Ÿå°±æ˜¯è¯´ï¼Œæ¯ä¸€æ¬¡çš„æ•°æ®ä¼ è¾“éƒ½è¦ç»å†è¿™å››ä¸ªè¿‡ç¨‹ï¼šå»ºç«‹TCPè¿æ¥  -->  è¯·æ±‚æ•°æ®èµ„æº  -->  å“åº”æ•°æ®èµ„æº  -->  æ–­å¼€TCPè¿æ¥ï¼ˆå³HTTPçŸ­è¿æ¥ï¼‰\n\nä½†ç°å¦‚ä»Šï¼Œä¸€ä¸ªHTMLé¡µé¢å°±å¯èƒ½åŒ…å«äº†ä¸Šç™¾ä¸ªæ•°æ®èµ„æºï¼Œä¹Ÿå°±æ˜¯è¯´è‡³å°‘å¾—å»ºç«‹å‡ ç™¾ä¸ªTCPè¿æ¥æ‰èƒ½æŠŠä¸€ä¸ªç½‘é¡µåŠ è½½å‡ºæ¥ã€‚å¦‚æ­¤æµ®èºçš„æ—¶ä»£ï¼Œå¦‚æ­¤å¤¸å¼ çš„ç½‘ç»œå»¶è¿Ÿï¼Œç”¨æˆ·ä½“éªŒè‚¯å®šå¼‚å¸¸ç³Ÿç³•\n\nä¸€ä¸ªå¾ˆç›´æ¥çš„æƒ³æ³•å°±æ˜¯æ‰€æœ‰çš„è¯·æ±‚åº”ç­”èµ„æºéƒ½å…±ç”¨ä¸€ä¸ªTCPè¿æ¥ï¼Œè¿™æ ·å°±çœå»äº†å¾ˆå¤šå»ºç«‹ã€æ–­å¼€TCPè¿æ¥çš„æ—¶é—´ã€‚è€Œåœ¨å®é™…åº”ç”¨ä¸­ï¼Œå°±æ˜¯ä½¿ç”¨**HTTP Keep-Alive**å®ç°è¿™ä¸ªåŠŸèƒ½çš„ï¼Œå¯ä»¥ä½¿ç”¨åŒä¸€ä¸ªTCPè¿æ¥æ¥å‘é€å’Œæ¥æ”¶å¤šä¸ªHTTPè¯·æ±‚/åº”ç­”ï¼Œé¿å…è¿æ¥å»ºç«‹å’Œé‡Šæ”¾çš„å¼€é”€ï¼Œå³**HTTPé•¿è¿æ¥**\n\nHTTPé•¿è¿æ¥çš„ä¸€ä¸ªç‰¹ç‚¹å°±æ˜¯ï¼š**åªè¦ä¸€ç«¯æ²¡æœ‰æ˜ç¡®æ–­å¼€è¿æ¥ï¼Œå°±ä¿æŒTCPè¿æ¥çŠ¶æ€**\n\n### TCP Keepalive\n\nTCP Keepaliveæœºåˆ¶å°±æ˜¯**TCPè¿æ¥çš„ä¿æ´»æœºåˆ¶**ï¼Œå½“è¿æ¥çš„åŒæ–¹å¾ˆé•¿ä¸€æ®µæ—¶é—´æ²¡æœ‰é€šä¿¡ï¼ˆè¿›è¡Œæ•°æ®çš„äº¤äº’ï¼‰ï¼Œè¾¾åˆ°è§¦å‘TCPä¿æ´»æœºåˆ¶çš„æ¡ä»¶ï¼Œé‚£ä¹ˆ**å†…æ ¸**ä¸­çš„TCPåè®®æ ˆå°±ä¼šå‘é€æ¢æµ‹æŠ¥æ–‡\n\n- å¦‚æœå¯¹ç«¯ç¨‹åºæ­£å¸¸è¿è¡Œï¼Œæ¥æ”¶åˆ°æ¢æµ‹æŠ¥æ–‡åä¼šæ­£å¸¸å“åº”ï¼ŒTCPä¿æ´»æ—¶é—´å°†è¢«é‡ç½®\n- å¦‚æœå¯¹ç«¯ä¸»æœºå®•æœºï¼ˆæ³¨æ„**ä¸æ˜¯è¿›ç¨‹å´©æºƒ**ï¼Œå› ä¸ºå½“æ“ä½œç³»ç»Ÿå›æ”¶å´©æºƒçš„è¿›ç¨‹æ—¶ï¼Œä¼šå‘é€FINæŠ¥æ–‡æ¥æ–­å¼€TCPè¿æ¥ã€‚è€Œä¸»æœºå®•æœºåˆ™æ˜¯å¯¹ç«¯ä¸å¯çŸ¥çš„ï¼Œéœ€è¦é€šè¿‡ä¿æ´»æœºåˆ¶æ¥æ¢æµ‹æ˜¯å¦æ˜¯çœŸçš„å®•æœºï¼‰ï¼Œæˆ–å…¶ä»–åŸå› å¯¼è‡´æ¢æµ‹æŠ¥æ–‡æ— æ³•æ­£å¸¸å¾—åˆ°å“åº”ï¼Œé‡å¤å‡ æ¬¡ï¼Œ**è¾¾åˆ°é‡å‘é˜ˆå€¼åï¼Œå°±æŠ¥å‘ŠTCPè¿æ¥æ­»äº¡ï¼Œéœ€è¦æ–­å¼€è¯¥TCPè¿æ¥**\n\n## UDP vs TCP\n\n> å¼„æ¸…æ¥šUDPå’ŒTCPçš„åŒºåˆ«å’Œåº”ç”¨åœºæ™¯ï¼Œè‡³å°‘è¦è®°å¿†3ä¸ªåŒºåˆ«\n\n- è¿æ¥\n  - TCPè¦æ±‚åœ¨å‘é€æ–¹å’Œæ¥æ”¶æ–¹é€šä¿¡ä¹‹å‰å»ºç«‹ä¸€ä¸ªTCPè¿æ¥ï¼Œæ˜¯é¢å‘è¿æ¥çš„åè®®\n  - UDPæ˜¯æ— è¿æ¥åè®®\n- ä¿è¯æ•°æ®ä¼ è¾“çš„é¡ºåº\n  - åœ¨TCPä¸­ï¼Œç”±äºäº‹å…ˆå»ºç«‹äº†ä¸€æ¡è‰¯å¥½çš„è¿æ¥ï¼Œæ¥æ”¶æ–¹å°†é¡ºåºåœ°æ¥æ”¶æ•°æ®åŒ…\n  - è€Œåœ¨UDPä¸­ï¼Œæ¥æ”¶æ–¹ä»¥æ— åºçš„æ–¹å¼æ¥æ”¶æ•°æ®åŒ…\n- å¯é æ€§\n  - æ¯å½“æ¥æ”¶æ–¹é€šè¿‡TCPè¿æ¥æ¥æ”¶åˆ°æ•°æ®åŒ…åï¼Œéƒ½ä¼šå‘å‘é€æ–¹å‘é€ä¸€ä¸ªå“åº”åŒ…ï¼Œæ˜ç¡®ä¸éœ€è¦é‡ä¼ è¿™ä¸ªæ•°æ®åŒ…\n  - UDPæ˜¯å°½åŠ›è€Œä¸ºçš„ï¼Œåªèƒ½ä¾èµ–äºé«˜å±‚åè®®å®ç°å¯é ä¼ è¾“ï¼Œä¾‹å¦‚[QUIC](https://en.wikipedia.org/wiki/QUIC)åè®®\n- é”™è¯¯æ£€æŸ¥\n  - TCPä¸­æœ‰å¹¿æ³›çš„é”™è¯¯æ£€æŸ¥è§„åˆ™ï¼Œ\n  - è€ŒUDPä¸­åªæœ‰åŸºæœ¬çš„æ ¡éªŒå’Œé”™è¯¯æ£€æŸ¥æŠ€æœ¯\n- ä¼ è¾“æ–¹æ³•\n  - åœ¨TCPä¸­ï¼Œæ•°æ®ä»¥å­—èŠ‚æµçš„å½¢å¼ä¼ è¾“\n  - è€Œåœ¨UDPä¸­ï¼Œæ•°æ®æ˜¯ä»¥ä¸€ä¸ªä¸€ä¸ªæ•°æ®åŒ…çš„å½¢å¼å‘é€çš„\n- å¹¿æ’­\n  - TCPä¸æ”¯æŒå¹¿æ’­ï¼Œå› ä¸ºTCPåè®®è¦æ±‚å‘é€æ–¹å’Œæ¥æ”¶æ–¹å»ºç«‹ä¸€æ¡è¿æ¥ï¼Œåœ¨å‘é€åæ–­å¼€è¿æ¥\n  - UDPæ”¯æŒå¹¿æ’­\n- TCPå’ŒUDPå¸¸è§ä½¿ç”¨åœºæ™¯\n  - TCPï¼šHTTPSã€HTTPã€SMTPã€FTP\n  - UDPï¼šDNSã€è§†é¢‘æµã€è§†é¢‘ç”µè¯ã€è¯­éŸ³æœåŠ¡\n","slug":"ä¼ è¾“å±‚çŸ¥è¯†ç‚¹","published":1,"updated":"2024-12-27T11:03:15.344Z","comments":1,"layout":"post","photos":[],"_id":"cm6c7md6i000la5t21dfo2257","content":"<h1 id=\"TCPã€UDP\"><a href=\"#TCPã€UDP\" class=\"headerlink\" title=\"TCPã€UDP\"></a>TCPã€UDP</h1><h2 id=\"TCPç²˜åŒ…æ‹†åŒ…\"><a href=\"#TCPç²˜åŒ…æ‹†åŒ…\" class=\"headerlink\" title=\"TCPç²˜åŒ…æ‹†åŒ…\"></a>TCPç²˜åŒ…æ‹†åŒ…</h2><blockquote>\n<p>ä¸ºä»€ä¹ˆä¼šæœ‰TCPç²˜åŒ…ï¼Ÿåº”ç”¨å±‚æ˜¯å¦‚ä½•è§£å†³TCPç²˜åŒ…çš„é—®é¢˜ï¼Ÿ</p>\n</blockquote>\n<h3 id=\"ä»€ä¹ˆæ˜¯TCPç²˜åŒ…\"><a href=\"#ä»€ä¹ˆæ˜¯TCPç²˜åŒ…\" class=\"headerlink\" title=\"ä»€ä¹ˆæ˜¯TCPç²˜åŒ…\"></a>ä»€ä¹ˆæ˜¯TCPç²˜åŒ…</h3><p>TCPç²˜åŒ…å°±æ˜¯æŒ‡å‘é€æ–¹å‘é€çš„è‹¥å¹²ä¸ªæ•°æ®åŒ…åˆ°è¾¾æ¥æ”¶æ–¹æ—¶ç²˜æˆäº†ä¸€åŒ…ï¼Œä»æ¥å—ç¼“å†²åŒºçœ‹ï¼Œè‹¥å¹²ä¸ªæ•°æ®åŒ…é¦–ä½ç›¸è¿ï¼Œå¥½åƒæ˜¯ç²˜åœ¨äº†ä¸€å—å„¿ã€‚TCPç²˜åŒ…çš„åŸå› å¯èƒ½æ˜¯æ¥è‡ªå‘é€æ–¹ï¼Œä¹Ÿå¯èƒ½æ¥è‡ªæ¥æ”¶æ–¹ã€‚</p>\n<h3 id=\"TCPç²˜åŒ…çš„åŸå› \"><a href=\"#TCPç²˜åŒ…çš„åŸå› \" class=\"headerlink\" title=\"TCPç²˜åŒ…çš„åŸå› \"></a>TCPç²˜åŒ…çš„åŸå› </h3><ol>\n<li>å‘é€æ–¹çš„åŸå› </li>\n</ol>\n<p>TCPé»˜è®¤ä½¿ç”¨<strong>Nagle</strong>ç®—æ³•ï¼ˆç”¨äºå‡è½»ç½‘ç»œè´Ÿæ‹…ï¼Œæé«˜æ•°æ®ä¼ è¾“çš„æ•ˆç‡ï¼‰ï¼Œè€ŒNagleç®—æ³•ä¸»è¦å·¥ä½œæœ‰è¿™ä¹ˆä¸¤ä¸ªï¼š</p>\n<ul>\n<li>åªæœ‰ä¸Šä¸€ä¸ªåˆ†ç»„å¾—åˆ°ç¡®è®¤ï¼Œæ‰ä¼šå‘é€ä¸‹ä¸€ä¸ªåˆ†ç»„çš„æ•°æ®åŒ…</li>\n<li>æ”¶é›†å¤šä¸ªå°åˆ†ç»„ï¼Œç´¯è®¡æ•°æ®é‡ï¼Œåœ¨ä¸€ä¸ªç¡®è®¤åˆ°æ¥åä¸€å—å‘é€</li>\n</ul>\n<p>å‘é€æ–¹ç”±äºä½¿ç”¨äº†<strong>Nagle</strong>ç®—æ³•ï¼Œæ‰ä¼šå¯¼è‡´TCPç²˜åŒ…çš„ç°è±¡</p>\n<ol start=\"2\">\n<li>æ¥æ”¶æ–¹çš„åŸå› </li>\n</ol>\n<p>ä¸€èˆ¬æƒ…å†µä¸‹ï¼Œæ¥æ”¶æ–¹æ”¶åˆ°æ•°æ®åŒ…æ—¶ï¼Œå¹¶ä¸ä¼šç«‹é©¬äº¤ä»˜ç»™åº”ç”¨å±‚è¿›è¡Œå¤„ç†ï¼Œè€Œæ˜¯æ”¾åœ¨<strong>ç¼“å†²çª—å£</strong>ä¸­ï¼Œç„¶ååº”ç”¨ç¨‹åºå†ä»ç¼“å†²çª—å£ä¸­è¯»å–æ”¶åˆ°çš„åˆ†ç»„ã€‚å¦‚æœåº”ç”¨ç¨‹åºçš„è¯»å–é€Ÿåº¦è¿œå°äºæ•°æ®çš„ç¼“å­˜é€Ÿåº¦ï¼Œé‚£ä¹ˆå°±ä¼šæœ‰å¤šä¸ªåŒ…è¢«ç¼“å­˜åœ¨çª—å£ä¸­ï¼Œæ­¤æ—¶åº”ç”¨ç¨‹åºå°±å¯èƒ½ä¼šè¯»å–åˆ°é¦–ä½ç²˜åœ¨ä¸€èµ·çš„æ•°æ®åŒ…</p>\n<h3 id=\"å¦‚ä½•è§£å†³TCPç²˜åŒ…\"><a href=\"#å¦‚ä½•è§£å†³TCPç²˜åŒ…\" class=\"headerlink\" title=\"å¦‚ä½•è§£å†³TCPç²˜åŒ…\"></a>å¦‚ä½•è§£å†³TCPç²˜åŒ…</h3><p>å¯¹äºå‘é€æ–¹ï¼Œå¯ä»¥é€šè¿‡å…³é—­Nagleç®—æ³•æ¥è§£å†³</p>\n<p>å¯¹äºæ¥æ”¶æ–¹ï¼Œåªèƒ½ä¾é åº”ç”¨å±‚æ¥è§£å†³</p>\n<p>å¯¹äºåº”ç”¨ç¨‹åºï¼Œä¸€èˆ¬æœ‰ä¸¤ç§æ–¹æ³•æ¥åŒºåˆ«ä¸€å¤§å¨çš„æ•°æ®åˆ†åˆ«ç”±å“ªä¸ªåˆ†ç»„æ„æˆï¼š</p>\n<ul>\n<li><strong>æ ¼å¼åŒ–æ•°æ®</strong>ï¼šæ¯æ¡æ•°æ®éƒ½æœ‰å›ºå®šçš„æ ¼å¼ï¼Œä¾‹å¦‚å¤§åé¼é¼çš„Redisåœ¨æ•°æ®äº¤äº’æ—¶å°±ç”¨<code>\\n</code>æ¥åŒºåˆ†æ¯ä¸€ä¸ªæ•°æ®åˆ†ç»„</li>\n<li><strong>å‘é€é•¿åº¦</strong>ï¼šå‘é€æ¯æ¡æ•°æ®æ—¶ï¼Œå°†æ•°æ®çš„é•¿åº¦ä¸€å¹¶å‘é€ï¼Œä¾‹å¦‚HTTPåè®®ä¸­çš„<code>Content-Length</code>å­—æ®µ</li>\n</ul>\n<h3 id=\"UDPæœ‰æœ¨æœ‰ç²˜åŒ…é—®é¢˜\"><a href=\"#UDPæœ‰æœ¨æœ‰ç²˜åŒ…é—®é¢˜\" class=\"headerlink\" title=\"UDPæœ‰æœ¨æœ‰ç²˜åŒ…é—®é¢˜\"></a>UDPæœ‰æœ¨æœ‰ç²˜åŒ…é—®é¢˜</h3><p>TCPé‡‡ç”¨äº†<strong>åŸºäºæµçš„ä¼ è¾“</strong>ï¼ŒåŸºäºæµçš„ä¼ è¾“ä¸è®¤ä¸ºæ¶ˆæ¯æ˜¯ä¸€æ¡ä¸€æ¡çš„ï¼Œæ˜¯æ— ä¿æŠ¤æ¶ˆæ¯è¾¹ç•Œçš„</p>\n<p>è€ŒUDPåˆ™æ˜¯<strong>é¢å‘æ¶ˆæ¯ä¼ è¾“</strong>çš„ï¼Œæ˜¯æœ‰ä¿æŠ¤æ¶ˆæ¯è¾¹ç•Œçš„ï¼Œæ¥æ”¶æ–¹åªèƒ½ä¸€æ¬¡åªèƒ½æ¥å—ä¸€æ¡ç‹¬ç«‹çš„æ¶ˆæ¯ï¼Œæ‰€ä»¥<strong>ä¸å­˜åœ¨ç²˜åŒ…é—®é¢˜</strong></p>\n<h2 id=\"TPCå¼‚å¸¸\"><a href=\"#TPCå¼‚å¸¸\" class=\"headerlink\" title=\"TPCå¼‚å¸¸\"></a>TPCå¼‚å¸¸</h2><p>å¦‚æœ<strong>å®¢æˆ·ç«¯è¿›ç¨‹å´©æºƒ</strong>ï¼Œå®¢æˆ·ç«¯çš„è¿›ç¨‹åœ¨å‘ç”Ÿå¥”æºƒæ—¶ï¼Œå†…æ ¸ä¼šå‘é€FINæŠ¥æ–‡ï¼Œä¸æœåŠ¡ç«¯è¿›è¡Œå››æ¬¡æŒ¥æ‰‹</p>\n<p>å¦‚æœ<strong>å®¢æˆ·ç«¯ä¸»æœºå®•æœº</strong>ï¼Œå®¢æˆ·ç«¯ä¸ä¼šå‘é€FINæŠ¥æ–‡ï¼Œåç»­æƒ…å†µéœ€è¦æ ¹æ®æœåŠ¡ç«¯çš„è¡Œä¸ºæ¥åˆ¤æ–­</p>\n<ul>\n<li>å¦‚æœæœåŠ¡ç«¯<strong>ä¼šå‘é€æ•°æ®</strong>ï¼Œç”±äºå®¢æˆ·ç«¯å·²ç»å®•æœºï¼ŒæœåŠ¡ç«¯æ”¶ä¸åˆ°å“åº”æŠ¥æ–‡ï¼Œäºæ˜¯ä¼šè¿›è¡Œè¶…æ—¶é‡ä¼ ï¼Œå½“é‡ä¼ æ€»é—´éš”æ—¶é•¿è¶…è¿‡ä¸€å®šé˜ˆå€¼åï¼Œä¼šæ–­å¼€TCPè¿æ¥</li>\n<li>å¦‚æœæœåŠ¡ç«¯ä¸ä¼šå‘é€æ•°æ®ï¼Œåˆ™éœ€è¦çœ‹çœ‹æœåŠ¡ç«¯<strong>æ˜¯å¦å¼€å¯äº†TCP keepaliveæœºåˆ¶</strong><ul>\n<li>å¦‚æœå¼€å¯äº†TCP keepaliveæœºåˆ¶ï¼ŒæœåŠ¡ç«¯é€šè¿‡å‘é€æ¢æµ‹æŠ¥æ–‡å‘ç°å®¢æˆ·ç«¯å·²ç»æ¶ˆäº¡ï¼Œåˆ™ä¼šæ–­å¼€è‡ªèº«çš„TCPè¿æ¥</li>\n<li>å¦‚æœæ²¡æœ‰å¼€å¯ï¼ŒæœåŠ¡ç«¯çš„TCPè¿æ¥ä¼šä¸€ç›´å­˜åœ¨ï¼Œå¹¶ä¸”ä¿æŒç€ESTABLISHEDçŠ¶æ€</li>\n</ul>\n</li>\n</ul>\n<h2 id=\"HTTP-Keep-Aliveå’ŒTCP-Keepalive\"><a href=\"#HTTP-Keep-Aliveå’ŒTCP-Keepalive\" class=\"headerlink\" title=\"HTTP Keep-Aliveå’ŒTCP Keepalive\"></a>HTTP Keep-Aliveå’ŒTCP Keepalive</h2><h3 id=\"HTTP-Keep-Alive\"><a href=\"#HTTP-Keep-Alive\" class=\"headerlink\" title=\"HTTP Keep-Alive\"></a>HTTP Keep-Alive</h3><p>HTTPåè®®åŸºäºTCPä¼ è¾“åè®®å®ç°ï¼Œé‡‡ç”¨<strong>è¯·æ±‚ã€åº”ç­”</strong>æ¨¡å¼è¿›è¡Œä¿¡æ¯äº¤äº’ã€‚ä¹Ÿå°±æ˜¯è¯´ï¼Œæ¯ä¸€æ¬¡çš„æ•°æ®ä¼ è¾“éƒ½è¦ç»å†è¿™å››ä¸ªè¿‡ç¨‹ï¼šå»ºç«‹TCPè¿æ¥  â€“&gt;  è¯·æ±‚æ•°æ®èµ„æº  â€“&gt;  å“åº”æ•°æ®èµ„æº  â€“&gt;  æ–­å¼€TCPè¿æ¥ï¼ˆå³HTTPçŸ­è¿æ¥ï¼‰</p>\n<p>ä½†ç°å¦‚ä»Šï¼Œä¸€ä¸ªHTMLé¡µé¢å°±å¯èƒ½åŒ…å«äº†ä¸Šç™¾ä¸ªæ•°æ®èµ„æºï¼Œä¹Ÿå°±æ˜¯è¯´è‡³å°‘å¾—å»ºç«‹å‡ ç™¾ä¸ªTCPè¿æ¥æ‰èƒ½æŠŠä¸€ä¸ªç½‘é¡µåŠ è½½å‡ºæ¥ã€‚å¦‚æ­¤æµ®èºçš„æ—¶ä»£ï¼Œå¦‚æ­¤å¤¸å¼ çš„ç½‘ç»œå»¶è¿Ÿï¼Œç”¨æˆ·ä½“éªŒè‚¯å®šå¼‚å¸¸ç³Ÿç³•</p>\n<p>ä¸€ä¸ªå¾ˆç›´æ¥çš„æƒ³æ³•å°±æ˜¯æ‰€æœ‰çš„è¯·æ±‚åº”ç­”èµ„æºéƒ½å…±ç”¨ä¸€ä¸ªTCPè¿æ¥ï¼Œè¿™æ ·å°±çœå»äº†å¾ˆå¤šå»ºç«‹ã€æ–­å¼€TCPè¿æ¥çš„æ—¶é—´ã€‚è€Œåœ¨å®é™…åº”ç”¨ä¸­ï¼Œå°±æ˜¯ä½¿ç”¨<strong>HTTP Keep-Alive</strong>å®ç°è¿™ä¸ªåŠŸèƒ½çš„ï¼Œå¯ä»¥ä½¿ç”¨åŒä¸€ä¸ªTCPè¿æ¥æ¥å‘é€å’Œæ¥æ”¶å¤šä¸ªHTTPè¯·æ±‚&#x2F;åº”ç­”ï¼Œé¿å…è¿æ¥å»ºç«‹å’Œé‡Šæ”¾çš„å¼€é”€ï¼Œå³<strong>HTTPé•¿è¿æ¥</strong></p>\n<p>HTTPé•¿è¿æ¥çš„ä¸€ä¸ªç‰¹ç‚¹å°±æ˜¯ï¼š<strong>åªè¦ä¸€ç«¯æ²¡æœ‰æ˜ç¡®æ–­å¼€è¿æ¥ï¼Œå°±ä¿æŒTCPè¿æ¥çŠ¶æ€</strong></p>\n<h3 id=\"TCP-Keepalive\"><a href=\"#TCP-Keepalive\" class=\"headerlink\" title=\"TCP Keepalive\"></a>TCP Keepalive</h3><p>TCP Keepaliveæœºåˆ¶å°±æ˜¯<strong>TCPè¿æ¥çš„ä¿æ´»æœºåˆ¶</strong>ï¼Œå½“è¿æ¥çš„åŒæ–¹å¾ˆé•¿ä¸€æ®µæ—¶é—´æ²¡æœ‰é€šä¿¡ï¼ˆè¿›è¡Œæ•°æ®çš„äº¤äº’ï¼‰ï¼Œè¾¾åˆ°è§¦å‘TCPä¿æ´»æœºåˆ¶çš„æ¡ä»¶ï¼Œé‚£ä¹ˆ<strong>å†…æ ¸</strong>ä¸­çš„TCPåè®®æ ˆå°±ä¼šå‘é€æ¢æµ‹æŠ¥æ–‡</p>\n<ul>\n<li>å¦‚æœå¯¹ç«¯ç¨‹åºæ­£å¸¸è¿è¡Œï¼Œæ¥æ”¶åˆ°æ¢æµ‹æŠ¥æ–‡åä¼šæ­£å¸¸å“åº”ï¼ŒTCPä¿æ´»æ—¶é—´å°†è¢«é‡ç½®</li>\n<li>å¦‚æœå¯¹ç«¯ä¸»æœºå®•æœºï¼ˆæ³¨æ„<strong>ä¸æ˜¯è¿›ç¨‹å´©æºƒ</strong>ï¼Œå› ä¸ºå½“æ“ä½œç³»ç»Ÿå›æ”¶å´©æºƒçš„è¿›ç¨‹æ—¶ï¼Œä¼šå‘é€FINæŠ¥æ–‡æ¥æ–­å¼€TCPè¿æ¥ã€‚è€Œä¸»æœºå®•æœºåˆ™æ˜¯å¯¹ç«¯ä¸å¯çŸ¥çš„ï¼Œéœ€è¦é€šè¿‡ä¿æ´»æœºåˆ¶æ¥æ¢æµ‹æ˜¯å¦æ˜¯çœŸçš„å®•æœºï¼‰ï¼Œæˆ–å…¶ä»–åŸå› å¯¼è‡´æ¢æµ‹æŠ¥æ–‡æ— æ³•æ­£å¸¸å¾—åˆ°å“åº”ï¼Œé‡å¤å‡ æ¬¡ï¼Œ<strong>è¾¾åˆ°é‡å‘é˜ˆå€¼åï¼Œå°±æŠ¥å‘ŠTCPè¿æ¥æ­»äº¡ï¼Œéœ€è¦æ–­å¼€è¯¥TCPè¿æ¥</strong></li>\n</ul>\n<h2 id=\"UDP-vs-TCP\"><a href=\"#UDP-vs-TCP\" class=\"headerlink\" title=\"UDP vs TCP\"></a>UDP vs TCP</h2><blockquote>\n<p>å¼„æ¸…æ¥šUDPå’ŒTCPçš„åŒºåˆ«å’Œåº”ç”¨åœºæ™¯ï¼Œè‡³å°‘è¦è®°å¿†3ä¸ªåŒºåˆ«</p>\n</blockquote>\n<ul>\n<li>è¿æ¥<ul>\n<li>TCPè¦æ±‚åœ¨å‘é€æ–¹å’Œæ¥æ”¶æ–¹é€šä¿¡ä¹‹å‰å»ºç«‹ä¸€ä¸ªTCPè¿æ¥ï¼Œæ˜¯é¢å‘è¿æ¥çš„åè®®</li>\n<li>UDPæ˜¯æ— è¿æ¥åè®®</li>\n</ul>\n</li>\n<li>ä¿è¯æ•°æ®ä¼ è¾“çš„é¡ºåº<ul>\n<li>åœ¨TCPä¸­ï¼Œç”±äºäº‹å…ˆå»ºç«‹äº†ä¸€æ¡è‰¯å¥½çš„è¿æ¥ï¼Œæ¥æ”¶æ–¹å°†é¡ºåºåœ°æ¥æ”¶æ•°æ®åŒ…</li>\n<li>è€Œåœ¨UDPä¸­ï¼Œæ¥æ”¶æ–¹ä»¥æ— åºçš„æ–¹å¼æ¥æ”¶æ•°æ®åŒ…</li>\n</ul>\n</li>\n<li>å¯é æ€§<ul>\n<li>æ¯å½“æ¥æ”¶æ–¹é€šè¿‡TCPè¿æ¥æ¥æ”¶åˆ°æ•°æ®åŒ…åï¼Œéƒ½ä¼šå‘å‘é€æ–¹å‘é€ä¸€ä¸ªå“åº”åŒ…ï¼Œæ˜ç¡®ä¸éœ€è¦é‡ä¼ è¿™ä¸ªæ•°æ®åŒ…</li>\n<li>UDPæ˜¯å°½åŠ›è€Œä¸ºçš„ï¼Œåªèƒ½ä¾èµ–äºé«˜å±‚åè®®å®ç°å¯é ä¼ è¾“ï¼Œä¾‹å¦‚<a href=\"https://en.wikipedia.org/wiki/QUIC\">QUIC</a>åè®®</li>\n</ul>\n</li>\n<li>é”™è¯¯æ£€æŸ¥<ul>\n<li>TCPä¸­æœ‰å¹¿æ³›çš„é”™è¯¯æ£€æŸ¥è§„åˆ™ï¼Œ</li>\n<li>è€ŒUDPä¸­åªæœ‰åŸºæœ¬çš„æ ¡éªŒå’Œé”™è¯¯æ£€æŸ¥æŠ€æœ¯</li>\n</ul>\n</li>\n<li>ä¼ è¾“æ–¹æ³•<ul>\n<li>åœ¨TCPä¸­ï¼Œæ•°æ®ä»¥å­—èŠ‚æµçš„å½¢å¼ä¼ è¾“</li>\n<li>è€Œåœ¨UDPä¸­ï¼Œæ•°æ®æ˜¯ä»¥ä¸€ä¸ªä¸€ä¸ªæ•°æ®åŒ…çš„å½¢å¼å‘é€çš„</li>\n</ul>\n</li>\n<li>å¹¿æ’­<ul>\n<li>TCPä¸æ”¯æŒå¹¿æ’­ï¼Œå› ä¸ºTCPåè®®è¦æ±‚å‘é€æ–¹å’Œæ¥æ”¶æ–¹å»ºç«‹ä¸€æ¡è¿æ¥ï¼Œåœ¨å‘é€åæ–­å¼€è¿æ¥</li>\n<li>UDPæ”¯æŒå¹¿æ’­</li>\n</ul>\n</li>\n<li>TCPå’ŒUDPå¸¸è§ä½¿ç”¨åœºæ™¯<ul>\n<li>TCPï¼šHTTPSã€HTTPã€SMTPã€FTP</li>\n<li>UDPï¼šDNSã€è§†é¢‘æµã€è§†é¢‘ç”µè¯ã€è¯­éŸ³æœåŠ¡</li>\n</ul>\n</li>\n</ul>\n","excerpt":"","more":"<h1 id=\"TCPã€UDP\"><a href=\"#TCPã€UDP\" class=\"headerlink\" title=\"TCPã€UDP\"></a>TCPã€UDP</h1><h2 id=\"TCPç²˜åŒ…æ‹†åŒ…\"><a href=\"#TCPç²˜åŒ…æ‹†åŒ…\" class=\"headerlink\" title=\"TCPç²˜åŒ…æ‹†åŒ…\"></a>TCPç²˜åŒ…æ‹†åŒ…</h2><blockquote>\n<p>ä¸ºä»€ä¹ˆä¼šæœ‰TCPç²˜åŒ…ï¼Ÿåº”ç”¨å±‚æ˜¯å¦‚ä½•è§£å†³TCPç²˜åŒ…çš„é—®é¢˜ï¼Ÿ</p>\n</blockquote>\n<h3 id=\"ä»€ä¹ˆæ˜¯TCPç²˜åŒ…\"><a href=\"#ä»€ä¹ˆæ˜¯TCPç²˜åŒ…\" class=\"headerlink\" title=\"ä»€ä¹ˆæ˜¯TCPç²˜åŒ…\"></a>ä»€ä¹ˆæ˜¯TCPç²˜åŒ…</h3><p>TCPç²˜åŒ…å°±æ˜¯æŒ‡å‘é€æ–¹å‘é€çš„è‹¥å¹²ä¸ªæ•°æ®åŒ…åˆ°è¾¾æ¥æ”¶æ–¹æ—¶ç²˜æˆäº†ä¸€åŒ…ï¼Œä»æ¥å—ç¼“å†²åŒºçœ‹ï¼Œè‹¥å¹²ä¸ªæ•°æ®åŒ…é¦–ä½ç›¸è¿ï¼Œå¥½åƒæ˜¯ç²˜åœ¨äº†ä¸€å—å„¿ã€‚TCPç²˜åŒ…çš„åŸå› å¯èƒ½æ˜¯æ¥è‡ªå‘é€æ–¹ï¼Œä¹Ÿå¯èƒ½æ¥è‡ªæ¥æ”¶æ–¹ã€‚</p>\n<h3 id=\"TCPç²˜åŒ…çš„åŸå› \"><a href=\"#TCPç²˜åŒ…çš„åŸå› \" class=\"headerlink\" title=\"TCPç²˜åŒ…çš„åŸå› \"></a>TCPç²˜åŒ…çš„åŸå› </h3><ol>\n<li>å‘é€æ–¹çš„åŸå› </li>\n</ol>\n<p>TCPé»˜è®¤ä½¿ç”¨<strong>Nagle</strong>ç®—æ³•ï¼ˆç”¨äºå‡è½»ç½‘ç»œè´Ÿæ‹…ï¼Œæé«˜æ•°æ®ä¼ è¾“çš„æ•ˆç‡ï¼‰ï¼Œè€ŒNagleç®—æ³•ä¸»è¦å·¥ä½œæœ‰è¿™ä¹ˆä¸¤ä¸ªï¼š</p>\n<ul>\n<li>åªæœ‰ä¸Šä¸€ä¸ªåˆ†ç»„å¾—åˆ°ç¡®è®¤ï¼Œæ‰ä¼šå‘é€ä¸‹ä¸€ä¸ªåˆ†ç»„çš„æ•°æ®åŒ…</li>\n<li>æ”¶é›†å¤šä¸ªå°åˆ†ç»„ï¼Œç´¯è®¡æ•°æ®é‡ï¼Œåœ¨ä¸€ä¸ªç¡®è®¤åˆ°æ¥åä¸€å—å‘é€</li>\n</ul>\n<p>å‘é€æ–¹ç”±äºä½¿ç”¨äº†<strong>Nagle</strong>ç®—æ³•ï¼Œæ‰ä¼šå¯¼è‡´TCPç²˜åŒ…çš„ç°è±¡</p>\n<ol start=\"2\">\n<li>æ¥æ”¶æ–¹çš„åŸå› </li>\n</ol>\n<p>ä¸€èˆ¬æƒ…å†µä¸‹ï¼Œæ¥æ”¶æ–¹æ”¶åˆ°æ•°æ®åŒ…æ—¶ï¼Œå¹¶ä¸ä¼šç«‹é©¬äº¤ä»˜ç»™åº”ç”¨å±‚è¿›è¡Œå¤„ç†ï¼Œè€Œæ˜¯æ”¾åœ¨<strong>ç¼“å†²çª—å£</strong>ä¸­ï¼Œç„¶ååº”ç”¨ç¨‹åºå†ä»ç¼“å†²çª—å£ä¸­è¯»å–æ”¶åˆ°çš„åˆ†ç»„ã€‚å¦‚æœåº”ç”¨ç¨‹åºçš„è¯»å–é€Ÿåº¦è¿œå°äºæ•°æ®çš„ç¼“å­˜é€Ÿåº¦ï¼Œé‚£ä¹ˆå°±ä¼šæœ‰å¤šä¸ªåŒ…è¢«ç¼“å­˜åœ¨çª—å£ä¸­ï¼Œæ­¤æ—¶åº”ç”¨ç¨‹åºå°±å¯èƒ½ä¼šè¯»å–åˆ°é¦–ä½ç²˜åœ¨ä¸€èµ·çš„æ•°æ®åŒ…</p>\n<h3 id=\"å¦‚ä½•è§£å†³TCPç²˜åŒ…\"><a href=\"#å¦‚ä½•è§£å†³TCPç²˜åŒ…\" class=\"headerlink\" title=\"å¦‚ä½•è§£å†³TCPç²˜åŒ…\"></a>å¦‚ä½•è§£å†³TCPç²˜åŒ…</h3><p>å¯¹äºå‘é€æ–¹ï¼Œå¯ä»¥é€šè¿‡å…³é—­Nagleç®—æ³•æ¥è§£å†³</p>\n<p>å¯¹äºæ¥æ”¶æ–¹ï¼Œåªèƒ½ä¾é åº”ç”¨å±‚æ¥è§£å†³</p>\n<p>å¯¹äºåº”ç”¨ç¨‹åºï¼Œä¸€èˆ¬æœ‰ä¸¤ç§æ–¹æ³•æ¥åŒºåˆ«ä¸€å¤§å¨çš„æ•°æ®åˆ†åˆ«ç”±å“ªä¸ªåˆ†ç»„æ„æˆï¼š</p>\n<ul>\n<li><strong>æ ¼å¼åŒ–æ•°æ®</strong>ï¼šæ¯æ¡æ•°æ®éƒ½æœ‰å›ºå®šçš„æ ¼å¼ï¼Œä¾‹å¦‚å¤§åé¼é¼çš„Redisåœ¨æ•°æ®äº¤äº’æ—¶å°±ç”¨<code>\\n</code>æ¥åŒºåˆ†æ¯ä¸€ä¸ªæ•°æ®åˆ†ç»„</li>\n<li><strong>å‘é€é•¿åº¦</strong>ï¼šå‘é€æ¯æ¡æ•°æ®æ—¶ï¼Œå°†æ•°æ®çš„é•¿åº¦ä¸€å¹¶å‘é€ï¼Œä¾‹å¦‚HTTPåè®®ä¸­çš„<code>Content-Length</code>å­—æ®µ</li>\n</ul>\n<h3 id=\"UDPæœ‰æœ¨æœ‰ç²˜åŒ…é—®é¢˜\"><a href=\"#UDPæœ‰æœ¨æœ‰ç²˜åŒ…é—®é¢˜\" class=\"headerlink\" title=\"UDPæœ‰æœ¨æœ‰ç²˜åŒ…é—®é¢˜\"></a>UDPæœ‰æœ¨æœ‰ç²˜åŒ…é—®é¢˜</h3><p>TCPé‡‡ç”¨äº†<strong>åŸºäºæµçš„ä¼ è¾“</strong>ï¼ŒåŸºäºæµçš„ä¼ è¾“ä¸è®¤ä¸ºæ¶ˆæ¯æ˜¯ä¸€æ¡ä¸€æ¡çš„ï¼Œæ˜¯æ— ä¿æŠ¤æ¶ˆæ¯è¾¹ç•Œçš„</p>\n<p>è€ŒUDPåˆ™æ˜¯<strong>é¢å‘æ¶ˆæ¯ä¼ è¾“</strong>çš„ï¼Œæ˜¯æœ‰ä¿æŠ¤æ¶ˆæ¯è¾¹ç•Œçš„ï¼Œæ¥æ”¶æ–¹åªèƒ½ä¸€æ¬¡åªèƒ½æ¥å—ä¸€æ¡ç‹¬ç«‹çš„æ¶ˆæ¯ï¼Œæ‰€ä»¥<strong>ä¸å­˜åœ¨ç²˜åŒ…é—®é¢˜</strong></p>\n<h2 id=\"TPCå¼‚å¸¸\"><a href=\"#TPCå¼‚å¸¸\" class=\"headerlink\" title=\"TPCå¼‚å¸¸\"></a>TPCå¼‚å¸¸</h2><p>å¦‚æœ<strong>å®¢æˆ·ç«¯è¿›ç¨‹å´©æºƒ</strong>ï¼Œå®¢æˆ·ç«¯çš„è¿›ç¨‹åœ¨å‘ç”Ÿå¥”æºƒæ—¶ï¼Œå†…æ ¸ä¼šå‘é€FINæŠ¥æ–‡ï¼Œä¸æœåŠ¡ç«¯è¿›è¡Œå››æ¬¡æŒ¥æ‰‹</p>\n<p>å¦‚æœ<strong>å®¢æˆ·ç«¯ä¸»æœºå®•æœº</strong>ï¼Œå®¢æˆ·ç«¯ä¸ä¼šå‘é€FINæŠ¥æ–‡ï¼Œåç»­æƒ…å†µéœ€è¦æ ¹æ®æœåŠ¡ç«¯çš„è¡Œä¸ºæ¥åˆ¤æ–­</p>\n<ul>\n<li>å¦‚æœæœåŠ¡ç«¯<strong>ä¼šå‘é€æ•°æ®</strong>ï¼Œç”±äºå®¢æˆ·ç«¯å·²ç»å®•æœºï¼ŒæœåŠ¡ç«¯æ”¶ä¸åˆ°å“åº”æŠ¥æ–‡ï¼Œäºæ˜¯ä¼šè¿›è¡Œè¶…æ—¶é‡ä¼ ï¼Œå½“é‡ä¼ æ€»é—´éš”æ—¶é•¿è¶…è¿‡ä¸€å®šé˜ˆå€¼åï¼Œä¼šæ–­å¼€TCPè¿æ¥</li>\n<li>å¦‚æœæœåŠ¡ç«¯ä¸ä¼šå‘é€æ•°æ®ï¼Œåˆ™éœ€è¦çœ‹çœ‹æœåŠ¡ç«¯<strong>æ˜¯å¦å¼€å¯äº†TCP keepaliveæœºåˆ¶</strong><ul>\n<li>å¦‚æœå¼€å¯äº†TCP keepaliveæœºåˆ¶ï¼ŒæœåŠ¡ç«¯é€šè¿‡å‘é€æ¢æµ‹æŠ¥æ–‡å‘ç°å®¢æˆ·ç«¯å·²ç»æ¶ˆäº¡ï¼Œåˆ™ä¼šæ–­å¼€è‡ªèº«çš„TCPè¿æ¥</li>\n<li>å¦‚æœæ²¡æœ‰å¼€å¯ï¼ŒæœåŠ¡ç«¯çš„TCPè¿æ¥ä¼šä¸€ç›´å­˜åœ¨ï¼Œå¹¶ä¸”ä¿æŒç€ESTABLISHEDçŠ¶æ€</li>\n</ul>\n</li>\n</ul>\n<h2 id=\"HTTP-Keep-Aliveå’ŒTCP-Keepalive\"><a href=\"#HTTP-Keep-Aliveå’ŒTCP-Keepalive\" class=\"headerlink\" title=\"HTTP Keep-Aliveå’ŒTCP Keepalive\"></a>HTTP Keep-Aliveå’ŒTCP Keepalive</h2><h3 id=\"HTTP-Keep-Alive\"><a href=\"#HTTP-Keep-Alive\" class=\"headerlink\" title=\"HTTP Keep-Alive\"></a>HTTP Keep-Alive</h3><p>HTTPåè®®åŸºäºTCPä¼ è¾“åè®®å®ç°ï¼Œé‡‡ç”¨<strong>è¯·æ±‚ã€åº”ç­”</strong>æ¨¡å¼è¿›è¡Œä¿¡æ¯äº¤äº’ã€‚ä¹Ÿå°±æ˜¯è¯´ï¼Œæ¯ä¸€æ¬¡çš„æ•°æ®ä¼ è¾“éƒ½è¦ç»å†è¿™å››ä¸ªè¿‡ç¨‹ï¼šå»ºç«‹TCPè¿æ¥  â€“&gt;  è¯·æ±‚æ•°æ®èµ„æº  â€“&gt;  å“åº”æ•°æ®èµ„æº  â€“&gt;  æ–­å¼€TCPè¿æ¥ï¼ˆå³HTTPçŸ­è¿æ¥ï¼‰</p>\n<p>ä½†ç°å¦‚ä»Šï¼Œä¸€ä¸ªHTMLé¡µé¢å°±å¯èƒ½åŒ…å«äº†ä¸Šç™¾ä¸ªæ•°æ®èµ„æºï¼Œä¹Ÿå°±æ˜¯è¯´è‡³å°‘å¾—å»ºç«‹å‡ ç™¾ä¸ªTCPè¿æ¥æ‰èƒ½æŠŠä¸€ä¸ªç½‘é¡µåŠ è½½å‡ºæ¥ã€‚å¦‚æ­¤æµ®èºçš„æ—¶ä»£ï¼Œå¦‚æ­¤å¤¸å¼ çš„ç½‘ç»œå»¶è¿Ÿï¼Œç”¨æˆ·ä½“éªŒè‚¯å®šå¼‚å¸¸ç³Ÿç³•</p>\n<p>ä¸€ä¸ªå¾ˆç›´æ¥çš„æƒ³æ³•å°±æ˜¯æ‰€æœ‰çš„è¯·æ±‚åº”ç­”èµ„æºéƒ½å…±ç”¨ä¸€ä¸ªTCPè¿æ¥ï¼Œè¿™æ ·å°±çœå»äº†å¾ˆå¤šå»ºç«‹ã€æ–­å¼€TCPè¿æ¥çš„æ—¶é—´ã€‚è€Œåœ¨å®é™…åº”ç”¨ä¸­ï¼Œå°±æ˜¯ä½¿ç”¨<strong>HTTP Keep-Alive</strong>å®ç°è¿™ä¸ªåŠŸèƒ½çš„ï¼Œå¯ä»¥ä½¿ç”¨åŒä¸€ä¸ªTCPè¿æ¥æ¥å‘é€å’Œæ¥æ”¶å¤šä¸ªHTTPè¯·æ±‚&#x2F;åº”ç­”ï¼Œé¿å…è¿æ¥å»ºç«‹å’Œé‡Šæ”¾çš„å¼€é”€ï¼Œå³<strong>HTTPé•¿è¿æ¥</strong></p>\n<p>HTTPé•¿è¿æ¥çš„ä¸€ä¸ªç‰¹ç‚¹å°±æ˜¯ï¼š<strong>åªè¦ä¸€ç«¯æ²¡æœ‰æ˜ç¡®æ–­å¼€è¿æ¥ï¼Œå°±ä¿æŒTCPè¿æ¥çŠ¶æ€</strong></p>\n<h3 id=\"TCP-Keepalive\"><a href=\"#TCP-Keepalive\" class=\"headerlink\" title=\"TCP Keepalive\"></a>TCP Keepalive</h3><p>TCP Keepaliveæœºåˆ¶å°±æ˜¯<strong>TCPè¿æ¥çš„ä¿æ´»æœºåˆ¶</strong>ï¼Œå½“è¿æ¥çš„åŒæ–¹å¾ˆé•¿ä¸€æ®µæ—¶é—´æ²¡æœ‰é€šä¿¡ï¼ˆè¿›è¡Œæ•°æ®çš„äº¤äº’ï¼‰ï¼Œè¾¾åˆ°è§¦å‘TCPä¿æ´»æœºåˆ¶çš„æ¡ä»¶ï¼Œé‚£ä¹ˆ<strong>å†…æ ¸</strong>ä¸­çš„TCPåè®®æ ˆå°±ä¼šå‘é€æ¢æµ‹æŠ¥æ–‡</p>\n<ul>\n<li>å¦‚æœå¯¹ç«¯ç¨‹åºæ­£å¸¸è¿è¡Œï¼Œæ¥æ”¶åˆ°æ¢æµ‹æŠ¥æ–‡åä¼šæ­£å¸¸å“åº”ï¼ŒTCPä¿æ´»æ—¶é—´å°†è¢«é‡ç½®</li>\n<li>å¦‚æœå¯¹ç«¯ä¸»æœºå®•æœºï¼ˆæ³¨æ„<strong>ä¸æ˜¯è¿›ç¨‹å´©æºƒ</strong>ï¼Œå› ä¸ºå½“æ“ä½œç³»ç»Ÿå›æ”¶å´©æºƒçš„è¿›ç¨‹æ—¶ï¼Œä¼šå‘é€FINæŠ¥æ–‡æ¥æ–­å¼€TCPè¿æ¥ã€‚è€Œä¸»æœºå®•æœºåˆ™æ˜¯å¯¹ç«¯ä¸å¯çŸ¥çš„ï¼Œéœ€è¦é€šè¿‡ä¿æ´»æœºåˆ¶æ¥æ¢æµ‹æ˜¯å¦æ˜¯çœŸçš„å®•æœºï¼‰ï¼Œæˆ–å…¶ä»–åŸå› å¯¼è‡´æ¢æµ‹æŠ¥æ–‡æ— æ³•æ­£å¸¸å¾—åˆ°å“åº”ï¼Œé‡å¤å‡ æ¬¡ï¼Œ<strong>è¾¾åˆ°é‡å‘é˜ˆå€¼åï¼Œå°±æŠ¥å‘ŠTCPè¿æ¥æ­»äº¡ï¼Œéœ€è¦æ–­å¼€è¯¥TCPè¿æ¥</strong></li>\n</ul>\n<h2 id=\"UDP-vs-TCP\"><a href=\"#UDP-vs-TCP\" class=\"headerlink\" title=\"UDP vs TCP\"></a>UDP vs TCP</h2><blockquote>\n<p>å¼„æ¸…æ¥šUDPå’ŒTCPçš„åŒºåˆ«å’Œåº”ç”¨åœºæ™¯ï¼Œè‡³å°‘è¦è®°å¿†3ä¸ªåŒºåˆ«</p>\n</blockquote>\n<ul>\n<li>è¿æ¥<ul>\n<li>TCPè¦æ±‚åœ¨å‘é€æ–¹å’Œæ¥æ”¶æ–¹é€šä¿¡ä¹‹å‰å»ºç«‹ä¸€ä¸ªTCPè¿æ¥ï¼Œæ˜¯é¢å‘è¿æ¥çš„åè®®</li>\n<li>UDPæ˜¯æ— è¿æ¥åè®®</li>\n</ul>\n</li>\n<li>ä¿è¯æ•°æ®ä¼ è¾“çš„é¡ºåº<ul>\n<li>åœ¨TCPä¸­ï¼Œç”±äºäº‹å…ˆå»ºç«‹äº†ä¸€æ¡è‰¯å¥½çš„è¿æ¥ï¼Œæ¥æ”¶æ–¹å°†é¡ºåºåœ°æ¥æ”¶æ•°æ®åŒ…</li>\n<li>è€Œåœ¨UDPä¸­ï¼Œæ¥æ”¶æ–¹ä»¥æ— åºçš„æ–¹å¼æ¥æ”¶æ•°æ®åŒ…</li>\n</ul>\n</li>\n<li>å¯é æ€§<ul>\n<li>æ¯å½“æ¥æ”¶æ–¹é€šè¿‡TCPè¿æ¥æ¥æ”¶åˆ°æ•°æ®åŒ…åï¼Œéƒ½ä¼šå‘å‘é€æ–¹å‘é€ä¸€ä¸ªå“åº”åŒ…ï¼Œæ˜ç¡®ä¸éœ€è¦é‡ä¼ è¿™ä¸ªæ•°æ®åŒ…</li>\n<li>UDPæ˜¯å°½åŠ›è€Œä¸ºçš„ï¼Œåªèƒ½ä¾èµ–äºé«˜å±‚åè®®å®ç°å¯é ä¼ è¾“ï¼Œä¾‹å¦‚<a href=\"https://en.wikipedia.org/wiki/QUIC\">QUIC</a>åè®®</li>\n</ul>\n</li>\n<li>é”™è¯¯æ£€æŸ¥<ul>\n<li>TCPä¸­æœ‰å¹¿æ³›çš„é”™è¯¯æ£€æŸ¥è§„åˆ™ï¼Œ</li>\n<li>è€ŒUDPä¸­åªæœ‰åŸºæœ¬çš„æ ¡éªŒå’Œé”™è¯¯æ£€æŸ¥æŠ€æœ¯</li>\n</ul>\n</li>\n<li>ä¼ è¾“æ–¹æ³•<ul>\n<li>åœ¨TCPä¸­ï¼Œæ•°æ®ä»¥å­—èŠ‚æµçš„å½¢å¼ä¼ è¾“</li>\n<li>è€Œåœ¨UDPä¸­ï¼Œæ•°æ®æ˜¯ä»¥ä¸€ä¸ªä¸€ä¸ªæ•°æ®åŒ…çš„å½¢å¼å‘é€çš„</li>\n</ul>\n</li>\n<li>å¹¿æ’­<ul>\n<li>TCPä¸æ”¯æŒå¹¿æ’­ï¼Œå› ä¸ºTCPåè®®è¦æ±‚å‘é€æ–¹å’Œæ¥æ”¶æ–¹å»ºç«‹ä¸€æ¡è¿æ¥ï¼Œåœ¨å‘é€åæ–­å¼€è¿æ¥</li>\n<li>UDPæ”¯æŒå¹¿æ’­</li>\n</ul>\n</li>\n<li>TCPå’ŒUDPå¸¸è§ä½¿ç”¨åœºæ™¯<ul>\n<li>TCPï¼šHTTPSã€HTTPã€SMTPã€FTP</li>\n<li>UDPï¼šDNSã€è§†é¢‘æµã€è§†é¢‘ç”µè¯ã€è¯­éŸ³æœåŠ¡</li>\n</ul>\n</li>\n</ul>\n"},{"title":"ä¼˜è´¨èµ„æºåˆé›†","publish":true,"description":"æ”¶è—ä¸€äº›ä¼˜è´¨èµ„æº","_content":"\n# ä¼˜è´¨èµ„æºåˆé›†\n\n## 2024-12-01\n- [Questionnaires tool](https://github.com/didi/xiaoju-survey)\n\n## 2024-11-17\n\n- [æ‘¸é±¼èƒŒå•è¯](https://github.com/Uahh/ToastFish)\n- [ç®—æ³•æ•™ç¨‹](https://github.com/krahets/hello-algo)\n\n## 2024-11-09\n\n- [å¦‚ä½•æ´»å¾—æ›´ä¹…ğŸ¤ª](https://github.com/geekan/HowToLiveLonger)\n\n## 2024-10-19\n\n- [åŸºäºgoogleäºŒæ¬¡å¼€å‘çš„æœç´¢å¼•æ“](https://github.com/KoriIku/luxirty-search)\n- [åæ˜ CPUå ç”¨ç‡çš„å¥”è·‘å°çŒ«](https://github.com/Kyome22/RunCat_for_windows)\n- [è§†é¢‘å›¾ç‰‡è¶…åˆ†å·¥å…·](https://github.com/k4yt3x/video2x)\n\n## 2024-10-12\n\n- [CS-Books](https://github.com/forthespada/CS-Books)\n  - è¶…è¿‡1000æœ¬çš„è®¡ç®—æœºç»å…¸ä¹¦ç±åˆ†äº«\n- [WizTree]([WizTree - The Fastest Disk Space Analyzer (diskanalyzer.com)](https://diskanalyzer.com/))\n  - ä»¥æ ‘çŠ¶å›¾çš„å½¢å¼åˆ†æWindowsç”µè„‘ç¡¬ç›˜çš„å ç”¨æƒ…å†µ\n- [Lemon](https://lemon.qq.com/)\n  - é€‚ç”¨äºMacç”µè„‘çš„ç¡¬ç›˜å ç”¨åˆ†æå·¥å…·\n\n## æ›´ä¹…ä¹‹å‰\n\n- [è½»é‡çº§çš„AIè¯ä»¶ç…§åˆ¶ä½œ](https://github.com/Zeyi-Lin/HivisionIDPhotos)\n  - HivisionIDPhoto æ—¨åœ¨å¼€å‘ä¸€ç§å®ç”¨ã€ç³»ç»Ÿæ€§çš„è¯ä»¶ç…§æ™ºèƒ½åˆ¶ä½œç®—æ³•ã€‚ å®ƒåˆ©ç”¨ä¸€å¥—å®Œå–„çš„AIæ¨¡å‹å·¥ä½œæµç¨‹ï¼Œå®ç°å¯¹å¤šç§ç”¨æˆ·æ‹ç…§åœºæ™¯çš„è¯†åˆ«ã€æŠ å›¾ä¸è¯ä»¶ç…§ç”Ÿæˆã€‚\n- [OCR](https://github.com/hiroi-sora/Umi-OCR)\n  - å…è´¹ï¼Œå¼€æºï¼Œå¯æ‰¹é‡çš„ç¦»çº¿OCRè½¯ä»¶\n- [å›¾ç‰‡é«˜æ¸…å·¥å…·](https://github.com/upscayl/upscayl)\n  - Upscayl lets you enlarge and enhance low-resolution images using advanced AI algorithms. Enlarge images without losing quality. It's almost like magic!\n\n- [cozy-reader](https://github.com/srsng/cozy-reader)\n  - å¼€æºçš„ Epub ç”µå­ä¹¦çš„æ¡Œé¢é˜…è¯»è½¯ä»¶ï¼Œè·¨å¹³å°\n\n- [PULSE](https://github.com/adamian98/pulse)\n  - é€šè¿‡è¿­ä»£æ¯”è¾ƒè¾“å‡ºå’Œè¾“å…¥å›¾ç‰‡ï¼Œå»é™¤é©¬èµ›å…‹\n\n- [The Most Dangerous Writing App](https://github.com/maebert/themostdangerouswritingapp?tab=readme-ov-file)\n  - æœ€å±é™©çš„å†™ä½œå·¥å…·ï¼Œåªè¦åœæ­¢å†™ä½œè¶…è¿‡è‹¥å¹²ç§’ï¼Œä½ çš„æ–‡ç« å°±æ²¡æœ‰å•¦ğŸ˜‚\n  - å¼ºè¿«è‡ªå·±æé«˜äº§å‡ºæ•ˆç‡ğŸ« \n\n- [gkd](https://github.com/gkd-kit/gkd)\n  - åŸºäº **æ— éšœç¢** + **é«˜çº§é€‰æ‹©å™¨** + **è®¢é˜…è§„åˆ™** çš„è‡ªå®šä¹‰å±å¹•ç‚¹å‡» APPğŸ¤ª\n\n- [lux](https://github.com/iawia002/lux)\n  - å¿«é€Ÿç®€å•çš„**è§†é¢‘ä¸‹è½½å·¥å…·**\n\n- [æ‘¸é±¼è½¯ä»¶ğŸ˜](https://github.com/DinoChan/Loaf)\n\n- [ç½‘ç›˜æœç´¢å¼•æ“](https://www.pansou.vip/)\n\n- [å…¨å¹³å°é€šç”¨æ¢æºå·¥å…·ä¸æ¡†æ¶](https://github.com/RubyMetric/chsrc)\n\n- [ä¿®æ”¹å™¨ä¸‹è½½å·¥å…·](https://github.com/dyang886/Game-Cheats-Manager)\n  - ä¿®æ”¹å™¨çœŸå¿«ä¹ğŸ˜\n\n- [TypeScripté¢˜åº“](https://typeroom.cn/problems/all)\n  - TypeScript é¢˜åº“ [Type Challenge](https://github.com/type-challenges/type-challenges) çš„ç½‘é¡µç‰ˆã€‚\n\n- [å¼€æºè®¸å¯è¯é€‰æ‹©å™¨](https://open-source-license-chooser.toolsnav.top/en/)\n  - å›ç­”å‡ ä¸ªé—®é¢˜ï¼Œå¸®ä½ é€‰æ‹©ä¸€ä¸ªå¼€æºè®¸å¯è¯","source":"_posts/ä¼˜è´¨å¼€æºè½¯ä»¶åˆé›†.md","raw":"---\ntitle: ä¼˜è´¨èµ„æºåˆé›†\npublish: true\ndescription: æ”¶è—ä¸€äº›ä¼˜è´¨èµ„æº\ntag: \n- å¼€æºå·¥å…·\n- èµ„æº\n---\n\n# ä¼˜è´¨èµ„æºåˆé›†\n\n## 2024-12-01\n- [Questionnaires tool](https://github.com/didi/xiaoju-survey)\n\n## 2024-11-17\n\n- [æ‘¸é±¼èƒŒå•è¯](https://github.com/Uahh/ToastFish)\n- [ç®—æ³•æ•™ç¨‹](https://github.com/krahets/hello-algo)\n\n## 2024-11-09\n\n- [å¦‚ä½•æ´»å¾—æ›´ä¹…ğŸ¤ª](https://github.com/geekan/HowToLiveLonger)\n\n## 2024-10-19\n\n- [åŸºäºgoogleäºŒæ¬¡å¼€å‘çš„æœç´¢å¼•æ“](https://github.com/KoriIku/luxirty-search)\n- [åæ˜ CPUå ç”¨ç‡çš„å¥”è·‘å°çŒ«](https://github.com/Kyome22/RunCat_for_windows)\n- [è§†é¢‘å›¾ç‰‡è¶…åˆ†å·¥å…·](https://github.com/k4yt3x/video2x)\n\n## 2024-10-12\n\n- [CS-Books](https://github.com/forthespada/CS-Books)\n  - è¶…è¿‡1000æœ¬çš„è®¡ç®—æœºç»å…¸ä¹¦ç±åˆ†äº«\n- [WizTree]([WizTree - The Fastest Disk Space Analyzer (diskanalyzer.com)](https://diskanalyzer.com/))\n  - ä»¥æ ‘çŠ¶å›¾çš„å½¢å¼åˆ†æWindowsç”µè„‘ç¡¬ç›˜çš„å ç”¨æƒ…å†µ\n- [Lemon](https://lemon.qq.com/)\n  - é€‚ç”¨äºMacç”µè„‘çš„ç¡¬ç›˜å ç”¨åˆ†æå·¥å…·\n\n## æ›´ä¹…ä¹‹å‰\n\n- [è½»é‡çº§çš„AIè¯ä»¶ç…§åˆ¶ä½œ](https://github.com/Zeyi-Lin/HivisionIDPhotos)\n  - HivisionIDPhoto æ—¨åœ¨å¼€å‘ä¸€ç§å®ç”¨ã€ç³»ç»Ÿæ€§çš„è¯ä»¶ç…§æ™ºèƒ½åˆ¶ä½œç®—æ³•ã€‚ å®ƒåˆ©ç”¨ä¸€å¥—å®Œå–„çš„AIæ¨¡å‹å·¥ä½œæµç¨‹ï¼Œå®ç°å¯¹å¤šç§ç”¨æˆ·æ‹ç…§åœºæ™¯çš„è¯†åˆ«ã€æŠ å›¾ä¸è¯ä»¶ç…§ç”Ÿæˆã€‚\n- [OCR](https://github.com/hiroi-sora/Umi-OCR)\n  - å…è´¹ï¼Œå¼€æºï¼Œå¯æ‰¹é‡çš„ç¦»çº¿OCRè½¯ä»¶\n- [å›¾ç‰‡é«˜æ¸…å·¥å…·](https://github.com/upscayl/upscayl)\n  - Upscayl lets you enlarge and enhance low-resolution images using advanced AI algorithms. Enlarge images without losing quality. It's almost like magic!\n\n- [cozy-reader](https://github.com/srsng/cozy-reader)\n  - å¼€æºçš„ Epub ç”µå­ä¹¦çš„æ¡Œé¢é˜…è¯»è½¯ä»¶ï¼Œè·¨å¹³å°\n\n- [PULSE](https://github.com/adamian98/pulse)\n  - é€šè¿‡è¿­ä»£æ¯”è¾ƒè¾“å‡ºå’Œè¾“å…¥å›¾ç‰‡ï¼Œå»é™¤é©¬èµ›å…‹\n\n- [The Most Dangerous Writing App](https://github.com/maebert/themostdangerouswritingapp?tab=readme-ov-file)\n  - æœ€å±é™©çš„å†™ä½œå·¥å…·ï¼Œåªè¦åœæ­¢å†™ä½œè¶…è¿‡è‹¥å¹²ç§’ï¼Œä½ çš„æ–‡ç« å°±æ²¡æœ‰å•¦ğŸ˜‚\n  - å¼ºè¿«è‡ªå·±æé«˜äº§å‡ºæ•ˆç‡ğŸ« \n\n- [gkd](https://github.com/gkd-kit/gkd)\n  - åŸºäº **æ— éšœç¢** + **é«˜çº§é€‰æ‹©å™¨** + **è®¢é˜…è§„åˆ™** çš„è‡ªå®šä¹‰å±å¹•ç‚¹å‡» APPğŸ¤ª\n\n- [lux](https://github.com/iawia002/lux)\n  - å¿«é€Ÿç®€å•çš„**è§†é¢‘ä¸‹è½½å·¥å…·**\n\n- [æ‘¸é±¼è½¯ä»¶ğŸ˜](https://github.com/DinoChan/Loaf)\n\n- [ç½‘ç›˜æœç´¢å¼•æ“](https://www.pansou.vip/)\n\n- [å…¨å¹³å°é€šç”¨æ¢æºå·¥å…·ä¸æ¡†æ¶](https://github.com/RubyMetric/chsrc)\n\n- [ä¿®æ”¹å™¨ä¸‹è½½å·¥å…·](https://github.com/dyang886/Game-Cheats-Manager)\n  - ä¿®æ”¹å™¨çœŸå¿«ä¹ğŸ˜\n\n- [TypeScripté¢˜åº“](https://typeroom.cn/problems/all)\n  - TypeScript é¢˜åº“ [Type Challenge](https://github.com/type-challenges/type-challenges) çš„ç½‘é¡µç‰ˆã€‚\n\n- [å¼€æºè®¸å¯è¯é€‰æ‹©å™¨](https://open-source-license-chooser.toolsnav.top/en/)\n  - å›ç­”å‡ ä¸ªé—®é¢˜ï¼Œå¸®ä½ é€‰æ‹©ä¸€ä¸ªå¼€æºè®¸å¯è¯","slug":"ä¼˜è´¨å¼€æºè½¯ä»¶åˆé›†","published":1,"date":"2024-12-27T11:03:15.344Z","updated":"2024-12-27T11:03:15.344Z","comments":1,"layout":"post","photos":[],"_id":"cm6c7md6i000na5t297ug5by3","content":"<h1 id=\"ä¼˜è´¨èµ„æºåˆé›†\"><a href=\"#ä¼˜è´¨èµ„æºåˆé›†\" class=\"headerlink\" title=\"ä¼˜è´¨èµ„æºåˆé›†\"></a>ä¼˜è´¨èµ„æºåˆé›†</h1><h2 id=\"2024-12-01\"><a href=\"#2024-12-01\" class=\"headerlink\" title=\"2024-12-01\"></a>2024-12-01</h2><ul>\n<li><a href=\"https://github.com/didi/xiaoju-survey\">Questionnaires tool</a></li>\n</ul>\n<h2 id=\"2024-11-17\"><a href=\"#2024-11-17\" class=\"headerlink\" title=\"2024-11-17\"></a>2024-11-17</h2><ul>\n<li><a href=\"https://github.com/Uahh/ToastFish\">æ‘¸é±¼èƒŒå•è¯</a></li>\n<li><a href=\"https://github.com/krahets/hello-algo\">ç®—æ³•æ•™ç¨‹</a></li>\n</ul>\n<h2 id=\"2024-11-09\"><a href=\"#2024-11-09\" class=\"headerlink\" title=\"2024-11-09\"></a>2024-11-09</h2><ul>\n<li><a href=\"https://github.com/geekan/HowToLiveLonger\">å¦‚ä½•æ´»å¾—æ›´ä¹…ğŸ¤ª</a></li>\n</ul>\n<h2 id=\"2024-10-19\"><a href=\"#2024-10-19\" class=\"headerlink\" title=\"2024-10-19\"></a>2024-10-19</h2><ul>\n<li><a href=\"https://github.com/KoriIku/luxirty-search\">åŸºäºgoogleäºŒæ¬¡å¼€å‘çš„æœç´¢å¼•æ“</a></li>\n<li><a href=\"https://github.com/Kyome22/RunCat_for_windows\">åæ˜ CPUå ç”¨ç‡çš„å¥”è·‘å°çŒ«</a></li>\n<li><a href=\"https://github.com/k4yt3x/video2x\">è§†é¢‘å›¾ç‰‡è¶…åˆ†å·¥å…·</a></li>\n</ul>\n<h2 id=\"2024-10-12\"><a href=\"#2024-10-12\" class=\"headerlink\" title=\"2024-10-12\"></a>2024-10-12</h2><ul>\n<li><a href=\"https://github.com/forthespada/CS-Books\">CS-Books</a><ul>\n<li>è¶…è¿‡1000æœ¬çš„è®¡ç®—æœºç»å…¸ä¹¦ç±åˆ†äº«</li>\n</ul>\n</li>\n<li>[WizTree](<a href=\"https://diskanalyzer.com/\">WizTree - The Fastest Disk Space Analyzer (diskanalyzer.com)</a>)<ul>\n<li>ä»¥æ ‘çŠ¶å›¾çš„å½¢å¼åˆ†æWindowsç”µè„‘ç¡¬ç›˜çš„å ç”¨æƒ…å†µ</li>\n</ul>\n</li>\n<li><a href=\"https://lemon.qq.com/\">Lemon</a><ul>\n<li>é€‚ç”¨äºMacç”µè„‘çš„ç¡¬ç›˜å ç”¨åˆ†æå·¥å…·</li>\n</ul>\n</li>\n</ul>\n<h2 id=\"æ›´ä¹…ä¹‹å‰\"><a href=\"#æ›´ä¹…ä¹‹å‰\" class=\"headerlink\" title=\"æ›´ä¹…ä¹‹å‰\"></a>æ›´ä¹…ä¹‹å‰</h2><ul>\n<li><p><a href=\"https://github.com/Zeyi-Lin/HivisionIDPhotos\">è½»é‡çº§çš„AIè¯ä»¶ç…§åˆ¶ä½œ</a></p>\n<ul>\n<li>HivisionIDPhoto æ—¨åœ¨å¼€å‘ä¸€ç§å®ç”¨ã€ç³»ç»Ÿæ€§çš„è¯ä»¶ç…§æ™ºèƒ½åˆ¶ä½œç®—æ³•ã€‚ å®ƒåˆ©ç”¨ä¸€å¥—å®Œå–„çš„AIæ¨¡å‹å·¥ä½œæµç¨‹ï¼Œå®ç°å¯¹å¤šç§ç”¨æˆ·æ‹ç…§åœºæ™¯çš„è¯†åˆ«ã€æŠ å›¾ä¸è¯ä»¶ç…§ç”Ÿæˆã€‚</li>\n</ul>\n</li>\n<li><p><a href=\"https://github.com/hiroi-sora/Umi-OCR\">OCR</a></p>\n<ul>\n<li>å…è´¹ï¼Œå¼€æºï¼Œå¯æ‰¹é‡çš„ç¦»çº¿OCRè½¯ä»¶</li>\n</ul>\n</li>\n<li><p><a href=\"https://github.com/upscayl/upscayl\">å›¾ç‰‡é«˜æ¸…å·¥å…·</a></p>\n<ul>\n<li>Upscayl lets you enlarge and enhance low-resolution images using advanced AI algorithms. Enlarge images without losing quality. Itâ€™s almost like magic!</li>\n</ul>\n</li>\n<li><p><a href=\"https://github.com/srsng/cozy-reader\">cozy-reader</a></p>\n<ul>\n<li>å¼€æºçš„ Epub ç”µå­ä¹¦çš„æ¡Œé¢é˜…è¯»è½¯ä»¶ï¼Œè·¨å¹³å°</li>\n</ul>\n</li>\n<li><p><a href=\"https://github.com/adamian98/pulse\">PULSE</a></p>\n<ul>\n<li>é€šè¿‡è¿­ä»£æ¯”è¾ƒè¾“å‡ºå’Œè¾“å…¥å›¾ç‰‡ï¼Œå»é™¤é©¬èµ›å…‹</li>\n</ul>\n</li>\n<li><p><a href=\"https://github.com/maebert/themostdangerouswritingapp?tab=readme-ov-file\">The Most Dangerous Writing App</a></p>\n<ul>\n<li>æœ€å±é™©çš„å†™ä½œå·¥å…·ï¼Œåªè¦åœæ­¢å†™ä½œè¶…è¿‡è‹¥å¹²ç§’ï¼Œä½ çš„æ–‡ç« å°±æ²¡æœ‰å•¦ğŸ˜‚</li>\n<li>å¼ºè¿«è‡ªå·±æé«˜äº§å‡ºæ•ˆç‡ğŸ« </li>\n</ul>\n</li>\n<li><p><a href=\"https://github.com/gkd-kit/gkd\">gkd</a></p>\n<ul>\n<li>åŸºäº <strong>æ— éšœç¢</strong> + <strong>é«˜çº§é€‰æ‹©å™¨</strong> + <strong>è®¢é˜…è§„åˆ™</strong> çš„è‡ªå®šä¹‰å±å¹•ç‚¹å‡» APPğŸ¤ª</li>\n</ul>\n</li>\n<li><p><a href=\"https://github.com/iawia002/lux\">lux</a></p>\n<ul>\n<li>å¿«é€Ÿç®€å•çš„<strong>è§†é¢‘ä¸‹è½½å·¥å…·</strong></li>\n</ul>\n</li>\n<li><p><a href=\"https://github.com/DinoChan/Loaf\">æ‘¸é±¼è½¯ä»¶ğŸ˜</a></p>\n</li>\n<li><p><a href=\"https://www.pansou.vip/\">ç½‘ç›˜æœç´¢å¼•æ“</a></p>\n</li>\n<li><p><a href=\"https://github.com/RubyMetric/chsrc\">å…¨å¹³å°é€šç”¨æ¢æºå·¥å…·ä¸æ¡†æ¶</a></p>\n</li>\n<li><p><a href=\"https://github.com/dyang886/Game-Cheats-Manager\">ä¿®æ”¹å™¨ä¸‹è½½å·¥å…·</a></p>\n<ul>\n<li>ä¿®æ”¹å™¨çœŸå¿«ä¹ğŸ˜</li>\n</ul>\n</li>\n<li><p><a href=\"https://typeroom.cn/problems/all\">TypeScripté¢˜åº“</a></p>\n<ul>\n<li>TypeScript é¢˜åº“ <a href=\"https://github.com/type-challenges/type-challenges\">Type Challenge</a> çš„ç½‘é¡µç‰ˆã€‚</li>\n</ul>\n</li>\n<li><p><a href=\"https://open-source-license-chooser.toolsnav.top/en/\">å¼€æºè®¸å¯è¯é€‰æ‹©å™¨</a></p>\n<ul>\n<li>å›ç­”å‡ ä¸ªé—®é¢˜ï¼Œå¸®ä½ é€‰æ‹©ä¸€ä¸ªå¼€æºè®¸å¯è¯</li>\n</ul>\n</li>\n</ul>\n","excerpt":"","more":"<h1 id=\"ä¼˜è´¨èµ„æºåˆé›†\"><a href=\"#ä¼˜è´¨èµ„æºåˆé›†\" class=\"headerlink\" title=\"ä¼˜è´¨èµ„æºåˆé›†\"></a>ä¼˜è´¨èµ„æºåˆé›†</h1><h2 id=\"2024-12-01\"><a href=\"#2024-12-01\" class=\"headerlink\" title=\"2024-12-01\"></a>2024-12-01</h2><ul>\n<li><a href=\"https://github.com/didi/xiaoju-survey\">Questionnaires tool</a></li>\n</ul>\n<h2 id=\"2024-11-17\"><a href=\"#2024-11-17\" class=\"headerlink\" title=\"2024-11-17\"></a>2024-11-17</h2><ul>\n<li><a href=\"https://github.com/Uahh/ToastFish\">æ‘¸é±¼èƒŒå•è¯</a></li>\n<li><a href=\"https://github.com/krahets/hello-algo\">ç®—æ³•æ•™ç¨‹</a></li>\n</ul>\n<h2 id=\"2024-11-09\"><a href=\"#2024-11-09\" class=\"headerlink\" title=\"2024-11-09\"></a>2024-11-09</h2><ul>\n<li><a href=\"https://github.com/geekan/HowToLiveLonger\">å¦‚ä½•æ´»å¾—æ›´ä¹…ğŸ¤ª</a></li>\n</ul>\n<h2 id=\"2024-10-19\"><a href=\"#2024-10-19\" class=\"headerlink\" title=\"2024-10-19\"></a>2024-10-19</h2><ul>\n<li><a href=\"https://github.com/KoriIku/luxirty-search\">åŸºäºgoogleäºŒæ¬¡å¼€å‘çš„æœç´¢å¼•æ“</a></li>\n<li><a href=\"https://github.com/Kyome22/RunCat_for_windows\">åæ˜ CPUå ç”¨ç‡çš„å¥”è·‘å°çŒ«</a></li>\n<li><a href=\"https://github.com/k4yt3x/video2x\">è§†é¢‘å›¾ç‰‡è¶…åˆ†å·¥å…·</a></li>\n</ul>\n<h2 id=\"2024-10-12\"><a href=\"#2024-10-12\" class=\"headerlink\" title=\"2024-10-12\"></a>2024-10-12</h2><ul>\n<li><a href=\"https://github.com/forthespada/CS-Books\">CS-Books</a><ul>\n<li>è¶…è¿‡1000æœ¬çš„è®¡ç®—æœºç»å…¸ä¹¦ç±åˆ†äº«</li>\n</ul>\n</li>\n<li>[WizTree](<a href=\"https://diskanalyzer.com/\">WizTree - The Fastest Disk Space Analyzer (diskanalyzer.com)</a>)<ul>\n<li>ä»¥æ ‘çŠ¶å›¾çš„å½¢å¼åˆ†æWindowsç”µè„‘ç¡¬ç›˜çš„å ç”¨æƒ…å†µ</li>\n</ul>\n</li>\n<li><a href=\"https://lemon.qq.com/\">Lemon</a><ul>\n<li>é€‚ç”¨äºMacç”µè„‘çš„ç¡¬ç›˜å ç”¨åˆ†æå·¥å…·</li>\n</ul>\n</li>\n</ul>\n<h2 id=\"æ›´ä¹…ä¹‹å‰\"><a href=\"#æ›´ä¹…ä¹‹å‰\" class=\"headerlink\" title=\"æ›´ä¹…ä¹‹å‰\"></a>æ›´ä¹…ä¹‹å‰</h2><ul>\n<li><p><a href=\"https://github.com/Zeyi-Lin/HivisionIDPhotos\">è½»é‡çº§çš„AIè¯ä»¶ç…§åˆ¶ä½œ</a></p>\n<ul>\n<li>HivisionIDPhoto æ—¨åœ¨å¼€å‘ä¸€ç§å®ç”¨ã€ç³»ç»Ÿæ€§çš„è¯ä»¶ç…§æ™ºèƒ½åˆ¶ä½œç®—æ³•ã€‚ å®ƒåˆ©ç”¨ä¸€å¥—å®Œå–„çš„AIæ¨¡å‹å·¥ä½œæµç¨‹ï¼Œå®ç°å¯¹å¤šç§ç”¨æˆ·æ‹ç…§åœºæ™¯çš„è¯†åˆ«ã€æŠ å›¾ä¸è¯ä»¶ç…§ç”Ÿæˆã€‚</li>\n</ul>\n</li>\n<li><p><a href=\"https://github.com/hiroi-sora/Umi-OCR\">OCR</a></p>\n<ul>\n<li>å…è´¹ï¼Œå¼€æºï¼Œå¯æ‰¹é‡çš„ç¦»çº¿OCRè½¯ä»¶</li>\n</ul>\n</li>\n<li><p><a href=\"https://github.com/upscayl/upscayl\">å›¾ç‰‡é«˜æ¸…å·¥å…·</a></p>\n<ul>\n<li>Upscayl lets you enlarge and enhance low-resolution images using advanced AI algorithms. Enlarge images without losing quality. Itâ€™s almost like magic!</li>\n</ul>\n</li>\n<li><p><a href=\"https://github.com/srsng/cozy-reader\">cozy-reader</a></p>\n<ul>\n<li>å¼€æºçš„ Epub ç”µå­ä¹¦çš„æ¡Œé¢é˜…è¯»è½¯ä»¶ï¼Œè·¨å¹³å°</li>\n</ul>\n</li>\n<li><p><a href=\"https://github.com/adamian98/pulse\">PULSE</a></p>\n<ul>\n<li>é€šè¿‡è¿­ä»£æ¯”è¾ƒè¾“å‡ºå’Œè¾“å…¥å›¾ç‰‡ï¼Œå»é™¤é©¬èµ›å…‹</li>\n</ul>\n</li>\n<li><p><a href=\"https://github.com/maebert/themostdangerouswritingapp?tab=readme-ov-file\">The Most Dangerous Writing App</a></p>\n<ul>\n<li>æœ€å±é™©çš„å†™ä½œå·¥å…·ï¼Œåªè¦åœæ­¢å†™ä½œè¶…è¿‡è‹¥å¹²ç§’ï¼Œä½ çš„æ–‡ç« å°±æ²¡æœ‰å•¦ğŸ˜‚</li>\n<li>å¼ºè¿«è‡ªå·±æé«˜äº§å‡ºæ•ˆç‡ğŸ« </li>\n</ul>\n</li>\n<li><p><a href=\"https://github.com/gkd-kit/gkd\">gkd</a></p>\n<ul>\n<li>åŸºäº <strong>æ— éšœç¢</strong> + <strong>é«˜çº§é€‰æ‹©å™¨</strong> + <strong>è®¢é˜…è§„åˆ™</strong> çš„è‡ªå®šä¹‰å±å¹•ç‚¹å‡» APPğŸ¤ª</li>\n</ul>\n</li>\n<li><p><a href=\"https://github.com/iawia002/lux\">lux</a></p>\n<ul>\n<li>å¿«é€Ÿç®€å•çš„<strong>è§†é¢‘ä¸‹è½½å·¥å…·</strong></li>\n</ul>\n</li>\n<li><p><a href=\"https://github.com/DinoChan/Loaf\">æ‘¸é±¼è½¯ä»¶ğŸ˜</a></p>\n</li>\n<li><p><a href=\"https://www.pansou.vip/\">ç½‘ç›˜æœç´¢å¼•æ“</a></p>\n</li>\n<li><p><a href=\"https://github.com/RubyMetric/chsrc\">å…¨å¹³å°é€šç”¨æ¢æºå·¥å…·ä¸æ¡†æ¶</a></p>\n</li>\n<li><p><a href=\"https://github.com/dyang886/Game-Cheats-Manager\">ä¿®æ”¹å™¨ä¸‹è½½å·¥å…·</a></p>\n<ul>\n<li>ä¿®æ”¹å™¨çœŸå¿«ä¹ğŸ˜</li>\n</ul>\n</li>\n<li><p><a href=\"https://typeroom.cn/problems/all\">TypeScripté¢˜åº“</a></p>\n<ul>\n<li>TypeScript é¢˜åº“ <a href=\"https://github.com/type-challenges/type-challenges\">Type Challenge</a> çš„ç½‘é¡µç‰ˆã€‚</li>\n</ul>\n</li>\n<li><p><a href=\"https://open-source-license-chooser.toolsnav.top/en/\">å¼€æºè®¸å¯è¯é€‰æ‹©å™¨</a></p>\n<ul>\n<li>å›ç­”å‡ ä¸ªé—®é¢˜ï¼Œå¸®ä½ é€‰æ‹©ä¸€ä¸ªå¼€æºè®¸å¯è¯</li>\n</ul>\n</li>\n</ul>\n"},{"title":"è®°å½•ä½¿ç”¨æœ¬åœ°ç¼“å­˜ä»£æ›¿Redis","description":"è®°å½•æŠ½è±¡æ¥å£æ€è·¯","sidebar":true,"readingTime":true,"_content":"\n# ä½¿ç”¨æœ¬åœ°ç¼“å­˜ä»£æ›¿Redis\n> ç°åœ¨å› ä¸ºä½ ä¸æƒ³è¿Redisï¼Œæ‰€ä»¥ä½ æ‰“ç®—æä¾›ä¸€ä¸ªåŸºäºæœ¬åœ°ç¼“å­˜å®ç°çš„`cache.CodeCache`\n\n## å¤§ä½“æ€è·¯\n- å®šä¹‰ä¸€ä¸ª`CodeCache`æ¥å£ï¼Œèƒ½å¤Ÿä½¿å¾—åº•å±‚åœ¨Rediså’Œæœ¬åœ°ç¼“å­˜ä¸­æ— ç¼åˆ‡æ¢\n- é€‰æ‹©ä¸€ä¸ªåˆé€‚çš„æœ¬åœ°ç¼“å­˜\n- ä¿è¯å•æœºçš„å¹¶å‘å®‰å…¨\n\n## å®šä¹‰æ¥å£\n### åœ¨å“ªä¸€çº§è¿›è¡ŒæŠ½è±¡ï¼Ÿ\nåœ¨å·²æœ‰çš„å®ç°ä¸­ï¼Œæˆ‘ä»¬åœ¨repositoryä¸­å®šä¹‰äº†`codeRepository`ç»“æ„ä½“<br>\n``` go\ntype CodeRepository struct {\n\tcache cache.CodeRedis\n}\n```\nåœ¨repositoryè°ƒç”¨cacheçš„Rediså®ç°ï¼Œè¿›è¡Œå­˜å‚¨éªŒè¯ç å’Œæ ¡éªŒéªŒè¯ç çš„æ“ä½œï¼Œæœ‰å¦‚ä¸‹çš„å±‚æ¬¡å…³ç³»<br>\n![image-20240805184543232](https://raw.githubusercontent.com/lyydsheep/pic/main/202408051846343.png)<br>\nä½¿ç”¨æœ¬åœ°ç¼“å­˜æ›¿æ¢Redisï¼Œä¸Šå›¾ä¸­çš„å±‚æ¬¡å…³ç³»ä¸æ”¹å˜ï¼Œå˜åŒ–çš„æ—¶cacheçš„å…·ä½“å®ç°ï¼Œå› æ­¤memoryå’ŒRediså±äºåŒä¸€çº§<br>\næˆ‘ä»¬ç¬¬ä¸€æ­¥éœ€è¦åšçš„å°±æ˜¯åœ¨Redis-memoryè¿™ä¸€ç­‰çº§ä¸ŠæŠ½è±¡å‡ºä¸€ä¸ªæ¥å£ï¼Œå¹¶å°†å…¶æš´éœ²ç»™repositoryï¼Œå‘repositoryå±è”½åº•å±‚ç»†èŠ‚ã€‚repositoryåªéœ€è¦é€šè¿‡è°ƒç”¨æ¥å£æ–¹æ³•ï¼Œå°±èƒ½å®Œæˆæ•°æ®å­˜å‚¨å’Œæ•°æ®æŸ¥æ‰¾\n### å¦‚ä½•æ€è€ƒæ¥å£çš„å®šä¹‰ï¼Ÿ\næˆ‘ä»¬å¯ä»¥ä»å·²æœ‰çš„Rediså®ç°å‡ºå‘ï¼Œæ€è€ƒæ¥å£è¯¥å¦‚ä½•å®šä¹‰<br>\n``` go\nfunc (cc *CodeRedisCache) CheckCode(ctx context.Context, key string, input string) error {\n\tres, err := cc.client.Eval(ctx, luaCheckCode, []string{key}, input).Int()\n\tif err != nil {\n\t\treturn err\n\t}\n\tswitch res {\n\tcase 0:\n\t\treturn nil\n\tcase -1:\n\t\treturn ErrNotMatch\n\tcase -3:\n\t\treturn ErrExceed\n\tdefault:\n\t\treturn errors.New(\"ç³»ç»Ÿé”™è¯¯\")\n\t}\n}\n\nfunc (cc *CodeRedisCache) SetCode(ctx context.Context, key string, val string) error {\n\t//è·å–è¿”å›å€¼\n\tres, err := cc.client.Eval(ctx, luaSetCode, []string{key}, val).Int()\n\tif err != nil {\n\t\treturn err\n\t}\n\tswitch res {\n\tcase 0:\n\t\treturn nil\n\tcase -1:\n\t\treturn ErrTooFrequent\n\tdefault:\n\t\treturn errors.New(\"ç³»ç»Ÿé”™è¯¯\")\n\n\t}\n}\n```\nä»Rediså®ç°ä¸­ï¼Œå¯ä»¥è·å–ä¸¤ä¸ªä¿¡æ¯\n- ä¸¤ä¸ªæ–¹æ³•`CheckCode`å’Œ`SetCode`åˆ†åˆ«è¿›è¡ŒæŸ¥è¯¢æ•°æ®å’Œå­˜å‚¨æ•°æ®çš„æ“ä½œ<br>\n- è°ƒç”¨`lua`è„šæœ¬ä¿è¯`check-do something`æ“ä½œæ˜¯åŸå­æ€§çš„\n\nç›®å‰åœ¨cacheå±‚ä¸­ï¼Œè¦ä¹ˆæ˜¯å¯¹æ•°æ®æŸ¥è¯¢ï¼Œè¦ä¹ˆæ˜¯å¯¹æ•°æ®å­˜å‚¨ï¼Œå¹¶ç»“åˆç¬¬ä¸€æ¡ä¿¡æ¯ï¼Œå¾ˆå®¹æ˜“å°±èƒ½å¾—å‡ºæ¥å£çš„å®šä¹‰\n``` go\ntype CodeCache interface {\n\tCheckCode(ctx context.Context, key string, input string) error\n\tSetCode(ctx context.Context, key string, val string) error\n}\n```\nåœ¨æŸäº›å¤æ‚çš„æƒ…å†µä¸‹ï¼Œæˆ‘ä»¬è¿˜éœ€è¦å¯¹æ¥å£ä¸­æ–¹æ³•çš„å‚æ•°ç±»å‹è¿›è¡Œè°ƒæ•´ï¼Œä¸€ç§ä¸‡é‡‘æ²¹çš„æ–¹æ³•å°±æ˜¯**å†å®šä¹‰ä¸€ä¸ª`Data`ç»“æ„ä½“**ï¼Œåœ¨`Data`ç»“æ„ä½“ä¸­è®¾ç½®ä¸åŒåº•å±‚å®ç°æ‰€éœ€è¦çš„å­—æ®µ<br>\nä¾‹å¦‚ï¼š\n``` go\ntype NameData struct {\n    Name string\n    Data string\n}\n```\n\nå®šä¹‰å¥½æ¥å£åï¼Œæˆ‘ä»¬è¿˜éœ€è¦å°†æ¥å£æš´éœ²ç»™`repository`ï¼Œå…·ä½“å®ç°å¦‚ä¸‹ï¼š\n``` go\ntype CodeRepository struct {\n\tcache cache.CodeCache\n}\n```\n\n## é€‰æ‹©ä¸€ä¸ªæœ¬åœ°ç¼“å­˜\nåœ¨Golangä¸­æœ‰ä¸‰ä¸ªæœ¬åœ°ç¼“å­˜åº“æ¯”è¾ƒæœ‰åï¼š\n![image-20240805190511385](https://raw.githubusercontent.com/lyydsheep/pic/main/202408051905419.png)<br>\nå…·ä½“é€‰æ‹©æ—¶åº”è€ƒè™‘ä¸€ä¸‹å‡ ç‚¹ï¼š\n- ç»“åˆåœºæ™¯\n- å¦‚æœéœ€è¦å¯¹å•ä¸ªkeyè®¾ç½®è¿‡æœŸæ—¶é—´ï¼Œé€‰æ‹©freecache\n- å¦‚æœä¸æ³¨é‡å•ä¸ªkeyè¿‡æœŸæ—¶é—´ï¼Œæ›´æ³¨é‡æ€§èƒ½,é€‰æ‹©bigcache\n\næŸ¥è¯¢å®˜æ–¹æ–‡æ¡£ï¼Œä¾¿èƒ½å¾ˆå®¹æ˜“åœ¨`CodeMemory`ç»“æ„ä½“ä¸Šå®ç°`CodeCache`æ¥å£\n\n## å¹¶å‘é—®é¢˜\nå¾ˆæ˜¾ç„¶ï¼Œä¸ç®¡æ˜¯è®¾ç½®éªŒè¯ç è¿˜æ˜¯æ ¡éªŒéªŒè¯ç ï¼Œéƒ½æ˜¯`check-do something`çš„æµç¨‹æ“ä½œï¼Œå­˜åœ¨æ˜æ˜¾çš„å¹¶å‘é—®é¢˜<br>\nåœ¨Rediså®ç°ä¸­ï¼Œå·§å¦™åœ°ä½¿ç”¨äº†`lua`è„šæœ¬ï¼Œå°†æ“ä½œæ•´åˆæˆä¸€ä¸ªåŸå­æ“ä½œã€‚ä½†æ˜¯åœ¨memoryå®ç°ä¸­ï¼Œæˆ‘ä»¬æ— æ³•é€šè¿‡ç±»ä¼¼çš„æ–¹å¼é¿å…å¹¶å‘é—®é¢˜ï¼Œå› æ­¤åªèƒ½æš´åŠ›ä¸Šé”ã€è§£é”æ¥ä¿è¯å¹¶å‘å®‰å…¨","source":"_posts/ä½¿ç”¨æœ¬åœ°ç¼“å­˜ä»£æ›¿Redis.md","raw":"---\ntitle: è®°å½•ä½¿ç”¨æœ¬åœ°ç¼“å­˜ä»£æ›¿Redis\n#sticky: 999\ndescription: è®°å½•æŠ½è±¡æ¥å£æ€è·¯\n#descriptionHTML: \ntag:\n - Golang\n#top: 1\nsidebar: true\n#categories: [Golang]\nreadingTime: true\n#recommend: 3\n---\n\n# ä½¿ç”¨æœ¬åœ°ç¼“å­˜ä»£æ›¿Redis\n> ç°åœ¨å› ä¸ºä½ ä¸æƒ³è¿Redisï¼Œæ‰€ä»¥ä½ æ‰“ç®—æä¾›ä¸€ä¸ªåŸºäºæœ¬åœ°ç¼“å­˜å®ç°çš„`cache.CodeCache`\n\n## å¤§ä½“æ€è·¯\n- å®šä¹‰ä¸€ä¸ª`CodeCache`æ¥å£ï¼Œèƒ½å¤Ÿä½¿å¾—åº•å±‚åœ¨Rediså’Œæœ¬åœ°ç¼“å­˜ä¸­æ— ç¼åˆ‡æ¢\n- é€‰æ‹©ä¸€ä¸ªåˆé€‚çš„æœ¬åœ°ç¼“å­˜\n- ä¿è¯å•æœºçš„å¹¶å‘å®‰å…¨\n\n## å®šä¹‰æ¥å£\n### åœ¨å“ªä¸€çº§è¿›è¡ŒæŠ½è±¡ï¼Ÿ\nåœ¨å·²æœ‰çš„å®ç°ä¸­ï¼Œæˆ‘ä»¬åœ¨repositoryä¸­å®šä¹‰äº†`codeRepository`ç»“æ„ä½“<br>\n``` go\ntype CodeRepository struct {\n\tcache cache.CodeRedis\n}\n```\nåœ¨repositoryè°ƒç”¨cacheçš„Rediså®ç°ï¼Œè¿›è¡Œå­˜å‚¨éªŒè¯ç å’Œæ ¡éªŒéªŒè¯ç çš„æ“ä½œï¼Œæœ‰å¦‚ä¸‹çš„å±‚æ¬¡å…³ç³»<br>\n![image-20240805184543232](https://raw.githubusercontent.com/lyydsheep/pic/main/202408051846343.png)<br>\nä½¿ç”¨æœ¬åœ°ç¼“å­˜æ›¿æ¢Redisï¼Œä¸Šå›¾ä¸­çš„å±‚æ¬¡å…³ç³»ä¸æ”¹å˜ï¼Œå˜åŒ–çš„æ—¶cacheçš„å…·ä½“å®ç°ï¼Œå› æ­¤memoryå’ŒRediså±äºåŒä¸€çº§<br>\næˆ‘ä»¬ç¬¬ä¸€æ­¥éœ€è¦åšçš„å°±æ˜¯åœ¨Redis-memoryè¿™ä¸€ç­‰çº§ä¸ŠæŠ½è±¡å‡ºä¸€ä¸ªæ¥å£ï¼Œå¹¶å°†å…¶æš´éœ²ç»™repositoryï¼Œå‘repositoryå±è”½åº•å±‚ç»†èŠ‚ã€‚repositoryåªéœ€è¦é€šè¿‡è°ƒç”¨æ¥å£æ–¹æ³•ï¼Œå°±èƒ½å®Œæˆæ•°æ®å­˜å‚¨å’Œæ•°æ®æŸ¥æ‰¾\n### å¦‚ä½•æ€è€ƒæ¥å£çš„å®šä¹‰ï¼Ÿ\næˆ‘ä»¬å¯ä»¥ä»å·²æœ‰çš„Rediså®ç°å‡ºå‘ï¼Œæ€è€ƒæ¥å£è¯¥å¦‚ä½•å®šä¹‰<br>\n``` go\nfunc (cc *CodeRedisCache) CheckCode(ctx context.Context, key string, input string) error {\n\tres, err := cc.client.Eval(ctx, luaCheckCode, []string{key}, input).Int()\n\tif err != nil {\n\t\treturn err\n\t}\n\tswitch res {\n\tcase 0:\n\t\treturn nil\n\tcase -1:\n\t\treturn ErrNotMatch\n\tcase -3:\n\t\treturn ErrExceed\n\tdefault:\n\t\treturn errors.New(\"ç³»ç»Ÿé”™è¯¯\")\n\t}\n}\n\nfunc (cc *CodeRedisCache) SetCode(ctx context.Context, key string, val string) error {\n\t//è·å–è¿”å›å€¼\n\tres, err := cc.client.Eval(ctx, luaSetCode, []string{key}, val).Int()\n\tif err != nil {\n\t\treturn err\n\t}\n\tswitch res {\n\tcase 0:\n\t\treturn nil\n\tcase -1:\n\t\treturn ErrTooFrequent\n\tdefault:\n\t\treturn errors.New(\"ç³»ç»Ÿé”™è¯¯\")\n\n\t}\n}\n```\nä»Rediså®ç°ä¸­ï¼Œå¯ä»¥è·å–ä¸¤ä¸ªä¿¡æ¯\n- ä¸¤ä¸ªæ–¹æ³•`CheckCode`å’Œ`SetCode`åˆ†åˆ«è¿›è¡ŒæŸ¥è¯¢æ•°æ®å’Œå­˜å‚¨æ•°æ®çš„æ“ä½œ<br>\n- è°ƒç”¨`lua`è„šæœ¬ä¿è¯`check-do something`æ“ä½œæ˜¯åŸå­æ€§çš„\n\nç›®å‰åœ¨cacheå±‚ä¸­ï¼Œè¦ä¹ˆæ˜¯å¯¹æ•°æ®æŸ¥è¯¢ï¼Œè¦ä¹ˆæ˜¯å¯¹æ•°æ®å­˜å‚¨ï¼Œå¹¶ç»“åˆç¬¬ä¸€æ¡ä¿¡æ¯ï¼Œå¾ˆå®¹æ˜“å°±èƒ½å¾—å‡ºæ¥å£çš„å®šä¹‰\n``` go\ntype CodeCache interface {\n\tCheckCode(ctx context.Context, key string, input string) error\n\tSetCode(ctx context.Context, key string, val string) error\n}\n```\nåœ¨æŸäº›å¤æ‚çš„æƒ…å†µä¸‹ï¼Œæˆ‘ä»¬è¿˜éœ€è¦å¯¹æ¥å£ä¸­æ–¹æ³•çš„å‚æ•°ç±»å‹è¿›è¡Œè°ƒæ•´ï¼Œä¸€ç§ä¸‡é‡‘æ²¹çš„æ–¹æ³•å°±æ˜¯**å†å®šä¹‰ä¸€ä¸ª`Data`ç»“æ„ä½“**ï¼Œåœ¨`Data`ç»“æ„ä½“ä¸­è®¾ç½®ä¸åŒåº•å±‚å®ç°æ‰€éœ€è¦çš„å­—æ®µ<br>\nä¾‹å¦‚ï¼š\n``` go\ntype NameData struct {\n    Name string\n    Data string\n}\n```\n\nå®šä¹‰å¥½æ¥å£åï¼Œæˆ‘ä»¬è¿˜éœ€è¦å°†æ¥å£æš´éœ²ç»™`repository`ï¼Œå…·ä½“å®ç°å¦‚ä¸‹ï¼š\n``` go\ntype CodeRepository struct {\n\tcache cache.CodeCache\n}\n```\n\n## é€‰æ‹©ä¸€ä¸ªæœ¬åœ°ç¼“å­˜\nåœ¨Golangä¸­æœ‰ä¸‰ä¸ªæœ¬åœ°ç¼“å­˜åº“æ¯”è¾ƒæœ‰åï¼š\n![image-20240805190511385](https://raw.githubusercontent.com/lyydsheep/pic/main/202408051905419.png)<br>\nå…·ä½“é€‰æ‹©æ—¶åº”è€ƒè™‘ä¸€ä¸‹å‡ ç‚¹ï¼š\n- ç»“åˆåœºæ™¯\n- å¦‚æœéœ€è¦å¯¹å•ä¸ªkeyè®¾ç½®è¿‡æœŸæ—¶é—´ï¼Œé€‰æ‹©freecache\n- å¦‚æœä¸æ³¨é‡å•ä¸ªkeyè¿‡æœŸæ—¶é—´ï¼Œæ›´æ³¨é‡æ€§èƒ½,é€‰æ‹©bigcache\n\næŸ¥è¯¢å®˜æ–¹æ–‡æ¡£ï¼Œä¾¿èƒ½å¾ˆå®¹æ˜“åœ¨`CodeMemory`ç»“æ„ä½“ä¸Šå®ç°`CodeCache`æ¥å£\n\n## å¹¶å‘é—®é¢˜\nå¾ˆæ˜¾ç„¶ï¼Œä¸ç®¡æ˜¯è®¾ç½®éªŒè¯ç è¿˜æ˜¯æ ¡éªŒéªŒè¯ç ï¼Œéƒ½æ˜¯`check-do something`çš„æµç¨‹æ“ä½œï¼Œå­˜åœ¨æ˜æ˜¾çš„å¹¶å‘é—®é¢˜<br>\nåœ¨Rediså®ç°ä¸­ï¼Œå·§å¦™åœ°ä½¿ç”¨äº†`lua`è„šæœ¬ï¼Œå°†æ“ä½œæ•´åˆæˆä¸€ä¸ªåŸå­æ“ä½œã€‚ä½†æ˜¯åœ¨memoryå®ç°ä¸­ï¼Œæˆ‘ä»¬æ— æ³•é€šè¿‡ç±»ä¼¼çš„æ–¹å¼é¿å…å¹¶å‘é—®é¢˜ï¼Œå› æ­¤åªèƒ½æš´åŠ›ä¸Šé”ã€è§£é”æ¥ä¿è¯å¹¶å‘å®‰å…¨","slug":"ä½¿ç”¨æœ¬åœ°ç¼“å­˜ä»£æ›¿Redis","published":1,"date":"2024-12-27T11:03:15.344Z","updated":"2024-12-27T11:03:15.344Z","comments":1,"layout":"post","photos":[],"_id":"cm6c7md6i000pa5t2233r35uc","content":"<h1 id=\"ä½¿ç”¨æœ¬åœ°ç¼“å­˜ä»£æ›¿Redis\"><a href=\"#ä½¿ç”¨æœ¬åœ°ç¼“å­˜ä»£æ›¿Redis\" class=\"headerlink\" title=\"ä½¿ç”¨æœ¬åœ°ç¼“å­˜ä»£æ›¿Redis\"></a>ä½¿ç”¨æœ¬åœ°ç¼“å­˜ä»£æ›¿Redis</h1><blockquote>\n<p>ç°åœ¨å› ä¸ºä½ ä¸æƒ³è¿Redisï¼Œæ‰€ä»¥ä½ æ‰“ç®—æä¾›ä¸€ä¸ªåŸºäºæœ¬åœ°ç¼“å­˜å®ç°çš„<code>cache.CodeCache</code></p>\n</blockquote>\n<h2 id=\"å¤§ä½“æ€è·¯\"><a href=\"#å¤§ä½“æ€è·¯\" class=\"headerlink\" title=\"å¤§ä½“æ€è·¯\"></a>å¤§ä½“æ€è·¯</h2><ul>\n<li>å®šä¹‰ä¸€ä¸ª<code>CodeCache</code>æ¥å£ï¼Œèƒ½å¤Ÿä½¿å¾—åº•å±‚åœ¨Rediså’Œæœ¬åœ°ç¼“å­˜ä¸­æ— ç¼åˆ‡æ¢</li>\n<li>é€‰æ‹©ä¸€ä¸ªåˆé€‚çš„æœ¬åœ°ç¼“å­˜</li>\n<li>ä¿è¯å•æœºçš„å¹¶å‘å®‰å…¨</li>\n</ul>\n<h2 id=\"å®šä¹‰æ¥å£\"><a href=\"#å®šä¹‰æ¥å£\" class=\"headerlink\" title=\"å®šä¹‰æ¥å£\"></a>å®šä¹‰æ¥å£</h2><h3 id=\"åœ¨å“ªä¸€çº§è¿›è¡ŒæŠ½è±¡ï¼Ÿ\"><a href=\"#åœ¨å“ªä¸€çº§è¿›è¡ŒæŠ½è±¡ï¼Ÿ\" class=\"headerlink\" title=\"åœ¨å“ªä¸€çº§è¿›è¡ŒæŠ½è±¡ï¼Ÿ\"></a>åœ¨å“ªä¸€çº§è¿›è¡ŒæŠ½è±¡ï¼Ÿ</h3><p>åœ¨å·²æœ‰çš„å®ç°ä¸­ï¼Œæˆ‘ä»¬åœ¨repositoryä¸­å®šä¹‰äº†<code>codeRepository</code>ç»“æ„ä½“<br></p>\n<figure class=\"highlight go\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">type</span> CodeRepository <span class=\"keyword\">struct</span> &#123;</span><br><span class=\"line\">\tcache cache.CodeRedis</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n<p>åœ¨repositoryè°ƒç”¨cacheçš„Rediså®ç°ï¼Œè¿›è¡Œå­˜å‚¨éªŒè¯ç å’Œæ ¡éªŒéªŒè¯ç çš„æ“ä½œï¼Œæœ‰å¦‚ä¸‹çš„å±‚æ¬¡å…³ç³»<br><br><img src=\"https://raw.githubusercontent.com/lyydsheep/pic/main/202408051846343.png\" alt=\"image-20240805184543232\"><br><br>ä½¿ç”¨æœ¬åœ°ç¼“å­˜æ›¿æ¢Redisï¼Œä¸Šå›¾ä¸­çš„å±‚æ¬¡å…³ç³»ä¸æ”¹å˜ï¼Œå˜åŒ–çš„æ—¶cacheçš„å…·ä½“å®ç°ï¼Œå› æ­¤memoryå’ŒRediså±äºåŒä¸€çº§<br><br>æˆ‘ä»¬ç¬¬ä¸€æ­¥éœ€è¦åšçš„å°±æ˜¯åœ¨Redis-memoryè¿™ä¸€ç­‰çº§ä¸ŠæŠ½è±¡å‡ºä¸€ä¸ªæ¥å£ï¼Œå¹¶å°†å…¶æš´éœ²ç»™repositoryï¼Œå‘repositoryå±è”½åº•å±‚ç»†èŠ‚ã€‚repositoryåªéœ€è¦é€šè¿‡è°ƒç”¨æ¥å£æ–¹æ³•ï¼Œå°±èƒ½å®Œæˆæ•°æ®å­˜å‚¨å’Œæ•°æ®æŸ¥æ‰¾</p>\n<h3 id=\"å¦‚ä½•æ€è€ƒæ¥å£çš„å®šä¹‰ï¼Ÿ\"><a href=\"#å¦‚ä½•æ€è€ƒæ¥å£çš„å®šä¹‰ï¼Ÿ\" class=\"headerlink\" title=\"å¦‚ä½•æ€è€ƒæ¥å£çš„å®šä¹‰ï¼Ÿ\"></a>å¦‚ä½•æ€è€ƒæ¥å£çš„å®šä¹‰ï¼Ÿ</h3><p>æˆ‘ä»¬å¯ä»¥ä»å·²æœ‰çš„Rediså®ç°å‡ºå‘ï¼Œæ€è€ƒæ¥å£è¯¥å¦‚ä½•å®šä¹‰<br></p>\n<figure class=\"highlight go\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br><span class=\"line\">31</span><br><span class=\"line\">32</span><br><span class=\"line\">33</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"function\"><span class=\"keyword\">func</span> <span class=\"params\">(cc *CodeRedisCache)</span></span> CheckCode(ctx context.Context, key <span class=\"type\">string</span>, input <span class=\"type\">string</span>) <span class=\"type\">error</span> &#123;</span><br><span class=\"line\">\tres, err := cc.client.Eval(ctx, luaCheckCode, []<span class=\"type\">string</span>&#123;key&#125;, input).Int()</span><br><span class=\"line\">\t<span class=\"keyword\">if</span> err != <span class=\"literal\">nil</span> &#123;</span><br><span class=\"line\">\t\t<span class=\"keyword\">return</span> err</span><br><span class=\"line\">\t&#125;</span><br><span class=\"line\">\t<span class=\"keyword\">switch</span> res &#123;</span><br><span class=\"line\">\t<span class=\"keyword\">case</span> <span class=\"number\">0</span>:</span><br><span class=\"line\">\t\t<span class=\"keyword\">return</span> <span class=\"literal\">nil</span></span><br><span class=\"line\">\t<span class=\"keyword\">case</span> <span class=\"number\">-1</span>:</span><br><span class=\"line\">\t\t<span class=\"keyword\">return</span> ErrNotMatch</span><br><span class=\"line\">\t<span class=\"keyword\">case</span> <span class=\"number\">-3</span>:</span><br><span class=\"line\">\t\t<span class=\"keyword\">return</span> ErrExceed</span><br><span class=\"line\">\t<span class=\"keyword\">default</span>:</span><br><span class=\"line\">\t\t<span class=\"keyword\">return</span> errors.New(<span class=\"string\">&quot;ç³»ç»Ÿé”™è¯¯&quot;</span>)</span><br><span class=\"line\">\t&#125;</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"function\"><span class=\"keyword\">func</span> <span class=\"params\">(cc *CodeRedisCache)</span></span> SetCode(ctx context.Context, key <span class=\"type\">string</span>, val <span class=\"type\">string</span>) <span class=\"type\">error</span> &#123;</span><br><span class=\"line\">\t<span class=\"comment\">//è·å–è¿”å›å€¼</span></span><br><span class=\"line\">\tres, err := cc.client.Eval(ctx, luaSetCode, []<span class=\"type\">string</span>&#123;key&#125;, val).Int()</span><br><span class=\"line\">\t<span class=\"keyword\">if</span> err != <span class=\"literal\">nil</span> &#123;</span><br><span class=\"line\">\t\t<span class=\"keyword\">return</span> err</span><br><span class=\"line\">\t&#125;</span><br><span class=\"line\">\t<span class=\"keyword\">switch</span> res &#123;</span><br><span class=\"line\">\t<span class=\"keyword\">case</span> <span class=\"number\">0</span>:</span><br><span class=\"line\">\t\t<span class=\"keyword\">return</span> <span class=\"literal\">nil</span></span><br><span class=\"line\">\t<span class=\"keyword\">case</span> <span class=\"number\">-1</span>:</span><br><span class=\"line\">\t\t<span class=\"keyword\">return</span> ErrTooFrequent</span><br><span class=\"line\">\t<span class=\"keyword\">default</span>:</span><br><span class=\"line\">\t\t<span class=\"keyword\">return</span> errors.New(<span class=\"string\">&quot;ç³»ç»Ÿé”™è¯¯&quot;</span>)</span><br><span class=\"line\"></span><br><span class=\"line\">\t&#125;</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n<p>ä»Rediså®ç°ä¸­ï¼Œå¯ä»¥è·å–ä¸¤ä¸ªä¿¡æ¯</p>\n<ul>\n<li>ä¸¤ä¸ªæ–¹æ³•<code>CheckCode</code>å’Œ<code>SetCode</code>åˆ†åˆ«è¿›è¡ŒæŸ¥è¯¢æ•°æ®å’Œå­˜å‚¨æ•°æ®çš„æ“ä½œ<br></li>\n<li>è°ƒç”¨<code>lua</code>è„šæœ¬ä¿è¯<code>check-do something</code>æ“ä½œæ˜¯åŸå­æ€§çš„</li>\n</ul>\n<p>ç›®å‰åœ¨cacheå±‚ä¸­ï¼Œè¦ä¹ˆæ˜¯å¯¹æ•°æ®æŸ¥è¯¢ï¼Œè¦ä¹ˆæ˜¯å¯¹æ•°æ®å­˜å‚¨ï¼Œå¹¶ç»“åˆç¬¬ä¸€æ¡ä¿¡æ¯ï¼Œå¾ˆå®¹æ˜“å°±èƒ½å¾—å‡ºæ¥å£çš„å®šä¹‰</p>\n<figure class=\"highlight go\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">type</span> CodeCache <span class=\"keyword\">interface</span> &#123;</span><br><span class=\"line\">\tCheckCode(ctx context.Context, key <span class=\"type\">string</span>, input <span class=\"type\">string</span>) <span class=\"type\">error</span></span><br><span class=\"line\">\tSetCode(ctx context.Context, key <span class=\"type\">string</span>, val <span class=\"type\">string</span>) <span class=\"type\">error</span></span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n<p>åœ¨æŸäº›å¤æ‚çš„æƒ…å†µä¸‹ï¼Œæˆ‘ä»¬è¿˜éœ€è¦å¯¹æ¥å£ä¸­æ–¹æ³•çš„å‚æ•°ç±»å‹è¿›è¡Œè°ƒæ•´ï¼Œä¸€ç§ä¸‡é‡‘æ²¹çš„æ–¹æ³•å°±æ˜¯<strong>å†å®šä¹‰ä¸€ä¸ª<code>Data</code>ç»“æ„ä½“</strong>ï¼Œåœ¨<code>Data</code>ç»“æ„ä½“ä¸­è®¾ç½®ä¸åŒåº•å±‚å®ç°æ‰€éœ€è¦çš„å­—æ®µ<br><br>ä¾‹å¦‚ï¼š</p>\n<figure class=\"highlight go\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">type</span> NameData <span class=\"keyword\">struct</span> &#123;</span><br><span class=\"line\">    Name <span class=\"type\">string</span></span><br><span class=\"line\">    Data <span class=\"type\">string</span></span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n\n<p>å®šä¹‰å¥½æ¥å£åï¼Œæˆ‘ä»¬è¿˜éœ€è¦å°†æ¥å£æš´éœ²ç»™<code>repository</code>ï¼Œå…·ä½“å®ç°å¦‚ä¸‹ï¼š</p>\n<figure class=\"highlight go\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">type</span> CodeRepository <span class=\"keyword\">struct</span> &#123;</span><br><span class=\"line\">\tcache cache.CodeCache</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n\n<h2 id=\"é€‰æ‹©ä¸€ä¸ªæœ¬åœ°ç¼“å­˜\"><a href=\"#é€‰æ‹©ä¸€ä¸ªæœ¬åœ°ç¼“å­˜\" class=\"headerlink\" title=\"é€‰æ‹©ä¸€ä¸ªæœ¬åœ°ç¼“å­˜\"></a>é€‰æ‹©ä¸€ä¸ªæœ¬åœ°ç¼“å­˜</h2><p>åœ¨Golangä¸­æœ‰ä¸‰ä¸ªæœ¬åœ°ç¼“å­˜åº“æ¯”è¾ƒæœ‰åï¼š<br><img src=\"https://raw.githubusercontent.com/lyydsheep/pic/main/202408051905419.png\" alt=\"image-20240805190511385\"><br><br>å…·ä½“é€‰æ‹©æ—¶åº”è€ƒè™‘ä¸€ä¸‹å‡ ç‚¹ï¼š</p>\n<ul>\n<li>ç»“åˆåœºæ™¯</li>\n<li>å¦‚æœéœ€è¦å¯¹å•ä¸ªkeyè®¾ç½®è¿‡æœŸæ—¶é—´ï¼Œé€‰æ‹©freecache</li>\n<li>å¦‚æœä¸æ³¨é‡å•ä¸ªkeyè¿‡æœŸæ—¶é—´ï¼Œæ›´æ³¨é‡æ€§èƒ½,é€‰æ‹©bigcache</li>\n</ul>\n<p>æŸ¥è¯¢å®˜æ–¹æ–‡æ¡£ï¼Œä¾¿èƒ½å¾ˆå®¹æ˜“åœ¨<code>CodeMemory</code>ç»“æ„ä½“ä¸Šå®ç°<code>CodeCache</code>æ¥å£</p>\n<h2 id=\"å¹¶å‘é—®é¢˜\"><a href=\"#å¹¶å‘é—®é¢˜\" class=\"headerlink\" title=\"å¹¶å‘é—®é¢˜\"></a>å¹¶å‘é—®é¢˜</h2><p>å¾ˆæ˜¾ç„¶ï¼Œä¸ç®¡æ˜¯è®¾ç½®éªŒè¯ç è¿˜æ˜¯æ ¡éªŒéªŒè¯ç ï¼Œéƒ½æ˜¯<code>check-do something</code>çš„æµç¨‹æ“ä½œï¼Œå­˜åœ¨æ˜æ˜¾çš„å¹¶å‘é—®é¢˜<br><br>åœ¨Rediså®ç°ä¸­ï¼Œå·§å¦™åœ°ä½¿ç”¨äº†<code>lua</code>è„šæœ¬ï¼Œå°†æ“ä½œæ•´åˆæˆä¸€ä¸ªåŸå­æ“ä½œã€‚ä½†æ˜¯åœ¨memoryå®ç°ä¸­ï¼Œæˆ‘ä»¬æ— æ³•é€šè¿‡ç±»ä¼¼çš„æ–¹å¼é¿å…å¹¶å‘é—®é¢˜ï¼Œå› æ­¤åªèƒ½æš´åŠ›ä¸Šé”ã€è§£é”æ¥ä¿è¯å¹¶å‘å®‰å…¨</p>\n","excerpt":"","more":"<h1 id=\"ä½¿ç”¨æœ¬åœ°ç¼“å­˜ä»£æ›¿Redis\"><a href=\"#ä½¿ç”¨æœ¬åœ°ç¼“å­˜ä»£æ›¿Redis\" class=\"headerlink\" title=\"ä½¿ç”¨æœ¬åœ°ç¼“å­˜ä»£æ›¿Redis\"></a>ä½¿ç”¨æœ¬åœ°ç¼“å­˜ä»£æ›¿Redis</h1><blockquote>\n<p>ç°åœ¨å› ä¸ºä½ ä¸æƒ³è¿Redisï¼Œæ‰€ä»¥ä½ æ‰“ç®—æä¾›ä¸€ä¸ªåŸºäºæœ¬åœ°ç¼“å­˜å®ç°çš„<code>cache.CodeCache</code></p>\n</blockquote>\n<h2 id=\"å¤§ä½“æ€è·¯\"><a href=\"#å¤§ä½“æ€è·¯\" class=\"headerlink\" title=\"å¤§ä½“æ€è·¯\"></a>å¤§ä½“æ€è·¯</h2><ul>\n<li>å®šä¹‰ä¸€ä¸ª<code>CodeCache</code>æ¥å£ï¼Œèƒ½å¤Ÿä½¿å¾—åº•å±‚åœ¨Rediså’Œæœ¬åœ°ç¼“å­˜ä¸­æ— ç¼åˆ‡æ¢</li>\n<li>é€‰æ‹©ä¸€ä¸ªåˆé€‚çš„æœ¬åœ°ç¼“å­˜</li>\n<li>ä¿è¯å•æœºçš„å¹¶å‘å®‰å…¨</li>\n</ul>\n<h2 id=\"å®šä¹‰æ¥å£\"><a href=\"#å®šä¹‰æ¥å£\" class=\"headerlink\" title=\"å®šä¹‰æ¥å£\"></a>å®šä¹‰æ¥å£</h2><h3 id=\"åœ¨å“ªä¸€çº§è¿›è¡ŒæŠ½è±¡ï¼Ÿ\"><a href=\"#åœ¨å“ªä¸€çº§è¿›è¡ŒæŠ½è±¡ï¼Ÿ\" class=\"headerlink\" title=\"åœ¨å“ªä¸€çº§è¿›è¡ŒæŠ½è±¡ï¼Ÿ\"></a>åœ¨å“ªä¸€çº§è¿›è¡ŒæŠ½è±¡ï¼Ÿ</h3><p>åœ¨å·²æœ‰çš„å®ç°ä¸­ï¼Œæˆ‘ä»¬åœ¨repositoryä¸­å®šä¹‰äº†<code>codeRepository</code>ç»“æ„ä½“<br></p>\n<figure class=\"highlight go\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">type</span> CodeRepository <span class=\"keyword\">struct</span> &#123;</span><br><span class=\"line\">\tcache cache.CodeRedis</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n<p>åœ¨repositoryè°ƒç”¨cacheçš„Rediså®ç°ï¼Œè¿›è¡Œå­˜å‚¨éªŒè¯ç å’Œæ ¡éªŒéªŒè¯ç çš„æ“ä½œï¼Œæœ‰å¦‚ä¸‹çš„å±‚æ¬¡å…³ç³»<br><br><img src=\"https://raw.githubusercontent.com/lyydsheep/pic/main/202408051846343.png\" alt=\"image-20240805184543232\"><br><br>ä½¿ç”¨æœ¬åœ°ç¼“å­˜æ›¿æ¢Redisï¼Œä¸Šå›¾ä¸­çš„å±‚æ¬¡å…³ç³»ä¸æ”¹å˜ï¼Œå˜åŒ–çš„æ—¶cacheçš„å…·ä½“å®ç°ï¼Œå› æ­¤memoryå’ŒRediså±äºåŒä¸€çº§<br><br>æˆ‘ä»¬ç¬¬ä¸€æ­¥éœ€è¦åšçš„å°±æ˜¯åœ¨Redis-memoryè¿™ä¸€ç­‰çº§ä¸ŠæŠ½è±¡å‡ºä¸€ä¸ªæ¥å£ï¼Œå¹¶å°†å…¶æš´éœ²ç»™repositoryï¼Œå‘repositoryå±è”½åº•å±‚ç»†èŠ‚ã€‚repositoryåªéœ€è¦é€šè¿‡è°ƒç”¨æ¥å£æ–¹æ³•ï¼Œå°±èƒ½å®Œæˆæ•°æ®å­˜å‚¨å’Œæ•°æ®æŸ¥æ‰¾</p>\n<h3 id=\"å¦‚ä½•æ€è€ƒæ¥å£çš„å®šä¹‰ï¼Ÿ\"><a href=\"#å¦‚ä½•æ€è€ƒæ¥å£çš„å®šä¹‰ï¼Ÿ\" class=\"headerlink\" title=\"å¦‚ä½•æ€è€ƒæ¥å£çš„å®šä¹‰ï¼Ÿ\"></a>å¦‚ä½•æ€è€ƒæ¥å£çš„å®šä¹‰ï¼Ÿ</h3><p>æˆ‘ä»¬å¯ä»¥ä»å·²æœ‰çš„Rediså®ç°å‡ºå‘ï¼Œæ€è€ƒæ¥å£è¯¥å¦‚ä½•å®šä¹‰<br></p>\n<figure class=\"highlight go\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br><span class=\"line\">31</span><br><span class=\"line\">32</span><br><span class=\"line\">33</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"function\"><span class=\"keyword\">func</span> <span class=\"params\">(cc *CodeRedisCache)</span></span> CheckCode(ctx context.Context, key <span class=\"type\">string</span>, input <span class=\"type\">string</span>) <span class=\"type\">error</span> &#123;</span><br><span class=\"line\">\tres, err := cc.client.Eval(ctx, luaCheckCode, []<span class=\"type\">string</span>&#123;key&#125;, input).Int()</span><br><span class=\"line\">\t<span class=\"keyword\">if</span> err != <span class=\"literal\">nil</span> &#123;</span><br><span class=\"line\">\t\t<span class=\"keyword\">return</span> err</span><br><span class=\"line\">\t&#125;</span><br><span class=\"line\">\t<span class=\"keyword\">switch</span> res &#123;</span><br><span class=\"line\">\t<span class=\"keyword\">case</span> <span class=\"number\">0</span>:</span><br><span class=\"line\">\t\t<span class=\"keyword\">return</span> <span class=\"literal\">nil</span></span><br><span class=\"line\">\t<span class=\"keyword\">case</span> <span class=\"number\">-1</span>:</span><br><span class=\"line\">\t\t<span class=\"keyword\">return</span> ErrNotMatch</span><br><span class=\"line\">\t<span class=\"keyword\">case</span> <span class=\"number\">-3</span>:</span><br><span class=\"line\">\t\t<span class=\"keyword\">return</span> ErrExceed</span><br><span class=\"line\">\t<span class=\"keyword\">default</span>:</span><br><span class=\"line\">\t\t<span class=\"keyword\">return</span> errors.New(<span class=\"string\">&quot;ç³»ç»Ÿé”™è¯¯&quot;</span>)</span><br><span class=\"line\">\t&#125;</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"function\"><span class=\"keyword\">func</span> <span class=\"params\">(cc *CodeRedisCache)</span></span> SetCode(ctx context.Context, key <span class=\"type\">string</span>, val <span class=\"type\">string</span>) <span class=\"type\">error</span> &#123;</span><br><span class=\"line\">\t<span class=\"comment\">//è·å–è¿”å›å€¼</span></span><br><span class=\"line\">\tres, err := cc.client.Eval(ctx, luaSetCode, []<span class=\"type\">string</span>&#123;key&#125;, val).Int()</span><br><span class=\"line\">\t<span class=\"keyword\">if</span> err != <span class=\"literal\">nil</span> &#123;</span><br><span class=\"line\">\t\t<span class=\"keyword\">return</span> err</span><br><span class=\"line\">\t&#125;</span><br><span class=\"line\">\t<span class=\"keyword\">switch</span> res &#123;</span><br><span class=\"line\">\t<span class=\"keyword\">case</span> <span class=\"number\">0</span>:</span><br><span class=\"line\">\t\t<span class=\"keyword\">return</span> <span class=\"literal\">nil</span></span><br><span class=\"line\">\t<span class=\"keyword\">case</span> <span class=\"number\">-1</span>:</span><br><span class=\"line\">\t\t<span class=\"keyword\">return</span> ErrTooFrequent</span><br><span class=\"line\">\t<span class=\"keyword\">default</span>:</span><br><span class=\"line\">\t\t<span class=\"keyword\">return</span> errors.New(<span class=\"string\">&quot;ç³»ç»Ÿé”™è¯¯&quot;</span>)</span><br><span class=\"line\"></span><br><span class=\"line\">\t&#125;</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n<p>ä»Rediså®ç°ä¸­ï¼Œå¯ä»¥è·å–ä¸¤ä¸ªä¿¡æ¯</p>\n<ul>\n<li>ä¸¤ä¸ªæ–¹æ³•<code>CheckCode</code>å’Œ<code>SetCode</code>åˆ†åˆ«è¿›è¡ŒæŸ¥è¯¢æ•°æ®å’Œå­˜å‚¨æ•°æ®çš„æ“ä½œ<br></li>\n<li>è°ƒç”¨<code>lua</code>è„šæœ¬ä¿è¯<code>check-do something</code>æ“ä½œæ˜¯åŸå­æ€§çš„</li>\n</ul>\n<p>ç›®å‰åœ¨cacheå±‚ä¸­ï¼Œè¦ä¹ˆæ˜¯å¯¹æ•°æ®æŸ¥è¯¢ï¼Œè¦ä¹ˆæ˜¯å¯¹æ•°æ®å­˜å‚¨ï¼Œå¹¶ç»“åˆç¬¬ä¸€æ¡ä¿¡æ¯ï¼Œå¾ˆå®¹æ˜“å°±èƒ½å¾—å‡ºæ¥å£çš„å®šä¹‰</p>\n<figure class=\"highlight go\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">type</span> CodeCache <span class=\"keyword\">interface</span> &#123;</span><br><span class=\"line\">\tCheckCode(ctx context.Context, key <span class=\"type\">string</span>, input <span class=\"type\">string</span>) <span class=\"type\">error</span></span><br><span class=\"line\">\tSetCode(ctx context.Context, key <span class=\"type\">string</span>, val <span class=\"type\">string</span>) <span class=\"type\">error</span></span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n<p>åœ¨æŸäº›å¤æ‚çš„æƒ…å†µä¸‹ï¼Œæˆ‘ä»¬è¿˜éœ€è¦å¯¹æ¥å£ä¸­æ–¹æ³•çš„å‚æ•°ç±»å‹è¿›è¡Œè°ƒæ•´ï¼Œä¸€ç§ä¸‡é‡‘æ²¹çš„æ–¹æ³•å°±æ˜¯<strong>å†å®šä¹‰ä¸€ä¸ª<code>Data</code>ç»“æ„ä½“</strong>ï¼Œåœ¨<code>Data</code>ç»“æ„ä½“ä¸­è®¾ç½®ä¸åŒåº•å±‚å®ç°æ‰€éœ€è¦çš„å­—æ®µ<br><br>ä¾‹å¦‚ï¼š</p>\n<figure class=\"highlight go\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">type</span> NameData <span class=\"keyword\">struct</span> &#123;</span><br><span class=\"line\">    Name <span class=\"type\">string</span></span><br><span class=\"line\">    Data <span class=\"type\">string</span></span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n\n<p>å®šä¹‰å¥½æ¥å£åï¼Œæˆ‘ä»¬è¿˜éœ€è¦å°†æ¥å£æš´éœ²ç»™<code>repository</code>ï¼Œå…·ä½“å®ç°å¦‚ä¸‹ï¼š</p>\n<figure class=\"highlight go\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">type</span> CodeRepository <span class=\"keyword\">struct</span> &#123;</span><br><span class=\"line\">\tcache cache.CodeCache</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n\n<h2 id=\"é€‰æ‹©ä¸€ä¸ªæœ¬åœ°ç¼“å­˜\"><a href=\"#é€‰æ‹©ä¸€ä¸ªæœ¬åœ°ç¼“å­˜\" class=\"headerlink\" title=\"é€‰æ‹©ä¸€ä¸ªæœ¬åœ°ç¼“å­˜\"></a>é€‰æ‹©ä¸€ä¸ªæœ¬åœ°ç¼“å­˜</h2><p>åœ¨Golangä¸­æœ‰ä¸‰ä¸ªæœ¬åœ°ç¼“å­˜åº“æ¯”è¾ƒæœ‰åï¼š<br><img src=\"https://raw.githubusercontent.com/lyydsheep/pic/main/202408051905419.png\" alt=\"image-20240805190511385\"><br><br>å…·ä½“é€‰æ‹©æ—¶åº”è€ƒè™‘ä¸€ä¸‹å‡ ç‚¹ï¼š</p>\n<ul>\n<li>ç»“åˆåœºæ™¯</li>\n<li>å¦‚æœéœ€è¦å¯¹å•ä¸ªkeyè®¾ç½®è¿‡æœŸæ—¶é—´ï¼Œé€‰æ‹©freecache</li>\n<li>å¦‚æœä¸æ³¨é‡å•ä¸ªkeyè¿‡æœŸæ—¶é—´ï¼Œæ›´æ³¨é‡æ€§èƒ½,é€‰æ‹©bigcache</li>\n</ul>\n<p>æŸ¥è¯¢å®˜æ–¹æ–‡æ¡£ï¼Œä¾¿èƒ½å¾ˆå®¹æ˜“åœ¨<code>CodeMemory</code>ç»“æ„ä½“ä¸Šå®ç°<code>CodeCache</code>æ¥å£</p>\n<h2 id=\"å¹¶å‘é—®é¢˜\"><a href=\"#å¹¶å‘é—®é¢˜\" class=\"headerlink\" title=\"å¹¶å‘é—®é¢˜\"></a>å¹¶å‘é—®é¢˜</h2><p>å¾ˆæ˜¾ç„¶ï¼Œä¸ç®¡æ˜¯è®¾ç½®éªŒè¯ç è¿˜æ˜¯æ ¡éªŒéªŒè¯ç ï¼Œéƒ½æ˜¯<code>check-do something</code>çš„æµç¨‹æ“ä½œï¼Œå­˜åœ¨æ˜æ˜¾çš„å¹¶å‘é—®é¢˜<br><br>åœ¨Rediså®ç°ä¸­ï¼Œå·§å¦™åœ°ä½¿ç”¨äº†<code>lua</code>è„šæœ¬ï¼Œå°†æ“ä½œæ•´åˆæˆä¸€ä¸ªåŸå­æ“ä½œã€‚ä½†æ˜¯åœ¨memoryå®ç°ä¸­ï¼Œæˆ‘ä»¬æ— æ³•é€šè¿‡ç±»ä¼¼çš„æ–¹å¼é¿å…å¹¶å‘é—®é¢˜ï¼Œå› æ­¤åªèƒ½æš´åŠ›ä¸Šé”ã€è§£é”æ¥ä¿è¯å¹¶å‘å®‰å…¨</p>\n"},{"publish":false,"_content":"\n# åˆ†å¸ƒå¼ç†è®ºåŸºç¡€\n\n## ä»€ä¹ˆæ˜¯åˆ†å¸ƒå¼ç³»ç»Ÿ\n\nåˆ†å¸ƒå¼ç³»ç»Ÿæ˜¯é›†ä¸­å¼ç³»ç»Ÿçš„å¯¹åº”é¢ï¼Œåœ¨æ˜ç¡®åˆ†å¸ƒå¼ç³»ç»Ÿå®šä¹‰ä¹‹å‰ï¼Œè®©æˆ‘ä»¬çœ‹çœ‹ä»€ä¹ˆæ˜¯é›†ä¸­å¼ç³»ç»Ÿ\n\n### é›†ä¸­å¼ç³»ç»Ÿ\n\né›†ä¸­å¼ç³»ç»Ÿé€šå¸¸æ˜¯ç”±ä¸€å°æ€§èƒ½è¶…å¼ºçš„è®¡ç®—æœºæ”¯æ’‘çš„ï¼Œç³»ç»Ÿæ‰€æœ‰çš„æ•°æ®é›†å’Œæ‰€æœ‰çš„ä¸šåŠ¡å•å…ƒéƒ½é›†ä¸­éƒ¨ç½²åœ¨è¿™ä¸ªä¸­å¿ƒèŠ‚ç‚¹ä¸Šï¼Œæ‰€æœ‰çš„ä¸šåŠ¡é€»è¾‘éƒ½æ˜¯åœ¨ä¸­å¿ƒèŠ‚ç‚¹ä¸Šå¤„ç†çš„\n\n![image-20240910191137362](https://raw.githubusercontent.com/lyydsheep/pic/main/202409101912496.png)\n\n#### ç‰¹ç‚¹\n\né›†ä¸­å¼ç³»ç»Ÿæœ€å¤§çš„ç‰¹ç‚¹å°±æ˜¯**ç»“æ„ç®€å•**ï¼Œå› ä¸ºç³»ç»Ÿæ‰€æœ‰çš„éƒ¨åˆ†éƒ½æ˜¯åœ¨è¿™ä¸€ä¸ªèŠ‚ç‚¹ä¸Šå®ç°çš„ï¼Œä¸éœ€è¦è€ƒè™‘å¤šä¸ªèŠ‚ç‚¹ä¹‹é—´çš„åä½œé—®é¢˜ã€‚\n\nä¹Ÿæ­£æ˜¯å› ä¸ºç³»ç»Ÿå•æœºéƒ¨ç½²ï¼Œå¯¼è‡´æ•´ä¸ªç³»ç»Ÿåºå¤§ä¸”å¤æ‚ï¼Œå¾ˆéš¾è¿›è¡Œæ‰©å±•ï¼ˆç‰µä¸€å‘è€ŒåŠ¨å…¨èº«ï¼‰ï¼Œå¹¶ä¸”è¿˜å­˜åœ¨å•ç‚¹æ•…éšœã€æ€§èƒ½å·®ç­‰é—®é¢˜ã€‚\n\n### åˆ†å¸ƒå¼ç³»ç»Ÿ\n\nåˆ†å¸ƒå¼ç³»ç»Ÿå°±æ˜¯ä¸ºè§£å†³é›†ä¸­å¼ç³»ç»Ÿçš„ç“¶é¢ˆè€Œç”Ÿçš„ã€‚åˆ†å¸ƒå¼ç³»ç»Ÿæ ¸å¿ƒæ€æƒ³å°±æ˜¯â€œåˆ†æ²»â€ï¼Œå°†å¤§é—®é¢˜æ‹†åˆ†æˆä¸€ä¸ªä¸€ä¸ªå°é—®é¢˜ï¼Œå°†ç³»ç»Ÿæ‹†åˆ†æˆä¸€ä¸ªä¸€ä¸ªå°æœåŠ¡å•å…ƒï¼Œåˆ†è€Œæ²»ä¹‹ã€‚æ¯ä¸€ä¸ªæœåŠ¡å•å…ƒåˆ†æ•£åˆ°ä¸åŒçš„ç½‘ç»œèŠ‚ç‚¹ä¸Šï¼Œå½¼æ­¤ä¹‹é—´åè°ƒæœåŠ¡ï¼Œå…±åŒå®Œæˆç³»ç»Ÿçš„æ•´ä½“åŠŸèƒ½ã€‚\n\n<img src=\"https://raw.githubusercontent.com/lyydsheep/pic/main/202409101929132.png\" alt=\"image-20240910192903084\" style=\"zoom: 67%;\" />\n\n\n\n#### ç‰¹ç‚¹\n\n- **åˆ†æ•£æ€§ï¼š**åˆ†å¸ƒå¼ç³»ç»Ÿä¸­çš„èŠ‚ç‚¹éƒ½æ˜¯ç‹¬ç«‹è¿è¡Œçš„ï¼Œå¹¶ä¸”å¯ä»¥åœ¨ç©ºé—´ä»»æ„åˆ†å¸ƒï¼Œè€Œä¸”å¯ä»¥éšæ—¶å˜åŠ¨ã€‚è¿™ç§åˆ†æ•£æ€§å¯ä»¥æœ‰æ•ˆçš„æé«˜åˆ†å¸ƒå¼ç³»ç»Ÿçš„å¯ç”¨æ€§å’Œä¼¸ç¼©æ€§ï¼Œå¹¶ä¸”å…·å¤‡å¾ˆå¼ºçš„å®¹é”™èƒ½åŠ›\n- **å¹¶å‘æ€§**ï¼šåˆ†å¸ƒå¼ç³»ç»Ÿä¸­æœ‰å¤šä¸ªè¿›ç¨‹å¹¶å‘è¿è¡Œï¼Œä»è€Œå®ç°æ›´é«˜çš„æ€§èƒ½\n- **å¼‚æ„æ€§**ï¼šåˆ†å¸ƒå¼ç³»ç»Ÿä¸­çš„èŠ‚ç‚¹å¯èƒ½å…·æœ‰ä¸åŒçš„ç¡¬ä»¶å’Œè½¯ä»¶èµ„æº\n- **å®¹é”™æ€§**ï¼šåˆ†å¸ƒå¼ç³»ç»Ÿå¯ä»¥é€šè¿‡å¤‡ä»½ã€å¤åˆ¶ä»¥åŠä¸€äº›å®¹é”™ç®—æ³•æ¥é¿å…å•ç‚¹æ•…éšœï¼Œæé«˜ç³»ç»Ÿçš„å¯é æ€§\n- **å¯æ‰©å±•æ€§**ï¼šåˆ†å¸ƒå¼ç³»ç»Ÿå¯ä»¥çµæ´»çš„å¢åŠ å’Œåˆ å‡ç³»ç»Ÿèµ„æºæ¥é€‚åº”ä¸åŒçš„ä¸šåŠ¡åœºæ™¯\n- **é€æ˜æ€§**ï¼šåˆ†å¸ƒå¼ç³»ç»Ÿå¯¹å¤–æ˜¯æ— æ„ŸçŸ¥çš„ï¼Œå¯¹ç”¨æˆ·è€Œè¨€ç³»ç»Ÿå°±æ˜¯ä¸€ä¸ªæ•´ä½“\n\n## å•æœºå’Œé›†ç¾¤ä»¥åŠåˆ†å¸ƒå¼çš„å…³ç³»\n\n### å•æœº\n\nå•æœºæ¶æ„æ¯”è¾ƒç®€å•ï¼Œå°±æ˜¯ç³»ç»Ÿçš„æ‰€æœ‰æœåŠ¡éƒ½è¿è¡Œåœ¨**åŒä¸€å°æœºå™¨ä¸Š**\n\n![image-20240917142802979](https://raw.githubusercontent.com/lyydsheep/pic/main/202409171428072.png)\n\n### é›†ç¾¤\n\nå•æœºæ¶æ„æ‰€æœ‰çš„æœåŠ¡éƒ½è¿è¡Œåœ¨ä¸€å°æœºå™¨ä¸Šï¼Œæœºå™¨çš„ç¡¬ä»¶èµ„æºå¾€å¾€æ˜¯æ€§èƒ½çš„ç“¶é¢ˆã€‚ä¸€ä¸ªå¾ˆç›´æ¥çš„æƒ³æ³•å°±æ˜¯ä¸€å°æœºå™¨ä¸è¡Œï¼Œé‚£å°±å¼•å…¥å¤šå°æœºå™¨ï¼Œè¿™å°±æ˜¯é›†ç¾¤æ¶æ„çš„åšæ³•ã€‚\n\næ‰€ä»¥é›†ç¾¤æ¶æ„å¯ä»¥ç®€å•ç†è§£ä¸ºæ˜¯**å¤šä¸ªå•æœºæ¶æ„ç»„æˆçš„**ï¼Œé›†ç¾¤ä¸­æ¯ä¸€å°æœºå™¨éƒ½æ˜¯ä¸€ä¸ªèŠ‚ç‚¹ï¼Œ**æ¯ä¸ªèŠ‚ç‚¹éƒ½æä¾›ç€ç›¸åŒçš„æœåŠ¡**\n\n![image-20240917143354503](https://raw.githubusercontent.com/lyydsheep/pic/main/202409171433611.png)\n\n### åˆ†å¸ƒå¼\n\né›†ç¾¤è™½ç„¶èƒ½å¤Ÿæœ‰æ•ˆè§£å†³å•æœºæ¶æ„çš„æ€§èƒ½ç“¶é¢ˆï¼Œä½†æ˜¯æ¯ä¸ªèŠ‚ç‚¹ä¸Šä¾æ—§è¿è¡Œç€æ‰€æœ‰çš„æœåŠ¡ï¼Œè€¦åˆåº¦å¤ªé«˜ï¼Œç»´æŠ¤èµ·æ¥æ¯”è¾ƒéº»çƒ¦ã€‚ä¸å¦‚ä»ä¸šåŠ¡åŠŸèƒ½è§’åº¦å‡ºå‘ï¼Œå°†æ¯ä¸ªä¸šåŠ¡åŠŸèƒ½æ‹†åˆ†æˆä¸€ä¸ªå®Œå…¨ç‹¬ç«‹çš„å­ç³»ç»Ÿï¼Œè¿™äº›å­ç³»ç»Ÿä¹‹é—´é€šè¿‡æ¶ˆæ¯ä¼ é€’è¿›è¡Œé€šä¿¡å’Œåè°ƒå·¥ä½œï¼Œå…±åŒæä¾›ä¸€ä¸ªå®Œæ•´çš„ç³»ç»ŸåŠŸèƒ½ã€‚\n\n![image-20240917144228241](https://raw.githubusercontent.com/lyydsheep/pic/main/202409171442369.png)\n\nä¸Šå›¾æ‰€ç¤ºå°±æ˜¯ä¸€ä¸ªåˆ†å¸ƒå¼ç³»ç»Ÿï¼Œå¹¶ä¸”æ˜¯ä¸€ä¸ªåˆ†å¸ƒå¼é›†ç¾¤ï¼Œå°†ç”µå•†ä¸šåŠ¡æ‹†æˆäº†å¤šä¸ªæœåŠ¡éƒ¨ç½²åˆ°äº†ä¸åŒçš„æœåŠ¡å™¨ä¸Šï¼Œå¹¶ä¸”è®¢å•æœåŠ¡ï¼Œç‰©æµæœåŠ¡ï¼Œè¿˜æœ‰å•†å“æœåŠ¡éƒ½æ˜¯é›†ç¾¤åŒ–éƒ¨ç½²ï¼Œéƒ¨ç½²äº†å¤šä»½ã€‚å½“ç„¶è¿™ä¸ªä¾‹å­åªæ˜¯ä¸ºäº†è¯´æ˜åˆ†å¸ƒå¼å’Œé›†ç¾¤çš„å…³ç³»ï¼Œç°åœ¨çœŸæ­£çš„ä¸šåŠ¡åœºæ™¯ä¸€èˆ¬ä¸ä¼šè¿™æ ·éƒ¨ç½²äº†ï¼Œä¸ä¼šä¸€å°æœåŠ¡å™¨éƒ¨ç½²ä¸€ä¸ªåº”ç”¨æœåŠ¡ï¼Œéƒ½æ˜¯å®¹å™¨åŒ–å¤šå®ä¾‹éƒ¨ç½²\n\n\n\nå•æœºã€é›†ç¾¤ã€åˆ†å¸ƒå¼ã€å¾®æœåŠ¡\n\nåˆ†å¸ƒå¼ä¼˜ç‚¹\n\n\n\n\n\nCAPç†è®º\n\næ•°æ®ä¸€è‡´æ€§ï¼ˆCï¼‰\n\nå¯ç”¨æ€§ï¼ˆAï¼‰\n\nåˆ†åŒºå®¹é”™æ€§ï¼ˆPï¼‰\n\n\n\nè¦ä¹ˆCPè¦ä¹ˆAP","source":"_posts/åˆ†å¸ƒå¼ç†è®ºåŸºç¡€.md","raw":"---\npublish: false\n---\n\n# åˆ†å¸ƒå¼ç†è®ºåŸºç¡€\n\n## ä»€ä¹ˆæ˜¯åˆ†å¸ƒå¼ç³»ç»Ÿ\n\nåˆ†å¸ƒå¼ç³»ç»Ÿæ˜¯é›†ä¸­å¼ç³»ç»Ÿçš„å¯¹åº”é¢ï¼Œåœ¨æ˜ç¡®åˆ†å¸ƒå¼ç³»ç»Ÿå®šä¹‰ä¹‹å‰ï¼Œè®©æˆ‘ä»¬çœ‹çœ‹ä»€ä¹ˆæ˜¯é›†ä¸­å¼ç³»ç»Ÿ\n\n### é›†ä¸­å¼ç³»ç»Ÿ\n\né›†ä¸­å¼ç³»ç»Ÿé€šå¸¸æ˜¯ç”±ä¸€å°æ€§èƒ½è¶…å¼ºçš„è®¡ç®—æœºæ”¯æ’‘çš„ï¼Œç³»ç»Ÿæ‰€æœ‰çš„æ•°æ®é›†å’Œæ‰€æœ‰çš„ä¸šåŠ¡å•å…ƒéƒ½é›†ä¸­éƒ¨ç½²åœ¨è¿™ä¸ªä¸­å¿ƒèŠ‚ç‚¹ä¸Šï¼Œæ‰€æœ‰çš„ä¸šåŠ¡é€»è¾‘éƒ½æ˜¯åœ¨ä¸­å¿ƒèŠ‚ç‚¹ä¸Šå¤„ç†çš„\n\n![image-20240910191137362](https://raw.githubusercontent.com/lyydsheep/pic/main/202409101912496.png)\n\n#### ç‰¹ç‚¹\n\né›†ä¸­å¼ç³»ç»Ÿæœ€å¤§çš„ç‰¹ç‚¹å°±æ˜¯**ç»“æ„ç®€å•**ï¼Œå› ä¸ºç³»ç»Ÿæ‰€æœ‰çš„éƒ¨åˆ†éƒ½æ˜¯åœ¨è¿™ä¸€ä¸ªèŠ‚ç‚¹ä¸Šå®ç°çš„ï¼Œä¸éœ€è¦è€ƒè™‘å¤šä¸ªèŠ‚ç‚¹ä¹‹é—´çš„åä½œé—®é¢˜ã€‚\n\nä¹Ÿæ­£æ˜¯å› ä¸ºç³»ç»Ÿå•æœºéƒ¨ç½²ï¼Œå¯¼è‡´æ•´ä¸ªç³»ç»Ÿåºå¤§ä¸”å¤æ‚ï¼Œå¾ˆéš¾è¿›è¡Œæ‰©å±•ï¼ˆç‰µä¸€å‘è€ŒåŠ¨å…¨èº«ï¼‰ï¼Œå¹¶ä¸”è¿˜å­˜åœ¨å•ç‚¹æ•…éšœã€æ€§èƒ½å·®ç­‰é—®é¢˜ã€‚\n\n### åˆ†å¸ƒå¼ç³»ç»Ÿ\n\nåˆ†å¸ƒå¼ç³»ç»Ÿå°±æ˜¯ä¸ºè§£å†³é›†ä¸­å¼ç³»ç»Ÿçš„ç“¶é¢ˆè€Œç”Ÿçš„ã€‚åˆ†å¸ƒå¼ç³»ç»Ÿæ ¸å¿ƒæ€æƒ³å°±æ˜¯â€œåˆ†æ²»â€ï¼Œå°†å¤§é—®é¢˜æ‹†åˆ†æˆä¸€ä¸ªä¸€ä¸ªå°é—®é¢˜ï¼Œå°†ç³»ç»Ÿæ‹†åˆ†æˆä¸€ä¸ªä¸€ä¸ªå°æœåŠ¡å•å…ƒï¼Œåˆ†è€Œæ²»ä¹‹ã€‚æ¯ä¸€ä¸ªæœåŠ¡å•å…ƒåˆ†æ•£åˆ°ä¸åŒçš„ç½‘ç»œèŠ‚ç‚¹ä¸Šï¼Œå½¼æ­¤ä¹‹é—´åè°ƒæœåŠ¡ï¼Œå…±åŒå®Œæˆç³»ç»Ÿçš„æ•´ä½“åŠŸèƒ½ã€‚\n\n<img src=\"https://raw.githubusercontent.com/lyydsheep/pic/main/202409101929132.png\" alt=\"image-20240910192903084\" style=\"zoom: 67%;\" />\n\n\n\n#### ç‰¹ç‚¹\n\n- **åˆ†æ•£æ€§ï¼š**åˆ†å¸ƒå¼ç³»ç»Ÿä¸­çš„èŠ‚ç‚¹éƒ½æ˜¯ç‹¬ç«‹è¿è¡Œçš„ï¼Œå¹¶ä¸”å¯ä»¥åœ¨ç©ºé—´ä»»æ„åˆ†å¸ƒï¼Œè€Œä¸”å¯ä»¥éšæ—¶å˜åŠ¨ã€‚è¿™ç§åˆ†æ•£æ€§å¯ä»¥æœ‰æ•ˆçš„æé«˜åˆ†å¸ƒå¼ç³»ç»Ÿçš„å¯ç”¨æ€§å’Œä¼¸ç¼©æ€§ï¼Œå¹¶ä¸”å…·å¤‡å¾ˆå¼ºçš„å®¹é”™èƒ½åŠ›\n- **å¹¶å‘æ€§**ï¼šåˆ†å¸ƒå¼ç³»ç»Ÿä¸­æœ‰å¤šä¸ªè¿›ç¨‹å¹¶å‘è¿è¡Œï¼Œä»è€Œå®ç°æ›´é«˜çš„æ€§èƒ½\n- **å¼‚æ„æ€§**ï¼šåˆ†å¸ƒå¼ç³»ç»Ÿä¸­çš„èŠ‚ç‚¹å¯èƒ½å…·æœ‰ä¸åŒçš„ç¡¬ä»¶å’Œè½¯ä»¶èµ„æº\n- **å®¹é”™æ€§**ï¼šåˆ†å¸ƒå¼ç³»ç»Ÿå¯ä»¥é€šè¿‡å¤‡ä»½ã€å¤åˆ¶ä»¥åŠä¸€äº›å®¹é”™ç®—æ³•æ¥é¿å…å•ç‚¹æ•…éšœï¼Œæé«˜ç³»ç»Ÿçš„å¯é æ€§\n- **å¯æ‰©å±•æ€§**ï¼šåˆ†å¸ƒå¼ç³»ç»Ÿå¯ä»¥çµæ´»çš„å¢åŠ å’Œåˆ å‡ç³»ç»Ÿèµ„æºæ¥é€‚åº”ä¸åŒçš„ä¸šåŠ¡åœºæ™¯\n- **é€æ˜æ€§**ï¼šåˆ†å¸ƒå¼ç³»ç»Ÿå¯¹å¤–æ˜¯æ— æ„ŸçŸ¥çš„ï¼Œå¯¹ç”¨æˆ·è€Œè¨€ç³»ç»Ÿå°±æ˜¯ä¸€ä¸ªæ•´ä½“\n\n## å•æœºå’Œé›†ç¾¤ä»¥åŠåˆ†å¸ƒå¼çš„å…³ç³»\n\n### å•æœº\n\nå•æœºæ¶æ„æ¯”è¾ƒç®€å•ï¼Œå°±æ˜¯ç³»ç»Ÿçš„æ‰€æœ‰æœåŠ¡éƒ½è¿è¡Œåœ¨**åŒä¸€å°æœºå™¨ä¸Š**\n\n![image-20240917142802979](https://raw.githubusercontent.com/lyydsheep/pic/main/202409171428072.png)\n\n### é›†ç¾¤\n\nå•æœºæ¶æ„æ‰€æœ‰çš„æœåŠ¡éƒ½è¿è¡Œåœ¨ä¸€å°æœºå™¨ä¸Šï¼Œæœºå™¨çš„ç¡¬ä»¶èµ„æºå¾€å¾€æ˜¯æ€§èƒ½çš„ç“¶é¢ˆã€‚ä¸€ä¸ªå¾ˆç›´æ¥çš„æƒ³æ³•å°±æ˜¯ä¸€å°æœºå™¨ä¸è¡Œï¼Œé‚£å°±å¼•å…¥å¤šå°æœºå™¨ï¼Œè¿™å°±æ˜¯é›†ç¾¤æ¶æ„çš„åšæ³•ã€‚\n\næ‰€ä»¥é›†ç¾¤æ¶æ„å¯ä»¥ç®€å•ç†è§£ä¸ºæ˜¯**å¤šä¸ªå•æœºæ¶æ„ç»„æˆçš„**ï¼Œé›†ç¾¤ä¸­æ¯ä¸€å°æœºå™¨éƒ½æ˜¯ä¸€ä¸ªèŠ‚ç‚¹ï¼Œ**æ¯ä¸ªèŠ‚ç‚¹éƒ½æä¾›ç€ç›¸åŒçš„æœåŠ¡**\n\n![image-20240917143354503](https://raw.githubusercontent.com/lyydsheep/pic/main/202409171433611.png)\n\n### åˆ†å¸ƒå¼\n\né›†ç¾¤è™½ç„¶èƒ½å¤Ÿæœ‰æ•ˆè§£å†³å•æœºæ¶æ„çš„æ€§èƒ½ç“¶é¢ˆï¼Œä½†æ˜¯æ¯ä¸ªèŠ‚ç‚¹ä¸Šä¾æ—§è¿è¡Œç€æ‰€æœ‰çš„æœåŠ¡ï¼Œè€¦åˆåº¦å¤ªé«˜ï¼Œç»´æŠ¤èµ·æ¥æ¯”è¾ƒéº»çƒ¦ã€‚ä¸å¦‚ä»ä¸šåŠ¡åŠŸèƒ½è§’åº¦å‡ºå‘ï¼Œå°†æ¯ä¸ªä¸šåŠ¡åŠŸèƒ½æ‹†åˆ†æˆä¸€ä¸ªå®Œå…¨ç‹¬ç«‹çš„å­ç³»ç»Ÿï¼Œè¿™äº›å­ç³»ç»Ÿä¹‹é—´é€šè¿‡æ¶ˆæ¯ä¼ é€’è¿›è¡Œé€šä¿¡å’Œåè°ƒå·¥ä½œï¼Œå…±åŒæä¾›ä¸€ä¸ªå®Œæ•´çš„ç³»ç»ŸåŠŸèƒ½ã€‚\n\n![image-20240917144228241](https://raw.githubusercontent.com/lyydsheep/pic/main/202409171442369.png)\n\nä¸Šå›¾æ‰€ç¤ºå°±æ˜¯ä¸€ä¸ªåˆ†å¸ƒå¼ç³»ç»Ÿï¼Œå¹¶ä¸”æ˜¯ä¸€ä¸ªåˆ†å¸ƒå¼é›†ç¾¤ï¼Œå°†ç”µå•†ä¸šåŠ¡æ‹†æˆäº†å¤šä¸ªæœåŠ¡éƒ¨ç½²åˆ°äº†ä¸åŒçš„æœåŠ¡å™¨ä¸Šï¼Œå¹¶ä¸”è®¢å•æœåŠ¡ï¼Œç‰©æµæœåŠ¡ï¼Œè¿˜æœ‰å•†å“æœåŠ¡éƒ½æ˜¯é›†ç¾¤åŒ–éƒ¨ç½²ï¼Œéƒ¨ç½²äº†å¤šä»½ã€‚å½“ç„¶è¿™ä¸ªä¾‹å­åªæ˜¯ä¸ºäº†è¯´æ˜åˆ†å¸ƒå¼å’Œé›†ç¾¤çš„å…³ç³»ï¼Œç°åœ¨çœŸæ­£çš„ä¸šåŠ¡åœºæ™¯ä¸€èˆ¬ä¸ä¼šè¿™æ ·éƒ¨ç½²äº†ï¼Œä¸ä¼šä¸€å°æœåŠ¡å™¨éƒ¨ç½²ä¸€ä¸ªåº”ç”¨æœåŠ¡ï¼Œéƒ½æ˜¯å®¹å™¨åŒ–å¤šå®ä¾‹éƒ¨ç½²\n\n\n\nå•æœºã€é›†ç¾¤ã€åˆ†å¸ƒå¼ã€å¾®æœåŠ¡\n\nåˆ†å¸ƒå¼ä¼˜ç‚¹\n\n\n\n\n\nCAPç†è®º\n\næ•°æ®ä¸€è‡´æ€§ï¼ˆCï¼‰\n\nå¯ç”¨æ€§ï¼ˆAï¼‰\n\nåˆ†åŒºå®¹é”™æ€§ï¼ˆPï¼‰\n\n\n\nè¦ä¹ˆCPè¦ä¹ˆAP","slug":"åˆ†å¸ƒå¼ç†è®ºåŸºç¡€","published":1,"date":"2024-12-27T11:03:15.344Z","updated":"2024-12-27T11:03:15.344Z","title":"","comments":1,"layout":"post","photos":[],"_id":"cm6c7md6i000ra5t24g8d9o27","content":"<h1 id=\"åˆ†å¸ƒå¼ç†è®ºåŸºç¡€\"><a href=\"#åˆ†å¸ƒå¼ç†è®ºåŸºç¡€\" class=\"headerlink\" title=\"åˆ†å¸ƒå¼ç†è®ºåŸºç¡€\"></a>åˆ†å¸ƒå¼ç†è®ºåŸºç¡€</h1><h2 id=\"ä»€ä¹ˆæ˜¯åˆ†å¸ƒå¼ç³»ç»Ÿ\"><a href=\"#ä»€ä¹ˆæ˜¯åˆ†å¸ƒå¼ç³»ç»Ÿ\" class=\"headerlink\" title=\"ä»€ä¹ˆæ˜¯åˆ†å¸ƒå¼ç³»ç»Ÿ\"></a>ä»€ä¹ˆæ˜¯åˆ†å¸ƒå¼ç³»ç»Ÿ</h2><p>åˆ†å¸ƒå¼ç³»ç»Ÿæ˜¯é›†ä¸­å¼ç³»ç»Ÿçš„å¯¹åº”é¢ï¼Œåœ¨æ˜ç¡®åˆ†å¸ƒå¼ç³»ç»Ÿå®šä¹‰ä¹‹å‰ï¼Œè®©æˆ‘ä»¬çœ‹çœ‹ä»€ä¹ˆæ˜¯é›†ä¸­å¼ç³»ç»Ÿ</p>\n<h3 id=\"é›†ä¸­å¼ç³»ç»Ÿ\"><a href=\"#é›†ä¸­å¼ç³»ç»Ÿ\" class=\"headerlink\" title=\"é›†ä¸­å¼ç³»ç»Ÿ\"></a>é›†ä¸­å¼ç³»ç»Ÿ</h3><p>é›†ä¸­å¼ç³»ç»Ÿé€šå¸¸æ˜¯ç”±ä¸€å°æ€§èƒ½è¶…å¼ºçš„è®¡ç®—æœºæ”¯æ’‘çš„ï¼Œç³»ç»Ÿæ‰€æœ‰çš„æ•°æ®é›†å’Œæ‰€æœ‰çš„ä¸šåŠ¡å•å…ƒéƒ½é›†ä¸­éƒ¨ç½²åœ¨è¿™ä¸ªä¸­å¿ƒèŠ‚ç‚¹ä¸Šï¼Œæ‰€æœ‰çš„ä¸šåŠ¡é€»è¾‘éƒ½æ˜¯åœ¨ä¸­å¿ƒèŠ‚ç‚¹ä¸Šå¤„ç†çš„</p>\n<p><img src=\"https://raw.githubusercontent.com/lyydsheep/pic/main/202409101912496.png\" alt=\"image-20240910191137362\"></p>\n<h4 id=\"ç‰¹ç‚¹\"><a href=\"#ç‰¹ç‚¹\" class=\"headerlink\" title=\"ç‰¹ç‚¹\"></a>ç‰¹ç‚¹</h4><p>é›†ä¸­å¼ç³»ç»Ÿæœ€å¤§çš„ç‰¹ç‚¹å°±æ˜¯<strong>ç»“æ„ç®€å•</strong>ï¼Œå› ä¸ºç³»ç»Ÿæ‰€æœ‰çš„éƒ¨åˆ†éƒ½æ˜¯åœ¨è¿™ä¸€ä¸ªèŠ‚ç‚¹ä¸Šå®ç°çš„ï¼Œä¸éœ€è¦è€ƒè™‘å¤šä¸ªèŠ‚ç‚¹ä¹‹é—´çš„åä½œé—®é¢˜ã€‚</p>\n<p>ä¹Ÿæ­£æ˜¯å› ä¸ºç³»ç»Ÿå•æœºéƒ¨ç½²ï¼Œå¯¼è‡´æ•´ä¸ªç³»ç»Ÿåºå¤§ä¸”å¤æ‚ï¼Œå¾ˆéš¾è¿›è¡Œæ‰©å±•ï¼ˆç‰µä¸€å‘è€ŒåŠ¨å…¨èº«ï¼‰ï¼Œå¹¶ä¸”è¿˜å­˜åœ¨å•ç‚¹æ•…éšœã€æ€§èƒ½å·®ç­‰é—®é¢˜ã€‚</p>\n<h3 id=\"åˆ†å¸ƒå¼ç³»ç»Ÿ\"><a href=\"#åˆ†å¸ƒå¼ç³»ç»Ÿ\" class=\"headerlink\" title=\"åˆ†å¸ƒå¼ç³»ç»Ÿ\"></a>åˆ†å¸ƒå¼ç³»ç»Ÿ</h3><p>åˆ†å¸ƒå¼ç³»ç»Ÿå°±æ˜¯ä¸ºè§£å†³é›†ä¸­å¼ç³»ç»Ÿçš„ç“¶é¢ˆè€Œç”Ÿçš„ã€‚åˆ†å¸ƒå¼ç³»ç»Ÿæ ¸å¿ƒæ€æƒ³å°±æ˜¯â€œåˆ†æ²»â€ï¼Œå°†å¤§é—®é¢˜æ‹†åˆ†æˆä¸€ä¸ªä¸€ä¸ªå°é—®é¢˜ï¼Œå°†ç³»ç»Ÿæ‹†åˆ†æˆä¸€ä¸ªä¸€ä¸ªå°æœåŠ¡å•å…ƒï¼Œåˆ†è€Œæ²»ä¹‹ã€‚æ¯ä¸€ä¸ªæœåŠ¡å•å…ƒåˆ†æ•£åˆ°ä¸åŒçš„ç½‘ç»œèŠ‚ç‚¹ä¸Šï¼Œå½¼æ­¤ä¹‹é—´åè°ƒæœåŠ¡ï¼Œå…±åŒå®Œæˆç³»ç»Ÿçš„æ•´ä½“åŠŸèƒ½ã€‚</p>\n<img src=\"https://raw.githubusercontent.com/lyydsheep/pic/main/202409101929132.png\" alt=\"image-20240910192903084\" style=\"zoom: 67%;\" />\n\n\n\n<h4 id=\"ç‰¹ç‚¹-1\"><a href=\"#ç‰¹ç‚¹-1\" class=\"headerlink\" title=\"ç‰¹ç‚¹\"></a>ç‰¹ç‚¹</h4><ul>\n<li><strong>åˆ†æ•£æ€§ï¼š</strong>åˆ†å¸ƒå¼ç³»ç»Ÿä¸­çš„èŠ‚ç‚¹éƒ½æ˜¯ç‹¬ç«‹è¿è¡Œçš„ï¼Œå¹¶ä¸”å¯ä»¥åœ¨ç©ºé—´ä»»æ„åˆ†å¸ƒï¼Œè€Œä¸”å¯ä»¥éšæ—¶å˜åŠ¨ã€‚è¿™ç§åˆ†æ•£æ€§å¯ä»¥æœ‰æ•ˆçš„æé«˜åˆ†å¸ƒå¼ç³»ç»Ÿçš„å¯ç”¨æ€§å’Œä¼¸ç¼©æ€§ï¼Œå¹¶ä¸”å…·å¤‡å¾ˆå¼ºçš„å®¹é”™èƒ½åŠ›</li>\n<li><strong>å¹¶å‘æ€§</strong>ï¼šåˆ†å¸ƒå¼ç³»ç»Ÿä¸­æœ‰å¤šä¸ªè¿›ç¨‹å¹¶å‘è¿è¡Œï¼Œä»è€Œå®ç°æ›´é«˜çš„æ€§èƒ½</li>\n<li><strong>å¼‚æ„æ€§</strong>ï¼šåˆ†å¸ƒå¼ç³»ç»Ÿä¸­çš„èŠ‚ç‚¹å¯èƒ½å…·æœ‰ä¸åŒçš„ç¡¬ä»¶å’Œè½¯ä»¶èµ„æº</li>\n<li><strong>å®¹é”™æ€§</strong>ï¼šåˆ†å¸ƒå¼ç³»ç»Ÿå¯ä»¥é€šè¿‡å¤‡ä»½ã€å¤åˆ¶ä»¥åŠä¸€äº›å®¹é”™ç®—æ³•æ¥é¿å…å•ç‚¹æ•…éšœï¼Œæé«˜ç³»ç»Ÿçš„å¯é æ€§</li>\n<li><strong>å¯æ‰©å±•æ€§</strong>ï¼šåˆ†å¸ƒå¼ç³»ç»Ÿå¯ä»¥çµæ´»çš„å¢åŠ å’Œåˆ å‡ç³»ç»Ÿèµ„æºæ¥é€‚åº”ä¸åŒçš„ä¸šåŠ¡åœºæ™¯</li>\n<li><strong>é€æ˜æ€§</strong>ï¼šåˆ†å¸ƒå¼ç³»ç»Ÿå¯¹å¤–æ˜¯æ— æ„ŸçŸ¥çš„ï¼Œå¯¹ç”¨æˆ·è€Œè¨€ç³»ç»Ÿå°±æ˜¯ä¸€ä¸ªæ•´ä½“</li>\n</ul>\n<h2 id=\"å•æœºå’Œé›†ç¾¤ä»¥åŠåˆ†å¸ƒå¼çš„å…³ç³»\"><a href=\"#å•æœºå’Œé›†ç¾¤ä»¥åŠåˆ†å¸ƒå¼çš„å…³ç³»\" class=\"headerlink\" title=\"å•æœºå’Œé›†ç¾¤ä»¥åŠåˆ†å¸ƒå¼çš„å…³ç³»\"></a>å•æœºå’Œé›†ç¾¤ä»¥åŠåˆ†å¸ƒå¼çš„å…³ç³»</h2><h3 id=\"å•æœº\"><a href=\"#å•æœº\" class=\"headerlink\" title=\"å•æœº\"></a>å•æœº</h3><p>å•æœºæ¶æ„æ¯”è¾ƒç®€å•ï¼Œå°±æ˜¯ç³»ç»Ÿçš„æ‰€æœ‰æœåŠ¡éƒ½è¿è¡Œåœ¨<strong>åŒä¸€å°æœºå™¨ä¸Š</strong></p>\n<p><img src=\"https://raw.githubusercontent.com/lyydsheep/pic/main/202409171428072.png\" alt=\"image-20240917142802979\"></p>\n<h3 id=\"é›†ç¾¤\"><a href=\"#é›†ç¾¤\" class=\"headerlink\" title=\"é›†ç¾¤\"></a>é›†ç¾¤</h3><p>å•æœºæ¶æ„æ‰€æœ‰çš„æœåŠ¡éƒ½è¿è¡Œåœ¨ä¸€å°æœºå™¨ä¸Šï¼Œæœºå™¨çš„ç¡¬ä»¶èµ„æºå¾€å¾€æ˜¯æ€§èƒ½çš„ç“¶é¢ˆã€‚ä¸€ä¸ªå¾ˆç›´æ¥çš„æƒ³æ³•å°±æ˜¯ä¸€å°æœºå™¨ä¸è¡Œï¼Œé‚£å°±å¼•å…¥å¤šå°æœºå™¨ï¼Œè¿™å°±æ˜¯é›†ç¾¤æ¶æ„çš„åšæ³•ã€‚</p>\n<p>æ‰€ä»¥é›†ç¾¤æ¶æ„å¯ä»¥ç®€å•ç†è§£ä¸ºæ˜¯<strong>å¤šä¸ªå•æœºæ¶æ„ç»„æˆçš„</strong>ï¼Œé›†ç¾¤ä¸­æ¯ä¸€å°æœºå™¨éƒ½æ˜¯ä¸€ä¸ªèŠ‚ç‚¹ï¼Œ<strong>æ¯ä¸ªèŠ‚ç‚¹éƒ½æä¾›ç€ç›¸åŒçš„æœåŠ¡</strong></p>\n<p><img src=\"https://raw.githubusercontent.com/lyydsheep/pic/main/202409171433611.png\" alt=\"image-20240917143354503\"></p>\n<h3 id=\"åˆ†å¸ƒå¼\"><a href=\"#åˆ†å¸ƒå¼\" class=\"headerlink\" title=\"åˆ†å¸ƒå¼\"></a>åˆ†å¸ƒå¼</h3><p>é›†ç¾¤è™½ç„¶èƒ½å¤Ÿæœ‰æ•ˆè§£å†³å•æœºæ¶æ„çš„æ€§èƒ½ç“¶é¢ˆï¼Œä½†æ˜¯æ¯ä¸ªèŠ‚ç‚¹ä¸Šä¾æ—§è¿è¡Œç€æ‰€æœ‰çš„æœåŠ¡ï¼Œè€¦åˆåº¦å¤ªé«˜ï¼Œç»´æŠ¤èµ·æ¥æ¯”è¾ƒéº»çƒ¦ã€‚ä¸å¦‚ä»ä¸šåŠ¡åŠŸèƒ½è§’åº¦å‡ºå‘ï¼Œå°†æ¯ä¸ªä¸šåŠ¡åŠŸèƒ½æ‹†åˆ†æˆä¸€ä¸ªå®Œå…¨ç‹¬ç«‹çš„å­ç³»ç»Ÿï¼Œè¿™äº›å­ç³»ç»Ÿä¹‹é—´é€šè¿‡æ¶ˆæ¯ä¼ é€’è¿›è¡Œé€šä¿¡å’Œåè°ƒå·¥ä½œï¼Œå…±åŒæä¾›ä¸€ä¸ªå®Œæ•´çš„ç³»ç»ŸåŠŸèƒ½ã€‚</p>\n<p><img src=\"https://raw.githubusercontent.com/lyydsheep/pic/main/202409171442369.png\" alt=\"image-20240917144228241\"></p>\n<p>ä¸Šå›¾æ‰€ç¤ºå°±æ˜¯ä¸€ä¸ªåˆ†å¸ƒå¼ç³»ç»Ÿï¼Œå¹¶ä¸”æ˜¯ä¸€ä¸ªåˆ†å¸ƒå¼é›†ç¾¤ï¼Œå°†ç”µå•†ä¸šåŠ¡æ‹†æˆäº†å¤šä¸ªæœåŠ¡éƒ¨ç½²åˆ°äº†ä¸åŒçš„æœåŠ¡å™¨ä¸Šï¼Œå¹¶ä¸”è®¢å•æœåŠ¡ï¼Œç‰©æµæœåŠ¡ï¼Œè¿˜æœ‰å•†å“æœåŠ¡éƒ½æ˜¯é›†ç¾¤åŒ–éƒ¨ç½²ï¼Œéƒ¨ç½²äº†å¤šä»½ã€‚å½“ç„¶è¿™ä¸ªä¾‹å­åªæ˜¯ä¸ºäº†è¯´æ˜åˆ†å¸ƒå¼å’Œé›†ç¾¤çš„å…³ç³»ï¼Œç°åœ¨çœŸæ­£çš„ä¸šåŠ¡åœºæ™¯ä¸€èˆ¬ä¸ä¼šè¿™æ ·éƒ¨ç½²äº†ï¼Œä¸ä¼šä¸€å°æœåŠ¡å™¨éƒ¨ç½²ä¸€ä¸ªåº”ç”¨æœåŠ¡ï¼Œéƒ½æ˜¯å®¹å™¨åŒ–å¤šå®ä¾‹éƒ¨ç½²</p>\n<p>å•æœºã€é›†ç¾¤ã€åˆ†å¸ƒå¼ã€å¾®æœåŠ¡</p>\n<p>åˆ†å¸ƒå¼ä¼˜ç‚¹</p>\n<p>CAPç†è®º</p>\n<p>æ•°æ®ä¸€è‡´æ€§ï¼ˆCï¼‰</p>\n<p>å¯ç”¨æ€§ï¼ˆAï¼‰</p>\n<p>åˆ†åŒºå®¹é”™æ€§ï¼ˆPï¼‰</p>\n<p>è¦ä¹ˆCPè¦ä¹ˆAP</p>\n","excerpt":"","more":"<h1 id=\"åˆ†å¸ƒå¼ç†è®ºåŸºç¡€\"><a href=\"#åˆ†å¸ƒå¼ç†è®ºåŸºç¡€\" class=\"headerlink\" title=\"åˆ†å¸ƒå¼ç†è®ºåŸºç¡€\"></a>åˆ†å¸ƒå¼ç†è®ºåŸºç¡€</h1><h2 id=\"ä»€ä¹ˆæ˜¯åˆ†å¸ƒå¼ç³»ç»Ÿ\"><a href=\"#ä»€ä¹ˆæ˜¯åˆ†å¸ƒå¼ç³»ç»Ÿ\" class=\"headerlink\" title=\"ä»€ä¹ˆæ˜¯åˆ†å¸ƒå¼ç³»ç»Ÿ\"></a>ä»€ä¹ˆæ˜¯åˆ†å¸ƒå¼ç³»ç»Ÿ</h2><p>åˆ†å¸ƒå¼ç³»ç»Ÿæ˜¯é›†ä¸­å¼ç³»ç»Ÿçš„å¯¹åº”é¢ï¼Œåœ¨æ˜ç¡®åˆ†å¸ƒå¼ç³»ç»Ÿå®šä¹‰ä¹‹å‰ï¼Œè®©æˆ‘ä»¬çœ‹çœ‹ä»€ä¹ˆæ˜¯é›†ä¸­å¼ç³»ç»Ÿ</p>\n<h3 id=\"é›†ä¸­å¼ç³»ç»Ÿ\"><a href=\"#é›†ä¸­å¼ç³»ç»Ÿ\" class=\"headerlink\" title=\"é›†ä¸­å¼ç³»ç»Ÿ\"></a>é›†ä¸­å¼ç³»ç»Ÿ</h3><p>é›†ä¸­å¼ç³»ç»Ÿé€šå¸¸æ˜¯ç”±ä¸€å°æ€§èƒ½è¶…å¼ºçš„è®¡ç®—æœºæ”¯æ’‘çš„ï¼Œç³»ç»Ÿæ‰€æœ‰çš„æ•°æ®é›†å’Œæ‰€æœ‰çš„ä¸šåŠ¡å•å…ƒéƒ½é›†ä¸­éƒ¨ç½²åœ¨è¿™ä¸ªä¸­å¿ƒèŠ‚ç‚¹ä¸Šï¼Œæ‰€æœ‰çš„ä¸šåŠ¡é€»è¾‘éƒ½æ˜¯åœ¨ä¸­å¿ƒèŠ‚ç‚¹ä¸Šå¤„ç†çš„</p>\n<p><img src=\"https://raw.githubusercontent.com/lyydsheep/pic/main/202409101912496.png\" alt=\"image-20240910191137362\"></p>\n<h4 id=\"ç‰¹ç‚¹\"><a href=\"#ç‰¹ç‚¹\" class=\"headerlink\" title=\"ç‰¹ç‚¹\"></a>ç‰¹ç‚¹</h4><p>é›†ä¸­å¼ç³»ç»Ÿæœ€å¤§çš„ç‰¹ç‚¹å°±æ˜¯<strong>ç»“æ„ç®€å•</strong>ï¼Œå› ä¸ºç³»ç»Ÿæ‰€æœ‰çš„éƒ¨åˆ†éƒ½æ˜¯åœ¨è¿™ä¸€ä¸ªèŠ‚ç‚¹ä¸Šå®ç°çš„ï¼Œä¸éœ€è¦è€ƒè™‘å¤šä¸ªèŠ‚ç‚¹ä¹‹é—´çš„åä½œé—®é¢˜ã€‚</p>\n<p>ä¹Ÿæ­£æ˜¯å› ä¸ºç³»ç»Ÿå•æœºéƒ¨ç½²ï¼Œå¯¼è‡´æ•´ä¸ªç³»ç»Ÿåºå¤§ä¸”å¤æ‚ï¼Œå¾ˆéš¾è¿›è¡Œæ‰©å±•ï¼ˆç‰µä¸€å‘è€ŒåŠ¨å…¨èº«ï¼‰ï¼Œå¹¶ä¸”è¿˜å­˜åœ¨å•ç‚¹æ•…éšœã€æ€§èƒ½å·®ç­‰é—®é¢˜ã€‚</p>\n<h3 id=\"åˆ†å¸ƒå¼ç³»ç»Ÿ\"><a href=\"#åˆ†å¸ƒå¼ç³»ç»Ÿ\" class=\"headerlink\" title=\"åˆ†å¸ƒå¼ç³»ç»Ÿ\"></a>åˆ†å¸ƒå¼ç³»ç»Ÿ</h3><p>åˆ†å¸ƒå¼ç³»ç»Ÿå°±æ˜¯ä¸ºè§£å†³é›†ä¸­å¼ç³»ç»Ÿçš„ç“¶é¢ˆè€Œç”Ÿçš„ã€‚åˆ†å¸ƒå¼ç³»ç»Ÿæ ¸å¿ƒæ€æƒ³å°±æ˜¯â€œåˆ†æ²»â€ï¼Œå°†å¤§é—®é¢˜æ‹†åˆ†æˆä¸€ä¸ªä¸€ä¸ªå°é—®é¢˜ï¼Œå°†ç³»ç»Ÿæ‹†åˆ†æˆä¸€ä¸ªä¸€ä¸ªå°æœåŠ¡å•å…ƒï¼Œåˆ†è€Œæ²»ä¹‹ã€‚æ¯ä¸€ä¸ªæœåŠ¡å•å…ƒåˆ†æ•£åˆ°ä¸åŒçš„ç½‘ç»œèŠ‚ç‚¹ä¸Šï¼Œå½¼æ­¤ä¹‹é—´åè°ƒæœåŠ¡ï¼Œå…±åŒå®Œæˆç³»ç»Ÿçš„æ•´ä½“åŠŸèƒ½ã€‚</p>\n<img src=\"https://raw.githubusercontent.com/lyydsheep/pic/main/202409101929132.png\" alt=\"image-20240910192903084\" style=\"zoom: 67%;\" />\n\n\n\n<h4 id=\"ç‰¹ç‚¹-1\"><a href=\"#ç‰¹ç‚¹-1\" class=\"headerlink\" title=\"ç‰¹ç‚¹\"></a>ç‰¹ç‚¹</h4><ul>\n<li><strong>åˆ†æ•£æ€§ï¼š</strong>åˆ†å¸ƒå¼ç³»ç»Ÿä¸­çš„èŠ‚ç‚¹éƒ½æ˜¯ç‹¬ç«‹è¿è¡Œçš„ï¼Œå¹¶ä¸”å¯ä»¥åœ¨ç©ºé—´ä»»æ„åˆ†å¸ƒï¼Œè€Œä¸”å¯ä»¥éšæ—¶å˜åŠ¨ã€‚è¿™ç§åˆ†æ•£æ€§å¯ä»¥æœ‰æ•ˆçš„æé«˜åˆ†å¸ƒå¼ç³»ç»Ÿçš„å¯ç”¨æ€§å’Œä¼¸ç¼©æ€§ï¼Œå¹¶ä¸”å…·å¤‡å¾ˆå¼ºçš„å®¹é”™èƒ½åŠ›</li>\n<li><strong>å¹¶å‘æ€§</strong>ï¼šåˆ†å¸ƒå¼ç³»ç»Ÿä¸­æœ‰å¤šä¸ªè¿›ç¨‹å¹¶å‘è¿è¡Œï¼Œä»è€Œå®ç°æ›´é«˜çš„æ€§èƒ½</li>\n<li><strong>å¼‚æ„æ€§</strong>ï¼šåˆ†å¸ƒå¼ç³»ç»Ÿä¸­çš„èŠ‚ç‚¹å¯èƒ½å…·æœ‰ä¸åŒçš„ç¡¬ä»¶å’Œè½¯ä»¶èµ„æº</li>\n<li><strong>å®¹é”™æ€§</strong>ï¼šåˆ†å¸ƒå¼ç³»ç»Ÿå¯ä»¥é€šè¿‡å¤‡ä»½ã€å¤åˆ¶ä»¥åŠä¸€äº›å®¹é”™ç®—æ³•æ¥é¿å…å•ç‚¹æ•…éšœï¼Œæé«˜ç³»ç»Ÿçš„å¯é æ€§</li>\n<li><strong>å¯æ‰©å±•æ€§</strong>ï¼šåˆ†å¸ƒå¼ç³»ç»Ÿå¯ä»¥çµæ´»çš„å¢åŠ å’Œåˆ å‡ç³»ç»Ÿèµ„æºæ¥é€‚åº”ä¸åŒçš„ä¸šåŠ¡åœºæ™¯</li>\n<li><strong>é€æ˜æ€§</strong>ï¼šåˆ†å¸ƒå¼ç³»ç»Ÿå¯¹å¤–æ˜¯æ— æ„ŸçŸ¥çš„ï¼Œå¯¹ç”¨æˆ·è€Œè¨€ç³»ç»Ÿå°±æ˜¯ä¸€ä¸ªæ•´ä½“</li>\n</ul>\n<h2 id=\"å•æœºå’Œé›†ç¾¤ä»¥åŠåˆ†å¸ƒå¼çš„å…³ç³»\"><a href=\"#å•æœºå’Œé›†ç¾¤ä»¥åŠåˆ†å¸ƒå¼çš„å…³ç³»\" class=\"headerlink\" title=\"å•æœºå’Œé›†ç¾¤ä»¥åŠåˆ†å¸ƒå¼çš„å…³ç³»\"></a>å•æœºå’Œé›†ç¾¤ä»¥åŠåˆ†å¸ƒå¼çš„å…³ç³»</h2><h3 id=\"å•æœº\"><a href=\"#å•æœº\" class=\"headerlink\" title=\"å•æœº\"></a>å•æœº</h3><p>å•æœºæ¶æ„æ¯”è¾ƒç®€å•ï¼Œå°±æ˜¯ç³»ç»Ÿçš„æ‰€æœ‰æœåŠ¡éƒ½è¿è¡Œåœ¨<strong>åŒä¸€å°æœºå™¨ä¸Š</strong></p>\n<p><img src=\"https://raw.githubusercontent.com/lyydsheep/pic/main/202409171428072.png\" alt=\"image-20240917142802979\"></p>\n<h3 id=\"é›†ç¾¤\"><a href=\"#é›†ç¾¤\" class=\"headerlink\" title=\"é›†ç¾¤\"></a>é›†ç¾¤</h3><p>å•æœºæ¶æ„æ‰€æœ‰çš„æœåŠ¡éƒ½è¿è¡Œåœ¨ä¸€å°æœºå™¨ä¸Šï¼Œæœºå™¨çš„ç¡¬ä»¶èµ„æºå¾€å¾€æ˜¯æ€§èƒ½çš„ç“¶é¢ˆã€‚ä¸€ä¸ªå¾ˆç›´æ¥çš„æƒ³æ³•å°±æ˜¯ä¸€å°æœºå™¨ä¸è¡Œï¼Œé‚£å°±å¼•å…¥å¤šå°æœºå™¨ï¼Œè¿™å°±æ˜¯é›†ç¾¤æ¶æ„çš„åšæ³•ã€‚</p>\n<p>æ‰€ä»¥é›†ç¾¤æ¶æ„å¯ä»¥ç®€å•ç†è§£ä¸ºæ˜¯<strong>å¤šä¸ªå•æœºæ¶æ„ç»„æˆçš„</strong>ï¼Œé›†ç¾¤ä¸­æ¯ä¸€å°æœºå™¨éƒ½æ˜¯ä¸€ä¸ªèŠ‚ç‚¹ï¼Œ<strong>æ¯ä¸ªèŠ‚ç‚¹éƒ½æä¾›ç€ç›¸åŒçš„æœåŠ¡</strong></p>\n<p><img src=\"https://raw.githubusercontent.com/lyydsheep/pic/main/202409171433611.png\" alt=\"image-20240917143354503\"></p>\n<h3 id=\"åˆ†å¸ƒå¼\"><a href=\"#åˆ†å¸ƒå¼\" class=\"headerlink\" title=\"åˆ†å¸ƒå¼\"></a>åˆ†å¸ƒå¼</h3><p>é›†ç¾¤è™½ç„¶èƒ½å¤Ÿæœ‰æ•ˆè§£å†³å•æœºæ¶æ„çš„æ€§èƒ½ç“¶é¢ˆï¼Œä½†æ˜¯æ¯ä¸ªèŠ‚ç‚¹ä¸Šä¾æ—§è¿è¡Œç€æ‰€æœ‰çš„æœåŠ¡ï¼Œè€¦åˆåº¦å¤ªé«˜ï¼Œç»´æŠ¤èµ·æ¥æ¯”è¾ƒéº»çƒ¦ã€‚ä¸å¦‚ä»ä¸šåŠ¡åŠŸèƒ½è§’åº¦å‡ºå‘ï¼Œå°†æ¯ä¸ªä¸šåŠ¡åŠŸèƒ½æ‹†åˆ†æˆä¸€ä¸ªå®Œå…¨ç‹¬ç«‹çš„å­ç³»ç»Ÿï¼Œè¿™äº›å­ç³»ç»Ÿä¹‹é—´é€šè¿‡æ¶ˆæ¯ä¼ é€’è¿›è¡Œé€šä¿¡å’Œåè°ƒå·¥ä½œï¼Œå…±åŒæä¾›ä¸€ä¸ªå®Œæ•´çš„ç³»ç»ŸåŠŸèƒ½ã€‚</p>\n<p><img src=\"https://raw.githubusercontent.com/lyydsheep/pic/main/202409171442369.png\" alt=\"image-20240917144228241\"></p>\n<p>ä¸Šå›¾æ‰€ç¤ºå°±æ˜¯ä¸€ä¸ªåˆ†å¸ƒå¼ç³»ç»Ÿï¼Œå¹¶ä¸”æ˜¯ä¸€ä¸ªåˆ†å¸ƒå¼é›†ç¾¤ï¼Œå°†ç”µå•†ä¸šåŠ¡æ‹†æˆäº†å¤šä¸ªæœåŠ¡éƒ¨ç½²åˆ°äº†ä¸åŒçš„æœåŠ¡å™¨ä¸Šï¼Œå¹¶ä¸”è®¢å•æœåŠ¡ï¼Œç‰©æµæœåŠ¡ï¼Œè¿˜æœ‰å•†å“æœåŠ¡éƒ½æ˜¯é›†ç¾¤åŒ–éƒ¨ç½²ï¼Œéƒ¨ç½²äº†å¤šä»½ã€‚å½“ç„¶è¿™ä¸ªä¾‹å­åªæ˜¯ä¸ºäº†è¯´æ˜åˆ†å¸ƒå¼å’Œé›†ç¾¤çš„å…³ç³»ï¼Œç°åœ¨çœŸæ­£çš„ä¸šåŠ¡åœºæ™¯ä¸€èˆ¬ä¸ä¼šè¿™æ ·éƒ¨ç½²äº†ï¼Œä¸ä¼šä¸€å°æœåŠ¡å™¨éƒ¨ç½²ä¸€ä¸ªåº”ç”¨æœåŠ¡ï¼Œéƒ½æ˜¯å®¹å™¨åŒ–å¤šå®ä¾‹éƒ¨ç½²</p>\n<p>å•æœºã€é›†ç¾¤ã€åˆ†å¸ƒå¼ã€å¾®æœåŠ¡</p>\n<p>åˆ†å¸ƒå¼ä¼˜ç‚¹</p>\n<p>CAPç†è®º</p>\n<p>æ•°æ®ä¸€è‡´æ€§ï¼ˆCï¼‰</p>\n<p>å¯ç”¨æ€§ï¼ˆAï¼‰</p>\n<p>åˆ†åŒºå®¹é”™æ€§ï¼ˆPï¼‰</p>\n<p>è¦ä¹ˆCPè¦ä¹ˆAP</p>\n"},{"publish":false,"date":"2024-12-12T16:00:00.000Z","_content":"## åŒæ­¥ä¸å¼‚æ­¥\n\nåŒæ­¥ï¼šè°ƒç”¨æ–¹å‘èµ·è¯·æ±‚ï¼Œç„¶åç­‰å¾…æœåŠ¡ç«¯æ‰§è¡Œå®Œä»»åŠ¡å›åŒ…\nå¼‚æ­¥ï¼šå‘èµ·è€…è°ƒç”¨è¯·æ±‚æ¥å£ï¼Œä»»åŠ¡å¼‚æ­¥å¤„ç†ï¼Œå‘èµ·è€…å¯¹ç»“æœè¿›è¡Œè½®è¯¢\n\n\n## è®°å½•ä¸€äº›é—®é¢˜\n- ä¸ºä»€ä¹ˆé…ç½®è¦å­˜åœ¨DBï¼Œè€Œä¸æ˜¯é‡‡ç”¨Viperæˆ–è€…etcdï¼Ÿ\n\t- å¹¶å‘é—®é¢˜ï¼Ÿ\n\n\n## æœ‰æ„æ€çš„ç‚¹\n- å•ä½“åº”ç”¨ä¸Šå‡è‡³åˆ†å¸ƒå¼åº”ç”¨ï¼Œè€ƒè™‘é—®é¢˜\n- ç›¸å¯¹ä¼˜å…ˆçº§ï¼Œè§£è€¦ã€å–æ¶ˆè”åˆç´¢å¼•","source":"_posts/å¼‚æ­¥æ¡†æ¶.md","raw":"---\npublish: false\ntags:\n  - é¡¹ç›®\ndate: 2024-12-13\n---\n## åŒæ­¥ä¸å¼‚æ­¥\n\nåŒæ­¥ï¼šè°ƒç”¨æ–¹å‘èµ·è¯·æ±‚ï¼Œç„¶åç­‰å¾…æœåŠ¡ç«¯æ‰§è¡Œå®Œä»»åŠ¡å›åŒ…\nå¼‚æ­¥ï¼šå‘èµ·è€…è°ƒç”¨è¯·æ±‚æ¥å£ï¼Œä»»åŠ¡å¼‚æ­¥å¤„ç†ï¼Œå‘èµ·è€…å¯¹ç»“æœè¿›è¡Œè½®è¯¢\n\n\n## è®°å½•ä¸€äº›é—®é¢˜\n- ä¸ºä»€ä¹ˆé…ç½®è¦å­˜åœ¨DBï¼Œè€Œä¸æ˜¯é‡‡ç”¨Viperæˆ–è€…etcdï¼Ÿ\n\t- å¹¶å‘é—®é¢˜ï¼Ÿ\n\n\n## æœ‰æ„æ€çš„ç‚¹\n- å•ä½“åº”ç”¨ä¸Šå‡è‡³åˆ†å¸ƒå¼åº”ç”¨ï¼Œè€ƒè™‘é—®é¢˜\n- ç›¸å¯¹ä¼˜å…ˆçº§ï¼Œè§£è€¦ã€å–æ¶ˆè”åˆç´¢å¼•","slug":"å¼‚æ­¥æ¡†æ¶","published":1,"updated":"2024-12-27T11:03:15.344Z","title":"","comments":1,"layout":"post","photos":[],"_id":"cm6c7md6j000ta5t26mn0f4ae","content":"<h2 id=\"åŒæ­¥ä¸å¼‚æ­¥\"><a href=\"#åŒæ­¥ä¸å¼‚æ­¥\" class=\"headerlink\" title=\"åŒæ­¥ä¸å¼‚æ­¥\"></a>åŒæ­¥ä¸å¼‚æ­¥</h2><p>åŒæ­¥ï¼šè°ƒç”¨æ–¹å‘èµ·è¯·æ±‚ï¼Œç„¶åç­‰å¾…æœåŠ¡ç«¯æ‰§è¡Œå®Œä»»åŠ¡å›åŒ…<br>å¼‚æ­¥ï¼šå‘èµ·è€…è°ƒç”¨è¯·æ±‚æ¥å£ï¼Œä»»åŠ¡å¼‚æ­¥å¤„ç†ï¼Œå‘èµ·è€…å¯¹ç»“æœè¿›è¡Œè½®è¯¢</p>\n<h2 id=\"è®°å½•ä¸€äº›é—®é¢˜\"><a href=\"#è®°å½•ä¸€äº›é—®é¢˜\" class=\"headerlink\" title=\"è®°å½•ä¸€äº›é—®é¢˜\"></a>è®°å½•ä¸€äº›é—®é¢˜</h2><ul>\n<li>ä¸ºä»€ä¹ˆé…ç½®è¦å­˜åœ¨DBï¼Œè€Œä¸æ˜¯é‡‡ç”¨Viperæˆ–è€…etcdï¼Ÿ<ul>\n<li>å¹¶å‘é—®é¢˜ï¼Ÿ</li>\n</ul>\n</li>\n</ul>\n<h2 id=\"æœ‰æ„æ€çš„ç‚¹\"><a href=\"#æœ‰æ„æ€çš„ç‚¹\" class=\"headerlink\" title=\"æœ‰æ„æ€çš„ç‚¹\"></a>æœ‰æ„æ€çš„ç‚¹</h2><ul>\n<li>å•ä½“åº”ç”¨ä¸Šå‡è‡³åˆ†å¸ƒå¼åº”ç”¨ï¼Œè€ƒè™‘é—®é¢˜</li>\n<li>ç›¸å¯¹ä¼˜å…ˆçº§ï¼Œè§£è€¦ã€å–æ¶ˆè”åˆç´¢å¼•</li>\n</ul>\n","excerpt":"","more":"<h2 id=\"åŒæ­¥ä¸å¼‚æ­¥\"><a href=\"#åŒæ­¥ä¸å¼‚æ­¥\" class=\"headerlink\" title=\"åŒæ­¥ä¸å¼‚æ­¥\"></a>åŒæ­¥ä¸å¼‚æ­¥</h2><p>åŒæ­¥ï¼šè°ƒç”¨æ–¹å‘èµ·è¯·æ±‚ï¼Œç„¶åç­‰å¾…æœåŠ¡ç«¯æ‰§è¡Œå®Œä»»åŠ¡å›åŒ…<br>å¼‚æ­¥ï¼šå‘èµ·è€…è°ƒç”¨è¯·æ±‚æ¥å£ï¼Œä»»åŠ¡å¼‚æ­¥å¤„ç†ï¼Œå‘èµ·è€…å¯¹ç»“æœè¿›è¡Œè½®è¯¢</p>\n<h2 id=\"è®°å½•ä¸€äº›é—®é¢˜\"><a href=\"#è®°å½•ä¸€äº›é—®é¢˜\" class=\"headerlink\" title=\"è®°å½•ä¸€äº›é—®é¢˜\"></a>è®°å½•ä¸€äº›é—®é¢˜</h2><ul>\n<li>ä¸ºä»€ä¹ˆé…ç½®è¦å­˜åœ¨DBï¼Œè€Œä¸æ˜¯é‡‡ç”¨Viperæˆ–è€…etcdï¼Ÿ<ul>\n<li>å¹¶å‘é—®é¢˜ï¼Ÿ</li>\n</ul>\n</li>\n</ul>\n<h2 id=\"æœ‰æ„æ€çš„ç‚¹\"><a href=\"#æœ‰æ„æ€çš„ç‚¹\" class=\"headerlink\" title=\"æœ‰æ„æ€çš„ç‚¹\"></a>æœ‰æ„æ€çš„ç‚¹</h2><ul>\n<li>å•ä½“åº”ç”¨ä¸Šå‡è‡³åˆ†å¸ƒå¼åº”ç”¨ï¼Œè€ƒè™‘é—®é¢˜</li>\n<li>ç›¸å¯¹ä¼˜å…ˆçº§ï¼Œè§£è€¦ã€å–æ¶ˆè”åˆç´¢å¼•</li>\n</ul>\n"},{"title":"å‘å¸–åŠŸèƒ½å®ç°","publish":true,"description":"TDDä»¥åŠç¼“å­˜æ–¹æ¡ˆ","sticky":2,"_content":"\n# å‘å¸–åŠŸèƒ½å®ç°\n\n## éœ€æ±‚åˆ†æ\n\n### ç”¨ä¾‹\n\n> é€šè¿‡ä½¿ç”¨ç”¨ä¾‹æ¥å±•ç¤ºæŸä¸ªéœ€æ±‚çš„å…·ä½“ä½¿ç”¨åœºæ™¯\n\n<img src=\"https://raw.githubusercontent.com/lyydsheep/pic/main/202409092129324.png\" width=300>\n\n- åˆ›ä½œè€…\n  - å¢åˆ æ”¹æŸ¥\n- è¯»è€…\n  - æŸ¥\n\n### å†…å®¹çš„å¯è§æ€§\n\n> åˆ›ä½œè€…åˆ›ä½œäº†ä¸€ç¯‡æ–‡ç« ï¼Œé‚£ä¹ˆè¿™ç¯‡æ–‡ç« ä»€ä¹ˆæƒ…å†µä¸‹å¯ä»¥è¢«è¯»è€…çœ‹åˆ°å‘¢ï¼Ÿ\n\næ ¹æ®ç”Ÿæ´»ç»éªŒï¼Œå¯ä»¥å¾ˆå®¹æ˜“æƒ³åˆ°ï¼šä¸€ç¯‡æ–‡ç« åªæœ‰åœ¨å‘è¡¨ï¼ˆé€šè¿‡å®¡æ ¸ï¼‰å¹¶ä¸”å¤„äºå…¬å¼€çŠ¶æ€ä¸‹æ‰èƒ½è¢«ç”¨æˆ·æ‰€çœ‹åˆ°ã€‚å¦‚æ­¤ï¼Œä¸€ç¯‡å¸–å­å°±æœ‰äº†å‘è¡¨å’Œæœªå‘è¡¨ä¸¤ä¸ªçŠ¶æ€ï¼Œæˆ‘ä»¬å¯ä»¥å¾ˆè½»æ¾åœ°å¾—å‡ºä¸€ç¯‡å¸–å­çš„**çŠ¶æ€**è½¬æ¢å›¾\n\n![image-20240909214045416](https://raw.githubusercontent.com/lyydsheep/pic/main/202409092140450.png)\n\næƒ³è±¡è¿™ä¹ˆä¸€ä¸ªåœºæ™¯ï¼Œç”¨æˆ·æ­£åœ¨æµè§ˆæ–‡ç« ï¼Œä¸æ­¤åŒæ—¶ä½œè€…ä¹Ÿåœ¨ä¿®æ”¹æ–‡ç« ï¼Œé‚£ä¹ˆç”¨æˆ·ä¼šå®æ—¶çœ‹åˆ°ä½œè€…çš„ä¿®æ”¹å—ï¼Ÿ\n\nè¿™å½“ç„¶ä¸ä¼šï¼Œåœ¨åˆ›ä½œè€…å‘å¸ƒä¹‹å‰ï¼Œè¿™äº›ä¿®æ”¹å¯¹è¯»è€…éƒ½æ˜¯ä¸å¯è§çš„\n\nä¸€ç§å¾ˆæ˜¾ç„¶çš„è§£å†³åŠæ³•å°±æ˜¯**åˆ†å¼€å­˜å‚¨**ï¼Œå³ä¸€ä¸ª**åˆ¶ä½œè¡¨**ï¼Œä¸€ä¸ª**çº¿ä¸Šè¡¨**\n\nç”¨æˆ·çœ‹åˆ°çš„æ˜¯çº¿ä¸Šè¡¨ä¸­çš„æ•°æ®ï¼Œè€Œä½œè€…ä¿®æ”¹çš„éƒ½æ˜¯åˆ¶ä½œè¡¨ä¸­çš„æ•°æ®ï¼Œè¿™æ ·ä½œè€…çš„ä¿®æ”¹å¯¹äºç”¨æˆ·è€Œè¨€éƒ½æ˜¯ä¸å¯çŸ¥çš„ï¼Œåªæœ‰å½“çº¿ä¸Šè¡¨æ›´æ–°åï¼Œç”¨æˆ·æ‰èƒ½çœ‹åˆ°ä¿®æ”¹\n\næ•´ç†ä¸Šè¿°åˆ†æï¼Œå¯ä»¥å¾—åˆ°æ›´è¯¦ç»†çš„çŠ¶æ€å›¾ï¼š\n\n![image-20240910200443544](https://raw.githubusercontent.com/lyydsheep/pic/main/202409102004630.png)\n\n### æµç¨‹åˆ†æ\n\næˆ‘ä»¬å°†ä¸¤ä¸ªè¡¨ï¼ˆåˆ¶ä½œè¡¨ã€çº¿ä¸Šè¡¨ï¼‰çš„çŠ¶æ€ï¼Œåˆ†åˆ«ç”¨ä¸€ä½äºŒè¿›åˆ¶è¡¨ç¤ºï¼Œå¯ä»¥å¾—å‡º3ä¸­èµ·å§‹çŠ¶æ€ï¼ˆæœ‰ä¸€ç§çŠ¶æ€ä¸å¯èƒ½å­˜åœ¨ï¼‰\n\n- 0 0ï¼šåˆ¶ä½œè¡¨å’Œçº¿ä¸Šè¡¨éƒ½æ²¡æœ‰æ•°æ®\n- 1 0ï¼šåªæœ‰åˆ¶ä½œè¡¨ä¸­æœ‰æ•°æ®\n- 1 1ï¼šåˆ¶ä½œè¡¨å’Œçº¿ä¸Šè¡¨éƒ½æœ‰æ•°æ®\n\nåˆ†ææ¯ä¸€ç§èµ·å§‹çŠ¶æ€å¯èƒ½çš„åç»­çŠ¶æ€\n\n- 0 0\n  - 1 0ï¼šä½œè€…å†™äº†ä¸€åŠï¼Œæœ¨æœ‰å‘è¡¨\n  - 1 1ï¼šä½œè€…å†™å¥½å¹¶å‘è¡¨äº†æ–‡ç« \n  - ![image-20240910201425755](https://raw.githubusercontent.com/lyydsheep/pic/main/202409102014800.png)\n- 1 0\n  - 1 1ï¼šä½œè€…å†™å¥½å¹¶å‘è¡¨äº†æ–‡ç« \n  - ![image-20240910201456526](https://raw.githubusercontent.com/lyydsheep/pic/main/202409102014565.png)\n- 1 1\n  - 1 1ï¼šä½œè€…ä¿®æ”¹æ–‡ç« \n  - ![image-20240910202622396](https://raw.githubusercontent.com/lyydsheep/pic/main/202409102026434.png)\n\n## TDDä¸ç¼–è¾‘æ¥å£\n\n**TDDï¼šæµ‹è¯•é©±åŠ¨å¼€å‘ï¼Œå…ˆå†™æµ‹è¯•ï¼Œå†å†™å®ç°**\n\n- é€šè¿‡æ’°å†™æµ‹è¯•ï¼Œ**ç†æ¸…æ¥šæ¥å£è¯¥å¦‚ä½•å®šä¹‰ï¼Œç«™åœ¨ç”¨æˆ·çš„è§’åº¦çœ‹æ˜¯å¦åˆé€‚**\n- é€šè¿‡æ’°å†™æµ‹è¯•ç”¨ä¾‹ï¼Œ**ç†æ¸…æ¥šæ•´ä¸ªåŠŸèƒ½è¦è€ƒè™‘çš„ä¸»æµç¨‹ã€å¼‚å¸¸æµç¨‹**\n\n### æ ¸å¿ƒå¾ªç¯\n\n- æ ¹æ®å¯¹éœ€æ±‚çš„ç†è§£ï¼Œ**åˆæ­¥å®šä¹‰æ¥å£**ï¼Œæ— æ‰€è°“æ¥å£åˆä¸åˆé€‚ï¼Œåæ­£è¿˜å¾—æ”¹\n- æ ¹æ®æ¥å£å®šä¹‰æµ‹è¯•\n- æ‰§è¡Œæ ¸å¿ƒå¾ªç¯\n  - å¢åŠ æµ‹è¯•ç”¨ä¾‹\n  - æä¾›/ä¿®æ”¹å®ç°\n  - æ‰§è¡Œæµ‹è¯•ç”¨ä¾‹\n\n<img src=\"https://raw.githubusercontent.com/lyydsheep/pic/main/202409161517114.png\" alt=\"image-20240916151718031\" style=\"zoom:67%;\" />\n\n### suiteæµ‹è¯•ç»„ç»‡å¥—ä»¶\n\n[å‚è€ƒæ–‡ç« ](https://annatarhe.github.io/2020/08/19/how-to-do-test-in-go.html)\n\næœ‰çš„æ—¶å€™åœ¨æµ‹è¯•ä¹‹å‰éœ€è¦è¿æ¥dbã€redisã€rpcä¹‹ç±»çš„ä¸œè¥¿ï¼Œç„¶åå†æµ‹è¯•ç»“æŸåå°†è¿™äº›è¿æ¥å…³é—­ã€‚ä¹Ÿå°±æ˜¯è¯´ï¼Œæˆ‘ä»¬çš„å•å…ƒï¼ˆé›†æˆï¼‰æµ‹è¯•å…·æœ‰**ç”Ÿå‘½å‘¨æœŸ**ã€‚å¦‚æœæ˜¯æ‰‹åŠ¨ç¼–å†™è¿æ¥ã€å…³é—­è¿æ¥çš„ä»£ç ä¼šä½¿å¾—æµ‹è¯•éƒ¨åˆ†æ˜¾å¾—å¼‚å¸¸è‡ƒè‚¿ï¼Œå¥½åœ¨æœ‰`suite`å¯ä»¥å¸®åŠ©æˆ‘ä»¬æœ‰æ•ˆåœ°ç®¡ç†æµ‹è¯•çš„ç”Ÿå‘½å‘¨æœŸ\n\n```go\nimport (\n    \"testing\"\n    \"github.com/stretchr/testify/assert\"\n    \"github.com/stretchr/testify/suite\"\n)\n\n// å®šä¹‰æµ‹è¯•ç»“æ„ä½“\ntype ExampleTestSuite struct {\n    suite.Suite\n    msg string\n}\n\n// æµ‹è¯•å‰çš„é¢„å¤‡\nfunc (suite *ExampleTestSuite) SetupTest() {\n    suite.msg = \"iu is my wife\"\n    db, _ = sql.Open(\"xxx\")\n}\n\n// æµ‹è¯•\nfunc (suite *ExampleTestSuite) TestExample() {\n    m := &obj{\n        Msg: suite.msg\n    }\n    err := insert(m)\n    assert.Nil(suite.T(), err)\n    assert.Equal(suite.T(), suite.msg, m.Msg)\n}\n\n// æµ‹è¯•åçš„æ¸…ç†\nfunc (suite *ExampleTestSuite) TearDownTest() {\n    db.Close()\n}\n\n// å…¥å£\nfunc TestExampleTestSuite(t *testing.T) {\n    suite.Run(t, new(ExampleTestSuite))\n}\n```\n\näº”ä¸ªæ­¥éª¤\n\n- **å®šä¹‰æµ‹è¯•ç»“æ„ä½“**\n  - æµ‹è¯•ç»“æ„ä½“ä¸­åº”åŒ…å«æ‰€éœ€è¦çš„ç¬¬ä¸‰æ–¹å­—æ®µï¼Œä¾‹å¦‚`suite.Suite`,`gorm.DB`, `redis.Cmdable`ç­‰\n- **å…¥å£å‡½æ•°**\n  - `func TestExampleTestSuite(t *testing.T)`\n  - å‡½æ•°ä½“ä¸­ä»…æœ‰`suite.Run(t, new(xxx))`ä¸€è¡Œä»£ç \n- **æµ‹è¯•å‰çš„å‡†å¤‡å·¥ä½œ**\n  - `func (suite *ExampleTestSuite) SetupTest()`\n- æµ‹è¯•\n  - `func (suite *ExampleTestSuite) TestExample()`\n- **æµ‹è¯•åçš„æ¸…ç†**\n  - `func (suite *ExampleTestSuite) TearDownTest()`\n\n### TDDé›†æˆæµ‹è¯•å®è·µï¼ˆä¸€ï¼‰\n\n```go\n// æµ‹è¯•å¥—ä»¶\ntype ArticleSuite struct {\n\tsuite.Suite\n\tserver *gin.Engine\n\tdb     *gorm.DB\n\tl      *zap.Logger\n}\n\n// SetupTest éƒ½ç”¨startupé‡Œçš„åˆå§‹åŒ–æ–¹æ³•ï¼Œå½“ç„¶ä½¿ç”¨wireç”Ÿæˆå•¦\nfunc (s *ArticleSuite) SetupTest() {\n\tvar err error\n\ts.l, err = zap.NewDevelopment()\n\tif err != nil {\n\t\tpanic(err)\n\t}\n\ts.db = startup.InitDB(s.l)\n\tgin.SetMode(gin.ReleaseMode)\n\ts.server = gin.Default()\n\t// åœ¨è¿™é‡Œæ”¾å¥½userClaimsï¼Œè¡¨ç¤ºç™»å½•çŠ¶æ€\n\ts.server.Use(func(ctx *gin.Context) {\n\t\tctx.Set(\"userClaims\", jwt.UserClaims{\n\t\t\tUserId: 123,\n\t\t})\n\t})\n\tartHdl := startup.InitArticleHandler()\n\tartHdl.RegisterRoutes(s.server)\n}\n\nfunc (s *ArticleSuite) TestEdit() {\n\tt := s.T()\n\ttestCases := []struct {\n\t\tname string\n\t\t// å‡†å¤‡æ•°æ®\n\t\tbefore func(t *testing.T)\n\t\t// æ ¡éªŒæ•°æ®\n\t\tafter   func(t *testing.T)\n\t\tarticle Article\n\t\t// é¢„æœŸæ•°æ®\n\t\texpectCode int\n\t\texpectRes  Result[int]\n\t}{\n\t\t{\n\t\t\tname: \"æ–°å»ºå¸–å­â€”â€”ä¿å­˜æˆåŠŸ\",\n\t\t\tbefore: func(t *testing.T) {\n\n\t\t\t},\n\t\t\tafter: func(t *testing.T) {\n\t\t\t\t// å¯¹æ¯ä¸€åˆ—æ•°æ®éƒ½è¦è¿›è¡Œæ£€éªŒ\n\t\t\t\tvar article dao.Article\n\t\t\t\terr := s.db.Where(\"id=?\", 1).First(&article).Error\n\t\t\t\trequire.NoError(t, err)\n\t\t\t\tassert.True(t, article.Ctime > 0)\n\t\t\t\tassert.True(t, article.Utime > 0)\n\t\t\t\tarticle.Ctime = 0\n\t\t\t\tarticle.Utime = 0\n\t\t\t\tassert.Equal(t, dao.Article{\n\t\t\t\t\tId:       1,\n\t\t\t\t\tTitle:    \"è¿™æ˜¯æ ‡é¢˜\",\n\t\t\t\t\tContent:  \"è¿™æ˜¯å†…å®¹\",\n\t\t\t\t\tAuthorId: 123,\n\t\t\t\t}, article)\n\t\t\t},\n            article: Article{\n                Title: \"è¿™æ˜¯æ ‡é¢˜\",\n                Content: \"è¿™æ˜¯å†…å®¹\",\n            }\n\t\t\texpectCode: http.StatusOK,\n\t\t\texpectRes: Result[int]{\n\t\t\t\tData: 1,\n\t\t\t},\n\t\t},\n\t}\n\tfor _, tc := range testCases {\n\t\tt.Run(tc.name, func(t *testing.T) {\n\t\t\t//tc.before(t)\n\t\t\t// ä»¥jsonæ ¼å¼è¾“å…¥\n\t\t\tarticleJson, err := json.Marshal(tc.article)\n\t\t\trequire.NoError(t, err)\n\t\t\treq, err := http.NewRequest(http.MethodPost, \"/article/edit\", bytes.NewBuffer(articleJson))\n\t\t\treq.Header.Set(\"Content-Type\", \"application/json\")\n\t\t\trequire.NoError(t, err)\n\t\t\tresp := httptest.NewRecorder()\n\t\t\ts.server.ServeHTTP(resp, req)\n\t\t\tvar res Result[int]\n\t\t\tassert.Equal(t, tc.expectCode, resp.Code)\n\t\t\terr = json.NewDecoder(resp.Body).Decode(&res)\n\t\t\tassert.Equal(t, tc.expectRes, res)\n\t\t\t//tc.after(t)\n\t\t})\n\t}\n}\n\n// æµ‹è¯•åæ‰€ä½œçš„åŠ¨ä½œ\nfunc (s *ArticleSuite) TearDownTest() {\n\ts.db.Exec(\"truncate table articles\")\n}\n\nfunc TestArticleSuite(t *testing.T) {\n\tsuite.Run(t, new(ArticleSuite))\n}\n\ntype Article struct {\n\tTitle   string `json:\"title\"`\n\tContent string `json:\"content\"`\n}\n\ntype Result[T any] struct {\n\tMsg  string `json:\"msg\"`\n\tCode int    `json:\"code\"`\n\tData T      `json:\"data\"`\n}\n\n```\n\n- DDDä¾§é‡äºè®¾è®¡æ¶æ„ã€é«˜å±‚æ¬¡æˆ˜ç•¥\n\n- TDDä¸“æ³¨äºæŸä¸ªåŠŸèƒ½çš„å®ç°\n\nåœ¨å¼€å‘è¿‡ç¨‹ä¸­ï¼Œå¯ä»¥ä½¿ç”¨å¦‚ä¸‹æŠ€å·§ï¼Œç¡®ä¿ç±»å‹å®ç°äº†ç‰¹å®šæ¥å£æ¥å£\n\nä¾‹å¦‚ï¼Œç¡®ä¿`ArticleHandler`ç±»å‹å®ç°äº†`handler`æ¥å£\n\n![image-20240907211201251](https://raw.githubusercontent.com/lyydsheep/pic/main/202409072112298.png)\n\n### TDDé›†æˆæµ‹è¯•å®è·µï¼ˆäºŒï¼‰\n\nåœ¨å®ç°å®Œåˆ›å»ºæ–‡ç« åŠŸèƒ½åï¼Œæ¥ç€å°±è¦å®ç°ä¿®æ”¹æ–‡ç« åŠŸèƒ½\n\nä¾æ®TDDæ ¸å¿ƒå¾ªç¯ï¼Œéœ€è¦å†æ·»åŠ æµ‹è¯•ç”¨ä¾‹\n\n![image-20240916151741659](https://raw.githubusercontent.com/lyydsheep/pic/main/202409161518765.png)\n\nç”±äºæˆ‘ä»¬å°†è¦å®ç°çš„æ˜¯ä¿®æ”¹æ–‡ç« åŠŸèƒ½ï¼Œä¹Ÿå°±æ˜¯è¯´**æ–‡ç« æ˜¯äº‹å…ˆå­˜åœ¨çš„ï¼Œå‰ç«¯è¯·æ±‚å°†ä¼šå¸¦ä¸Šæ–‡ç« çš„Id**ï¼Œé‚£ä¹ˆåœ¨æµ‹è¯•æ—¶éœ€è¦åœ¨`before`å‡½æ•°ä¸­åšå¥½æ•°æ®çš„å‡†å¤‡å·¥ä½œ\n\n```go\nbefore: func(t *testing.T) {\n    err := s.db.Create(&dao.Article{\n        Id:      2,\n        Title:   \"æ—§çš„æ ‡é¢˜\",\n        Content: \"æ—§çš„æ ‡é¢˜\",\n        // å’Œæ—¶é—´æœ‰å…³çš„æµ‹è¯•ï¼Œæœ€å¥½ä¸ç”¨time.Now(), å› ä¸ºæ¯ä¸€æ¬¡éƒ½ä¸ä¸€æ ·ï¼Œä¸æ–¹ä¾¿è¿›è¡Œæ–­è¨€\n        AuthorId: 123,\n        Ctime:    677,\n        Utime:    677,\n    }).Error\n    require.NoError(t, err)\n},\n```\n\næ›´æ–°æ–‡ç« æ¶‰åŠåˆ°æ›´æ–°æ•°æ®åº“ï¼Œæœ‰ä¸¤ä¸ªå€¼å¾—æ³¨æ„çš„ç‚¹\n\n- ä¿®æ”¹`utime`è¿™ä¸ªè·Ÿæ—¶é—´æœ‰å…³çš„å­—æ®µï¼Œè€Œåœ¨è¿›è¡Œå’Œæ—¶é—´æœ‰å…³çš„æµ‹è¯•æ—¶ï¼Œå°½é‡ä¸è¦ä½¿ç”¨`time.Now()`å‡½æ•°ï¼Œå› ä¸ºæ¯ä¸€æ¬¡è¿è¡Œ`time.Now()`ç»“æœéƒ½ä¸ç›¸åŒï¼Œä¸ä¾¿äºåç»­çš„æ–­è¨€æ“ä½œ\n\n- ä¸¤ç§æ›´æ–°æ“ä½œå†™æ³•\n\n  - ```go\n    // åˆ©ç”¨äº†gormå¿½ç•¥é›¶å€¼çš„ç‰¹æ€§ï¼Œæ ¹æ®ä¸»é”®ï¼ˆé”å®šè¦æ›´æ–°çš„è¡Œï¼‰è¿›è¡Œæ›´æ–°æ“ä½œ\n    // å¯è¯»æ€§å·®\n    // å¿½ç•¥é›¶å€¼æ˜¯æŒ‡å¦‚æœæŸä¸ªå­—æ®µæ˜¯åŸæœ¬æ˜¯é›¶å€¼ï¼Œé‚£ä¹ˆå°±ä¸æ›´æ–°è¯¥å­—æ®µ\n    err := dao.db.WithContext(ctx).Updates(&article).Error\n    ```\n\n  - ```go\n    // å¯è¯»æ€§è¾ƒå¼º\n    err := dao.db.WithContext(ctx).Model(&article).\n    \t\tWhere(\"id=?\", article.Id).Updates(map[string]any{\n    \t\t\"title\":   article.Title,\n    \t\t\"content\": article.Content,\n    \t\t\"utime\":   article.Utime,\n    ```\n\n  - å¿½ç•¥é›¶å€¼å¯å‚è€ƒ [æ›´æ–° | GORM](https://gorm.io/zh_CN/docs/update.html#æ›´æ–°å¤šåˆ—)\n\n## DDDï¼šå®ä½“ â€”â€” å€¼å¯¹è±¡\n\nä¸‹å›¾æ‰€ç¤ºå°±æ˜¯ä¸€ä¸ªéå¸¸ç»å…¸çš„é¢†åŸŸè®¾è®¡é©±åŠ¨ä¸­çš„é¢†åŸŸå¯¹è±¡ä¸­**å®ä½“**å’Œ**å€¼å¯¹è±¡**çš„ä¸€ä¸ªä½“ç°\n\n<img src=\"https://raw.githubusercontent.com/lyydsheep/pic/main/202409161550256.png\" alt=\"image-20240916155000184\" style=\"zoom:67%;\" />\n\n- å®ä½“ï¼š**ç‹¬ç«‹å­˜åœ¨çš„**\n- å€¼å¯¹è±¡ï¼š**ä¾èµ–äºå®ä½“è€Œå­˜åœ¨ï¼Œé€šå¸¸ä½œä¸ºå®ä½“çš„å±æ€§å‡ºç°**\n\nå¯ä»¥ç»“åˆå®ä¾‹ç†è§£ä¸€ä¸‹ï¼šåœ¨ç”¨æˆ·é¢†åŸŸï¼Œä¸€ä¸ªäººæ˜¯ä¸€ä¸ªå®ä½“ï¼Œä»–æ˜¯ç‹¬ç«‹å­˜åœ¨çš„ï¼›è€Œåœ¨å¸–å­é¢†åŸŸï¼Œä¸€ä¸ªäººæ˜¯ä¾èµ–äºå¸–å­æ‰èƒ½æˆä¸ºä½œè€…ï¼Œæ˜¯ä¸€ä¸ªå€¼å¯¹è±¡\n\n**åœ¨DDDé‡Œé¢ï¼Œä¸€ä¸ªé¢†åŸŸçš„å®ä½“ï¼Œåœ¨å¦ä¸€ä¸ªé¢†åŸŸä¸­é€šå¸¸ä½œä¸ºå€¼å¯¹è±¡ã€å¦ä¸€ä¸ªå®ä½“çš„å±æ€§å‡ºç°**\n\n## æ•°æ®åŒæ­¥\n\n### èŒè´£åˆ’åˆ†\n\n> ç”±ä¹‹å‰çš„åˆ†æå¯çŸ¥ï¼Œæˆ‘ä»¬éœ€è¦ä¸€ä¸ªåˆ¶ä½œè¡¨å’Œçº¿ä¸Šè¡¨ï¼Œé‚£ä¹ˆè¯¥æœ‰å“ªä¸€ä¸ªéƒ¨åˆ†æ¥åŒæ­¥ä¸¤ä¸ªè¡¨çš„æ•°æ®å‘¢ï¼Ÿ\n\nç†è®ºä¸Šï¼Œé¡¹ç›®æ˜¯å•ä½“åº”ç”¨è¿˜æ˜¯å¾®æœåŠ¡åº”ç”¨æ˜¯é€‰æ‹©æ—¶éœ€è¦å‚è€ƒçš„å› ç´ \n\n- web/èšåˆæœåŠ¡\n  - è°ƒç”¨ä¸åŒçš„serviceæ¥åŒæ­¥æ•°æ®ï¼Œå¯ä»¥ç†è§£ä¸ºä½œè€…å’Œè¯»è€…å„æœ‰å„çš„æœåŠ¡\n- service\n  - è°ƒç”¨ä¸åŒçš„repositoryæ¥ä¿å­˜æ•°æ®ï¼Œä»å­˜å‚¨çš„è§’åº¦çœ‹æ¥ï¼Œä½œè€…çœ‹åˆ°çš„å¸–å­å’Œè¯»è€…çœ‹åˆ°çš„å¸–å­æ˜¯ä¸ä¸€æ ·çš„\n- repository\n  - æ“ä½œä¸åŒçš„æ•°æ®æº\n\n**ä¸šåŠ¡ç®€å•å°±ä¸€ä¸ªrepositoryï¼Œå¤æ‚å°±ç”¨å¤šä¸ªrepository**\n\n<img src=\"https://raw.githubusercontent.com/lyydsheep/pic/main/202409271441109.png\" alt=\"image-20240927144102855\" style=\"zoom:50%;\" />\n\n### ç»´æŠ¤äº‹åŠ¡\n\nåŒæ­¥åˆ¶ä½œåº“å’Œçº¿ä¸Šåº“è¦ä¹ˆåŒæ—¶æˆåŠŸï¼Œè¦ä¹ˆåŒæ—¶å¤±è´¥ï¼Œå› æ­¤å°†æ•°æ®åŒæ­¥æ“ä½œåšæˆä¸€ä¸ªäº‹åŠ¡å†åˆé€‚ä¸è¿‡äº†\n\nå¯ä»¥åœ¨ä¸¤ä¸ªå±‚é¢ä¸Šç»´æŠ¤äº‹åŠ¡ï¼Œä¸€ä¸ªæ˜¯`repository`ï¼Œå¦ä¸€ä¸ªæ˜¯`dao`ã€‚ä½†æ˜¯`repository`åœ¨DDDä¸­åº”è¯¥æ˜¯æ“ä½œæ•°æ®åº“å’Œç¼“å­˜çš„ï¼Œå¦‚æœåœ¨è¿™ä¸€å±‚é¢ç»´æŠ¤äº‹åŠ¡ï¼Œç»“æœå°±æ˜¯è·¨å±‚æ“ä½œå¹¶å¼ºè€¦åˆäºGORMï¼ˆè€Œä¸”å†™èµ·æ¥ä¸ä¼˜é›…ğŸ¤ªï¼‰ã€‚å¦ä¸€ç§æ–¹æ¡ˆæ˜¯åœ¨`dao`å±‚ä¸­ç»´æŠ¤äº‹åŠ¡ï¼ˆè¿™å°±æ–¹ä¾¿å¤šå•¦ğŸ˜Šï¼‰ï¼Œå…·ä½“å®ç°å¦‚ä¸‹\n\n```go\nfunc (dao *BasicArticleDAO) Sync(ctx context.Context, article Article) (int, error) {\n\tid := article.Id\n\t// åˆ©ç”¨GORMæ§åˆ¶äº‹åŠ¡çš„ç”Ÿå‘½å‘¨æœŸ\n\terr := dao.db.WithContext(ctx).Transaction(func(tx *gorm.DB) error {\n\t\tvar err error\n\t\tif id > 0 {\n\t\t\terr = dao.UpdateById(ctx, article)\n\t\t} else {\n\t\t\tid, err = dao.Insert(ctx, article)\n\t\t}\n\t\tif err != nil {\n\t\t\treturn err\n\t\t}\n\t\treturn dao.Upsert(ctx, PublishArticle{\n\t\t\tArticle: article,\n\t\t})\n\t})\n\treturn id, err\n}\n```\n\nâš ï¸ï¼šGORMçš„`transaction`æ–¹æ³•åœ¨åº•å±‚å®ç°æ—¶å°±å·²ç»å¸®æˆ‘ä»¬ç»´æŠ¤äº†**äº‹åŠ¡çš„ç”Ÿå‘½å‘¨æœŸ**\n\n> é‡ç‚¹æ˜¯å¦‚ä½•åœ¨GORMä¸‹å®ç°Upsertå‡½æ•°\n\n```go\nfunc (dao *BasicArticleDAO) Upsert(ctx context.Context, article PublishArticle) error {\n\tnow := time.Now().UnixMilli()\n\tarticle.Utime = now\n\tarticle.Ctime = now\n\t// Upsertå‡½æ•°åœ¨GORMä¸‹çš„å®ç°\n\treturn dao.db.WithContext(ctx).Clauses(clause.OnConflict{\n\t\tDoUpdates: clause.Assignments(map[string]interface{}{\n\t\t\t\"title\":   article.Title,\n\t\t\t\"content\": article.Content,\n\t\t\t\"utime\":   article.Utime,\n\t\t}),\n\t}).Create(&article).Error\n}\n```\n\nå‘`Clauses`å‡½æ•°ä¸­ä¼ é€’`OnConflict`ç»“æ„ä½“ï¼Œè¡¨ç¤ºå¦‚æœå‘ç”Ÿå†²çªçš„è¯åº”è¯¥åšä»€ä¹ˆäº‹æƒ…\n\n`OnConfilt`ä¸­æœ‰ä¸€äº›æ¯”è¾ƒæœ‰ç”¨çš„å­—æ®µ\n\n```go\n// DoUpdate\t\t---> åšæ›´æ–°æ“ä½œ\n// DoNothing\t---> ä»€ä¹ˆä¹Ÿä¸åš\n// Where\t\t---> æ•°æ®å†²çªäº†å¹¶ä¸”ç¬¦åˆwhereå­å¥ï¼Œå°±æ‰§è¡Œæ›´æ–°æ“ä½œ\n```\n\n**ğŸŒŸï¼šåœ¨ä¸€ä¸ªäº‹åŠ¡ä¸­ï¼Œä¸€ç›´éƒ½æ˜¯åŒä¸€ä¸ªæ•°æ®åº“è¿æ¥**\n\n## ç»´æŠ¤çŠ¶æ€\n\nåœ¨å…ˆå‰çš„åˆ†æä¸­ï¼Œæˆ‘ä»¬çŸ¥é“éœ€è¦æœ‰çº¿ä¸Šåº“å’Œåˆ¶ä½œåº“ä¸¤ä¸ªæ•°æ®å­˜å‚¨çš„åœ°æ–¹ï¼Œè¿™ä¸¤ä¸ªåœ°æ–¹å­˜å‚¨çš„æ•°æ®æœ¬è´¨ä¸Šæ˜¯ä¸€æ ·çš„ï¼Œå› æ­¤ä¸å¿…åˆ›å»ºæ–°çš„é¢†åŸŸå¯¹è±¡æ¥ç»´æŠ¤ï¼Œ**ä½¿ç”¨è¡ç”Ÿç±»å‹æ›´åŠ æ–¹ä¾¿**\n\n### çŠ¶æ€å¸¸é‡å®šä¹‰\n\nåˆ©ç”¨å¸¸é‡è¡¨ç¤ºä¸€ç¯‡å¸–å­çš„ä¸åŒçŠ¶æ€ï¼Œè¿™äº›å¸¸é‡å¯ä»¥ç›´æ¥åˆ©ç”¨`iota`åœ¨`domain`ä¸­å®šä¹‰ã€‚**ä¸€èˆ¬å®šä¹‰å¸¸é‡ï¼Œæœ€å¥½ä¸è¦æŠŠé›¶å€¼åšæˆæœ‰æ„ä¹‰çš„å€¼**ï¼Œå¦åˆ™éš¾ä»¥åŒºåˆ†æ˜¯ç”¨æˆ·æ²¡æœ‰è¾“å…¥è¿˜æ˜¯å‰ç«¯ä¼ é€’é»˜è®¤æ•°æ®\n\n![image-20240927090706192](https://raw.githubusercontent.com/lyydsheep/pic/main/202409270907841.png)\n\n## ä½¿ç”¨MongoDBå­˜å‚¨\n\nç±»ä¼¼äºå¤§æ–‡æœ¬ä¹‹ç±»çš„ä¸œè¥¿ï¼Œé™¤äº†å¯ä»¥ä½¿ç”¨å…³ç³»å‹æ•°æ®åº“ï¼Œä¹Ÿå¯ä»¥è€ƒè™‘ä½¿ç”¨å…¶ä»–å­˜å‚¨åº”ç”¨ï¼Œä¾‹å¦‚MongoDB\n\n**MongoDBå±äºNoSQLï¼ŒNoSQLå³Not Only SQL**ï¼Œä¸ä»…ä»…æ˜¯SQL\n\nNoSQLæ•°æ®åº“çš„äº§ç”Ÿæ˜¯ä¸ºäº†è§£å†³å¤§è§„æ¨¡æ•°æ®é›†åˆã€å¤šç§æ•°æ®ç§ç±»å¸¦æ¥çš„æŒ‘æˆ˜ï¼Œå°¤å…¶æ˜¯å¤§æ•°æ®åº”ç”¨éš¾é¢˜\n\n<img src=\"https://raw.githubusercontent.com/lyydsheep/pic/main/202409301530245.png\" alt=\"image-20240930153021471\" style=\"zoom:50%;\" />\n\n### MongoDBç®€ä»‹\n\nMongoDBçš„åŸºæœ¬ç‰¹æ€§\n\n- **é¢å‘é›†åˆå­˜å‚¨**ï¼šMongoDBé›†åˆä¸­å¯ä»¥å­˜å‚¨å¤šä¸ªæ–‡æ¡£\n  - ç±»æ¯”äºMySQLï¼ŒMongoDBä¸­çš„ä¸€ä¸ªé›†åˆå°±åƒæ˜¯ä¸€å¼ è¡¨ï¼Œé›†åˆä¸­çš„ä¸€ä¸ªæ–‡æ¡£å°±ç›¸å½“äºè¡¨ä¸­çš„ä¸€æ¡è®°å½•\n- **æ¨¡å¼è‡ªç”±**ï¼šMongoDBé‡‡ç”¨æ— ç»“æ„æ¨¡å¼å­˜å‚¨æ•°æ®ï¼Œä¹Ÿå°±æ˜¯è¯´ï¼Œåœ¨å‚¨å­˜æ•°æ®ä¹‹å‰ä¸éœ€è¦å®šä¹‰æ•°æ®çš„ç»“æ„\n  - å°±åƒå½“äºåœ¨MySQLä¸­ä¸éœ€è¦é¢„å…ˆå»ºç«‹è¡¨ç»“æ„å°±èƒ½æ’å…¥æ•°æ®\n- **æ”¯æŒåˆ†ç‰‡**ï¼šMongoDBæ”¯æŒåˆ†ç‰‡ï¼Œå¹¶ä¸”MongoDBè‡ªåŠ¨è§£å†³äº†åˆ†ç‰‡çš„å„ç§é—®é¢˜ï¼ŒåŒ…æ‹¬è‡ªåŠ¨åŒ–æ‰©å®¹\n\n<img src=\"https://raw.githubusercontent.com/lyydsheep/pic/main/202409301530677.png\" alt=\"image-20240930153009489\" style=\"zoom:67%;\" />\n\né€‰æ‹©MongoDBçš„ä¸¤ä¸ªç†ç”±ï¼š\n\n- **çµæ´»çš„æ–‡æ¡£æ¨¡å‹**ï¼šäºMySQLä¸åŒï¼Œä¸éœ€è¦äº‹å‰åœ¨MongoDBä¸­å®šä¹‰æ–‡æ¡£æ¨¡å‹ï¼Œå¹¶ä¸”å¯ä»¥çµæ´»ä¿®æ”¹\n\n- **æ˜“äºæ¨ªå‘æ‰©å±•**ï¼šå¯ä»¥é€šè¿‡å¢åŠ MongoDBå®ä¾‹æ¥åº”ä»˜æµé‡å’Œæ•°æ®å¢é•¿\n\n### åˆå§‹åŒ–å®¢æˆ·ç«¯å¹¶æ’å…¥æ–‡æ¡£\n\n> éœ€è¦ä½¿ç”¨MongoDBå®˜ç½‘çš„go-driver\n\n![image-20240930194117517](https://raw.githubusercontent.com/lyydsheep/pic/main/202409301941675.png)\n\n### æŸ¥æ‰¾æ–‡æ¡£\n\nåœ¨MongoDBä¸­æœ‰ä¸¤ç§æ„é€ æŸ¥è¯¢æ¡ä»¶çš„æ–¹å¼ï¼š\n\n- **bson**\n- **ç»“æ„ä½“**\n\n```go\n\t// ä½¿ç”¨bsonæ„é€ æŸ¥è¯¢æ¡ä»¶\n\tfilter := bson.D{bson.E{Key: \"id\", Value: 123}}\n\tvar art Article\n\terr = col.FindOne(ctx, filter).Decode(&art)\n\tassert.NoError(t, err)\n\tfmt.Printf(\"find article %v\\n\", art)\n\t// ä½¿ç”¨ç»“æ„ä½“æ„é€ æŸ¥è¯¢æ¡ä»¶\n\terr = col.FindOne(ctx, Article{Id: 123}).Decode(&art)\n\tif errors.Is(err, mongo.ErrNoDocuments) {\n\t\tfmt.Printf(\"find none\")\n\t}\n```\n\nâš ï¸ï¼šä½¿ç”¨ç»“æ„ä½“æ„é€ æŸ¥è¯¢æ¡ä»¶æ—¶ï¼Œmongodb-go-driveré»˜è®¤ä½¿ç”¨ç»“æ„ä½“çš„å…¨éƒ¨å­—æ®µä½œä¸ºåŒ¹é…æ¡ä»¶ï¼Œéœ€è¦æ³¨æ„æŸäº›å­—æ®µ**é»˜è®¤é›¶å€¼**ã€‚å½“ç„¶ï¼Œå¯ä»¥ä½¿ç”¨`bson:\"field_name,omitempty\"`æ ‡ç­¾æ¥å‘ŠçŸ¥mongodb-go-driverå¿½ç•¥å­—æ®µé›¶å€¼\n\nğŸŒŸï¼šå¯ä»¥ä½¿ç”¨`mongo.ErrNoDocuments`é”™è¯¯å€¼æ£€éªŒæ˜¯å¦æœ‰æŸ¥è¯¢åˆ°æ–‡æ¡£\n\n### æ›´æ–°æ–‡æ¡£\n\n- æ„é€ æ›´æ–°æ¡ä»¶ï¼ŒåŒæ„é€ æŸ¥è¯¢æ¡ä»¶\n- æ„é€ æ›´æ–°å­—æ®µ\n  - **bson**\n  - **ç»“æ„ä½“**\n\nâš ï¸ï¼šåŒæ ·çš„ï¼Œéœ€è¦æ³¨æ„**åº•å±‚æ˜¯å¦ä¼šé‡‡ç”¨å­—æ®µé›¶å€¼**\n\n```go\n\tsets := bson.D{bson.E{Key: \"$set\",\n\t\tValue: bson.E{Key: \"content\", Value: \"serious content\"}}}\n\tres, err := col.UpdateOne(ctx, filter, sets)\n\t// ä½¿ç”¨ç»“æ„ä½“æ„é€ æ›´æ–°å­—æ®µ\n\tres, err = col.UpdateOne(ctx, filter, bson.D{bson.E{Key: \"$set\", Value: Article{\n\t\tTitle: \"new title\",\n\t}}})\n```\n\n### åˆ›å»ºç´¢å¼•\n\nç±»ä¼¼äºMySQLï¼Œ**ä¸€èˆ¬æ˜¯æ ¹æ®ä¸šåŠ¡ä¸­å¸¸ç”¨çš„æŸ¥è¯¢æ¡ä»¶ï¼Œæ¥å†³å®šåœ¨ä»€ä¹ˆåˆ—ä¸Šæ„å»ºç´¢å¼•**\n\n```go\n\tindexRes, err := col.Indexes().CreateOne(ctx, mongo.IndexModel{\n\t\tKeys:    bson.M{\"id\": 1},\n\t\tOptions: options.Index().SetUnique(true),\n\t})\n\tfmt.Println(indexRes)\n```\n\n### MongoDBå­˜å‚¨æ•°æ®\n\nç”±äºMongoDBä¸­çš„`_id`å­—æ®µä¸æ˜¯è‡ªå¢å¹¶ä¸”æ˜¯ä¸€ä¸ª**12å­—èŠ‚**çš„åˆ‡ç‰‡ï¼Œå› æ­¤ä¸èƒ½ç›´æ¥ä½¿ç”¨è¿™ä¸ªå­—æ®µä½œä¸ºä¸»é”®\n\nä¸»é”®çš„å¯é€‰æ–¹æ¡ˆï¼š\n\n- **å°†æ•´ä¸ªidä¿®æ”¹ä¸ºstringç±»å‹**\n- **ä½¿ç”¨IDç”Ÿæˆç­–ç•¥**ï¼Œä¾‹å¦‚**é›ªèŠ±ç®—æ³•**\n  - **1æ¯”ç‰¹ä¿ç•™ä½**\n  - **41æ¯”ç‰¹æ—¶é—´æˆ³**\n  - **10æ¯”ç‰¹æœºå™¨ä½**ï¼Œä¸€èˆ¬å«åš`Worker ID`\n  - **12æ¯”ç‰¹è‡ªå¢åºå·**\n  - ![image-20241003154159484](https://raw.githubusercontent.com/lyydsheep/pic/main/202410031541579.png)\n- **ä½¿ç”¨GUID**\n- **å®šä¹‰ä¸€ä¸ªæ–°çš„æ¥å£**ï¼Œä½†è¿™æ ·å°±å¤±å»äº†DAOå±‚çš„ç»Ÿä¸€æ¥å£\n\n**âš ï¸ï¼šåœ¨MongoDBä¸­ï¼Œå°½é‡ä½¿ç”¨è¡ç”Ÿç±»å‹è€Œä¸æ˜¯åµŒå¥—ç»“æ„ä½“ã€‚å› ä¸ºåµŒå¥—ç»“æ„ä½“ä¸­å­ç»“æ„ä½“çš„å­—æ®µæ ‡ç­¾åœ¨æ“ä½œè¿‡ç¨‹ä¸­æ— æ³•æ­£å¸¸ç”Ÿæ•ˆ**\n\n## åˆ©ç”¨OSSæ¥å­˜å‚¨æ•°æ®\n\n> åˆ©ç”¨OSSå­˜å‚¨çº¿ä¸Šæ•°æ®ï¼Œè€Œåç›´æ¥é€šè¿‡CDNåŠ é€Ÿè®¿é—®\n\nOSSï¼ˆObject Storage Serviceï¼‰æ˜¯æŒ‡å…‘ç°å­˜å‚¨ï¼Œ**è¢«å¤§é‡ç”¨äºå­˜å‚¨æ–‡ä»¶ã€æµåª’ä½“ã€å›¾ç‰‡ç­‰**\n\nOSSä¸­çš„ä¸¤ä¸ªæ ¸å¿ƒæ¦‚å¿µï¼š\n\n- **Bucket**ï¼šé€»è¾‘ä¸Šçš„åˆ†ç»„å…³ç³»ï¼Œä¾‹å¦‚æŸä¸ªä¸šåŠ¡ä½¿ç”¨ä¸€ä¸ªæ¡¶ï¼Œå¦ä¸€ä¸ªä¸šåŠ¡ä½¿ç”¨å¦å¤–ä¸€ä¸ªæ¡¶\n- **Object**ï¼šå¯¹è±¡ï¼Œä¹Ÿå°±æ˜¯éœ€è¦å­˜å‚¨çš„ä¸œè¥¿\n\nACLï¼ˆAccess Control Listï¼‰ï¼šæƒé™æ§åˆ¶æ–¹æ¡ˆ\n\n![image-20241004101033272](https://raw.githubusercontent.com/lyydsheep/pic/main/202410041010143.png)\n\nOSSé€šå¸¸å’ŒCDNç»“åˆåœ¨ä¸€èµ·ä½¿ç”¨ï¼Œ**å³åœ¨OSSä¸Šå­˜å‚¨çš„æ•°æ®ï¼Œå¯ä»¥é€šè¿‡CDNæ¥è®¿é—®**\n\nä¸€ç§å¾ˆå¸¸è§çš„æ€§èƒ½å’Œå¯ç”¨æ€§ä¼˜åŒ–æ‰‹æ®µï¼Œå°±æ˜¯ä½¿ç”¨**OSSå’ŒCDNæ¥å­˜å‚¨ç½‘ç«™çš„é™æ€èµ„æº**ï¼Œæ­¤æ—¶OSSè¢«å½“ä½œCDNçš„ä¸€ä¸ªå›æºç«™ç‚¹\n\n![image-20241004101307223](https://raw.githubusercontent.com/lyydsheep/pic/main/202410041013265.png)\n\n## æŸ¥è¯¢æ¥å£ä¸ç¼“å­˜\n\nåœ¨å®ç°æŸ¥è¯¢æ–‡ç« åŠŸèƒ½è¿‡ç¨‹ä¸­ï¼Œéœ€è¦ä»ä¸åŒç”¨æˆ·è§’åº¦å‡ºå‘è¿›è¡Œæ€è€ƒ\n\n- å¯¹äºåˆ›ä½œè€…æ¥è¯´ï¼Œéœ€è¦æŸ¥è¯¢è‡ªå·±çš„**æ–‡ç« åˆ—è¡¨**ä»¥åŠ**æŸä¸€ç¯‡æ–‡ç« çš„è¯¦ç»†å†…å®¹**ï¼Œåˆ†åˆ«å¯¹åº”ç€ä¸¤ä¸ªæ¥å£\n  - åˆ—è¡¨æ¥å£\n  - è¯¦æƒ…æ¥å£\n- å¯¹äºè¯»è€…ï¼Œä»–èƒ½å¤Ÿ**æœç´¢æŸç¯‡æ–‡ç« **ã€**æµè§ˆæ¨èæ–‡ç« åˆ—è¡¨**ã€**é˜…è¯»æ–‡ç« çš„å…·ä½“å†…å®¹**ã€‚ç”±æ­¤å¯è§ï¼Œéœ€è¦æä¾›ä»¥ä¸‹æ¥å£\n  - æœç´¢æ¥å£\n  - æ¨èæ¥å£\n  - é˜…è¯»æ–‡ç« æ¥å£\n\nç›®å‰ä»…å®ç°åˆ›ä½œè€…çš„**åˆ—è¡¨æ¥å£å’Œè¯¦æƒ…æ¥å£**ï¼Œä»¥åŠè¯»è€…çš„**é˜…è¯»æ–‡ç« æ¥å£**\n\n### åˆ—è¡¨æ¥å£\n\n#### éœ€æ±‚åˆ†æ\n\nå‚è€ƒæ˜é‡‘çš„åˆ—è¡¨å±•ç¤ºï¼š\n\n![image-20241006141112588](https://raw.githubusercontent.com/lyydsheep/pic/main/202410061411490.png)\n\nå¯ä»¥å‘ç°ï¼Œåœ¨åˆ—è¡¨ä¸­å±•ç¤ºçš„æ–‡ç« å¯¹è±¡æœ‰å¦‚ä¸‹ç‰¹å¾ï¼š\n\n- æ ‡é¢˜\n- åˆ›å»ºæ—¶é—´\n- ç®€ä»‹\n- ...\n\næ ¹æ®è¿™äº›ç‰¹å¾æˆ‘ä»¬å°±èƒ½å®šä¹‰å‡ºä¸å‰ç«¯ç›¸å¯¹åº”çš„`ArticleVO`\n\nå¦ä¸€ä¸ªå€¼å¾—æ³¨æ„çš„ç‚¹æ˜¯ï¼Œ**æ˜é‡‘åœ¨åˆ—è¡¨ä¸­å±•ç¤ºçš„æ–‡ç« åªæœ‰ä¸€å°éƒ¨åˆ†ï¼Œå½“é¡µé¢ä¸‹æ»‘æ—¶æ‰ä¼šåŠ è½½æ›´å¤šçš„æ–‡ç« **ï¼Œè¿™å°±ç›¸å½“äºä¸€ä¸ª**åˆ†é¡µæŸ¥è¯¢**æ“ä½œ\n\n#### åˆ†é¡µå½¢æ€\n\n**åˆ†é¡µçš„æ ¸å¿ƒç›®æ ‡å°±æ˜¯é¿å…ä¸€æ¬¡æ“ä½œå¤ªå¤šæ•°æ®ï¼Œå¼•å‘æ€§èƒ½é—®é¢˜**ã€‚å†µä¸”ï¼Œåˆ—è¡¨é¡µåœ¨å±•ç¤ºçš„æ—¶å€™ï¼Œä¹Ÿä¸è®¸é‚£ä¹ˆå¤šçš„å†…å®¹ğŸ˜\n\nåˆ†é¡µæ¥å£ä¸€èˆ¬æœ‰ä¸‰ç§å®šä¹‰å½¢å¼ï¼š\n\n- **ç›´æ¥å®šä¹‰`Offset`å’Œ`Limit`å­—æ®µ**\n- **ç›´æ¥å®šä¹‰ä¸€ä¸ª`Page`å­—æ®µï¼Œå¹¶çº¦å®šå¥½Pageçš„å¤§å°**\n- **ç›´æ¥å®šä¹‰ä¸€ä¸ª`Cursor`å­—æ®µ**\n\n<img src=\"https://raw.githubusercontent.com/lyydsheep/pic/main/202410061421861.png\" alt=\"image-20241006142108823\" style=\"zoom: 50%;\" />\n\n### ç¼“å­˜è®¾è®¡\n\n> ç¼“å­˜ç¬¬ä¸€é¡µåˆ†é¡µ\n\nå¤§éƒ¨åˆ†æƒ…å†µä¸‹ï¼Œä¸ä¼šå¯¹åˆ†é¡µç»“æœè¿›è¡Œç¼“å­˜ï¼Œ**å› ä¸ºå¦‚æœæ•°æ®çš„ç­›é€‰æ¡ä»¶ã€æ’åºæ¡ä»¶ã€åˆ†é¡µæ¡ä»¶ã€åˆ†é¡µçš„åç§»é‡å’Œæ•°æ®é‡ä¸­çš„ä»»ä½•ä¸€ä¸ªå‘ç”Ÿäº†å˜åŒ–ï¼Œç¼“å­˜å°±å¾ˆéš¾ä½¿ç”¨äº†**\n\nä½†å¯ä»¥åª**ç¼“å­˜ç¬¬ä¸€é¡µ**ï¼Œæ¯•ç«Ÿå¤§éƒ¨åˆ†ç”¨æˆ·åªçœ‹åˆ—è¡¨çš„ç¬¬ä¸€é¡µ\n\næœ‰äº†ç¼“å­˜ä¹‹åï¼Œ**æ¯æ¬¡è¿›è¡Œæ›´æ–°æ“ä½œéƒ½è¦å°†ç¼“å­˜åˆ é™¤ï¼Œé˜²æ­¢ç¼“å­˜ä¸ä¸€è‡´é—®é¢˜**\n\n> ä¸šåŠ¡ç›¸å…³çš„é¢„åŠ è½½\n\n**é¢„åŠ è½½æœ¬è´¨ä¸Šå°±æ˜¯é¢„åˆ¤ç”¨æˆ·å°†è¦è¯»å–çš„å†…å®¹ï¼Œæå‰å°†å†…å®¹å­˜å…¥ç¼“å­˜ä¸­**\n\nè€Œä¸”ï¼Œå› ä¸ºæ˜¯é¢„æµ‹æ€§è´¨çš„ï¼Œæ‰€ä»¥è¿‡æœŸæ—¶é—´è®¾ç½®å¾—å¾ˆçŸ­\n\n![image-20241006151243081](https://raw.githubusercontent.com/lyydsheep/pic/main/202410061512142.png)\n\n> ä¸ç¼“å­˜å¤§æ–‡æ¡£ï¼ˆè°ƒä¼˜ğŸ˜‚ï¼‰\n\nå¯ä»¥è€ƒè™‘åœ¨Rediså†…å­˜æ¶ˆè€—å’Œç¼“å­˜æ€§èƒ½ä¹‹é—´åšä¸€ä¸ªæƒè¡¡\n\nä¹Ÿå°±æ˜¯è¯´ï¼Œå¹¶ä¸æ˜¯æ‰€æœ‰çš„å€¼éƒ½éœ€è¦ç¼“å­˜ï¼Œ**æœ‰ä¸€äº›å¾ˆå ç”¨å†…å­˜ç©ºé—´çš„æ–‡ç« å°±ä¸å¿…ç¼“å­˜**\n\n#### ç¼“å­˜è¿‡æœŸæ—¶é—´\n\nç¼“å­˜çš„è¿‡æœŸæ—¶é—´å’Œç¼“å­˜å‘½ä¸­ç‡æœ‰å…³ï¼Œä¸€èˆ¬æƒ…å†µä¸‹ï¼Œ**è¿‡æœŸæ—¶é—´è¶Šé•¿ï¼Œå‘½ä¸­ç‡è¶Šé«˜ï¼Œä½†æ•°æ®ä¸€è‡´æ€§ä¼šå˜å·®ï¼›è¿‡æœŸæ—¶é—´è¶ŠçŸ­ï¼Œå‘½ä¸­ç‡è¶Šä½ï¼Œä½†æ•°æ®ä¸€è‡´æ€§ä¼šæ›´å¥½**\n\n- ä¸šåŠ¡ç›¸å…³çš„ç¼“å­˜é¢„åŠ è½½ï¼Œè¿‡æœŸæ—¶é—´è¦çŸ­\n- æ ¹æ®ç”¨æˆ·èº«ä»½æŒ‰æƒç»™äºˆä¸åŒçš„ç¼“å­˜æ—¶é—´\n\n#### æ·˜æ±°ç­–ç•¥\n\næ·˜æ±°ç­–ç•¥æ˜¯æŒ‡åœ¨ç¼“å­˜å†…å­˜ä¸å¤Ÿç”¨çš„æƒ…å†µä¸‹ï¼Œæ·˜æ±°æŸä¸€éƒ¨åˆ†æ•°æ®æ—¶çš„è®¡åˆ’\n\nå¸¸è§„æ–¹æ¡ˆå°±æ˜¯**LRUå’ŒLFU**\n\nè¿˜æœ‰ä¸€äº›æ–¹æ¡ˆï¼š\n\n- ä¼˜å…ˆæ·˜æ±°æ™®é€šåˆ›ä½œè€…çš„æ•°æ®ï¼Œç•™ä¸‹å¤§vçš„æ•°æ®\n- ä¼˜å…ˆæ·˜æ±°å¤§å¯¹è±¡ï¼Œé‡Šæ”¾å‡ºæ›´å¤šçš„å†…å­˜ç©ºé—´\n- ä¼˜å…ˆæ·˜æ±°å°å¯¹è±¡ï¼Œç›¸æ¯”äºå¤§å¯¹è±¡ï¼Œå°å¯¹è±¡åœ¨ä»æ•°æ®åº“ï¼ˆæˆ–OSSï¼‰ä¸­è·å–æ›´åŠ è¿…é€Ÿ\n\n### æ³¨æ„äº‹é¡¹\n\n- ä½¿ç”¨`wrapbodyandtoken`ç»Ÿä¸€å¤„ç†Bodyå’ŒTokenä¸­çš„æ•°æ®\n- è€ƒè™‘åˆ°ä¸­æ–‡å­—ç¬¦ç”±å¤šä¸ªå­—èŠ‚ç»„æˆï¼Œåœ¨å¤„ç†åŒ…å«ä¸­æ–‡çš„å­—ç¬¦ä¸²æ—¶ï¼Œåº”å®ç°å°†å…¶è½¬ä¸º`[]rune`å†è¿›è¡Œ`len()`æ“ä½œ\n- éœ€è¦å°†å­˜å‚¨å¯¹è±¡è½¬æ¢ä¸º`json`æ ¼å¼åæ‰èƒ½å­˜å…¥Redisä¸­ï¼Œå¦åˆ™ä¼šæŠ¥é”™\n\n\n\n\n\n","source":"_posts/å‘å¸–åŠŸèƒ½å®ç°.md","raw":"---\ntitle: å‘å¸–åŠŸèƒ½å®ç°\npublish: true\ndescription: TDDä»¥åŠç¼“å­˜æ–¹æ¡ˆ\ntag: \n- Go\n- å­¦ä¹ \nsticky: 2\n---\n\n# å‘å¸–åŠŸèƒ½å®ç°\n\n## éœ€æ±‚åˆ†æ\n\n### ç”¨ä¾‹\n\n> é€šè¿‡ä½¿ç”¨ç”¨ä¾‹æ¥å±•ç¤ºæŸä¸ªéœ€æ±‚çš„å…·ä½“ä½¿ç”¨åœºæ™¯\n\n<img src=\"https://raw.githubusercontent.com/lyydsheep/pic/main/202409092129324.png\" width=300>\n\n- åˆ›ä½œè€…\n  - å¢åˆ æ”¹æŸ¥\n- è¯»è€…\n  - æŸ¥\n\n### å†…å®¹çš„å¯è§æ€§\n\n> åˆ›ä½œè€…åˆ›ä½œäº†ä¸€ç¯‡æ–‡ç« ï¼Œé‚£ä¹ˆè¿™ç¯‡æ–‡ç« ä»€ä¹ˆæƒ…å†µä¸‹å¯ä»¥è¢«è¯»è€…çœ‹åˆ°å‘¢ï¼Ÿ\n\næ ¹æ®ç”Ÿæ´»ç»éªŒï¼Œå¯ä»¥å¾ˆå®¹æ˜“æƒ³åˆ°ï¼šä¸€ç¯‡æ–‡ç« åªæœ‰åœ¨å‘è¡¨ï¼ˆé€šè¿‡å®¡æ ¸ï¼‰å¹¶ä¸”å¤„äºå…¬å¼€çŠ¶æ€ä¸‹æ‰èƒ½è¢«ç”¨æˆ·æ‰€çœ‹åˆ°ã€‚å¦‚æ­¤ï¼Œä¸€ç¯‡å¸–å­å°±æœ‰äº†å‘è¡¨å’Œæœªå‘è¡¨ä¸¤ä¸ªçŠ¶æ€ï¼Œæˆ‘ä»¬å¯ä»¥å¾ˆè½»æ¾åœ°å¾—å‡ºä¸€ç¯‡å¸–å­çš„**çŠ¶æ€**è½¬æ¢å›¾\n\n![image-20240909214045416](https://raw.githubusercontent.com/lyydsheep/pic/main/202409092140450.png)\n\næƒ³è±¡è¿™ä¹ˆä¸€ä¸ªåœºæ™¯ï¼Œç”¨æˆ·æ­£åœ¨æµè§ˆæ–‡ç« ï¼Œä¸æ­¤åŒæ—¶ä½œè€…ä¹Ÿåœ¨ä¿®æ”¹æ–‡ç« ï¼Œé‚£ä¹ˆç”¨æˆ·ä¼šå®æ—¶çœ‹åˆ°ä½œè€…çš„ä¿®æ”¹å—ï¼Ÿ\n\nè¿™å½“ç„¶ä¸ä¼šï¼Œåœ¨åˆ›ä½œè€…å‘å¸ƒä¹‹å‰ï¼Œè¿™äº›ä¿®æ”¹å¯¹è¯»è€…éƒ½æ˜¯ä¸å¯è§çš„\n\nä¸€ç§å¾ˆæ˜¾ç„¶çš„è§£å†³åŠæ³•å°±æ˜¯**åˆ†å¼€å­˜å‚¨**ï¼Œå³ä¸€ä¸ª**åˆ¶ä½œè¡¨**ï¼Œä¸€ä¸ª**çº¿ä¸Šè¡¨**\n\nç”¨æˆ·çœ‹åˆ°çš„æ˜¯çº¿ä¸Šè¡¨ä¸­çš„æ•°æ®ï¼Œè€Œä½œè€…ä¿®æ”¹çš„éƒ½æ˜¯åˆ¶ä½œè¡¨ä¸­çš„æ•°æ®ï¼Œè¿™æ ·ä½œè€…çš„ä¿®æ”¹å¯¹äºç”¨æˆ·è€Œè¨€éƒ½æ˜¯ä¸å¯çŸ¥çš„ï¼Œåªæœ‰å½“çº¿ä¸Šè¡¨æ›´æ–°åï¼Œç”¨æˆ·æ‰èƒ½çœ‹åˆ°ä¿®æ”¹\n\næ•´ç†ä¸Šè¿°åˆ†æï¼Œå¯ä»¥å¾—åˆ°æ›´è¯¦ç»†çš„çŠ¶æ€å›¾ï¼š\n\n![image-20240910200443544](https://raw.githubusercontent.com/lyydsheep/pic/main/202409102004630.png)\n\n### æµç¨‹åˆ†æ\n\næˆ‘ä»¬å°†ä¸¤ä¸ªè¡¨ï¼ˆåˆ¶ä½œè¡¨ã€çº¿ä¸Šè¡¨ï¼‰çš„çŠ¶æ€ï¼Œåˆ†åˆ«ç”¨ä¸€ä½äºŒè¿›åˆ¶è¡¨ç¤ºï¼Œå¯ä»¥å¾—å‡º3ä¸­èµ·å§‹çŠ¶æ€ï¼ˆæœ‰ä¸€ç§çŠ¶æ€ä¸å¯èƒ½å­˜åœ¨ï¼‰\n\n- 0 0ï¼šåˆ¶ä½œè¡¨å’Œçº¿ä¸Šè¡¨éƒ½æ²¡æœ‰æ•°æ®\n- 1 0ï¼šåªæœ‰åˆ¶ä½œè¡¨ä¸­æœ‰æ•°æ®\n- 1 1ï¼šåˆ¶ä½œè¡¨å’Œçº¿ä¸Šè¡¨éƒ½æœ‰æ•°æ®\n\nåˆ†ææ¯ä¸€ç§èµ·å§‹çŠ¶æ€å¯èƒ½çš„åç»­çŠ¶æ€\n\n- 0 0\n  - 1 0ï¼šä½œè€…å†™äº†ä¸€åŠï¼Œæœ¨æœ‰å‘è¡¨\n  - 1 1ï¼šä½œè€…å†™å¥½å¹¶å‘è¡¨äº†æ–‡ç« \n  - ![image-20240910201425755](https://raw.githubusercontent.com/lyydsheep/pic/main/202409102014800.png)\n- 1 0\n  - 1 1ï¼šä½œè€…å†™å¥½å¹¶å‘è¡¨äº†æ–‡ç« \n  - ![image-20240910201456526](https://raw.githubusercontent.com/lyydsheep/pic/main/202409102014565.png)\n- 1 1\n  - 1 1ï¼šä½œè€…ä¿®æ”¹æ–‡ç« \n  - ![image-20240910202622396](https://raw.githubusercontent.com/lyydsheep/pic/main/202409102026434.png)\n\n## TDDä¸ç¼–è¾‘æ¥å£\n\n**TDDï¼šæµ‹è¯•é©±åŠ¨å¼€å‘ï¼Œå…ˆå†™æµ‹è¯•ï¼Œå†å†™å®ç°**\n\n- é€šè¿‡æ’°å†™æµ‹è¯•ï¼Œ**ç†æ¸…æ¥šæ¥å£è¯¥å¦‚ä½•å®šä¹‰ï¼Œç«™åœ¨ç”¨æˆ·çš„è§’åº¦çœ‹æ˜¯å¦åˆé€‚**\n- é€šè¿‡æ’°å†™æµ‹è¯•ç”¨ä¾‹ï¼Œ**ç†æ¸…æ¥šæ•´ä¸ªåŠŸèƒ½è¦è€ƒè™‘çš„ä¸»æµç¨‹ã€å¼‚å¸¸æµç¨‹**\n\n### æ ¸å¿ƒå¾ªç¯\n\n- æ ¹æ®å¯¹éœ€æ±‚çš„ç†è§£ï¼Œ**åˆæ­¥å®šä¹‰æ¥å£**ï¼Œæ— æ‰€è°“æ¥å£åˆä¸åˆé€‚ï¼Œåæ­£è¿˜å¾—æ”¹\n- æ ¹æ®æ¥å£å®šä¹‰æµ‹è¯•\n- æ‰§è¡Œæ ¸å¿ƒå¾ªç¯\n  - å¢åŠ æµ‹è¯•ç”¨ä¾‹\n  - æä¾›/ä¿®æ”¹å®ç°\n  - æ‰§è¡Œæµ‹è¯•ç”¨ä¾‹\n\n<img src=\"https://raw.githubusercontent.com/lyydsheep/pic/main/202409161517114.png\" alt=\"image-20240916151718031\" style=\"zoom:67%;\" />\n\n### suiteæµ‹è¯•ç»„ç»‡å¥—ä»¶\n\n[å‚è€ƒæ–‡ç« ](https://annatarhe.github.io/2020/08/19/how-to-do-test-in-go.html)\n\næœ‰çš„æ—¶å€™åœ¨æµ‹è¯•ä¹‹å‰éœ€è¦è¿æ¥dbã€redisã€rpcä¹‹ç±»çš„ä¸œè¥¿ï¼Œç„¶åå†æµ‹è¯•ç»“æŸåå°†è¿™äº›è¿æ¥å…³é—­ã€‚ä¹Ÿå°±æ˜¯è¯´ï¼Œæˆ‘ä»¬çš„å•å…ƒï¼ˆé›†æˆï¼‰æµ‹è¯•å…·æœ‰**ç”Ÿå‘½å‘¨æœŸ**ã€‚å¦‚æœæ˜¯æ‰‹åŠ¨ç¼–å†™è¿æ¥ã€å…³é—­è¿æ¥çš„ä»£ç ä¼šä½¿å¾—æµ‹è¯•éƒ¨åˆ†æ˜¾å¾—å¼‚å¸¸è‡ƒè‚¿ï¼Œå¥½åœ¨æœ‰`suite`å¯ä»¥å¸®åŠ©æˆ‘ä»¬æœ‰æ•ˆåœ°ç®¡ç†æµ‹è¯•çš„ç”Ÿå‘½å‘¨æœŸ\n\n```go\nimport (\n    \"testing\"\n    \"github.com/stretchr/testify/assert\"\n    \"github.com/stretchr/testify/suite\"\n)\n\n// å®šä¹‰æµ‹è¯•ç»“æ„ä½“\ntype ExampleTestSuite struct {\n    suite.Suite\n    msg string\n}\n\n// æµ‹è¯•å‰çš„é¢„å¤‡\nfunc (suite *ExampleTestSuite) SetupTest() {\n    suite.msg = \"iu is my wife\"\n    db, _ = sql.Open(\"xxx\")\n}\n\n// æµ‹è¯•\nfunc (suite *ExampleTestSuite) TestExample() {\n    m := &obj{\n        Msg: suite.msg\n    }\n    err := insert(m)\n    assert.Nil(suite.T(), err)\n    assert.Equal(suite.T(), suite.msg, m.Msg)\n}\n\n// æµ‹è¯•åçš„æ¸…ç†\nfunc (suite *ExampleTestSuite) TearDownTest() {\n    db.Close()\n}\n\n// å…¥å£\nfunc TestExampleTestSuite(t *testing.T) {\n    suite.Run(t, new(ExampleTestSuite))\n}\n```\n\näº”ä¸ªæ­¥éª¤\n\n- **å®šä¹‰æµ‹è¯•ç»“æ„ä½“**\n  - æµ‹è¯•ç»“æ„ä½“ä¸­åº”åŒ…å«æ‰€éœ€è¦çš„ç¬¬ä¸‰æ–¹å­—æ®µï¼Œä¾‹å¦‚`suite.Suite`,`gorm.DB`, `redis.Cmdable`ç­‰\n- **å…¥å£å‡½æ•°**\n  - `func TestExampleTestSuite(t *testing.T)`\n  - å‡½æ•°ä½“ä¸­ä»…æœ‰`suite.Run(t, new(xxx))`ä¸€è¡Œä»£ç \n- **æµ‹è¯•å‰çš„å‡†å¤‡å·¥ä½œ**\n  - `func (suite *ExampleTestSuite) SetupTest()`\n- æµ‹è¯•\n  - `func (suite *ExampleTestSuite) TestExample()`\n- **æµ‹è¯•åçš„æ¸…ç†**\n  - `func (suite *ExampleTestSuite) TearDownTest()`\n\n### TDDé›†æˆæµ‹è¯•å®è·µï¼ˆä¸€ï¼‰\n\n```go\n// æµ‹è¯•å¥—ä»¶\ntype ArticleSuite struct {\n\tsuite.Suite\n\tserver *gin.Engine\n\tdb     *gorm.DB\n\tl      *zap.Logger\n}\n\n// SetupTest éƒ½ç”¨startupé‡Œçš„åˆå§‹åŒ–æ–¹æ³•ï¼Œå½“ç„¶ä½¿ç”¨wireç”Ÿæˆå•¦\nfunc (s *ArticleSuite) SetupTest() {\n\tvar err error\n\ts.l, err = zap.NewDevelopment()\n\tif err != nil {\n\t\tpanic(err)\n\t}\n\ts.db = startup.InitDB(s.l)\n\tgin.SetMode(gin.ReleaseMode)\n\ts.server = gin.Default()\n\t// åœ¨è¿™é‡Œæ”¾å¥½userClaimsï¼Œè¡¨ç¤ºç™»å½•çŠ¶æ€\n\ts.server.Use(func(ctx *gin.Context) {\n\t\tctx.Set(\"userClaims\", jwt.UserClaims{\n\t\t\tUserId: 123,\n\t\t})\n\t})\n\tartHdl := startup.InitArticleHandler()\n\tartHdl.RegisterRoutes(s.server)\n}\n\nfunc (s *ArticleSuite) TestEdit() {\n\tt := s.T()\n\ttestCases := []struct {\n\t\tname string\n\t\t// å‡†å¤‡æ•°æ®\n\t\tbefore func(t *testing.T)\n\t\t// æ ¡éªŒæ•°æ®\n\t\tafter   func(t *testing.T)\n\t\tarticle Article\n\t\t// é¢„æœŸæ•°æ®\n\t\texpectCode int\n\t\texpectRes  Result[int]\n\t}{\n\t\t{\n\t\t\tname: \"æ–°å»ºå¸–å­â€”â€”ä¿å­˜æˆåŠŸ\",\n\t\t\tbefore: func(t *testing.T) {\n\n\t\t\t},\n\t\t\tafter: func(t *testing.T) {\n\t\t\t\t// å¯¹æ¯ä¸€åˆ—æ•°æ®éƒ½è¦è¿›è¡Œæ£€éªŒ\n\t\t\t\tvar article dao.Article\n\t\t\t\terr := s.db.Where(\"id=?\", 1).First(&article).Error\n\t\t\t\trequire.NoError(t, err)\n\t\t\t\tassert.True(t, article.Ctime > 0)\n\t\t\t\tassert.True(t, article.Utime > 0)\n\t\t\t\tarticle.Ctime = 0\n\t\t\t\tarticle.Utime = 0\n\t\t\t\tassert.Equal(t, dao.Article{\n\t\t\t\t\tId:       1,\n\t\t\t\t\tTitle:    \"è¿™æ˜¯æ ‡é¢˜\",\n\t\t\t\t\tContent:  \"è¿™æ˜¯å†…å®¹\",\n\t\t\t\t\tAuthorId: 123,\n\t\t\t\t}, article)\n\t\t\t},\n            article: Article{\n                Title: \"è¿™æ˜¯æ ‡é¢˜\",\n                Content: \"è¿™æ˜¯å†…å®¹\",\n            }\n\t\t\texpectCode: http.StatusOK,\n\t\t\texpectRes: Result[int]{\n\t\t\t\tData: 1,\n\t\t\t},\n\t\t},\n\t}\n\tfor _, tc := range testCases {\n\t\tt.Run(tc.name, func(t *testing.T) {\n\t\t\t//tc.before(t)\n\t\t\t// ä»¥jsonæ ¼å¼è¾“å…¥\n\t\t\tarticleJson, err := json.Marshal(tc.article)\n\t\t\trequire.NoError(t, err)\n\t\t\treq, err := http.NewRequest(http.MethodPost, \"/article/edit\", bytes.NewBuffer(articleJson))\n\t\t\treq.Header.Set(\"Content-Type\", \"application/json\")\n\t\t\trequire.NoError(t, err)\n\t\t\tresp := httptest.NewRecorder()\n\t\t\ts.server.ServeHTTP(resp, req)\n\t\t\tvar res Result[int]\n\t\t\tassert.Equal(t, tc.expectCode, resp.Code)\n\t\t\terr = json.NewDecoder(resp.Body).Decode(&res)\n\t\t\tassert.Equal(t, tc.expectRes, res)\n\t\t\t//tc.after(t)\n\t\t})\n\t}\n}\n\n// æµ‹è¯•åæ‰€ä½œçš„åŠ¨ä½œ\nfunc (s *ArticleSuite) TearDownTest() {\n\ts.db.Exec(\"truncate table articles\")\n}\n\nfunc TestArticleSuite(t *testing.T) {\n\tsuite.Run(t, new(ArticleSuite))\n}\n\ntype Article struct {\n\tTitle   string `json:\"title\"`\n\tContent string `json:\"content\"`\n}\n\ntype Result[T any] struct {\n\tMsg  string `json:\"msg\"`\n\tCode int    `json:\"code\"`\n\tData T      `json:\"data\"`\n}\n\n```\n\n- DDDä¾§é‡äºè®¾è®¡æ¶æ„ã€é«˜å±‚æ¬¡æˆ˜ç•¥\n\n- TDDä¸“æ³¨äºæŸä¸ªåŠŸèƒ½çš„å®ç°\n\nåœ¨å¼€å‘è¿‡ç¨‹ä¸­ï¼Œå¯ä»¥ä½¿ç”¨å¦‚ä¸‹æŠ€å·§ï¼Œç¡®ä¿ç±»å‹å®ç°äº†ç‰¹å®šæ¥å£æ¥å£\n\nä¾‹å¦‚ï¼Œç¡®ä¿`ArticleHandler`ç±»å‹å®ç°äº†`handler`æ¥å£\n\n![image-20240907211201251](https://raw.githubusercontent.com/lyydsheep/pic/main/202409072112298.png)\n\n### TDDé›†æˆæµ‹è¯•å®è·µï¼ˆäºŒï¼‰\n\nåœ¨å®ç°å®Œåˆ›å»ºæ–‡ç« åŠŸèƒ½åï¼Œæ¥ç€å°±è¦å®ç°ä¿®æ”¹æ–‡ç« åŠŸèƒ½\n\nä¾æ®TDDæ ¸å¿ƒå¾ªç¯ï¼Œéœ€è¦å†æ·»åŠ æµ‹è¯•ç”¨ä¾‹\n\n![image-20240916151741659](https://raw.githubusercontent.com/lyydsheep/pic/main/202409161518765.png)\n\nç”±äºæˆ‘ä»¬å°†è¦å®ç°çš„æ˜¯ä¿®æ”¹æ–‡ç« åŠŸèƒ½ï¼Œä¹Ÿå°±æ˜¯è¯´**æ–‡ç« æ˜¯äº‹å…ˆå­˜åœ¨çš„ï¼Œå‰ç«¯è¯·æ±‚å°†ä¼šå¸¦ä¸Šæ–‡ç« çš„Id**ï¼Œé‚£ä¹ˆåœ¨æµ‹è¯•æ—¶éœ€è¦åœ¨`before`å‡½æ•°ä¸­åšå¥½æ•°æ®çš„å‡†å¤‡å·¥ä½œ\n\n```go\nbefore: func(t *testing.T) {\n    err := s.db.Create(&dao.Article{\n        Id:      2,\n        Title:   \"æ—§çš„æ ‡é¢˜\",\n        Content: \"æ—§çš„æ ‡é¢˜\",\n        // å’Œæ—¶é—´æœ‰å…³çš„æµ‹è¯•ï¼Œæœ€å¥½ä¸ç”¨time.Now(), å› ä¸ºæ¯ä¸€æ¬¡éƒ½ä¸ä¸€æ ·ï¼Œä¸æ–¹ä¾¿è¿›è¡Œæ–­è¨€\n        AuthorId: 123,\n        Ctime:    677,\n        Utime:    677,\n    }).Error\n    require.NoError(t, err)\n},\n```\n\næ›´æ–°æ–‡ç« æ¶‰åŠåˆ°æ›´æ–°æ•°æ®åº“ï¼Œæœ‰ä¸¤ä¸ªå€¼å¾—æ³¨æ„çš„ç‚¹\n\n- ä¿®æ”¹`utime`è¿™ä¸ªè·Ÿæ—¶é—´æœ‰å…³çš„å­—æ®µï¼Œè€Œåœ¨è¿›è¡Œå’Œæ—¶é—´æœ‰å…³çš„æµ‹è¯•æ—¶ï¼Œå°½é‡ä¸è¦ä½¿ç”¨`time.Now()`å‡½æ•°ï¼Œå› ä¸ºæ¯ä¸€æ¬¡è¿è¡Œ`time.Now()`ç»“æœéƒ½ä¸ç›¸åŒï¼Œä¸ä¾¿äºåç»­çš„æ–­è¨€æ“ä½œ\n\n- ä¸¤ç§æ›´æ–°æ“ä½œå†™æ³•\n\n  - ```go\n    // åˆ©ç”¨äº†gormå¿½ç•¥é›¶å€¼çš„ç‰¹æ€§ï¼Œæ ¹æ®ä¸»é”®ï¼ˆé”å®šè¦æ›´æ–°çš„è¡Œï¼‰è¿›è¡Œæ›´æ–°æ“ä½œ\n    // å¯è¯»æ€§å·®\n    // å¿½ç•¥é›¶å€¼æ˜¯æŒ‡å¦‚æœæŸä¸ªå­—æ®µæ˜¯åŸæœ¬æ˜¯é›¶å€¼ï¼Œé‚£ä¹ˆå°±ä¸æ›´æ–°è¯¥å­—æ®µ\n    err := dao.db.WithContext(ctx).Updates(&article).Error\n    ```\n\n  - ```go\n    // å¯è¯»æ€§è¾ƒå¼º\n    err := dao.db.WithContext(ctx).Model(&article).\n    \t\tWhere(\"id=?\", article.Id).Updates(map[string]any{\n    \t\t\"title\":   article.Title,\n    \t\t\"content\": article.Content,\n    \t\t\"utime\":   article.Utime,\n    ```\n\n  - å¿½ç•¥é›¶å€¼å¯å‚è€ƒ [æ›´æ–° | GORM](https://gorm.io/zh_CN/docs/update.html#æ›´æ–°å¤šåˆ—)\n\n## DDDï¼šå®ä½“ â€”â€” å€¼å¯¹è±¡\n\nä¸‹å›¾æ‰€ç¤ºå°±æ˜¯ä¸€ä¸ªéå¸¸ç»å…¸çš„é¢†åŸŸè®¾è®¡é©±åŠ¨ä¸­çš„é¢†åŸŸå¯¹è±¡ä¸­**å®ä½“**å’Œ**å€¼å¯¹è±¡**çš„ä¸€ä¸ªä½“ç°\n\n<img src=\"https://raw.githubusercontent.com/lyydsheep/pic/main/202409161550256.png\" alt=\"image-20240916155000184\" style=\"zoom:67%;\" />\n\n- å®ä½“ï¼š**ç‹¬ç«‹å­˜åœ¨çš„**\n- å€¼å¯¹è±¡ï¼š**ä¾èµ–äºå®ä½“è€Œå­˜åœ¨ï¼Œé€šå¸¸ä½œä¸ºå®ä½“çš„å±æ€§å‡ºç°**\n\nå¯ä»¥ç»“åˆå®ä¾‹ç†è§£ä¸€ä¸‹ï¼šåœ¨ç”¨æˆ·é¢†åŸŸï¼Œä¸€ä¸ªäººæ˜¯ä¸€ä¸ªå®ä½“ï¼Œä»–æ˜¯ç‹¬ç«‹å­˜åœ¨çš„ï¼›è€Œåœ¨å¸–å­é¢†åŸŸï¼Œä¸€ä¸ªäººæ˜¯ä¾èµ–äºå¸–å­æ‰èƒ½æˆä¸ºä½œè€…ï¼Œæ˜¯ä¸€ä¸ªå€¼å¯¹è±¡\n\n**åœ¨DDDé‡Œé¢ï¼Œä¸€ä¸ªé¢†åŸŸçš„å®ä½“ï¼Œåœ¨å¦ä¸€ä¸ªé¢†åŸŸä¸­é€šå¸¸ä½œä¸ºå€¼å¯¹è±¡ã€å¦ä¸€ä¸ªå®ä½“çš„å±æ€§å‡ºç°**\n\n## æ•°æ®åŒæ­¥\n\n### èŒè´£åˆ’åˆ†\n\n> ç”±ä¹‹å‰çš„åˆ†æå¯çŸ¥ï¼Œæˆ‘ä»¬éœ€è¦ä¸€ä¸ªåˆ¶ä½œè¡¨å’Œçº¿ä¸Šè¡¨ï¼Œé‚£ä¹ˆè¯¥æœ‰å“ªä¸€ä¸ªéƒ¨åˆ†æ¥åŒæ­¥ä¸¤ä¸ªè¡¨çš„æ•°æ®å‘¢ï¼Ÿ\n\nç†è®ºä¸Šï¼Œé¡¹ç›®æ˜¯å•ä½“åº”ç”¨è¿˜æ˜¯å¾®æœåŠ¡åº”ç”¨æ˜¯é€‰æ‹©æ—¶éœ€è¦å‚è€ƒçš„å› ç´ \n\n- web/èšåˆæœåŠ¡\n  - è°ƒç”¨ä¸åŒçš„serviceæ¥åŒæ­¥æ•°æ®ï¼Œå¯ä»¥ç†è§£ä¸ºä½œè€…å’Œè¯»è€…å„æœ‰å„çš„æœåŠ¡\n- service\n  - è°ƒç”¨ä¸åŒçš„repositoryæ¥ä¿å­˜æ•°æ®ï¼Œä»å­˜å‚¨çš„è§’åº¦çœ‹æ¥ï¼Œä½œè€…çœ‹åˆ°çš„å¸–å­å’Œè¯»è€…çœ‹åˆ°çš„å¸–å­æ˜¯ä¸ä¸€æ ·çš„\n- repository\n  - æ“ä½œä¸åŒçš„æ•°æ®æº\n\n**ä¸šåŠ¡ç®€å•å°±ä¸€ä¸ªrepositoryï¼Œå¤æ‚å°±ç”¨å¤šä¸ªrepository**\n\n<img src=\"https://raw.githubusercontent.com/lyydsheep/pic/main/202409271441109.png\" alt=\"image-20240927144102855\" style=\"zoom:50%;\" />\n\n### ç»´æŠ¤äº‹åŠ¡\n\nåŒæ­¥åˆ¶ä½œåº“å’Œçº¿ä¸Šåº“è¦ä¹ˆåŒæ—¶æˆåŠŸï¼Œè¦ä¹ˆåŒæ—¶å¤±è´¥ï¼Œå› æ­¤å°†æ•°æ®åŒæ­¥æ“ä½œåšæˆä¸€ä¸ªäº‹åŠ¡å†åˆé€‚ä¸è¿‡äº†\n\nå¯ä»¥åœ¨ä¸¤ä¸ªå±‚é¢ä¸Šç»´æŠ¤äº‹åŠ¡ï¼Œä¸€ä¸ªæ˜¯`repository`ï¼Œå¦ä¸€ä¸ªæ˜¯`dao`ã€‚ä½†æ˜¯`repository`åœ¨DDDä¸­åº”è¯¥æ˜¯æ“ä½œæ•°æ®åº“å’Œç¼“å­˜çš„ï¼Œå¦‚æœåœ¨è¿™ä¸€å±‚é¢ç»´æŠ¤äº‹åŠ¡ï¼Œç»“æœå°±æ˜¯è·¨å±‚æ“ä½œå¹¶å¼ºè€¦åˆäºGORMï¼ˆè€Œä¸”å†™èµ·æ¥ä¸ä¼˜é›…ğŸ¤ªï¼‰ã€‚å¦ä¸€ç§æ–¹æ¡ˆæ˜¯åœ¨`dao`å±‚ä¸­ç»´æŠ¤äº‹åŠ¡ï¼ˆè¿™å°±æ–¹ä¾¿å¤šå•¦ğŸ˜Šï¼‰ï¼Œå…·ä½“å®ç°å¦‚ä¸‹\n\n```go\nfunc (dao *BasicArticleDAO) Sync(ctx context.Context, article Article) (int, error) {\n\tid := article.Id\n\t// åˆ©ç”¨GORMæ§åˆ¶äº‹åŠ¡çš„ç”Ÿå‘½å‘¨æœŸ\n\terr := dao.db.WithContext(ctx).Transaction(func(tx *gorm.DB) error {\n\t\tvar err error\n\t\tif id > 0 {\n\t\t\terr = dao.UpdateById(ctx, article)\n\t\t} else {\n\t\t\tid, err = dao.Insert(ctx, article)\n\t\t}\n\t\tif err != nil {\n\t\t\treturn err\n\t\t}\n\t\treturn dao.Upsert(ctx, PublishArticle{\n\t\t\tArticle: article,\n\t\t})\n\t})\n\treturn id, err\n}\n```\n\nâš ï¸ï¼šGORMçš„`transaction`æ–¹æ³•åœ¨åº•å±‚å®ç°æ—¶å°±å·²ç»å¸®æˆ‘ä»¬ç»´æŠ¤äº†**äº‹åŠ¡çš„ç”Ÿå‘½å‘¨æœŸ**\n\n> é‡ç‚¹æ˜¯å¦‚ä½•åœ¨GORMä¸‹å®ç°Upsertå‡½æ•°\n\n```go\nfunc (dao *BasicArticleDAO) Upsert(ctx context.Context, article PublishArticle) error {\n\tnow := time.Now().UnixMilli()\n\tarticle.Utime = now\n\tarticle.Ctime = now\n\t// Upsertå‡½æ•°åœ¨GORMä¸‹çš„å®ç°\n\treturn dao.db.WithContext(ctx).Clauses(clause.OnConflict{\n\t\tDoUpdates: clause.Assignments(map[string]interface{}{\n\t\t\t\"title\":   article.Title,\n\t\t\t\"content\": article.Content,\n\t\t\t\"utime\":   article.Utime,\n\t\t}),\n\t}).Create(&article).Error\n}\n```\n\nå‘`Clauses`å‡½æ•°ä¸­ä¼ é€’`OnConflict`ç»“æ„ä½“ï¼Œè¡¨ç¤ºå¦‚æœå‘ç”Ÿå†²çªçš„è¯åº”è¯¥åšä»€ä¹ˆäº‹æƒ…\n\n`OnConfilt`ä¸­æœ‰ä¸€äº›æ¯”è¾ƒæœ‰ç”¨çš„å­—æ®µ\n\n```go\n// DoUpdate\t\t---> åšæ›´æ–°æ“ä½œ\n// DoNothing\t---> ä»€ä¹ˆä¹Ÿä¸åš\n// Where\t\t---> æ•°æ®å†²çªäº†å¹¶ä¸”ç¬¦åˆwhereå­å¥ï¼Œå°±æ‰§è¡Œæ›´æ–°æ“ä½œ\n```\n\n**ğŸŒŸï¼šåœ¨ä¸€ä¸ªäº‹åŠ¡ä¸­ï¼Œä¸€ç›´éƒ½æ˜¯åŒä¸€ä¸ªæ•°æ®åº“è¿æ¥**\n\n## ç»´æŠ¤çŠ¶æ€\n\nåœ¨å…ˆå‰çš„åˆ†æä¸­ï¼Œæˆ‘ä»¬çŸ¥é“éœ€è¦æœ‰çº¿ä¸Šåº“å’Œåˆ¶ä½œåº“ä¸¤ä¸ªæ•°æ®å­˜å‚¨çš„åœ°æ–¹ï¼Œè¿™ä¸¤ä¸ªåœ°æ–¹å­˜å‚¨çš„æ•°æ®æœ¬è´¨ä¸Šæ˜¯ä¸€æ ·çš„ï¼Œå› æ­¤ä¸å¿…åˆ›å»ºæ–°çš„é¢†åŸŸå¯¹è±¡æ¥ç»´æŠ¤ï¼Œ**ä½¿ç”¨è¡ç”Ÿç±»å‹æ›´åŠ æ–¹ä¾¿**\n\n### çŠ¶æ€å¸¸é‡å®šä¹‰\n\nåˆ©ç”¨å¸¸é‡è¡¨ç¤ºä¸€ç¯‡å¸–å­çš„ä¸åŒçŠ¶æ€ï¼Œè¿™äº›å¸¸é‡å¯ä»¥ç›´æ¥åˆ©ç”¨`iota`åœ¨`domain`ä¸­å®šä¹‰ã€‚**ä¸€èˆ¬å®šä¹‰å¸¸é‡ï¼Œæœ€å¥½ä¸è¦æŠŠé›¶å€¼åšæˆæœ‰æ„ä¹‰çš„å€¼**ï¼Œå¦åˆ™éš¾ä»¥åŒºåˆ†æ˜¯ç”¨æˆ·æ²¡æœ‰è¾“å…¥è¿˜æ˜¯å‰ç«¯ä¼ é€’é»˜è®¤æ•°æ®\n\n![image-20240927090706192](https://raw.githubusercontent.com/lyydsheep/pic/main/202409270907841.png)\n\n## ä½¿ç”¨MongoDBå­˜å‚¨\n\nç±»ä¼¼äºå¤§æ–‡æœ¬ä¹‹ç±»çš„ä¸œè¥¿ï¼Œé™¤äº†å¯ä»¥ä½¿ç”¨å…³ç³»å‹æ•°æ®åº“ï¼Œä¹Ÿå¯ä»¥è€ƒè™‘ä½¿ç”¨å…¶ä»–å­˜å‚¨åº”ç”¨ï¼Œä¾‹å¦‚MongoDB\n\n**MongoDBå±äºNoSQLï¼ŒNoSQLå³Not Only SQL**ï¼Œä¸ä»…ä»…æ˜¯SQL\n\nNoSQLæ•°æ®åº“çš„äº§ç”Ÿæ˜¯ä¸ºäº†è§£å†³å¤§è§„æ¨¡æ•°æ®é›†åˆã€å¤šç§æ•°æ®ç§ç±»å¸¦æ¥çš„æŒ‘æˆ˜ï¼Œå°¤å…¶æ˜¯å¤§æ•°æ®åº”ç”¨éš¾é¢˜\n\n<img src=\"https://raw.githubusercontent.com/lyydsheep/pic/main/202409301530245.png\" alt=\"image-20240930153021471\" style=\"zoom:50%;\" />\n\n### MongoDBç®€ä»‹\n\nMongoDBçš„åŸºæœ¬ç‰¹æ€§\n\n- **é¢å‘é›†åˆå­˜å‚¨**ï¼šMongoDBé›†åˆä¸­å¯ä»¥å­˜å‚¨å¤šä¸ªæ–‡æ¡£\n  - ç±»æ¯”äºMySQLï¼ŒMongoDBä¸­çš„ä¸€ä¸ªé›†åˆå°±åƒæ˜¯ä¸€å¼ è¡¨ï¼Œé›†åˆä¸­çš„ä¸€ä¸ªæ–‡æ¡£å°±ç›¸å½“äºè¡¨ä¸­çš„ä¸€æ¡è®°å½•\n- **æ¨¡å¼è‡ªç”±**ï¼šMongoDBé‡‡ç”¨æ— ç»“æ„æ¨¡å¼å­˜å‚¨æ•°æ®ï¼Œä¹Ÿå°±æ˜¯è¯´ï¼Œåœ¨å‚¨å­˜æ•°æ®ä¹‹å‰ä¸éœ€è¦å®šä¹‰æ•°æ®çš„ç»“æ„\n  - å°±åƒå½“äºåœ¨MySQLä¸­ä¸éœ€è¦é¢„å…ˆå»ºç«‹è¡¨ç»“æ„å°±èƒ½æ’å…¥æ•°æ®\n- **æ”¯æŒåˆ†ç‰‡**ï¼šMongoDBæ”¯æŒåˆ†ç‰‡ï¼Œå¹¶ä¸”MongoDBè‡ªåŠ¨è§£å†³äº†åˆ†ç‰‡çš„å„ç§é—®é¢˜ï¼ŒåŒ…æ‹¬è‡ªåŠ¨åŒ–æ‰©å®¹\n\n<img src=\"https://raw.githubusercontent.com/lyydsheep/pic/main/202409301530677.png\" alt=\"image-20240930153009489\" style=\"zoom:67%;\" />\n\né€‰æ‹©MongoDBçš„ä¸¤ä¸ªç†ç”±ï¼š\n\n- **çµæ´»çš„æ–‡æ¡£æ¨¡å‹**ï¼šäºMySQLä¸åŒï¼Œä¸éœ€è¦äº‹å‰åœ¨MongoDBä¸­å®šä¹‰æ–‡æ¡£æ¨¡å‹ï¼Œå¹¶ä¸”å¯ä»¥çµæ´»ä¿®æ”¹\n\n- **æ˜“äºæ¨ªå‘æ‰©å±•**ï¼šå¯ä»¥é€šè¿‡å¢åŠ MongoDBå®ä¾‹æ¥åº”ä»˜æµé‡å’Œæ•°æ®å¢é•¿\n\n### åˆå§‹åŒ–å®¢æˆ·ç«¯å¹¶æ’å…¥æ–‡æ¡£\n\n> éœ€è¦ä½¿ç”¨MongoDBå®˜ç½‘çš„go-driver\n\n![image-20240930194117517](https://raw.githubusercontent.com/lyydsheep/pic/main/202409301941675.png)\n\n### æŸ¥æ‰¾æ–‡æ¡£\n\nåœ¨MongoDBä¸­æœ‰ä¸¤ç§æ„é€ æŸ¥è¯¢æ¡ä»¶çš„æ–¹å¼ï¼š\n\n- **bson**\n- **ç»“æ„ä½“**\n\n```go\n\t// ä½¿ç”¨bsonæ„é€ æŸ¥è¯¢æ¡ä»¶\n\tfilter := bson.D{bson.E{Key: \"id\", Value: 123}}\n\tvar art Article\n\terr = col.FindOne(ctx, filter).Decode(&art)\n\tassert.NoError(t, err)\n\tfmt.Printf(\"find article %v\\n\", art)\n\t// ä½¿ç”¨ç»“æ„ä½“æ„é€ æŸ¥è¯¢æ¡ä»¶\n\terr = col.FindOne(ctx, Article{Id: 123}).Decode(&art)\n\tif errors.Is(err, mongo.ErrNoDocuments) {\n\t\tfmt.Printf(\"find none\")\n\t}\n```\n\nâš ï¸ï¼šä½¿ç”¨ç»“æ„ä½“æ„é€ æŸ¥è¯¢æ¡ä»¶æ—¶ï¼Œmongodb-go-driveré»˜è®¤ä½¿ç”¨ç»“æ„ä½“çš„å…¨éƒ¨å­—æ®µä½œä¸ºåŒ¹é…æ¡ä»¶ï¼Œéœ€è¦æ³¨æ„æŸäº›å­—æ®µ**é»˜è®¤é›¶å€¼**ã€‚å½“ç„¶ï¼Œå¯ä»¥ä½¿ç”¨`bson:\"field_name,omitempty\"`æ ‡ç­¾æ¥å‘ŠçŸ¥mongodb-go-driverå¿½ç•¥å­—æ®µé›¶å€¼\n\nğŸŒŸï¼šå¯ä»¥ä½¿ç”¨`mongo.ErrNoDocuments`é”™è¯¯å€¼æ£€éªŒæ˜¯å¦æœ‰æŸ¥è¯¢åˆ°æ–‡æ¡£\n\n### æ›´æ–°æ–‡æ¡£\n\n- æ„é€ æ›´æ–°æ¡ä»¶ï¼ŒåŒæ„é€ æŸ¥è¯¢æ¡ä»¶\n- æ„é€ æ›´æ–°å­—æ®µ\n  - **bson**\n  - **ç»“æ„ä½“**\n\nâš ï¸ï¼šåŒæ ·çš„ï¼Œéœ€è¦æ³¨æ„**åº•å±‚æ˜¯å¦ä¼šé‡‡ç”¨å­—æ®µé›¶å€¼**\n\n```go\n\tsets := bson.D{bson.E{Key: \"$set\",\n\t\tValue: bson.E{Key: \"content\", Value: \"serious content\"}}}\n\tres, err := col.UpdateOne(ctx, filter, sets)\n\t// ä½¿ç”¨ç»“æ„ä½“æ„é€ æ›´æ–°å­—æ®µ\n\tres, err = col.UpdateOne(ctx, filter, bson.D{bson.E{Key: \"$set\", Value: Article{\n\t\tTitle: \"new title\",\n\t}}})\n```\n\n### åˆ›å»ºç´¢å¼•\n\nç±»ä¼¼äºMySQLï¼Œ**ä¸€èˆ¬æ˜¯æ ¹æ®ä¸šåŠ¡ä¸­å¸¸ç”¨çš„æŸ¥è¯¢æ¡ä»¶ï¼Œæ¥å†³å®šåœ¨ä»€ä¹ˆåˆ—ä¸Šæ„å»ºç´¢å¼•**\n\n```go\n\tindexRes, err := col.Indexes().CreateOne(ctx, mongo.IndexModel{\n\t\tKeys:    bson.M{\"id\": 1},\n\t\tOptions: options.Index().SetUnique(true),\n\t})\n\tfmt.Println(indexRes)\n```\n\n### MongoDBå­˜å‚¨æ•°æ®\n\nç”±äºMongoDBä¸­çš„`_id`å­—æ®µä¸æ˜¯è‡ªå¢å¹¶ä¸”æ˜¯ä¸€ä¸ª**12å­—èŠ‚**çš„åˆ‡ç‰‡ï¼Œå› æ­¤ä¸èƒ½ç›´æ¥ä½¿ç”¨è¿™ä¸ªå­—æ®µä½œä¸ºä¸»é”®\n\nä¸»é”®çš„å¯é€‰æ–¹æ¡ˆï¼š\n\n- **å°†æ•´ä¸ªidä¿®æ”¹ä¸ºstringç±»å‹**\n- **ä½¿ç”¨IDç”Ÿæˆç­–ç•¥**ï¼Œä¾‹å¦‚**é›ªèŠ±ç®—æ³•**\n  - **1æ¯”ç‰¹ä¿ç•™ä½**\n  - **41æ¯”ç‰¹æ—¶é—´æˆ³**\n  - **10æ¯”ç‰¹æœºå™¨ä½**ï¼Œä¸€èˆ¬å«åš`Worker ID`\n  - **12æ¯”ç‰¹è‡ªå¢åºå·**\n  - ![image-20241003154159484](https://raw.githubusercontent.com/lyydsheep/pic/main/202410031541579.png)\n- **ä½¿ç”¨GUID**\n- **å®šä¹‰ä¸€ä¸ªæ–°çš„æ¥å£**ï¼Œä½†è¿™æ ·å°±å¤±å»äº†DAOå±‚çš„ç»Ÿä¸€æ¥å£\n\n**âš ï¸ï¼šåœ¨MongoDBä¸­ï¼Œå°½é‡ä½¿ç”¨è¡ç”Ÿç±»å‹è€Œä¸æ˜¯åµŒå¥—ç»“æ„ä½“ã€‚å› ä¸ºåµŒå¥—ç»“æ„ä½“ä¸­å­ç»“æ„ä½“çš„å­—æ®µæ ‡ç­¾åœ¨æ“ä½œè¿‡ç¨‹ä¸­æ— æ³•æ­£å¸¸ç”Ÿæ•ˆ**\n\n## åˆ©ç”¨OSSæ¥å­˜å‚¨æ•°æ®\n\n> åˆ©ç”¨OSSå­˜å‚¨çº¿ä¸Šæ•°æ®ï¼Œè€Œåç›´æ¥é€šè¿‡CDNåŠ é€Ÿè®¿é—®\n\nOSSï¼ˆObject Storage Serviceï¼‰æ˜¯æŒ‡å…‘ç°å­˜å‚¨ï¼Œ**è¢«å¤§é‡ç”¨äºå­˜å‚¨æ–‡ä»¶ã€æµåª’ä½“ã€å›¾ç‰‡ç­‰**\n\nOSSä¸­çš„ä¸¤ä¸ªæ ¸å¿ƒæ¦‚å¿µï¼š\n\n- **Bucket**ï¼šé€»è¾‘ä¸Šçš„åˆ†ç»„å…³ç³»ï¼Œä¾‹å¦‚æŸä¸ªä¸šåŠ¡ä½¿ç”¨ä¸€ä¸ªæ¡¶ï¼Œå¦ä¸€ä¸ªä¸šåŠ¡ä½¿ç”¨å¦å¤–ä¸€ä¸ªæ¡¶\n- **Object**ï¼šå¯¹è±¡ï¼Œä¹Ÿå°±æ˜¯éœ€è¦å­˜å‚¨çš„ä¸œè¥¿\n\nACLï¼ˆAccess Control Listï¼‰ï¼šæƒé™æ§åˆ¶æ–¹æ¡ˆ\n\n![image-20241004101033272](https://raw.githubusercontent.com/lyydsheep/pic/main/202410041010143.png)\n\nOSSé€šå¸¸å’ŒCDNç»“åˆåœ¨ä¸€èµ·ä½¿ç”¨ï¼Œ**å³åœ¨OSSä¸Šå­˜å‚¨çš„æ•°æ®ï¼Œå¯ä»¥é€šè¿‡CDNæ¥è®¿é—®**\n\nä¸€ç§å¾ˆå¸¸è§çš„æ€§èƒ½å’Œå¯ç”¨æ€§ä¼˜åŒ–æ‰‹æ®µï¼Œå°±æ˜¯ä½¿ç”¨**OSSå’ŒCDNæ¥å­˜å‚¨ç½‘ç«™çš„é™æ€èµ„æº**ï¼Œæ­¤æ—¶OSSè¢«å½“ä½œCDNçš„ä¸€ä¸ªå›æºç«™ç‚¹\n\n![image-20241004101307223](https://raw.githubusercontent.com/lyydsheep/pic/main/202410041013265.png)\n\n## æŸ¥è¯¢æ¥å£ä¸ç¼“å­˜\n\nåœ¨å®ç°æŸ¥è¯¢æ–‡ç« åŠŸèƒ½è¿‡ç¨‹ä¸­ï¼Œéœ€è¦ä»ä¸åŒç”¨æˆ·è§’åº¦å‡ºå‘è¿›è¡Œæ€è€ƒ\n\n- å¯¹äºåˆ›ä½œè€…æ¥è¯´ï¼Œéœ€è¦æŸ¥è¯¢è‡ªå·±çš„**æ–‡ç« åˆ—è¡¨**ä»¥åŠ**æŸä¸€ç¯‡æ–‡ç« çš„è¯¦ç»†å†…å®¹**ï¼Œåˆ†åˆ«å¯¹åº”ç€ä¸¤ä¸ªæ¥å£\n  - åˆ—è¡¨æ¥å£\n  - è¯¦æƒ…æ¥å£\n- å¯¹äºè¯»è€…ï¼Œä»–èƒ½å¤Ÿ**æœç´¢æŸç¯‡æ–‡ç« **ã€**æµè§ˆæ¨èæ–‡ç« åˆ—è¡¨**ã€**é˜…è¯»æ–‡ç« çš„å…·ä½“å†…å®¹**ã€‚ç”±æ­¤å¯è§ï¼Œéœ€è¦æä¾›ä»¥ä¸‹æ¥å£\n  - æœç´¢æ¥å£\n  - æ¨èæ¥å£\n  - é˜…è¯»æ–‡ç« æ¥å£\n\nç›®å‰ä»…å®ç°åˆ›ä½œè€…çš„**åˆ—è¡¨æ¥å£å’Œè¯¦æƒ…æ¥å£**ï¼Œä»¥åŠè¯»è€…çš„**é˜…è¯»æ–‡ç« æ¥å£**\n\n### åˆ—è¡¨æ¥å£\n\n#### éœ€æ±‚åˆ†æ\n\nå‚è€ƒæ˜é‡‘çš„åˆ—è¡¨å±•ç¤ºï¼š\n\n![image-20241006141112588](https://raw.githubusercontent.com/lyydsheep/pic/main/202410061411490.png)\n\nå¯ä»¥å‘ç°ï¼Œåœ¨åˆ—è¡¨ä¸­å±•ç¤ºçš„æ–‡ç« å¯¹è±¡æœ‰å¦‚ä¸‹ç‰¹å¾ï¼š\n\n- æ ‡é¢˜\n- åˆ›å»ºæ—¶é—´\n- ç®€ä»‹\n- ...\n\næ ¹æ®è¿™äº›ç‰¹å¾æˆ‘ä»¬å°±èƒ½å®šä¹‰å‡ºä¸å‰ç«¯ç›¸å¯¹åº”çš„`ArticleVO`\n\nå¦ä¸€ä¸ªå€¼å¾—æ³¨æ„çš„ç‚¹æ˜¯ï¼Œ**æ˜é‡‘åœ¨åˆ—è¡¨ä¸­å±•ç¤ºçš„æ–‡ç« åªæœ‰ä¸€å°éƒ¨åˆ†ï¼Œå½“é¡µé¢ä¸‹æ»‘æ—¶æ‰ä¼šåŠ è½½æ›´å¤šçš„æ–‡ç« **ï¼Œè¿™å°±ç›¸å½“äºä¸€ä¸ª**åˆ†é¡µæŸ¥è¯¢**æ“ä½œ\n\n#### åˆ†é¡µå½¢æ€\n\n**åˆ†é¡µçš„æ ¸å¿ƒç›®æ ‡å°±æ˜¯é¿å…ä¸€æ¬¡æ“ä½œå¤ªå¤šæ•°æ®ï¼Œå¼•å‘æ€§èƒ½é—®é¢˜**ã€‚å†µä¸”ï¼Œåˆ—è¡¨é¡µåœ¨å±•ç¤ºçš„æ—¶å€™ï¼Œä¹Ÿä¸è®¸é‚£ä¹ˆå¤šçš„å†…å®¹ğŸ˜\n\nåˆ†é¡µæ¥å£ä¸€èˆ¬æœ‰ä¸‰ç§å®šä¹‰å½¢å¼ï¼š\n\n- **ç›´æ¥å®šä¹‰`Offset`å’Œ`Limit`å­—æ®µ**\n- **ç›´æ¥å®šä¹‰ä¸€ä¸ª`Page`å­—æ®µï¼Œå¹¶çº¦å®šå¥½Pageçš„å¤§å°**\n- **ç›´æ¥å®šä¹‰ä¸€ä¸ª`Cursor`å­—æ®µ**\n\n<img src=\"https://raw.githubusercontent.com/lyydsheep/pic/main/202410061421861.png\" alt=\"image-20241006142108823\" style=\"zoom: 50%;\" />\n\n### ç¼“å­˜è®¾è®¡\n\n> ç¼“å­˜ç¬¬ä¸€é¡µåˆ†é¡µ\n\nå¤§éƒ¨åˆ†æƒ…å†µä¸‹ï¼Œä¸ä¼šå¯¹åˆ†é¡µç»“æœè¿›è¡Œç¼“å­˜ï¼Œ**å› ä¸ºå¦‚æœæ•°æ®çš„ç­›é€‰æ¡ä»¶ã€æ’åºæ¡ä»¶ã€åˆ†é¡µæ¡ä»¶ã€åˆ†é¡µçš„åç§»é‡å’Œæ•°æ®é‡ä¸­çš„ä»»ä½•ä¸€ä¸ªå‘ç”Ÿäº†å˜åŒ–ï¼Œç¼“å­˜å°±å¾ˆéš¾ä½¿ç”¨äº†**\n\nä½†å¯ä»¥åª**ç¼“å­˜ç¬¬ä¸€é¡µ**ï¼Œæ¯•ç«Ÿå¤§éƒ¨åˆ†ç”¨æˆ·åªçœ‹åˆ—è¡¨çš„ç¬¬ä¸€é¡µ\n\næœ‰äº†ç¼“å­˜ä¹‹åï¼Œ**æ¯æ¬¡è¿›è¡Œæ›´æ–°æ“ä½œéƒ½è¦å°†ç¼“å­˜åˆ é™¤ï¼Œé˜²æ­¢ç¼“å­˜ä¸ä¸€è‡´é—®é¢˜**\n\n> ä¸šåŠ¡ç›¸å…³çš„é¢„åŠ è½½\n\n**é¢„åŠ è½½æœ¬è´¨ä¸Šå°±æ˜¯é¢„åˆ¤ç”¨æˆ·å°†è¦è¯»å–çš„å†…å®¹ï¼Œæå‰å°†å†…å®¹å­˜å…¥ç¼“å­˜ä¸­**\n\nè€Œä¸”ï¼Œå› ä¸ºæ˜¯é¢„æµ‹æ€§è´¨çš„ï¼Œæ‰€ä»¥è¿‡æœŸæ—¶é—´è®¾ç½®å¾—å¾ˆçŸ­\n\n![image-20241006151243081](https://raw.githubusercontent.com/lyydsheep/pic/main/202410061512142.png)\n\n> ä¸ç¼“å­˜å¤§æ–‡æ¡£ï¼ˆè°ƒä¼˜ğŸ˜‚ï¼‰\n\nå¯ä»¥è€ƒè™‘åœ¨Rediså†…å­˜æ¶ˆè€—å’Œç¼“å­˜æ€§èƒ½ä¹‹é—´åšä¸€ä¸ªæƒè¡¡\n\nä¹Ÿå°±æ˜¯è¯´ï¼Œå¹¶ä¸æ˜¯æ‰€æœ‰çš„å€¼éƒ½éœ€è¦ç¼“å­˜ï¼Œ**æœ‰ä¸€äº›å¾ˆå ç”¨å†…å­˜ç©ºé—´çš„æ–‡ç« å°±ä¸å¿…ç¼“å­˜**\n\n#### ç¼“å­˜è¿‡æœŸæ—¶é—´\n\nç¼“å­˜çš„è¿‡æœŸæ—¶é—´å’Œç¼“å­˜å‘½ä¸­ç‡æœ‰å…³ï¼Œä¸€èˆ¬æƒ…å†µä¸‹ï¼Œ**è¿‡æœŸæ—¶é—´è¶Šé•¿ï¼Œå‘½ä¸­ç‡è¶Šé«˜ï¼Œä½†æ•°æ®ä¸€è‡´æ€§ä¼šå˜å·®ï¼›è¿‡æœŸæ—¶é—´è¶ŠçŸ­ï¼Œå‘½ä¸­ç‡è¶Šä½ï¼Œä½†æ•°æ®ä¸€è‡´æ€§ä¼šæ›´å¥½**\n\n- ä¸šåŠ¡ç›¸å…³çš„ç¼“å­˜é¢„åŠ è½½ï¼Œè¿‡æœŸæ—¶é—´è¦çŸ­\n- æ ¹æ®ç”¨æˆ·èº«ä»½æŒ‰æƒç»™äºˆä¸åŒçš„ç¼“å­˜æ—¶é—´\n\n#### æ·˜æ±°ç­–ç•¥\n\næ·˜æ±°ç­–ç•¥æ˜¯æŒ‡åœ¨ç¼“å­˜å†…å­˜ä¸å¤Ÿç”¨çš„æƒ…å†µä¸‹ï¼Œæ·˜æ±°æŸä¸€éƒ¨åˆ†æ•°æ®æ—¶çš„è®¡åˆ’\n\nå¸¸è§„æ–¹æ¡ˆå°±æ˜¯**LRUå’ŒLFU**\n\nè¿˜æœ‰ä¸€äº›æ–¹æ¡ˆï¼š\n\n- ä¼˜å…ˆæ·˜æ±°æ™®é€šåˆ›ä½œè€…çš„æ•°æ®ï¼Œç•™ä¸‹å¤§vçš„æ•°æ®\n- ä¼˜å…ˆæ·˜æ±°å¤§å¯¹è±¡ï¼Œé‡Šæ”¾å‡ºæ›´å¤šçš„å†…å­˜ç©ºé—´\n- ä¼˜å…ˆæ·˜æ±°å°å¯¹è±¡ï¼Œç›¸æ¯”äºå¤§å¯¹è±¡ï¼Œå°å¯¹è±¡åœ¨ä»æ•°æ®åº“ï¼ˆæˆ–OSSï¼‰ä¸­è·å–æ›´åŠ è¿…é€Ÿ\n\n### æ³¨æ„äº‹é¡¹\n\n- ä½¿ç”¨`wrapbodyandtoken`ç»Ÿä¸€å¤„ç†Bodyå’ŒTokenä¸­çš„æ•°æ®\n- è€ƒè™‘åˆ°ä¸­æ–‡å­—ç¬¦ç”±å¤šä¸ªå­—èŠ‚ç»„æˆï¼Œåœ¨å¤„ç†åŒ…å«ä¸­æ–‡çš„å­—ç¬¦ä¸²æ—¶ï¼Œåº”å®ç°å°†å…¶è½¬ä¸º`[]rune`å†è¿›è¡Œ`len()`æ“ä½œ\n- éœ€è¦å°†å­˜å‚¨å¯¹è±¡è½¬æ¢ä¸º`json`æ ¼å¼åæ‰èƒ½å­˜å…¥Redisä¸­ï¼Œå¦åˆ™ä¼šæŠ¥é”™\n\n\n\n\n\n","slug":"å‘å¸–åŠŸèƒ½å®ç°","published":1,"date":"2024-12-27T11:03:15.344Z","updated":"2024-12-27T11:03:15.344Z","comments":1,"layout":"post","photos":[],"_id":"cm6c7md6j000va5t2aa62c9mc","content":"<h1 id=\"å‘å¸–åŠŸèƒ½å®ç°\"><a href=\"#å‘å¸–åŠŸèƒ½å®ç°\" class=\"headerlink\" title=\"å‘å¸–åŠŸèƒ½å®ç°\"></a>å‘å¸–åŠŸèƒ½å®ç°</h1><h2 id=\"éœ€æ±‚åˆ†æ\"><a href=\"#éœ€æ±‚åˆ†æ\" class=\"headerlink\" title=\"éœ€æ±‚åˆ†æ\"></a>éœ€æ±‚åˆ†æ</h2><h3 id=\"ç”¨ä¾‹\"><a href=\"#ç”¨ä¾‹\" class=\"headerlink\" title=\"ç”¨ä¾‹\"></a>ç”¨ä¾‹</h3><blockquote>\n<p>é€šè¿‡ä½¿ç”¨ç”¨ä¾‹æ¥å±•ç¤ºæŸä¸ªéœ€æ±‚çš„å…·ä½“ä½¿ç”¨åœºæ™¯</p>\n</blockquote>\n<img src=\"https://raw.githubusercontent.com/lyydsheep/pic/main/202409092129324.png\" width=300>\n\n<ul>\n<li>åˆ›ä½œè€…<ul>\n<li>å¢åˆ æ”¹æŸ¥</li>\n</ul>\n</li>\n<li>è¯»è€…<ul>\n<li>æŸ¥</li>\n</ul>\n</li>\n</ul>\n<h3 id=\"å†…å®¹çš„å¯è§æ€§\"><a href=\"#å†…å®¹çš„å¯è§æ€§\" class=\"headerlink\" title=\"å†…å®¹çš„å¯è§æ€§\"></a>å†…å®¹çš„å¯è§æ€§</h3><blockquote>\n<p>åˆ›ä½œè€…åˆ›ä½œäº†ä¸€ç¯‡æ–‡ç« ï¼Œé‚£ä¹ˆè¿™ç¯‡æ–‡ç« ä»€ä¹ˆæƒ…å†µä¸‹å¯ä»¥è¢«è¯»è€…çœ‹åˆ°å‘¢ï¼Ÿ</p>\n</blockquote>\n<p>æ ¹æ®ç”Ÿæ´»ç»éªŒï¼Œå¯ä»¥å¾ˆå®¹æ˜“æƒ³åˆ°ï¼šä¸€ç¯‡æ–‡ç« åªæœ‰åœ¨å‘è¡¨ï¼ˆé€šè¿‡å®¡æ ¸ï¼‰å¹¶ä¸”å¤„äºå…¬å¼€çŠ¶æ€ä¸‹æ‰èƒ½è¢«ç”¨æˆ·æ‰€çœ‹åˆ°ã€‚å¦‚æ­¤ï¼Œä¸€ç¯‡å¸–å­å°±æœ‰äº†å‘è¡¨å’Œæœªå‘è¡¨ä¸¤ä¸ªçŠ¶æ€ï¼Œæˆ‘ä»¬å¯ä»¥å¾ˆè½»æ¾åœ°å¾—å‡ºä¸€ç¯‡å¸–å­çš„<strong>çŠ¶æ€</strong>è½¬æ¢å›¾</p>\n<p><img src=\"https://raw.githubusercontent.com/lyydsheep/pic/main/202409092140450.png\" alt=\"image-20240909214045416\"></p>\n<p>æƒ³è±¡è¿™ä¹ˆä¸€ä¸ªåœºæ™¯ï¼Œç”¨æˆ·æ­£åœ¨æµè§ˆæ–‡ç« ï¼Œä¸æ­¤åŒæ—¶ä½œè€…ä¹Ÿåœ¨ä¿®æ”¹æ–‡ç« ï¼Œé‚£ä¹ˆç”¨æˆ·ä¼šå®æ—¶çœ‹åˆ°ä½œè€…çš„ä¿®æ”¹å—ï¼Ÿ</p>\n<p>è¿™å½“ç„¶ä¸ä¼šï¼Œåœ¨åˆ›ä½œè€…å‘å¸ƒä¹‹å‰ï¼Œè¿™äº›ä¿®æ”¹å¯¹è¯»è€…éƒ½æ˜¯ä¸å¯è§çš„</p>\n<p>ä¸€ç§å¾ˆæ˜¾ç„¶çš„è§£å†³åŠæ³•å°±æ˜¯<strong>åˆ†å¼€å­˜å‚¨</strong>ï¼Œå³ä¸€ä¸ª<strong>åˆ¶ä½œè¡¨</strong>ï¼Œä¸€ä¸ª<strong>çº¿ä¸Šè¡¨</strong></p>\n<p>ç”¨æˆ·çœ‹åˆ°çš„æ˜¯çº¿ä¸Šè¡¨ä¸­çš„æ•°æ®ï¼Œè€Œä½œè€…ä¿®æ”¹çš„éƒ½æ˜¯åˆ¶ä½œè¡¨ä¸­çš„æ•°æ®ï¼Œè¿™æ ·ä½œè€…çš„ä¿®æ”¹å¯¹äºç”¨æˆ·è€Œè¨€éƒ½æ˜¯ä¸å¯çŸ¥çš„ï¼Œåªæœ‰å½“çº¿ä¸Šè¡¨æ›´æ–°åï¼Œç”¨æˆ·æ‰èƒ½çœ‹åˆ°ä¿®æ”¹</p>\n<p>æ•´ç†ä¸Šè¿°åˆ†æï¼Œå¯ä»¥å¾—åˆ°æ›´è¯¦ç»†çš„çŠ¶æ€å›¾ï¼š</p>\n<p><img src=\"https://raw.githubusercontent.com/lyydsheep/pic/main/202409102004630.png\" alt=\"image-20240910200443544\"></p>\n<h3 id=\"æµç¨‹åˆ†æ\"><a href=\"#æµç¨‹åˆ†æ\" class=\"headerlink\" title=\"æµç¨‹åˆ†æ\"></a>æµç¨‹åˆ†æ</h3><p>æˆ‘ä»¬å°†ä¸¤ä¸ªè¡¨ï¼ˆåˆ¶ä½œè¡¨ã€çº¿ä¸Šè¡¨ï¼‰çš„çŠ¶æ€ï¼Œåˆ†åˆ«ç”¨ä¸€ä½äºŒè¿›åˆ¶è¡¨ç¤ºï¼Œå¯ä»¥å¾—å‡º3ä¸­èµ·å§‹çŠ¶æ€ï¼ˆæœ‰ä¸€ç§çŠ¶æ€ä¸å¯èƒ½å­˜åœ¨ï¼‰</p>\n<ul>\n<li>0 0ï¼šåˆ¶ä½œè¡¨å’Œçº¿ä¸Šè¡¨éƒ½æ²¡æœ‰æ•°æ®</li>\n<li>1 0ï¼šåªæœ‰åˆ¶ä½œè¡¨ä¸­æœ‰æ•°æ®</li>\n<li>1 1ï¼šåˆ¶ä½œè¡¨å’Œçº¿ä¸Šè¡¨éƒ½æœ‰æ•°æ®</li>\n</ul>\n<p>åˆ†ææ¯ä¸€ç§èµ·å§‹çŠ¶æ€å¯èƒ½çš„åç»­çŠ¶æ€</p>\n<ul>\n<li>0 0<ul>\n<li>1 0ï¼šä½œè€…å†™äº†ä¸€åŠï¼Œæœ¨æœ‰å‘è¡¨</li>\n<li>1 1ï¼šä½œè€…å†™å¥½å¹¶å‘è¡¨äº†æ–‡ç« </li>\n<li><img src=\"https://raw.githubusercontent.com/lyydsheep/pic/main/202409102014800.png\" alt=\"image-20240910201425755\"></li>\n</ul>\n</li>\n<li>1 0<ul>\n<li>1 1ï¼šä½œè€…å†™å¥½å¹¶å‘è¡¨äº†æ–‡ç« </li>\n<li><img src=\"https://raw.githubusercontent.com/lyydsheep/pic/main/202409102014565.png\" alt=\"image-20240910201456526\"></li>\n</ul>\n</li>\n<li>1 1<ul>\n<li>1 1ï¼šä½œè€…ä¿®æ”¹æ–‡ç« </li>\n<li><img src=\"https://raw.githubusercontent.com/lyydsheep/pic/main/202409102026434.png\" alt=\"image-20240910202622396\"></li>\n</ul>\n</li>\n</ul>\n<h2 id=\"TDDä¸ç¼–è¾‘æ¥å£\"><a href=\"#TDDä¸ç¼–è¾‘æ¥å£\" class=\"headerlink\" title=\"TDDä¸ç¼–è¾‘æ¥å£\"></a>TDDä¸ç¼–è¾‘æ¥å£</h2><p><strong>TDDï¼šæµ‹è¯•é©±åŠ¨å¼€å‘ï¼Œå…ˆå†™æµ‹è¯•ï¼Œå†å†™å®ç°</strong></p>\n<ul>\n<li>é€šè¿‡æ’°å†™æµ‹è¯•ï¼Œ<strong>ç†æ¸…æ¥šæ¥å£è¯¥å¦‚ä½•å®šä¹‰ï¼Œç«™åœ¨ç”¨æˆ·çš„è§’åº¦çœ‹æ˜¯å¦åˆé€‚</strong></li>\n<li>é€šè¿‡æ’°å†™æµ‹è¯•ç”¨ä¾‹ï¼Œ<strong>ç†æ¸…æ¥šæ•´ä¸ªåŠŸèƒ½è¦è€ƒè™‘çš„ä¸»æµç¨‹ã€å¼‚å¸¸æµç¨‹</strong></li>\n</ul>\n<h3 id=\"æ ¸å¿ƒå¾ªç¯\"><a href=\"#æ ¸å¿ƒå¾ªç¯\" class=\"headerlink\" title=\"æ ¸å¿ƒå¾ªç¯\"></a>æ ¸å¿ƒå¾ªç¯</h3><ul>\n<li>æ ¹æ®å¯¹éœ€æ±‚çš„ç†è§£ï¼Œ<strong>åˆæ­¥å®šä¹‰æ¥å£</strong>ï¼Œæ— æ‰€è°“æ¥å£åˆä¸åˆé€‚ï¼Œåæ­£è¿˜å¾—æ”¹</li>\n<li>æ ¹æ®æ¥å£å®šä¹‰æµ‹è¯•</li>\n<li>æ‰§è¡Œæ ¸å¿ƒå¾ªç¯<ul>\n<li>å¢åŠ æµ‹è¯•ç”¨ä¾‹</li>\n<li>æä¾›&#x2F;ä¿®æ”¹å®ç°</li>\n<li>æ‰§è¡Œæµ‹è¯•ç”¨ä¾‹</li>\n</ul>\n</li>\n</ul>\n<img src=\"https://raw.githubusercontent.com/lyydsheep/pic/main/202409161517114.png\" alt=\"image-20240916151718031\" style=\"zoom:67%;\" />\n\n<h3 id=\"suiteæµ‹è¯•ç»„ç»‡å¥—ä»¶\"><a href=\"#suiteæµ‹è¯•ç»„ç»‡å¥—ä»¶\" class=\"headerlink\" title=\"suiteæµ‹è¯•ç»„ç»‡å¥—ä»¶\"></a>suiteæµ‹è¯•ç»„ç»‡å¥—ä»¶</h3><p><a href=\"https://annatarhe.github.io/2020/08/19/how-to-do-test-in-go.html\">å‚è€ƒæ–‡ç« </a></p>\n<p>æœ‰çš„æ—¶å€™åœ¨æµ‹è¯•ä¹‹å‰éœ€è¦è¿æ¥dbã€redisã€rpcä¹‹ç±»çš„ä¸œè¥¿ï¼Œç„¶åå†æµ‹è¯•ç»“æŸåå°†è¿™äº›è¿æ¥å…³é—­ã€‚ä¹Ÿå°±æ˜¯è¯´ï¼Œæˆ‘ä»¬çš„å•å…ƒï¼ˆé›†æˆï¼‰æµ‹è¯•å…·æœ‰<strong>ç”Ÿå‘½å‘¨æœŸ</strong>ã€‚å¦‚æœæ˜¯æ‰‹åŠ¨ç¼–å†™è¿æ¥ã€å…³é—­è¿æ¥çš„ä»£ç ä¼šä½¿å¾—æµ‹è¯•éƒ¨åˆ†æ˜¾å¾—å¼‚å¸¸è‡ƒè‚¿ï¼Œå¥½åœ¨æœ‰<code>suite</code>å¯ä»¥å¸®åŠ©æˆ‘ä»¬æœ‰æ•ˆåœ°ç®¡ç†æµ‹è¯•çš„ç”Ÿå‘½å‘¨æœŸ</p>\n<figure class=\"highlight go\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br><span class=\"line\">31</span><br><span class=\"line\">32</span><br><span class=\"line\">33</span><br><span class=\"line\">34</span><br><span class=\"line\">35</span><br><span class=\"line\">36</span><br><span class=\"line\">37</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">import</span> (</span><br><span class=\"line\">    <span class=\"string\">&quot;testing&quot;</span></span><br><span class=\"line\">    <span class=\"string\">&quot;github.com/stretchr/testify/assert&quot;</span></span><br><span class=\"line\">    <span class=\"string\">&quot;github.com/stretchr/testify/suite&quot;</span></span><br><span class=\"line\">)</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\">// å®šä¹‰æµ‹è¯•ç»“æ„ä½“</span></span><br><span class=\"line\"><span class=\"keyword\">type</span> ExampleTestSuite <span class=\"keyword\">struct</span> &#123;</span><br><span class=\"line\">    suite.Suite</span><br><span class=\"line\">    msg <span class=\"type\">string</span></span><br><span class=\"line\">&#125;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\">// æµ‹è¯•å‰çš„é¢„å¤‡</span></span><br><span class=\"line\"><span class=\"function\"><span class=\"keyword\">func</span> <span class=\"params\">(suite *ExampleTestSuite)</span></span> SetupTest() &#123;</span><br><span class=\"line\">    suite.msg = <span class=\"string\">&quot;iu is my wife&quot;</span></span><br><span class=\"line\">    db, _ = sql.Open(<span class=\"string\">&quot;xxx&quot;</span>)</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\">// æµ‹è¯•</span></span><br><span class=\"line\"><span class=\"function\"><span class=\"keyword\">func</span> <span class=\"params\">(suite *ExampleTestSuite)</span></span> TestExample() &#123;</span><br><span class=\"line\">    m := &amp;obj&#123;</span><br><span class=\"line\">        Msg: suite.msg</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">    err := insert(m)</span><br><span class=\"line\">    assert.Nil(suite.T(), err)</span><br><span class=\"line\">    assert.Equal(suite.T(), suite.msg, m.Msg)</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\">// æµ‹è¯•åçš„æ¸…ç†</span></span><br><span class=\"line\"><span class=\"function\"><span class=\"keyword\">func</span> <span class=\"params\">(suite *ExampleTestSuite)</span></span> TearDownTest() &#123;</span><br><span class=\"line\">    db.Close()</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\">// å…¥å£</span></span><br><span class=\"line\"><span class=\"function\"><span class=\"keyword\">func</span> <span class=\"title\">TestExampleTestSuite</span><span class=\"params\">(t *testing.T)</span></span> &#123;</span><br><span class=\"line\">    suite.Run(t, <span class=\"built_in\">new</span>(ExampleTestSuite))</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n\n<p>äº”ä¸ªæ­¥éª¤</p>\n<ul>\n<li><strong>å®šä¹‰æµ‹è¯•ç»“æ„ä½“</strong><ul>\n<li>æµ‹è¯•ç»“æ„ä½“ä¸­åº”åŒ…å«æ‰€éœ€è¦çš„ç¬¬ä¸‰æ–¹å­—æ®µï¼Œä¾‹å¦‚<code>suite.Suite</code>,<code>gorm.DB</code>, <code>redis.Cmdable</code>ç­‰</li>\n</ul>\n</li>\n<li><strong>å…¥å£å‡½æ•°</strong><ul>\n<li><code>func TestExampleTestSuite(t *testing.T)</code></li>\n<li>å‡½æ•°ä½“ä¸­ä»…æœ‰<code>suite.Run(t, new(xxx))</code>ä¸€è¡Œä»£ç </li>\n</ul>\n</li>\n<li><strong>æµ‹è¯•å‰çš„å‡†å¤‡å·¥ä½œ</strong><ul>\n<li><code>func (suite *ExampleTestSuite) SetupTest()</code></li>\n</ul>\n</li>\n<li>æµ‹è¯•<ul>\n<li><code>func (suite *ExampleTestSuite) TestExample()</code></li>\n</ul>\n</li>\n<li><strong>æµ‹è¯•åçš„æ¸…ç†</strong><ul>\n<li><code>func (suite *ExampleTestSuite) TearDownTest()</code></li>\n</ul>\n</li>\n</ul>\n<h3 id=\"TDDé›†æˆæµ‹è¯•å®è·µï¼ˆä¸€ï¼‰\"><a href=\"#TDDé›†æˆæµ‹è¯•å®è·µï¼ˆä¸€ï¼‰\" class=\"headerlink\" title=\"TDDé›†æˆæµ‹è¯•å®è·µï¼ˆä¸€ï¼‰\"></a>TDDé›†æˆæµ‹è¯•å®è·µï¼ˆä¸€ï¼‰</h3><figure class=\"highlight go\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br><span class=\"line\">31</span><br><span class=\"line\">32</span><br><span class=\"line\">33</span><br><span class=\"line\">34</span><br><span class=\"line\">35</span><br><span class=\"line\">36</span><br><span class=\"line\">37</span><br><span class=\"line\">38</span><br><span class=\"line\">39</span><br><span class=\"line\">40</span><br><span class=\"line\">41</span><br><span class=\"line\">42</span><br><span class=\"line\">43</span><br><span class=\"line\">44</span><br><span class=\"line\">45</span><br><span class=\"line\">46</span><br><span class=\"line\">47</span><br><span class=\"line\">48</span><br><span class=\"line\">49</span><br><span class=\"line\">50</span><br><span class=\"line\">51</span><br><span class=\"line\">52</span><br><span class=\"line\">53</span><br><span class=\"line\">54</span><br><span class=\"line\">55</span><br><span class=\"line\">56</span><br><span class=\"line\">57</span><br><span class=\"line\">58</span><br><span class=\"line\">59</span><br><span class=\"line\">60</span><br><span class=\"line\">61</span><br><span class=\"line\">62</span><br><span class=\"line\">63</span><br><span class=\"line\">64</span><br><span class=\"line\">65</span><br><span class=\"line\">66</span><br><span class=\"line\">67</span><br><span class=\"line\">68</span><br><span class=\"line\">69</span><br><span class=\"line\">70</span><br><span class=\"line\">71</span><br><span class=\"line\">72</span><br><span class=\"line\">73</span><br><span class=\"line\">74</span><br><span class=\"line\">75</span><br><span class=\"line\">76</span><br><span class=\"line\">77</span><br><span class=\"line\">78</span><br><span class=\"line\">79</span><br><span class=\"line\">80</span><br><span class=\"line\">81</span><br><span class=\"line\">82</span><br><span class=\"line\">83</span><br><span class=\"line\">84</span><br><span class=\"line\">85</span><br><span class=\"line\">86</span><br><span class=\"line\">87</span><br><span class=\"line\">88</span><br><span class=\"line\">89</span><br><span class=\"line\">90</span><br><span class=\"line\">91</span><br><span class=\"line\">92</span><br><span class=\"line\">93</span><br><span class=\"line\">94</span><br><span class=\"line\">95</span><br><span class=\"line\">96</span><br><span class=\"line\">97</span><br><span class=\"line\">98</span><br><span class=\"line\">99</span><br><span class=\"line\">100</span><br><span class=\"line\">101</span><br><span class=\"line\">102</span><br><span class=\"line\">103</span><br><span class=\"line\">104</span><br><span class=\"line\">105</span><br><span class=\"line\">106</span><br><span class=\"line\">107</span><br><span class=\"line\">108</span><br><span class=\"line\">109</span><br><span class=\"line\">110</span><br><span class=\"line\">111</span><br><span class=\"line\">112</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\">// æµ‹è¯•å¥—ä»¶</span></span><br><span class=\"line\"><span class=\"keyword\">type</span> ArticleSuite <span class=\"keyword\">struct</span> &#123;</span><br><span class=\"line\">\tsuite.Suite</span><br><span class=\"line\">\tserver *gin.Engine</span><br><span class=\"line\">\tdb     *gorm.DB</span><br><span class=\"line\">\tl      *zap.Logger</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\">// SetupTest éƒ½ç”¨startupé‡Œçš„åˆå§‹åŒ–æ–¹æ³•ï¼Œå½“ç„¶ä½¿ç”¨wireç”Ÿæˆå•¦</span></span><br><span class=\"line\"><span class=\"function\"><span class=\"keyword\">func</span> <span class=\"params\">(s *ArticleSuite)</span></span> SetupTest() &#123;</span><br><span class=\"line\">\t<span class=\"keyword\">var</span> err <span class=\"type\">error</span></span><br><span class=\"line\">\ts.l, err = zap.NewDevelopment()</span><br><span class=\"line\">\t<span class=\"keyword\">if</span> err != <span class=\"literal\">nil</span> &#123;</span><br><span class=\"line\">\t\t<span class=\"built_in\">panic</span>(err)</span><br><span class=\"line\">\t&#125;</span><br><span class=\"line\">\ts.db = startup.InitDB(s.l)</span><br><span class=\"line\">\tgin.SetMode(gin.ReleaseMode)</span><br><span class=\"line\">\ts.server = gin.Default()</span><br><span class=\"line\">\t<span class=\"comment\">// åœ¨è¿™é‡Œæ”¾å¥½userClaimsï¼Œè¡¨ç¤ºç™»å½•çŠ¶æ€</span></span><br><span class=\"line\">\ts.server.Use(<span class=\"function\"><span class=\"keyword\">func</span><span class=\"params\">(ctx *gin.Context)</span></span> &#123;</span><br><span class=\"line\">\t\tctx.Set(<span class=\"string\">&quot;userClaims&quot;</span>, jwt.UserClaims&#123;</span><br><span class=\"line\">\t\t\tUserId: <span class=\"number\">123</span>,</span><br><span class=\"line\">\t\t&#125;)</span><br><span class=\"line\">\t&#125;)</span><br><span class=\"line\">\tartHdl := startup.InitArticleHandler()</span><br><span class=\"line\">\tartHdl.RegisterRoutes(s.server)</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"function\"><span class=\"keyword\">func</span> <span class=\"params\">(s *ArticleSuite)</span></span> TestEdit() &#123;</span><br><span class=\"line\">\tt := s.T()</span><br><span class=\"line\">\ttestCases := []<span class=\"keyword\">struct</span> &#123;</span><br><span class=\"line\">\t\tname <span class=\"type\">string</span></span><br><span class=\"line\">\t\t<span class=\"comment\">// å‡†å¤‡æ•°æ®</span></span><br><span class=\"line\">\t\tbefore <span class=\"function\"><span class=\"keyword\">func</span><span class=\"params\">(t *testing.T)</span></span></span><br><span class=\"line\">\t\t<span class=\"comment\">// æ ¡éªŒæ•°æ®</span></span><br><span class=\"line\">\t\tafter   <span class=\"function\"><span class=\"keyword\">func</span><span class=\"params\">(t *testing.T)</span></span></span><br><span class=\"line\">\t\tarticle Article</span><br><span class=\"line\">\t\t<span class=\"comment\">// é¢„æœŸæ•°æ®</span></span><br><span class=\"line\">\t\texpectCode <span class=\"type\">int</span></span><br><span class=\"line\">\t\texpectRes  Result[<span class=\"type\">int</span>]</span><br><span class=\"line\">\t&#125;&#123;</span><br><span class=\"line\">\t\t&#123;</span><br><span class=\"line\">\t\t\tname: <span class=\"string\">&quot;æ–°å»ºå¸–å­â€”â€”ä¿å­˜æˆåŠŸ&quot;</span>,</span><br><span class=\"line\">\t\t\tbefore: <span class=\"function\"><span class=\"keyword\">func</span><span class=\"params\">(t *testing.T)</span></span> &#123;</span><br><span class=\"line\"></span><br><span class=\"line\">\t\t\t&#125;,</span><br><span class=\"line\">\t\t\tafter: <span class=\"function\"><span class=\"keyword\">func</span><span class=\"params\">(t *testing.T)</span></span> &#123;</span><br><span class=\"line\">\t\t\t\t<span class=\"comment\">// å¯¹æ¯ä¸€åˆ—æ•°æ®éƒ½è¦è¿›è¡Œæ£€éªŒ</span></span><br><span class=\"line\">\t\t\t\t<span class=\"keyword\">var</span> article dao.Article</span><br><span class=\"line\">\t\t\t\terr := s.db.Where(<span class=\"string\">&quot;id=?&quot;</span>, <span class=\"number\">1</span>).First(&amp;article).Error</span><br><span class=\"line\">\t\t\t\trequire.NoError(t, err)</span><br><span class=\"line\">\t\t\t\tassert.True(t, article.Ctime &gt; <span class=\"number\">0</span>)</span><br><span class=\"line\">\t\t\t\tassert.True(t, article.Utime &gt; <span class=\"number\">0</span>)</span><br><span class=\"line\">\t\t\t\tarticle.Ctime = <span class=\"number\">0</span></span><br><span class=\"line\">\t\t\t\tarticle.Utime = <span class=\"number\">0</span></span><br><span class=\"line\">\t\t\t\tassert.Equal(t, dao.Article&#123;</span><br><span class=\"line\">\t\t\t\t\tId:       <span class=\"number\">1</span>,</span><br><span class=\"line\">\t\t\t\t\tTitle:    <span class=\"string\">&quot;è¿™æ˜¯æ ‡é¢˜&quot;</span>,</span><br><span class=\"line\">\t\t\t\t\tContent:  <span class=\"string\">&quot;è¿™æ˜¯å†…å®¹&quot;</span>,</span><br><span class=\"line\">\t\t\t\t\tAuthorId: <span class=\"number\">123</span>,</span><br><span class=\"line\">\t\t\t\t&#125;, article)</span><br><span class=\"line\">\t\t\t&#125;,</span><br><span class=\"line\">            article: Article&#123;</span><br><span class=\"line\">                Title: <span class=\"string\">&quot;è¿™æ˜¯æ ‡é¢˜&quot;</span>,</span><br><span class=\"line\">                Content: <span class=\"string\">&quot;è¿™æ˜¯å†…å®¹&quot;</span>,</span><br><span class=\"line\">            &#125;</span><br><span class=\"line\">\t\t\texpectCode: http.StatusOK,</span><br><span class=\"line\">\t\t\texpectRes: Result[<span class=\"type\">int</span>]&#123;</span><br><span class=\"line\">\t\t\t\tData: <span class=\"number\">1</span>,</span><br><span class=\"line\">\t\t\t&#125;,</span><br><span class=\"line\">\t\t&#125;,</span><br><span class=\"line\">\t&#125;</span><br><span class=\"line\">\t<span class=\"keyword\">for</span> _, tc := <span class=\"keyword\">range</span> testCases &#123;</span><br><span class=\"line\">\t\tt.Run(tc.name, <span class=\"function\"><span class=\"keyword\">func</span><span class=\"params\">(t *testing.T)</span></span> &#123;</span><br><span class=\"line\">\t\t\t<span class=\"comment\">//tc.before(t)</span></span><br><span class=\"line\">\t\t\t<span class=\"comment\">// ä»¥jsonæ ¼å¼è¾“å…¥</span></span><br><span class=\"line\">\t\t\tarticleJson, err := json.Marshal(tc.article)</span><br><span class=\"line\">\t\t\trequire.NoError(t, err)</span><br><span class=\"line\">\t\t\treq, err := http.NewRequest(http.MethodPost, <span class=\"string\">&quot;/article/edit&quot;</span>, bytes.NewBuffer(articleJson))</span><br><span class=\"line\">\t\t\treq.Header.Set(<span class=\"string\">&quot;Content-Type&quot;</span>, <span class=\"string\">&quot;application/json&quot;</span>)</span><br><span class=\"line\">\t\t\trequire.NoError(t, err)</span><br><span class=\"line\">\t\t\tresp := httptest.NewRecorder()</span><br><span class=\"line\">\t\t\ts.server.ServeHTTP(resp, req)</span><br><span class=\"line\">\t\t\t<span class=\"keyword\">var</span> res Result[<span class=\"type\">int</span>]</span><br><span class=\"line\">\t\t\tassert.Equal(t, tc.expectCode, resp.Code)</span><br><span class=\"line\">\t\t\terr = json.NewDecoder(resp.Body).Decode(&amp;res)</span><br><span class=\"line\">\t\t\tassert.Equal(t, tc.expectRes, res)</span><br><span class=\"line\">\t\t\t<span class=\"comment\">//tc.after(t)</span></span><br><span class=\"line\">\t\t&#125;)</span><br><span class=\"line\">\t&#125;</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\">// æµ‹è¯•åæ‰€ä½œçš„åŠ¨ä½œ</span></span><br><span class=\"line\"><span class=\"function\"><span class=\"keyword\">func</span> <span class=\"params\">(s *ArticleSuite)</span></span> TearDownTest() &#123;</span><br><span class=\"line\">\ts.db.Exec(<span class=\"string\">&quot;truncate table articles&quot;</span>)</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"function\"><span class=\"keyword\">func</span> <span class=\"title\">TestArticleSuite</span><span class=\"params\">(t *testing.T)</span></span> &#123;</span><br><span class=\"line\">\tsuite.Run(t, <span class=\"built_in\">new</span>(ArticleSuite))</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"keyword\">type</span> Article <span class=\"keyword\">struct</span> &#123;</span><br><span class=\"line\">\tTitle   <span class=\"type\">string</span> <span class=\"string\">`json:&quot;title&quot;`</span></span><br><span class=\"line\">\tContent <span class=\"type\">string</span> <span class=\"string\">`json:&quot;content&quot;`</span></span><br><span class=\"line\">&#125;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"keyword\">type</span> Result[T any] <span class=\"keyword\">struct</span> &#123;</span><br><span class=\"line\">\tMsg  <span class=\"type\">string</span> <span class=\"string\">`json:&quot;msg&quot;`</span></span><br><span class=\"line\">\tCode <span class=\"type\">int</span>    <span class=\"string\">`json:&quot;code&quot;`</span></span><br><span class=\"line\">\tData T      <span class=\"string\">`json:&quot;data&quot;`</span></span><br><span class=\"line\">&#125;</span><br><span class=\"line\"></span><br></pre></td></tr></table></figure>\n\n<ul>\n<li><p>DDDä¾§é‡äºè®¾è®¡æ¶æ„ã€é«˜å±‚æ¬¡æˆ˜ç•¥</p>\n</li>\n<li><p>TDDä¸“æ³¨äºæŸä¸ªåŠŸèƒ½çš„å®ç°</p>\n</li>\n</ul>\n<p>åœ¨å¼€å‘è¿‡ç¨‹ä¸­ï¼Œå¯ä»¥ä½¿ç”¨å¦‚ä¸‹æŠ€å·§ï¼Œç¡®ä¿ç±»å‹å®ç°äº†ç‰¹å®šæ¥å£æ¥å£</p>\n<p>ä¾‹å¦‚ï¼Œç¡®ä¿<code>ArticleHandler</code>ç±»å‹å®ç°äº†<code>handler</code>æ¥å£</p>\n<p><img src=\"https://raw.githubusercontent.com/lyydsheep/pic/main/202409072112298.png\" alt=\"image-20240907211201251\"></p>\n<h3 id=\"TDDé›†æˆæµ‹è¯•å®è·µï¼ˆäºŒï¼‰\"><a href=\"#TDDé›†æˆæµ‹è¯•å®è·µï¼ˆäºŒï¼‰\" class=\"headerlink\" title=\"TDDé›†æˆæµ‹è¯•å®è·µï¼ˆäºŒï¼‰\"></a>TDDé›†æˆæµ‹è¯•å®è·µï¼ˆäºŒï¼‰</h3><p>åœ¨å®ç°å®Œåˆ›å»ºæ–‡ç« åŠŸèƒ½åï¼Œæ¥ç€å°±è¦å®ç°ä¿®æ”¹æ–‡ç« åŠŸèƒ½</p>\n<p>ä¾æ®TDDæ ¸å¿ƒå¾ªç¯ï¼Œéœ€è¦å†æ·»åŠ æµ‹è¯•ç”¨ä¾‹</p>\n<p><img src=\"https://raw.githubusercontent.com/lyydsheep/pic/main/202409161518765.png\" alt=\"image-20240916151741659\"></p>\n<p>ç”±äºæˆ‘ä»¬å°†è¦å®ç°çš„æ˜¯ä¿®æ”¹æ–‡ç« åŠŸèƒ½ï¼Œä¹Ÿå°±æ˜¯è¯´<strong>æ–‡ç« æ˜¯äº‹å…ˆå­˜åœ¨çš„ï¼Œå‰ç«¯è¯·æ±‚å°†ä¼šå¸¦ä¸Šæ–‡ç« çš„Id</strong>ï¼Œé‚£ä¹ˆåœ¨æµ‹è¯•æ—¶éœ€è¦åœ¨<code>before</code>å‡½æ•°ä¸­åšå¥½æ•°æ®çš„å‡†å¤‡å·¥ä½œ</p>\n<figure class=\"highlight go\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">before: <span class=\"function\"><span class=\"keyword\">func</span><span class=\"params\">(t *testing.T)</span></span> &#123;</span><br><span class=\"line\">    err := s.db.Create(&amp;dao.Article&#123;</span><br><span class=\"line\">        Id:      <span class=\"number\">2</span>,</span><br><span class=\"line\">        Title:   <span class=\"string\">&quot;æ—§çš„æ ‡é¢˜&quot;</span>,</span><br><span class=\"line\">        Content: <span class=\"string\">&quot;æ—§çš„æ ‡é¢˜&quot;</span>,</span><br><span class=\"line\">        <span class=\"comment\">// å’Œæ—¶é—´æœ‰å…³çš„æµ‹è¯•ï¼Œæœ€å¥½ä¸ç”¨time.Now(), å› ä¸ºæ¯ä¸€æ¬¡éƒ½ä¸ä¸€æ ·ï¼Œä¸æ–¹ä¾¿è¿›è¡Œæ–­è¨€</span></span><br><span class=\"line\">        AuthorId: <span class=\"number\">123</span>,</span><br><span class=\"line\">        Ctime:    <span class=\"number\">677</span>,</span><br><span class=\"line\">        Utime:    <span class=\"number\">677</span>,</span><br><span class=\"line\">    &#125;).Error</span><br><span class=\"line\">    require.NoError(t, err)</span><br><span class=\"line\">&#125;,</span><br></pre></td></tr></table></figure>\n\n<p>æ›´æ–°æ–‡ç« æ¶‰åŠåˆ°æ›´æ–°æ•°æ®åº“ï¼Œæœ‰ä¸¤ä¸ªå€¼å¾—æ³¨æ„çš„ç‚¹</p>\n<ul>\n<li><p>ä¿®æ”¹<code>utime</code>è¿™ä¸ªè·Ÿæ—¶é—´æœ‰å…³çš„å­—æ®µï¼Œè€Œåœ¨è¿›è¡Œå’Œæ—¶é—´æœ‰å…³çš„æµ‹è¯•æ—¶ï¼Œå°½é‡ä¸è¦ä½¿ç”¨<code>time.Now()</code>å‡½æ•°ï¼Œå› ä¸ºæ¯ä¸€æ¬¡è¿è¡Œ<code>time.Now()</code>ç»“æœéƒ½ä¸ç›¸åŒï¼Œä¸ä¾¿äºåç»­çš„æ–­è¨€æ“ä½œ</p>\n</li>\n<li><p>ä¸¤ç§æ›´æ–°æ“ä½œå†™æ³•</p>\n<ul>\n<li><pre><code class=\"go\">// åˆ©ç”¨äº†gormå¿½ç•¥é›¶å€¼çš„ç‰¹æ€§ï¼Œæ ¹æ®ä¸»é”®ï¼ˆé”å®šè¦æ›´æ–°çš„è¡Œï¼‰è¿›è¡Œæ›´æ–°æ“ä½œ\n// å¯è¯»æ€§å·®\n// å¿½ç•¥é›¶å€¼æ˜¯æŒ‡å¦‚æœæŸä¸ªå­—æ®µæ˜¯åŸæœ¬æ˜¯é›¶å€¼ï¼Œé‚£ä¹ˆå°±ä¸æ›´æ–°è¯¥å­—æ®µ\nerr := dao.db.WithContext(ctx).Updates(&amp;article).Error\n<figure class=\"highlight plaintext\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"></span><br><span class=\"line\">- ```go</span><br><span class=\"line\">  // å¯è¯»æ€§è¾ƒå¼º</span><br><span class=\"line\">  err := dao.db.WithContext(ctx).Model(&amp;article).</span><br><span class=\"line\">  \t\tWhere(&quot;id=?&quot;, article.Id).Updates(map[string]any&#123;</span><br><span class=\"line\">  \t\t&quot;title&quot;:   article.Title,</span><br><span class=\"line\">  \t\t&quot;content&quot;: article.Content,</span><br><span class=\"line\">  \t\t&quot;utime&quot;:   article.Utime,</span><br></pre></td></tr></table></figure>\n</code></pre>\n</li>\n<li><p>å¿½ç•¥é›¶å€¼å¯å‚è€ƒ <a href=\"https://gorm.io/zh_CN/docs/update.html#%E6%9B%B4%E6%96%B0%E5%A4%9A%E5%88%97\">æ›´æ–° | GORM</a></p>\n</li>\n</ul>\n</li>\n</ul>\n<h2 id=\"DDDï¼šå®ä½“-â€”â€”-å€¼å¯¹è±¡\"><a href=\"#DDDï¼šå®ä½“-â€”â€”-å€¼å¯¹è±¡\" class=\"headerlink\" title=\"DDDï¼šå®ä½“ â€”â€” å€¼å¯¹è±¡\"></a>DDDï¼šå®ä½“ â€”â€” å€¼å¯¹è±¡</h2><p>ä¸‹å›¾æ‰€ç¤ºå°±æ˜¯ä¸€ä¸ªéå¸¸ç»å…¸çš„é¢†åŸŸè®¾è®¡é©±åŠ¨ä¸­çš„é¢†åŸŸå¯¹è±¡ä¸­<strong>å®ä½“</strong>å’Œ<strong>å€¼å¯¹è±¡</strong>çš„ä¸€ä¸ªä½“ç°</p>\n<img src=\"https://raw.githubusercontent.com/lyydsheep/pic/main/202409161550256.png\" alt=\"image-20240916155000184\" style=\"zoom:67%;\" />\n\n<ul>\n<li>å®ä½“ï¼š<strong>ç‹¬ç«‹å­˜åœ¨çš„</strong></li>\n<li>å€¼å¯¹è±¡ï¼š<strong>ä¾èµ–äºå®ä½“è€Œå­˜åœ¨ï¼Œé€šå¸¸ä½œä¸ºå®ä½“çš„å±æ€§å‡ºç°</strong></li>\n</ul>\n<p>å¯ä»¥ç»“åˆå®ä¾‹ç†è§£ä¸€ä¸‹ï¼šåœ¨ç”¨æˆ·é¢†åŸŸï¼Œä¸€ä¸ªäººæ˜¯ä¸€ä¸ªå®ä½“ï¼Œä»–æ˜¯ç‹¬ç«‹å­˜åœ¨çš„ï¼›è€Œåœ¨å¸–å­é¢†åŸŸï¼Œä¸€ä¸ªäººæ˜¯ä¾èµ–äºå¸–å­æ‰èƒ½æˆä¸ºä½œè€…ï¼Œæ˜¯ä¸€ä¸ªå€¼å¯¹è±¡</p>\n<p><strong>åœ¨DDDé‡Œé¢ï¼Œä¸€ä¸ªé¢†åŸŸçš„å®ä½“ï¼Œåœ¨å¦ä¸€ä¸ªé¢†åŸŸä¸­é€šå¸¸ä½œä¸ºå€¼å¯¹è±¡ã€å¦ä¸€ä¸ªå®ä½“çš„å±æ€§å‡ºç°</strong></p>\n<h2 id=\"æ•°æ®åŒæ­¥\"><a href=\"#æ•°æ®åŒæ­¥\" class=\"headerlink\" title=\"æ•°æ®åŒæ­¥\"></a>æ•°æ®åŒæ­¥</h2><h3 id=\"èŒè´£åˆ’åˆ†\"><a href=\"#èŒè´£åˆ’åˆ†\" class=\"headerlink\" title=\"èŒè´£åˆ’åˆ†\"></a>èŒè´£åˆ’åˆ†</h3><blockquote>\n<p>ç”±ä¹‹å‰çš„åˆ†æå¯çŸ¥ï¼Œæˆ‘ä»¬éœ€è¦ä¸€ä¸ªåˆ¶ä½œè¡¨å’Œçº¿ä¸Šè¡¨ï¼Œé‚£ä¹ˆè¯¥æœ‰å“ªä¸€ä¸ªéƒ¨åˆ†æ¥åŒæ­¥ä¸¤ä¸ªè¡¨çš„æ•°æ®å‘¢ï¼Ÿ</p>\n</blockquote>\n<p>ç†è®ºä¸Šï¼Œé¡¹ç›®æ˜¯å•ä½“åº”ç”¨è¿˜æ˜¯å¾®æœåŠ¡åº”ç”¨æ˜¯é€‰æ‹©æ—¶éœ€è¦å‚è€ƒçš„å› ç´ </p>\n<ul>\n<li>web&#x2F;èšåˆæœåŠ¡<ul>\n<li>è°ƒç”¨ä¸åŒçš„serviceæ¥åŒæ­¥æ•°æ®ï¼Œå¯ä»¥ç†è§£ä¸ºä½œè€…å’Œè¯»è€…å„æœ‰å„çš„æœåŠ¡</li>\n</ul>\n</li>\n<li>service<ul>\n<li>è°ƒç”¨ä¸åŒçš„repositoryæ¥ä¿å­˜æ•°æ®ï¼Œä»å­˜å‚¨çš„è§’åº¦çœ‹æ¥ï¼Œä½œè€…çœ‹åˆ°çš„å¸–å­å’Œè¯»è€…çœ‹åˆ°çš„å¸–å­æ˜¯ä¸ä¸€æ ·çš„</li>\n</ul>\n</li>\n<li>repository<ul>\n<li>æ“ä½œä¸åŒçš„æ•°æ®æº</li>\n</ul>\n</li>\n</ul>\n<p><strong>ä¸šåŠ¡ç®€å•å°±ä¸€ä¸ªrepositoryï¼Œå¤æ‚å°±ç”¨å¤šä¸ªrepository</strong></p>\n<img src=\"https://raw.githubusercontent.com/lyydsheep/pic/main/202409271441109.png\" alt=\"image-20240927144102855\" style=\"zoom:50%;\" />\n\n<h3 id=\"ç»´æŠ¤äº‹åŠ¡\"><a href=\"#ç»´æŠ¤äº‹åŠ¡\" class=\"headerlink\" title=\"ç»´æŠ¤äº‹åŠ¡\"></a>ç»´æŠ¤äº‹åŠ¡</h3><p>åŒæ­¥åˆ¶ä½œåº“å’Œçº¿ä¸Šåº“è¦ä¹ˆåŒæ—¶æˆåŠŸï¼Œè¦ä¹ˆåŒæ—¶å¤±è´¥ï¼Œå› æ­¤å°†æ•°æ®åŒæ­¥æ“ä½œåšæˆä¸€ä¸ªäº‹åŠ¡å†åˆé€‚ä¸è¿‡äº†</p>\n<p>å¯ä»¥åœ¨ä¸¤ä¸ªå±‚é¢ä¸Šç»´æŠ¤äº‹åŠ¡ï¼Œä¸€ä¸ªæ˜¯<code>repository</code>ï¼Œå¦ä¸€ä¸ªæ˜¯<code>dao</code>ã€‚ä½†æ˜¯<code>repository</code>åœ¨DDDä¸­åº”è¯¥æ˜¯æ“ä½œæ•°æ®åº“å’Œç¼“å­˜çš„ï¼Œå¦‚æœåœ¨è¿™ä¸€å±‚é¢ç»´æŠ¤äº‹åŠ¡ï¼Œç»“æœå°±æ˜¯è·¨å±‚æ“ä½œå¹¶å¼ºè€¦åˆäºGORMï¼ˆè€Œä¸”å†™èµ·æ¥ä¸ä¼˜é›…ğŸ¤ªï¼‰ã€‚å¦ä¸€ç§æ–¹æ¡ˆæ˜¯åœ¨<code>dao</code>å±‚ä¸­ç»´æŠ¤äº‹åŠ¡ï¼ˆè¿™å°±æ–¹ä¾¿å¤šå•¦ğŸ˜Šï¼‰ï¼Œå…·ä½“å®ç°å¦‚ä¸‹</p>\n<figure class=\"highlight go\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"function\"><span class=\"keyword\">func</span> <span class=\"params\">(dao *BasicArticleDAO)</span></span> Sync(ctx context.Context, article Article) (<span class=\"type\">int</span>, <span class=\"type\">error</span>) &#123;</span><br><span class=\"line\">\tid := article.Id</span><br><span class=\"line\">\t<span class=\"comment\">// åˆ©ç”¨GORMæ§åˆ¶äº‹åŠ¡çš„ç”Ÿå‘½å‘¨æœŸ</span></span><br><span class=\"line\">\terr := dao.db.WithContext(ctx).Transaction(<span class=\"function\"><span class=\"keyword\">func</span><span class=\"params\">(tx *gorm.DB)</span></span> <span class=\"type\">error</span> &#123;</span><br><span class=\"line\">\t\t<span class=\"keyword\">var</span> err <span class=\"type\">error</span></span><br><span class=\"line\">\t\t<span class=\"keyword\">if</span> id &gt; <span class=\"number\">0</span> &#123;</span><br><span class=\"line\">\t\t\terr = dao.UpdateById(ctx, article)</span><br><span class=\"line\">\t\t&#125; <span class=\"keyword\">else</span> &#123;</span><br><span class=\"line\">\t\t\tid, err = dao.Insert(ctx, article)</span><br><span class=\"line\">\t\t&#125;</span><br><span class=\"line\">\t\t<span class=\"keyword\">if</span> err != <span class=\"literal\">nil</span> &#123;</span><br><span class=\"line\">\t\t\t<span class=\"keyword\">return</span> err</span><br><span class=\"line\">\t\t&#125;</span><br><span class=\"line\">\t\t<span class=\"keyword\">return</span> dao.Upsert(ctx, PublishArticle&#123;</span><br><span class=\"line\">\t\t\tArticle: article,</span><br><span class=\"line\">\t\t&#125;)</span><br><span class=\"line\">\t&#125;)</span><br><span class=\"line\">\t<span class=\"keyword\">return</span> id, err</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n\n<p>âš ï¸ï¼šGORMçš„<code>transaction</code>æ–¹æ³•åœ¨åº•å±‚å®ç°æ—¶å°±å·²ç»å¸®æˆ‘ä»¬ç»´æŠ¤äº†<strong>äº‹åŠ¡çš„ç”Ÿå‘½å‘¨æœŸ</strong></p>\n<blockquote>\n<p>é‡ç‚¹æ˜¯å¦‚ä½•åœ¨GORMä¸‹å®ç°Upsertå‡½æ•°</p>\n</blockquote>\n<figure class=\"highlight go\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"function\"><span class=\"keyword\">func</span> <span class=\"params\">(dao *BasicArticleDAO)</span></span> Upsert(ctx context.Context, article PublishArticle) <span class=\"type\">error</span> &#123;</span><br><span class=\"line\">\tnow := time.Now().UnixMilli()</span><br><span class=\"line\">\tarticle.Utime = now</span><br><span class=\"line\">\tarticle.Ctime = now</span><br><span class=\"line\">\t<span class=\"comment\">// Upsertå‡½æ•°åœ¨GORMä¸‹çš„å®ç°</span></span><br><span class=\"line\">\t<span class=\"keyword\">return</span> dao.db.WithContext(ctx).Clauses(clause.OnConflict&#123;</span><br><span class=\"line\">\t\tDoUpdates: clause.Assignments(<span class=\"keyword\">map</span>[<span class=\"type\">string</span>]<span class=\"keyword\">interface</span>&#123;&#125;&#123;</span><br><span class=\"line\">\t\t\t<span class=\"string\">&quot;title&quot;</span>:   article.Title,</span><br><span class=\"line\">\t\t\t<span class=\"string\">&quot;content&quot;</span>: article.Content,</span><br><span class=\"line\">\t\t\t<span class=\"string\">&quot;utime&quot;</span>:   article.Utime,</span><br><span class=\"line\">\t\t&#125;),</span><br><span class=\"line\">\t&#125;).Create(&amp;article).Error</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n\n<p>å‘<code>Clauses</code>å‡½æ•°ä¸­ä¼ é€’<code>OnConflict</code>ç»“æ„ä½“ï¼Œè¡¨ç¤ºå¦‚æœå‘ç”Ÿå†²çªçš„è¯åº”è¯¥åšä»€ä¹ˆäº‹æƒ…</p>\n<p><code>OnConfilt</code>ä¸­æœ‰ä¸€äº›æ¯”è¾ƒæœ‰ç”¨çš„å­—æ®µ</p>\n<figure class=\"highlight go\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\">// DoUpdate\t\t---&gt; åšæ›´æ–°æ“ä½œ</span></span><br><span class=\"line\"><span class=\"comment\">// DoNothing\t---&gt; ä»€ä¹ˆä¹Ÿä¸åš</span></span><br><span class=\"line\"><span class=\"comment\">// Where\t\t---&gt; æ•°æ®å†²çªäº†å¹¶ä¸”ç¬¦åˆwhereå­å¥ï¼Œå°±æ‰§è¡Œæ›´æ–°æ“ä½œ</span></span><br></pre></td></tr></table></figure>\n\n<p><strong>ğŸŒŸï¼šåœ¨ä¸€ä¸ªäº‹åŠ¡ä¸­ï¼Œä¸€ç›´éƒ½æ˜¯åŒä¸€ä¸ªæ•°æ®åº“è¿æ¥</strong></p>\n<h2 id=\"ç»´æŠ¤çŠ¶æ€\"><a href=\"#ç»´æŠ¤çŠ¶æ€\" class=\"headerlink\" title=\"ç»´æŠ¤çŠ¶æ€\"></a>ç»´æŠ¤çŠ¶æ€</h2><p>åœ¨å…ˆå‰çš„åˆ†æä¸­ï¼Œæˆ‘ä»¬çŸ¥é“éœ€è¦æœ‰çº¿ä¸Šåº“å’Œåˆ¶ä½œåº“ä¸¤ä¸ªæ•°æ®å­˜å‚¨çš„åœ°æ–¹ï¼Œè¿™ä¸¤ä¸ªåœ°æ–¹å­˜å‚¨çš„æ•°æ®æœ¬è´¨ä¸Šæ˜¯ä¸€æ ·çš„ï¼Œå› æ­¤ä¸å¿…åˆ›å»ºæ–°çš„é¢†åŸŸå¯¹è±¡æ¥ç»´æŠ¤ï¼Œ<strong>ä½¿ç”¨è¡ç”Ÿç±»å‹æ›´åŠ æ–¹ä¾¿</strong></p>\n<h3 id=\"çŠ¶æ€å¸¸é‡å®šä¹‰\"><a href=\"#çŠ¶æ€å¸¸é‡å®šä¹‰\" class=\"headerlink\" title=\"çŠ¶æ€å¸¸é‡å®šä¹‰\"></a>çŠ¶æ€å¸¸é‡å®šä¹‰</h3><p>åˆ©ç”¨å¸¸é‡è¡¨ç¤ºä¸€ç¯‡å¸–å­çš„ä¸åŒçŠ¶æ€ï¼Œè¿™äº›å¸¸é‡å¯ä»¥ç›´æ¥åˆ©ç”¨<code>iota</code>åœ¨<code>domain</code>ä¸­å®šä¹‰ã€‚<strong>ä¸€èˆ¬å®šä¹‰å¸¸é‡ï¼Œæœ€å¥½ä¸è¦æŠŠé›¶å€¼åšæˆæœ‰æ„ä¹‰çš„å€¼</strong>ï¼Œå¦åˆ™éš¾ä»¥åŒºåˆ†æ˜¯ç”¨æˆ·æ²¡æœ‰è¾“å…¥è¿˜æ˜¯å‰ç«¯ä¼ é€’é»˜è®¤æ•°æ®</p>\n<p><img src=\"https://raw.githubusercontent.com/lyydsheep/pic/main/202409270907841.png\" alt=\"image-20240927090706192\"></p>\n<h2 id=\"ä½¿ç”¨MongoDBå­˜å‚¨\"><a href=\"#ä½¿ç”¨MongoDBå­˜å‚¨\" class=\"headerlink\" title=\"ä½¿ç”¨MongoDBå­˜å‚¨\"></a>ä½¿ç”¨MongoDBå­˜å‚¨</h2><p>ç±»ä¼¼äºå¤§æ–‡æœ¬ä¹‹ç±»çš„ä¸œè¥¿ï¼Œé™¤äº†å¯ä»¥ä½¿ç”¨å…³ç³»å‹æ•°æ®åº“ï¼Œä¹Ÿå¯ä»¥è€ƒè™‘ä½¿ç”¨å…¶ä»–å­˜å‚¨åº”ç”¨ï¼Œä¾‹å¦‚MongoDB</p>\n<p><strong>MongoDBå±äºNoSQLï¼ŒNoSQLå³Not Only SQL</strong>ï¼Œä¸ä»…ä»…æ˜¯SQL</p>\n<p>NoSQLæ•°æ®åº“çš„äº§ç”Ÿæ˜¯ä¸ºäº†è§£å†³å¤§è§„æ¨¡æ•°æ®é›†åˆã€å¤šç§æ•°æ®ç§ç±»å¸¦æ¥çš„æŒ‘æˆ˜ï¼Œå°¤å…¶æ˜¯å¤§æ•°æ®åº”ç”¨éš¾é¢˜</p>\n<img src=\"https://raw.githubusercontent.com/lyydsheep/pic/main/202409301530245.png\" alt=\"image-20240930153021471\" style=\"zoom:50%;\" />\n\n<h3 id=\"MongoDBç®€ä»‹\"><a href=\"#MongoDBç®€ä»‹\" class=\"headerlink\" title=\"MongoDBç®€ä»‹\"></a>MongoDBç®€ä»‹</h3><p>MongoDBçš„åŸºæœ¬ç‰¹æ€§</p>\n<ul>\n<li><strong>é¢å‘é›†åˆå­˜å‚¨</strong>ï¼šMongoDBé›†åˆä¸­å¯ä»¥å­˜å‚¨å¤šä¸ªæ–‡æ¡£<ul>\n<li>ç±»æ¯”äºMySQLï¼ŒMongoDBä¸­çš„ä¸€ä¸ªé›†åˆå°±åƒæ˜¯ä¸€å¼ è¡¨ï¼Œé›†åˆä¸­çš„ä¸€ä¸ªæ–‡æ¡£å°±ç›¸å½“äºè¡¨ä¸­çš„ä¸€æ¡è®°å½•</li>\n</ul>\n</li>\n<li><strong>æ¨¡å¼è‡ªç”±</strong>ï¼šMongoDBé‡‡ç”¨æ— ç»“æ„æ¨¡å¼å­˜å‚¨æ•°æ®ï¼Œä¹Ÿå°±æ˜¯è¯´ï¼Œåœ¨å‚¨å­˜æ•°æ®ä¹‹å‰ä¸éœ€è¦å®šä¹‰æ•°æ®çš„ç»“æ„<ul>\n<li>å°±åƒå½“äºåœ¨MySQLä¸­ä¸éœ€è¦é¢„å…ˆå»ºç«‹è¡¨ç»“æ„å°±èƒ½æ’å…¥æ•°æ®</li>\n</ul>\n</li>\n<li><strong>æ”¯æŒåˆ†ç‰‡</strong>ï¼šMongoDBæ”¯æŒåˆ†ç‰‡ï¼Œå¹¶ä¸”MongoDBè‡ªåŠ¨è§£å†³äº†åˆ†ç‰‡çš„å„ç§é—®é¢˜ï¼ŒåŒ…æ‹¬è‡ªåŠ¨åŒ–æ‰©å®¹</li>\n</ul>\n<img src=\"https://raw.githubusercontent.com/lyydsheep/pic/main/202409301530677.png\" alt=\"image-20240930153009489\" style=\"zoom:67%;\" />\n\n<p>é€‰æ‹©MongoDBçš„ä¸¤ä¸ªç†ç”±ï¼š</p>\n<ul>\n<li><p><strong>çµæ´»çš„æ–‡æ¡£æ¨¡å‹</strong>ï¼šäºMySQLä¸åŒï¼Œä¸éœ€è¦äº‹å‰åœ¨MongoDBä¸­å®šä¹‰æ–‡æ¡£æ¨¡å‹ï¼Œå¹¶ä¸”å¯ä»¥çµæ´»ä¿®æ”¹</p>\n</li>\n<li><p><strong>æ˜“äºæ¨ªå‘æ‰©å±•</strong>ï¼šå¯ä»¥é€šè¿‡å¢åŠ MongoDBå®ä¾‹æ¥åº”ä»˜æµé‡å’Œæ•°æ®å¢é•¿</p>\n</li>\n</ul>\n<h3 id=\"åˆå§‹åŒ–å®¢æˆ·ç«¯å¹¶æ’å…¥æ–‡æ¡£\"><a href=\"#åˆå§‹åŒ–å®¢æˆ·ç«¯å¹¶æ’å…¥æ–‡æ¡£\" class=\"headerlink\" title=\"åˆå§‹åŒ–å®¢æˆ·ç«¯å¹¶æ’å…¥æ–‡æ¡£\"></a>åˆå§‹åŒ–å®¢æˆ·ç«¯å¹¶æ’å…¥æ–‡æ¡£</h3><blockquote>\n<p>éœ€è¦ä½¿ç”¨MongoDBå®˜ç½‘çš„go-driver</p>\n</blockquote>\n<p><img src=\"https://raw.githubusercontent.com/lyydsheep/pic/main/202409301941675.png\" alt=\"image-20240930194117517\"></p>\n<h3 id=\"æŸ¥æ‰¾æ–‡æ¡£\"><a href=\"#æŸ¥æ‰¾æ–‡æ¡£\" class=\"headerlink\" title=\"æŸ¥æ‰¾æ–‡æ¡£\"></a>æŸ¥æ‰¾æ–‡æ¡£</h3><p>åœ¨MongoDBä¸­æœ‰ä¸¤ç§æ„é€ æŸ¥è¯¢æ¡ä»¶çš„æ–¹å¼ï¼š</p>\n<ul>\n<li><strong>bson</strong></li>\n<li><strong>ç»“æ„ä½“</strong></li>\n</ul>\n<figure class=\"highlight go\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\">// ä½¿ç”¨bsonæ„é€ æŸ¥è¯¢æ¡ä»¶</span></span><br><span class=\"line\">filter := bson.D&#123;bson.E&#123;Key: <span class=\"string\">&quot;id&quot;</span>, Value: <span class=\"number\">123</span>&#125;&#125;</span><br><span class=\"line\"><span class=\"keyword\">var</span> art Article</span><br><span class=\"line\">err = col.FindOne(ctx, filter).Decode(&amp;art)</span><br><span class=\"line\">assert.NoError(t, err)</span><br><span class=\"line\">fmt.Printf(<span class=\"string\">&quot;find article %v\\n&quot;</span>, art)</span><br><span class=\"line\"><span class=\"comment\">// ä½¿ç”¨ç»“æ„ä½“æ„é€ æŸ¥è¯¢æ¡ä»¶</span></span><br><span class=\"line\">err = col.FindOne(ctx, Article&#123;Id: <span class=\"number\">123</span>&#125;).Decode(&amp;art)</span><br><span class=\"line\"><span class=\"keyword\">if</span> errors.Is(err, mongo.ErrNoDocuments) &#123;</span><br><span class=\"line\">\tfmt.Printf(<span class=\"string\">&quot;find none&quot;</span>)</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n\n<p>âš ï¸ï¼šä½¿ç”¨ç»“æ„ä½“æ„é€ æŸ¥è¯¢æ¡ä»¶æ—¶ï¼Œmongodb-go-driveré»˜è®¤ä½¿ç”¨ç»“æ„ä½“çš„å…¨éƒ¨å­—æ®µä½œä¸ºåŒ¹é…æ¡ä»¶ï¼Œéœ€è¦æ³¨æ„æŸäº›å­—æ®µ<strong>é»˜è®¤é›¶å€¼</strong>ã€‚å½“ç„¶ï¼Œå¯ä»¥ä½¿ç”¨<code>bson:&quot;field_name,omitempty&quot;</code>æ ‡ç­¾æ¥å‘ŠçŸ¥mongodb-go-driverå¿½ç•¥å­—æ®µé›¶å€¼</p>\n<p>ğŸŒŸï¼šå¯ä»¥ä½¿ç”¨<code>mongo.ErrNoDocuments</code>é”™è¯¯å€¼æ£€éªŒæ˜¯å¦æœ‰æŸ¥è¯¢åˆ°æ–‡æ¡£</p>\n<h3 id=\"æ›´æ–°æ–‡æ¡£\"><a href=\"#æ›´æ–°æ–‡æ¡£\" class=\"headerlink\" title=\"æ›´æ–°æ–‡æ¡£\"></a>æ›´æ–°æ–‡æ¡£</h3><ul>\n<li>æ„é€ æ›´æ–°æ¡ä»¶ï¼ŒåŒæ„é€ æŸ¥è¯¢æ¡ä»¶</li>\n<li>æ„é€ æ›´æ–°å­—æ®µ<ul>\n<li><strong>bson</strong></li>\n<li><strong>ç»“æ„ä½“</strong></li>\n</ul>\n</li>\n</ul>\n<p>âš ï¸ï¼šåŒæ ·çš„ï¼Œéœ€è¦æ³¨æ„<strong>åº•å±‚æ˜¯å¦ä¼šé‡‡ç”¨å­—æ®µé›¶å€¼</strong></p>\n<figure class=\"highlight go\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">sets := bson.D&#123;bson.E&#123;Key: <span class=\"string\">&quot;$set&quot;</span>,</span><br><span class=\"line\">\tValue: bson.E&#123;Key: <span class=\"string\">&quot;content&quot;</span>, Value: <span class=\"string\">&quot;serious content&quot;</span>&#125;&#125;&#125;</span><br><span class=\"line\">res, err := col.UpdateOne(ctx, filter, sets)</span><br><span class=\"line\"><span class=\"comment\">// ä½¿ç”¨ç»“æ„ä½“æ„é€ æ›´æ–°å­—æ®µ</span></span><br><span class=\"line\">res, err = col.UpdateOne(ctx, filter, bson.D&#123;bson.E&#123;Key: <span class=\"string\">&quot;$set&quot;</span>, Value: Article&#123;</span><br><span class=\"line\">\tTitle: <span class=\"string\">&quot;new title&quot;</span>,</span><br><span class=\"line\">&#125;&#125;&#125;)</span><br></pre></td></tr></table></figure>\n\n<h3 id=\"åˆ›å»ºç´¢å¼•\"><a href=\"#åˆ›å»ºç´¢å¼•\" class=\"headerlink\" title=\"åˆ›å»ºç´¢å¼•\"></a>åˆ›å»ºç´¢å¼•</h3><p>ç±»ä¼¼äºMySQLï¼Œ<strong>ä¸€èˆ¬æ˜¯æ ¹æ®ä¸šåŠ¡ä¸­å¸¸ç”¨çš„æŸ¥è¯¢æ¡ä»¶ï¼Œæ¥å†³å®šåœ¨ä»€ä¹ˆåˆ—ä¸Šæ„å»ºç´¢å¼•</strong></p>\n<figure class=\"highlight go\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">indexRes, err := col.Indexes().CreateOne(ctx, mongo.IndexModel&#123;</span><br><span class=\"line\">\tKeys:    bson.M&#123;<span class=\"string\">&quot;id&quot;</span>: <span class=\"number\">1</span>&#125;,</span><br><span class=\"line\">\tOptions: options.Index().SetUnique(<span class=\"literal\">true</span>),</span><br><span class=\"line\">&#125;)</span><br><span class=\"line\">fmt.Println(indexRes)</span><br></pre></td></tr></table></figure>\n\n<h3 id=\"MongoDBå­˜å‚¨æ•°æ®\"><a href=\"#MongoDBå­˜å‚¨æ•°æ®\" class=\"headerlink\" title=\"MongoDBå­˜å‚¨æ•°æ®\"></a>MongoDBå­˜å‚¨æ•°æ®</h3><p>ç”±äºMongoDBä¸­çš„<code>_id</code>å­—æ®µä¸æ˜¯è‡ªå¢å¹¶ä¸”æ˜¯ä¸€ä¸ª<strong>12å­—èŠ‚</strong>çš„åˆ‡ç‰‡ï¼Œå› æ­¤ä¸èƒ½ç›´æ¥ä½¿ç”¨è¿™ä¸ªå­—æ®µä½œä¸ºä¸»é”®</p>\n<p>ä¸»é”®çš„å¯é€‰æ–¹æ¡ˆï¼š</p>\n<ul>\n<li><strong>å°†æ•´ä¸ªidä¿®æ”¹ä¸ºstringç±»å‹</strong></li>\n<li><strong>ä½¿ç”¨IDç”Ÿæˆç­–ç•¥</strong>ï¼Œä¾‹å¦‚<strong>é›ªèŠ±ç®—æ³•</strong><ul>\n<li><strong>1æ¯”ç‰¹ä¿ç•™ä½</strong></li>\n<li><strong>41æ¯”ç‰¹æ—¶é—´æˆ³</strong></li>\n<li><strong>10æ¯”ç‰¹æœºå™¨ä½</strong>ï¼Œä¸€èˆ¬å«åš<code>Worker ID</code></li>\n<li><strong>12æ¯”ç‰¹è‡ªå¢åºå·</strong></li>\n<li><img src=\"https://raw.githubusercontent.com/lyydsheep/pic/main/202410031541579.png\" alt=\"image-20241003154159484\"></li>\n</ul>\n</li>\n<li><strong>ä½¿ç”¨GUID</strong></li>\n<li><strong>å®šä¹‰ä¸€ä¸ªæ–°çš„æ¥å£</strong>ï¼Œä½†è¿™æ ·å°±å¤±å»äº†DAOå±‚çš„ç»Ÿä¸€æ¥å£</li>\n</ul>\n<p><strong>âš ï¸ï¼šåœ¨MongoDBä¸­ï¼Œå°½é‡ä½¿ç”¨è¡ç”Ÿç±»å‹è€Œä¸æ˜¯åµŒå¥—ç»“æ„ä½“ã€‚å› ä¸ºåµŒå¥—ç»“æ„ä½“ä¸­å­ç»“æ„ä½“çš„å­—æ®µæ ‡ç­¾åœ¨æ“ä½œè¿‡ç¨‹ä¸­æ— æ³•æ­£å¸¸ç”Ÿæ•ˆ</strong></p>\n<h2 id=\"åˆ©ç”¨OSSæ¥å­˜å‚¨æ•°æ®\"><a href=\"#åˆ©ç”¨OSSæ¥å­˜å‚¨æ•°æ®\" class=\"headerlink\" title=\"åˆ©ç”¨OSSæ¥å­˜å‚¨æ•°æ®\"></a>åˆ©ç”¨OSSæ¥å­˜å‚¨æ•°æ®</h2><blockquote>\n<p>åˆ©ç”¨OSSå­˜å‚¨çº¿ä¸Šæ•°æ®ï¼Œè€Œåç›´æ¥é€šè¿‡CDNåŠ é€Ÿè®¿é—®</p>\n</blockquote>\n<p>OSSï¼ˆObject Storage Serviceï¼‰æ˜¯æŒ‡å…‘ç°å­˜å‚¨ï¼Œ<strong>è¢«å¤§é‡ç”¨äºå­˜å‚¨æ–‡ä»¶ã€æµåª’ä½“ã€å›¾ç‰‡ç­‰</strong></p>\n<p>OSSä¸­çš„ä¸¤ä¸ªæ ¸å¿ƒæ¦‚å¿µï¼š</p>\n<ul>\n<li><strong>Bucket</strong>ï¼šé€»è¾‘ä¸Šçš„åˆ†ç»„å…³ç³»ï¼Œä¾‹å¦‚æŸä¸ªä¸šåŠ¡ä½¿ç”¨ä¸€ä¸ªæ¡¶ï¼Œå¦ä¸€ä¸ªä¸šåŠ¡ä½¿ç”¨å¦å¤–ä¸€ä¸ªæ¡¶</li>\n<li><strong>Object</strong>ï¼šå¯¹è±¡ï¼Œä¹Ÿå°±æ˜¯éœ€è¦å­˜å‚¨çš„ä¸œè¥¿</li>\n</ul>\n<p>ACLï¼ˆAccess Control Listï¼‰ï¼šæƒé™æ§åˆ¶æ–¹æ¡ˆ</p>\n<p><img src=\"https://raw.githubusercontent.com/lyydsheep/pic/main/202410041010143.png\" alt=\"image-20241004101033272\"></p>\n<p>OSSé€šå¸¸å’ŒCDNç»“åˆåœ¨ä¸€èµ·ä½¿ç”¨ï¼Œ<strong>å³åœ¨OSSä¸Šå­˜å‚¨çš„æ•°æ®ï¼Œå¯ä»¥é€šè¿‡CDNæ¥è®¿é—®</strong></p>\n<p>ä¸€ç§å¾ˆå¸¸è§çš„æ€§èƒ½å’Œå¯ç”¨æ€§ä¼˜åŒ–æ‰‹æ®µï¼Œå°±æ˜¯ä½¿ç”¨<strong>OSSå’ŒCDNæ¥å­˜å‚¨ç½‘ç«™çš„é™æ€èµ„æº</strong>ï¼Œæ­¤æ—¶OSSè¢«å½“ä½œCDNçš„ä¸€ä¸ªå›æºç«™ç‚¹</p>\n<p><img src=\"https://raw.githubusercontent.com/lyydsheep/pic/main/202410041013265.png\" alt=\"image-20241004101307223\"></p>\n<h2 id=\"æŸ¥è¯¢æ¥å£ä¸ç¼“å­˜\"><a href=\"#æŸ¥è¯¢æ¥å£ä¸ç¼“å­˜\" class=\"headerlink\" title=\"æŸ¥è¯¢æ¥å£ä¸ç¼“å­˜\"></a>æŸ¥è¯¢æ¥å£ä¸ç¼“å­˜</h2><p>åœ¨å®ç°æŸ¥è¯¢æ–‡ç« åŠŸèƒ½è¿‡ç¨‹ä¸­ï¼Œéœ€è¦ä»ä¸åŒç”¨æˆ·è§’åº¦å‡ºå‘è¿›è¡Œæ€è€ƒ</p>\n<ul>\n<li>å¯¹äºåˆ›ä½œè€…æ¥è¯´ï¼Œéœ€è¦æŸ¥è¯¢è‡ªå·±çš„<strong>æ–‡ç« åˆ—è¡¨</strong>ä»¥åŠ<strong>æŸä¸€ç¯‡æ–‡ç« çš„è¯¦ç»†å†…å®¹</strong>ï¼Œåˆ†åˆ«å¯¹åº”ç€ä¸¤ä¸ªæ¥å£<ul>\n<li>åˆ—è¡¨æ¥å£</li>\n<li>è¯¦æƒ…æ¥å£</li>\n</ul>\n</li>\n<li>å¯¹äºè¯»è€…ï¼Œä»–èƒ½å¤Ÿ<strong>æœç´¢æŸç¯‡æ–‡ç« </strong>ã€<strong>æµè§ˆæ¨èæ–‡ç« åˆ—è¡¨</strong>ã€<strong>é˜…è¯»æ–‡ç« çš„å…·ä½“å†…å®¹</strong>ã€‚ç”±æ­¤å¯è§ï¼Œéœ€è¦æä¾›ä»¥ä¸‹æ¥å£<ul>\n<li>æœç´¢æ¥å£</li>\n<li>æ¨èæ¥å£</li>\n<li>é˜…è¯»æ–‡ç« æ¥å£</li>\n</ul>\n</li>\n</ul>\n<p>ç›®å‰ä»…å®ç°åˆ›ä½œè€…çš„<strong>åˆ—è¡¨æ¥å£å’Œè¯¦æƒ…æ¥å£</strong>ï¼Œä»¥åŠè¯»è€…çš„<strong>é˜…è¯»æ–‡ç« æ¥å£</strong></p>\n<h3 id=\"åˆ—è¡¨æ¥å£\"><a href=\"#åˆ—è¡¨æ¥å£\" class=\"headerlink\" title=\"åˆ—è¡¨æ¥å£\"></a>åˆ—è¡¨æ¥å£</h3><h4 id=\"éœ€æ±‚åˆ†æ-1\"><a href=\"#éœ€æ±‚åˆ†æ-1\" class=\"headerlink\" title=\"éœ€æ±‚åˆ†æ\"></a>éœ€æ±‚åˆ†æ</h4><p>å‚è€ƒæ˜é‡‘çš„åˆ—è¡¨å±•ç¤ºï¼š</p>\n<p><img src=\"https://raw.githubusercontent.com/lyydsheep/pic/main/202410061411490.png\" alt=\"image-20241006141112588\"></p>\n<p>å¯ä»¥å‘ç°ï¼Œåœ¨åˆ—è¡¨ä¸­å±•ç¤ºçš„æ–‡ç« å¯¹è±¡æœ‰å¦‚ä¸‹ç‰¹å¾ï¼š</p>\n<ul>\n<li>æ ‡é¢˜</li>\n<li>åˆ›å»ºæ—¶é—´</li>\n<li>ç®€ä»‹</li>\n<li>â€¦</li>\n</ul>\n<p>æ ¹æ®è¿™äº›ç‰¹å¾æˆ‘ä»¬å°±èƒ½å®šä¹‰å‡ºä¸å‰ç«¯ç›¸å¯¹åº”çš„<code>ArticleVO</code></p>\n<p>å¦ä¸€ä¸ªå€¼å¾—æ³¨æ„çš„ç‚¹æ˜¯ï¼Œ<strong>æ˜é‡‘åœ¨åˆ—è¡¨ä¸­å±•ç¤ºçš„æ–‡ç« åªæœ‰ä¸€å°éƒ¨åˆ†ï¼Œå½“é¡µé¢ä¸‹æ»‘æ—¶æ‰ä¼šåŠ è½½æ›´å¤šçš„æ–‡ç« </strong>ï¼Œè¿™å°±ç›¸å½“äºä¸€ä¸ª<strong>åˆ†é¡µæŸ¥è¯¢</strong>æ“ä½œ</p>\n<h4 id=\"åˆ†é¡µå½¢æ€\"><a href=\"#åˆ†é¡µå½¢æ€\" class=\"headerlink\" title=\"åˆ†é¡µå½¢æ€\"></a>åˆ†é¡µå½¢æ€</h4><p><strong>åˆ†é¡µçš„æ ¸å¿ƒç›®æ ‡å°±æ˜¯é¿å…ä¸€æ¬¡æ“ä½œå¤ªå¤šæ•°æ®ï¼Œå¼•å‘æ€§èƒ½é—®é¢˜</strong>ã€‚å†µä¸”ï¼Œåˆ—è¡¨é¡µåœ¨å±•ç¤ºçš„æ—¶å€™ï¼Œä¹Ÿä¸è®¸é‚£ä¹ˆå¤šçš„å†…å®¹ğŸ˜</p>\n<p>åˆ†é¡µæ¥å£ä¸€èˆ¬æœ‰ä¸‰ç§å®šä¹‰å½¢å¼ï¼š</p>\n<ul>\n<li><strong>ç›´æ¥å®šä¹‰<code>Offset</code>å’Œ<code>Limit</code>å­—æ®µ</strong></li>\n<li><strong>ç›´æ¥å®šä¹‰ä¸€ä¸ª<code>Page</code>å­—æ®µï¼Œå¹¶çº¦å®šå¥½Pageçš„å¤§å°</strong></li>\n<li><strong>ç›´æ¥å®šä¹‰ä¸€ä¸ª<code>Cursor</code>å­—æ®µ</strong></li>\n</ul>\n<img src=\"https://raw.githubusercontent.com/lyydsheep/pic/main/202410061421861.png\" alt=\"image-20241006142108823\" style=\"zoom: 50%;\" />\n\n<h3 id=\"ç¼“å­˜è®¾è®¡\"><a href=\"#ç¼“å­˜è®¾è®¡\" class=\"headerlink\" title=\"ç¼“å­˜è®¾è®¡\"></a>ç¼“å­˜è®¾è®¡</h3><blockquote>\n<p>ç¼“å­˜ç¬¬ä¸€é¡µåˆ†é¡µ</p>\n</blockquote>\n<p>å¤§éƒ¨åˆ†æƒ…å†µä¸‹ï¼Œä¸ä¼šå¯¹åˆ†é¡µç»“æœè¿›è¡Œç¼“å­˜ï¼Œ<strong>å› ä¸ºå¦‚æœæ•°æ®çš„ç­›é€‰æ¡ä»¶ã€æ’åºæ¡ä»¶ã€åˆ†é¡µæ¡ä»¶ã€åˆ†é¡µçš„åç§»é‡å’Œæ•°æ®é‡ä¸­çš„ä»»ä½•ä¸€ä¸ªå‘ç”Ÿäº†å˜åŒ–ï¼Œç¼“å­˜å°±å¾ˆéš¾ä½¿ç”¨äº†</strong></p>\n<p>ä½†å¯ä»¥åª<strong>ç¼“å­˜ç¬¬ä¸€é¡µ</strong>ï¼Œæ¯•ç«Ÿå¤§éƒ¨åˆ†ç”¨æˆ·åªçœ‹åˆ—è¡¨çš„ç¬¬ä¸€é¡µ</p>\n<p>æœ‰äº†ç¼“å­˜ä¹‹åï¼Œ<strong>æ¯æ¬¡è¿›è¡Œæ›´æ–°æ“ä½œéƒ½è¦å°†ç¼“å­˜åˆ é™¤ï¼Œé˜²æ­¢ç¼“å­˜ä¸ä¸€è‡´é—®é¢˜</strong></p>\n<blockquote>\n<p>ä¸šåŠ¡ç›¸å…³çš„é¢„åŠ è½½</p>\n</blockquote>\n<p><strong>é¢„åŠ è½½æœ¬è´¨ä¸Šå°±æ˜¯é¢„åˆ¤ç”¨æˆ·å°†è¦è¯»å–çš„å†…å®¹ï¼Œæå‰å°†å†…å®¹å­˜å…¥ç¼“å­˜ä¸­</strong></p>\n<p>è€Œä¸”ï¼Œå› ä¸ºæ˜¯é¢„æµ‹æ€§è´¨çš„ï¼Œæ‰€ä»¥è¿‡æœŸæ—¶é—´è®¾ç½®å¾—å¾ˆçŸ­</p>\n<p><img src=\"https://raw.githubusercontent.com/lyydsheep/pic/main/202410061512142.png\" alt=\"image-20241006151243081\"></p>\n<blockquote>\n<p>ä¸ç¼“å­˜å¤§æ–‡æ¡£ï¼ˆè°ƒä¼˜ğŸ˜‚ï¼‰</p>\n</blockquote>\n<p>å¯ä»¥è€ƒè™‘åœ¨Rediså†…å­˜æ¶ˆè€—å’Œç¼“å­˜æ€§èƒ½ä¹‹é—´åšä¸€ä¸ªæƒè¡¡</p>\n<p>ä¹Ÿå°±æ˜¯è¯´ï¼Œå¹¶ä¸æ˜¯æ‰€æœ‰çš„å€¼éƒ½éœ€è¦ç¼“å­˜ï¼Œ<strong>æœ‰ä¸€äº›å¾ˆå ç”¨å†…å­˜ç©ºé—´çš„æ–‡ç« å°±ä¸å¿…ç¼“å­˜</strong></p>\n<h4 id=\"ç¼“å­˜è¿‡æœŸæ—¶é—´\"><a href=\"#ç¼“å­˜è¿‡æœŸæ—¶é—´\" class=\"headerlink\" title=\"ç¼“å­˜è¿‡æœŸæ—¶é—´\"></a>ç¼“å­˜è¿‡æœŸæ—¶é—´</h4><p>ç¼“å­˜çš„è¿‡æœŸæ—¶é—´å’Œç¼“å­˜å‘½ä¸­ç‡æœ‰å…³ï¼Œä¸€èˆ¬æƒ…å†µä¸‹ï¼Œ<strong>è¿‡æœŸæ—¶é—´è¶Šé•¿ï¼Œå‘½ä¸­ç‡è¶Šé«˜ï¼Œä½†æ•°æ®ä¸€è‡´æ€§ä¼šå˜å·®ï¼›è¿‡æœŸæ—¶é—´è¶ŠçŸ­ï¼Œå‘½ä¸­ç‡è¶Šä½ï¼Œä½†æ•°æ®ä¸€è‡´æ€§ä¼šæ›´å¥½</strong></p>\n<ul>\n<li>ä¸šåŠ¡ç›¸å…³çš„ç¼“å­˜é¢„åŠ è½½ï¼Œè¿‡æœŸæ—¶é—´è¦çŸ­</li>\n<li>æ ¹æ®ç”¨æˆ·èº«ä»½æŒ‰æƒç»™äºˆä¸åŒçš„ç¼“å­˜æ—¶é—´</li>\n</ul>\n<h4 id=\"æ·˜æ±°ç­–ç•¥\"><a href=\"#æ·˜æ±°ç­–ç•¥\" class=\"headerlink\" title=\"æ·˜æ±°ç­–ç•¥\"></a>æ·˜æ±°ç­–ç•¥</h4><p>æ·˜æ±°ç­–ç•¥æ˜¯æŒ‡åœ¨ç¼“å­˜å†…å­˜ä¸å¤Ÿç”¨çš„æƒ…å†µä¸‹ï¼Œæ·˜æ±°æŸä¸€éƒ¨åˆ†æ•°æ®æ—¶çš„è®¡åˆ’</p>\n<p>å¸¸è§„æ–¹æ¡ˆå°±æ˜¯<strong>LRUå’ŒLFU</strong></p>\n<p>è¿˜æœ‰ä¸€äº›æ–¹æ¡ˆï¼š</p>\n<ul>\n<li>ä¼˜å…ˆæ·˜æ±°æ™®é€šåˆ›ä½œè€…çš„æ•°æ®ï¼Œç•™ä¸‹å¤§vçš„æ•°æ®</li>\n<li>ä¼˜å…ˆæ·˜æ±°å¤§å¯¹è±¡ï¼Œé‡Šæ”¾å‡ºæ›´å¤šçš„å†…å­˜ç©ºé—´</li>\n<li>ä¼˜å…ˆæ·˜æ±°å°å¯¹è±¡ï¼Œç›¸æ¯”äºå¤§å¯¹è±¡ï¼Œå°å¯¹è±¡åœ¨ä»æ•°æ®åº“ï¼ˆæˆ–OSSï¼‰ä¸­è·å–æ›´åŠ è¿…é€Ÿ</li>\n</ul>\n<h3 id=\"æ³¨æ„äº‹é¡¹\"><a href=\"#æ³¨æ„äº‹é¡¹\" class=\"headerlink\" title=\"æ³¨æ„äº‹é¡¹\"></a>æ³¨æ„äº‹é¡¹</h3><ul>\n<li>ä½¿ç”¨<code>wrapbodyandtoken</code>ç»Ÿä¸€å¤„ç†Bodyå’ŒTokenä¸­çš„æ•°æ®</li>\n<li>è€ƒè™‘åˆ°ä¸­æ–‡å­—ç¬¦ç”±å¤šä¸ªå­—èŠ‚ç»„æˆï¼Œåœ¨å¤„ç†åŒ…å«ä¸­æ–‡çš„å­—ç¬¦ä¸²æ—¶ï¼Œåº”å®ç°å°†å…¶è½¬ä¸º<code>[]rune</code>å†è¿›è¡Œ<code>len()</code>æ“ä½œ</li>\n<li>éœ€è¦å°†å­˜å‚¨å¯¹è±¡è½¬æ¢ä¸º<code>json</code>æ ¼å¼åæ‰èƒ½å­˜å…¥Redisä¸­ï¼Œå¦åˆ™ä¼šæŠ¥é”™</li>\n</ul>\n","excerpt":"","more":"<h1 id=\"å‘å¸–åŠŸèƒ½å®ç°\"><a href=\"#å‘å¸–åŠŸèƒ½å®ç°\" class=\"headerlink\" title=\"å‘å¸–åŠŸèƒ½å®ç°\"></a>å‘å¸–åŠŸèƒ½å®ç°</h1><h2 id=\"éœ€æ±‚åˆ†æ\"><a href=\"#éœ€æ±‚åˆ†æ\" class=\"headerlink\" title=\"éœ€æ±‚åˆ†æ\"></a>éœ€æ±‚åˆ†æ</h2><h3 id=\"ç”¨ä¾‹\"><a href=\"#ç”¨ä¾‹\" class=\"headerlink\" title=\"ç”¨ä¾‹\"></a>ç”¨ä¾‹</h3><blockquote>\n<p>é€šè¿‡ä½¿ç”¨ç”¨ä¾‹æ¥å±•ç¤ºæŸä¸ªéœ€æ±‚çš„å…·ä½“ä½¿ç”¨åœºæ™¯</p>\n</blockquote>\n<img src=\"https://raw.githubusercontent.com/lyydsheep/pic/main/202409092129324.png\" width=300>\n\n<ul>\n<li>åˆ›ä½œè€…<ul>\n<li>å¢åˆ æ”¹æŸ¥</li>\n</ul>\n</li>\n<li>è¯»è€…<ul>\n<li>æŸ¥</li>\n</ul>\n</li>\n</ul>\n<h3 id=\"å†…å®¹çš„å¯è§æ€§\"><a href=\"#å†…å®¹çš„å¯è§æ€§\" class=\"headerlink\" title=\"å†…å®¹çš„å¯è§æ€§\"></a>å†…å®¹çš„å¯è§æ€§</h3><blockquote>\n<p>åˆ›ä½œè€…åˆ›ä½œäº†ä¸€ç¯‡æ–‡ç« ï¼Œé‚£ä¹ˆè¿™ç¯‡æ–‡ç« ä»€ä¹ˆæƒ…å†µä¸‹å¯ä»¥è¢«è¯»è€…çœ‹åˆ°å‘¢ï¼Ÿ</p>\n</blockquote>\n<p>æ ¹æ®ç”Ÿæ´»ç»éªŒï¼Œå¯ä»¥å¾ˆå®¹æ˜“æƒ³åˆ°ï¼šä¸€ç¯‡æ–‡ç« åªæœ‰åœ¨å‘è¡¨ï¼ˆé€šè¿‡å®¡æ ¸ï¼‰å¹¶ä¸”å¤„äºå…¬å¼€çŠ¶æ€ä¸‹æ‰èƒ½è¢«ç”¨æˆ·æ‰€çœ‹åˆ°ã€‚å¦‚æ­¤ï¼Œä¸€ç¯‡å¸–å­å°±æœ‰äº†å‘è¡¨å’Œæœªå‘è¡¨ä¸¤ä¸ªçŠ¶æ€ï¼Œæˆ‘ä»¬å¯ä»¥å¾ˆè½»æ¾åœ°å¾—å‡ºä¸€ç¯‡å¸–å­çš„<strong>çŠ¶æ€</strong>è½¬æ¢å›¾</p>\n<p><img src=\"https://raw.githubusercontent.com/lyydsheep/pic/main/202409092140450.png\" alt=\"image-20240909214045416\"></p>\n<p>æƒ³è±¡è¿™ä¹ˆä¸€ä¸ªåœºæ™¯ï¼Œç”¨æˆ·æ­£åœ¨æµè§ˆæ–‡ç« ï¼Œä¸æ­¤åŒæ—¶ä½œè€…ä¹Ÿåœ¨ä¿®æ”¹æ–‡ç« ï¼Œé‚£ä¹ˆç”¨æˆ·ä¼šå®æ—¶çœ‹åˆ°ä½œè€…çš„ä¿®æ”¹å—ï¼Ÿ</p>\n<p>è¿™å½“ç„¶ä¸ä¼šï¼Œåœ¨åˆ›ä½œè€…å‘å¸ƒä¹‹å‰ï¼Œè¿™äº›ä¿®æ”¹å¯¹è¯»è€…éƒ½æ˜¯ä¸å¯è§çš„</p>\n<p>ä¸€ç§å¾ˆæ˜¾ç„¶çš„è§£å†³åŠæ³•å°±æ˜¯<strong>åˆ†å¼€å­˜å‚¨</strong>ï¼Œå³ä¸€ä¸ª<strong>åˆ¶ä½œè¡¨</strong>ï¼Œä¸€ä¸ª<strong>çº¿ä¸Šè¡¨</strong></p>\n<p>ç”¨æˆ·çœ‹åˆ°çš„æ˜¯çº¿ä¸Šè¡¨ä¸­çš„æ•°æ®ï¼Œè€Œä½œè€…ä¿®æ”¹çš„éƒ½æ˜¯åˆ¶ä½œè¡¨ä¸­çš„æ•°æ®ï¼Œè¿™æ ·ä½œè€…çš„ä¿®æ”¹å¯¹äºç”¨æˆ·è€Œè¨€éƒ½æ˜¯ä¸å¯çŸ¥çš„ï¼Œåªæœ‰å½“çº¿ä¸Šè¡¨æ›´æ–°åï¼Œç”¨æˆ·æ‰èƒ½çœ‹åˆ°ä¿®æ”¹</p>\n<p>æ•´ç†ä¸Šè¿°åˆ†æï¼Œå¯ä»¥å¾—åˆ°æ›´è¯¦ç»†çš„çŠ¶æ€å›¾ï¼š</p>\n<p><img src=\"https://raw.githubusercontent.com/lyydsheep/pic/main/202409102004630.png\" alt=\"image-20240910200443544\"></p>\n<h3 id=\"æµç¨‹åˆ†æ\"><a href=\"#æµç¨‹åˆ†æ\" class=\"headerlink\" title=\"æµç¨‹åˆ†æ\"></a>æµç¨‹åˆ†æ</h3><p>æˆ‘ä»¬å°†ä¸¤ä¸ªè¡¨ï¼ˆåˆ¶ä½œè¡¨ã€çº¿ä¸Šè¡¨ï¼‰çš„çŠ¶æ€ï¼Œåˆ†åˆ«ç”¨ä¸€ä½äºŒè¿›åˆ¶è¡¨ç¤ºï¼Œå¯ä»¥å¾—å‡º3ä¸­èµ·å§‹çŠ¶æ€ï¼ˆæœ‰ä¸€ç§çŠ¶æ€ä¸å¯èƒ½å­˜åœ¨ï¼‰</p>\n<ul>\n<li>0 0ï¼šåˆ¶ä½œè¡¨å’Œçº¿ä¸Šè¡¨éƒ½æ²¡æœ‰æ•°æ®</li>\n<li>1 0ï¼šåªæœ‰åˆ¶ä½œè¡¨ä¸­æœ‰æ•°æ®</li>\n<li>1 1ï¼šåˆ¶ä½œè¡¨å’Œçº¿ä¸Šè¡¨éƒ½æœ‰æ•°æ®</li>\n</ul>\n<p>åˆ†ææ¯ä¸€ç§èµ·å§‹çŠ¶æ€å¯èƒ½çš„åç»­çŠ¶æ€</p>\n<ul>\n<li>0 0<ul>\n<li>1 0ï¼šä½œè€…å†™äº†ä¸€åŠï¼Œæœ¨æœ‰å‘è¡¨</li>\n<li>1 1ï¼šä½œè€…å†™å¥½å¹¶å‘è¡¨äº†æ–‡ç« </li>\n<li><img src=\"https://raw.githubusercontent.com/lyydsheep/pic/main/202409102014800.png\" alt=\"image-20240910201425755\"></li>\n</ul>\n</li>\n<li>1 0<ul>\n<li>1 1ï¼šä½œè€…å†™å¥½å¹¶å‘è¡¨äº†æ–‡ç« </li>\n<li><img src=\"https://raw.githubusercontent.com/lyydsheep/pic/main/202409102014565.png\" alt=\"image-20240910201456526\"></li>\n</ul>\n</li>\n<li>1 1<ul>\n<li>1 1ï¼šä½œè€…ä¿®æ”¹æ–‡ç« </li>\n<li><img src=\"https://raw.githubusercontent.com/lyydsheep/pic/main/202409102026434.png\" alt=\"image-20240910202622396\"></li>\n</ul>\n</li>\n</ul>\n<h2 id=\"TDDä¸ç¼–è¾‘æ¥å£\"><a href=\"#TDDä¸ç¼–è¾‘æ¥å£\" class=\"headerlink\" title=\"TDDä¸ç¼–è¾‘æ¥å£\"></a>TDDä¸ç¼–è¾‘æ¥å£</h2><p><strong>TDDï¼šæµ‹è¯•é©±åŠ¨å¼€å‘ï¼Œå…ˆå†™æµ‹è¯•ï¼Œå†å†™å®ç°</strong></p>\n<ul>\n<li>é€šè¿‡æ’°å†™æµ‹è¯•ï¼Œ<strong>ç†æ¸…æ¥šæ¥å£è¯¥å¦‚ä½•å®šä¹‰ï¼Œç«™åœ¨ç”¨æˆ·çš„è§’åº¦çœ‹æ˜¯å¦åˆé€‚</strong></li>\n<li>é€šè¿‡æ’°å†™æµ‹è¯•ç”¨ä¾‹ï¼Œ<strong>ç†æ¸…æ¥šæ•´ä¸ªåŠŸèƒ½è¦è€ƒè™‘çš„ä¸»æµç¨‹ã€å¼‚å¸¸æµç¨‹</strong></li>\n</ul>\n<h3 id=\"æ ¸å¿ƒå¾ªç¯\"><a href=\"#æ ¸å¿ƒå¾ªç¯\" class=\"headerlink\" title=\"æ ¸å¿ƒå¾ªç¯\"></a>æ ¸å¿ƒå¾ªç¯</h3><ul>\n<li>æ ¹æ®å¯¹éœ€æ±‚çš„ç†è§£ï¼Œ<strong>åˆæ­¥å®šä¹‰æ¥å£</strong>ï¼Œæ— æ‰€è°“æ¥å£åˆä¸åˆé€‚ï¼Œåæ­£è¿˜å¾—æ”¹</li>\n<li>æ ¹æ®æ¥å£å®šä¹‰æµ‹è¯•</li>\n<li>æ‰§è¡Œæ ¸å¿ƒå¾ªç¯<ul>\n<li>å¢åŠ æµ‹è¯•ç”¨ä¾‹</li>\n<li>æä¾›&#x2F;ä¿®æ”¹å®ç°</li>\n<li>æ‰§è¡Œæµ‹è¯•ç”¨ä¾‹</li>\n</ul>\n</li>\n</ul>\n<img src=\"https://raw.githubusercontent.com/lyydsheep/pic/main/202409161517114.png\" alt=\"image-20240916151718031\" style=\"zoom:67%;\" />\n\n<h3 id=\"suiteæµ‹è¯•ç»„ç»‡å¥—ä»¶\"><a href=\"#suiteæµ‹è¯•ç»„ç»‡å¥—ä»¶\" class=\"headerlink\" title=\"suiteæµ‹è¯•ç»„ç»‡å¥—ä»¶\"></a>suiteæµ‹è¯•ç»„ç»‡å¥—ä»¶</h3><p><a href=\"https://annatarhe.github.io/2020/08/19/how-to-do-test-in-go.html\">å‚è€ƒæ–‡ç« </a></p>\n<p>æœ‰çš„æ—¶å€™åœ¨æµ‹è¯•ä¹‹å‰éœ€è¦è¿æ¥dbã€redisã€rpcä¹‹ç±»çš„ä¸œè¥¿ï¼Œç„¶åå†æµ‹è¯•ç»“æŸåå°†è¿™äº›è¿æ¥å…³é—­ã€‚ä¹Ÿå°±æ˜¯è¯´ï¼Œæˆ‘ä»¬çš„å•å…ƒï¼ˆé›†æˆï¼‰æµ‹è¯•å…·æœ‰<strong>ç”Ÿå‘½å‘¨æœŸ</strong>ã€‚å¦‚æœæ˜¯æ‰‹åŠ¨ç¼–å†™è¿æ¥ã€å…³é—­è¿æ¥çš„ä»£ç ä¼šä½¿å¾—æµ‹è¯•éƒ¨åˆ†æ˜¾å¾—å¼‚å¸¸è‡ƒè‚¿ï¼Œå¥½åœ¨æœ‰<code>suite</code>å¯ä»¥å¸®åŠ©æˆ‘ä»¬æœ‰æ•ˆåœ°ç®¡ç†æµ‹è¯•çš„ç”Ÿå‘½å‘¨æœŸ</p>\n<figure class=\"highlight go\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br><span class=\"line\">31</span><br><span class=\"line\">32</span><br><span class=\"line\">33</span><br><span class=\"line\">34</span><br><span class=\"line\">35</span><br><span class=\"line\">36</span><br><span class=\"line\">37</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">import</span> (</span><br><span class=\"line\">    <span class=\"string\">&quot;testing&quot;</span></span><br><span class=\"line\">    <span class=\"string\">&quot;github.com/stretchr/testify/assert&quot;</span></span><br><span class=\"line\">    <span class=\"string\">&quot;github.com/stretchr/testify/suite&quot;</span></span><br><span class=\"line\">)</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\">// å®šä¹‰æµ‹è¯•ç»“æ„ä½“</span></span><br><span class=\"line\"><span class=\"keyword\">type</span> ExampleTestSuite <span class=\"keyword\">struct</span> &#123;</span><br><span class=\"line\">    suite.Suite</span><br><span class=\"line\">    msg <span class=\"type\">string</span></span><br><span class=\"line\">&#125;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\">// æµ‹è¯•å‰çš„é¢„å¤‡</span></span><br><span class=\"line\"><span class=\"function\"><span class=\"keyword\">func</span> <span class=\"params\">(suite *ExampleTestSuite)</span></span> SetupTest() &#123;</span><br><span class=\"line\">    suite.msg = <span class=\"string\">&quot;iu is my wife&quot;</span></span><br><span class=\"line\">    db, _ = sql.Open(<span class=\"string\">&quot;xxx&quot;</span>)</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\">// æµ‹è¯•</span></span><br><span class=\"line\"><span class=\"function\"><span class=\"keyword\">func</span> <span class=\"params\">(suite *ExampleTestSuite)</span></span> TestExample() &#123;</span><br><span class=\"line\">    m := &amp;obj&#123;</span><br><span class=\"line\">        Msg: suite.msg</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">    err := insert(m)</span><br><span class=\"line\">    assert.Nil(suite.T(), err)</span><br><span class=\"line\">    assert.Equal(suite.T(), suite.msg, m.Msg)</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\">// æµ‹è¯•åçš„æ¸…ç†</span></span><br><span class=\"line\"><span class=\"function\"><span class=\"keyword\">func</span> <span class=\"params\">(suite *ExampleTestSuite)</span></span> TearDownTest() &#123;</span><br><span class=\"line\">    db.Close()</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\">// å…¥å£</span></span><br><span class=\"line\"><span class=\"function\"><span class=\"keyword\">func</span> <span class=\"title\">TestExampleTestSuite</span><span class=\"params\">(t *testing.T)</span></span> &#123;</span><br><span class=\"line\">    suite.Run(t, <span class=\"built_in\">new</span>(ExampleTestSuite))</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n\n<p>äº”ä¸ªæ­¥éª¤</p>\n<ul>\n<li><strong>å®šä¹‰æµ‹è¯•ç»“æ„ä½“</strong><ul>\n<li>æµ‹è¯•ç»“æ„ä½“ä¸­åº”åŒ…å«æ‰€éœ€è¦çš„ç¬¬ä¸‰æ–¹å­—æ®µï¼Œä¾‹å¦‚<code>suite.Suite</code>,<code>gorm.DB</code>, <code>redis.Cmdable</code>ç­‰</li>\n</ul>\n</li>\n<li><strong>å…¥å£å‡½æ•°</strong><ul>\n<li><code>func TestExampleTestSuite(t *testing.T)</code></li>\n<li>å‡½æ•°ä½“ä¸­ä»…æœ‰<code>suite.Run(t, new(xxx))</code>ä¸€è¡Œä»£ç </li>\n</ul>\n</li>\n<li><strong>æµ‹è¯•å‰çš„å‡†å¤‡å·¥ä½œ</strong><ul>\n<li><code>func (suite *ExampleTestSuite) SetupTest()</code></li>\n</ul>\n</li>\n<li>æµ‹è¯•<ul>\n<li><code>func (suite *ExampleTestSuite) TestExample()</code></li>\n</ul>\n</li>\n<li><strong>æµ‹è¯•åçš„æ¸…ç†</strong><ul>\n<li><code>func (suite *ExampleTestSuite) TearDownTest()</code></li>\n</ul>\n</li>\n</ul>\n<h3 id=\"TDDé›†æˆæµ‹è¯•å®è·µï¼ˆä¸€ï¼‰\"><a href=\"#TDDé›†æˆæµ‹è¯•å®è·µï¼ˆä¸€ï¼‰\" class=\"headerlink\" title=\"TDDé›†æˆæµ‹è¯•å®è·µï¼ˆä¸€ï¼‰\"></a>TDDé›†æˆæµ‹è¯•å®è·µï¼ˆä¸€ï¼‰</h3><figure class=\"highlight go\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br><span class=\"line\">31</span><br><span class=\"line\">32</span><br><span class=\"line\">33</span><br><span class=\"line\">34</span><br><span class=\"line\">35</span><br><span class=\"line\">36</span><br><span class=\"line\">37</span><br><span class=\"line\">38</span><br><span class=\"line\">39</span><br><span class=\"line\">40</span><br><span class=\"line\">41</span><br><span class=\"line\">42</span><br><span class=\"line\">43</span><br><span class=\"line\">44</span><br><span class=\"line\">45</span><br><span class=\"line\">46</span><br><span class=\"line\">47</span><br><span class=\"line\">48</span><br><span class=\"line\">49</span><br><span class=\"line\">50</span><br><span class=\"line\">51</span><br><span class=\"line\">52</span><br><span class=\"line\">53</span><br><span class=\"line\">54</span><br><span class=\"line\">55</span><br><span class=\"line\">56</span><br><span class=\"line\">57</span><br><span class=\"line\">58</span><br><span class=\"line\">59</span><br><span class=\"line\">60</span><br><span class=\"line\">61</span><br><span class=\"line\">62</span><br><span class=\"line\">63</span><br><span class=\"line\">64</span><br><span class=\"line\">65</span><br><span class=\"line\">66</span><br><span class=\"line\">67</span><br><span class=\"line\">68</span><br><span class=\"line\">69</span><br><span class=\"line\">70</span><br><span class=\"line\">71</span><br><span class=\"line\">72</span><br><span class=\"line\">73</span><br><span class=\"line\">74</span><br><span class=\"line\">75</span><br><span class=\"line\">76</span><br><span class=\"line\">77</span><br><span class=\"line\">78</span><br><span class=\"line\">79</span><br><span class=\"line\">80</span><br><span class=\"line\">81</span><br><span class=\"line\">82</span><br><span class=\"line\">83</span><br><span class=\"line\">84</span><br><span class=\"line\">85</span><br><span class=\"line\">86</span><br><span class=\"line\">87</span><br><span class=\"line\">88</span><br><span class=\"line\">89</span><br><span class=\"line\">90</span><br><span class=\"line\">91</span><br><span class=\"line\">92</span><br><span class=\"line\">93</span><br><span class=\"line\">94</span><br><span class=\"line\">95</span><br><span class=\"line\">96</span><br><span class=\"line\">97</span><br><span class=\"line\">98</span><br><span class=\"line\">99</span><br><span class=\"line\">100</span><br><span class=\"line\">101</span><br><span class=\"line\">102</span><br><span class=\"line\">103</span><br><span class=\"line\">104</span><br><span class=\"line\">105</span><br><span class=\"line\">106</span><br><span class=\"line\">107</span><br><span class=\"line\">108</span><br><span class=\"line\">109</span><br><span class=\"line\">110</span><br><span class=\"line\">111</span><br><span class=\"line\">112</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\">// æµ‹è¯•å¥—ä»¶</span></span><br><span class=\"line\"><span class=\"keyword\">type</span> ArticleSuite <span class=\"keyword\">struct</span> &#123;</span><br><span class=\"line\">\tsuite.Suite</span><br><span class=\"line\">\tserver *gin.Engine</span><br><span class=\"line\">\tdb     *gorm.DB</span><br><span class=\"line\">\tl      *zap.Logger</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\">// SetupTest éƒ½ç”¨startupé‡Œçš„åˆå§‹åŒ–æ–¹æ³•ï¼Œå½“ç„¶ä½¿ç”¨wireç”Ÿæˆå•¦</span></span><br><span class=\"line\"><span class=\"function\"><span class=\"keyword\">func</span> <span class=\"params\">(s *ArticleSuite)</span></span> SetupTest() &#123;</span><br><span class=\"line\">\t<span class=\"keyword\">var</span> err <span class=\"type\">error</span></span><br><span class=\"line\">\ts.l, err = zap.NewDevelopment()</span><br><span class=\"line\">\t<span class=\"keyword\">if</span> err != <span class=\"literal\">nil</span> &#123;</span><br><span class=\"line\">\t\t<span class=\"built_in\">panic</span>(err)</span><br><span class=\"line\">\t&#125;</span><br><span class=\"line\">\ts.db = startup.InitDB(s.l)</span><br><span class=\"line\">\tgin.SetMode(gin.ReleaseMode)</span><br><span class=\"line\">\ts.server = gin.Default()</span><br><span class=\"line\">\t<span class=\"comment\">// åœ¨è¿™é‡Œæ”¾å¥½userClaimsï¼Œè¡¨ç¤ºç™»å½•çŠ¶æ€</span></span><br><span class=\"line\">\ts.server.Use(<span class=\"function\"><span class=\"keyword\">func</span><span class=\"params\">(ctx *gin.Context)</span></span> &#123;</span><br><span class=\"line\">\t\tctx.Set(<span class=\"string\">&quot;userClaims&quot;</span>, jwt.UserClaims&#123;</span><br><span class=\"line\">\t\t\tUserId: <span class=\"number\">123</span>,</span><br><span class=\"line\">\t\t&#125;)</span><br><span class=\"line\">\t&#125;)</span><br><span class=\"line\">\tartHdl := startup.InitArticleHandler()</span><br><span class=\"line\">\tartHdl.RegisterRoutes(s.server)</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"function\"><span class=\"keyword\">func</span> <span class=\"params\">(s *ArticleSuite)</span></span> TestEdit() &#123;</span><br><span class=\"line\">\tt := s.T()</span><br><span class=\"line\">\ttestCases := []<span class=\"keyword\">struct</span> &#123;</span><br><span class=\"line\">\t\tname <span class=\"type\">string</span></span><br><span class=\"line\">\t\t<span class=\"comment\">// å‡†å¤‡æ•°æ®</span></span><br><span class=\"line\">\t\tbefore <span class=\"function\"><span class=\"keyword\">func</span><span class=\"params\">(t *testing.T)</span></span></span><br><span class=\"line\">\t\t<span class=\"comment\">// æ ¡éªŒæ•°æ®</span></span><br><span class=\"line\">\t\tafter   <span class=\"function\"><span class=\"keyword\">func</span><span class=\"params\">(t *testing.T)</span></span></span><br><span class=\"line\">\t\tarticle Article</span><br><span class=\"line\">\t\t<span class=\"comment\">// é¢„æœŸæ•°æ®</span></span><br><span class=\"line\">\t\texpectCode <span class=\"type\">int</span></span><br><span class=\"line\">\t\texpectRes  Result[<span class=\"type\">int</span>]</span><br><span class=\"line\">\t&#125;&#123;</span><br><span class=\"line\">\t\t&#123;</span><br><span class=\"line\">\t\t\tname: <span class=\"string\">&quot;æ–°å»ºå¸–å­â€”â€”ä¿å­˜æˆåŠŸ&quot;</span>,</span><br><span class=\"line\">\t\t\tbefore: <span class=\"function\"><span class=\"keyword\">func</span><span class=\"params\">(t *testing.T)</span></span> &#123;</span><br><span class=\"line\"></span><br><span class=\"line\">\t\t\t&#125;,</span><br><span class=\"line\">\t\t\tafter: <span class=\"function\"><span class=\"keyword\">func</span><span class=\"params\">(t *testing.T)</span></span> &#123;</span><br><span class=\"line\">\t\t\t\t<span class=\"comment\">// å¯¹æ¯ä¸€åˆ—æ•°æ®éƒ½è¦è¿›è¡Œæ£€éªŒ</span></span><br><span class=\"line\">\t\t\t\t<span class=\"keyword\">var</span> article dao.Article</span><br><span class=\"line\">\t\t\t\terr := s.db.Where(<span class=\"string\">&quot;id=?&quot;</span>, <span class=\"number\">1</span>).First(&amp;article).Error</span><br><span class=\"line\">\t\t\t\trequire.NoError(t, err)</span><br><span class=\"line\">\t\t\t\tassert.True(t, article.Ctime &gt; <span class=\"number\">0</span>)</span><br><span class=\"line\">\t\t\t\tassert.True(t, article.Utime &gt; <span class=\"number\">0</span>)</span><br><span class=\"line\">\t\t\t\tarticle.Ctime = <span class=\"number\">0</span></span><br><span class=\"line\">\t\t\t\tarticle.Utime = <span class=\"number\">0</span></span><br><span class=\"line\">\t\t\t\tassert.Equal(t, dao.Article&#123;</span><br><span class=\"line\">\t\t\t\t\tId:       <span class=\"number\">1</span>,</span><br><span class=\"line\">\t\t\t\t\tTitle:    <span class=\"string\">&quot;è¿™æ˜¯æ ‡é¢˜&quot;</span>,</span><br><span class=\"line\">\t\t\t\t\tContent:  <span class=\"string\">&quot;è¿™æ˜¯å†…å®¹&quot;</span>,</span><br><span class=\"line\">\t\t\t\t\tAuthorId: <span class=\"number\">123</span>,</span><br><span class=\"line\">\t\t\t\t&#125;, article)</span><br><span class=\"line\">\t\t\t&#125;,</span><br><span class=\"line\">            article: Article&#123;</span><br><span class=\"line\">                Title: <span class=\"string\">&quot;è¿™æ˜¯æ ‡é¢˜&quot;</span>,</span><br><span class=\"line\">                Content: <span class=\"string\">&quot;è¿™æ˜¯å†…å®¹&quot;</span>,</span><br><span class=\"line\">            &#125;</span><br><span class=\"line\">\t\t\texpectCode: http.StatusOK,</span><br><span class=\"line\">\t\t\texpectRes: Result[<span class=\"type\">int</span>]&#123;</span><br><span class=\"line\">\t\t\t\tData: <span class=\"number\">1</span>,</span><br><span class=\"line\">\t\t\t&#125;,</span><br><span class=\"line\">\t\t&#125;,</span><br><span class=\"line\">\t&#125;</span><br><span class=\"line\">\t<span class=\"keyword\">for</span> _, tc := <span class=\"keyword\">range</span> testCases &#123;</span><br><span class=\"line\">\t\tt.Run(tc.name, <span class=\"function\"><span class=\"keyword\">func</span><span class=\"params\">(t *testing.T)</span></span> &#123;</span><br><span class=\"line\">\t\t\t<span class=\"comment\">//tc.before(t)</span></span><br><span class=\"line\">\t\t\t<span class=\"comment\">// ä»¥jsonæ ¼å¼è¾“å…¥</span></span><br><span class=\"line\">\t\t\tarticleJson, err := json.Marshal(tc.article)</span><br><span class=\"line\">\t\t\trequire.NoError(t, err)</span><br><span class=\"line\">\t\t\treq, err := http.NewRequest(http.MethodPost, <span class=\"string\">&quot;/article/edit&quot;</span>, bytes.NewBuffer(articleJson))</span><br><span class=\"line\">\t\t\treq.Header.Set(<span class=\"string\">&quot;Content-Type&quot;</span>, <span class=\"string\">&quot;application/json&quot;</span>)</span><br><span class=\"line\">\t\t\trequire.NoError(t, err)</span><br><span class=\"line\">\t\t\tresp := httptest.NewRecorder()</span><br><span class=\"line\">\t\t\ts.server.ServeHTTP(resp, req)</span><br><span class=\"line\">\t\t\t<span class=\"keyword\">var</span> res Result[<span class=\"type\">int</span>]</span><br><span class=\"line\">\t\t\tassert.Equal(t, tc.expectCode, resp.Code)</span><br><span class=\"line\">\t\t\terr = json.NewDecoder(resp.Body).Decode(&amp;res)</span><br><span class=\"line\">\t\t\tassert.Equal(t, tc.expectRes, res)</span><br><span class=\"line\">\t\t\t<span class=\"comment\">//tc.after(t)</span></span><br><span class=\"line\">\t\t&#125;)</span><br><span class=\"line\">\t&#125;</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\">// æµ‹è¯•åæ‰€ä½œçš„åŠ¨ä½œ</span></span><br><span class=\"line\"><span class=\"function\"><span class=\"keyword\">func</span> <span class=\"params\">(s *ArticleSuite)</span></span> TearDownTest() &#123;</span><br><span class=\"line\">\ts.db.Exec(<span class=\"string\">&quot;truncate table articles&quot;</span>)</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"function\"><span class=\"keyword\">func</span> <span class=\"title\">TestArticleSuite</span><span class=\"params\">(t *testing.T)</span></span> &#123;</span><br><span class=\"line\">\tsuite.Run(t, <span class=\"built_in\">new</span>(ArticleSuite))</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"keyword\">type</span> Article <span class=\"keyword\">struct</span> &#123;</span><br><span class=\"line\">\tTitle   <span class=\"type\">string</span> <span class=\"string\">`json:&quot;title&quot;`</span></span><br><span class=\"line\">\tContent <span class=\"type\">string</span> <span class=\"string\">`json:&quot;content&quot;`</span></span><br><span class=\"line\">&#125;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"keyword\">type</span> Result[T any] <span class=\"keyword\">struct</span> &#123;</span><br><span class=\"line\">\tMsg  <span class=\"type\">string</span> <span class=\"string\">`json:&quot;msg&quot;`</span></span><br><span class=\"line\">\tCode <span class=\"type\">int</span>    <span class=\"string\">`json:&quot;code&quot;`</span></span><br><span class=\"line\">\tData T      <span class=\"string\">`json:&quot;data&quot;`</span></span><br><span class=\"line\">&#125;</span><br><span class=\"line\"></span><br></pre></td></tr></table></figure>\n\n<ul>\n<li><p>DDDä¾§é‡äºè®¾è®¡æ¶æ„ã€é«˜å±‚æ¬¡æˆ˜ç•¥</p>\n</li>\n<li><p>TDDä¸“æ³¨äºæŸä¸ªåŠŸèƒ½çš„å®ç°</p>\n</li>\n</ul>\n<p>åœ¨å¼€å‘è¿‡ç¨‹ä¸­ï¼Œå¯ä»¥ä½¿ç”¨å¦‚ä¸‹æŠ€å·§ï¼Œç¡®ä¿ç±»å‹å®ç°äº†ç‰¹å®šæ¥å£æ¥å£</p>\n<p>ä¾‹å¦‚ï¼Œç¡®ä¿<code>ArticleHandler</code>ç±»å‹å®ç°äº†<code>handler</code>æ¥å£</p>\n<p><img src=\"https://raw.githubusercontent.com/lyydsheep/pic/main/202409072112298.png\" alt=\"image-20240907211201251\"></p>\n<h3 id=\"TDDé›†æˆæµ‹è¯•å®è·µï¼ˆäºŒï¼‰\"><a href=\"#TDDé›†æˆæµ‹è¯•å®è·µï¼ˆäºŒï¼‰\" class=\"headerlink\" title=\"TDDé›†æˆæµ‹è¯•å®è·µï¼ˆäºŒï¼‰\"></a>TDDé›†æˆæµ‹è¯•å®è·µï¼ˆäºŒï¼‰</h3><p>åœ¨å®ç°å®Œåˆ›å»ºæ–‡ç« åŠŸèƒ½åï¼Œæ¥ç€å°±è¦å®ç°ä¿®æ”¹æ–‡ç« åŠŸèƒ½</p>\n<p>ä¾æ®TDDæ ¸å¿ƒå¾ªç¯ï¼Œéœ€è¦å†æ·»åŠ æµ‹è¯•ç”¨ä¾‹</p>\n<p><img src=\"https://raw.githubusercontent.com/lyydsheep/pic/main/202409161518765.png\" alt=\"image-20240916151741659\"></p>\n<p>ç”±äºæˆ‘ä»¬å°†è¦å®ç°çš„æ˜¯ä¿®æ”¹æ–‡ç« åŠŸèƒ½ï¼Œä¹Ÿå°±æ˜¯è¯´<strong>æ–‡ç« æ˜¯äº‹å…ˆå­˜åœ¨çš„ï¼Œå‰ç«¯è¯·æ±‚å°†ä¼šå¸¦ä¸Šæ–‡ç« çš„Id</strong>ï¼Œé‚£ä¹ˆåœ¨æµ‹è¯•æ—¶éœ€è¦åœ¨<code>before</code>å‡½æ•°ä¸­åšå¥½æ•°æ®çš„å‡†å¤‡å·¥ä½œ</p>\n<figure class=\"highlight go\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">before: <span class=\"function\"><span class=\"keyword\">func</span><span class=\"params\">(t *testing.T)</span></span> &#123;</span><br><span class=\"line\">    err := s.db.Create(&amp;dao.Article&#123;</span><br><span class=\"line\">        Id:      <span class=\"number\">2</span>,</span><br><span class=\"line\">        Title:   <span class=\"string\">&quot;æ—§çš„æ ‡é¢˜&quot;</span>,</span><br><span class=\"line\">        Content: <span class=\"string\">&quot;æ—§çš„æ ‡é¢˜&quot;</span>,</span><br><span class=\"line\">        <span class=\"comment\">// å’Œæ—¶é—´æœ‰å…³çš„æµ‹è¯•ï¼Œæœ€å¥½ä¸ç”¨time.Now(), å› ä¸ºæ¯ä¸€æ¬¡éƒ½ä¸ä¸€æ ·ï¼Œä¸æ–¹ä¾¿è¿›è¡Œæ–­è¨€</span></span><br><span class=\"line\">        AuthorId: <span class=\"number\">123</span>,</span><br><span class=\"line\">        Ctime:    <span class=\"number\">677</span>,</span><br><span class=\"line\">        Utime:    <span class=\"number\">677</span>,</span><br><span class=\"line\">    &#125;).Error</span><br><span class=\"line\">    require.NoError(t, err)</span><br><span class=\"line\">&#125;,</span><br></pre></td></tr></table></figure>\n\n<p>æ›´æ–°æ–‡ç« æ¶‰åŠåˆ°æ›´æ–°æ•°æ®åº“ï¼Œæœ‰ä¸¤ä¸ªå€¼å¾—æ³¨æ„çš„ç‚¹</p>\n<ul>\n<li><p>ä¿®æ”¹<code>utime</code>è¿™ä¸ªè·Ÿæ—¶é—´æœ‰å…³çš„å­—æ®µï¼Œè€Œåœ¨è¿›è¡Œå’Œæ—¶é—´æœ‰å…³çš„æµ‹è¯•æ—¶ï¼Œå°½é‡ä¸è¦ä½¿ç”¨<code>time.Now()</code>å‡½æ•°ï¼Œå› ä¸ºæ¯ä¸€æ¬¡è¿è¡Œ<code>time.Now()</code>ç»“æœéƒ½ä¸ç›¸åŒï¼Œä¸ä¾¿äºåç»­çš„æ–­è¨€æ“ä½œ</p>\n</li>\n<li><p>ä¸¤ç§æ›´æ–°æ“ä½œå†™æ³•</p>\n<ul>\n<li><pre><code class=\"go\">// åˆ©ç”¨äº†gormå¿½ç•¥é›¶å€¼çš„ç‰¹æ€§ï¼Œæ ¹æ®ä¸»é”®ï¼ˆé”å®šè¦æ›´æ–°çš„è¡Œï¼‰è¿›è¡Œæ›´æ–°æ“ä½œ\n// å¯è¯»æ€§å·®\n// å¿½ç•¥é›¶å€¼æ˜¯æŒ‡å¦‚æœæŸä¸ªå­—æ®µæ˜¯åŸæœ¬æ˜¯é›¶å€¼ï¼Œé‚£ä¹ˆå°±ä¸æ›´æ–°è¯¥å­—æ®µ\nerr := dao.db.WithContext(ctx).Updates(&amp;article).Error\n<figure class=\"highlight plaintext\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"></span><br><span class=\"line\">- ```go</span><br><span class=\"line\">  // å¯è¯»æ€§è¾ƒå¼º</span><br><span class=\"line\">  err := dao.db.WithContext(ctx).Model(&amp;article).</span><br><span class=\"line\">  \t\tWhere(&quot;id=?&quot;, article.Id).Updates(map[string]any&#123;</span><br><span class=\"line\">  \t\t&quot;title&quot;:   article.Title,</span><br><span class=\"line\">  \t\t&quot;content&quot;: article.Content,</span><br><span class=\"line\">  \t\t&quot;utime&quot;:   article.Utime,</span><br></pre></td></tr></table></figure>\n</code></pre>\n</li>\n<li><p>å¿½ç•¥é›¶å€¼å¯å‚è€ƒ <a href=\"https://gorm.io/zh_CN/docs/update.html#%E6%9B%B4%E6%96%B0%E5%A4%9A%E5%88%97\">æ›´æ–° | GORM</a></p>\n</li>\n</ul>\n</li>\n</ul>\n<h2 id=\"DDDï¼šå®ä½“-â€”â€”-å€¼å¯¹è±¡\"><a href=\"#DDDï¼šå®ä½“-â€”â€”-å€¼å¯¹è±¡\" class=\"headerlink\" title=\"DDDï¼šå®ä½“ â€”â€” å€¼å¯¹è±¡\"></a>DDDï¼šå®ä½“ â€”â€” å€¼å¯¹è±¡</h2><p>ä¸‹å›¾æ‰€ç¤ºå°±æ˜¯ä¸€ä¸ªéå¸¸ç»å…¸çš„é¢†åŸŸè®¾è®¡é©±åŠ¨ä¸­çš„é¢†åŸŸå¯¹è±¡ä¸­<strong>å®ä½“</strong>å’Œ<strong>å€¼å¯¹è±¡</strong>çš„ä¸€ä¸ªä½“ç°</p>\n<img src=\"https://raw.githubusercontent.com/lyydsheep/pic/main/202409161550256.png\" alt=\"image-20240916155000184\" style=\"zoom:67%;\" />\n\n<ul>\n<li>å®ä½“ï¼š<strong>ç‹¬ç«‹å­˜åœ¨çš„</strong></li>\n<li>å€¼å¯¹è±¡ï¼š<strong>ä¾èµ–äºå®ä½“è€Œå­˜åœ¨ï¼Œé€šå¸¸ä½œä¸ºå®ä½“çš„å±æ€§å‡ºç°</strong></li>\n</ul>\n<p>å¯ä»¥ç»“åˆå®ä¾‹ç†è§£ä¸€ä¸‹ï¼šåœ¨ç”¨æˆ·é¢†åŸŸï¼Œä¸€ä¸ªäººæ˜¯ä¸€ä¸ªå®ä½“ï¼Œä»–æ˜¯ç‹¬ç«‹å­˜åœ¨çš„ï¼›è€Œåœ¨å¸–å­é¢†åŸŸï¼Œä¸€ä¸ªäººæ˜¯ä¾èµ–äºå¸–å­æ‰èƒ½æˆä¸ºä½œè€…ï¼Œæ˜¯ä¸€ä¸ªå€¼å¯¹è±¡</p>\n<p><strong>åœ¨DDDé‡Œé¢ï¼Œä¸€ä¸ªé¢†åŸŸçš„å®ä½“ï¼Œåœ¨å¦ä¸€ä¸ªé¢†åŸŸä¸­é€šå¸¸ä½œä¸ºå€¼å¯¹è±¡ã€å¦ä¸€ä¸ªå®ä½“çš„å±æ€§å‡ºç°</strong></p>\n<h2 id=\"æ•°æ®åŒæ­¥\"><a href=\"#æ•°æ®åŒæ­¥\" class=\"headerlink\" title=\"æ•°æ®åŒæ­¥\"></a>æ•°æ®åŒæ­¥</h2><h3 id=\"èŒè´£åˆ’åˆ†\"><a href=\"#èŒè´£åˆ’åˆ†\" class=\"headerlink\" title=\"èŒè´£åˆ’åˆ†\"></a>èŒè´£åˆ’åˆ†</h3><blockquote>\n<p>ç”±ä¹‹å‰çš„åˆ†æå¯çŸ¥ï¼Œæˆ‘ä»¬éœ€è¦ä¸€ä¸ªåˆ¶ä½œè¡¨å’Œçº¿ä¸Šè¡¨ï¼Œé‚£ä¹ˆè¯¥æœ‰å“ªä¸€ä¸ªéƒ¨åˆ†æ¥åŒæ­¥ä¸¤ä¸ªè¡¨çš„æ•°æ®å‘¢ï¼Ÿ</p>\n</blockquote>\n<p>ç†è®ºä¸Šï¼Œé¡¹ç›®æ˜¯å•ä½“åº”ç”¨è¿˜æ˜¯å¾®æœåŠ¡åº”ç”¨æ˜¯é€‰æ‹©æ—¶éœ€è¦å‚è€ƒçš„å› ç´ </p>\n<ul>\n<li>web&#x2F;èšåˆæœåŠ¡<ul>\n<li>è°ƒç”¨ä¸åŒçš„serviceæ¥åŒæ­¥æ•°æ®ï¼Œå¯ä»¥ç†è§£ä¸ºä½œè€…å’Œè¯»è€…å„æœ‰å„çš„æœåŠ¡</li>\n</ul>\n</li>\n<li>service<ul>\n<li>è°ƒç”¨ä¸åŒçš„repositoryæ¥ä¿å­˜æ•°æ®ï¼Œä»å­˜å‚¨çš„è§’åº¦çœ‹æ¥ï¼Œä½œè€…çœ‹åˆ°çš„å¸–å­å’Œè¯»è€…çœ‹åˆ°çš„å¸–å­æ˜¯ä¸ä¸€æ ·çš„</li>\n</ul>\n</li>\n<li>repository<ul>\n<li>æ“ä½œä¸åŒçš„æ•°æ®æº</li>\n</ul>\n</li>\n</ul>\n<p><strong>ä¸šåŠ¡ç®€å•å°±ä¸€ä¸ªrepositoryï¼Œå¤æ‚å°±ç”¨å¤šä¸ªrepository</strong></p>\n<img src=\"https://raw.githubusercontent.com/lyydsheep/pic/main/202409271441109.png\" alt=\"image-20240927144102855\" style=\"zoom:50%;\" />\n\n<h3 id=\"ç»´æŠ¤äº‹åŠ¡\"><a href=\"#ç»´æŠ¤äº‹åŠ¡\" class=\"headerlink\" title=\"ç»´æŠ¤äº‹åŠ¡\"></a>ç»´æŠ¤äº‹åŠ¡</h3><p>åŒæ­¥åˆ¶ä½œåº“å’Œçº¿ä¸Šåº“è¦ä¹ˆåŒæ—¶æˆåŠŸï¼Œè¦ä¹ˆåŒæ—¶å¤±è´¥ï¼Œå› æ­¤å°†æ•°æ®åŒæ­¥æ“ä½œåšæˆä¸€ä¸ªäº‹åŠ¡å†åˆé€‚ä¸è¿‡äº†</p>\n<p>å¯ä»¥åœ¨ä¸¤ä¸ªå±‚é¢ä¸Šç»´æŠ¤äº‹åŠ¡ï¼Œä¸€ä¸ªæ˜¯<code>repository</code>ï¼Œå¦ä¸€ä¸ªæ˜¯<code>dao</code>ã€‚ä½†æ˜¯<code>repository</code>åœ¨DDDä¸­åº”è¯¥æ˜¯æ“ä½œæ•°æ®åº“å’Œç¼“å­˜çš„ï¼Œå¦‚æœåœ¨è¿™ä¸€å±‚é¢ç»´æŠ¤äº‹åŠ¡ï¼Œç»“æœå°±æ˜¯è·¨å±‚æ“ä½œå¹¶å¼ºè€¦åˆäºGORMï¼ˆè€Œä¸”å†™èµ·æ¥ä¸ä¼˜é›…ğŸ¤ªï¼‰ã€‚å¦ä¸€ç§æ–¹æ¡ˆæ˜¯åœ¨<code>dao</code>å±‚ä¸­ç»´æŠ¤äº‹åŠ¡ï¼ˆè¿™å°±æ–¹ä¾¿å¤šå•¦ğŸ˜Šï¼‰ï¼Œå…·ä½“å®ç°å¦‚ä¸‹</p>\n<figure class=\"highlight go\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"function\"><span class=\"keyword\">func</span> <span class=\"params\">(dao *BasicArticleDAO)</span></span> Sync(ctx context.Context, article Article) (<span class=\"type\">int</span>, <span class=\"type\">error</span>) &#123;</span><br><span class=\"line\">\tid := article.Id</span><br><span class=\"line\">\t<span class=\"comment\">// åˆ©ç”¨GORMæ§åˆ¶äº‹åŠ¡çš„ç”Ÿå‘½å‘¨æœŸ</span></span><br><span class=\"line\">\terr := dao.db.WithContext(ctx).Transaction(<span class=\"function\"><span class=\"keyword\">func</span><span class=\"params\">(tx *gorm.DB)</span></span> <span class=\"type\">error</span> &#123;</span><br><span class=\"line\">\t\t<span class=\"keyword\">var</span> err <span class=\"type\">error</span></span><br><span class=\"line\">\t\t<span class=\"keyword\">if</span> id &gt; <span class=\"number\">0</span> &#123;</span><br><span class=\"line\">\t\t\terr = dao.UpdateById(ctx, article)</span><br><span class=\"line\">\t\t&#125; <span class=\"keyword\">else</span> &#123;</span><br><span class=\"line\">\t\t\tid, err = dao.Insert(ctx, article)</span><br><span class=\"line\">\t\t&#125;</span><br><span class=\"line\">\t\t<span class=\"keyword\">if</span> err != <span class=\"literal\">nil</span> &#123;</span><br><span class=\"line\">\t\t\t<span class=\"keyword\">return</span> err</span><br><span class=\"line\">\t\t&#125;</span><br><span class=\"line\">\t\t<span class=\"keyword\">return</span> dao.Upsert(ctx, PublishArticle&#123;</span><br><span class=\"line\">\t\t\tArticle: article,</span><br><span class=\"line\">\t\t&#125;)</span><br><span class=\"line\">\t&#125;)</span><br><span class=\"line\">\t<span class=\"keyword\">return</span> id, err</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n\n<p>âš ï¸ï¼šGORMçš„<code>transaction</code>æ–¹æ³•åœ¨åº•å±‚å®ç°æ—¶å°±å·²ç»å¸®æˆ‘ä»¬ç»´æŠ¤äº†<strong>äº‹åŠ¡çš„ç”Ÿå‘½å‘¨æœŸ</strong></p>\n<blockquote>\n<p>é‡ç‚¹æ˜¯å¦‚ä½•åœ¨GORMä¸‹å®ç°Upsertå‡½æ•°</p>\n</blockquote>\n<figure class=\"highlight go\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"function\"><span class=\"keyword\">func</span> <span class=\"params\">(dao *BasicArticleDAO)</span></span> Upsert(ctx context.Context, article PublishArticle) <span class=\"type\">error</span> &#123;</span><br><span class=\"line\">\tnow := time.Now().UnixMilli()</span><br><span class=\"line\">\tarticle.Utime = now</span><br><span class=\"line\">\tarticle.Ctime = now</span><br><span class=\"line\">\t<span class=\"comment\">// Upsertå‡½æ•°åœ¨GORMä¸‹çš„å®ç°</span></span><br><span class=\"line\">\t<span class=\"keyword\">return</span> dao.db.WithContext(ctx).Clauses(clause.OnConflict&#123;</span><br><span class=\"line\">\t\tDoUpdates: clause.Assignments(<span class=\"keyword\">map</span>[<span class=\"type\">string</span>]<span class=\"keyword\">interface</span>&#123;&#125;&#123;</span><br><span class=\"line\">\t\t\t<span class=\"string\">&quot;title&quot;</span>:   article.Title,</span><br><span class=\"line\">\t\t\t<span class=\"string\">&quot;content&quot;</span>: article.Content,</span><br><span class=\"line\">\t\t\t<span class=\"string\">&quot;utime&quot;</span>:   article.Utime,</span><br><span class=\"line\">\t\t&#125;),</span><br><span class=\"line\">\t&#125;).Create(&amp;article).Error</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n\n<p>å‘<code>Clauses</code>å‡½æ•°ä¸­ä¼ é€’<code>OnConflict</code>ç»“æ„ä½“ï¼Œè¡¨ç¤ºå¦‚æœå‘ç”Ÿå†²çªçš„è¯åº”è¯¥åšä»€ä¹ˆäº‹æƒ…</p>\n<p><code>OnConfilt</code>ä¸­æœ‰ä¸€äº›æ¯”è¾ƒæœ‰ç”¨çš„å­—æ®µ</p>\n<figure class=\"highlight go\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\">// DoUpdate\t\t---&gt; åšæ›´æ–°æ“ä½œ</span></span><br><span class=\"line\"><span class=\"comment\">// DoNothing\t---&gt; ä»€ä¹ˆä¹Ÿä¸åš</span></span><br><span class=\"line\"><span class=\"comment\">// Where\t\t---&gt; æ•°æ®å†²çªäº†å¹¶ä¸”ç¬¦åˆwhereå­å¥ï¼Œå°±æ‰§è¡Œæ›´æ–°æ“ä½œ</span></span><br></pre></td></tr></table></figure>\n\n<p><strong>ğŸŒŸï¼šåœ¨ä¸€ä¸ªäº‹åŠ¡ä¸­ï¼Œä¸€ç›´éƒ½æ˜¯åŒä¸€ä¸ªæ•°æ®åº“è¿æ¥</strong></p>\n<h2 id=\"ç»´æŠ¤çŠ¶æ€\"><a href=\"#ç»´æŠ¤çŠ¶æ€\" class=\"headerlink\" title=\"ç»´æŠ¤çŠ¶æ€\"></a>ç»´æŠ¤çŠ¶æ€</h2><p>åœ¨å…ˆå‰çš„åˆ†æä¸­ï¼Œæˆ‘ä»¬çŸ¥é“éœ€è¦æœ‰çº¿ä¸Šåº“å’Œåˆ¶ä½œåº“ä¸¤ä¸ªæ•°æ®å­˜å‚¨çš„åœ°æ–¹ï¼Œè¿™ä¸¤ä¸ªåœ°æ–¹å­˜å‚¨çš„æ•°æ®æœ¬è´¨ä¸Šæ˜¯ä¸€æ ·çš„ï¼Œå› æ­¤ä¸å¿…åˆ›å»ºæ–°çš„é¢†åŸŸå¯¹è±¡æ¥ç»´æŠ¤ï¼Œ<strong>ä½¿ç”¨è¡ç”Ÿç±»å‹æ›´åŠ æ–¹ä¾¿</strong></p>\n<h3 id=\"çŠ¶æ€å¸¸é‡å®šä¹‰\"><a href=\"#çŠ¶æ€å¸¸é‡å®šä¹‰\" class=\"headerlink\" title=\"çŠ¶æ€å¸¸é‡å®šä¹‰\"></a>çŠ¶æ€å¸¸é‡å®šä¹‰</h3><p>åˆ©ç”¨å¸¸é‡è¡¨ç¤ºä¸€ç¯‡å¸–å­çš„ä¸åŒçŠ¶æ€ï¼Œè¿™äº›å¸¸é‡å¯ä»¥ç›´æ¥åˆ©ç”¨<code>iota</code>åœ¨<code>domain</code>ä¸­å®šä¹‰ã€‚<strong>ä¸€èˆ¬å®šä¹‰å¸¸é‡ï¼Œæœ€å¥½ä¸è¦æŠŠé›¶å€¼åšæˆæœ‰æ„ä¹‰çš„å€¼</strong>ï¼Œå¦åˆ™éš¾ä»¥åŒºåˆ†æ˜¯ç”¨æˆ·æ²¡æœ‰è¾“å…¥è¿˜æ˜¯å‰ç«¯ä¼ é€’é»˜è®¤æ•°æ®</p>\n<p><img src=\"https://raw.githubusercontent.com/lyydsheep/pic/main/202409270907841.png\" alt=\"image-20240927090706192\"></p>\n<h2 id=\"ä½¿ç”¨MongoDBå­˜å‚¨\"><a href=\"#ä½¿ç”¨MongoDBå­˜å‚¨\" class=\"headerlink\" title=\"ä½¿ç”¨MongoDBå­˜å‚¨\"></a>ä½¿ç”¨MongoDBå­˜å‚¨</h2><p>ç±»ä¼¼äºå¤§æ–‡æœ¬ä¹‹ç±»çš„ä¸œè¥¿ï¼Œé™¤äº†å¯ä»¥ä½¿ç”¨å…³ç³»å‹æ•°æ®åº“ï¼Œä¹Ÿå¯ä»¥è€ƒè™‘ä½¿ç”¨å…¶ä»–å­˜å‚¨åº”ç”¨ï¼Œä¾‹å¦‚MongoDB</p>\n<p><strong>MongoDBå±äºNoSQLï¼ŒNoSQLå³Not Only SQL</strong>ï¼Œä¸ä»…ä»…æ˜¯SQL</p>\n<p>NoSQLæ•°æ®åº“çš„äº§ç”Ÿæ˜¯ä¸ºäº†è§£å†³å¤§è§„æ¨¡æ•°æ®é›†åˆã€å¤šç§æ•°æ®ç§ç±»å¸¦æ¥çš„æŒ‘æˆ˜ï¼Œå°¤å…¶æ˜¯å¤§æ•°æ®åº”ç”¨éš¾é¢˜</p>\n<img src=\"https://raw.githubusercontent.com/lyydsheep/pic/main/202409301530245.png\" alt=\"image-20240930153021471\" style=\"zoom:50%;\" />\n\n<h3 id=\"MongoDBç®€ä»‹\"><a href=\"#MongoDBç®€ä»‹\" class=\"headerlink\" title=\"MongoDBç®€ä»‹\"></a>MongoDBç®€ä»‹</h3><p>MongoDBçš„åŸºæœ¬ç‰¹æ€§</p>\n<ul>\n<li><strong>é¢å‘é›†åˆå­˜å‚¨</strong>ï¼šMongoDBé›†åˆä¸­å¯ä»¥å­˜å‚¨å¤šä¸ªæ–‡æ¡£<ul>\n<li>ç±»æ¯”äºMySQLï¼ŒMongoDBä¸­çš„ä¸€ä¸ªé›†åˆå°±åƒæ˜¯ä¸€å¼ è¡¨ï¼Œé›†åˆä¸­çš„ä¸€ä¸ªæ–‡æ¡£å°±ç›¸å½“äºè¡¨ä¸­çš„ä¸€æ¡è®°å½•</li>\n</ul>\n</li>\n<li><strong>æ¨¡å¼è‡ªç”±</strong>ï¼šMongoDBé‡‡ç”¨æ— ç»“æ„æ¨¡å¼å­˜å‚¨æ•°æ®ï¼Œä¹Ÿå°±æ˜¯è¯´ï¼Œåœ¨å‚¨å­˜æ•°æ®ä¹‹å‰ä¸éœ€è¦å®šä¹‰æ•°æ®çš„ç»“æ„<ul>\n<li>å°±åƒå½“äºåœ¨MySQLä¸­ä¸éœ€è¦é¢„å…ˆå»ºç«‹è¡¨ç»“æ„å°±èƒ½æ’å…¥æ•°æ®</li>\n</ul>\n</li>\n<li><strong>æ”¯æŒåˆ†ç‰‡</strong>ï¼šMongoDBæ”¯æŒåˆ†ç‰‡ï¼Œå¹¶ä¸”MongoDBè‡ªåŠ¨è§£å†³äº†åˆ†ç‰‡çš„å„ç§é—®é¢˜ï¼ŒåŒ…æ‹¬è‡ªåŠ¨åŒ–æ‰©å®¹</li>\n</ul>\n<img src=\"https://raw.githubusercontent.com/lyydsheep/pic/main/202409301530677.png\" alt=\"image-20240930153009489\" style=\"zoom:67%;\" />\n\n<p>é€‰æ‹©MongoDBçš„ä¸¤ä¸ªç†ç”±ï¼š</p>\n<ul>\n<li><p><strong>çµæ´»çš„æ–‡æ¡£æ¨¡å‹</strong>ï¼šäºMySQLä¸åŒï¼Œä¸éœ€è¦äº‹å‰åœ¨MongoDBä¸­å®šä¹‰æ–‡æ¡£æ¨¡å‹ï¼Œå¹¶ä¸”å¯ä»¥çµæ´»ä¿®æ”¹</p>\n</li>\n<li><p><strong>æ˜“äºæ¨ªå‘æ‰©å±•</strong>ï¼šå¯ä»¥é€šè¿‡å¢åŠ MongoDBå®ä¾‹æ¥åº”ä»˜æµé‡å’Œæ•°æ®å¢é•¿</p>\n</li>\n</ul>\n<h3 id=\"åˆå§‹åŒ–å®¢æˆ·ç«¯å¹¶æ’å…¥æ–‡æ¡£\"><a href=\"#åˆå§‹åŒ–å®¢æˆ·ç«¯å¹¶æ’å…¥æ–‡æ¡£\" class=\"headerlink\" title=\"åˆå§‹åŒ–å®¢æˆ·ç«¯å¹¶æ’å…¥æ–‡æ¡£\"></a>åˆå§‹åŒ–å®¢æˆ·ç«¯å¹¶æ’å…¥æ–‡æ¡£</h3><blockquote>\n<p>éœ€è¦ä½¿ç”¨MongoDBå®˜ç½‘çš„go-driver</p>\n</blockquote>\n<p><img src=\"https://raw.githubusercontent.com/lyydsheep/pic/main/202409301941675.png\" alt=\"image-20240930194117517\"></p>\n<h3 id=\"æŸ¥æ‰¾æ–‡æ¡£\"><a href=\"#æŸ¥æ‰¾æ–‡æ¡£\" class=\"headerlink\" title=\"æŸ¥æ‰¾æ–‡æ¡£\"></a>æŸ¥æ‰¾æ–‡æ¡£</h3><p>åœ¨MongoDBä¸­æœ‰ä¸¤ç§æ„é€ æŸ¥è¯¢æ¡ä»¶çš„æ–¹å¼ï¼š</p>\n<ul>\n<li><strong>bson</strong></li>\n<li><strong>ç»“æ„ä½“</strong></li>\n</ul>\n<figure class=\"highlight go\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\">// ä½¿ç”¨bsonæ„é€ æŸ¥è¯¢æ¡ä»¶</span></span><br><span class=\"line\">filter := bson.D&#123;bson.E&#123;Key: <span class=\"string\">&quot;id&quot;</span>, Value: <span class=\"number\">123</span>&#125;&#125;</span><br><span class=\"line\"><span class=\"keyword\">var</span> art Article</span><br><span class=\"line\">err = col.FindOne(ctx, filter).Decode(&amp;art)</span><br><span class=\"line\">assert.NoError(t, err)</span><br><span class=\"line\">fmt.Printf(<span class=\"string\">&quot;find article %v\\n&quot;</span>, art)</span><br><span class=\"line\"><span class=\"comment\">// ä½¿ç”¨ç»“æ„ä½“æ„é€ æŸ¥è¯¢æ¡ä»¶</span></span><br><span class=\"line\">err = col.FindOne(ctx, Article&#123;Id: <span class=\"number\">123</span>&#125;).Decode(&amp;art)</span><br><span class=\"line\"><span class=\"keyword\">if</span> errors.Is(err, mongo.ErrNoDocuments) &#123;</span><br><span class=\"line\">\tfmt.Printf(<span class=\"string\">&quot;find none&quot;</span>)</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n\n<p>âš ï¸ï¼šä½¿ç”¨ç»“æ„ä½“æ„é€ æŸ¥è¯¢æ¡ä»¶æ—¶ï¼Œmongodb-go-driveré»˜è®¤ä½¿ç”¨ç»“æ„ä½“çš„å…¨éƒ¨å­—æ®µä½œä¸ºåŒ¹é…æ¡ä»¶ï¼Œéœ€è¦æ³¨æ„æŸäº›å­—æ®µ<strong>é»˜è®¤é›¶å€¼</strong>ã€‚å½“ç„¶ï¼Œå¯ä»¥ä½¿ç”¨<code>bson:&quot;field_name,omitempty&quot;</code>æ ‡ç­¾æ¥å‘ŠçŸ¥mongodb-go-driverå¿½ç•¥å­—æ®µé›¶å€¼</p>\n<p>ğŸŒŸï¼šå¯ä»¥ä½¿ç”¨<code>mongo.ErrNoDocuments</code>é”™è¯¯å€¼æ£€éªŒæ˜¯å¦æœ‰æŸ¥è¯¢åˆ°æ–‡æ¡£</p>\n<h3 id=\"æ›´æ–°æ–‡æ¡£\"><a href=\"#æ›´æ–°æ–‡æ¡£\" class=\"headerlink\" title=\"æ›´æ–°æ–‡æ¡£\"></a>æ›´æ–°æ–‡æ¡£</h3><ul>\n<li>æ„é€ æ›´æ–°æ¡ä»¶ï¼ŒåŒæ„é€ æŸ¥è¯¢æ¡ä»¶</li>\n<li>æ„é€ æ›´æ–°å­—æ®µ<ul>\n<li><strong>bson</strong></li>\n<li><strong>ç»“æ„ä½“</strong></li>\n</ul>\n</li>\n</ul>\n<p>âš ï¸ï¼šåŒæ ·çš„ï¼Œéœ€è¦æ³¨æ„<strong>åº•å±‚æ˜¯å¦ä¼šé‡‡ç”¨å­—æ®µé›¶å€¼</strong></p>\n<figure class=\"highlight go\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">sets := bson.D&#123;bson.E&#123;Key: <span class=\"string\">&quot;$set&quot;</span>,</span><br><span class=\"line\">\tValue: bson.E&#123;Key: <span class=\"string\">&quot;content&quot;</span>, Value: <span class=\"string\">&quot;serious content&quot;</span>&#125;&#125;&#125;</span><br><span class=\"line\">res, err := col.UpdateOne(ctx, filter, sets)</span><br><span class=\"line\"><span class=\"comment\">// ä½¿ç”¨ç»“æ„ä½“æ„é€ æ›´æ–°å­—æ®µ</span></span><br><span class=\"line\">res, err = col.UpdateOne(ctx, filter, bson.D&#123;bson.E&#123;Key: <span class=\"string\">&quot;$set&quot;</span>, Value: Article&#123;</span><br><span class=\"line\">\tTitle: <span class=\"string\">&quot;new title&quot;</span>,</span><br><span class=\"line\">&#125;&#125;&#125;)</span><br></pre></td></tr></table></figure>\n\n<h3 id=\"åˆ›å»ºç´¢å¼•\"><a href=\"#åˆ›å»ºç´¢å¼•\" class=\"headerlink\" title=\"åˆ›å»ºç´¢å¼•\"></a>åˆ›å»ºç´¢å¼•</h3><p>ç±»ä¼¼äºMySQLï¼Œ<strong>ä¸€èˆ¬æ˜¯æ ¹æ®ä¸šåŠ¡ä¸­å¸¸ç”¨çš„æŸ¥è¯¢æ¡ä»¶ï¼Œæ¥å†³å®šåœ¨ä»€ä¹ˆåˆ—ä¸Šæ„å»ºç´¢å¼•</strong></p>\n<figure class=\"highlight go\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">indexRes, err := col.Indexes().CreateOne(ctx, mongo.IndexModel&#123;</span><br><span class=\"line\">\tKeys:    bson.M&#123;<span class=\"string\">&quot;id&quot;</span>: <span class=\"number\">1</span>&#125;,</span><br><span class=\"line\">\tOptions: options.Index().SetUnique(<span class=\"literal\">true</span>),</span><br><span class=\"line\">&#125;)</span><br><span class=\"line\">fmt.Println(indexRes)</span><br></pre></td></tr></table></figure>\n\n<h3 id=\"MongoDBå­˜å‚¨æ•°æ®\"><a href=\"#MongoDBå­˜å‚¨æ•°æ®\" class=\"headerlink\" title=\"MongoDBå­˜å‚¨æ•°æ®\"></a>MongoDBå­˜å‚¨æ•°æ®</h3><p>ç”±äºMongoDBä¸­çš„<code>_id</code>å­—æ®µä¸æ˜¯è‡ªå¢å¹¶ä¸”æ˜¯ä¸€ä¸ª<strong>12å­—èŠ‚</strong>çš„åˆ‡ç‰‡ï¼Œå› æ­¤ä¸èƒ½ç›´æ¥ä½¿ç”¨è¿™ä¸ªå­—æ®µä½œä¸ºä¸»é”®</p>\n<p>ä¸»é”®çš„å¯é€‰æ–¹æ¡ˆï¼š</p>\n<ul>\n<li><strong>å°†æ•´ä¸ªidä¿®æ”¹ä¸ºstringç±»å‹</strong></li>\n<li><strong>ä½¿ç”¨IDç”Ÿæˆç­–ç•¥</strong>ï¼Œä¾‹å¦‚<strong>é›ªèŠ±ç®—æ³•</strong><ul>\n<li><strong>1æ¯”ç‰¹ä¿ç•™ä½</strong></li>\n<li><strong>41æ¯”ç‰¹æ—¶é—´æˆ³</strong></li>\n<li><strong>10æ¯”ç‰¹æœºå™¨ä½</strong>ï¼Œä¸€èˆ¬å«åš<code>Worker ID</code></li>\n<li><strong>12æ¯”ç‰¹è‡ªå¢åºå·</strong></li>\n<li><img src=\"https://raw.githubusercontent.com/lyydsheep/pic/main/202410031541579.png\" alt=\"image-20241003154159484\"></li>\n</ul>\n</li>\n<li><strong>ä½¿ç”¨GUID</strong></li>\n<li><strong>å®šä¹‰ä¸€ä¸ªæ–°çš„æ¥å£</strong>ï¼Œä½†è¿™æ ·å°±å¤±å»äº†DAOå±‚çš„ç»Ÿä¸€æ¥å£</li>\n</ul>\n<p><strong>âš ï¸ï¼šåœ¨MongoDBä¸­ï¼Œå°½é‡ä½¿ç”¨è¡ç”Ÿç±»å‹è€Œä¸æ˜¯åµŒå¥—ç»“æ„ä½“ã€‚å› ä¸ºåµŒå¥—ç»“æ„ä½“ä¸­å­ç»“æ„ä½“çš„å­—æ®µæ ‡ç­¾åœ¨æ“ä½œè¿‡ç¨‹ä¸­æ— æ³•æ­£å¸¸ç”Ÿæ•ˆ</strong></p>\n<h2 id=\"åˆ©ç”¨OSSæ¥å­˜å‚¨æ•°æ®\"><a href=\"#åˆ©ç”¨OSSæ¥å­˜å‚¨æ•°æ®\" class=\"headerlink\" title=\"åˆ©ç”¨OSSæ¥å­˜å‚¨æ•°æ®\"></a>åˆ©ç”¨OSSæ¥å­˜å‚¨æ•°æ®</h2><blockquote>\n<p>åˆ©ç”¨OSSå­˜å‚¨çº¿ä¸Šæ•°æ®ï¼Œè€Œåç›´æ¥é€šè¿‡CDNåŠ é€Ÿè®¿é—®</p>\n</blockquote>\n<p>OSSï¼ˆObject Storage Serviceï¼‰æ˜¯æŒ‡å…‘ç°å­˜å‚¨ï¼Œ<strong>è¢«å¤§é‡ç”¨äºå­˜å‚¨æ–‡ä»¶ã€æµåª’ä½“ã€å›¾ç‰‡ç­‰</strong></p>\n<p>OSSä¸­çš„ä¸¤ä¸ªæ ¸å¿ƒæ¦‚å¿µï¼š</p>\n<ul>\n<li><strong>Bucket</strong>ï¼šé€»è¾‘ä¸Šçš„åˆ†ç»„å…³ç³»ï¼Œä¾‹å¦‚æŸä¸ªä¸šåŠ¡ä½¿ç”¨ä¸€ä¸ªæ¡¶ï¼Œå¦ä¸€ä¸ªä¸šåŠ¡ä½¿ç”¨å¦å¤–ä¸€ä¸ªæ¡¶</li>\n<li><strong>Object</strong>ï¼šå¯¹è±¡ï¼Œä¹Ÿå°±æ˜¯éœ€è¦å­˜å‚¨çš„ä¸œè¥¿</li>\n</ul>\n<p>ACLï¼ˆAccess Control Listï¼‰ï¼šæƒé™æ§åˆ¶æ–¹æ¡ˆ</p>\n<p><img src=\"https://raw.githubusercontent.com/lyydsheep/pic/main/202410041010143.png\" alt=\"image-20241004101033272\"></p>\n<p>OSSé€šå¸¸å’ŒCDNç»“åˆåœ¨ä¸€èµ·ä½¿ç”¨ï¼Œ<strong>å³åœ¨OSSä¸Šå­˜å‚¨çš„æ•°æ®ï¼Œå¯ä»¥é€šè¿‡CDNæ¥è®¿é—®</strong></p>\n<p>ä¸€ç§å¾ˆå¸¸è§çš„æ€§èƒ½å’Œå¯ç”¨æ€§ä¼˜åŒ–æ‰‹æ®µï¼Œå°±æ˜¯ä½¿ç”¨<strong>OSSå’ŒCDNæ¥å­˜å‚¨ç½‘ç«™çš„é™æ€èµ„æº</strong>ï¼Œæ­¤æ—¶OSSè¢«å½“ä½œCDNçš„ä¸€ä¸ªå›æºç«™ç‚¹</p>\n<p><img src=\"https://raw.githubusercontent.com/lyydsheep/pic/main/202410041013265.png\" alt=\"image-20241004101307223\"></p>\n<h2 id=\"æŸ¥è¯¢æ¥å£ä¸ç¼“å­˜\"><a href=\"#æŸ¥è¯¢æ¥å£ä¸ç¼“å­˜\" class=\"headerlink\" title=\"æŸ¥è¯¢æ¥å£ä¸ç¼“å­˜\"></a>æŸ¥è¯¢æ¥å£ä¸ç¼“å­˜</h2><p>åœ¨å®ç°æŸ¥è¯¢æ–‡ç« åŠŸèƒ½è¿‡ç¨‹ä¸­ï¼Œéœ€è¦ä»ä¸åŒç”¨æˆ·è§’åº¦å‡ºå‘è¿›è¡Œæ€è€ƒ</p>\n<ul>\n<li>å¯¹äºåˆ›ä½œè€…æ¥è¯´ï¼Œéœ€è¦æŸ¥è¯¢è‡ªå·±çš„<strong>æ–‡ç« åˆ—è¡¨</strong>ä»¥åŠ<strong>æŸä¸€ç¯‡æ–‡ç« çš„è¯¦ç»†å†…å®¹</strong>ï¼Œåˆ†åˆ«å¯¹åº”ç€ä¸¤ä¸ªæ¥å£<ul>\n<li>åˆ—è¡¨æ¥å£</li>\n<li>è¯¦æƒ…æ¥å£</li>\n</ul>\n</li>\n<li>å¯¹äºè¯»è€…ï¼Œä»–èƒ½å¤Ÿ<strong>æœç´¢æŸç¯‡æ–‡ç« </strong>ã€<strong>æµè§ˆæ¨èæ–‡ç« åˆ—è¡¨</strong>ã€<strong>é˜…è¯»æ–‡ç« çš„å…·ä½“å†…å®¹</strong>ã€‚ç”±æ­¤å¯è§ï¼Œéœ€è¦æä¾›ä»¥ä¸‹æ¥å£<ul>\n<li>æœç´¢æ¥å£</li>\n<li>æ¨èæ¥å£</li>\n<li>é˜…è¯»æ–‡ç« æ¥å£</li>\n</ul>\n</li>\n</ul>\n<p>ç›®å‰ä»…å®ç°åˆ›ä½œè€…çš„<strong>åˆ—è¡¨æ¥å£å’Œè¯¦æƒ…æ¥å£</strong>ï¼Œä»¥åŠè¯»è€…çš„<strong>é˜…è¯»æ–‡ç« æ¥å£</strong></p>\n<h3 id=\"åˆ—è¡¨æ¥å£\"><a href=\"#åˆ—è¡¨æ¥å£\" class=\"headerlink\" title=\"åˆ—è¡¨æ¥å£\"></a>åˆ—è¡¨æ¥å£</h3><h4 id=\"éœ€æ±‚åˆ†æ-1\"><a href=\"#éœ€æ±‚åˆ†æ-1\" class=\"headerlink\" title=\"éœ€æ±‚åˆ†æ\"></a>éœ€æ±‚åˆ†æ</h4><p>å‚è€ƒæ˜é‡‘çš„åˆ—è¡¨å±•ç¤ºï¼š</p>\n<p><img src=\"https://raw.githubusercontent.com/lyydsheep/pic/main/202410061411490.png\" alt=\"image-20241006141112588\"></p>\n<p>å¯ä»¥å‘ç°ï¼Œåœ¨åˆ—è¡¨ä¸­å±•ç¤ºçš„æ–‡ç« å¯¹è±¡æœ‰å¦‚ä¸‹ç‰¹å¾ï¼š</p>\n<ul>\n<li>æ ‡é¢˜</li>\n<li>åˆ›å»ºæ—¶é—´</li>\n<li>ç®€ä»‹</li>\n<li>â€¦</li>\n</ul>\n<p>æ ¹æ®è¿™äº›ç‰¹å¾æˆ‘ä»¬å°±èƒ½å®šä¹‰å‡ºä¸å‰ç«¯ç›¸å¯¹åº”çš„<code>ArticleVO</code></p>\n<p>å¦ä¸€ä¸ªå€¼å¾—æ³¨æ„çš„ç‚¹æ˜¯ï¼Œ<strong>æ˜é‡‘åœ¨åˆ—è¡¨ä¸­å±•ç¤ºçš„æ–‡ç« åªæœ‰ä¸€å°éƒ¨åˆ†ï¼Œå½“é¡µé¢ä¸‹æ»‘æ—¶æ‰ä¼šåŠ è½½æ›´å¤šçš„æ–‡ç« </strong>ï¼Œè¿™å°±ç›¸å½“äºä¸€ä¸ª<strong>åˆ†é¡µæŸ¥è¯¢</strong>æ“ä½œ</p>\n<h4 id=\"åˆ†é¡µå½¢æ€\"><a href=\"#åˆ†é¡µå½¢æ€\" class=\"headerlink\" title=\"åˆ†é¡µå½¢æ€\"></a>åˆ†é¡µå½¢æ€</h4><p><strong>åˆ†é¡µçš„æ ¸å¿ƒç›®æ ‡å°±æ˜¯é¿å…ä¸€æ¬¡æ“ä½œå¤ªå¤šæ•°æ®ï¼Œå¼•å‘æ€§èƒ½é—®é¢˜</strong>ã€‚å†µä¸”ï¼Œåˆ—è¡¨é¡µåœ¨å±•ç¤ºçš„æ—¶å€™ï¼Œä¹Ÿä¸è®¸é‚£ä¹ˆå¤šçš„å†…å®¹ğŸ˜</p>\n<p>åˆ†é¡µæ¥å£ä¸€èˆ¬æœ‰ä¸‰ç§å®šä¹‰å½¢å¼ï¼š</p>\n<ul>\n<li><strong>ç›´æ¥å®šä¹‰<code>Offset</code>å’Œ<code>Limit</code>å­—æ®µ</strong></li>\n<li><strong>ç›´æ¥å®šä¹‰ä¸€ä¸ª<code>Page</code>å­—æ®µï¼Œå¹¶çº¦å®šå¥½Pageçš„å¤§å°</strong></li>\n<li><strong>ç›´æ¥å®šä¹‰ä¸€ä¸ª<code>Cursor</code>å­—æ®µ</strong></li>\n</ul>\n<img src=\"https://raw.githubusercontent.com/lyydsheep/pic/main/202410061421861.png\" alt=\"image-20241006142108823\" style=\"zoom: 50%;\" />\n\n<h3 id=\"ç¼“å­˜è®¾è®¡\"><a href=\"#ç¼“å­˜è®¾è®¡\" class=\"headerlink\" title=\"ç¼“å­˜è®¾è®¡\"></a>ç¼“å­˜è®¾è®¡</h3><blockquote>\n<p>ç¼“å­˜ç¬¬ä¸€é¡µåˆ†é¡µ</p>\n</blockquote>\n<p>å¤§éƒ¨åˆ†æƒ…å†µä¸‹ï¼Œä¸ä¼šå¯¹åˆ†é¡µç»“æœè¿›è¡Œç¼“å­˜ï¼Œ<strong>å› ä¸ºå¦‚æœæ•°æ®çš„ç­›é€‰æ¡ä»¶ã€æ’åºæ¡ä»¶ã€åˆ†é¡µæ¡ä»¶ã€åˆ†é¡µçš„åç§»é‡å’Œæ•°æ®é‡ä¸­çš„ä»»ä½•ä¸€ä¸ªå‘ç”Ÿäº†å˜åŒ–ï¼Œç¼“å­˜å°±å¾ˆéš¾ä½¿ç”¨äº†</strong></p>\n<p>ä½†å¯ä»¥åª<strong>ç¼“å­˜ç¬¬ä¸€é¡µ</strong>ï¼Œæ¯•ç«Ÿå¤§éƒ¨åˆ†ç”¨æˆ·åªçœ‹åˆ—è¡¨çš„ç¬¬ä¸€é¡µ</p>\n<p>æœ‰äº†ç¼“å­˜ä¹‹åï¼Œ<strong>æ¯æ¬¡è¿›è¡Œæ›´æ–°æ“ä½œéƒ½è¦å°†ç¼“å­˜åˆ é™¤ï¼Œé˜²æ­¢ç¼“å­˜ä¸ä¸€è‡´é—®é¢˜</strong></p>\n<blockquote>\n<p>ä¸šåŠ¡ç›¸å…³çš„é¢„åŠ è½½</p>\n</blockquote>\n<p><strong>é¢„åŠ è½½æœ¬è´¨ä¸Šå°±æ˜¯é¢„åˆ¤ç”¨æˆ·å°†è¦è¯»å–çš„å†…å®¹ï¼Œæå‰å°†å†…å®¹å­˜å…¥ç¼“å­˜ä¸­</strong></p>\n<p>è€Œä¸”ï¼Œå› ä¸ºæ˜¯é¢„æµ‹æ€§è´¨çš„ï¼Œæ‰€ä»¥è¿‡æœŸæ—¶é—´è®¾ç½®å¾—å¾ˆçŸ­</p>\n<p><img src=\"https://raw.githubusercontent.com/lyydsheep/pic/main/202410061512142.png\" alt=\"image-20241006151243081\"></p>\n<blockquote>\n<p>ä¸ç¼“å­˜å¤§æ–‡æ¡£ï¼ˆè°ƒä¼˜ğŸ˜‚ï¼‰</p>\n</blockquote>\n<p>å¯ä»¥è€ƒè™‘åœ¨Rediså†…å­˜æ¶ˆè€—å’Œç¼“å­˜æ€§èƒ½ä¹‹é—´åšä¸€ä¸ªæƒè¡¡</p>\n<p>ä¹Ÿå°±æ˜¯è¯´ï¼Œå¹¶ä¸æ˜¯æ‰€æœ‰çš„å€¼éƒ½éœ€è¦ç¼“å­˜ï¼Œ<strong>æœ‰ä¸€äº›å¾ˆå ç”¨å†…å­˜ç©ºé—´çš„æ–‡ç« å°±ä¸å¿…ç¼“å­˜</strong></p>\n<h4 id=\"ç¼“å­˜è¿‡æœŸæ—¶é—´\"><a href=\"#ç¼“å­˜è¿‡æœŸæ—¶é—´\" class=\"headerlink\" title=\"ç¼“å­˜è¿‡æœŸæ—¶é—´\"></a>ç¼“å­˜è¿‡æœŸæ—¶é—´</h4><p>ç¼“å­˜çš„è¿‡æœŸæ—¶é—´å’Œç¼“å­˜å‘½ä¸­ç‡æœ‰å…³ï¼Œä¸€èˆ¬æƒ…å†µä¸‹ï¼Œ<strong>è¿‡æœŸæ—¶é—´è¶Šé•¿ï¼Œå‘½ä¸­ç‡è¶Šé«˜ï¼Œä½†æ•°æ®ä¸€è‡´æ€§ä¼šå˜å·®ï¼›è¿‡æœŸæ—¶é—´è¶ŠçŸ­ï¼Œå‘½ä¸­ç‡è¶Šä½ï¼Œä½†æ•°æ®ä¸€è‡´æ€§ä¼šæ›´å¥½</strong></p>\n<ul>\n<li>ä¸šåŠ¡ç›¸å…³çš„ç¼“å­˜é¢„åŠ è½½ï¼Œè¿‡æœŸæ—¶é—´è¦çŸ­</li>\n<li>æ ¹æ®ç”¨æˆ·èº«ä»½æŒ‰æƒç»™äºˆä¸åŒçš„ç¼“å­˜æ—¶é—´</li>\n</ul>\n<h4 id=\"æ·˜æ±°ç­–ç•¥\"><a href=\"#æ·˜æ±°ç­–ç•¥\" class=\"headerlink\" title=\"æ·˜æ±°ç­–ç•¥\"></a>æ·˜æ±°ç­–ç•¥</h4><p>æ·˜æ±°ç­–ç•¥æ˜¯æŒ‡åœ¨ç¼“å­˜å†…å­˜ä¸å¤Ÿç”¨çš„æƒ…å†µä¸‹ï¼Œæ·˜æ±°æŸä¸€éƒ¨åˆ†æ•°æ®æ—¶çš„è®¡åˆ’</p>\n<p>å¸¸è§„æ–¹æ¡ˆå°±æ˜¯<strong>LRUå’ŒLFU</strong></p>\n<p>è¿˜æœ‰ä¸€äº›æ–¹æ¡ˆï¼š</p>\n<ul>\n<li>ä¼˜å…ˆæ·˜æ±°æ™®é€šåˆ›ä½œè€…çš„æ•°æ®ï¼Œç•™ä¸‹å¤§vçš„æ•°æ®</li>\n<li>ä¼˜å…ˆæ·˜æ±°å¤§å¯¹è±¡ï¼Œé‡Šæ”¾å‡ºæ›´å¤šçš„å†…å­˜ç©ºé—´</li>\n<li>ä¼˜å…ˆæ·˜æ±°å°å¯¹è±¡ï¼Œç›¸æ¯”äºå¤§å¯¹è±¡ï¼Œå°å¯¹è±¡åœ¨ä»æ•°æ®åº“ï¼ˆæˆ–OSSï¼‰ä¸­è·å–æ›´åŠ è¿…é€Ÿ</li>\n</ul>\n<h3 id=\"æ³¨æ„äº‹é¡¹\"><a href=\"#æ³¨æ„äº‹é¡¹\" class=\"headerlink\" title=\"æ³¨æ„äº‹é¡¹\"></a>æ³¨æ„äº‹é¡¹</h3><ul>\n<li>ä½¿ç”¨<code>wrapbodyandtoken</code>ç»Ÿä¸€å¤„ç†Bodyå’ŒTokenä¸­çš„æ•°æ®</li>\n<li>è€ƒè™‘åˆ°ä¸­æ–‡å­—ç¬¦ç”±å¤šä¸ªå­—èŠ‚ç»„æˆï¼Œåœ¨å¤„ç†åŒ…å«ä¸­æ–‡çš„å­—ç¬¦ä¸²æ—¶ï¼Œåº”å®ç°å°†å…¶è½¬ä¸º<code>[]rune</code>å†è¿›è¡Œ<code>len()</code>æ“ä½œ</li>\n<li>éœ€è¦å°†å­˜å‚¨å¯¹è±¡è½¬æ¢ä¸º<code>json</code>æ ¼å¼åæ‰èƒ½å­˜å…¥Redisä¸­ï¼Œå¦åˆ™ä¼šæŠ¥é”™</li>\n</ul>\n"},{"description":"è®°å½•å®šæ—¶å¾®æœåŠ¡é¡¹ç›®","_content":"\n# å®šæ—¶å¾®æœåŠ¡\n\n## å‰ç½®å‡†å¤‡\n\n### èƒŒæ™¯å’Œç°çŠ¶\n\nå¸‚é¢ä¸Šå·²æœ‰çš„å®šæ—¶å¾®æœåŠ¡æŠ€æœ¯ï¼šJava Timerã€Rocket MQã€xxl-jobã€Quartzã€Robfig/Cron\n\n- å¾ˆå¤šå…¬å¸çš„ä¸šåŠ¡åªéœ€è¦ä¸€ä¸ªç®€å•çš„â€œå®šæ—¶â€åŠŸèƒ½ã€‚ä¸ºäº†æ»¡è¶³ä¸€ä¸ªç®€å•å®šæ—¶åŠŸèƒ½è€Œå¼•å…¥è¿‡äºå¼ºå¤§è€Œä¸”è‡ƒè‚¿çš„ä»»åŠ¡è°ƒåº¦ç»„ä»¶æ˜¯ä¸åˆé€‚çš„\n- è®¾è®¡ä¸€ä¸ª**åŠŸèƒ½èšç„¦ã€è½»é‡çº§ã€ç»´æŠ¤æˆæœ¬ä½**çš„å®šæ—¶å¾®æœåŠ¡ç»„ä»¶æ˜¯å¾ˆæœ‰å¿…è¦çš„\n\n**å®šæ—¶å¾®æœåŠ¡LyyTimer**\n\n1. ä¾èµ–ç®€å•ï¼šåªéœ€è¦æä¾›MySQLã€Rediså’ŒKafkaç»„ä»¶çš„æ”¯æŒå³å¯ï¼Œæ¥å…¥å’Œç»´æŠ¤çš„æˆæœ¬ä½\n2. å­¦ä¹ æˆæœ¬ä½ï¼šæ•´ä¸ªå®šæ—¶å¾®æœåŠ¡åŠŸèƒ½èšç„¦ï¼Œå®¹æ˜“ä¸Šæ‰‹\n3. ç‰¹æ€§ä¼˜ï¼šLyyTimerå…·æœ‰é«˜ç²¾å‡†ã€é«˜è´Ÿè½½ã€å¼‚å¸¸å¤„ç†ç­‰ç‰¹æ€§ï¼Œèƒ½åŸºæœ¬æ»¡è¶³å¤§éƒ¨åˆ†çš„å®šæ—¶éœ€æ±‚\n\n### éš¾ç‚¹\n\n#### **é«˜ç²¾å‡†**\n\nç›¸å¯¹äºå•ç‚¹å®šæ—¶ï¼ˆä¾‹å¦‚Java.Timerï¼‰åŸºæœ¬èƒ½åšåˆ°æ¯«ç§’çº§è§¦å‘ï¼Œå‡ ä¹æ‰€æœ‰å®šæ—¶ä»»åŠ¡æ¡†æ¶æˆ–è€…æ¶ˆæ¯é˜Ÿåˆ—ï¼Œéƒ½åªèƒ½ä¿è¯ç§’çº§åˆ«è¯¯å·®\n\nå¸¸è§å¯¼è‡´æ—¶é—´è¯¯å·®å¤§çš„åŸå› ï¼š\n\n- å®šæ—¶è„šæœ¬è¿è¡Œè€—æ—¶\n- ç­‰å¾…å®šæ—¶è„šæœ¬è¿è¡Œ\n- æ¶ˆæ¯é˜Ÿåˆ—ä¸­æ¶ˆæ¯å †ç§¯\n- åˆ†å¸ƒå¼å®šæ—¶å™¨å»¶æ—¶å—ç½‘ç»œå½±å“\n- æ•°æ®åº“ä¸­æŸ¥æ‰¾ä»»åŠ¡æ•°æ®è€—æ—¶\n- ç‰¹æ®Šæ—¶é—´æ®µä»»åŠ¡è¿‡å¤š\n\n#### **é«˜è´Ÿè½½**\n\nèƒ½å¤Ÿæ”¯æŒåŒæ—¶å¤„ç†å¤§é‡ä»»åŠ¡ï¼Œå¹¶ä¸”å°½å¯èƒ½å°‘çš„å †ç§¯ä»»åŠ¡\n\né«˜è´Ÿè½½è§£å†³æ€è·¯å’Œæ–¹æ³•ï¼š\n\n- åº”ç”¨å±‚æ–¹é¢å‡å°‘ä»»åŠ¡é‡ï¼Œé€‰æ‹©å°†åŒä¸€æ—¶åˆ»çš„å¤šä¸ªç‹¬ç«‹ä»»åŠ¡åˆå¹¶æˆä¸€ä¸ªâ€œè®¡åˆ’åˆ—è¡¨â€\n- åˆ†åº“åˆ†è¡¨ï¼šå°†ä¸€ä¸ªå¤§å‹æ•°æ®åº“åˆ†æˆå¤šä¸ªè¾ƒå°çš„æ•°æ®åº“ï¼Œå¹¶å°†æ¯ä¸ªæ•°æ®åº“è¿›ä¸€æ­¥åˆ†æˆå¤šä¸ªè¾ƒå°çš„è¡¨ï¼Œæ¯ä¸ªè¡¨åªåŒ…å«éƒ¨åˆ†æ•°æ®\n  - å‚ç›´åˆ†è¡¨ï¼šä¿æŒåˆ—å®Œæ•´\n  - æ°´å¹³åˆ†è¡¨ï¼šåªä¿ç•™éƒ¨åˆ†åˆ—\n  - åˆ†åº“åˆ†è¡¨ç»„åˆ\n- æ•°æ®åˆ†åŒºï¼šå°†å¤§æ•°æ®æ‹†åˆ†æˆå¤šä¸ªå°æ•°æ®åˆ†åŒºï¼Œå°†è¿™äº›å°åˆ†åŒºå­˜å‚¨åœ¨ä¸åŒçš„ç‰©ç†è®¾å¤‡æˆ–æœåŠ¡å™¨ä¸Šï¼Œæä¾›æ•°æ®çš„å­˜å–æ•ˆç‡å’Œå¤„ç†é€Ÿåº¦\n- çº¿ç¨‹æ± æŠ€æœ¯\n  - å¤ç”¨çº¿ç¨‹ï¼Œé™ä½äº†èµ„æºæ¶ˆè€—\n  - é«˜æ•ˆåœ°ç®¡ç†å¤šä¸ªçº¿ç¨‹\n\n#### **ä»»åŠ¡å¼‚å¸¸å¤„ç†**\n\n>  å®šæ—¶ä»»åŠ¡éœ€æ±‚å¯ä»¥å…è®¸æœ‰ä¸€å®šçš„è¯¯å·®ï¼Œä½†æ˜¯ä¸èƒ½ä¸è§¦å‘\n\n**ä»»åŠ¡å¼‚å¸¸çš„åŸå› ï¼š**\n\n- åˆ›å»ºï¼ˆæ¿€æ´»ï¼‰ä»»åŠ¡æ¥å£å¼‚å¸¸ï¼šåœ¨åˆ›å»ºä»»åŠ¡é˜¶æ®µå‘ç”Ÿå¼‚å¸¸ï¼Œç³»ç»Ÿå¯ä»¥ç›´æ¥å°†å¼‚å¸¸åŸå› è¿”å›ç»™ç”¨æˆ·ã€‚ç”¨æˆ·æ„ŸçŸ¥åˆ°å¼‚å¸¸åï¼Œå¯é€šè¿‡ä¸»åŠ¨é‡è¯•è§£å†³é—®é¢˜ï¼Œå³è¯¥é˜¶æ®µçš„å¼‚å¸¸ä¸åº”è¯¥ç”±æ¡†æ¶è§£å†³\n\n- ä»»åŠ¡æµè½¬å¼‚å¸¸ï¼šä¸€æ—¦ä»»åŠ¡æˆåŠŸå­˜å‚¨åœ¨æ•°æ®åº“ä¸­ï¼Œå°±è®¤ä¸ºè¯¥å®šæ—¶ä»»åŠ¡åˆ›å»ºæˆåŠŸï¼Œå¾®æœåŠ¡æ¡†æ¶å°±è¦è´Ÿè´£è¯¥ä»»åŠ¡åç»­çš„æµè½¬ï¼ˆæŸ¥è¯¢æ•°æ®åº“ã€å‘é€æ¶ˆæ¯é˜Ÿåˆ—ã€ç¼“å­˜ç­‰ï¼‰ã€‚å› æ­¤ï¼Œæ¡†æ¶éœ€è¦è§£å†³ä»»åŠ¡æµè½¬è¿‡ç¨‹ä¸­å‘ç”Ÿçš„å¼‚å¸¸\n- ä»»åŠ¡è§¦å‘é˜¶æ®µå¼‚å¸¸ï¼šå½“ä»»åŠ¡æ‰§è¡Œåï¼Œç³»ç»Ÿéœ€è¦å›è°ƒå‘ŠçŸ¥ä¸šåŠ¡æ–¹ä»»åŠ¡ç»“æœã€‚å¯¹äºä¸šåŠ¡æ–¹æ¥è¯´ï¼Œå¦‚æœå›è°ƒå¤±è´¥å¯¼è‡´ç»“æœä¸¢å¤±ï¼Œå°±ç›¸å½“äºè¯¥ä»»åŠ¡æ²¡æœ‰æ‰§è¡Œè¿‡\n\n\n\n**å¸¸ç”¨çš„è§£å†³æ–¹æ¡ˆ**\n\n- **ï¼ˆç«‹å³ï¼‰é‡è¯•æœºåˆ¶**ï¼šå¯ä»¥åº”ä»˜ä¸€äº›å¶å‘æ€§å¼‚å¸¸ï¼Œä¾‹å¦‚æ•°æ®åº“æŠ–åŠ¨ã€RedisæŠ–åŠ¨\n- **å¤±è´¥å…œåº•æœºåˆ¶**ï¼šä¸€èˆ¬æ¥è¯´ï¼Œå…œåº•ç­–ç•¥éƒ½æ˜¯é‡‡ç”¨ä¸€äº›â€œæ— è„‘â€è„šæœ¬ï¼Œå…¨è¡¨æ‰«ææ•°æ®åº“ï¼Œé’ˆå¯¹å¤±è´¥è®°å½•è¿›è¡Œé‡è¯•æ“ä½œã€‚ä½†æ˜¯å…œåº•ç­–ç•¥ä¸€èˆ¬åœ¨æ€§èƒ½ä¸Šä¸å ä¼˜åŠ¿ï¼Œæ‰€ä»¥éœ€è¦é€‰æ‹©åˆé€‚çš„æ—¶é—´é—´éš”æ‰§è¡Œå…œåº•è„šæœ¬\n- **å¤±è´¥æŠ¥è­¦æœºåˆ¶**ï¼šå½“çŸ­æ—¶é—´å†…æœ‰å¤§é‡ä»»åŠ¡å¤±è´¥æ—¶ï¼Œéœ€è¦åŠæ—¶æŠ¥è­¦\n- **äººå·¥å¹²é¢„**\n\n## æ¶æ„è®¾è®¡\n\n### å®ç°æ€è·¯\n\n**å®šæ—¶å™¨æœ¬è´¨å®ç°æ€è·¯ï¼šæŸ¥è¯¢ + è§¦å‘**ï¼Œä»¥åŠæš´éœ²ç»™ç”¨æˆ·ä¸€ä¸ª**æ³¨å†Œä»»åŠ¡**æ¥å£\n\n- **æ³¨å†Œ**å®šæ—¶å™¨ï¼šæ¥å—ç”¨æˆ·çš„åˆ›å»ºè¯·æ±‚ï¼Œæ˜ç¡®æ¯ä¸€ä¸ªä»»åŠ¡çš„**æ‰§è¡Œæ—¶é—´**\n- **æŸ¥è¯¢**æ•°æ®åº“ï¼šæ¯éš”ä¸€æ®µæ—¶é—´é—´éš”å°±**æŸ¥è¯¢**ä»»åŠ¡åˆ—è¡¨ï¼Œç­›é€‰å‡ºæœªè§¦å‘çš„ä»»åŠ¡\n- **è§¦å‘**ä»»åŠ¡ï¼šè§¦å‘**æ‰§è¡Œæ—¶é—´å°äºå½“å‰æ—¶é—´ï¼ˆæ—¶åˆ»ï¼‰**çš„ä»»åŠ¡\n\n#### å­˜å‚¨ç»“æ„ä¼˜åŒ–ï¼šæœ‰åºè¡¨\n\n**åŸºäºæœ‰åºæ•°æ®ç»“æ„ï¼ŒåŠ å¿«æ•°æ®æŸ¥è¯¢**\n\nå¸¸è§çš„æœ‰åºæ•°æ®ç»“æ„ï¼šçº¢é»‘æ ‘ã€è·³è¡¨ã€å¹³è¡¡æ ‘ç­‰ï¼Œè¿™äº›æ•°æ®ç»“æ„é€šè¿‡åœ¨æ’å…¥æ“ä½œå‡æ‘ŠæŸ¥è¯¢æ“ä½œçš„æ—¶é—´å¤æ‚åº¦å®ç°**æŸ¥è¯¢æ—¶é—´å¤æ‚åº¦$$O(N) ---> O(logN)$$**çš„ä¼˜åŒ–\n\n#### å­˜å‚¨ç»“æ„ä¼˜åŒ–ï¼šæ¨ªå‘åˆ‡ç‰‡\n\n**æ ¹æ®æ—¶é—´åŒºé—´å¯¹æ•°æ®åˆ†ç‰‡ï¼Œå‡å°‘æŸ¥è¯¢æ—¶æ¶‰åŠçš„æ•°æ®æ•°é‡**\n\næ¯æ¬¡æŸ¥è¯¢æ•°æ®çš„æ—¶å€™ï¼ŒçœŸæ­£çš„ç›®æ ‡æ˜¯**å³å°†æ‰§è¡Œ**çš„ä»»åŠ¡ï¼Œè€Œ**ç¨åæ‰§è¡Œ**çš„ä»»åŠ¡å±äºæ— å…³ä»»åŠ¡ã€‚åŸºäºè¿™ä¸ªç†å¿µï¼Œæˆ‘ä»¬å¯ä»¥å°†æ•°æ®è¿›è¡Œæ¨ªå‘åˆ‡åˆ†ï¼Œä¾‹å¦‚æ¯ä¸€åˆ†é’Ÿåˆ’åˆ†ä¸€ä¸ªæ•°æ®åˆ‡ç‰‡ï¼Œç„¶åä»åŒ…å«ç›®æ ‡æ•°æ®çš„æ•°æ®åˆ‡ç‰‡ä¸­æŸ¥è¯¢æ•°æ®\n\nè¿™ç§åšæ³•å¯ä»¥å°†å¤§å¤§é™ä½æ¯ä¸€æ¬¡æŸ¥è¯¢çš„ä»»åŠ¡æ•°é‡çº§ï¼šN ---> N'ï¼Œå…¶ä¸­N' << Nï¼Œå³ä½¿æ²¡æœ‰æ”¹å˜æŸ¥è¯¢çš„æ—¶é—´å¤æ‚åº¦ï¼Œä½†å‡å°‘äº†æŸ¥è¯¢æ—¶æ¶‰åŠçš„æ•°æ®æ•°é‡\n\n#### å­˜å‚¨ç»“æ„ä¼˜åŒ–ï¼šçºµå‘åˆ‡ç‰‡\n\n**å¯¹æ•°æ®åˆ†åŒºè¿›è¡Œåˆ†æ¡¶ï¼Œæé«˜æ•°æ®æ“ä½œçš„å¹¶å‘åº¦**\n\næˆªæ­¢åˆ°ä¸Šä¸€æ­¥ï¼Œæ—¶é—´æ•°æ®åˆ†åŒºæ˜¯å®šæ—¶å™¨ä¸­çš„æœ€å°èµ„æºå•ä½ï¼Œæ¯ä¸€ä¸ªæ•°æ®åˆ†åŒºéƒ½ç”±ä¸€ä¸ªgoroutineï¼ˆæˆ–çº¿ç¨‹ï¼‰æ§åˆ¶ã€‚ä¸ºäº†æé«˜æ•°æ®æ“ä½œçš„å¹¶å‘åº¦ï¼Œå¯ä»¥å¯¹åˆ†åŒºä¸­çš„æ•°æ®è¿›ä¸€æ­¥**åˆ†æ¡¶**ï¼ŒæŠŠæ¯ä¸€ä¸ªæ¡¶äº¤ä»˜ç»™ä¸€ä¸ªgoroutineï¼ˆæˆ–çº¿ç¨‹ï¼‰å¤„ç†ï¼Œåœ¨çºµå‘å¢åŠ åˆ†æ¡¶çš„ç»´åº¦ï¼Œæé«˜å¹¶å‘åº¦\n\n> æ€»ç»“ï¼šä¾ç„¶æ˜¯â€œæŸ¥è¯¢ + è§¦å‘â€çš„å®šæ—¶å™¨æœºåˆ¶ï¼Œåªä¸è¿‡ç›¸è¾ƒäºä¸ç‰ˆå®šæ—¶å™¨æœ‰å¦‚ä¸‹å˜åŒ–ï¼šæ¯æ¬¡æŸ¥è¯¢éƒ½åªæŸ¥è¯¢ä¸€ä¸ªï¼ˆå½“å‰ï¼‰æ—¶é—´èŒƒå›´å†…çš„æ•°æ®ï¼Œè¿™äº›æ•°æ®ç”±ZSetæ•°æ®ç»“æ„å­˜å‚¨ã€‚æ¥ç€åŸºäºå¹¶å‘çš„è€ƒè™‘ï¼Œä»¤å¤šä¸ªgoroutineè´Ÿè´£ä»åˆ†åŒºä¸­çš„å¤šä¸ªæ¡¶ä¸­æŸ¥è¯¢æ•°æ®ï¼Œæœ€åå°†è§¦å‘è·å–åˆ°çš„ä»»åŠ¡ã€‚\n\n### æ•´ä½“æ¶æ„\n\n#### å®šæ—¶ä»»åŠ¡è°ƒåº¦æµç¨‹\n\nä»»åŠ¡è°ƒåº¦æµç¨‹**æœåŠ¡æ¶æ„ï¼šä¸‰ä¸ªæ¨¡å— + ä¸¤ä¸ªåç¨‹æ± **\n\nLyyTimeræ˜¯ä¸€ä¸ª**å»ä¸­å¿ƒåŒ–çš„å®šæ—¶ä»»åŠ¡è°ƒåº¦æ¡†æ¶**ï¼Œå®šæ—¶ä»»åŠ¡è°ƒåº¦æœåŠ¡æ ¹æ®èŒè´£è¾¹ç•Œå¯ä»¥å°†æœåŠ¡æ‹†åˆ†ä¸ºï¼š**è°ƒåº¦å™¨æ¨¡å—**ã€**è§¦å‘å™¨æ¨¡å—**ã€**æ‰§è¡Œæ¨¡å—**ï¼Œè¿™ä¸‰ä¸ªæ¨¡å—å­˜åœ¨ç€ä¾èµ–å…³ç³»ã€‚çˆ¶æ¨¡å—é€šè¿‡åç¨‹æ± å¼‚æ­¥å¯åŠ¨å­æ¨¡å—æ‰§è¡Œç›¸åº”å·¥ä½œ\n\n![image-20241125183915443](https://raw.githubusercontent.com/lyydsheep/pic/main/202411251841204.png)\n\n#### å®šæ—¶ä»»åŠ¡ç”Ÿæˆæµç¨‹\n\n**å®šæ—¶ä»»åŠ¡çš„åˆ›å»ºè®¾è®¡åˆ°Web Serverå’ŒMigrator Schedulerä¸¤ä¸ªæ¨¡å—**\n\n- ç”¨æˆ·é€šè¿‡Web Serveræä¾›çš„APIåˆ›å»ºå®šæ—¶ä»»åŠ¡\n- Migrator Schedulerå®šæ—¶æ ¹æ®cronè¡¨è¾¾å¼é¢„çƒ­å®šæ—¶ä»»åŠ¡æ•°æ®\n\n![image-20241125185145008](https://raw.githubusercontent.com/lyydsheep/pic/main/202411251851062.png)\n\n> ä¸ºä»€ä¹ˆéœ€è¦ä¸¤ç§æ–¹å¼é¢„çƒ­æ•°æ®ï¼Ÿ\n>\n> ä¸ºäº†ç¡®ä¿åœ¨å®šæ—¶è„šæœ¬æ‰§è¡Œé—´éš”å†…åˆ›å»ºçš„ä»»åŠ¡ç”Ÿæ•ˆã€‚ä¾‹å¦‚ï¼Œå®šæ—¶è„šæœ¬æ¯ä¸¤å°æ—¶æ‰§è¡Œä¸€æ¬¡ï¼Œæ¯ä¸€æ¬¡æ‰§è¡Œéƒ½ä¼šé¢„çƒ­ä¸¤å°æ—¶åçš„æ•°æ®ã€‚ç¬¬ä¸€æ¬¡å®šæ—¶è„šæœ¬æ‰§è¡Œæ—¶åˆ»æ˜¯18:58ï¼Œåˆ›å»ºäº†18:58-20:58å®šæ—¶ä»»åŠ¡ã€‚å€˜è‹¥æœ‰ç”¨æˆ·åœ¨19:00æƒ³è¦åˆ›å»ºä¸€ä¸ª19:58åˆ†çš„å®šæ—¶ä»»åŠ¡ï¼Œé‚£ä¹ˆåªä¾é å®šæ—¶è„šæœ¬æ˜¯æ— æ³•å®ç°çš„ï¼Œå› ä¸ºä¸‹ä¸€æ¬¡å®šæ—¶è„šæœ¬çš„æ‰§è¡Œæ—¶é—´æ˜¯20:58ã€‚ç»¼ä¸Šæ‰€è¯‰ï¼Œä»…ä»…æœ‰å®šæ—¶è„šæœ¬æ˜¯æœ‰ç¼ºé™·çš„ï¼Œè¿˜éœ€è¦ä¸€ä¸ªWeb Serveræ¨¡å—å®Œæˆä»»åŠ¡çš„ç¬¬ä¸€æ¬¡åˆ›å»ºï¼Œç¡®ä¿ç”¨æˆ·åœ¨ä»»ä½•æ—¶å€™åˆ›å»ºçš„ä»»åŠ¡éƒ½èƒ½ç”Ÿæ•ˆã€‚\n\n### è°ƒåº¦æµç¨‹æ¨¡å—åŒ–\n\n#### è°ƒåº¦å™¨æ¨¡å—\n\n**ç¡®å®šäºŒç»´æ•°æ®åˆ†åŒºç›®æ ‡å¯¹è±¡ï¼Œç»Ÿç­¹åˆ†é…è§¦å‘å™¨**\n\nè°ƒåº¦å™¨çš„ä½œç”¨å°±æ˜¯è¦ç¡®ä¿åœ¨åˆ†å¸ƒå¼åœºæ™¯ä¸‹ï¼Œæ¯ä¸€ä¸ªäºŒç»´æ•°æ®åˆ†åŒºéƒ½èƒ½è¢«ä¸€ä¸ªè§¦å‘å™¨è´Ÿè´£å¤„ç†ï¼Œæ—¢ä¸èƒ½é—æ¼ï¼Œä¹Ÿä¸èƒ½é‡å¤\n\n- è°ƒåº¦å™¨åŸºäºtime tickeræ¯ç§’é’Ÿè¿›è¡Œä¸€æ¬¡å·¥ä½œï¼Œæ ¹æ®å½“å‰æ—¶åˆ»æ¨ç®—å‡º**åˆ†é’Ÿçº§åˆ«**çš„å­—ç¬¦ä¸²è¡¨è¾¾å¼\n- æ ¹æ®é…ç½®ä¸­æœ€å¤§æ¡¶æ•°é‡ï¼Œä¾æ¬¡æ‹¼æ¥åˆ†é’ŸKeyå€¼å¾—åˆ°è‹¥å¹²ä¸ªäºŒç»´æ•°æ®åˆ†åŒºçš„Keyå€¼ã€‚ä¾‹å¦‚`20:47:39_0`ã€`20:48:11_1`\n- å°è¯•æŠ¢å æ•°æ®åˆ†åŒºçš„åˆ†å¸ƒå¼é”ï¼Œå¹¶æŠŠé”çš„è¿‡æœŸæ—¶é—´è®¾ç½®ä¸º**å¤§äº1å€åˆ†ç‰‡æ—¶é—´ï¼Œå°äº2å€åˆ†ç‰‡æ—¶é—´**\n- å¦‚æœæŠ¢é”æˆåŠŸï¼Œå°±è°ƒåº¦ä¸€ä¸ªè§¦å‘å™¨è¿›è¡Œä½œä¸š\n\n#### è§¦å‘å™¨æ¨¡å—\n\n**æŒ‰æ—¶å”¤é†’äºŒç»´æ•°æ®åˆ†åŒºä¸­çš„å®šæ—¶ä»»åŠ¡**\n\n- è§¦å‘å™¨è¢«åˆ›å»ºåï¼Œæ¯ç§’å¯¹è´Ÿè´£çš„æ•°æ®åˆ†åŒºè¿›è¡Œæ‰«æï¼Œä»¥å½“å‰æ—¶åˆ»ä¸ºåŸºå‡†ï¼Œå°†ç¬¦åˆæ¡ä»¶çš„å®šæ—¶ä»»åŠ¡å–å‡ºå¹¶äº¤ä»˜ç»™æ‰§è¡Œå™¨æ‰§è¡Œ\n- å½“è§¦å‘å™¨åç¨‹å®Œæˆä»»åŠ¡åï¼Œéœ€è¦å°†åˆ†å¸ƒå¼é”çš„è¿‡æœŸæ—¶é—´å»¶æœŸè‡³**å¤§äºä¸¤ä¸ªåˆ†åŒºæ—¶é—´**\n\n> ä¸ºä»€ä¹ˆè¦å¯¹åˆ†å¸ƒå¼é”è¿›è¡Œå»¶æœŸï¼Ÿ\n>\n> å›ç­”è¿™ä¸ªé—®é¢˜ä¹‹å‰ï¼Œéœ€è¦è¡¥å……çš„ä¸€ç‚¹ï¼šä¸ºäº†å¯¹å‰ä¸€åˆ†é’Ÿçš„æ•°æ®åˆ†åŒºæ‰§è¡Œå¤±è´¥åšå…œåº•ï¼Œæ¯æ¬¡è§¦å‘å™¨å¯¹å½“å‰åˆ†åŒºè¿›è¡Œæ‰«ææ—¶éƒ½ä¼šå¯¹å‰ä¸€åˆ†é’Ÿçš„æ•°æ®åˆ†åŒºè¿›è¡Œé‡è¯•æ‰«æã€‚\n>\n> å› æ­¤ï¼Œå¦‚æœå‰ä¸€ä¸ªæ•°æ®åˆ†åŒºçš„ä»»åŠ¡æ‰§è¡Œå¤±è´¥ï¼Œé‚£ä¹ˆè¯¥åˆ†åŒºçš„åˆ†å¸ƒå¼é”æ— æ³•å¾—åˆ°å»¶æ—¶ï¼Œå¿…ç„¶ä¼šåœ¨å½“å‰åˆ†é’Ÿå†…å†æ¬¡è·å¾—è¿›è€Œè¿›è¡Œé‡è¯•æ“ä½œã€‚åä¹‹ï¼Œåˆ†å¸ƒå¼é”å¾—åˆ°äº†å»¶æ—¶ï¼Œé‚£ä¹ˆå½“å‰åˆ†é’Ÿå†…å°±ä¸ä¼šé‡å¤æ‰§è¡Œå·²æˆåŠŸæ‰§è¡Œçš„ä»»åŠ¡ã€‚\n>\n> ä¹Ÿæ­£æ˜¯å‡ºäºè¿™ä¸ªæœºåˆ¶è€ƒè™‘ï¼Œå»¶è¿Ÿçš„æ—¶é—´å¿…é¡»å¤§äºä¸¤ä¸ªåˆ†åŒºæ—¶é—´\n\né—®é¢˜åœ¨äºå¾ˆéš¾å®ç°ç™¾åˆ†ç™¾çš„åˆ†å¸ƒå¼äº‹åŠ¡ï¼Œå³æ— æ³•ä¿è¯**å®Œæˆåˆ†åŒºä»»åŠ¡ + å»¶è¿Ÿåˆ†å¸ƒå¼é”**æ“ä½œæ˜¯åŸå­çš„ï¼Œå› æ­¤è¿™é‡Œåªèƒ½æ˜¯**At least once**è¯­ä¹‰ã€‚\n\n#### æ‰§è¡Œå™¨æ¨¡å—\n\n**æ‰§è¡Œå®šæ—¶ä»»åŠ¡**\n\n- ä¸€ä¸ªæ‰§è¡Œå™¨ç”±è§¦å‘å™¨è°ƒåº¦ï¼Œå¯¹åº”ä¸€ä¸ªå…·ä½“çš„å®šæ—¶ä»»åŠ¡\n- æ‰§è¡Œå™¨é¦–å…ˆå¯¹å®šæ—¶ä»»åŠ¡è¿›è¡Œå¹‚ç­‰æ£€æŸ¥\n- æ‰§è¡Œä»»åŠ¡\n- æ›´æ–°å®šæ—¶ä»»åŠ¡çš„çŠ¶æ€\n\n### ä»»åŠ¡è¿ç§»æ¨¡å—åŒ–\n\nLyyTimeré¡¹ç›®ä½¿ç”¨MySQL + RedisäºŒçº§å­˜å‚¨æ¨¡å‹ï¼Œå¹¶è®¾ç½®äº†ä¸€ä¸ªMigratoræ ¹æ®æ—¶é—´ç”±è¿‘åŠè¿œ**é€šè¿‡å¤„äºæ¿€æ´»çŠ¶æ€çš„å®šæ—¶å™¨ï¼ˆcronè¡¨è¾¾å¼ï¼‰ç”Ÿæˆä¸€ç³»åˆ—å®šæ—¶ä»»åŠ¡**ï¼Œå¹¶è¿ç§»åŒæ­¥è‡³ä¸¤ä¸ªå­˜å‚¨ä»‹è´¨ä¸­\n\n#### Migratoræ¨¡å—\n\n- æ¯éš”ä¸€æ®µæ—¶é—´æ­¥é•¿å°±æ‰«ææ‰€æœ‰çš„å®šæ—¶å™¨ï¼Œæ ¹æ®å¤„äºæ¿€æ´»çŠ¶æ€çš„å®šæ—¶å™¨ç”Ÿæˆæœªæ¥ä¸¤ä¸ªæ—¶é—´æ­¥é•¿çš„å®šæ—¶ä»»åŠ¡ï¼ˆæœ¬è´¨ä¸Šå°±ä¸€ä¸ªæ—¶é—´æ­¥é•¿ï¼Œéƒ½æ˜¯ä¸ºäº†å¤±è´¥å…œåº•ğŸ˜‚ï¼‰\n  - ä¾‹å¦‚ï¼Œæ¯éš”ä¸€å°æ—¶å°±è¿›è¡Œä¸€æ¬¡å…¨è¡¨æ‰«æï¼Œè‹¥14:45:34å¯¹æ‰€æœ‰çš„å®šæ—¶å™¨è¿›è¡Œä¸€æ¬¡æ‰«æï¼Œè¿ç§»æ¨¡å—å°±ä¼šç”Ÿæˆ14:45:34 - 16:45:34è¿™ä¸¤ä¸ªå°æ—¶çš„å®šæ—¶ä»»åŠ¡å¹¶è¿ç§»è‡³MySQLå’ŒRedisä¸­ã€‚ä½†14:45:34 - 15:45:34è¿™ä¸ªæ—¶é—´æ®µçš„ä»»åŠ¡å·²ç»åœ¨13:45:34è¢«Migratoræ¨¡å—ç”Ÿæˆå¹¶å­˜å‚¨äº†ï¼Œæ‰€ä»¥æœ¬è´¨ä¸Šè¿ç§»æ¨¡å—åªç”Ÿæˆäº†ä¸€å°æ—¶çš„ä»»åŠ¡ã€‚é‡å¤çš„ä»»åŠ¡å°†ä¼šç”±äºå”¯ä¸€çº¦æŸè€Œæ’å…¥å¤±è´¥ï¼Œæ‰€ä»¥ä¸å¿…æ‹…å¿ƒä»»åŠ¡é‡å¤æ’å…¥\n\n##### ä¸²è¡Œæ‰“ç‚¹è¿˜æ˜¯æ‰¹é‡æ‰“ç‚¹ï¼Ÿ\n\nä¸²è¡Œæ‰“ç‚¹å°±æ˜¯æŒ‡æ¯æ¬¡æ ¹æ®cronè¡¨è¾¾å¼**åªç”Ÿæˆæœ€è¿‘çš„ä¸€æ¬¡**å®šæ—¶ä»»åŠ¡ï¼Œç„¶ååœ¨æ‰§è¡Œå™¨æ‰§è¡Œå®Œè¿™ä¸ªä»»åŠ¡åå°±ç«‹é©¬ç”Ÿæˆä¸‹ä¸€æ¬¡çš„å®šæ—¶ä»»åŠ¡ï¼Œå¦‚æ­¤å¾ªç¯ã€‚\n\nä¸²è¡Œæ‰“ç‚¹æ¯”è¾ƒèŠ‚çº¦èµ„æºï¼Œå¯ä»¥ç¼“è§£ç”Ÿæˆä»»åŠ¡è¿‡å¤šå¯¼è‡´çš„çŸ­æ—¶é—´å†…èµ„æºæµªè´¹é—®é¢˜ï¼Œä½†æ˜¯é’ˆå¯¹äºçŸ­é—´éš”é«˜é¢‘æ‰§è¡Œçš„å®šæ—¶å™¨ï¼ˆä¾‹å¦‚ï¼š1sæ‰§è¡Œä¸€æ¬¡ï¼‰å°±æœ‰äº›åŠ›ä¸ä»å¿ƒäº†ã€‚\n\n**ä¼˜åŒ–æ–¹æ¡ˆï¼šæ‰¹é‡æ‰“ç‚¹**\n\næ¯éš”ä¸€æ®µæ—¶é—´ç¨‹åºå°±æ ¹æ®cronè¡¨è¾¾å¼ç”Ÿæˆä¸€ä¸ªæ—¶é—´æ­¥é•¿çš„ä»»åŠ¡ï¼Œè¿™æ ·å¯ä»¥æœ‰æ•ˆè§£å†³çŸ­é—´éš”é«˜é¢‘ç‡çš„ä»»åŠ¡ç”Ÿæˆé—®é¢˜ã€‚ä½†å¦‚æœç”¨æˆ·å¯¹å®šæ—¶å™¨è¿›è¡Œé¢‘ç¹çš„ä¿®æ”¹ï¼Œé‚£ä¸ºäº†ä¿è¯æ•°æ®ä¸€è‡´æ€§ï¼Œå°±éœ€è¦å¼•å…¥åˆ é™¤ã€ä¿®æ”¹å·²ç”Ÿæˆä»»åŠ¡ç­‰å¤æ‚æ“ä½œã€‚ä¸ºäº†è§„é¿è¿™ç§æƒ…å†µï¼Œæˆ‘ä»¬å¯ä»¥è¦æ±‚ç”¨æˆ·æ— æ³•å¯¹å·²æœ‰çš„å®šæ—¶å™¨è¿›è¡Œä¿®æ”¹ï¼Œåªå…è®¸**æ¿€æ´»**å’Œ**å»æ¿€æ´»**ä¸¤ç§æ“ä½œ\n\næ­¤å¤–ï¼Œå³ä½¿ç”¨æˆ·**å»æ¿€æ´»**æŸä¸€ä¸ªå®šæ—¶å™¨ï¼Œæˆ‘ä»¬ä¹Ÿæ— éœ€ä¿®æ”¹å·²æœ‰çš„ä»»åŠ¡ï¼Œåªéœ€è¦åœ¨å›è°ƒä¹‹å‰æ£€æŸ¥å®šæ—¶å™¨çŠ¶æ€æ˜¯å¦åˆæ³•å³å¯ã€‚\n\n## å­˜å‚¨ç»“æ„è®¾è®¡\n\n**å®šæ—¶å™¨è¡¨**\n\n| å­—æ®µ              | ç±»å‹          | è¯´æ˜                            |\n| ----------------- | ------------- | ------------------------------- |\n| timer_id          | bigint        | è‡ªå¢ä¸»é”®IDï¼ˆæˆ–æœ‰åºUUIDï¼‰        |\n| ctime             | bigint        | åˆ›å»ºæ—¶é—´ï¼ˆé¿å…æ—¶åŒºé—®é¢˜ï¼‰        |\n| utime             | bigint        | ä¿®æ”¹æ—¶é—´                        |\n| app               | varchar(128)  | ä¸šåŠ¡æ–¹æ ‡è¯†                      |\n| name              | varchar(256)  | ä»»åŠ¡å                          |\n| status            | tinyint       | ä»»åŠ¡çŠ¶æ€ï¼š0æ–°å»ºã€1æ¿€æ´»ã€2æœªæ¿€æ´» |\n| cron              | varchar(256)  | cronè¡¨è¾¾å¼ï¼Œç”¨äºç”Ÿæˆå®šæ—¶ä»»åŠ¡    |\n| notify_http_param | varchar(8192) | å›è°ƒä¸Šä¸‹æ–‡                      |\n\n**å®šæ—¶ä»»åŠ¡è¡¨**\n\n| å­—æ®µ      | ç±»å‹         | è¯´æ˜                            |\n| --------- | ------------ | ------------------------------- |\n| task_id   | bigint       | è‡ªå¢ä¸»é”®ID                      |\n| ctime     | bigint       | åˆ›å»ºæ—¶é—´                        |\n| utime     | bigint       | ä¿®æ”¹æ—¶é—´                        |\n| timer_id  | bigint       | å¯¹åº”çš„å®šæ—¶å™¨ID                  |\n| app       | varchar(128) | ä¸šåŠ¡æ–¹æ ‡è¯†                      |\n| output    | var(1024)    | æ‰§è¡Œç»“æœ                        |\n| status    | tinyint      | ä»»åŠ¡çŠ¶æ€ï¼š0å¾…æ‰§è¡Œã€1æˆåŠŸã€2å¤±è´¥ |\n| run_timer | bigint       | å¼€å§‹è¿è¡Œæ—¶é—´                    |\n| cost_time | bigint       | è¯¯å·®æ—¶é—´                        |\n\n**å•ä¸ªåˆ†ç‰‡ç»“æ„**ï¼š\n\nKeyï¼šæ—¶é—´ + bucketç¼–å· = â€œ2024121115:54:51_01â€\n\nMemberï¼štimerId + unixå½“å‰æ—¶é—´æˆ³\n\nScoreï¼šunixå½“å‰æ—¶é—´æˆ³\n\n\n\nä¸€ä¸ªå¯èƒ½çš„ä¼˜åŒ–ç‚¹ï¼š\n\nåœ¨ä»»åŠ¡çŠ¶æ€ä¸Šå»ºç«‹ç´¢å¼•  ----->  å­˜åœ¨**æ•°æ®å€¾æ–œ**\n","source":"_posts/å®šæ—¶å¾®æœåŠ¡.md","raw":"---\ndescription: è®°å½•å®šæ—¶å¾®æœåŠ¡é¡¹ç›®\ntag: é¡¹ç›®\n---\n\n# å®šæ—¶å¾®æœåŠ¡\n\n## å‰ç½®å‡†å¤‡\n\n### èƒŒæ™¯å’Œç°çŠ¶\n\nå¸‚é¢ä¸Šå·²æœ‰çš„å®šæ—¶å¾®æœåŠ¡æŠ€æœ¯ï¼šJava Timerã€Rocket MQã€xxl-jobã€Quartzã€Robfig/Cron\n\n- å¾ˆå¤šå…¬å¸çš„ä¸šåŠ¡åªéœ€è¦ä¸€ä¸ªç®€å•çš„â€œå®šæ—¶â€åŠŸèƒ½ã€‚ä¸ºäº†æ»¡è¶³ä¸€ä¸ªç®€å•å®šæ—¶åŠŸèƒ½è€Œå¼•å…¥è¿‡äºå¼ºå¤§è€Œä¸”è‡ƒè‚¿çš„ä»»åŠ¡è°ƒåº¦ç»„ä»¶æ˜¯ä¸åˆé€‚çš„\n- è®¾è®¡ä¸€ä¸ª**åŠŸèƒ½èšç„¦ã€è½»é‡çº§ã€ç»´æŠ¤æˆæœ¬ä½**çš„å®šæ—¶å¾®æœåŠ¡ç»„ä»¶æ˜¯å¾ˆæœ‰å¿…è¦çš„\n\n**å®šæ—¶å¾®æœåŠ¡LyyTimer**\n\n1. ä¾èµ–ç®€å•ï¼šåªéœ€è¦æä¾›MySQLã€Rediså’ŒKafkaç»„ä»¶çš„æ”¯æŒå³å¯ï¼Œæ¥å…¥å’Œç»´æŠ¤çš„æˆæœ¬ä½\n2. å­¦ä¹ æˆæœ¬ä½ï¼šæ•´ä¸ªå®šæ—¶å¾®æœåŠ¡åŠŸèƒ½èšç„¦ï¼Œå®¹æ˜“ä¸Šæ‰‹\n3. ç‰¹æ€§ä¼˜ï¼šLyyTimerå…·æœ‰é«˜ç²¾å‡†ã€é«˜è´Ÿè½½ã€å¼‚å¸¸å¤„ç†ç­‰ç‰¹æ€§ï¼Œèƒ½åŸºæœ¬æ»¡è¶³å¤§éƒ¨åˆ†çš„å®šæ—¶éœ€æ±‚\n\n### éš¾ç‚¹\n\n#### **é«˜ç²¾å‡†**\n\nç›¸å¯¹äºå•ç‚¹å®šæ—¶ï¼ˆä¾‹å¦‚Java.Timerï¼‰åŸºæœ¬èƒ½åšåˆ°æ¯«ç§’çº§è§¦å‘ï¼Œå‡ ä¹æ‰€æœ‰å®šæ—¶ä»»åŠ¡æ¡†æ¶æˆ–è€…æ¶ˆæ¯é˜Ÿåˆ—ï¼Œéƒ½åªèƒ½ä¿è¯ç§’çº§åˆ«è¯¯å·®\n\nå¸¸è§å¯¼è‡´æ—¶é—´è¯¯å·®å¤§çš„åŸå› ï¼š\n\n- å®šæ—¶è„šæœ¬è¿è¡Œè€—æ—¶\n- ç­‰å¾…å®šæ—¶è„šæœ¬è¿è¡Œ\n- æ¶ˆæ¯é˜Ÿåˆ—ä¸­æ¶ˆæ¯å †ç§¯\n- åˆ†å¸ƒå¼å®šæ—¶å™¨å»¶æ—¶å—ç½‘ç»œå½±å“\n- æ•°æ®åº“ä¸­æŸ¥æ‰¾ä»»åŠ¡æ•°æ®è€—æ—¶\n- ç‰¹æ®Šæ—¶é—´æ®µä»»åŠ¡è¿‡å¤š\n\n#### **é«˜è´Ÿè½½**\n\nèƒ½å¤Ÿæ”¯æŒåŒæ—¶å¤„ç†å¤§é‡ä»»åŠ¡ï¼Œå¹¶ä¸”å°½å¯èƒ½å°‘çš„å †ç§¯ä»»åŠ¡\n\né«˜è´Ÿè½½è§£å†³æ€è·¯å’Œæ–¹æ³•ï¼š\n\n- åº”ç”¨å±‚æ–¹é¢å‡å°‘ä»»åŠ¡é‡ï¼Œé€‰æ‹©å°†åŒä¸€æ—¶åˆ»çš„å¤šä¸ªç‹¬ç«‹ä»»åŠ¡åˆå¹¶æˆä¸€ä¸ªâ€œè®¡åˆ’åˆ—è¡¨â€\n- åˆ†åº“åˆ†è¡¨ï¼šå°†ä¸€ä¸ªå¤§å‹æ•°æ®åº“åˆ†æˆå¤šä¸ªè¾ƒå°çš„æ•°æ®åº“ï¼Œå¹¶å°†æ¯ä¸ªæ•°æ®åº“è¿›ä¸€æ­¥åˆ†æˆå¤šä¸ªè¾ƒå°çš„è¡¨ï¼Œæ¯ä¸ªè¡¨åªåŒ…å«éƒ¨åˆ†æ•°æ®\n  - å‚ç›´åˆ†è¡¨ï¼šä¿æŒåˆ—å®Œæ•´\n  - æ°´å¹³åˆ†è¡¨ï¼šåªä¿ç•™éƒ¨åˆ†åˆ—\n  - åˆ†åº“åˆ†è¡¨ç»„åˆ\n- æ•°æ®åˆ†åŒºï¼šå°†å¤§æ•°æ®æ‹†åˆ†æˆå¤šä¸ªå°æ•°æ®åˆ†åŒºï¼Œå°†è¿™äº›å°åˆ†åŒºå­˜å‚¨åœ¨ä¸åŒçš„ç‰©ç†è®¾å¤‡æˆ–æœåŠ¡å™¨ä¸Šï¼Œæä¾›æ•°æ®çš„å­˜å–æ•ˆç‡å’Œå¤„ç†é€Ÿåº¦\n- çº¿ç¨‹æ± æŠ€æœ¯\n  - å¤ç”¨çº¿ç¨‹ï¼Œé™ä½äº†èµ„æºæ¶ˆè€—\n  - é«˜æ•ˆåœ°ç®¡ç†å¤šä¸ªçº¿ç¨‹\n\n#### **ä»»åŠ¡å¼‚å¸¸å¤„ç†**\n\n>  å®šæ—¶ä»»åŠ¡éœ€æ±‚å¯ä»¥å…è®¸æœ‰ä¸€å®šçš„è¯¯å·®ï¼Œä½†æ˜¯ä¸èƒ½ä¸è§¦å‘\n\n**ä»»åŠ¡å¼‚å¸¸çš„åŸå› ï¼š**\n\n- åˆ›å»ºï¼ˆæ¿€æ´»ï¼‰ä»»åŠ¡æ¥å£å¼‚å¸¸ï¼šåœ¨åˆ›å»ºä»»åŠ¡é˜¶æ®µå‘ç”Ÿå¼‚å¸¸ï¼Œç³»ç»Ÿå¯ä»¥ç›´æ¥å°†å¼‚å¸¸åŸå› è¿”å›ç»™ç”¨æˆ·ã€‚ç”¨æˆ·æ„ŸçŸ¥åˆ°å¼‚å¸¸åï¼Œå¯é€šè¿‡ä¸»åŠ¨é‡è¯•è§£å†³é—®é¢˜ï¼Œå³è¯¥é˜¶æ®µçš„å¼‚å¸¸ä¸åº”è¯¥ç”±æ¡†æ¶è§£å†³\n\n- ä»»åŠ¡æµè½¬å¼‚å¸¸ï¼šä¸€æ—¦ä»»åŠ¡æˆåŠŸå­˜å‚¨åœ¨æ•°æ®åº“ä¸­ï¼Œå°±è®¤ä¸ºè¯¥å®šæ—¶ä»»åŠ¡åˆ›å»ºæˆåŠŸï¼Œå¾®æœåŠ¡æ¡†æ¶å°±è¦è´Ÿè´£è¯¥ä»»åŠ¡åç»­çš„æµè½¬ï¼ˆæŸ¥è¯¢æ•°æ®åº“ã€å‘é€æ¶ˆæ¯é˜Ÿåˆ—ã€ç¼“å­˜ç­‰ï¼‰ã€‚å› æ­¤ï¼Œæ¡†æ¶éœ€è¦è§£å†³ä»»åŠ¡æµè½¬è¿‡ç¨‹ä¸­å‘ç”Ÿçš„å¼‚å¸¸\n- ä»»åŠ¡è§¦å‘é˜¶æ®µå¼‚å¸¸ï¼šå½“ä»»åŠ¡æ‰§è¡Œåï¼Œç³»ç»Ÿéœ€è¦å›è°ƒå‘ŠçŸ¥ä¸šåŠ¡æ–¹ä»»åŠ¡ç»“æœã€‚å¯¹äºä¸šåŠ¡æ–¹æ¥è¯´ï¼Œå¦‚æœå›è°ƒå¤±è´¥å¯¼è‡´ç»“æœä¸¢å¤±ï¼Œå°±ç›¸å½“äºè¯¥ä»»åŠ¡æ²¡æœ‰æ‰§è¡Œè¿‡\n\n\n\n**å¸¸ç”¨çš„è§£å†³æ–¹æ¡ˆ**\n\n- **ï¼ˆç«‹å³ï¼‰é‡è¯•æœºåˆ¶**ï¼šå¯ä»¥åº”ä»˜ä¸€äº›å¶å‘æ€§å¼‚å¸¸ï¼Œä¾‹å¦‚æ•°æ®åº“æŠ–åŠ¨ã€RedisæŠ–åŠ¨\n- **å¤±è´¥å…œåº•æœºåˆ¶**ï¼šä¸€èˆ¬æ¥è¯´ï¼Œå…œåº•ç­–ç•¥éƒ½æ˜¯é‡‡ç”¨ä¸€äº›â€œæ— è„‘â€è„šæœ¬ï¼Œå…¨è¡¨æ‰«ææ•°æ®åº“ï¼Œé’ˆå¯¹å¤±è´¥è®°å½•è¿›è¡Œé‡è¯•æ“ä½œã€‚ä½†æ˜¯å…œåº•ç­–ç•¥ä¸€èˆ¬åœ¨æ€§èƒ½ä¸Šä¸å ä¼˜åŠ¿ï¼Œæ‰€ä»¥éœ€è¦é€‰æ‹©åˆé€‚çš„æ—¶é—´é—´éš”æ‰§è¡Œå…œåº•è„šæœ¬\n- **å¤±è´¥æŠ¥è­¦æœºåˆ¶**ï¼šå½“çŸ­æ—¶é—´å†…æœ‰å¤§é‡ä»»åŠ¡å¤±è´¥æ—¶ï¼Œéœ€è¦åŠæ—¶æŠ¥è­¦\n- **äººå·¥å¹²é¢„**\n\n## æ¶æ„è®¾è®¡\n\n### å®ç°æ€è·¯\n\n**å®šæ—¶å™¨æœ¬è´¨å®ç°æ€è·¯ï¼šæŸ¥è¯¢ + è§¦å‘**ï¼Œä»¥åŠæš´éœ²ç»™ç”¨æˆ·ä¸€ä¸ª**æ³¨å†Œä»»åŠ¡**æ¥å£\n\n- **æ³¨å†Œ**å®šæ—¶å™¨ï¼šæ¥å—ç”¨æˆ·çš„åˆ›å»ºè¯·æ±‚ï¼Œæ˜ç¡®æ¯ä¸€ä¸ªä»»åŠ¡çš„**æ‰§è¡Œæ—¶é—´**\n- **æŸ¥è¯¢**æ•°æ®åº“ï¼šæ¯éš”ä¸€æ®µæ—¶é—´é—´éš”å°±**æŸ¥è¯¢**ä»»åŠ¡åˆ—è¡¨ï¼Œç­›é€‰å‡ºæœªè§¦å‘çš„ä»»åŠ¡\n- **è§¦å‘**ä»»åŠ¡ï¼šè§¦å‘**æ‰§è¡Œæ—¶é—´å°äºå½“å‰æ—¶é—´ï¼ˆæ—¶åˆ»ï¼‰**çš„ä»»åŠ¡\n\n#### å­˜å‚¨ç»“æ„ä¼˜åŒ–ï¼šæœ‰åºè¡¨\n\n**åŸºäºæœ‰åºæ•°æ®ç»“æ„ï¼ŒåŠ å¿«æ•°æ®æŸ¥è¯¢**\n\nå¸¸è§çš„æœ‰åºæ•°æ®ç»“æ„ï¼šçº¢é»‘æ ‘ã€è·³è¡¨ã€å¹³è¡¡æ ‘ç­‰ï¼Œè¿™äº›æ•°æ®ç»“æ„é€šè¿‡åœ¨æ’å…¥æ“ä½œå‡æ‘ŠæŸ¥è¯¢æ“ä½œçš„æ—¶é—´å¤æ‚åº¦å®ç°**æŸ¥è¯¢æ—¶é—´å¤æ‚åº¦$$O(N) ---> O(logN)$$**çš„ä¼˜åŒ–\n\n#### å­˜å‚¨ç»“æ„ä¼˜åŒ–ï¼šæ¨ªå‘åˆ‡ç‰‡\n\n**æ ¹æ®æ—¶é—´åŒºé—´å¯¹æ•°æ®åˆ†ç‰‡ï¼Œå‡å°‘æŸ¥è¯¢æ—¶æ¶‰åŠçš„æ•°æ®æ•°é‡**\n\næ¯æ¬¡æŸ¥è¯¢æ•°æ®çš„æ—¶å€™ï¼ŒçœŸæ­£çš„ç›®æ ‡æ˜¯**å³å°†æ‰§è¡Œ**çš„ä»»åŠ¡ï¼Œè€Œ**ç¨åæ‰§è¡Œ**çš„ä»»åŠ¡å±äºæ— å…³ä»»åŠ¡ã€‚åŸºäºè¿™ä¸ªç†å¿µï¼Œæˆ‘ä»¬å¯ä»¥å°†æ•°æ®è¿›è¡Œæ¨ªå‘åˆ‡åˆ†ï¼Œä¾‹å¦‚æ¯ä¸€åˆ†é’Ÿåˆ’åˆ†ä¸€ä¸ªæ•°æ®åˆ‡ç‰‡ï¼Œç„¶åä»åŒ…å«ç›®æ ‡æ•°æ®çš„æ•°æ®åˆ‡ç‰‡ä¸­æŸ¥è¯¢æ•°æ®\n\nè¿™ç§åšæ³•å¯ä»¥å°†å¤§å¤§é™ä½æ¯ä¸€æ¬¡æŸ¥è¯¢çš„ä»»åŠ¡æ•°é‡çº§ï¼šN ---> N'ï¼Œå…¶ä¸­N' << Nï¼Œå³ä½¿æ²¡æœ‰æ”¹å˜æŸ¥è¯¢çš„æ—¶é—´å¤æ‚åº¦ï¼Œä½†å‡å°‘äº†æŸ¥è¯¢æ—¶æ¶‰åŠçš„æ•°æ®æ•°é‡\n\n#### å­˜å‚¨ç»“æ„ä¼˜åŒ–ï¼šçºµå‘åˆ‡ç‰‡\n\n**å¯¹æ•°æ®åˆ†åŒºè¿›è¡Œåˆ†æ¡¶ï¼Œæé«˜æ•°æ®æ“ä½œçš„å¹¶å‘åº¦**\n\næˆªæ­¢åˆ°ä¸Šä¸€æ­¥ï¼Œæ—¶é—´æ•°æ®åˆ†åŒºæ˜¯å®šæ—¶å™¨ä¸­çš„æœ€å°èµ„æºå•ä½ï¼Œæ¯ä¸€ä¸ªæ•°æ®åˆ†åŒºéƒ½ç”±ä¸€ä¸ªgoroutineï¼ˆæˆ–çº¿ç¨‹ï¼‰æ§åˆ¶ã€‚ä¸ºäº†æé«˜æ•°æ®æ“ä½œçš„å¹¶å‘åº¦ï¼Œå¯ä»¥å¯¹åˆ†åŒºä¸­çš„æ•°æ®è¿›ä¸€æ­¥**åˆ†æ¡¶**ï¼ŒæŠŠæ¯ä¸€ä¸ªæ¡¶äº¤ä»˜ç»™ä¸€ä¸ªgoroutineï¼ˆæˆ–çº¿ç¨‹ï¼‰å¤„ç†ï¼Œåœ¨çºµå‘å¢åŠ åˆ†æ¡¶çš„ç»´åº¦ï¼Œæé«˜å¹¶å‘åº¦\n\n> æ€»ç»“ï¼šä¾ç„¶æ˜¯â€œæŸ¥è¯¢ + è§¦å‘â€çš„å®šæ—¶å™¨æœºåˆ¶ï¼Œåªä¸è¿‡ç›¸è¾ƒäºä¸ç‰ˆå®šæ—¶å™¨æœ‰å¦‚ä¸‹å˜åŒ–ï¼šæ¯æ¬¡æŸ¥è¯¢éƒ½åªæŸ¥è¯¢ä¸€ä¸ªï¼ˆå½“å‰ï¼‰æ—¶é—´èŒƒå›´å†…çš„æ•°æ®ï¼Œè¿™äº›æ•°æ®ç”±ZSetæ•°æ®ç»“æ„å­˜å‚¨ã€‚æ¥ç€åŸºäºå¹¶å‘çš„è€ƒè™‘ï¼Œä»¤å¤šä¸ªgoroutineè´Ÿè´£ä»åˆ†åŒºä¸­çš„å¤šä¸ªæ¡¶ä¸­æŸ¥è¯¢æ•°æ®ï¼Œæœ€åå°†è§¦å‘è·å–åˆ°çš„ä»»åŠ¡ã€‚\n\n### æ•´ä½“æ¶æ„\n\n#### å®šæ—¶ä»»åŠ¡è°ƒåº¦æµç¨‹\n\nä»»åŠ¡è°ƒåº¦æµç¨‹**æœåŠ¡æ¶æ„ï¼šä¸‰ä¸ªæ¨¡å— + ä¸¤ä¸ªåç¨‹æ± **\n\nLyyTimeræ˜¯ä¸€ä¸ª**å»ä¸­å¿ƒåŒ–çš„å®šæ—¶ä»»åŠ¡è°ƒåº¦æ¡†æ¶**ï¼Œå®šæ—¶ä»»åŠ¡è°ƒåº¦æœåŠ¡æ ¹æ®èŒè´£è¾¹ç•Œå¯ä»¥å°†æœåŠ¡æ‹†åˆ†ä¸ºï¼š**è°ƒåº¦å™¨æ¨¡å—**ã€**è§¦å‘å™¨æ¨¡å—**ã€**æ‰§è¡Œæ¨¡å—**ï¼Œè¿™ä¸‰ä¸ªæ¨¡å—å­˜åœ¨ç€ä¾èµ–å…³ç³»ã€‚çˆ¶æ¨¡å—é€šè¿‡åç¨‹æ± å¼‚æ­¥å¯åŠ¨å­æ¨¡å—æ‰§è¡Œç›¸åº”å·¥ä½œ\n\n![image-20241125183915443](https://raw.githubusercontent.com/lyydsheep/pic/main/202411251841204.png)\n\n#### å®šæ—¶ä»»åŠ¡ç”Ÿæˆæµç¨‹\n\n**å®šæ—¶ä»»åŠ¡çš„åˆ›å»ºè®¾è®¡åˆ°Web Serverå’ŒMigrator Schedulerä¸¤ä¸ªæ¨¡å—**\n\n- ç”¨æˆ·é€šè¿‡Web Serveræä¾›çš„APIåˆ›å»ºå®šæ—¶ä»»åŠ¡\n- Migrator Schedulerå®šæ—¶æ ¹æ®cronè¡¨è¾¾å¼é¢„çƒ­å®šæ—¶ä»»åŠ¡æ•°æ®\n\n![image-20241125185145008](https://raw.githubusercontent.com/lyydsheep/pic/main/202411251851062.png)\n\n> ä¸ºä»€ä¹ˆéœ€è¦ä¸¤ç§æ–¹å¼é¢„çƒ­æ•°æ®ï¼Ÿ\n>\n> ä¸ºäº†ç¡®ä¿åœ¨å®šæ—¶è„šæœ¬æ‰§è¡Œé—´éš”å†…åˆ›å»ºçš„ä»»åŠ¡ç”Ÿæ•ˆã€‚ä¾‹å¦‚ï¼Œå®šæ—¶è„šæœ¬æ¯ä¸¤å°æ—¶æ‰§è¡Œä¸€æ¬¡ï¼Œæ¯ä¸€æ¬¡æ‰§è¡Œéƒ½ä¼šé¢„çƒ­ä¸¤å°æ—¶åçš„æ•°æ®ã€‚ç¬¬ä¸€æ¬¡å®šæ—¶è„šæœ¬æ‰§è¡Œæ—¶åˆ»æ˜¯18:58ï¼Œåˆ›å»ºäº†18:58-20:58å®šæ—¶ä»»åŠ¡ã€‚å€˜è‹¥æœ‰ç”¨æˆ·åœ¨19:00æƒ³è¦åˆ›å»ºä¸€ä¸ª19:58åˆ†çš„å®šæ—¶ä»»åŠ¡ï¼Œé‚£ä¹ˆåªä¾é å®šæ—¶è„šæœ¬æ˜¯æ— æ³•å®ç°çš„ï¼Œå› ä¸ºä¸‹ä¸€æ¬¡å®šæ—¶è„šæœ¬çš„æ‰§è¡Œæ—¶é—´æ˜¯20:58ã€‚ç»¼ä¸Šæ‰€è¯‰ï¼Œä»…ä»…æœ‰å®šæ—¶è„šæœ¬æ˜¯æœ‰ç¼ºé™·çš„ï¼Œè¿˜éœ€è¦ä¸€ä¸ªWeb Serveræ¨¡å—å®Œæˆä»»åŠ¡çš„ç¬¬ä¸€æ¬¡åˆ›å»ºï¼Œç¡®ä¿ç”¨æˆ·åœ¨ä»»ä½•æ—¶å€™åˆ›å»ºçš„ä»»åŠ¡éƒ½èƒ½ç”Ÿæ•ˆã€‚\n\n### è°ƒåº¦æµç¨‹æ¨¡å—åŒ–\n\n#### è°ƒåº¦å™¨æ¨¡å—\n\n**ç¡®å®šäºŒç»´æ•°æ®åˆ†åŒºç›®æ ‡å¯¹è±¡ï¼Œç»Ÿç­¹åˆ†é…è§¦å‘å™¨**\n\nè°ƒåº¦å™¨çš„ä½œç”¨å°±æ˜¯è¦ç¡®ä¿åœ¨åˆ†å¸ƒå¼åœºæ™¯ä¸‹ï¼Œæ¯ä¸€ä¸ªäºŒç»´æ•°æ®åˆ†åŒºéƒ½èƒ½è¢«ä¸€ä¸ªè§¦å‘å™¨è´Ÿè´£å¤„ç†ï¼Œæ—¢ä¸èƒ½é—æ¼ï¼Œä¹Ÿä¸èƒ½é‡å¤\n\n- è°ƒåº¦å™¨åŸºäºtime tickeræ¯ç§’é’Ÿè¿›è¡Œä¸€æ¬¡å·¥ä½œï¼Œæ ¹æ®å½“å‰æ—¶åˆ»æ¨ç®—å‡º**åˆ†é’Ÿçº§åˆ«**çš„å­—ç¬¦ä¸²è¡¨è¾¾å¼\n- æ ¹æ®é…ç½®ä¸­æœ€å¤§æ¡¶æ•°é‡ï¼Œä¾æ¬¡æ‹¼æ¥åˆ†é’ŸKeyå€¼å¾—åˆ°è‹¥å¹²ä¸ªäºŒç»´æ•°æ®åˆ†åŒºçš„Keyå€¼ã€‚ä¾‹å¦‚`20:47:39_0`ã€`20:48:11_1`\n- å°è¯•æŠ¢å æ•°æ®åˆ†åŒºçš„åˆ†å¸ƒå¼é”ï¼Œå¹¶æŠŠé”çš„è¿‡æœŸæ—¶é—´è®¾ç½®ä¸º**å¤§äº1å€åˆ†ç‰‡æ—¶é—´ï¼Œå°äº2å€åˆ†ç‰‡æ—¶é—´**\n- å¦‚æœæŠ¢é”æˆåŠŸï¼Œå°±è°ƒåº¦ä¸€ä¸ªè§¦å‘å™¨è¿›è¡Œä½œä¸š\n\n#### è§¦å‘å™¨æ¨¡å—\n\n**æŒ‰æ—¶å”¤é†’äºŒç»´æ•°æ®åˆ†åŒºä¸­çš„å®šæ—¶ä»»åŠ¡**\n\n- è§¦å‘å™¨è¢«åˆ›å»ºåï¼Œæ¯ç§’å¯¹è´Ÿè´£çš„æ•°æ®åˆ†åŒºè¿›è¡Œæ‰«æï¼Œä»¥å½“å‰æ—¶åˆ»ä¸ºåŸºå‡†ï¼Œå°†ç¬¦åˆæ¡ä»¶çš„å®šæ—¶ä»»åŠ¡å–å‡ºå¹¶äº¤ä»˜ç»™æ‰§è¡Œå™¨æ‰§è¡Œ\n- å½“è§¦å‘å™¨åç¨‹å®Œæˆä»»åŠ¡åï¼Œéœ€è¦å°†åˆ†å¸ƒå¼é”çš„è¿‡æœŸæ—¶é—´å»¶æœŸè‡³**å¤§äºä¸¤ä¸ªåˆ†åŒºæ—¶é—´**\n\n> ä¸ºä»€ä¹ˆè¦å¯¹åˆ†å¸ƒå¼é”è¿›è¡Œå»¶æœŸï¼Ÿ\n>\n> å›ç­”è¿™ä¸ªé—®é¢˜ä¹‹å‰ï¼Œéœ€è¦è¡¥å……çš„ä¸€ç‚¹ï¼šä¸ºäº†å¯¹å‰ä¸€åˆ†é’Ÿçš„æ•°æ®åˆ†åŒºæ‰§è¡Œå¤±è´¥åšå…œåº•ï¼Œæ¯æ¬¡è§¦å‘å™¨å¯¹å½“å‰åˆ†åŒºè¿›è¡Œæ‰«ææ—¶éƒ½ä¼šå¯¹å‰ä¸€åˆ†é’Ÿçš„æ•°æ®åˆ†åŒºè¿›è¡Œé‡è¯•æ‰«æã€‚\n>\n> å› æ­¤ï¼Œå¦‚æœå‰ä¸€ä¸ªæ•°æ®åˆ†åŒºçš„ä»»åŠ¡æ‰§è¡Œå¤±è´¥ï¼Œé‚£ä¹ˆè¯¥åˆ†åŒºçš„åˆ†å¸ƒå¼é”æ— æ³•å¾—åˆ°å»¶æ—¶ï¼Œå¿…ç„¶ä¼šåœ¨å½“å‰åˆ†é’Ÿå†…å†æ¬¡è·å¾—è¿›è€Œè¿›è¡Œé‡è¯•æ“ä½œã€‚åä¹‹ï¼Œåˆ†å¸ƒå¼é”å¾—åˆ°äº†å»¶æ—¶ï¼Œé‚£ä¹ˆå½“å‰åˆ†é’Ÿå†…å°±ä¸ä¼šé‡å¤æ‰§è¡Œå·²æˆåŠŸæ‰§è¡Œçš„ä»»åŠ¡ã€‚\n>\n> ä¹Ÿæ­£æ˜¯å‡ºäºè¿™ä¸ªæœºåˆ¶è€ƒè™‘ï¼Œå»¶è¿Ÿçš„æ—¶é—´å¿…é¡»å¤§äºä¸¤ä¸ªåˆ†åŒºæ—¶é—´\n\né—®é¢˜åœ¨äºå¾ˆéš¾å®ç°ç™¾åˆ†ç™¾çš„åˆ†å¸ƒå¼äº‹åŠ¡ï¼Œå³æ— æ³•ä¿è¯**å®Œæˆåˆ†åŒºä»»åŠ¡ + å»¶è¿Ÿåˆ†å¸ƒå¼é”**æ“ä½œæ˜¯åŸå­çš„ï¼Œå› æ­¤è¿™é‡Œåªèƒ½æ˜¯**At least once**è¯­ä¹‰ã€‚\n\n#### æ‰§è¡Œå™¨æ¨¡å—\n\n**æ‰§è¡Œå®šæ—¶ä»»åŠ¡**\n\n- ä¸€ä¸ªæ‰§è¡Œå™¨ç”±è§¦å‘å™¨è°ƒåº¦ï¼Œå¯¹åº”ä¸€ä¸ªå…·ä½“çš„å®šæ—¶ä»»åŠ¡\n- æ‰§è¡Œå™¨é¦–å…ˆå¯¹å®šæ—¶ä»»åŠ¡è¿›è¡Œå¹‚ç­‰æ£€æŸ¥\n- æ‰§è¡Œä»»åŠ¡\n- æ›´æ–°å®šæ—¶ä»»åŠ¡çš„çŠ¶æ€\n\n### ä»»åŠ¡è¿ç§»æ¨¡å—åŒ–\n\nLyyTimeré¡¹ç›®ä½¿ç”¨MySQL + RedisäºŒçº§å­˜å‚¨æ¨¡å‹ï¼Œå¹¶è®¾ç½®äº†ä¸€ä¸ªMigratoræ ¹æ®æ—¶é—´ç”±è¿‘åŠè¿œ**é€šè¿‡å¤„äºæ¿€æ´»çŠ¶æ€çš„å®šæ—¶å™¨ï¼ˆcronè¡¨è¾¾å¼ï¼‰ç”Ÿæˆä¸€ç³»åˆ—å®šæ—¶ä»»åŠ¡**ï¼Œå¹¶è¿ç§»åŒæ­¥è‡³ä¸¤ä¸ªå­˜å‚¨ä»‹è´¨ä¸­\n\n#### Migratoræ¨¡å—\n\n- æ¯éš”ä¸€æ®µæ—¶é—´æ­¥é•¿å°±æ‰«ææ‰€æœ‰çš„å®šæ—¶å™¨ï¼Œæ ¹æ®å¤„äºæ¿€æ´»çŠ¶æ€çš„å®šæ—¶å™¨ç”Ÿæˆæœªæ¥ä¸¤ä¸ªæ—¶é—´æ­¥é•¿çš„å®šæ—¶ä»»åŠ¡ï¼ˆæœ¬è´¨ä¸Šå°±ä¸€ä¸ªæ—¶é—´æ­¥é•¿ï¼Œéƒ½æ˜¯ä¸ºäº†å¤±è´¥å…œåº•ğŸ˜‚ï¼‰\n  - ä¾‹å¦‚ï¼Œæ¯éš”ä¸€å°æ—¶å°±è¿›è¡Œä¸€æ¬¡å…¨è¡¨æ‰«æï¼Œè‹¥14:45:34å¯¹æ‰€æœ‰çš„å®šæ—¶å™¨è¿›è¡Œä¸€æ¬¡æ‰«æï¼Œè¿ç§»æ¨¡å—å°±ä¼šç”Ÿæˆ14:45:34 - 16:45:34è¿™ä¸¤ä¸ªå°æ—¶çš„å®šæ—¶ä»»åŠ¡å¹¶è¿ç§»è‡³MySQLå’ŒRedisä¸­ã€‚ä½†14:45:34 - 15:45:34è¿™ä¸ªæ—¶é—´æ®µçš„ä»»åŠ¡å·²ç»åœ¨13:45:34è¢«Migratoræ¨¡å—ç”Ÿæˆå¹¶å­˜å‚¨äº†ï¼Œæ‰€ä»¥æœ¬è´¨ä¸Šè¿ç§»æ¨¡å—åªç”Ÿæˆäº†ä¸€å°æ—¶çš„ä»»åŠ¡ã€‚é‡å¤çš„ä»»åŠ¡å°†ä¼šç”±äºå”¯ä¸€çº¦æŸè€Œæ’å…¥å¤±è´¥ï¼Œæ‰€ä»¥ä¸å¿…æ‹…å¿ƒä»»åŠ¡é‡å¤æ’å…¥\n\n##### ä¸²è¡Œæ‰“ç‚¹è¿˜æ˜¯æ‰¹é‡æ‰“ç‚¹ï¼Ÿ\n\nä¸²è¡Œæ‰“ç‚¹å°±æ˜¯æŒ‡æ¯æ¬¡æ ¹æ®cronè¡¨è¾¾å¼**åªç”Ÿæˆæœ€è¿‘çš„ä¸€æ¬¡**å®šæ—¶ä»»åŠ¡ï¼Œç„¶ååœ¨æ‰§è¡Œå™¨æ‰§è¡Œå®Œè¿™ä¸ªä»»åŠ¡åå°±ç«‹é©¬ç”Ÿæˆä¸‹ä¸€æ¬¡çš„å®šæ—¶ä»»åŠ¡ï¼Œå¦‚æ­¤å¾ªç¯ã€‚\n\nä¸²è¡Œæ‰“ç‚¹æ¯”è¾ƒèŠ‚çº¦èµ„æºï¼Œå¯ä»¥ç¼“è§£ç”Ÿæˆä»»åŠ¡è¿‡å¤šå¯¼è‡´çš„çŸ­æ—¶é—´å†…èµ„æºæµªè´¹é—®é¢˜ï¼Œä½†æ˜¯é’ˆå¯¹äºçŸ­é—´éš”é«˜é¢‘æ‰§è¡Œçš„å®šæ—¶å™¨ï¼ˆä¾‹å¦‚ï¼š1sæ‰§è¡Œä¸€æ¬¡ï¼‰å°±æœ‰äº›åŠ›ä¸ä»å¿ƒäº†ã€‚\n\n**ä¼˜åŒ–æ–¹æ¡ˆï¼šæ‰¹é‡æ‰“ç‚¹**\n\næ¯éš”ä¸€æ®µæ—¶é—´ç¨‹åºå°±æ ¹æ®cronè¡¨è¾¾å¼ç”Ÿæˆä¸€ä¸ªæ—¶é—´æ­¥é•¿çš„ä»»åŠ¡ï¼Œè¿™æ ·å¯ä»¥æœ‰æ•ˆè§£å†³çŸ­é—´éš”é«˜é¢‘ç‡çš„ä»»åŠ¡ç”Ÿæˆé—®é¢˜ã€‚ä½†å¦‚æœç”¨æˆ·å¯¹å®šæ—¶å™¨è¿›è¡Œé¢‘ç¹çš„ä¿®æ”¹ï¼Œé‚£ä¸ºäº†ä¿è¯æ•°æ®ä¸€è‡´æ€§ï¼Œå°±éœ€è¦å¼•å…¥åˆ é™¤ã€ä¿®æ”¹å·²ç”Ÿæˆä»»åŠ¡ç­‰å¤æ‚æ“ä½œã€‚ä¸ºäº†è§„é¿è¿™ç§æƒ…å†µï¼Œæˆ‘ä»¬å¯ä»¥è¦æ±‚ç”¨æˆ·æ— æ³•å¯¹å·²æœ‰çš„å®šæ—¶å™¨è¿›è¡Œä¿®æ”¹ï¼Œåªå…è®¸**æ¿€æ´»**å’Œ**å»æ¿€æ´»**ä¸¤ç§æ“ä½œ\n\næ­¤å¤–ï¼Œå³ä½¿ç”¨æˆ·**å»æ¿€æ´»**æŸä¸€ä¸ªå®šæ—¶å™¨ï¼Œæˆ‘ä»¬ä¹Ÿæ— éœ€ä¿®æ”¹å·²æœ‰çš„ä»»åŠ¡ï¼Œåªéœ€è¦åœ¨å›è°ƒä¹‹å‰æ£€æŸ¥å®šæ—¶å™¨çŠ¶æ€æ˜¯å¦åˆæ³•å³å¯ã€‚\n\n## å­˜å‚¨ç»“æ„è®¾è®¡\n\n**å®šæ—¶å™¨è¡¨**\n\n| å­—æ®µ              | ç±»å‹          | è¯´æ˜                            |\n| ----------------- | ------------- | ------------------------------- |\n| timer_id          | bigint        | è‡ªå¢ä¸»é”®IDï¼ˆæˆ–æœ‰åºUUIDï¼‰        |\n| ctime             | bigint        | åˆ›å»ºæ—¶é—´ï¼ˆé¿å…æ—¶åŒºé—®é¢˜ï¼‰        |\n| utime             | bigint        | ä¿®æ”¹æ—¶é—´                        |\n| app               | varchar(128)  | ä¸šåŠ¡æ–¹æ ‡è¯†                      |\n| name              | varchar(256)  | ä»»åŠ¡å                          |\n| status            | tinyint       | ä»»åŠ¡çŠ¶æ€ï¼š0æ–°å»ºã€1æ¿€æ´»ã€2æœªæ¿€æ´» |\n| cron              | varchar(256)  | cronè¡¨è¾¾å¼ï¼Œç”¨äºç”Ÿæˆå®šæ—¶ä»»åŠ¡    |\n| notify_http_param | varchar(8192) | å›è°ƒä¸Šä¸‹æ–‡                      |\n\n**å®šæ—¶ä»»åŠ¡è¡¨**\n\n| å­—æ®µ      | ç±»å‹         | è¯´æ˜                            |\n| --------- | ------------ | ------------------------------- |\n| task_id   | bigint       | è‡ªå¢ä¸»é”®ID                      |\n| ctime     | bigint       | åˆ›å»ºæ—¶é—´                        |\n| utime     | bigint       | ä¿®æ”¹æ—¶é—´                        |\n| timer_id  | bigint       | å¯¹åº”çš„å®šæ—¶å™¨ID                  |\n| app       | varchar(128) | ä¸šåŠ¡æ–¹æ ‡è¯†                      |\n| output    | var(1024)    | æ‰§è¡Œç»“æœ                        |\n| status    | tinyint      | ä»»åŠ¡çŠ¶æ€ï¼š0å¾…æ‰§è¡Œã€1æˆåŠŸã€2å¤±è´¥ |\n| run_timer | bigint       | å¼€å§‹è¿è¡Œæ—¶é—´                    |\n| cost_time | bigint       | è¯¯å·®æ—¶é—´                        |\n\n**å•ä¸ªåˆ†ç‰‡ç»“æ„**ï¼š\n\nKeyï¼šæ—¶é—´ + bucketç¼–å· = â€œ2024121115:54:51_01â€\n\nMemberï¼štimerId + unixå½“å‰æ—¶é—´æˆ³\n\nScoreï¼šunixå½“å‰æ—¶é—´æˆ³\n\n\n\nä¸€ä¸ªå¯èƒ½çš„ä¼˜åŒ–ç‚¹ï¼š\n\nåœ¨ä»»åŠ¡çŠ¶æ€ä¸Šå»ºç«‹ç´¢å¼•  ----->  å­˜åœ¨**æ•°æ®å€¾æ–œ**\n","slug":"å®šæ—¶å¾®æœåŠ¡","published":1,"date":"2024-12-27T11:03:15.344Z","updated":"2024-12-27T11:03:15.344Z","title":"","comments":1,"layout":"post","photos":[],"_id":"cm6c7md6j000ya5t249oj8dxi","content":"<h1 id=\"å®šæ—¶å¾®æœåŠ¡\"><a href=\"#å®šæ—¶å¾®æœåŠ¡\" class=\"headerlink\" title=\"å®šæ—¶å¾®æœåŠ¡\"></a>å®šæ—¶å¾®æœåŠ¡</h1><h2 id=\"å‰ç½®å‡†å¤‡\"><a href=\"#å‰ç½®å‡†å¤‡\" class=\"headerlink\" title=\"å‰ç½®å‡†å¤‡\"></a>å‰ç½®å‡†å¤‡</h2><h3 id=\"èƒŒæ™¯å’Œç°çŠ¶\"><a href=\"#èƒŒæ™¯å’Œç°çŠ¶\" class=\"headerlink\" title=\"èƒŒæ™¯å’Œç°çŠ¶\"></a>èƒŒæ™¯å’Œç°çŠ¶</h3><p>å¸‚é¢ä¸Šå·²æœ‰çš„å®šæ—¶å¾®æœåŠ¡æŠ€æœ¯ï¼šJava Timerã€Rocket MQã€xxl-jobã€Quartzã€Robfig&#x2F;Cron</p>\n<ul>\n<li>å¾ˆå¤šå…¬å¸çš„ä¸šåŠ¡åªéœ€è¦ä¸€ä¸ªç®€å•çš„â€œå®šæ—¶â€åŠŸèƒ½ã€‚ä¸ºäº†æ»¡è¶³ä¸€ä¸ªç®€å•å®šæ—¶åŠŸèƒ½è€Œå¼•å…¥è¿‡äºå¼ºå¤§è€Œä¸”è‡ƒè‚¿çš„ä»»åŠ¡è°ƒåº¦ç»„ä»¶æ˜¯ä¸åˆé€‚çš„</li>\n<li>è®¾è®¡ä¸€ä¸ª<strong>åŠŸèƒ½èšç„¦ã€è½»é‡çº§ã€ç»´æŠ¤æˆæœ¬ä½</strong>çš„å®šæ—¶å¾®æœåŠ¡ç»„ä»¶æ˜¯å¾ˆæœ‰å¿…è¦çš„</li>\n</ul>\n<p><strong>å®šæ—¶å¾®æœåŠ¡LyyTimer</strong></p>\n<ol>\n<li>ä¾èµ–ç®€å•ï¼šåªéœ€è¦æä¾›MySQLã€Rediså’ŒKafkaç»„ä»¶çš„æ”¯æŒå³å¯ï¼Œæ¥å…¥å’Œç»´æŠ¤çš„æˆæœ¬ä½</li>\n<li>å­¦ä¹ æˆæœ¬ä½ï¼šæ•´ä¸ªå®šæ—¶å¾®æœåŠ¡åŠŸèƒ½èšç„¦ï¼Œå®¹æ˜“ä¸Šæ‰‹</li>\n<li>ç‰¹æ€§ä¼˜ï¼šLyyTimerå…·æœ‰é«˜ç²¾å‡†ã€é«˜è´Ÿè½½ã€å¼‚å¸¸å¤„ç†ç­‰ç‰¹æ€§ï¼Œèƒ½åŸºæœ¬æ»¡è¶³å¤§éƒ¨åˆ†çš„å®šæ—¶éœ€æ±‚</li>\n</ol>\n<h3 id=\"éš¾ç‚¹\"><a href=\"#éš¾ç‚¹\" class=\"headerlink\" title=\"éš¾ç‚¹\"></a>éš¾ç‚¹</h3><h4 id=\"é«˜ç²¾å‡†\"><a href=\"#é«˜ç²¾å‡†\" class=\"headerlink\" title=\"é«˜ç²¾å‡†\"></a><strong>é«˜ç²¾å‡†</strong></h4><p>ç›¸å¯¹äºå•ç‚¹å®šæ—¶ï¼ˆä¾‹å¦‚Java.Timerï¼‰åŸºæœ¬èƒ½åšåˆ°æ¯«ç§’çº§è§¦å‘ï¼Œå‡ ä¹æ‰€æœ‰å®šæ—¶ä»»åŠ¡æ¡†æ¶æˆ–è€…æ¶ˆæ¯é˜Ÿåˆ—ï¼Œéƒ½åªèƒ½ä¿è¯ç§’çº§åˆ«è¯¯å·®</p>\n<p>å¸¸è§å¯¼è‡´æ—¶é—´è¯¯å·®å¤§çš„åŸå› ï¼š</p>\n<ul>\n<li>å®šæ—¶è„šæœ¬è¿è¡Œè€—æ—¶</li>\n<li>ç­‰å¾…å®šæ—¶è„šæœ¬è¿è¡Œ</li>\n<li>æ¶ˆæ¯é˜Ÿåˆ—ä¸­æ¶ˆæ¯å †ç§¯</li>\n<li>åˆ†å¸ƒå¼å®šæ—¶å™¨å»¶æ—¶å—ç½‘ç»œå½±å“</li>\n<li>æ•°æ®åº“ä¸­æŸ¥æ‰¾ä»»åŠ¡æ•°æ®è€—æ—¶</li>\n<li>ç‰¹æ®Šæ—¶é—´æ®µä»»åŠ¡è¿‡å¤š</li>\n</ul>\n<h4 id=\"é«˜è´Ÿè½½\"><a href=\"#é«˜è´Ÿè½½\" class=\"headerlink\" title=\"é«˜è´Ÿè½½\"></a><strong>é«˜è´Ÿè½½</strong></h4><p>èƒ½å¤Ÿæ”¯æŒåŒæ—¶å¤„ç†å¤§é‡ä»»åŠ¡ï¼Œå¹¶ä¸”å°½å¯èƒ½å°‘çš„å †ç§¯ä»»åŠ¡</p>\n<p>é«˜è´Ÿè½½è§£å†³æ€è·¯å’Œæ–¹æ³•ï¼š</p>\n<ul>\n<li>åº”ç”¨å±‚æ–¹é¢å‡å°‘ä»»åŠ¡é‡ï¼Œé€‰æ‹©å°†åŒä¸€æ—¶åˆ»çš„å¤šä¸ªç‹¬ç«‹ä»»åŠ¡åˆå¹¶æˆä¸€ä¸ªâ€œè®¡åˆ’åˆ—è¡¨â€</li>\n<li>åˆ†åº“åˆ†è¡¨ï¼šå°†ä¸€ä¸ªå¤§å‹æ•°æ®åº“åˆ†æˆå¤šä¸ªè¾ƒå°çš„æ•°æ®åº“ï¼Œå¹¶å°†æ¯ä¸ªæ•°æ®åº“è¿›ä¸€æ­¥åˆ†æˆå¤šä¸ªè¾ƒå°çš„è¡¨ï¼Œæ¯ä¸ªè¡¨åªåŒ…å«éƒ¨åˆ†æ•°æ®<ul>\n<li>å‚ç›´åˆ†è¡¨ï¼šä¿æŒåˆ—å®Œæ•´</li>\n<li>æ°´å¹³åˆ†è¡¨ï¼šåªä¿ç•™éƒ¨åˆ†åˆ—</li>\n<li>åˆ†åº“åˆ†è¡¨ç»„åˆ</li>\n</ul>\n</li>\n<li>æ•°æ®åˆ†åŒºï¼šå°†å¤§æ•°æ®æ‹†åˆ†æˆå¤šä¸ªå°æ•°æ®åˆ†åŒºï¼Œå°†è¿™äº›å°åˆ†åŒºå­˜å‚¨åœ¨ä¸åŒçš„ç‰©ç†è®¾å¤‡æˆ–æœåŠ¡å™¨ä¸Šï¼Œæä¾›æ•°æ®çš„å­˜å–æ•ˆç‡å’Œå¤„ç†é€Ÿåº¦</li>\n<li>çº¿ç¨‹æ± æŠ€æœ¯<ul>\n<li>å¤ç”¨çº¿ç¨‹ï¼Œé™ä½äº†èµ„æºæ¶ˆè€—</li>\n<li>é«˜æ•ˆåœ°ç®¡ç†å¤šä¸ªçº¿ç¨‹</li>\n</ul>\n</li>\n</ul>\n<h4 id=\"ä»»åŠ¡å¼‚å¸¸å¤„ç†\"><a href=\"#ä»»åŠ¡å¼‚å¸¸å¤„ç†\" class=\"headerlink\" title=\"ä»»åŠ¡å¼‚å¸¸å¤„ç†\"></a><strong>ä»»åŠ¡å¼‚å¸¸å¤„ç†</strong></h4><blockquote>\n<p> å®šæ—¶ä»»åŠ¡éœ€æ±‚å¯ä»¥å…è®¸æœ‰ä¸€å®šçš„è¯¯å·®ï¼Œä½†æ˜¯ä¸èƒ½ä¸è§¦å‘</p>\n</blockquote>\n<p><strong>ä»»åŠ¡å¼‚å¸¸çš„åŸå› ï¼š</strong></p>\n<ul>\n<li><p>åˆ›å»ºï¼ˆæ¿€æ´»ï¼‰ä»»åŠ¡æ¥å£å¼‚å¸¸ï¼šåœ¨åˆ›å»ºä»»åŠ¡é˜¶æ®µå‘ç”Ÿå¼‚å¸¸ï¼Œç³»ç»Ÿå¯ä»¥ç›´æ¥å°†å¼‚å¸¸åŸå› è¿”å›ç»™ç”¨æˆ·ã€‚ç”¨æˆ·æ„ŸçŸ¥åˆ°å¼‚å¸¸åï¼Œå¯é€šè¿‡ä¸»åŠ¨é‡è¯•è§£å†³é—®é¢˜ï¼Œå³è¯¥é˜¶æ®µçš„å¼‚å¸¸ä¸åº”è¯¥ç”±æ¡†æ¶è§£å†³</p>\n</li>\n<li><p>ä»»åŠ¡æµè½¬å¼‚å¸¸ï¼šä¸€æ—¦ä»»åŠ¡æˆåŠŸå­˜å‚¨åœ¨æ•°æ®åº“ä¸­ï¼Œå°±è®¤ä¸ºè¯¥å®šæ—¶ä»»åŠ¡åˆ›å»ºæˆåŠŸï¼Œå¾®æœåŠ¡æ¡†æ¶å°±è¦è´Ÿè´£è¯¥ä»»åŠ¡åç»­çš„æµè½¬ï¼ˆæŸ¥è¯¢æ•°æ®åº“ã€å‘é€æ¶ˆæ¯é˜Ÿåˆ—ã€ç¼“å­˜ç­‰ï¼‰ã€‚å› æ­¤ï¼Œæ¡†æ¶éœ€è¦è§£å†³ä»»åŠ¡æµè½¬è¿‡ç¨‹ä¸­å‘ç”Ÿçš„å¼‚å¸¸</p>\n</li>\n<li><p>ä»»åŠ¡è§¦å‘é˜¶æ®µå¼‚å¸¸ï¼šå½“ä»»åŠ¡æ‰§è¡Œåï¼Œç³»ç»Ÿéœ€è¦å›è°ƒå‘ŠçŸ¥ä¸šåŠ¡æ–¹ä»»åŠ¡ç»“æœã€‚å¯¹äºä¸šåŠ¡æ–¹æ¥è¯´ï¼Œå¦‚æœå›è°ƒå¤±è´¥å¯¼è‡´ç»“æœä¸¢å¤±ï¼Œå°±ç›¸å½“äºè¯¥ä»»åŠ¡æ²¡æœ‰æ‰§è¡Œè¿‡</p>\n</li>\n</ul>\n<p><strong>å¸¸ç”¨çš„è§£å†³æ–¹æ¡ˆ</strong></p>\n<ul>\n<li><strong>ï¼ˆç«‹å³ï¼‰é‡è¯•æœºåˆ¶</strong>ï¼šå¯ä»¥åº”ä»˜ä¸€äº›å¶å‘æ€§å¼‚å¸¸ï¼Œä¾‹å¦‚æ•°æ®åº“æŠ–åŠ¨ã€RedisæŠ–åŠ¨</li>\n<li><strong>å¤±è´¥å…œåº•æœºåˆ¶</strong>ï¼šä¸€èˆ¬æ¥è¯´ï¼Œå…œåº•ç­–ç•¥éƒ½æ˜¯é‡‡ç”¨ä¸€äº›â€œæ— è„‘â€è„šæœ¬ï¼Œå…¨è¡¨æ‰«ææ•°æ®åº“ï¼Œé’ˆå¯¹å¤±è´¥è®°å½•è¿›è¡Œé‡è¯•æ“ä½œã€‚ä½†æ˜¯å…œåº•ç­–ç•¥ä¸€èˆ¬åœ¨æ€§èƒ½ä¸Šä¸å ä¼˜åŠ¿ï¼Œæ‰€ä»¥éœ€è¦é€‰æ‹©åˆé€‚çš„æ—¶é—´é—´éš”æ‰§è¡Œå…œåº•è„šæœ¬</li>\n<li><strong>å¤±è´¥æŠ¥è­¦æœºåˆ¶</strong>ï¼šå½“çŸ­æ—¶é—´å†…æœ‰å¤§é‡ä»»åŠ¡å¤±è´¥æ—¶ï¼Œéœ€è¦åŠæ—¶æŠ¥è­¦</li>\n<li><strong>äººå·¥å¹²é¢„</strong></li>\n</ul>\n<h2 id=\"æ¶æ„è®¾è®¡\"><a href=\"#æ¶æ„è®¾è®¡\" class=\"headerlink\" title=\"æ¶æ„è®¾è®¡\"></a>æ¶æ„è®¾è®¡</h2><h3 id=\"å®ç°æ€è·¯\"><a href=\"#å®ç°æ€è·¯\" class=\"headerlink\" title=\"å®ç°æ€è·¯\"></a>å®ç°æ€è·¯</h3><p><strong>å®šæ—¶å™¨æœ¬è´¨å®ç°æ€è·¯ï¼šæŸ¥è¯¢ + è§¦å‘</strong>ï¼Œä»¥åŠæš´éœ²ç»™ç”¨æˆ·ä¸€ä¸ª<strong>æ³¨å†Œä»»åŠ¡</strong>æ¥å£</p>\n<ul>\n<li><strong>æ³¨å†Œ</strong>å®šæ—¶å™¨ï¼šæ¥å—ç”¨æˆ·çš„åˆ›å»ºè¯·æ±‚ï¼Œæ˜ç¡®æ¯ä¸€ä¸ªä»»åŠ¡çš„<strong>æ‰§è¡Œæ—¶é—´</strong></li>\n<li><strong>æŸ¥è¯¢</strong>æ•°æ®åº“ï¼šæ¯éš”ä¸€æ®µæ—¶é—´é—´éš”å°±<strong>æŸ¥è¯¢</strong>ä»»åŠ¡åˆ—è¡¨ï¼Œç­›é€‰å‡ºæœªè§¦å‘çš„ä»»åŠ¡</li>\n<li><strong>è§¦å‘</strong>ä»»åŠ¡ï¼šè§¦å‘<strong>æ‰§è¡Œæ—¶é—´å°äºå½“å‰æ—¶é—´ï¼ˆæ—¶åˆ»ï¼‰</strong>çš„ä»»åŠ¡</li>\n</ul>\n<h4 id=\"å­˜å‚¨ç»“æ„ä¼˜åŒ–ï¼šæœ‰åºè¡¨\"><a href=\"#å­˜å‚¨ç»“æ„ä¼˜åŒ–ï¼šæœ‰åºè¡¨\" class=\"headerlink\" title=\"å­˜å‚¨ç»“æ„ä¼˜åŒ–ï¼šæœ‰åºè¡¨\"></a>å­˜å‚¨ç»“æ„ä¼˜åŒ–ï¼šæœ‰åºè¡¨</h4><p><strong>åŸºäºæœ‰åºæ•°æ®ç»“æ„ï¼ŒåŠ å¿«æ•°æ®æŸ¥è¯¢</strong></p>\n<p>å¸¸è§çš„æœ‰åºæ•°æ®ç»“æ„ï¼šçº¢é»‘æ ‘ã€è·³è¡¨ã€å¹³è¡¡æ ‘ç­‰ï¼Œè¿™äº›æ•°æ®ç»“æ„é€šè¿‡åœ¨æ’å…¥æ“ä½œå‡æ‘ŠæŸ¥è¯¢æ“ä½œçš„æ—¶é—´å¤æ‚åº¦å®ç°**æŸ¥è¯¢æ—¶é—´å¤æ‚åº¦$$O(N) â€”&gt; O(logN)$$**çš„ä¼˜åŒ–</p>\n<h4 id=\"å­˜å‚¨ç»“æ„ä¼˜åŒ–ï¼šæ¨ªå‘åˆ‡ç‰‡\"><a href=\"#å­˜å‚¨ç»“æ„ä¼˜åŒ–ï¼šæ¨ªå‘åˆ‡ç‰‡\" class=\"headerlink\" title=\"å­˜å‚¨ç»“æ„ä¼˜åŒ–ï¼šæ¨ªå‘åˆ‡ç‰‡\"></a>å­˜å‚¨ç»“æ„ä¼˜åŒ–ï¼šæ¨ªå‘åˆ‡ç‰‡</h4><p><strong>æ ¹æ®æ—¶é—´åŒºé—´å¯¹æ•°æ®åˆ†ç‰‡ï¼Œå‡å°‘æŸ¥è¯¢æ—¶æ¶‰åŠçš„æ•°æ®æ•°é‡</strong></p>\n<p>æ¯æ¬¡æŸ¥è¯¢æ•°æ®çš„æ—¶å€™ï¼ŒçœŸæ­£çš„ç›®æ ‡æ˜¯<strong>å³å°†æ‰§è¡Œ</strong>çš„ä»»åŠ¡ï¼Œè€Œ<strong>ç¨åæ‰§è¡Œ</strong>çš„ä»»åŠ¡å±äºæ— å…³ä»»åŠ¡ã€‚åŸºäºè¿™ä¸ªç†å¿µï¼Œæˆ‘ä»¬å¯ä»¥å°†æ•°æ®è¿›è¡Œæ¨ªå‘åˆ‡åˆ†ï¼Œä¾‹å¦‚æ¯ä¸€åˆ†é’Ÿåˆ’åˆ†ä¸€ä¸ªæ•°æ®åˆ‡ç‰‡ï¼Œç„¶åä»åŒ…å«ç›®æ ‡æ•°æ®çš„æ•°æ®åˆ‡ç‰‡ä¸­æŸ¥è¯¢æ•°æ®</p>\n<p>è¿™ç§åšæ³•å¯ä»¥å°†å¤§å¤§é™ä½æ¯ä¸€æ¬¡æŸ¥è¯¢çš„ä»»åŠ¡æ•°é‡çº§ï¼šN â€”&gt; Nâ€™ï¼Œå…¶ä¸­Nâ€™ &lt;&lt; Nï¼Œå³ä½¿æ²¡æœ‰æ”¹å˜æŸ¥è¯¢çš„æ—¶é—´å¤æ‚åº¦ï¼Œä½†å‡å°‘äº†æŸ¥è¯¢æ—¶æ¶‰åŠçš„æ•°æ®æ•°é‡</p>\n<h4 id=\"å­˜å‚¨ç»“æ„ä¼˜åŒ–ï¼šçºµå‘åˆ‡ç‰‡\"><a href=\"#å­˜å‚¨ç»“æ„ä¼˜åŒ–ï¼šçºµå‘åˆ‡ç‰‡\" class=\"headerlink\" title=\"å­˜å‚¨ç»“æ„ä¼˜åŒ–ï¼šçºµå‘åˆ‡ç‰‡\"></a>å­˜å‚¨ç»“æ„ä¼˜åŒ–ï¼šçºµå‘åˆ‡ç‰‡</h4><p><strong>å¯¹æ•°æ®åˆ†åŒºè¿›è¡Œåˆ†æ¡¶ï¼Œæé«˜æ•°æ®æ“ä½œçš„å¹¶å‘åº¦</strong></p>\n<p>æˆªæ­¢åˆ°ä¸Šä¸€æ­¥ï¼Œæ—¶é—´æ•°æ®åˆ†åŒºæ˜¯å®šæ—¶å™¨ä¸­çš„æœ€å°èµ„æºå•ä½ï¼Œæ¯ä¸€ä¸ªæ•°æ®åˆ†åŒºéƒ½ç”±ä¸€ä¸ªgoroutineï¼ˆæˆ–çº¿ç¨‹ï¼‰æ§åˆ¶ã€‚ä¸ºäº†æé«˜æ•°æ®æ“ä½œçš„å¹¶å‘åº¦ï¼Œå¯ä»¥å¯¹åˆ†åŒºä¸­çš„æ•°æ®è¿›ä¸€æ­¥<strong>åˆ†æ¡¶</strong>ï¼ŒæŠŠæ¯ä¸€ä¸ªæ¡¶äº¤ä»˜ç»™ä¸€ä¸ªgoroutineï¼ˆæˆ–çº¿ç¨‹ï¼‰å¤„ç†ï¼Œåœ¨çºµå‘å¢åŠ åˆ†æ¡¶çš„ç»´åº¦ï¼Œæé«˜å¹¶å‘åº¦</p>\n<blockquote>\n<p>æ€»ç»“ï¼šä¾ç„¶æ˜¯â€œæŸ¥è¯¢ + è§¦å‘â€çš„å®šæ—¶å™¨æœºåˆ¶ï¼Œåªä¸è¿‡ç›¸è¾ƒäºä¸ç‰ˆå®šæ—¶å™¨æœ‰å¦‚ä¸‹å˜åŒ–ï¼šæ¯æ¬¡æŸ¥è¯¢éƒ½åªæŸ¥è¯¢ä¸€ä¸ªï¼ˆå½“å‰ï¼‰æ—¶é—´èŒƒå›´å†…çš„æ•°æ®ï¼Œè¿™äº›æ•°æ®ç”±ZSetæ•°æ®ç»“æ„å­˜å‚¨ã€‚æ¥ç€åŸºäºå¹¶å‘çš„è€ƒè™‘ï¼Œä»¤å¤šä¸ªgoroutineè´Ÿè´£ä»åˆ†åŒºä¸­çš„å¤šä¸ªæ¡¶ä¸­æŸ¥è¯¢æ•°æ®ï¼Œæœ€åå°†è§¦å‘è·å–åˆ°çš„ä»»åŠ¡ã€‚</p>\n</blockquote>\n<h3 id=\"æ•´ä½“æ¶æ„\"><a href=\"#æ•´ä½“æ¶æ„\" class=\"headerlink\" title=\"æ•´ä½“æ¶æ„\"></a>æ•´ä½“æ¶æ„</h3><h4 id=\"å®šæ—¶ä»»åŠ¡è°ƒåº¦æµç¨‹\"><a href=\"#å®šæ—¶ä»»åŠ¡è°ƒåº¦æµç¨‹\" class=\"headerlink\" title=\"å®šæ—¶ä»»åŠ¡è°ƒåº¦æµç¨‹\"></a>å®šæ—¶ä»»åŠ¡è°ƒåº¦æµç¨‹</h4><p>ä»»åŠ¡è°ƒåº¦æµç¨‹<strong>æœåŠ¡æ¶æ„ï¼šä¸‰ä¸ªæ¨¡å— + ä¸¤ä¸ªåç¨‹æ± </strong></p>\n<p>LyyTimeræ˜¯ä¸€ä¸ª<strong>å»ä¸­å¿ƒåŒ–çš„å®šæ—¶ä»»åŠ¡è°ƒåº¦æ¡†æ¶</strong>ï¼Œå®šæ—¶ä»»åŠ¡è°ƒåº¦æœåŠ¡æ ¹æ®èŒè´£è¾¹ç•Œå¯ä»¥å°†æœåŠ¡æ‹†åˆ†ä¸ºï¼š<strong>è°ƒåº¦å™¨æ¨¡å—</strong>ã€<strong>è§¦å‘å™¨æ¨¡å—</strong>ã€<strong>æ‰§è¡Œæ¨¡å—</strong>ï¼Œè¿™ä¸‰ä¸ªæ¨¡å—å­˜åœ¨ç€ä¾èµ–å…³ç³»ã€‚çˆ¶æ¨¡å—é€šè¿‡åç¨‹æ± å¼‚æ­¥å¯åŠ¨å­æ¨¡å—æ‰§è¡Œç›¸åº”å·¥ä½œ</p>\n<p><img src=\"https://raw.githubusercontent.com/lyydsheep/pic/main/202411251841204.png\" alt=\"image-20241125183915443\"></p>\n<h4 id=\"å®šæ—¶ä»»åŠ¡ç”Ÿæˆæµç¨‹\"><a href=\"#å®šæ—¶ä»»åŠ¡ç”Ÿæˆæµç¨‹\" class=\"headerlink\" title=\"å®šæ—¶ä»»åŠ¡ç”Ÿæˆæµç¨‹\"></a>å®šæ—¶ä»»åŠ¡ç”Ÿæˆæµç¨‹</h4><p><strong>å®šæ—¶ä»»åŠ¡çš„åˆ›å»ºè®¾è®¡åˆ°Web Serverå’ŒMigrator Schedulerä¸¤ä¸ªæ¨¡å—</strong></p>\n<ul>\n<li>ç”¨æˆ·é€šè¿‡Web Serveræä¾›çš„APIåˆ›å»ºå®šæ—¶ä»»åŠ¡</li>\n<li>Migrator Schedulerå®šæ—¶æ ¹æ®cronè¡¨è¾¾å¼é¢„çƒ­å®šæ—¶ä»»åŠ¡æ•°æ®</li>\n</ul>\n<p><img src=\"https://raw.githubusercontent.com/lyydsheep/pic/main/202411251851062.png\" alt=\"image-20241125185145008\"></p>\n<blockquote>\n<p>ä¸ºä»€ä¹ˆéœ€è¦ä¸¤ç§æ–¹å¼é¢„çƒ­æ•°æ®ï¼Ÿ</p>\n<p>ä¸ºäº†ç¡®ä¿åœ¨å®šæ—¶è„šæœ¬æ‰§è¡Œé—´éš”å†…åˆ›å»ºçš„ä»»åŠ¡ç”Ÿæ•ˆã€‚ä¾‹å¦‚ï¼Œå®šæ—¶è„šæœ¬æ¯ä¸¤å°æ—¶æ‰§è¡Œä¸€æ¬¡ï¼Œæ¯ä¸€æ¬¡æ‰§è¡Œéƒ½ä¼šé¢„çƒ­ä¸¤å°æ—¶åçš„æ•°æ®ã€‚ç¬¬ä¸€æ¬¡å®šæ—¶è„šæœ¬æ‰§è¡Œæ—¶åˆ»æ˜¯18:58ï¼Œåˆ›å»ºäº†18:58-20:58å®šæ—¶ä»»åŠ¡ã€‚å€˜è‹¥æœ‰ç”¨æˆ·åœ¨19:00æƒ³è¦åˆ›å»ºä¸€ä¸ª19:58åˆ†çš„å®šæ—¶ä»»åŠ¡ï¼Œé‚£ä¹ˆåªä¾é å®šæ—¶è„šæœ¬æ˜¯æ— æ³•å®ç°çš„ï¼Œå› ä¸ºä¸‹ä¸€æ¬¡å®šæ—¶è„šæœ¬çš„æ‰§è¡Œæ—¶é—´æ˜¯20:58ã€‚ç»¼ä¸Šæ‰€è¯‰ï¼Œä»…ä»…æœ‰å®šæ—¶è„šæœ¬æ˜¯æœ‰ç¼ºé™·çš„ï¼Œè¿˜éœ€è¦ä¸€ä¸ªWeb Serveræ¨¡å—å®Œæˆä»»åŠ¡çš„ç¬¬ä¸€æ¬¡åˆ›å»ºï¼Œç¡®ä¿ç”¨æˆ·åœ¨ä»»ä½•æ—¶å€™åˆ›å»ºçš„ä»»åŠ¡éƒ½èƒ½ç”Ÿæ•ˆã€‚</p>\n</blockquote>\n<h3 id=\"è°ƒåº¦æµç¨‹æ¨¡å—åŒ–\"><a href=\"#è°ƒåº¦æµç¨‹æ¨¡å—åŒ–\" class=\"headerlink\" title=\"è°ƒåº¦æµç¨‹æ¨¡å—åŒ–\"></a>è°ƒåº¦æµç¨‹æ¨¡å—åŒ–</h3><h4 id=\"è°ƒåº¦å™¨æ¨¡å—\"><a href=\"#è°ƒåº¦å™¨æ¨¡å—\" class=\"headerlink\" title=\"è°ƒåº¦å™¨æ¨¡å—\"></a>è°ƒåº¦å™¨æ¨¡å—</h4><p><strong>ç¡®å®šäºŒç»´æ•°æ®åˆ†åŒºç›®æ ‡å¯¹è±¡ï¼Œç»Ÿç­¹åˆ†é…è§¦å‘å™¨</strong></p>\n<p>è°ƒåº¦å™¨çš„ä½œç”¨å°±æ˜¯è¦ç¡®ä¿åœ¨åˆ†å¸ƒå¼åœºæ™¯ä¸‹ï¼Œæ¯ä¸€ä¸ªäºŒç»´æ•°æ®åˆ†åŒºéƒ½èƒ½è¢«ä¸€ä¸ªè§¦å‘å™¨è´Ÿè´£å¤„ç†ï¼Œæ—¢ä¸èƒ½é—æ¼ï¼Œä¹Ÿä¸èƒ½é‡å¤</p>\n<ul>\n<li>è°ƒåº¦å™¨åŸºäºtime tickeræ¯ç§’é’Ÿè¿›è¡Œä¸€æ¬¡å·¥ä½œï¼Œæ ¹æ®å½“å‰æ—¶åˆ»æ¨ç®—å‡º<strong>åˆ†é’Ÿçº§åˆ«</strong>çš„å­—ç¬¦ä¸²è¡¨è¾¾å¼</li>\n<li>æ ¹æ®é…ç½®ä¸­æœ€å¤§æ¡¶æ•°é‡ï¼Œä¾æ¬¡æ‹¼æ¥åˆ†é’ŸKeyå€¼å¾—åˆ°è‹¥å¹²ä¸ªäºŒç»´æ•°æ®åˆ†åŒºçš„Keyå€¼ã€‚ä¾‹å¦‚<code>20:47:39_0</code>ã€<code>20:48:11_1</code></li>\n<li>å°è¯•æŠ¢å æ•°æ®åˆ†åŒºçš„åˆ†å¸ƒå¼é”ï¼Œå¹¶æŠŠé”çš„è¿‡æœŸæ—¶é—´è®¾ç½®ä¸º<strong>å¤§äº1å€åˆ†ç‰‡æ—¶é—´ï¼Œå°äº2å€åˆ†ç‰‡æ—¶é—´</strong></li>\n<li>å¦‚æœæŠ¢é”æˆåŠŸï¼Œå°±è°ƒåº¦ä¸€ä¸ªè§¦å‘å™¨è¿›è¡Œä½œä¸š</li>\n</ul>\n<h4 id=\"è§¦å‘å™¨æ¨¡å—\"><a href=\"#è§¦å‘å™¨æ¨¡å—\" class=\"headerlink\" title=\"è§¦å‘å™¨æ¨¡å—\"></a>è§¦å‘å™¨æ¨¡å—</h4><p><strong>æŒ‰æ—¶å”¤é†’äºŒç»´æ•°æ®åˆ†åŒºä¸­çš„å®šæ—¶ä»»åŠ¡</strong></p>\n<ul>\n<li>è§¦å‘å™¨è¢«åˆ›å»ºåï¼Œæ¯ç§’å¯¹è´Ÿè´£çš„æ•°æ®åˆ†åŒºè¿›è¡Œæ‰«æï¼Œä»¥å½“å‰æ—¶åˆ»ä¸ºåŸºå‡†ï¼Œå°†ç¬¦åˆæ¡ä»¶çš„å®šæ—¶ä»»åŠ¡å–å‡ºå¹¶äº¤ä»˜ç»™æ‰§è¡Œå™¨æ‰§è¡Œ</li>\n<li>å½“è§¦å‘å™¨åç¨‹å®Œæˆä»»åŠ¡åï¼Œéœ€è¦å°†åˆ†å¸ƒå¼é”çš„è¿‡æœŸæ—¶é—´å»¶æœŸè‡³<strong>å¤§äºä¸¤ä¸ªåˆ†åŒºæ—¶é—´</strong></li>\n</ul>\n<blockquote>\n<p>ä¸ºä»€ä¹ˆè¦å¯¹åˆ†å¸ƒå¼é”è¿›è¡Œå»¶æœŸï¼Ÿ</p>\n<p>å›ç­”è¿™ä¸ªé—®é¢˜ä¹‹å‰ï¼Œéœ€è¦è¡¥å……çš„ä¸€ç‚¹ï¼šä¸ºäº†å¯¹å‰ä¸€åˆ†é’Ÿçš„æ•°æ®åˆ†åŒºæ‰§è¡Œå¤±è´¥åšå…œåº•ï¼Œæ¯æ¬¡è§¦å‘å™¨å¯¹å½“å‰åˆ†åŒºè¿›è¡Œæ‰«ææ—¶éƒ½ä¼šå¯¹å‰ä¸€åˆ†é’Ÿçš„æ•°æ®åˆ†åŒºè¿›è¡Œé‡è¯•æ‰«æã€‚</p>\n<p>å› æ­¤ï¼Œå¦‚æœå‰ä¸€ä¸ªæ•°æ®åˆ†åŒºçš„ä»»åŠ¡æ‰§è¡Œå¤±è´¥ï¼Œé‚£ä¹ˆè¯¥åˆ†åŒºçš„åˆ†å¸ƒå¼é”æ— æ³•å¾—åˆ°å»¶æ—¶ï¼Œå¿…ç„¶ä¼šåœ¨å½“å‰åˆ†é’Ÿå†…å†æ¬¡è·å¾—è¿›è€Œè¿›è¡Œé‡è¯•æ“ä½œã€‚åä¹‹ï¼Œåˆ†å¸ƒå¼é”å¾—åˆ°äº†å»¶æ—¶ï¼Œé‚£ä¹ˆå½“å‰åˆ†é’Ÿå†…å°±ä¸ä¼šé‡å¤æ‰§è¡Œå·²æˆåŠŸæ‰§è¡Œçš„ä»»åŠ¡ã€‚</p>\n<p>ä¹Ÿæ­£æ˜¯å‡ºäºè¿™ä¸ªæœºåˆ¶è€ƒè™‘ï¼Œå»¶è¿Ÿçš„æ—¶é—´å¿…é¡»å¤§äºä¸¤ä¸ªåˆ†åŒºæ—¶é—´</p>\n</blockquote>\n<p>é—®é¢˜åœ¨äºå¾ˆéš¾å®ç°ç™¾åˆ†ç™¾çš„åˆ†å¸ƒå¼äº‹åŠ¡ï¼Œå³æ— æ³•ä¿è¯<strong>å®Œæˆåˆ†åŒºä»»åŠ¡ + å»¶è¿Ÿåˆ†å¸ƒå¼é”</strong>æ“ä½œæ˜¯åŸå­çš„ï¼Œå› æ­¤è¿™é‡Œåªèƒ½æ˜¯<strong>At least once</strong>è¯­ä¹‰ã€‚</p>\n<h4 id=\"æ‰§è¡Œå™¨æ¨¡å—\"><a href=\"#æ‰§è¡Œå™¨æ¨¡å—\" class=\"headerlink\" title=\"æ‰§è¡Œå™¨æ¨¡å—\"></a>æ‰§è¡Œå™¨æ¨¡å—</h4><p><strong>æ‰§è¡Œå®šæ—¶ä»»åŠ¡</strong></p>\n<ul>\n<li>ä¸€ä¸ªæ‰§è¡Œå™¨ç”±è§¦å‘å™¨è°ƒåº¦ï¼Œå¯¹åº”ä¸€ä¸ªå…·ä½“çš„å®šæ—¶ä»»åŠ¡</li>\n<li>æ‰§è¡Œå™¨é¦–å…ˆå¯¹å®šæ—¶ä»»åŠ¡è¿›è¡Œå¹‚ç­‰æ£€æŸ¥</li>\n<li>æ‰§è¡Œä»»åŠ¡</li>\n<li>æ›´æ–°å®šæ—¶ä»»åŠ¡çš„çŠ¶æ€</li>\n</ul>\n<h3 id=\"ä»»åŠ¡è¿ç§»æ¨¡å—åŒ–\"><a href=\"#ä»»åŠ¡è¿ç§»æ¨¡å—åŒ–\" class=\"headerlink\" title=\"ä»»åŠ¡è¿ç§»æ¨¡å—åŒ–\"></a>ä»»åŠ¡è¿ç§»æ¨¡å—åŒ–</h3><p>LyyTimeré¡¹ç›®ä½¿ç”¨MySQL + RedisäºŒçº§å­˜å‚¨æ¨¡å‹ï¼Œå¹¶è®¾ç½®äº†ä¸€ä¸ªMigratoræ ¹æ®æ—¶é—´ç”±è¿‘åŠè¿œ<strong>é€šè¿‡å¤„äºæ¿€æ´»çŠ¶æ€çš„å®šæ—¶å™¨ï¼ˆcronè¡¨è¾¾å¼ï¼‰ç”Ÿæˆä¸€ç³»åˆ—å®šæ—¶ä»»åŠ¡</strong>ï¼Œå¹¶è¿ç§»åŒæ­¥è‡³ä¸¤ä¸ªå­˜å‚¨ä»‹è´¨ä¸­</p>\n<h4 id=\"Migratoræ¨¡å—\"><a href=\"#Migratoræ¨¡å—\" class=\"headerlink\" title=\"Migratoræ¨¡å—\"></a>Migratoræ¨¡å—</h4><ul>\n<li>æ¯éš”ä¸€æ®µæ—¶é—´æ­¥é•¿å°±æ‰«ææ‰€æœ‰çš„å®šæ—¶å™¨ï¼Œæ ¹æ®å¤„äºæ¿€æ´»çŠ¶æ€çš„å®šæ—¶å™¨ç”Ÿæˆæœªæ¥ä¸¤ä¸ªæ—¶é—´æ­¥é•¿çš„å®šæ—¶ä»»åŠ¡ï¼ˆæœ¬è´¨ä¸Šå°±ä¸€ä¸ªæ—¶é—´æ­¥é•¿ï¼Œéƒ½æ˜¯ä¸ºäº†å¤±è´¥å…œåº•ğŸ˜‚ï¼‰<ul>\n<li>ä¾‹å¦‚ï¼Œæ¯éš”ä¸€å°æ—¶å°±è¿›è¡Œä¸€æ¬¡å…¨è¡¨æ‰«æï¼Œè‹¥14:45:34å¯¹æ‰€æœ‰çš„å®šæ—¶å™¨è¿›è¡Œä¸€æ¬¡æ‰«æï¼Œè¿ç§»æ¨¡å—å°±ä¼šç”Ÿæˆ14:45:34 - 16:45:34è¿™ä¸¤ä¸ªå°æ—¶çš„å®šæ—¶ä»»åŠ¡å¹¶è¿ç§»è‡³MySQLå’ŒRedisä¸­ã€‚ä½†14:45:34 - 15:45:34è¿™ä¸ªæ—¶é—´æ®µçš„ä»»åŠ¡å·²ç»åœ¨13:45:34è¢«Migratoræ¨¡å—ç”Ÿæˆå¹¶å­˜å‚¨äº†ï¼Œæ‰€ä»¥æœ¬è´¨ä¸Šè¿ç§»æ¨¡å—åªç”Ÿæˆäº†ä¸€å°æ—¶çš„ä»»åŠ¡ã€‚é‡å¤çš„ä»»åŠ¡å°†ä¼šç”±äºå”¯ä¸€çº¦æŸè€Œæ’å…¥å¤±è´¥ï¼Œæ‰€ä»¥ä¸å¿…æ‹…å¿ƒä»»åŠ¡é‡å¤æ’å…¥</li>\n</ul>\n</li>\n</ul>\n<h5 id=\"ä¸²è¡Œæ‰“ç‚¹è¿˜æ˜¯æ‰¹é‡æ‰“ç‚¹ï¼Ÿ\"><a href=\"#ä¸²è¡Œæ‰“ç‚¹è¿˜æ˜¯æ‰¹é‡æ‰“ç‚¹ï¼Ÿ\" class=\"headerlink\" title=\"ä¸²è¡Œæ‰“ç‚¹è¿˜æ˜¯æ‰¹é‡æ‰“ç‚¹ï¼Ÿ\"></a>ä¸²è¡Œæ‰“ç‚¹è¿˜æ˜¯æ‰¹é‡æ‰“ç‚¹ï¼Ÿ</h5><p>ä¸²è¡Œæ‰“ç‚¹å°±æ˜¯æŒ‡æ¯æ¬¡æ ¹æ®cronè¡¨è¾¾å¼<strong>åªç”Ÿæˆæœ€è¿‘çš„ä¸€æ¬¡</strong>å®šæ—¶ä»»åŠ¡ï¼Œç„¶ååœ¨æ‰§è¡Œå™¨æ‰§è¡Œå®Œè¿™ä¸ªä»»åŠ¡åå°±ç«‹é©¬ç”Ÿæˆä¸‹ä¸€æ¬¡çš„å®šæ—¶ä»»åŠ¡ï¼Œå¦‚æ­¤å¾ªç¯ã€‚</p>\n<p>ä¸²è¡Œæ‰“ç‚¹æ¯”è¾ƒèŠ‚çº¦èµ„æºï¼Œå¯ä»¥ç¼“è§£ç”Ÿæˆä»»åŠ¡è¿‡å¤šå¯¼è‡´çš„çŸ­æ—¶é—´å†…èµ„æºæµªè´¹é—®é¢˜ï¼Œä½†æ˜¯é’ˆå¯¹äºçŸ­é—´éš”é«˜é¢‘æ‰§è¡Œçš„å®šæ—¶å™¨ï¼ˆä¾‹å¦‚ï¼š1sæ‰§è¡Œä¸€æ¬¡ï¼‰å°±æœ‰äº›åŠ›ä¸ä»å¿ƒäº†ã€‚</p>\n<p><strong>ä¼˜åŒ–æ–¹æ¡ˆï¼šæ‰¹é‡æ‰“ç‚¹</strong></p>\n<p>æ¯éš”ä¸€æ®µæ—¶é—´ç¨‹åºå°±æ ¹æ®cronè¡¨è¾¾å¼ç”Ÿæˆä¸€ä¸ªæ—¶é—´æ­¥é•¿çš„ä»»åŠ¡ï¼Œè¿™æ ·å¯ä»¥æœ‰æ•ˆè§£å†³çŸ­é—´éš”é«˜é¢‘ç‡çš„ä»»åŠ¡ç”Ÿæˆé—®é¢˜ã€‚ä½†å¦‚æœç”¨æˆ·å¯¹å®šæ—¶å™¨è¿›è¡Œé¢‘ç¹çš„ä¿®æ”¹ï¼Œé‚£ä¸ºäº†ä¿è¯æ•°æ®ä¸€è‡´æ€§ï¼Œå°±éœ€è¦å¼•å…¥åˆ é™¤ã€ä¿®æ”¹å·²ç”Ÿæˆä»»åŠ¡ç­‰å¤æ‚æ“ä½œã€‚ä¸ºäº†è§„é¿è¿™ç§æƒ…å†µï¼Œæˆ‘ä»¬å¯ä»¥è¦æ±‚ç”¨æˆ·æ— æ³•å¯¹å·²æœ‰çš„å®šæ—¶å™¨è¿›è¡Œä¿®æ”¹ï¼Œåªå…è®¸<strong>æ¿€æ´»</strong>å’Œ<strong>å»æ¿€æ´»</strong>ä¸¤ç§æ“ä½œ</p>\n<p>æ­¤å¤–ï¼Œå³ä½¿ç”¨æˆ·<strong>å»æ¿€æ´»</strong>æŸä¸€ä¸ªå®šæ—¶å™¨ï¼Œæˆ‘ä»¬ä¹Ÿæ— éœ€ä¿®æ”¹å·²æœ‰çš„ä»»åŠ¡ï¼Œåªéœ€è¦åœ¨å›è°ƒä¹‹å‰æ£€æŸ¥å®šæ—¶å™¨çŠ¶æ€æ˜¯å¦åˆæ³•å³å¯ã€‚</p>\n<h2 id=\"å­˜å‚¨ç»“æ„è®¾è®¡\"><a href=\"#å­˜å‚¨ç»“æ„è®¾è®¡\" class=\"headerlink\" title=\"å­˜å‚¨ç»“æ„è®¾è®¡\"></a>å­˜å‚¨ç»“æ„è®¾è®¡</h2><p><strong>å®šæ—¶å™¨è¡¨</strong></p>\n<table>\n<thead>\n<tr>\n<th>å­—æ®µ</th>\n<th>ç±»å‹</th>\n<th>è¯´æ˜</th>\n</tr>\n</thead>\n<tbody><tr>\n<td>timer_id</td>\n<td>bigint</td>\n<td>è‡ªå¢ä¸»é”®IDï¼ˆæˆ–æœ‰åºUUIDï¼‰</td>\n</tr>\n<tr>\n<td>ctime</td>\n<td>bigint</td>\n<td>åˆ›å»ºæ—¶é—´ï¼ˆé¿å…æ—¶åŒºé—®é¢˜ï¼‰</td>\n</tr>\n<tr>\n<td>utime</td>\n<td>bigint</td>\n<td>ä¿®æ”¹æ—¶é—´</td>\n</tr>\n<tr>\n<td>app</td>\n<td>varchar(128)</td>\n<td>ä¸šåŠ¡æ–¹æ ‡è¯†</td>\n</tr>\n<tr>\n<td>name</td>\n<td>varchar(256)</td>\n<td>ä»»åŠ¡å</td>\n</tr>\n<tr>\n<td>status</td>\n<td>tinyint</td>\n<td>ä»»åŠ¡çŠ¶æ€ï¼š0æ–°å»ºã€1æ¿€æ´»ã€2æœªæ¿€æ´»</td>\n</tr>\n<tr>\n<td>cron</td>\n<td>varchar(256)</td>\n<td>cronè¡¨è¾¾å¼ï¼Œç”¨äºç”Ÿæˆå®šæ—¶ä»»åŠ¡</td>\n</tr>\n<tr>\n<td>notify_http_param</td>\n<td>varchar(8192)</td>\n<td>å›è°ƒä¸Šä¸‹æ–‡</td>\n</tr>\n</tbody></table>\n<p><strong>å®šæ—¶ä»»åŠ¡è¡¨</strong></p>\n<table>\n<thead>\n<tr>\n<th>å­—æ®µ</th>\n<th>ç±»å‹</th>\n<th>è¯´æ˜</th>\n</tr>\n</thead>\n<tbody><tr>\n<td>task_id</td>\n<td>bigint</td>\n<td>è‡ªå¢ä¸»é”®ID</td>\n</tr>\n<tr>\n<td>ctime</td>\n<td>bigint</td>\n<td>åˆ›å»ºæ—¶é—´</td>\n</tr>\n<tr>\n<td>utime</td>\n<td>bigint</td>\n<td>ä¿®æ”¹æ—¶é—´</td>\n</tr>\n<tr>\n<td>timer_id</td>\n<td>bigint</td>\n<td>å¯¹åº”çš„å®šæ—¶å™¨ID</td>\n</tr>\n<tr>\n<td>app</td>\n<td>varchar(128)</td>\n<td>ä¸šåŠ¡æ–¹æ ‡è¯†</td>\n</tr>\n<tr>\n<td>output</td>\n<td>var(1024)</td>\n<td>æ‰§è¡Œç»“æœ</td>\n</tr>\n<tr>\n<td>status</td>\n<td>tinyint</td>\n<td>ä»»åŠ¡çŠ¶æ€ï¼š0å¾…æ‰§è¡Œã€1æˆåŠŸã€2å¤±è´¥</td>\n</tr>\n<tr>\n<td>run_timer</td>\n<td>bigint</td>\n<td>å¼€å§‹è¿è¡Œæ—¶é—´</td>\n</tr>\n<tr>\n<td>cost_time</td>\n<td>bigint</td>\n<td>è¯¯å·®æ—¶é—´</td>\n</tr>\n</tbody></table>\n<p><strong>å•ä¸ªåˆ†ç‰‡ç»“æ„</strong>ï¼š</p>\n<p>Keyï¼šæ—¶é—´ + bucketç¼–å· &#x3D; â€œ2024121115:54:51_01â€</p>\n<p>Memberï¼štimerId + unixå½“å‰æ—¶é—´æˆ³</p>\n<p>Scoreï¼šunixå½“å‰æ—¶é—´æˆ³</p>\n<p>ä¸€ä¸ªå¯èƒ½çš„ä¼˜åŒ–ç‚¹ï¼š</p>\n<p>åœ¨ä»»åŠ¡çŠ¶æ€ä¸Šå»ºç«‹ç´¢å¼•  â€”â€“&gt;  å­˜åœ¨<strong>æ•°æ®å€¾æ–œ</strong></p>\n","excerpt":"","more":"<h1 id=\"å®šæ—¶å¾®æœåŠ¡\"><a href=\"#å®šæ—¶å¾®æœåŠ¡\" class=\"headerlink\" title=\"å®šæ—¶å¾®æœåŠ¡\"></a>å®šæ—¶å¾®æœåŠ¡</h1><h2 id=\"å‰ç½®å‡†å¤‡\"><a href=\"#å‰ç½®å‡†å¤‡\" class=\"headerlink\" title=\"å‰ç½®å‡†å¤‡\"></a>å‰ç½®å‡†å¤‡</h2><h3 id=\"èƒŒæ™¯å’Œç°çŠ¶\"><a href=\"#èƒŒæ™¯å’Œç°çŠ¶\" class=\"headerlink\" title=\"èƒŒæ™¯å’Œç°çŠ¶\"></a>èƒŒæ™¯å’Œç°çŠ¶</h3><p>å¸‚é¢ä¸Šå·²æœ‰çš„å®šæ—¶å¾®æœåŠ¡æŠ€æœ¯ï¼šJava Timerã€Rocket MQã€xxl-jobã€Quartzã€Robfig&#x2F;Cron</p>\n<ul>\n<li>å¾ˆå¤šå…¬å¸çš„ä¸šåŠ¡åªéœ€è¦ä¸€ä¸ªç®€å•çš„â€œå®šæ—¶â€åŠŸèƒ½ã€‚ä¸ºäº†æ»¡è¶³ä¸€ä¸ªç®€å•å®šæ—¶åŠŸèƒ½è€Œå¼•å…¥è¿‡äºå¼ºå¤§è€Œä¸”è‡ƒè‚¿çš„ä»»åŠ¡è°ƒåº¦ç»„ä»¶æ˜¯ä¸åˆé€‚çš„</li>\n<li>è®¾è®¡ä¸€ä¸ª<strong>åŠŸèƒ½èšç„¦ã€è½»é‡çº§ã€ç»´æŠ¤æˆæœ¬ä½</strong>çš„å®šæ—¶å¾®æœåŠ¡ç»„ä»¶æ˜¯å¾ˆæœ‰å¿…è¦çš„</li>\n</ul>\n<p><strong>å®šæ—¶å¾®æœåŠ¡LyyTimer</strong></p>\n<ol>\n<li>ä¾èµ–ç®€å•ï¼šåªéœ€è¦æä¾›MySQLã€Rediså’ŒKafkaç»„ä»¶çš„æ”¯æŒå³å¯ï¼Œæ¥å…¥å’Œç»´æŠ¤çš„æˆæœ¬ä½</li>\n<li>å­¦ä¹ æˆæœ¬ä½ï¼šæ•´ä¸ªå®šæ—¶å¾®æœåŠ¡åŠŸèƒ½èšç„¦ï¼Œå®¹æ˜“ä¸Šæ‰‹</li>\n<li>ç‰¹æ€§ä¼˜ï¼šLyyTimerå…·æœ‰é«˜ç²¾å‡†ã€é«˜è´Ÿè½½ã€å¼‚å¸¸å¤„ç†ç­‰ç‰¹æ€§ï¼Œèƒ½åŸºæœ¬æ»¡è¶³å¤§éƒ¨åˆ†çš„å®šæ—¶éœ€æ±‚</li>\n</ol>\n<h3 id=\"éš¾ç‚¹\"><a href=\"#éš¾ç‚¹\" class=\"headerlink\" title=\"éš¾ç‚¹\"></a>éš¾ç‚¹</h3><h4 id=\"é«˜ç²¾å‡†\"><a href=\"#é«˜ç²¾å‡†\" class=\"headerlink\" title=\"é«˜ç²¾å‡†\"></a><strong>é«˜ç²¾å‡†</strong></h4><p>ç›¸å¯¹äºå•ç‚¹å®šæ—¶ï¼ˆä¾‹å¦‚Java.Timerï¼‰åŸºæœ¬èƒ½åšåˆ°æ¯«ç§’çº§è§¦å‘ï¼Œå‡ ä¹æ‰€æœ‰å®šæ—¶ä»»åŠ¡æ¡†æ¶æˆ–è€…æ¶ˆæ¯é˜Ÿåˆ—ï¼Œéƒ½åªèƒ½ä¿è¯ç§’çº§åˆ«è¯¯å·®</p>\n<p>å¸¸è§å¯¼è‡´æ—¶é—´è¯¯å·®å¤§çš„åŸå› ï¼š</p>\n<ul>\n<li>å®šæ—¶è„šæœ¬è¿è¡Œè€—æ—¶</li>\n<li>ç­‰å¾…å®šæ—¶è„šæœ¬è¿è¡Œ</li>\n<li>æ¶ˆæ¯é˜Ÿåˆ—ä¸­æ¶ˆæ¯å †ç§¯</li>\n<li>åˆ†å¸ƒå¼å®šæ—¶å™¨å»¶æ—¶å—ç½‘ç»œå½±å“</li>\n<li>æ•°æ®åº“ä¸­æŸ¥æ‰¾ä»»åŠ¡æ•°æ®è€—æ—¶</li>\n<li>ç‰¹æ®Šæ—¶é—´æ®µä»»åŠ¡è¿‡å¤š</li>\n</ul>\n<h4 id=\"é«˜è´Ÿè½½\"><a href=\"#é«˜è´Ÿè½½\" class=\"headerlink\" title=\"é«˜è´Ÿè½½\"></a><strong>é«˜è´Ÿè½½</strong></h4><p>èƒ½å¤Ÿæ”¯æŒåŒæ—¶å¤„ç†å¤§é‡ä»»åŠ¡ï¼Œå¹¶ä¸”å°½å¯èƒ½å°‘çš„å †ç§¯ä»»åŠ¡</p>\n<p>é«˜è´Ÿè½½è§£å†³æ€è·¯å’Œæ–¹æ³•ï¼š</p>\n<ul>\n<li>åº”ç”¨å±‚æ–¹é¢å‡å°‘ä»»åŠ¡é‡ï¼Œé€‰æ‹©å°†åŒä¸€æ—¶åˆ»çš„å¤šä¸ªç‹¬ç«‹ä»»åŠ¡åˆå¹¶æˆä¸€ä¸ªâ€œè®¡åˆ’åˆ—è¡¨â€</li>\n<li>åˆ†åº“åˆ†è¡¨ï¼šå°†ä¸€ä¸ªå¤§å‹æ•°æ®åº“åˆ†æˆå¤šä¸ªè¾ƒå°çš„æ•°æ®åº“ï¼Œå¹¶å°†æ¯ä¸ªæ•°æ®åº“è¿›ä¸€æ­¥åˆ†æˆå¤šä¸ªè¾ƒå°çš„è¡¨ï¼Œæ¯ä¸ªè¡¨åªåŒ…å«éƒ¨åˆ†æ•°æ®<ul>\n<li>å‚ç›´åˆ†è¡¨ï¼šä¿æŒåˆ—å®Œæ•´</li>\n<li>æ°´å¹³åˆ†è¡¨ï¼šåªä¿ç•™éƒ¨åˆ†åˆ—</li>\n<li>åˆ†åº“åˆ†è¡¨ç»„åˆ</li>\n</ul>\n</li>\n<li>æ•°æ®åˆ†åŒºï¼šå°†å¤§æ•°æ®æ‹†åˆ†æˆå¤šä¸ªå°æ•°æ®åˆ†åŒºï¼Œå°†è¿™äº›å°åˆ†åŒºå­˜å‚¨åœ¨ä¸åŒçš„ç‰©ç†è®¾å¤‡æˆ–æœåŠ¡å™¨ä¸Šï¼Œæä¾›æ•°æ®çš„å­˜å–æ•ˆç‡å’Œå¤„ç†é€Ÿåº¦</li>\n<li>çº¿ç¨‹æ± æŠ€æœ¯<ul>\n<li>å¤ç”¨çº¿ç¨‹ï¼Œé™ä½äº†èµ„æºæ¶ˆè€—</li>\n<li>é«˜æ•ˆåœ°ç®¡ç†å¤šä¸ªçº¿ç¨‹</li>\n</ul>\n</li>\n</ul>\n<h4 id=\"ä»»åŠ¡å¼‚å¸¸å¤„ç†\"><a href=\"#ä»»åŠ¡å¼‚å¸¸å¤„ç†\" class=\"headerlink\" title=\"ä»»åŠ¡å¼‚å¸¸å¤„ç†\"></a><strong>ä»»åŠ¡å¼‚å¸¸å¤„ç†</strong></h4><blockquote>\n<p> å®šæ—¶ä»»åŠ¡éœ€æ±‚å¯ä»¥å…è®¸æœ‰ä¸€å®šçš„è¯¯å·®ï¼Œä½†æ˜¯ä¸èƒ½ä¸è§¦å‘</p>\n</blockquote>\n<p><strong>ä»»åŠ¡å¼‚å¸¸çš„åŸå› ï¼š</strong></p>\n<ul>\n<li><p>åˆ›å»ºï¼ˆæ¿€æ´»ï¼‰ä»»åŠ¡æ¥å£å¼‚å¸¸ï¼šåœ¨åˆ›å»ºä»»åŠ¡é˜¶æ®µå‘ç”Ÿå¼‚å¸¸ï¼Œç³»ç»Ÿå¯ä»¥ç›´æ¥å°†å¼‚å¸¸åŸå› è¿”å›ç»™ç”¨æˆ·ã€‚ç”¨æˆ·æ„ŸçŸ¥åˆ°å¼‚å¸¸åï¼Œå¯é€šè¿‡ä¸»åŠ¨é‡è¯•è§£å†³é—®é¢˜ï¼Œå³è¯¥é˜¶æ®µçš„å¼‚å¸¸ä¸åº”è¯¥ç”±æ¡†æ¶è§£å†³</p>\n</li>\n<li><p>ä»»åŠ¡æµè½¬å¼‚å¸¸ï¼šä¸€æ—¦ä»»åŠ¡æˆåŠŸå­˜å‚¨åœ¨æ•°æ®åº“ä¸­ï¼Œå°±è®¤ä¸ºè¯¥å®šæ—¶ä»»åŠ¡åˆ›å»ºæˆåŠŸï¼Œå¾®æœåŠ¡æ¡†æ¶å°±è¦è´Ÿè´£è¯¥ä»»åŠ¡åç»­çš„æµè½¬ï¼ˆæŸ¥è¯¢æ•°æ®åº“ã€å‘é€æ¶ˆæ¯é˜Ÿåˆ—ã€ç¼“å­˜ç­‰ï¼‰ã€‚å› æ­¤ï¼Œæ¡†æ¶éœ€è¦è§£å†³ä»»åŠ¡æµè½¬è¿‡ç¨‹ä¸­å‘ç”Ÿçš„å¼‚å¸¸</p>\n</li>\n<li><p>ä»»åŠ¡è§¦å‘é˜¶æ®µå¼‚å¸¸ï¼šå½“ä»»åŠ¡æ‰§è¡Œåï¼Œç³»ç»Ÿéœ€è¦å›è°ƒå‘ŠçŸ¥ä¸šåŠ¡æ–¹ä»»åŠ¡ç»“æœã€‚å¯¹äºä¸šåŠ¡æ–¹æ¥è¯´ï¼Œå¦‚æœå›è°ƒå¤±è´¥å¯¼è‡´ç»“æœä¸¢å¤±ï¼Œå°±ç›¸å½“äºè¯¥ä»»åŠ¡æ²¡æœ‰æ‰§è¡Œè¿‡</p>\n</li>\n</ul>\n<p><strong>å¸¸ç”¨çš„è§£å†³æ–¹æ¡ˆ</strong></p>\n<ul>\n<li><strong>ï¼ˆç«‹å³ï¼‰é‡è¯•æœºåˆ¶</strong>ï¼šå¯ä»¥åº”ä»˜ä¸€äº›å¶å‘æ€§å¼‚å¸¸ï¼Œä¾‹å¦‚æ•°æ®åº“æŠ–åŠ¨ã€RedisæŠ–åŠ¨</li>\n<li><strong>å¤±è´¥å…œåº•æœºåˆ¶</strong>ï¼šä¸€èˆ¬æ¥è¯´ï¼Œå…œåº•ç­–ç•¥éƒ½æ˜¯é‡‡ç”¨ä¸€äº›â€œæ— è„‘â€è„šæœ¬ï¼Œå…¨è¡¨æ‰«ææ•°æ®åº“ï¼Œé’ˆå¯¹å¤±è´¥è®°å½•è¿›è¡Œé‡è¯•æ“ä½œã€‚ä½†æ˜¯å…œåº•ç­–ç•¥ä¸€èˆ¬åœ¨æ€§èƒ½ä¸Šä¸å ä¼˜åŠ¿ï¼Œæ‰€ä»¥éœ€è¦é€‰æ‹©åˆé€‚çš„æ—¶é—´é—´éš”æ‰§è¡Œå…œåº•è„šæœ¬</li>\n<li><strong>å¤±è´¥æŠ¥è­¦æœºåˆ¶</strong>ï¼šå½“çŸ­æ—¶é—´å†…æœ‰å¤§é‡ä»»åŠ¡å¤±è´¥æ—¶ï¼Œéœ€è¦åŠæ—¶æŠ¥è­¦</li>\n<li><strong>äººå·¥å¹²é¢„</strong></li>\n</ul>\n<h2 id=\"æ¶æ„è®¾è®¡\"><a href=\"#æ¶æ„è®¾è®¡\" class=\"headerlink\" title=\"æ¶æ„è®¾è®¡\"></a>æ¶æ„è®¾è®¡</h2><h3 id=\"å®ç°æ€è·¯\"><a href=\"#å®ç°æ€è·¯\" class=\"headerlink\" title=\"å®ç°æ€è·¯\"></a>å®ç°æ€è·¯</h3><p><strong>å®šæ—¶å™¨æœ¬è´¨å®ç°æ€è·¯ï¼šæŸ¥è¯¢ + è§¦å‘</strong>ï¼Œä»¥åŠæš´éœ²ç»™ç”¨æˆ·ä¸€ä¸ª<strong>æ³¨å†Œä»»åŠ¡</strong>æ¥å£</p>\n<ul>\n<li><strong>æ³¨å†Œ</strong>å®šæ—¶å™¨ï¼šæ¥å—ç”¨æˆ·çš„åˆ›å»ºè¯·æ±‚ï¼Œæ˜ç¡®æ¯ä¸€ä¸ªä»»åŠ¡çš„<strong>æ‰§è¡Œæ—¶é—´</strong></li>\n<li><strong>æŸ¥è¯¢</strong>æ•°æ®åº“ï¼šæ¯éš”ä¸€æ®µæ—¶é—´é—´éš”å°±<strong>æŸ¥è¯¢</strong>ä»»åŠ¡åˆ—è¡¨ï¼Œç­›é€‰å‡ºæœªè§¦å‘çš„ä»»åŠ¡</li>\n<li><strong>è§¦å‘</strong>ä»»åŠ¡ï¼šè§¦å‘<strong>æ‰§è¡Œæ—¶é—´å°äºå½“å‰æ—¶é—´ï¼ˆæ—¶åˆ»ï¼‰</strong>çš„ä»»åŠ¡</li>\n</ul>\n<h4 id=\"å­˜å‚¨ç»“æ„ä¼˜åŒ–ï¼šæœ‰åºè¡¨\"><a href=\"#å­˜å‚¨ç»“æ„ä¼˜åŒ–ï¼šæœ‰åºè¡¨\" class=\"headerlink\" title=\"å­˜å‚¨ç»“æ„ä¼˜åŒ–ï¼šæœ‰åºè¡¨\"></a>å­˜å‚¨ç»“æ„ä¼˜åŒ–ï¼šæœ‰åºè¡¨</h4><p><strong>åŸºäºæœ‰åºæ•°æ®ç»“æ„ï¼ŒåŠ å¿«æ•°æ®æŸ¥è¯¢</strong></p>\n<p>å¸¸è§çš„æœ‰åºæ•°æ®ç»“æ„ï¼šçº¢é»‘æ ‘ã€è·³è¡¨ã€å¹³è¡¡æ ‘ç­‰ï¼Œè¿™äº›æ•°æ®ç»“æ„é€šè¿‡åœ¨æ’å…¥æ“ä½œå‡æ‘ŠæŸ¥è¯¢æ“ä½œçš„æ—¶é—´å¤æ‚åº¦å®ç°**æŸ¥è¯¢æ—¶é—´å¤æ‚åº¦$$O(N) â€”&gt; O(logN)$$**çš„ä¼˜åŒ–</p>\n<h4 id=\"å­˜å‚¨ç»“æ„ä¼˜åŒ–ï¼šæ¨ªå‘åˆ‡ç‰‡\"><a href=\"#å­˜å‚¨ç»“æ„ä¼˜åŒ–ï¼šæ¨ªå‘åˆ‡ç‰‡\" class=\"headerlink\" title=\"å­˜å‚¨ç»“æ„ä¼˜åŒ–ï¼šæ¨ªå‘åˆ‡ç‰‡\"></a>å­˜å‚¨ç»“æ„ä¼˜åŒ–ï¼šæ¨ªå‘åˆ‡ç‰‡</h4><p><strong>æ ¹æ®æ—¶é—´åŒºé—´å¯¹æ•°æ®åˆ†ç‰‡ï¼Œå‡å°‘æŸ¥è¯¢æ—¶æ¶‰åŠçš„æ•°æ®æ•°é‡</strong></p>\n<p>æ¯æ¬¡æŸ¥è¯¢æ•°æ®çš„æ—¶å€™ï¼ŒçœŸæ­£çš„ç›®æ ‡æ˜¯<strong>å³å°†æ‰§è¡Œ</strong>çš„ä»»åŠ¡ï¼Œè€Œ<strong>ç¨åæ‰§è¡Œ</strong>çš„ä»»åŠ¡å±äºæ— å…³ä»»åŠ¡ã€‚åŸºäºè¿™ä¸ªç†å¿µï¼Œæˆ‘ä»¬å¯ä»¥å°†æ•°æ®è¿›è¡Œæ¨ªå‘åˆ‡åˆ†ï¼Œä¾‹å¦‚æ¯ä¸€åˆ†é’Ÿåˆ’åˆ†ä¸€ä¸ªæ•°æ®åˆ‡ç‰‡ï¼Œç„¶åä»åŒ…å«ç›®æ ‡æ•°æ®çš„æ•°æ®åˆ‡ç‰‡ä¸­æŸ¥è¯¢æ•°æ®</p>\n<p>è¿™ç§åšæ³•å¯ä»¥å°†å¤§å¤§é™ä½æ¯ä¸€æ¬¡æŸ¥è¯¢çš„ä»»åŠ¡æ•°é‡çº§ï¼šN â€”&gt; Nâ€™ï¼Œå…¶ä¸­Nâ€™ &lt;&lt; Nï¼Œå³ä½¿æ²¡æœ‰æ”¹å˜æŸ¥è¯¢çš„æ—¶é—´å¤æ‚åº¦ï¼Œä½†å‡å°‘äº†æŸ¥è¯¢æ—¶æ¶‰åŠçš„æ•°æ®æ•°é‡</p>\n<h4 id=\"å­˜å‚¨ç»“æ„ä¼˜åŒ–ï¼šçºµå‘åˆ‡ç‰‡\"><a href=\"#å­˜å‚¨ç»“æ„ä¼˜åŒ–ï¼šçºµå‘åˆ‡ç‰‡\" class=\"headerlink\" title=\"å­˜å‚¨ç»“æ„ä¼˜åŒ–ï¼šçºµå‘åˆ‡ç‰‡\"></a>å­˜å‚¨ç»“æ„ä¼˜åŒ–ï¼šçºµå‘åˆ‡ç‰‡</h4><p><strong>å¯¹æ•°æ®åˆ†åŒºè¿›è¡Œåˆ†æ¡¶ï¼Œæé«˜æ•°æ®æ“ä½œçš„å¹¶å‘åº¦</strong></p>\n<p>æˆªæ­¢åˆ°ä¸Šä¸€æ­¥ï¼Œæ—¶é—´æ•°æ®åˆ†åŒºæ˜¯å®šæ—¶å™¨ä¸­çš„æœ€å°èµ„æºå•ä½ï¼Œæ¯ä¸€ä¸ªæ•°æ®åˆ†åŒºéƒ½ç”±ä¸€ä¸ªgoroutineï¼ˆæˆ–çº¿ç¨‹ï¼‰æ§åˆ¶ã€‚ä¸ºäº†æé«˜æ•°æ®æ“ä½œçš„å¹¶å‘åº¦ï¼Œå¯ä»¥å¯¹åˆ†åŒºä¸­çš„æ•°æ®è¿›ä¸€æ­¥<strong>åˆ†æ¡¶</strong>ï¼ŒæŠŠæ¯ä¸€ä¸ªæ¡¶äº¤ä»˜ç»™ä¸€ä¸ªgoroutineï¼ˆæˆ–çº¿ç¨‹ï¼‰å¤„ç†ï¼Œåœ¨çºµå‘å¢åŠ åˆ†æ¡¶çš„ç»´åº¦ï¼Œæé«˜å¹¶å‘åº¦</p>\n<blockquote>\n<p>æ€»ç»“ï¼šä¾ç„¶æ˜¯â€œæŸ¥è¯¢ + è§¦å‘â€çš„å®šæ—¶å™¨æœºåˆ¶ï¼Œåªä¸è¿‡ç›¸è¾ƒäºä¸ç‰ˆå®šæ—¶å™¨æœ‰å¦‚ä¸‹å˜åŒ–ï¼šæ¯æ¬¡æŸ¥è¯¢éƒ½åªæŸ¥è¯¢ä¸€ä¸ªï¼ˆå½“å‰ï¼‰æ—¶é—´èŒƒå›´å†…çš„æ•°æ®ï¼Œè¿™äº›æ•°æ®ç”±ZSetæ•°æ®ç»“æ„å­˜å‚¨ã€‚æ¥ç€åŸºäºå¹¶å‘çš„è€ƒè™‘ï¼Œä»¤å¤šä¸ªgoroutineè´Ÿè´£ä»åˆ†åŒºä¸­çš„å¤šä¸ªæ¡¶ä¸­æŸ¥è¯¢æ•°æ®ï¼Œæœ€åå°†è§¦å‘è·å–åˆ°çš„ä»»åŠ¡ã€‚</p>\n</blockquote>\n<h3 id=\"æ•´ä½“æ¶æ„\"><a href=\"#æ•´ä½“æ¶æ„\" class=\"headerlink\" title=\"æ•´ä½“æ¶æ„\"></a>æ•´ä½“æ¶æ„</h3><h4 id=\"å®šæ—¶ä»»åŠ¡è°ƒåº¦æµç¨‹\"><a href=\"#å®šæ—¶ä»»åŠ¡è°ƒåº¦æµç¨‹\" class=\"headerlink\" title=\"å®šæ—¶ä»»åŠ¡è°ƒåº¦æµç¨‹\"></a>å®šæ—¶ä»»åŠ¡è°ƒåº¦æµç¨‹</h4><p>ä»»åŠ¡è°ƒåº¦æµç¨‹<strong>æœåŠ¡æ¶æ„ï¼šä¸‰ä¸ªæ¨¡å— + ä¸¤ä¸ªåç¨‹æ± </strong></p>\n<p>LyyTimeræ˜¯ä¸€ä¸ª<strong>å»ä¸­å¿ƒåŒ–çš„å®šæ—¶ä»»åŠ¡è°ƒåº¦æ¡†æ¶</strong>ï¼Œå®šæ—¶ä»»åŠ¡è°ƒåº¦æœåŠ¡æ ¹æ®èŒè´£è¾¹ç•Œå¯ä»¥å°†æœåŠ¡æ‹†åˆ†ä¸ºï¼š<strong>è°ƒåº¦å™¨æ¨¡å—</strong>ã€<strong>è§¦å‘å™¨æ¨¡å—</strong>ã€<strong>æ‰§è¡Œæ¨¡å—</strong>ï¼Œè¿™ä¸‰ä¸ªæ¨¡å—å­˜åœ¨ç€ä¾èµ–å…³ç³»ã€‚çˆ¶æ¨¡å—é€šè¿‡åç¨‹æ± å¼‚æ­¥å¯åŠ¨å­æ¨¡å—æ‰§è¡Œç›¸åº”å·¥ä½œ</p>\n<p><img src=\"https://raw.githubusercontent.com/lyydsheep/pic/main/202411251841204.png\" alt=\"image-20241125183915443\"></p>\n<h4 id=\"å®šæ—¶ä»»åŠ¡ç”Ÿæˆæµç¨‹\"><a href=\"#å®šæ—¶ä»»åŠ¡ç”Ÿæˆæµç¨‹\" class=\"headerlink\" title=\"å®šæ—¶ä»»åŠ¡ç”Ÿæˆæµç¨‹\"></a>å®šæ—¶ä»»åŠ¡ç”Ÿæˆæµç¨‹</h4><p><strong>å®šæ—¶ä»»åŠ¡çš„åˆ›å»ºè®¾è®¡åˆ°Web Serverå’ŒMigrator Schedulerä¸¤ä¸ªæ¨¡å—</strong></p>\n<ul>\n<li>ç”¨æˆ·é€šè¿‡Web Serveræä¾›çš„APIåˆ›å»ºå®šæ—¶ä»»åŠ¡</li>\n<li>Migrator Schedulerå®šæ—¶æ ¹æ®cronè¡¨è¾¾å¼é¢„çƒ­å®šæ—¶ä»»åŠ¡æ•°æ®</li>\n</ul>\n<p><img src=\"https://raw.githubusercontent.com/lyydsheep/pic/main/202411251851062.png\" alt=\"image-20241125185145008\"></p>\n<blockquote>\n<p>ä¸ºä»€ä¹ˆéœ€è¦ä¸¤ç§æ–¹å¼é¢„çƒ­æ•°æ®ï¼Ÿ</p>\n<p>ä¸ºäº†ç¡®ä¿åœ¨å®šæ—¶è„šæœ¬æ‰§è¡Œé—´éš”å†…åˆ›å»ºçš„ä»»åŠ¡ç”Ÿæ•ˆã€‚ä¾‹å¦‚ï¼Œå®šæ—¶è„šæœ¬æ¯ä¸¤å°æ—¶æ‰§è¡Œä¸€æ¬¡ï¼Œæ¯ä¸€æ¬¡æ‰§è¡Œéƒ½ä¼šé¢„çƒ­ä¸¤å°æ—¶åçš„æ•°æ®ã€‚ç¬¬ä¸€æ¬¡å®šæ—¶è„šæœ¬æ‰§è¡Œæ—¶åˆ»æ˜¯18:58ï¼Œåˆ›å»ºäº†18:58-20:58å®šæ—¶ä»»åŠ¡ã€‚å€˜è‹¥æœ‰ç”¨æˆ·åœ¨19:00æƒ³è¦åˆ›å»ºä¸€ä¸ª19:58åˆ†çš„å®šæ—¶ä»»åŠ¡ï¼Œé‚£ä¹ˆåªä¾é å®šæ—¶è„šæœ¬æ˜¯æ— æ³•å®ç°çš„ï¼Œå› ä¸ºä¸‹ä¸€æ¬¡å®šæ—¶è„šæœ¬çš„æ‰§è¡Œæ—¶é—´æ˜¯20:58ã€‚ç»¼ä¸Šæ‰€è¯‰ï¼Œä»…ä»…æœ‰å®šæ—¶è„šæœ¬æ˜¯æœ‰ç¼ºé™·çš„ï¼Œè¿˜éœ€è¦ä¸€ä¸ªWeb Serveræ¨¡å—å®Œæˆä»»åŠ¡çš„ç¬¬ä¸€æ¬¡åˆ›å»ºï¼Œç¡®ä¿ç”¨æˆ·åœ¨ä»»ä½•æ—¶å€™åˆ›å»ºçš„ä»»åŠ¡éƒ½èƒ½ç”Ÿæ•ˆã€‚</p>\n</blockquote>\n<h3 id=\"è°ƒåº¦æµç¨‹æ¨¡å—åŒ–\"><a href=\"#è°ƒåº¦æµç¨‹æ¨¡å—åŒ–\" class=\"headerlink\" title=\"è°ƒåº¦æµç¨‹æ¨¡å—åŒ–\"></a>è°ƒåº¦æµç¨‹æ¨¡å—åŒ–</h3><h4 id=\"è°ƒåº¦å™¨æ¨¡å—\"><a href=\"#è°ƒåº¦å™¨æ¨¡å—\" class=\"headerlink\" title=\"è°ƒåº¦å™¨æ¨¡å—\"></a>è°ƒåº¦å™¨æ¨¡å—</h4><p><strong>ç¡®å®šäºŒç»´æ•°æ®åˆ†åŒºç›®æ ‡å¯¹è±¡ï¼Œç»Ÿç­¹åˆ†é…è§¦å‘å™¨</strong></p>\n<p>è°ƒåº¦å™¨çš„ä½œç”¨å°±æ˜¯è¦ç¡®ä¿åœ¨åˆ†å¸ƒå¼åœºæ™¯ä¸‹ï¼Œæ¯ä¸€ä¸ªäºŒç»´æ•°æ®åˆ†åŒºéƒ½èƒ½è¢«ä¸€ä¸ªè§¦å‘å™¨è´Ÿè´£å¤„ç†ï¼Œæ—¢ä¸èƒ½é—æ¼ï¼Œä¹Ÿä¸èƒ½é‡å¤</p>\n<ul>\n<li>è°ƒåº¦å™¨åŸºäºtime tickeræ¯ç§’é’Ÿè¿›è¡Œä¸€æ¬¡å·¥ä½œï¼Œæ ¹æ®å½“å‰æ—¶åˆ»æ¨ç®—å‡º<strong>åˆ†é’Ÿçº§åˆ«</strong>çš„å­—ç¬¦ä¸²è¡¨è¾¾å¼</li>\n<li>æ ¹æ®é…ç½®ä¸­æœ€å¤§æ¡¶æ•°é‡ï¼Œä¾æ¬¡æ‹¼æ¥åˆ†é’ŸKeyå€¼å¾—åˆ°è‹¥å¹²ä¸ªäºŒç»´æ•°æ®åˆ†åŒºçš„Keyå€¼ã€‚ä¾‹å¦‚<code>20:47:39_0</code>ã€<code>20:48:11_1</code></li>\n<li>å°è¯•æŠ¢å æ•°æ®åˆ†åŒºçš„åˆ†å¸ƒå¼é”ï¼Œå¹¶æŠŠé”çš„è¿‡æœŸæ—¶é—´è®¾ç½®ä¸º<strong>å¤§äº1å€åˆ†ç‰‡æ—¶é—´ï¼Œå°äº2å€åˆ†ç‰‡æ—¶é—´</strong></li>\n<li>å¦‚æœæŠ¢é”æˆåŠŸï¼Œå°±è°ƒåº¦ä¸€ä¸ªè§¦å‘å™¨è¿›è¡Œä½œä¸š</li>\n</ul>\n<h4 id=\"è§¦å‘å™¨æ¨¡å—\"><a href=\"#è§¦å‘å™¨æ¨¡å—\" class=\"headerlink\" title=\"è§¦å‘å™¨æ¨¡å—\"></a>è§¦å‘å™¨æ¨¡å—</h4><p><strong>æŒ‰æ—¶å”¤é†’äºŒç»´æ•°æ®åˆ†åŒºä¸­çš„å®šæ—¶ä»»åŠ¡</strong></p>\n<ul>\n<li>è§¦å‘å™¨è¢«åˆ›å»ºåï¼Œæ¯ç§’å¯¹è´Ÿè´£çš„æ•°æ®åˆ†åŒºè¿›è¡Œæ‰«æï¼Œä»¥å½“å‰æ—¶åˆ»ä¸ºåŸºå‡†ï¼Œå°†ç¬¦åˆæ¡ä»¶çš„å®šæ—¶ä»»åŠ¡å–å‡ºå¹¶äº¤ä»˜ç»™æ‰§è¡Œå™¨æ‰§è¡Œ</li>\n<li>å½“è§¦å‘å™¨åç¨‹å®Œæˆä»»åŠ¡åï¼Œéœ€è¦å°†åˆ†å¸ƒå¼é”çš„è¿‡æœŸæ—¶é—´å»¶æœŸè‡³<strong>å¤§äºä¸¤ä¸ªåˆ†åŒºæ—¶é—´</strong></li>\n</ul>\n<blockquote>\n<p>ä¸ºä»€ä¹ˆè¦å¯¹åˆ†å¸ƒå¼é”è¿›è¡Œå»¶æœŸï¼Ÿ</p>\n<p>å›ç­”è¿™ä¸ªé—®é¢˜ä¹‹å‰ï¼Œéœ€è¦è¡¥å……çš„ä¸€ç‚¹ï¼šä¸ºäº†å¯¹å‰ä¸€åˆ†é’Ÿçš„æ•°æ®åˆ†åŒºæ‰§è¡Œå¤±è´¥åšå…œåº•ï¼Œæ¯æ¬¡è§¦å‘å™¨å¯¹å½“å‰åˆ†åŒºè¿›è¡Œæ‰«ææ—¶éƒ½ä¼šå¯¹å‰ä¸€åˆ†é’Ÿçš„æ•°æ®åˆ†åŒºè¿›è¡Œé‡è¯•æ‰«æã€‚</p>\n<p>å› æ­¤ï¼Œå¦‚æœå‰ä¸€ä¸ªæ•°æ®åˆ†åŒºçš„ä»»åŠ¡æ‰§è¡Œå¤±è´¥ï¼Œé‚£ä¹ˆè¯¥åˆ†åŒºçš„åˆ†å¸ƒå¼é”æ— æ³•å¾—åˆ°å»¶æ—¶ï¼Œå¿…ç„¶ä¼šåœ¨å½“å‰åˆ†é’Ÿå†…å†æ¬¡è·å¾—è¿›è€Œè¿›è¡Œé‡è¯•æ“ä½œã€‚åä¹‹ï¼Œåˆ†å¸ƒå¼é”å¾—åˆ°äº†å»¶æ—¶ï¼Œé‚£ä¹ˆå½“å‰åˆ†é’Ÿå†…å°±ä¸ä¼šé‡å¤æ‰§è¡Œå·²æˆåŠŸæ‰§è¡Œçš„ä»»åŠ¡ã€‚</p>\n<p>ä¹Ÿæ­£æ˜¯å‡ºäºè¿™ä¸ªæœºåˆ¶è€ƒè™‘ï¼Œå»¶è¿Ÿçš„æ—¶é—´å¿…é¡»å¤§äºä¸¤ä¸ªåˆ†åŒºæ—¶é—´</p>\n</blockquote>\n<p>é—®é¢˜åœ¨äºå¾ˆéš¾å®ç°ç™¾åˆ†ç™¾çš„åˆ†å¸ƒå¼äº‹åŠ¡ï¼Œå³æ— æ³•ä¿è¯<strong>å®Œæˆåˆ†åŒºä»»åŠ¡ + å»¶è¿Ÿåˆ†å¸ƒå¼é”</strong>æ“ä½œæ˜¯åŸå­çš„ï¼Œå› æ­¤è¿™é‡Œåªèƒ½æ˜¯<strong>At least once</strong>è¯­ä¹‰ã€‚</p>\n<h4 id=\"æ‰§è¡Œå™¨æ¨¡å—\"><a href=\"#æ‰§è¡Œå™¨æ¨¡å—\" class=\"headerlink\" title=\"æ‰§è¡Œå™¨æ¨¡å—\"></a>æ‰§è¡Œå™¨æ¨¡å—</h4><p><strong>æ‰§è¡Œå®šæ—¶ä»»åŠ¡</strong></p>\n<ul>\n<li>ä¸€ä¸ªæ‰§è¡Œå™¨ç”±è§¦å‘å™¨è°ƒåº¦ï¼Œå¯¹åº”ä¸€ä¸ªå…·ä½“çš„å®šæ—¶ä»»åŠ¡</li>\n<li>æ‰§è¡Œå™¨é¦–å…ˆå¯¹å®šæ—¶ä»»åŠ¡è¿›è¡Œå¹‚ç­‰æ£€æŸ¥</li>\n<li>æ‰§è¡Œä»»åŠ¡</li>\n<li>æ›´æ–°å®šæ—¶ä»»åŠ¡çš„çŠ¶æ€</li>\n</ul>\n<h3 id=\"ä»»åŠ¡è¿ç§»æ¨¡å—åŒ–\"><a href=\"#ä»»åŠ¡è¿ç§»æ¨¡å—åŒ–\" class=\"headerlink\" title=\"ä»»åŠ¡è¿ç§»æ¨¡å—åŒ–\"></a>ä»»åŠ¡è¿ç§»æ¨¡å—åŒ–</h3><p>LyyTimeré¡¹ç›®ä½¿ç”¨MySQL + RedisäºŒçº§å­˜å‚¨æ¨¡å‹ï¼Œå¹¶è®¾ç½®äº†ä¸€ä¸ªMigratoræ ¹æ®æ—¶é—´ç”±è¿‘åŠè¿œ<strong>é€šè¿‡å¤„äºæ¿€æ´»çŠ¶æ€çš„å®šæ—¶å™¨ï¼ˆcronè¡¨è¾¾å¼ï¼‰ç”Ÿæˆä¸€ç³»åˆ—å®šæ—¶ä»»åŠ¡</strong>ï¼Œå¹¶è¿ç§»åŒæ­¥è‡³ä¸¤ä¸ªå­˜å‚¨ä»‹è´¨ä¸­</p>\n<h4 id=\"Migratoræ¨¡å—\"><a href=\"#Migratoræ¨¡å—\" class=\"headerlink\" title=\"Migratoræ¨¡å—\"></a>Migratoræ¨¡å—</h4><ul>\n<li>æ¯éš”ä¸€æ®µæ—¶é—´æ­¥é•¿å°±æ‰«ææ‰€æœ‰çš„å®šæ—¶å™¨ï¼Œæ ¹æ®å¤„äºæ¿€æ´»çŠ¶æ€çš„å®šæ—¶å™¨ç”Ÿæˆæœªæ¥ä¸¤ä¸ªæ—¶é—´æ­¥é•¿çš„å®šæ—¶ä»»åŠ¡ï¼ˆæœ¬è´¨ä¸Šå°±ä¸€ä¸ªæ—¶é—´æ­¥é•¿ï¼Œéƒ½æ˜¯ä¸ºäº†å¤±è´¥å…œåº•ğŸ˜‚ï¼‰<ul>\n<li>ä¾‹å¦‚ï¼Œæ¯éš”ä¸€å°æ—¶å°±è¿›è¡Œä¸€æ¬¡å…¨è¡¨æ‰«æï¼Œè‹¥14:45:34å¯¹æ‰€æœ‰çš„å®šæ—¶å™¨è¿›è¡Œä¸€æ¬¡æ‰«æï¼Œè¿ç§»æ¨¡å—å°±ä¼šç”Ÿæˆ14:45:34 - 16:45:34è¿™ä¸¤ä¸ªå°æ—¶çš„å®šæ—¶ä»»åŠ¡å¹¶è¿ç§»è‡³MySQLå’ŒRedisä¸­ã€‚ä½†14:45:34 - 15:45:34è¿™ä¸ªæ—¶é—´æ®µçš„ä»»åŠ¡å·²ç»åœ¨13:45:34è¢«Migratoræ¨¡å—ç”Ÿæˆå¹¶å­˜å‚¨äº†ï¼Œæ‰€ä»¥æœ¬è´¨ä¸Šè¿ç§»æ¨¡å—åªç”Ÿæˆäº†ä¸€å°æ—¶çš„ä»»åŠ¡ã€‚é‡å¤çš„ä»»åŠ¡å°†ä¼šç”±äºå”¯ä¸€çº¦æŸè€Œæ’å…¥å¤±è´¥ï¼Œæ‰€ä»¥ä¸å¿…æ‹…å¿ƒä»»åŠ¡é‡å¤æ’å…¥</li>\n</ul>\n</li>\n</ul>\n<h5 id=\"ä¸²è¡Œæ‰“ç‚¹è¿˜æ˜¯æ‰¹é‡æ‰“ç‚¹ï¼Ÿ\"><a href=\"#ä¸²è¡Œæ‰“ç‚¹è¿˜æ˜¯æ‰¹é‡æ‰“ç‚¹ï¼Ÿ\" class=\"headerlink\" title=\"ä¸²è¡Œæ‰“ç‚¹è¿˜æ˜¯æ‰¹é‡æ‰“ç‚¹ï¼Ÿ\"></a>ä¸²è¡Œæ‰“ç‚¹è¿˜æ˜¯æ‰¹é‡æ‰“ç‚¹ï¼Ÿ</h5><p>ä¸²è¡Œæ‰“ç‚¹å°±æ˜¯æŒ‡æ¯æ¬¡æ ¹æ®cronè¡¨è¾¾å¼<strong>åªç”Ÿæˆæœ€è¿‘çš„ä¸€æ¬¡</strong>å®šæ—¶ä»»åŠ¡ï¼Œç„¶ååœ¨æ‰§è¡Œå™¨æ‰§è¡Œå®Œè¿™ä¸ªä»»åŠ¡åå°±ç«‹é©¬ç”Ÿæˆä¸‹ä¸€æ¬¡çš„å®šæ—¶ä»»åŠ¡ï¼Œå¦‚æ­¤å¾ªç¯ã€‚</p>\n<p>ä¸²è¡Œæ‰“ç‚¹æ¯”è¾ƒèŠ‚çº¦èµ„æºï¼Œå¯ä»¥ç¼“è§£ç”Ÿæˆä»»åŠ¡è¿‡å¤šå¯¼è‡´çš„çŸ­æ—¶é—´å†…èµ„æºæµªè´¹é—®é¢˜ï¼Œä½†æ˜¯é’ˆå¯¹äºçŸ­é—´éš”é«˜é¢‘æ‰§è¡Œçš„å®šæ—¶å™¨ï¼ˆä¾‹å¦‚ï¼š1sæ‰§è¡Œä¸€æ¬¡ï¼‰å°±æœ‰äº›åŠ›ä¸ä»å¿ƒäº†ã€‚</p>\n<p><strong>ä¼˜åŒ–æ–¹æ¡ˆï¼šæ‰¹é‡æ‰“ç‚¹</strong></p>\n<p>æ¯éš”ä¸€æ®µæ—¶é—´ç¨‹åºå°±æ ¹æ®cronè¡¨è¾¾å¼ç”Ÿæˆä¸€ä¸ªæ—¶é—´æ­¥é•¿çš„ä»»åŠ¡ï¼Œè¿™æ ·å¯ä»¥æœ‰æ•ˆè§£å†³çŸ­é—´éš”é«˜é¢‘ç‡çš„ä»»åŠ¡ç”Ÿæˆé—®é¢˜ã€‚ä½†å¦‚æœç”¨æˆ·å¯¹å®šæ—¶å™¨è¿›è¡Œé¢‘ç¹çš„ä¿®æ”¹ï¼Œé‚£ä¸ºäº†ä¿è¯æ•°æ®ä¸€è‡´æ€§ï¼Œå°±éœ€è¦å¼•å…¥åˆ é™¤ã€ä¿®æ”¹å·²ç”Ÿæˆä»»åŠ¡ç­‰å¤æ‚æ“ä½œã€‚ä¸ºäº†è§„é¿è¿™ç§æƒ…å†µï¼Œæˆ‘ä»¬å¯ä»¥è¦æ±‚ç”¨æˆ·æ— æ³•å¯¹å·²æœ‰çš„å®šæ—¶å™¨è¿›è¡Œä¿®æ”¹ï¼Œåªå…è®¸<strong>æ¿€æ´»</strong>å’Œ<strong>å»æ¿€æ´»</strong>ä¸¤ç§æ“ä½œ</p>\n<p>æ­¤å¤–ï¼Œå³ä½¿ç”¨æˆ·<strong>å»æ¿€æ´»</strong>æŸä¸€ä¸ªå®šæ—¶å™¨ï¼Œæˆ‘ä»¬ä¹Ÿæ— éœ€ä¿®æ”¹å·²æœ‰çš„ä»»åŠ¡ï¼Œåªéœ€è¦åœ¨å›è°ƒä¹‹å‰æ£€æŸ¥å®šæ—¶å™¨çŠ¶æ€æ˜¯å¦åˆæ³•å³å¯ã€‚</p>\n<h2 id=\"å­˜å‚¨ç»“æ„è®¾è®¡\"><a href=\"#å­˜å‚¨ç»“æ„è®¾è®¡\" class=\"headerlink\" title=\"å­˜å‚¨ç»“æ„è®¾è®¡\"></a>å­˜å‚¨ç»“æ„è®¾è®¡</h2><p><strong>å®šæ—¶å™¨è¡¨</strong></p>\n<table>\n<thead>\n<tr>\n<th>å­—æ®µ</th>\n<th>ç±»å‹</th>\n<th>è¯´æ˜</th>\n</tr>\n</thead>\n<tbody><tr>\n<td>timer_id</td>\n<td>bigint</td>\n<td>è‡ªå¢ä¸»é”®IDï¼ˆæˆ–æœ‰åºUUIDï¼‰</td>\n</tr>\n<tr>\n<td>ctime</td>\n<td>bigint</td>\n<td>åˆ›å»ºæ—¶é—´ï¼ˆé¿å…æ—¶åŒºé—®é¢˜ï¼‰</td>\n</tr>\n<tr>\n<td>utime</td>\n<td>bigint</td>\n<td>ä¿®æ”¹æ—¶é—´</td>\n</tr>\n<tr>\n<td>app</td>\n<td>varchar(128)</td>\n<td>ä¸šåŠ¡æ–¹æ ‡è¯†</td>\n</tr>\n<tr>\n<td>name</td>\n<td>varchar(256)</td>\n<td>ä»»åŠ¡å</td>\n</tr>\n<tr>\n<td>status</td>\n<td>tinyint</td>\n<td>ä»»åŠ¡çŠ¶æ€ï¼š0æ–°å»ºã€1æ¿€æ´»ã€2æœªæ¿€æ´»</td>\n</tr>\n<tr>\n<td>cron</td>\n<td>varchar(256)</td>\n<td>cronè¡¨è¾¾å¼ï¼Œç”¨äºç”Ÿæˆå®šæ—¶ä»»åŠ¡</td>\n</tr>\n<tr>\n<td>notify_http_param</td>\n<td>varchar(8192)</td>\n<td>å›è°ƒä¸Šä¸‹æ–‡</td>\n</tr>\n</tbody></table>\n<p><strong>å®šæ—¶ä»»åŠ¡è¡¨</strong></p>\n<table>\n<thead>\n<tr>\n<th>å­—æ®µ</th>\n<th>ç±»å‹</th>\n<th>è¯´æ˜</th>\n</tr>\n</thead>\n<tbody><tr>\n<td>task_id</td>\n<td>bigint</td>\n<td>è‡ªå¢ä¸»é”®ID</td>\n</tr>\n<tr>\n<td>ctime</td>\n<td>bigint</td>\n<td>åˆ›å»ºæ—¶é—´</td>\n</tr>\n<tr>\n<td>utime</td>\n<td>bigint</td>\n<td>ä¿®æ”¹æ—¶é—´</td>\n</tr>\n<tr>\n<td>timer_id</td>\n<td>bigint</td>\n<td>å¯¹åº”çš„å®šæ—¶å™¨ID</td>\n</tr>\n<tr>\n<td>app</td>\n<td>varchar(128)</td>\n<td>ä¸šåŠ¡æ–¹æ ‡è¯†</td>\n</tr>\n<tr>\n<td>output</td>\n<td>var(1024)</td>\n<td>æ‰§è¡Œç»“æœ</td>\n</tr>\n<tr>\n<td>status</td>\n<td>tinyint</td>\n<td>ä»»åŠ¡çŠ¶æ€ï¼š0å¾…æ‰§è¡Œã€1æˆåŠŸã€2å¤±è´¥</td>\n</tr>\n<tr>\n<td>run_timer</td>\n<td>bigint</td>\n<td>å¼€å§‹è¿è¡Œæ—¶é—´</td>\n</tr>\n<tr>\n<td>cost_time</td>\n<td>bigint</td>\n<td>è¯¯å·®æ—¶é—´</td>\n</tr>\n</tbody></table>\n<p><strong>å•ä¸ªåˆ†ç‰‡ç»“æ„</strong>ï¼š</p>\n<p>Keyï¼šæ—¶é—´ + bucketç¼–å· &#x3D; â€œ2024121115:54:51_01â€</p>\n<p>Memberï¼štimerId + unixå½“å‰æ—¶é—´æˆ³</p>\n<p>Scoreï¼šunixå½“å‰æ—¶é—´æˆ³</p>\n<p>ä¸€ä¸ªå¯èƒ½çš„ä¼˜åŒ–ç‚¹ï¼š</p>\n<p>åœ¨ä»»åŠ¡çŠ¶æ€ä¸Šå»ºç«‹ç´¢å¼•  â€”â€“&gt;  å­˜åœ¨<strong>æ•°æ®å€¾æ–œ</strong></p>\n"},{"_content":"ETF\n\nSecurity Basketï¼šBasic fee * 6\nGrow Basketï¼šS&P500\nHigh Grow Basketï¼šdanger\nLuxury Basketï¼šentertainment\n\nå…ˆå¡«æ»¡ç¬¬ä¸€ä¸ªç®±å­\n","source":"_posts/ç†ç¬.md","raw":"ETF\n\nSecurity Basketï¼šBasic fee * 6\nGrow Basketï¼šS&P500\nHigh Grow Basketï¼šdanger\nLuxury Basketï¼šentertainment\n\nå…ˆå¡«æ»¡ç¬¬ä¸€ä¸ªç®±å­\n","slug":"ç†ç¬","published":1,"date":"2024-12-27T11:03:15.345Z","updated":"2024-12-27T11:03:15.345Z","title":"","comments":1,"layout":"post","photos":[],"_id":"cm6c7md6j000za5t2383l0shx","content":"<p>ETF</p>\n<p>Security Basketï¼šBasic fee * 6<br>Grow Basketï¼šS&amp;P500<br>High Grow Basketï¼šdanger<br>Luxury Basketï¼šentertainment</p>\n<p>å…ˆå¡«æ»¡ç¬¬ä¸€ä¸ªç®±å­</p>\n","excerpt":"","more":"<p>ETF</p>\n<p>Security Basketï¼šBasic fee * 6<br>Grow Basketï¼šS&amp;P500<br>High Grow Basketï¼šdanger<br>Luxury Basketï¼šentertainment</p>\n<p>å…ˆå¡«æ»¡ç¬¬ä¸€ä¸ªç®±å­</p>\n"},{"title":"æ•°æ®é“¾è·¯å±‚çŸ¥è¯†ç‚¹","publish":true,"description":"è®°å½•äº†ä¸€äº›ç½‘ç»œå±‚çš„çŸ¥è¯†ç‚¹","date":"2024-09-22T16:00:00.000Z","_content":"\n\n\n# æ•°æ®é“¾è·¯å±‚çŸ¥è¯†ç‚¹\n\n## ARPåè®®\n\n> ææ¸…æ¥šARPåè®®çš„ç”¨é€”æ˜¯ä»€ä¹ˆ\n\nå‚è€ƒä¹¦ç±ã€Šå›¾è§£TCP/IP ç¬¬äº”ç‰ˆã€‹\n\n### ARPåè®®æ¦‚è¦\n\nARPåè®®å¯ä»¥æ ¹æ®ç›®æ ‡IPåœ°å€æ‰¾åˆ°ä¸‹ä¸€è·³çš„è®¾å¤‡ï¼ˆå¦‚æœç›®æ ‡ä¸»æœºåœ¨åŒä¸€ä¸ªé“¾è·¯ä¸Šï¼Œé‚£ä¹ˆå°±æ˜¯ç›®æ ‡ä¸»æœºï¼Œå¦åˆ™å°±æ˜¯è·¯ç”±å™¨ï¼‰çš„MACåœ°å€ã€‚ARPåè®®åªé€‚ç”¨äºIPv4ï¼Œä¸èƒ½ç”¨äºIPv6ï¼Œä½†IPv6å¯ä»¥ç”¨ICMPv6ä»£æ›¿ARPå‘é€é‚»å±…æ¢ç´¢æ¶ˆæ¯ã€‚\n\n### ARPçš„å·¥ä½œæœºåˆ¶\n\nç®€å•æ¥è¯´ï¼Œå°±æ˜¯ä»ä¸€ä¸ªIPåœ°å€å¹¿æ’­ARPè¯·æ±‚åŒ…ï¼Œç›®æ ‡IPåœ°å€å°†è‡ªèº«çš„MACåœ°å€å¡«å…¥å…¶ä¸­çš„ARPå“åº”åŒ…è¿”å›åˆ°æºIPåœ°å€\n\næºIPåœ°å€çš„è®¾å¤‡æ¥æ”¶åˆ°ARPå“åº”åŒ…åï¼Œå»ºç«‹ä¸€ä¸ªIP-MACåœ°å€çš„æ˜ å°„å¹¶å­˜å‚¨åœ¨ç¼“å­˜è¡¨ä¸­ã€‚è¿™æ ·å½“ä¸‹ä¸€æ¬¡å‘é€æ•°æ®åŒ…æ—¶å°±å¯ä»¥ç›´æ¥ä»ç¼“å­˜è¡¨ä¸­è¯»å–å‡ºMACåœ°å€ï¼ŒåŠ å¿«å‘é€æ•°æ®åŒ…çš„é€Ÿåº¦\n\nä¸è¿‡MACåœ°å€çš„ç¼“å­˜æ˜¯æœ‰ä¸€å®šæœŸé™çš„ï¼Œè¶…è¿‡è¿™ä¸ªæœŸé™ï¼Œç¼“å­˜å†…å®¹å°±è¢«æ¸…é™¤ã€‚è¿™ä½¿å¾—å³ä½¿MACåœ°å€ä¸IPåœ°å€çš„æ˜ å°„å…³ç³»å‘ç”Ÿå˜åŒ–ï¼Œä¹Ÿèƒ½å¤Ÿæ­£ç¡®åœ°å‘é€æ•°æ®åŒ…ç»™ç›®æ ‡è®¾å¤‡ã€‚\n\n### RARP\n\nRARPæ˜¯ARPçš„é€†è¿‡ç¨‹ï¼Œä»MACåœ°å€å®šä½IPåœ°å€çš„ä¸€ç§åè®®ã€‚RARPä¸»è¦ä¾èµ–ä¸€ä¸ªRARPæœåŠ¡å™¨ï¼Œåœ¨è¿™ä¸ªæœåŠ¡å™¨ä¸Šæ³¨å†Œäº†è®¸å¤šè®¾å¤‡çš„MACåœ°å€ä¸IPåœ°å€çš„æ˜ å°„\n\nğŸŒ°ï¼šå½“ä¸»æœºAæƒ³è¦ç›´åˆ°è‡ªå·±çš„IPåœ°å€æ—¶ï¼Œå°±å¯ä»¥å‘RARPæœåŠ¡å™¨å‘é€ä¸€ä¸ªRARPè¯·æ±‚åŒ…ï¼ŒRARPæœåŠ¡å™¨æ¥æ”¶åˆ°è¯·æ±‚åŒ…åï¼ŒæŸ¥çœ‹æ˜ å°„å…³ç³»ï¼Œå°†IPåœ°å€æ”¾å…¥RARPå“åº”åŒ…ä¸­å¹¶è¿”å›ç»™ä¸»æœºA\n\n![image-20240923144758648](https://raw.githubusercontent.com/lyydsheep/pic/main/202409231447673.png)","source":"_posts/æ•°æ®é“¾è·¯å±‚çŸ¥è¯†ç‚¹.md","raw":"---\ntitle: æ•°æ®é“¾è·¯å±‚çŸ¥è¯†ç‚¹\npublish: true\ndescription: è®°å½•äº†ä¸€äº›ç½‘ç»œå±‚çš„çŸ¥è¯†ç‚¹\ndate: 2024-09-23 \ntag: è®¡ç®—æœºç½‘ç»œ\n---\n\n\n\n# æ•°æ®é“¾è·¯å±‚çŸ¥è¯†ç‚¹\n\n## ARPåè®®\n\n> ææ¸…æ¥šARPåè®®çš„ç”¨é€”æ˜¯ä»€ä¹ˆ\n\nå‚è€ƒä¹¦ç±ã€Šå›¾è§£TCP/IP ç¬¬äº”ç‰ˆã€‹\n\n### ARPåè®®æ¦‚è¦\n\nARPåè®®å¯ä»¥æ ¹æ®ç›®æ ‡IPåœ°å€æ‰¾åˆ°ä¸‹ä¸€è·³çš„è®¾å¤‡ï¼ˆå¦‚æœç›®æ ‡ä¸»æœºåœ¨åŒä¸€ä¸ªé“¾è·¯ä¸Šï¼Œé‚£ä¹ˆå°±æ˜¯ç›®æ ‡ä¸»æœºï¼Œå¦åˆ™å°±æ˜¯è·¯ç”±å™¨ï¼‰çš„MACåœ°å€ã€‚ARPåè®®åªé€‚ç”¨äºIPv4ï¼Œä¸èƒ½ç”¨äºIPv6ï¼Œä½†IPv6å¯ä»¥ç”¨ICMPv6ä»£æ›¿ARPå‘é€é‚»å±…æ¢ç´¢æ¶ˆæ¯ã€‚\n\n### ARPçš„å·¥ä½œæœºåˆ¶\n\nç®€å•æ¥è¯´ï¼Œå°±æ˜¯ä»ä¸€ä¸ªIPåœ°å€å¹¿æ’­ARPè¯·æ±‚åŒ…ï¼Œç›®æ ‡IPåœ°å€å°†è‡ªèº«çš„MACåœ°å€å¡«å…¥å…¶ä¸­çš„ARPå“åº”åŒ…è¿”å›åˆ°æºIPåœ°å€\n\næºIPåœ°å€çš„è®¾å¤‡æ¥æ”¶åˆ°ARPå“åº”åŒ…åï¼Œå»ºç«‹ä¸€ä¸ªIP-MACåœ°å€çš„æ˜ å°„å¹¶å­˜å‚¨åœ¨ç¼“å­˜è¡¨ä¸­ã€‚è¿™æ ·å½“ä¸‹ä¸€æ¬¡å‘é€æ•°æ®åŒ…æ—¶å°±å¯ä»¥ç›´æ¥ä»ç¼“å­˜è¡¨ä¸­è¯»å–å‡ºMACåœ°å€ï¼ŒåŠ å¿«å‘é€æ•°æ®åŒ…çš„é€Ÿåº¦\n\nä¸è¿‡MACåœ°å€çš„ç¼“å­˜æ˜¯æœ‰ä¸€å®šæœŸé™çš„ï¼Œè¶…è¿‡è¿™ä¸ªæœŸé™ï¼Œç¼“å­˜å†…å®¹å°±è¢«æ¸…é™¤ã€‚è¿™ä½¿å¾—å³ä½¿MACåœ°å€ä¸IPåœ°å€çš„æ˜ å°„å…³ç³»å‘ç”Ÿå˜åŒ–ï¼Œä¹Ÿèƒ½å¤Ÿæ­£ç¡®åœ°å‘é€æ•°æ®åŒ…ç»™ç›®æ ‡è®¾å¤‡ã€‚\n\n### RARP\n\nRARPæ˜¯ARPçš„é€†è¿‡ç¨‹ï¼Œä»MACåœ°å€å®šä½IPåœ°å€çš„ä¸€ç§åè®®ã€‚RARPä¸»è¦ä¾èµ–ä¸€ä¸ªRARPæœåŠ¡å™¨ï¼Œåœ¨è¿™ä¸ªæœåŠ¡å™¨ä¸Šæ³¨å†Œäº†è®¸å¤šè®¾å¤‡çš„MACåœ°å€ä¸IPåœ°å€çš„æ˜ å°„\n\nğŸŒ°ï¼šå½“ä¸»æœºAæƒ³è¦ç›´åˆ°è‡ªå·±çš„IPåœ°å€æ—¶ï¼Œå°±å¯ä»¥å‘RARPæœåŠ¡å™¨å‘é€ä¸€ä¸ªRARPè¯·æ±‚åŒ…ï¼ŒRARPæœåŠ¡å™¨æ¥æ”¶åˆ°è¯·æ±‚åŒ…åï¼ŒæŸ¥çœ‹æ˜ å°„å…³ç³»ï¼Œå°†IPåœ°å€æ”¾å…¥RARPå“åº”åŒ…ä¸­å¹¶è¿”å›ç»™ä¸»æœºA\n\n![image-20240923144758648](https://raw.githubusercontent.com/lyydsheep/pic/main/202409231447673.png)","slug":"æ•°æ®é“¾è·¯å±‚çŸ¥è¯†ç‚¹","published":1,"updated":"2024-12-27T11:03:15.345Z","comments":1,"layout":"post","photos":[],"_id":"cm6c7md6j0011a5t24hlzhtnu","content":"<h1 id=\"æ•°æ®é“¾è·¯å±‚çŸ¥è¯†ç‚¹\"><a href=\"#æ•°æ®é“¾è·¯å±‚çŸ¥è¯†ç‚¹\" class=\"headerlink\" title=\"æ•°æ®é“¾è·¯å±‚çŸ¥è¯†ç‚¹\"></a>æ•°æ®é“¾è·¯å±‚çŸ¥è¯†ç‚¹</h1><h2 id=\"ARPåè®®\"><a href=\"#ARPåè®®\" class=\"headerlink\" title=\"ARPåè®®\"></a>ARPåè®®</h2><blockquote>\n<p>ææ¸…æ¥šARPåè®®çš„ç”¨é€”æ˜¯ä»€ä¹ˆ</p>\n</blockquote>\n<p>å‚è€ƒä¹¦ç±ã€Šå›¾è§£TCP&#x2F;IP ç¬¬äº”ç‰ˆã€‹</p>\n<h3 id=\"ARPåè®®æ¦‚è¦\"><a href=\"#ARPåè®®æ¦‚è¦\" class=\"headerlink\" title=\"ARPåè®®æ¦‚è¦\"></a>ARPåè®®æ¦‚è¦</h3><p>ARPåè®®å¯ä»¥æ ¹æ®ç›®æ ‡IPåœ°å€æ‰¾åˆ°ä¸‹ä¸€è·³çš„è®¾å¤‡ï¼ˆå¦‚æœç›®æ ‡ä¸»æœºåœ¨åŒä¸€ä¸ªé“¾è·¯ä¸Šï¼Œé‚£ä¹ˆå°±æ˜¯ç›®æ ‡ä¸»æœºï¼Œå¦åˆ™å°±æ˜¯è·¯ç”±å™¨ï¼‰çš„MACåœ°å€ã€‚ARPåè®®åªé€‚ç”¨äºIPv4ï¼Œä¸èƒ½ç”¨äºIPv6ï¼Œä½†IPv6å¯ä»¥ç”¨ICMPv6ä»£æ›¿ARPå‘é€é‚»å±…æ¢ç´¢æ¶ˆæ¯ã€‚</p>\n<h3 id=\"ARPçš„å·¥ä½œæœºåˆ¶\"><a href=\"#ARPçš„å·¥ä½œæœºåˆ¶\" class=\"headerlink\" title=\"ARPçš„å·¥ä½œæœºåˆ¶\"></a>ARPçš„å·¥ä½œæœºåˆ¶</h3><p>ç®€å•æ¥è¯´ï¼Œå°±æ˜¯ä»ä¸€ä¸ªIPåœ°å€å¹¿æ’­ARPè¯·æ±‚åŒ…ï¼Œç›®æ ‡IPåœ°å€å°†è‡ªèº«çš„MACåœ°å€å¡«å…¥å…¶ä¸­çš„ARPå“åº”åŒ…è¿”å›åˆ°æºIPåœ°å€</p>\n<p>æºIPåœ°å€çš„è®¾å¤‡æ¥æ”¶åˆ°ARPå“åº”åŒ…åï¼Œå»ºç«‹ä¸€ä¸ªIP-MACåœ°å€çš„æ˜ å°„å¹¶å­˜å‚¨åœ¨ç¼“å­˜è¡¨ä¸­ã€‚è¿™æ ·å½“ä¸‹ä¸€æ¬¡å‘é€æ•°æ®åŒ…æ—¶å°±å¯ä»¥ç›´æ¥ä»ç¼“å­˜è¡¨ä¸­è¯»å–å‡ºMACåœ°å€ï¼ŒåŠ å¿«å‘é€æ•°æ®åŒ…çš„é€Ÿåº¦</p>\n<p>ä¸è¿‡MACåœ°å€çš„ç¼“å­˜æ˜¯æœ‰ä¸€å®šæœŸé™çš„ï¼Œè¶…è¿‡è¿™ä¸ªæœŸé™ï¼Œç¼“å­˜å†…å®¹å°±è¢«æ¸…é™¤ã€‚è¿™ä½¿å¾—å³ä½¿MACåœ°å€ä¸IPåœ°å€çš„æ˜ å°„å…³ç³»å‘ç”Ÿå˜åŒ–ï¼Œä¹Ÿèƒ½å¤Ÿæ­£ç¡®åœ°å‘é€æ•°æ®åŒ…ç»™ç›®æ ‡è®¾å¤‡ã€‚</p>\n<h3 id=\"RARP\"><a href=\"#RARP\" class=\"headerlink\" title=\"RARP\"></a>RARP</h3><p>RARPæ˜¯ARPçš„é€†è¿‡ç¨‹ï¼Œä»MACåœ°å€å®šä½IPåœ°å€çš„ä¸€ç§åè®®ã€‚RARPä¸»è¦ä¾èµ–ä¸€ä¸ªRARPæœåŠ¡å™¨ï¼Œåœ¨è¿™ä¸ªæœåŠ¡å™¨ä¸Šæ³¨å†Œäº†è®¸å¤šè®¾å¤‡çš„MACåœ°å€ä¸IPåœ°å€çš„æ˜ å°„</p>\n<p>ğŸŒ°ï¼šå½“ä¸»æœºAæƒ³è¦ç›´åˆ°è‡ªå·±çš„IPåœ°å€æ—¶ï¼Œå°±å¯ä»¥å‘RARPæœåŠ¡å™¨å‘é€ä¸€ä¸ªRARPè¯·æ±‚åŒ…ï¼ŒRARPæœåŠ¡å™¨æ¥æ”¶åˆ°è¯·æ±‚åŒ…åï¼ŒæŸ¥çœ‹æ˜ å°„å…³ç³»ï¼Œå°†IPåœ°å€æ”¾å…¥RARPå“åº”åŒ…ä¸­å¹¶è¿”å›ç»™ä¸»æœºA</p>\n<p><img src=\"https://raw.githubusercontent.com/lyydsheep/pic/main/202409231447673.png\" alt=\"image-20240923144758648\"></p>\n","excerpt":"","more":"<h1 id=\"æ•°æ®é“¾è·¯å±‚çŸ¥è¯†ç‚¹\"><a href=\"#æ•°æ®é“¾è·¯å±‚çŸ¥è¯†ç‚¹\" class=\"headerlink\" title=\"æ•°æ®é“¾è·¯å±‚çŸ¥è¯†ç‚¹\"></a>æ•°æ®é“¾è·¯å±‚çŸ¥è¯†ç‚¹</h1><h2 id=\"ARPåè®®\"><a href=\"#ARPåè®®\" class=\"headerlink\" title=\"ARPåè®®\"></a>ARPåè®®</h2><blockquote>\n<p>ææ¸…æ¥šARPåè®®çš„ç”¨é€”æ˜¯ä»€ä¹ˆ</p>\n</blockquote>\n<p>å‚è€ƒä¹¦ç±ã€Šå›¾è§£TCP&#x2F;IP ç¬¬äº”ç‰ˆã€‹</p>\n<h3 id=\"ARPåè®®æ¦‚è¦\"><a href=\"#ARPåè®®æ¦‚è¦\" class=\"headerlink\" title=\"ARPåè®®æ¦‚è¦\"></a>ARPåè®®æ¦‚è¦</h3><p>ARPåè®®å¯ä»¥æ ¹æ®ç›®æ ‡IPåœ°å€æ‰¾åˆ°ä¸‹ä¸€è·³çš„è®¾å¤‡ï¼ˆå¦‚æœç›®æ ‡ä¸»æœºåœ¨åŒä¸€ä¸ªé“¾è·¯ä¸Šï¼Œé‚£ä¹ˆå°±æ˜¯ç›®æ ‡ä¸»æœºï¼Œå¦åˆ™å°±æ˜¯è·¯ç”±å™¨ï¼‰çš„MACåœ°å€ã€‚ARPåè®®åªé€‚ç”¨äºIPv4ï¼Œä¸èƒ½ç”¨äºIPv6ï¼Œä½†IPv6å¯ä»¥ç”¨ICMPv6ä»£æ›¿ARPå‘é€é‚»å±…æ¢ç´¢æ¶ˆæ¯ã€‚</p>\n<h3 id=\"ARPçš„å·¥ä½œæœºåˆ¶\"><a href=\"#ARPçš„å·¥ä½œæœºåˆ¶\" class=\"headerlink\" title=\"ARPçš„å·¥ä½œæœºåˆ¶\"></a>ARPçš„å·¥ä½œæœºåˆ¶</h3><p>ç®€å•æ¥è¯´ï¼Œå°±æ˜¯ä»ä¸€ä¸ªIPåœ°å€å¹¿æ’­ARPè¯·æ±‚åŒ…ï¼Œç›®æ ‡IPåœ°å€å°†è‡ªèº«çš„MACåœ°å€å¡«å…¥å…¶ä¸­çš„ARPå“åº”åŒ…è¿”å›åˆ°æºIPåœ°å€</p>\n<p>æºIPåœ°å€çš„è®¾å¤‡æ¥æ”¶åˆ°ARPå“åº”åŒ…åï¼Œå»ºç«‹ä¸€ä¸ªIP-MACåœ°å€çš„æ˜ å°„å¹¶å­˜å‚¨åœ¨ç¼“å­˜è¡¨ä¸­ã€‚è¿™æ ·å½“ä¸‹ä¸€æ¬¡å‘é€æ•°æ®åŒ…æ—¶å°±å¯ä»¥ç›´æ¥ä»ç¼“å­˜è¡¨ä¸­è¯»å–å‡ºMACåœ°å€ï¼ŒåŠ å¿«å‘é€æ•°æ®åŒ…çš„é€Ÿåº¦</p>\n<p>ä¸è¿‡MACåœ°å€çš„ç¼“å­˜æ˜¯æœ‰ä¸€å®šæœŸé™çš„ï¼Œè¶…è¿‡è¿™ä¸ªæœŸé™ï¼Œç¼“å­˜å†…å®¹å°±è¢«æ¸…é™¤ã€‚è¿™ä½¿å¾—å³ä½¿MACåœ°å€ä¸IPåœ°å€çš„æ˜ å°„å…³ç³»å‘ç”Ÿå˜åŒ–ï¼Œä¹Ÿèƒ½å¤Ÿæ­£ç¡®åœ°å‘é€æ•°æ®åŒ…ç»™ç›®æ ‡è®¾å¤‡ã€‚</p>\n<h3 id=\"RARP\"><a href=\"#RARP\" class=\"headerlink\" title=\"RARP\"></a>RARP</h3><p>RARPæ˜¯ARPçš„é€†è¿‡ç¨‹ï¼Œä»MACåœ°å€å®šä½IPåœ°å€çš„ä¸€ç§åè®®ã€‚RARPä¸»è¦ä¾èµ–ä¸€ä¸ªRARPæœåŠ¡å™¨ï¼Œåœ¨è¿™ä¸ªæœåŠ¡å™¨ä¸Šæ³¨å†Œäº†è®¸å¤šè®¾å¤‡çš„MACåœ°å€ä¸IPåœ°å€çš„æ˜ å°„</p>\n<p>ğŸŒ°ï¼šå½“ä¸»æœºAæƒ³è¦ç›´åˆ°è‡ªå·±çš„IPåœ°å€æ—¶ï¼Œå°±å¯ä»¥å‘RARPæœåŠ¡å™¨å‘é€ä¸€ä¸ªRARPè¯·æ±‚åŒ…ï¼ŒRARPæœåŠ¡å™¨æ¥æ”¶åˆ°è¯·æ±‚åŒ…åï¼ŒæŸ¥çœ‹æ˜ å°„å…³ç³»ï¼Œå°†IPåœ°å€æ”¾å…¥RARPå“åº”åŒ…ä¸­å¹¶è¿”å›ç»™ä¸»æœºA</p>\n<p><img src=\"https://raw.githubusercontent.com/lyydsheep/pic/main/202409231447673.png\" alt=\"image-20240923144758648\"></p>\n"},{"title":"æ¢å–Mac OS","publish":false,"_content":"\n## å¤§çº²\n\n### è‡ªæˆ‘ä»‹ç»\n\n- å§“å \n- ç­çº§ \n- æ”¿æ²»é¢è²Œ\n  - å…±é’å›¢å‘˜\n- æ’å\n  -  **12/393**\n  - **163 ----> 12**\n- æˆç»©\n  -  **å¿˜äº†å‡åˆ†**\n  -  ç¦»æ•£æ•°å­¦2 98\n  - è®¡ç®—æœºæ•°å­¦åŸºç¡€ 98\n  - è®¡ç®—æœºç»„ç»‡ä¸ç»“æ„ 93\n  - å¤§å­¦ç‰©ç†(è½¯) 96\n  - æ“ä½œç³»ç»Ÿ 92\n  - å¤§å­¦è‹±è¯­3 98\n  - æ¦‚ç‡ä¸ç»Ÿè®¡A 99\n  - æ•°æ®ç»“æ„ä¸ç®—æ³• 97\n  -  è®¡ç®—æœºç»„ç»‡ä¸ç»“æ„å®éªŒ 95\n- è·å¥–æƒ…å†µ\n  - å­¦ä¹ ä¼˜ç§€å¥–å­¦é‡‘ï¼ˆä¸€ç­‰ï¼‰\n  - ç§‘æŠ€åˆ›æ–°å¥–å­¦é‡‘\n  - CCF CSP ç¬¬31æ¬¡è®¤è¯ é™¢çº§äºŒç­‰å¥–\n  - ç¬¬åä¹å±Šç™¾åº¦ä¹‹æ˜Ÿç¨‹åºè®¾è®¡å¤§èµ›åˆèµ› çœçº§ä¸‰ç­‰å¥–\n  - 2023å¹´ç¬¬å››å±Šå…¨å›½å¤§å­¦ç”Ÿç®—æ³•è®¾è®¡ä¸ç¼–ç¨‹æŒ‘æˆ˜èµ›ï¼ˆç§‹å­£èµ›ï¼‰ å›½å®¶çº§ä¸‰ç­‰å¥–\n  - 2023å¹´ç¬¬åä¸‰å±ŠAPMCMäºšå¤ªåœ°åŒºå¤§å­¦ç”Ÿæ•°å­¦å»ºæ¨¡ç«èµ› å›½å®¶çº§ä¸‰ç­‰å¥–\n  - 2023å¹´å…¨å›½å¤§å­¦ç”Ÿä¿¡æ¯æŠ€æœ¯è®¤è¯æŒ‘æˆ˜èµ› å›½å®¶çº§ä¸‰ç­‰å¥–\n  - 2024å¹´ç¬¬äº”å±Šå…¨å›½å¤§å­¦ç”Ÿç®—æ³•è®¾è®¡ä¸ç¼–ç¨‹æŒ‘æˆ˜èµ›ï¼ˆæ˜¥å­£èµ›ï¼‰ å›½å®¶çº§ä¸‰ç­‰å¥–\n  - ç¬¬äº”å±Šå…¨å›½é«˜æ ¡è®¡ç®—æœºèƒ½åŠ›æŒ‘æˆ˜èµ›-C++ å›½å®¶çº§äºŒç­‰å¥–\n  - ç¬¬åäº”å±Šè“æ¡¥æ¯å…¨å›½è½¯ä»¶å’Œä¿¡æ¯æŠ€æœ¯ä¸“ä¸šäººæ‰å¤§èµ›è¾½å®èµ›åŒº çœçº§äºŒç­‰å¥–\n  - 2024å¹´ç¾å›½å¤§å­¦ç”Ÿæ•°å­¦å»ºæ¨¡ç«èµ› å›½å®¶çº§Hå¥–\n  - 2024å¹´ç¬¬äºŒå±Šå…¨å›½å¤§å­¦ç”Ÿä¿¡æ¯æŠ€æœ¯è®¤è¯æŒ‘æˆ˜èµ› å›½å®¶çº§ä¸‰ç­‰å¥–\n  - 2024å¹´ä¸­å›½é«˜æ ¡è®¡ç®—æœºå¤§èµ›-AIGCåˆ›æ–°èµ›-åº”ç”¨èµ›é“ï¼ˆæ ¡èµ›ï¼‰ æ ¡çº§ä¸€ç­‰å¥–\n  - 2023é¦–å±Šå¤§å­¦ç”Ÿç®—æ³•å¤§èµ› ä¼˜ç§€å¥–\n  - 116ç§¯åˆ†\n- èº«ä»½\n\n### æˆç»©ã€ç§‘åˆ›ã€åç«¯\n\n- æˆç»©\n  - å¤§ä¸€å­¦å¹´60 -----> å¤§äºŒå­¦å¹´12\n  - è¿‡ç¨‹\n    - è®¤çœŸå¬è®²\n    - ä»”ç»†åšç¬”è®°\n    - é‡å¤é‡å¤é‡å¤\n- ç§‘åˆ›å¥–é¡¹\n  - ç§‘åˆ›ç§¯åˆ†116\n  - å›½å®¶çº§å¥–é¡¹8é¡¹\n  - ä½œä¸ºåˆ›ä¸­ä¸€ä»½å­ï¼Œç§¯ææŠ•èº«äºç§‘åˆ›ç«èµ›\n- åç«¯\n  - å¼€æºçŸ­é“¾é¡¹ç›®\n  - æ·±å…¥å­¦ä¹ MySQLåŸç†\n  - æ·±å…¥å­¦ä¹ RedisåŸç†\n  - åšå®¢\n  - æ€è·¯ï¼š\n    - åç«¯æ¶æ„æŠ€æœ¯ï¼Œè‡ªå­¦Goè¯­è¨€å¹¶ç§¯ç´¯è¿‘2wå­—å­¦ä¹ ç¬”è®°\n    - ä¸ºäº†æ›´å¥½åœ°æé«˜ç³»ç»Ÿæ€§èƒ½ï¼Œæ·±å…¥å­¦ä¹ MySQLã€Redisåº•å±‚åŸç†ï¼Œä¸åº•å±‚Cè¯­è¨€å®ç°ä»£ç æ–—æ™ºæ–—å‹‡\n    - ä¸ªäººåšå®¢\n- ç§‘ç ”\n  - å¤§åˆ›ï¼ˆè¹­ï¼‰\n  - è®ºæ–‡\n\n### å­¦ç”Ÿå·¥ä½œ\n\n- ä¾‹ä¼š\n- åŸ¹å…»å¤§ä¸€/äºŒåŒå­¦\n\n### æ€»ç»“\n\n## aba\n\n- è‡ªæˆ‘ä»‹ç»ï¼šä¸€å¹´ä»¥æ¥çš„ç§¯ç´¯\n  - ç‰¹ç‚¹\n- ç›®å½•\n- è¿‡ç¨‹--->ç»“æœ\n- é‡---->æ€»ç»“è¿‡ç¨‹---->ç²¾ç¥\n- é¡¹ç›®ï¼šæ‰¿æ‹…ä»€ä¹ˆè§’è‰²ã€ä»€ä¹ˆæå‡\n- æˆæœç½—åˆ—é¡µ\n\n## ç¨¿å­\n\nâ€‹    å°Šæ•¬çš„å„ä½è¯„å§”è€å¸ˆï¼Œæ™šä¸Šå¥½ï¼æˆ‘æ˜¯æ¥è‡ªè½¯ 2213 ç­çš„ææºä¸œã€‚å¾ˆè£å¹¸å‚åŠ æœ¬æ¬¡å›½å®¶å¥–å­¦é‡‘æ±‡æŠ¥ã€‚æˆ‘æ±‡æŠ¥çš„ä¸»é¢˜æ˜¯ â€œè„šè¸å®åœ° æºè¿œæµé•¿ åªäº‰æœå¤• å‹¤å‹‰è‡´è¿œâ€ï¼ˆç¿»é¡µï¼‰\n\n   å¤§äºŒå­¦å¹´ï¼Œæˆ‘è£è·äº†ä¸€ç­‰å­¦ä¹ ä¼˜ç§€å¥–å­¦é‡‘ã€æ ¡ä¸‰å¥½å­¦ç”Ÿã€ç§‘æŠ€åˆ›æ–°å¥–å­¦é‡‘ç­‰è£èª‰ã€‚ï¼ˆç¿»é¡µï¼‰\n\n**ä¸€ã€è„šè¸å®åœ°ï¼Œå®ç°æˆç»©é£è·ƒ**\n\n   é¢å¯¹å¤§ä¸€ä¸Šä¸å°½äººæ„çš„æˆç»©ï¼Œæˆ‘å†…å¿ƒå……æ»¡ä¸ç”˜ã€‚æˆ‘ä¸æ„¿å°±æ­¤æ¶ˆæ²‰ï¼Œæ›´ä¸æ„¿è®©çˆ¶æ¯å¤±æœ›ã€‚ä»æ­¤ï¼Œæˆ‘æˆä¸ºäº†è‡ªä¹ å®¤çš„å¸¸å®¢ã€æ•™å®¤å‰æ’çš„åšå®ˆè€…ï¼Œ300ä½™é¡µçš„ç¬”è®°ï¼Œ300å¤šä¸ªæ—¥å¤œçš„è¾›å‹¤åŠªåŠ›ï¼Œç»ˆäºåœ¨å¤§äºŒå­¦å¹´ï¼Œæˆ‘å®ç°äº†ä¸“ä¸šæ’åä»**33%****åˆ°3%****çš„é£è·ƒ**ï¼Œä»**ä»…æœ‰**ä¸€é—¨è¯¾ç¨‹æˆç»©90+ï¼Œåˆ°å¤§äºŒå­¦å¹´10é—¨å¿…ä¿®è¯¾90+ã€‚ï¼ˆç¿»é¡µï¼‰\n\n**äºŒã€åªäº‰æœå¤•ï¼Œç£¨ç ºç§‘æŠ€åˆ›æ–°**\n\nâ€‹    æ— è®ºæ˜¯æ˜¥åç§‹å®è¿˜æ˜¯å†¬å†·å¤çƒ­ï¼Œæ´›è°·ã€åŠ›æ‰£è§è¯äº†æˆ‘æ—¥å¤ä¸€æ—¥çš„å‹¤å¥‹ç»ƒä¹ ã€‚å¤§äºŒå­¦å¹´ï¼Œæˆ‘ä»¥æ±—æ°´æµ‡çŒï¼Œå…±è·å¾—äº†12é¡¹ç«èµ›è£èª‰ï¼Œå…¶ä¸­åŒ…æ‹¬8é¡¹å›½å®¶çº§å¥–é¡¹å’Œ2é¡¹çœçº§å¥–é¡¹ï¼Œç§‘åˆ›ç§¯åˆ†ä¹Ÿå®ç°äº†ä»0åˆ°116åˆ†çš„é£è·ƒã€‚ï¼ˆç¿»é¡µï¼‰\n\n   åœ¨ç§‘ç ”é¢†åŸŸï¼Œæˆ‘ä¸ä»…å·©å›ºäº†ç†è®ºçŸ¥è¯†ï¼Œåœ¨ç ”ç©¶ç”Ÿçš„æŒ‡å¯¼ä¸‹é˜…è¯»äº†10ä½™ç¯‡è®ºæ–‡ï¼Œè¿˜èº¬è¡Œå®è·µï¼Œä¸å›¢é˜Ÿæˆå‘˜å…±åŒå¼€å‘åŒ–å·¥å¤§æ¨¡å‹å¤§åˆ›é¡¹ç›®ã€‚ï¼ˆç¿»é¡µï¼‰\n\n   æˆ‘ç§¯ææ¢ç´¢åç«¯æœ€æ–°æŠ€æœ¯ï¼Œæ·±å…¥Goè¯­è¨€çš„åº•å±‚åŸç†ï¼Œæ¢ç´¢é«˜æ€§èƒ½æ¶æ„è®¾è®¡ï¼Œç‹¬ç«‹æ­å»ºäº†ä¸ªäººåšå®¢ï¼Œåˆ†äº«æ‰€è§æ‰€é—»ã€‚ï¼ˆç¿»é¡µï¼‰\n\n   è‡³ä»Šï¼Œå·²æœ‰åº•å±‚åŸç†ç¬”è®°è¿‘**2ä¸‡å­—**ï¼Œ**ç‹¬ç«‹å¼€å‘å¹¶å¼€æº**çŸ­é“¾ç³»ç»Ÿï¼Œå‘å¸ƒ**20**ä½™ç¯‡æŠ€æœ¯æ–‡ç« ï¼Œæ€»å­—æ•°è¶…è¿‡**6ä¸‡å­—**ã€‚ï¼ˆç¿»é¡µï¼‰\n\n**ä¸‰ã€é¥®æ°´æ€æºï¼Œæ•£å‘è¤ç«ä¹‹å…‰**\n\n   ä½œä¸ºè…¾è®¯ç»„çš„æ ¸å¿ƒæˆå‘˜ï¼Œæˆ‘ä¸ä»…ç§¯æå‚ä¸æŠ€æœ¯æ ˆå»ºè®¾ï¼Œä¸ºå›¢é˜Ÿæˆå‘˜æä¾›ä¸°å¯Œçš„å­¦ä¹ èµ„æºï¼Œè¿˜è‡´åŠ›äºåŸ¹å…»å›¢é˜Ÿåç«¯æŠ€æœ¯äººæ‰ï¼Œç§¯æå›åº”å›¢é˜Ÿæˆå‘˜çš„ç–‘é—®ã€‚æŠ€æœ¯æ ˆå·²æ”¶å½•åšå®¢**äºŒå**ç¯‡ ä¸ªäººè´¡çŒ®**3**ç¯‡ 23çº§ç»„å‘˜åäºº **ç™¾åˆ†ç™¾** å­¦ä¹ ä¼˜ç§€å¥–å­¦é‡‘ã€‚ç”¨è¡ŒåŠ¨è¯ é‡Š**â€œ****æœ‰ä¸€åˆ†çƒ­ï¼Œå°±è¦å‘ä¸€åˆ†å…‰â€**çš„ç²¾ç¥ã€‚ï¼ˆç¿»é¡µï¼‰\n\n**æ€»ç»“**\n\n   æˆ‘å§‹ç»ˆåšä¿¡ï¼šä¸é©°äºç©ºæƒ³ï¼Œä¸éª›äºè™šå£°ï¼Œå”¯æœ‰ä»¥**æ±‚å®**çš„æ€åº¦ï¼Œ**è¸å®**çš„å·¥ä½œï¼Œæ‰èƒ½èµ°å¾—æ›´è¿œã€‚ï¼ˆç¿»é¡µï¼‰\n\n   å±•æœ›æœªæ¥ï¼Œæ„¿æˆ‘ä»¬éƒ½èƒ½ä¸ºçœŸç†çš„**æºè¿œæ ¹æ·±**è€Œåªäº‰æœå¤•ï¼Œä¸ºäº‰åš**å—é‡‘ä¸œç®­**è€Œæ‹¼æå¥‹æ–—ã€‚\n\n   æˆ‘çš„æ±‡æŠ¥åˆ°æ­¤ç»“æŸï¼Œè°¢è°¢å¤§å®¶ã€‚","source":"_posts/æ¢å–Mac OSç¬¬ä¸€æ­¥.md","raw":"---\ntitle: æ¢å–Mac OS\npublish: false\n\n---\n\n## å¤§çº²\n\n### è‡ªæˆ‘ä»‹ç»\n\n- å§“å \n- ç­çº§ \n- æ”¿æ²»é¢è²Œ\n  - å…±é’å›¢å‘˜\n- æ’å\n  -  **12/393**\n  - **163 ----> 12**\n- æˆç»©\n  -  **å¿˜äº†å‡åˆ†**\n  -  ç¦»æ•£æ•°å­¦2 98\n  - è®¡ç®—æœºæ•°å­¦åŸºç¡€ 98\n  - è®¡ç®—æœºç»„ç»‡ä¸ç»“æ„ 93\n  - å¤§å­¦ç‰©ç†(è½¯) 96\n  - æ“ä½œç³»ç»Ÿ 92\n  - å¤§å­¦è‹±è¯­3 98\n  - æ¦‚ç‡ä¸ç»Ÿè®¡A 99\n  - æ•°æ®ç»“æ„ä¸ç®—æ³• 97\n  -  è®¡ç®—æœºç»„ç»‡ä¸ç»“æ„å®éªŒ 95\n- è·å¥–æƒ…å†µ\n  - å­¦ä¹ ä¼˜ç§€å¥–å­¦é‡‘ï¼ˆä¸€ç­‰ï¼‰\n  - ç§‘æŠ€åˆ›æ–°å¥–å­¦é‡‘\n  - CCF CSP ç¬¬31æ¬¡è®¤è¯ é™¢çº§äºŒç­‰å¥–\n  - ç¬¬åä¹å±Šç™¾åº¦ä¹‹æ˜Ÿç¨‹åºè®¾è®¡å¤§èµ›åˆèµ› çœçº§ä¸‰ç­‰å¥–\n  - 2023å¹´ç¬¬å››å±Šå…¨å›½å¤§å­¦ç”Ÿç®—æ³•è®¾è®¡ä¸ç¼–ç¨‹æŒ‘æˆ˜èµ›ï¼ˆç§‹å­£èµ›ï¼‰ å›½å®¶çº§ä¸‰ç­‰å¥–\n  - 2023å¹´ç¬¬åä¸‰å±ŠAPMCMäºšå¤ªåœ°åŒºå¤§å­¦ç”Ÿæ•°å­¦å»ºæ¨¡ç«èµ› å›½å®¶çº§ä¸‰ç­‰å¥–\n  - 2023å¹´å…¨å›½å¤§å­¦ç”Ÿä¿¡æ¯æŠ€æœ¯è®¤è¯æŒ‘æˆ˜èµ› å›½å®¶çº§ä¸‰ç­‰å¥–\n  - 2024å¹´ç¬¬äº”å±Šå…¨å›½å¤§å­¦ç”Ÿç®—æ³•è®¾è®¡ä¸ç¼–ç¨‹æŒ‘æˆ˜èµ›ï¼ˆæ˜¥å­£èµ›ï¼‰ å›½å®¶çº§ä¸‰ç­‰å¥–\n  - ç¬¬äº”å±Šå…¨å›½é«˜æ ¡è®¡ç®—æœºèƒ½åŠ›æŒ‘æˆ˜èµ›-C++ å›½å®¶çº§äºŒç­‰å¥–\n  - ç¬¬åäº”å±Šè“æ¡¥æ¯å…¨å›½è½¯ä»¶å’Œä¿¡æ¯æŠ€æœ¯ä¸“ä¸šäººæ‰å¤§èµ›è¾½å®èµ›åŒº çœçº§äºŒç­‰å¥–\n  - 2024å¹´ç¾å›½å¤§å­¦ç”Ÿæ•°å­¦å»ºæ¨¡ç«èµ› å›½å®¶çº§Hå¥–\n  - 2024å¹´ç¬¬äºŒå±Šå…¨å›½å¤§å­¦ç”Ÿä¿¡æ¯æŠ€æœ¯è®¤è¯æŒ‘æˆ˜èµ› å›½å®¶çº§ä¸‰ç­‰å¥–\n  - 2024å¹´ä¸­å›½é«˜æ ¡è®¡ç®—æœºå¤§èµ›-AIGCåˆ›æ–°èµ›-åº”ç”¨èµ›é“ï¼ˆæ ¡èµ›ï¼‰ æ ¡çº§ä¸€ç­‰å¥–\n  - 2023é¦–å±Šå¤§å­¦ç”Ÿç®—æ³•å¤§èµ› ä¼˜ç§€å¥–\n  - 116ç§¯åˆ†\n- èº«ä»½\n\n### æˆç»©ã€ç§‘åˆ›ã€åç«¯\n\n- æˆç»©\n  - å¤§ä¸€å­¦å¹´60 -----> å¤§äºŒå­¦å¹´12\n  - è¿‡ç¨‹\n    - è®¤çœŸå¬è®²\n    - ä»”ç»†åšç¬”è®°\n    - é‡å¤é‡å¤é‡å¤\n- ç§‘åˆ›å¥–é¡¹\n  - ç§‘åˆ›ç§¯åˆ†116\n  - å›½å®¶çº§å¥–é¡¹8é¡¹\n  - ä½œä¸ºåˆ›ä¸­ä¸€ä»½å­ï¼Œç§¯ææŠ•èº«äºç§‘åˆ›ç«èµ›\n- åç«¯\n  - å¼€æºçŸ­é“¾é¡¹ç›®\n  - æ·±å…¥å­¦ä¹ MySQLåŸç†\n  - æ·±å…¥å­¦ä¹ RedisåŸç†\n  - åšå®¢\n  - æ€è·¯ï¼š\n    - åç«¯æ¶æ„æŠ€æœ¯ï¼Œè‡ªå­¦Goè¯­è¨€å¹¶ç§¯ç´¯è¿‘2wå­—å­¦ä¹ ç¬”è®°\n    - ä¸ºäº†æ›´å¥½åœ°æé«˜ç³»ç»Ÿæ€§èƒ½ï¼Œæ·±å…¥å­¦ä¹ MySQLã€Redisåº•å±‚åŸç†ï¼Œä¸åº•å±‚Cè¯­è¨€å®ç°ä»£ç æ–—æ™ºæ–—å‹‡\n    - ä¸ªäººåšå®¢\n- ç§‘ç ”\n  - å¤§åˆ›ï¼ˆè¹­ï¼‰\n  - è®ºæ–‡\n\n### å­¦ç”Ÿå·¥ä½œ\n\n- ä¾‹ä¼š\n- åŸ¹å…»å¤§ä¸€/äºŒåŒå­¦\n\n### æ€»ç»“\n\n## aba\n\n- è‡ªæˆ‘ä»‹ç»ï¼šä¸€å¹´ä»¥æ¥çš„ç§¯ç´¯\n  - ç‰¹ç‚¹\n- ç›®å½•\n- è¿‡ç¨‹--->ç»“æœ\n- é‡---->æ€»ç»“è¿‡ç¨‹---->ç²¾ç¥\n- é¡¹ç›®ï¼šæ‰¿æ‹…ä»€ä¹ˆè§’è‰²ã€ä»€ä¹ˆæå‡\n- æˆæœç½—åˆ—é¡µ\n\n## ç¨¿å­\n\nâ€‹    å°Šæ•¬çš„å„ä½è¯„å§”è€å¸ˆï¼Œæ™šä¸Šå¥½ï¼æˆ‘æ˜¯æ¥è‡ªè½¯ 2213 ç­çš„ææºä¸œã€‚å¾ˆè£å¹¸å‚åŠ æœ¬æ¬¡å›½å®¶å¥–å­¦é‡‘æ±‡æŠ¥ã€‚æˆ‘æ±‡æŠ¥çš„ä¸»é¢˜æ˜¯ â€œè„šè¸å®åœ° æºè¿œæµé•¿ åªäº‰æœå¤• å‹¤å‹‰è‡´è¿œâ€ï¼ˆç¿»é¡µï¼‰\n\n   å¤§äºŒå­¦å¹´ï¼Œæˆ‘è£è·äº†ä¸€ç­‰å­¦ä¹ ä¼˜ç§€å¥–å­¦é‡‘ã€æ ¡ä¸‰å¥½å­¦ç”Ÿã€ç§‘æŠ€åˆ›æ–°å¥–å­¦é‡‘ç­‰è£èª‰ã€‚ï¼ˆç¿»é¡µï¼‰\n\n**ä¸€ã€è„šè¸å®åœ°ï¼Œå®ç°æˆç»©é£è·ƒ**\n\n   é¢å¯¹å¤§ä¸€ä¸Šä¸å°½äººæ„çš„æˆç»©ï¼Œæˆ‘å†…å¿ƒå……æ»¡ä¸ç”˜ã€‚æˆ‘ä¸æ„¿å°±æ­¤æ¶ˆæ²‰ï¼Œæ›´ä¸æ„¿è®©çˆ¶æ¯å¤±æœ›ã€‚ä»æ­¤ï¼Œæˆ‘æˆä¸ºäº†è‡ªä¹ å®¤çš„å¸¸å®¢ã€æ•™å®¤å‰æ’çš„åšå®ˆè€…ï¼Œ300ä½™é¡µçš„ç¬”è®°ï¼Œ300å¤šä¸ªæ—¥å¤œçš„è¾›å‹¤åŠªåŠ›ï¼Œç»ˆäºåœ¨å¤§äºŒå­¦å¹´ï¼Œæˆ‘å®ç°äº†ä¸“ä¸šæ’åä»**33%****åˆ°3%****çš„é£è·ƒ**ï¼Œä»**ä»…æœ‰**ä¸€é—¨è¯¾ç¨‹æˆç»©90+ï¼Œåˆ°å¤§äºŒå­¦å¹´10é—¨å¿…ä¿®è¯¾90+ã€‚ï¼ˆç¿»é¡µï¼‰\n\n**äºŒã€åªäº‰æœå¤•ï¼Œç£¨ç ºç§‘æŠ€åˆ›æ–°**\n\nâ€‹    æ— è®ºæ˜¯æ˜¥åç§‹å®è¿˜æ˜¯å†¬å†·å¤çƒ­ï¼Œæ´›è°·ã€åŠ›æ‰£è§è¯äº†æˆ‘æ—¥å¤ä¸€æ—¥çš„å‹¤å¥‹ç»ƒä¹ ã€‚å¤§äºŒå­¦å¹´ï¼Œæˆ‘ä»¥æ±—æ°´æµ‡çŒï¼Œå…±è·å¾—äº†12é¡¹ç«èµ›è£èª‰ï¼Œå…¶ä¸­åŒ…æ‹¬8é¡¹å›½å®¶çº§å¥–é¡¹å’Œ2é¡¹çœçº§å¥–é¡¹ï¼Œç§‘åˆ›ç§¯åˆ†ä¹Ÿå®ç°äº†ä»0åˆ°116åˆ†çš„é£è·ƒã€‚ï¼ˆç¿»é¡µï¼‰\n\n   åœ¨ç§‘ç ”é¢†åŸŸï¼Œæˆ‘ä¸ä»…å·©å›ºäº†ç†è®ºçŸ¥è¯†ï¼Œåœ¨ç ”ç©¶ç”Ÿçš„æŒ‡å¯¼ä¸‹é˜…è¯»äº†10ä½™ç¯‡è®ºæ–‡ï¼Œè¿˜èº¬è¡Œå®è·µï¼Œä¸å›¢é˜Ÿæˆå‘˜å…±åŒå¼€å‘åŒ–å·¥å¤§æ¨¡å‹å¤§åˆ›é¡¹ç›®ã€‚ï¼ˆç¿»é¡µï¼‰\n\n   æˆ‘ç§¯ææ¢ç´¢åç«¯æœ€æ–°æŠ€æœ¯ï¼Œæ·±å…¥Goè¯­è¨€çš„åº•å±‚åŸç†ï¼Œæ¢ç´¢é«˜æ€§èƒ½æ¶æ„è®¾è®¡ï¼Œç‹¬ç«‹æ­å»ºäº†ä¸ªäººåšå®¢ï¼Œåˆ†äº«æ‰€è§æ‰€é—»ã€‚ï¼ˆç¿»é¡µï¼‰\n\n   è‡³ä»Šï¼Œå·²æœ‰åº•å±‚åŸç†ç¬”è®°è¿‘**2ä¸‡å­—**ï¼Œ**ç‹¬ç«‹å¼€å‘å¹¶å¼€æº**çŸ­é“¾ç³»ç»Ÿï¼Œå‘å¸ƒ**20**ä½™ç¯‡æŠ€æœ¯æ–‡ç« ï¼Œæ€»å­—æ•°è¶…è¿‡**6ä¸‡å­—**ã€‚ï¼ˆç¿»é¡µï¼‰\n\n**ä¸‰ã€é¥®æ°´æ€æºï¼Œæ•£å‘è¤ç«ä¹‹å…‰**\n\n   ä½œä¸ºè…¾è®¯ç»„çš„æ ¸å¿ƒæˆå‘˜ï¼Œæˆ‘ä¸ä»…ç§¯æå‚ä¸æŠ€æœ¯æ ˆå»ºè®¾ï¼Œä¸ºå›¢é˜Ÿæˆå‘˜æä¾›ä¸°å¯Œçš„å­¦ä¹ èµ„æºï¼Œè¿˜è‡´åŠ›äºåŸ¹å…»å›¢é˜Ÿåç«¯æŠ€æœ¯äººæ‰ï¼Œç§¯æå›åº”å›¢é˜Ÿæˆå‘˜çš„ç–‘é—®ã€‚æŠ€æœ¯æ ˆå·²æ”¶å½•åšå®¢**äºŒå**ç¯‡ ä¸ªäººè´¡çŒ®**3**ç¯‡ 23çº§ç»„å‘˜åäºº **ç™¾åˆ†ç™¾** å­¦ä¹ ä¼˜ç§€å¥–å­¦é‡‘ã€‚ç”¨è¡ŒåŠ¨è¯ é‡Š**â€œ****æœ‰ä¸€åˆ†çƒ­ï¼Œå°±è¦å‘ä¸€åˆ†å…‰â€**çš„ç²¾ç¥ã€‚ï¼ˆç¿»é¡µï¼‰\n\n**æ€»ç»“**\n\n   æˆ‘å§‹ç»ˆåšä¿¡ï¼šä¸é©°äºç©ºæƒ³ï¼Œä¸éª›äºè™šå£°ï¼Œå”¯æœ‰ä»¥**æ±‚å®**çš„æ€åº¦ï¼Œ**è¸å®**çš„å·¥ä½œï¼Œæ‰èƒ½èµ°å¾—æ›´è¿œã€‚ï¼ˆç¿»é¡µï¼‰\n\n   å±•æœ›æœªæ¥ï¼Œæ„¿æˆ‘ä»¬éƒ½èƒ½ä¸ºçœŸç†çš„**æºè¿œæ ¹æ·±**è€Œåªäº‰æœå¤•ï¼Œä¸ºäº‰åš**å—é‡‘ä¸œç®­**è€Œæ‹¼æå¥‹æ–—ã€‚\n\n   æˆ‘çš„æ±‡æŠ¥åˆ°æ­¤ç»“æŸï¼Œè°¢è°¢å¤§å®¶ã€‚","slug":"æ¢å–Mac OSç¬¬ä¸€æ­¥","published":1,"date":"2024-12-27T11:03:15.344Z","updated":"2024-12-27T11:03:15.344Z","comments":1,"layout":"post","photos":[],"_id":"cm6c7md6j0013a5t2bsvu15js","content":"<h2 id=\"å¤§çº²\"><a href=\"#å¤§çº²\" class=\"headerlink\" title=\"å¤§çº²\"></a>å¤§çº²</h2><h3 id=\"è‡ªæˆ‘ä»‹ç»\"><a href=\"#è‡ªæˆ‘ä»‹ç»\" class=\"headerlink\" title=\"è‡ªæˆ‘ä»‹ç»\"></a>è‡ªæˆ‘ä»‹ç»</h3><ul>\n<li>å§“å </li>\n<li>ç­çº§ </li>\n<li>æ”¿æ²»é¢è²Œ<ul>\n<li>å…±é’å›¢å‘˜</li>\n</ul>\n</li>\n<li>æ’å<ul>\n<li><strong>12&#x2F;393</strong></li>\n<li><strong>163 â€”-&gt; 12</strong></li>\n</ul>\n</li>\n<li>æˆç»©<ul>\n<li><strong>å¿˜äº†å‡åˆ†</strong></li>\n<li>ç¦»æ•£æ•°å­¦2 98</li>\n<li>è®¡ç®—æœºæ•°å­¦åŸºç¡€ 98</li>\n<li>è®¡ç®—æœºç»„ç»‡ä¸ç»“æ„ 93</li>\n<li>å¤§å­¦ç‰©ç†(è½¯) 96</li>\n<li>æ“ä½œç³»ç»Ÿ 92</li>\n<li>å¤§å­¦è‹±è¯­3 98</li>\n<li>æ¦‚ç‡ä¸ç»Ÿè®¡A 99</li>\n<li>æ•°æ®ç»“æ„ä¸ç®—æ³• 97</li>\n<li>è®¡ç®—æœºç»„ç»‡ä¸ç»“æ„å®éªŒ 95</li>\n</ul>\n</li>\n<li>è·å¥–æƒ…å†µ<ul>\n<li>å­¦ä¹ ä¼˜ç§€å¥–å­¦é‡‘ï¼ˆä¸€ç­‰ï¼‰</li>\n<li>ç§‘æŠ€åˆ›æ–°å¥–å­¦é‡‘</li>\n<li>CCF CSP ç¬¬31æ¬¡è®¤è¯ é™¢çº§äºŒç­‰å¥–</li>\n<li>ç¬¬åä¹å±Šç™¾åº¦ä¹‹æ˜Ÿç¨‹åºè®¾è®¡å¤§èµ›åˆèµ› çœçº§ä¸‰ç­‰å¥–</li>\n<li>2023å¹´ç¬¬å››å±Šå…¨å›½å¤§å­¦ç”Ÿç®—æ³•è®¾è®¡ä¸ç¼–ç¨‹æŒ‘æˆ˜èµ›ï¼ˆç§‹å­£èµ›ï¼‰ å›½å®¶çº§ä¸‰ç­‰å¥–</li>\n<li>2023å¹´ç¬¬åä¸‰å±ŠAPMCMäºšå¤ªåœ°åŒºå¤§å­¦ç”Ÿæ•°å­¦å»ºæ¨¡ç«èµ› å›½å®¶çº§ä¸‰ç­‰å¥–</li>\n<li>2023å¹´å…¨å›½å¤§å­¦ç”Ÿä¿¡æ¯æŠ€æœ¯è®¤è¯æŒ‘æˆ˜èµ› å›½å®¶çº§ä¸‰ç­‰å¥–</li>\n<li>2024å¹´ç¬¬äº”å±Šå…¨å›½å¤§å­¦ç”Ÿç®—æ³•è®¾è®¡ä¸ç¼–ç¨‹æŒ‘æˆ˜èµ›ï¼ˆæ˜¥å­£èµ›ï¼‰ å›½å®¶çº§ä¸‰ç­‰å¥–</li>\n<li>ç¬¬äº”å±Šå…¨å›½é«˜æ ¡è®¡ç®—æœºèƒ½åŠ›æŒ‘æˆ˜èµ›-C++ å›½å®¶çº§äºŒç­‰å¥–</li>\n<li>ç¬¬åäº”å±Šè“æ¡¥æ¯å…¨å›½è½¯ä»¶å’Œä¿¡æ¯æŠ€æœ¯ä¸“ä¸šäººæ‰å¤§èµ›è¾½å®èµ›åŒº çœçº§äºŒç­‰å¥–</li>\n<li>2024å¹´ç¾å›½å¤§å­¦ç”Ÿæ•°å­¦å»ºæ¨¡ç«èµ› å›½å®¶çº§Hå¥–</li>\n<li>2024å¹´ç¬¬äºŒå±Šå…¨å›½å¤§å­¦ç”Ÿä¿¡æ¯æŠ€æœ¯è®¤è¯æŒ‘æˆ˜èµ› å›½å®¶çº§ä¸‰ç­‰å¥–</li>\n<li>2024å¹´ä¸­å›½é«˜æ ¡è®¡ç®—æœºå¤§èµ›-AIGCåˆ›æ–°èµ›-åº”ç”¨èµ›é“ï¼ˆæ ¡èµ›ï¼‰ æ ¡çº§ä¸€ç­‰å¥–</li>\n<li>2023é¦–å±Šå¤§å­¦ç”Ÿç®—æ³•å¤§èµ› ä¼˜ç§€å¥–</li>\n<li>116ç§¯åˆ†</li>\n</ul>\n</li>\n<li>èº«ä»½</li>\n</ul>\n<h3 id=\"æˆç»©ã€ç§‘åˆ›ã€åç«¯\"><a href=\"#æˆç»©ã€ç§‘åˆ›ã€åç«¯\" class=\"headerlink\" title=\"æˆç»©ã€ç§‘åˆ›ã€åç«¯\"></a>æˆç»©ã€ç§‘åˆ›ã€åç«¯</h3><ul>\n<li>æˆç»©<ul>\n<li>å¤§ä¸€å­¦å¹´60 â€”â€“&gt; å¤§äºŒå­¦å¹´12</li>\n<li>è¿‡ç¨‹<ul>\n<li>è®¤çœŸå¬è®²</li>\n<li>ä»”ç»†åšç¬”è®°</li>\n<li>é‡å¤é‡å¤é‡å¤</li>\n</ul>\n</li>\n</ul>\n</li>\n<li>ç§‘åˆ›å¥–é¡¹<ul>\n<li>ç§‘åˆ›ç§¯åˆ†116</li>\n<li>å›½å®¶çº§å¥–é¡¹8é¡¹</li>\n<li>ä½œä¸ºåˆ›ä¸­ä¸€ä»½å­ï¼Œç§¯ææŠ•èº«äºç§‘åˆ›ç«èµ›</li>\n</ul>\n</li>\n<li>åç«¯<ul>\n<li>å¼€æºçŸ­é“¾é¡¹ç›®</li>\n<li>æ·±å…¥å­¦ä¹ MySQLåŸç†</li>\n<li>æ·±å…¥å­¦ä¹ RedisåŸç†</li>\n<li>åšå®¢</li>\n<li>æ€è·¯ï¼š<ul>\n<li>åç«¯æ¶æ„æŠ€æœ¯ï¼Œè‡ªå­¦Goè¯­è¨€å¹¶ç§¯ç´¯è¿‘2wå­—å­¦ä¹ ç¬”è®°</li>\n<li>ä¸ºäº†æ›´å¥½åœ°æé«˜ç³»ç»Ÿæ€§èƒ½ï¼Œæ·±å…¥å­¦ä¹ MySQLã€Redisåº•å±‚åŸç†ï¼Œä¸åº•å±‚Cè¯­è¨€å®ç°ä»£ç æ–—æ™ºæ–—å‹‡</li>\n<li>ä¸ªäººåšå®¢</li>\n</ul>\n</li>\n</ul>\n</li>\n<li>ç§‘ç ”<ul>\n<li>å¤§åˆ›ï¼ˆè¹­ï¼‰</li>\n<li>è®ºæ–‡</li>\n</ul>\n</li>\n</ul>\n<h3 id=\"å­¦ç”Ÿå·¥ä½œ\"><a href=\"#å­¦ç”Ÿå·¥ä½œ\" class=\"headerlink\" title=\"å­¦ç”Ÿå·¥ä½œ\"></a>å­¦ç”Ÿå·¥ä½œ</h3><ul>\n<li>ä¾‹ä¼š</li>\n<li>åŸ¹å…»å¤§ä¸€&#x2F;äºŒåŒå­¦</li>\n</ul>\n<h3 id=\"æ€»ç»“\"><a href=\"#æ€»ç»“\" class=\"headerlink\" title=\"æ€»ç»“\"></a>æ€»ç»“</h3><h2 id=\"aba\"><a href=\"#aba\" class=\"headerlink\" title=\"aba\"></a>aba</h2><ul>\n<li>è‡ªæˆ‘ä»‹ç»ï¼šä¸€å¹´ä»¥æ¥çš„ç§¯ç´¯<ul>\n<li>ç‰¹ç‚¹</li>\n</ul>\n</li>\n<li>ç›®å½•</li>\n<li>è¿‡ç¨‹â€”&gt;ç»“æœ</li>\n<li>é‡â€”-&gt;æ€»ç»“è¿‡ç¨‹â€”-&gt;ç²¾ç¥</li>\n<li>é¡¹ç›®ï¼šæ‰¿æ‹…ä»€ä¹ˆè§’è‰²ã€ä»€ä¹ˆæå‡</li>\n<li>æˆæœç½—åˆ—é¡µ</li>\n</ul>\n<h2 id=\"ç¨¿å­\"><a href=\"#ç¨¿å­\" class=\"headerlink\" title=\"ç¨¿å­\"></a>ç¨¿å­</h2><p>â€‹    å°Šæ•¬çš„å„ä½è¯„å§”è€å¸ˆï¼Œæ™šä¸Šå¥½ï¼æˆ‘æ˜¯æ¥è‡ªè½¯ 2213 ç­çš„ææºä¸œã€‚å¾ˆè£å¹¸å‚åŠ æœ¬æ¬¡å›½å®¶å¥–å­¦é‡‘æ±‡æŠ¥ã€‚æˆ‘æ±‡æŠ¥çš„ä¸»é¢˜æ˜¯ â€œè„šè¸å®åœ° æºè¿œæµé•¿ åªäº‰æœå¤• å‹¤å‹‰è‡´è¿œâ€ï¼ˆç¿»é¡µï¼‰</p>\n<p>   å¤§äºŒå­¦å¹´ï¼Œæˆ‘è£è·äº†ä¸€ç­‰å­¦ä¹ ä¼˜ç§€å¥–å­¦é‡‘ã€æ ¡ä¸‰å¥½å­¦ç”Ÿã€ç§‘æŠ€åˆ›æ–°å¥–å­¦é‡‘ç­‰è£èª‰ã€‚ï¼ˆç¿»é¡µï¼‰</p>\n<p><strong>ä¸€ã€è„šè¸å®åœ°ï¼Œå®ç°æˆç»©é£è·ƒ</strong></p>\n<p>   é¢å¯¹å¤§ä¸€ä¸Šä¸å°½äººæ„çš„æˆç»©ï¼Œæˆ‘å†…å¿ƒå……æ»¡ä¸ç”˜ã€‚æˆ‘ä¸æ„¿å°±æ­¤æ¶ˆæ²‰ï¼Œæ›´ä¸æ„¿è®©çˆ¶æ¯å¤±æœ›ã€‚ä»æ­¤ï¼Œæˆ‘æˆä¸ºäº†è‡ªä¹ å®¤çš„å¸¸å®¢ã€æ•™å®¤å‰æ’çš„åšå®ˆè€…ï¼Œ300ä½™é¡µçš„ç¬”è®°ï¼Œ300å¤šä¸ªæ—¥å¤œçš„è¾›å‹¤åŠªåŠ›ï¼Œç»ˆäºåœ¨å¤§äºŒå­¦å¹´ï¼Œæˆ‘å®ç°äº†ä¸“ä¸šæ’åä»**33%**<strong>åˆ°3%*<em><strong>çš„é£è·ƒ</strong>ï¼Œä»</em>*ä»…æœ‰</strong>ä¸€é—¨è¯¾ç¨‹æˆç»©90+ï¼Œåˆ°å¤§äºŒå­¦å¹´10é—¨å¿…ä¿®è¯¾90+ã€‚ï¼ˆç¿»é¡µï¼‰</p>\n<p><strong>äºŒã€åªäº‰æœå¤•ï¼Œç£¨ç ºç§‘æŠ€åˆ›æ–°</strong></p>\n<p>â€‹    æ— è®ºæ˜¯æ˜¥åç§‹å®è¿˜æ˜¯å†¬å†·å¤çƒ­ï¼Œæ´›è°·ã€åŠ›æ‰£è§è¯äº†æˆ‘æ—¥å¤ä¸€æ—¥çš„å‹¤å¥‹ç»ƒä¹ ã€‚å¤§äºŒå­¦å¹´ï¼Œæˆ‘ä»¥æ±—æ°´æµ‡çŒï¼Œå…±è·å¾—äº†12é¡¹ç«èµ›è£èª‰ï¼Œå…¶ä¸­åŒ…æ‹¬8é¡¹å›½å®¶çº§å¥–é¡¹å’Œ2é¡¹çœçº§å¥–é¡¹ï¼Œç§‘åˆ›ç§¯åˆ†ä¹Ÿå®ç°äº†ä»0åˆ°116åˆ†çš„é£è·ƒã€‚ï¼ˆç¿»é¡µï¼‰</p>\n<p>   åœ¨ç§‘ç ”é¢†åŸŸï¼Œæˆ‘ä¸ä»…å·©å›ºäº†ç†è®ºçŸ¥è¯†ï¼Œåœ¨ç ”ç©¶ç”Ÿçš„æŒ‡å¯¼ä¸‹é˜…è¯»äº†10ä½™ç¯‡è®ºæ–‡ï¼Œè¿˜èº¬è¡Œå®è·µï¼Œä¸å›¢é˜Ÿæˆå‘˜å…±åŒå¼€å‘åŒ–å·¥å¤§æ¨¡å‹å¤§åˆ›é¡¹ç›®ã€‚ï¼ˆç¿»é¡µï¼‰</p>\n<p>   æˆ‘ç§¯ææ¢ç´¢åç«¯æœ€æ–°æŠ€æœ¯ï¼Œæ·±å…¥Goè¯­è¨€çš„åº•å±‚åŸç†ï¼Œæ¢ç´¢é«˜æ€§èƒ½æ¶æ„è®¾è®¡ï¼Œç‹¬ç«‹æ­å»ºäº†ä¸ªäººåšå®¢ï¼Œåˆ†äº«æ‰€è§æ‰€é—»ã€‚ï¼ˆç¿»é¡µï¼‰</p>\n<p>   è‡³ä»Šï¼Œå·²æœ‰åº•å±‚åŸç†ç¬”è®°è¿‘<strong>2ä¸‡å­—</strong>ï¼Œ<strong>ç‹¬ç«‹å¼€å‘å¹¶å¼€æº</strong>çŸ­é“¾ç³»ç»Ÿï¼Œå‘å¸ƒ<strong>20</strong>ä½™ç¯‡æŠ€æœ¯æ–‡ç« ï¼Œæ€»å­—æ•°è¶…è¿‡<strong>6ä¸‡å­—</strong>ã€‚ï¼ˆç¿»é¡µï¼‰</p>\n<p><strong>ä¸‰ã€é¥®æ°´æ€æºï¼Œæ•£å‘è¤ç«ä¹‹å…‰</strong></p>\n<p>   ä½œä¸ºè…¾è®¯ç»„çš„æ ¸å¿ƒæˆå‘˜ï¼Œæˆ‘ä¸ä»…ç§¯æå‚ä¸æŠ€æœ¯æ ˆå»ºè®¾ï¼Œä¸ºå›¢é˜Ÿæˆå‘˜æä¾›ä¸°å¯Œçš„å­¦ä¹ èµ„æºï¼Œè¿˜è‡´åŠ›äºåŸ¹å…»å›¢é˜Ÿåç«¯æŠ€æœ¯äººæ‰ï¼Œç§¯æå›åº”å›¢é˜Ÿæˆå‘˜çš„ç–‘é—®ã€‚æŠ€æœ¯æ ˆå·²æ”¶å½•åšå®¢<strong>äºŒå</strong>ç¯‡ ä¸ªäººè´¡çŒ®<strong>3</strong>ç¯‡ 23çº§ç»„å‘˜åäºº <strong>ç™¾åˆ†ç™¾</strong> å­¦ä¹ ä¼˜ç§€å¥–å­¦é‡‘ã€‚ç”¨è¡ŒåŠ¨è¯ é‡Š<strong>â€œ****æœ‰ä¸€åˆ†çƒ­ï¼Œå°±è¦å‘ä¸€åˆ†å…‰â€</strong>çš„ç²¾ç¥ã€‚ï¼ˆç¿»é¡µï¼‰</p>\n<p><strong>æ€»ç»“</strong></p>\n<p>   æˆ‘å§‹ç»ˆåšä¿¡ï¼šä¸é©°äºç©ºæƒ³ï¼Œä¸éª›äºè™šå£°ï¼Œå”¯æœ‰ä»¥<strong>æ±‚å®</strong>çš„æ€åº¦ï¼Œ<strong>è¸å®</strong>çš„å·¥ä½œï¼Œæ‰èƒ½èµ°å¾—æ›´è¿œã€‚ï¼ˆç¿»é¡µï¼‰</p>\n<p>   å±•æœ›æœªæ¥ï¼Œæ„¿æˆ‘ä»¬éƒ½èƒ½ä¸ºçœŸç†çš„<strong>æºè¿œæ ¹æ·±</strong>è€Œåªäº‰æœå¤•ï¼Œä¸ºäº‰åš<strong>å—é‡‘ä¸œç®­</strong>è€Œæ‹¼æå¥‹æ–—ã€‚</p>\n<p>   æˆ‘çš„æ±‡æŠ¥åˆ°æ­¤ç»“æŸï¼Œè°¢è°¢å¤§å®¶ã€‚</p>\n","excerpt":"","more":"<h2 id=\"å¤§çº²\"><a href=\"#å¤§çº²\" class=\"headerlink\" title=\"å¤§çº²\"></a>å¤§çº²</h2><h3 id=\"è‡ªæˆ‘ä»‹ç»\"><a href=\"#è‡ªæˆ‘ä»‹ç»\" class=\"headerlink\" title=\"è‡ªæˆ‘ä»‹ç»\"></a>è‡ªæˆ‘ä»‹ç»</h3><ul>\n<li>å§“å </li>\n<li>ç­çº§ </li>\n<li>æ”¿æ²»é¢è²Œ<ul>\n<li>å…±é’å›¢å‘˜</li>\n</ul>\n</li>\n<li>æ’å<ul>\n<li><strong>12&#x2F;393</strong></li>\n<li><strong>163 â€”-&gt; 12</strong></li>\n</ul>\n</li>\n<li>æˆç»©<ul>\n<li><strong>å¿˜äº†å‡åˆ†</strong></li>\n<li>ç¦»æ•£æ•°å­¦2 98</li>\n<li>è®¡ç®—æœºæ•°å­¦åŸºç¡€ 98</li>\n<li>è®¡ç®—æœºç»„ç»‡ä¸ç»“æ„ 93</li>\n<li>å¤§å­¦ç‰©ç†(è½¯) 96</li>\n<li>æ“ä½œç³»ç»Ÿ 92</li>\n<li>å¤§å­¦è‹±è¯­3 98</li>\n<li>æ¦‚ç‡ä¸ç»Ÿè®¡A 99</li>\n<li>æ•°æ®ç»“æ„ä¸ç®—æ³• 97</li>\n<li>è®¡ç®—æœºç»„ç»‡ä¸ç»“æ„å®éªŒ 95</li>\n</ul>\n</li>\n<li>è·å¥–æƒ…å†µ<ul>\n<li>å­¦ä¹ ä¼˜ç§€å¥–å­¦é‡‘ï¼ˆä¸€ç­‰ï¼‰</li>\n<li>ç§‘æŠ€åˆ›æ–°å¥–å­¦é‡‘</li>\n<li>CCF CSP ç¬¬31æ¬¡è®¤è¯ é™¢çº§äºŒç­‰å¥–</li>\n<li>ç¬¬åä¹å±Šç™¾åº¦ä¹‹æ˜Ÿç¨‹åºè®¾è®¡å¤§èµ›åˆèµ› çœçº§ä¸‰ç­‰å¥–</li>\n<li>2023å¹´ç¬¬å››å±Šå…¨å›½å¤§å­¦ç”Ÿç®—æ³•è®¾è®¡ä¸ç¼–ç¨‹æŒ‘æˆ˜èµ›ï¼ˆç§‹å­£èµ›ï¼‰ å›½å®¶çº§ä¸‰ç­‰å¥–</li>\n<li>2023å¹´ç¬¬åä¸‰å±ŠAPMCMäºšå¤ªåœ°åŒºå¤§å­¦ç”Ÿæ•°å­¦å»ºæ¨¡ç«èµ› å›½å®¶çº§ä¸‰ç­‰å¥–</li>\n<li>2023å¹´å…¨å›½å¤§å­¦ç”Ÿä¿¡æ¯æŠ€æœ¯è®¤è¯æŒ‘æˆ˜èµ› å›½å®¶çº§ä¸‰ç­‰å¥–</li>\n<li>2024å¹´ç¬¬äº”å±Šå…¨å›½å¤§å­¦ç”Ÿç®—æ³•è®¾è®¡ä¸ç¼–ç¨‹æŒ‘æˆ˜èµ›ï¼ˆæ˜¥å­£èµ›ï¼‰ å›½å®¶çº§ä¸‰ç­‰å¥–</li>\n<li>ç¬¬äº”å±Šå…¨å›½é«˜æ ¡è®¡ç®—æœºèƒ½åŠ›æŒ‘æˆ˜èµ›-C++ å›½å®¶çº§äºŒç­‰å¥–</li>\n<li>ç¬¬åäº”å±Šè“æ¡¥æ¯å…¨å›½è½¯ä»¶å’Œä¿¡æ¯æŠ€æœ¯ä¸“ä¸šäººæ‰å¤§èµ›è¾½å®èµ›åŒº çœçº§äºŒç­‰å¥–</li>\n<li>2024å¹´ç¾å›½å¤§å­¦ç”Ÿæ•°å­¦å»ºæ¨¡ç«èµ› å›½å®¶çº§Hå¥–</li>\n<li>2024å¹´ç¬¬äºŒå±Šå…¨å›½å¤§å­¦ç”Ÿä¿¡æ¯æŠ€æœ¯è®¤è¯æŒ‘æˆ˜èµ› å›½å®¶çº§ä¸‰ç­‰å¥–</li>\n<li>2024å¹´ä¸­å›½é«˜æ ¡è®¡ç®—æœºå¤§èµ›-AIGCåˆ›æ–°èµ›-åº”ç”¨èµ›é“ï¼ˆæ ¡èµ›ï¼‰ æ ¡çº§ä¸€ç­‰å¥–</li>\n<li>2023é¦–å±Šå¤§å­¦ç”Ÿç®—æ³•å¤§èµ› ä¼˜ç§€å¥–</li>\n<li>116ç§¯åˆ†</li>\n</ul>\n</li>\n<li>èº«ä»½</li>\n</ul>\n<h3 id=\"æˆç»©ã€ç§‘åˆ›ã€åç«¯\"><a href=\"#æˆç»©ã€ç§‘åˆ›ã€åç«¯\" class=\"headerlink\" title=\"æˆç»©ã€ç§‘åˆ›ã€åç«¯\"></a>æˆç»©ã€ç§‘åˆ›ã€åç«¯</h3><ul>\n<li>æˆç»©<ul>\n<li>å¤§ä¸€å­¦å¹´60 â€”â€“&gt; å¤§äºŒå­¦å¹´12</li>\n<li>è¿‡ç¨‹<ul>\n<li>è®¤çœŸå¬è®²</li>\n<li>ä»”ç»†åšç¬”è®°</li>\n<li>é‡å¤é‡å¤é‡å¤</li>\n</ul>\n</li>\n</ul>\n</li>\n<li>ç§‘åˆ›å¥–é¡¹<ul>\n<li>ç§‘åˆ›ç§¯åˆ†116</li>\n<li>å›½å®¶çº§å¥–é¡¹8é¡¹</li>\n<li>ä½œä¸ºåˆ›ä¸­ä¸€ä»½å­ï¼Œç§¯ææŠ•èº«äºç§‘åˆ›ç«èµ›</li>\n</ul>\n</li>\n<li>åç«¯<ul>\n<li>å¼€æºçŸ­é“¾é¡¹ç›®</li>\n<li>æ·±å…¥å­¦ä¹ MySQLåŸç†</li>\n<li>æ·±å…¥å­¦ä¹ RedisåŸç†</li>\n<li>åšå®¢</li>\n<li>æ€è·¯ï¼š<ul>\n<li>åç«¯æ¶æ„æŠ€æœ¯ï¼Œè‡ªå­¦Goè¯­è¨€å¹¶ç§¯ç´¯è¿‘2wå­—å­¦ä¹ ç¬”è®°</li>\n<li>ä¸ºäº†æ›´å¥½åœ°æé«˜ç³»ç»Ÿæ€§èƒ½ï¼Œæ·±å…¥å­¦ä¹ MySQLã€Redisåº•å±‚åŸç†ï¼Œä¸åº•å±‚Cè¯­è¨€å®ç°ä»£ç æ–—æ™ºæ–—å‹‡</li>\n<li>ä¸ªäººåšå®¢</li>\n</ul>\n</li>\n</ul>\n</li>\n<li>ç§‘ç ”<ul>\n<li>å¤§åˆ›ï¼ˆè¹­ï¼‰</li>\n<li>è®ºæ–‡</li>\n</ul>\n</li>\n</ul>\n<h3 id=\"å­¦ç”Ÿå·¥ä½œ\"><a href=\"#å­¦ç”Ÿå·¥ä½œ\" class=\"headerlink\" title=\"å­¦ç”Ÿå·¥ä½œ\"></a>å­¦ç”Ÿå·¥ä½œ</h3><ul>\n<li>ä¾‹ä¼š</li>\n<li>åŸ¹å…»å¤§ä¸€&#x2F;äºŒåŒå­¦</li>\n</ul>\n<h3 id=\"æ€»ç»“\"><a href=\"#æ€»ç»“\" class=\"headerlink\" title=\"æ€»ç»“\"></a>æ€»ç»“</h3><h2 id=\"aba\"><a href=\"#aba\" class=\"headerlink\" title=\"aba\"></a>aba</h2><ul>\n<li>è‡ªæˆ‘ä»‹ç»ï¼šä¸€å¹´ä»¥æ¥çš„ç§¯ç´¯<ul>\n<li>ç‰¹ç‚¹</li>\n</ul>\n</li>\n<li>ç›®å½•</li>\n<li>è¿‡ç¨‹â€”&gt;ç»“æœ</li>\n<li>é‡â€”-&gt;æ€»ç»“è¿‡ç¨‹â€”-&gt;ç²¾ç¥</li>\n<li>é¡¹ç›®ï¼šæ‰¿æ‹…ä»€ä¹ˆè§’è‰²ã€ä»€ä¹ˆæå‡</li>\n<li>æˆæœç½—åˆ—é¡µ</li>\n</ul>\n<h2 id=\"ç¨¿å­\"><a href=\"#ç¨¿å­\" class=\"headerlink\" title=\"ç¨¿å­\"></a>ç¨¿å­</h2><p>â€‹    å°Šæ•¬çš„å„ä½è¯„å§”è€å¸ˆï¼Œæ™šä¸Šå¥½ï¼æˆ‘æ˜¯æ¥è‡ªè½¯ 2213 ç­çš„ææºä¸œã€‚å¾ˆè£å¹¸å‚åŠ æœ¬æ¬¡å›½å®¶å¥–å­¦é‡‘æ±‡æŠ¥ã€‚æˆ‘æ±‡æŠ¥çš„ä¸»é¢˜æ˜¯ â€œè„šè¸å®åœ° æºè¿œæµé•¿ åªäº‰æœå¤• å‹¤å‹‰è‡´è¿œâ€ï¼ˆç¿»é¡µï¼‰</p>\n<p>   å¤§äºŒå­¦å¹´ï¼Œæˆ‘è£è·äº†ä¸€ç­‰å­¦ä¹ ä¼˜ç§€å¥–å­¦é‡‘ã€æ ¡ä¸‰å¥½å­¦ç”Ÿã€ç§‘æŠ€åˆ›æ–°å¥–å­¦é‡‘ç­‰è£èª‰ã€‚ï¼ˆç¿»é¡µï¼‰</p>\n<p><strong>ä¸€ã€è„šè¸å®åœ°ï¼Œå®ç°æˆç»©é£è·ƒ</strong></p>\n<p>   é¢å¯¹å¤§ä¸€ä¸Šä¸å°½äººæ„çš„æˆç»©ï¼Œæˆ‘å†…å¿ƒå……æ»¡ä¸ç”˜ã€‚æˆ‘ä¸æ„¿å°±æ­¤æ¶ˆæ²‰ï¼Œæ›´ä¸æ„¿è®©çˆ¶æ¯å¤±æœ›ã€‚ä»æ­¤ï¼Œæˆ‘æˆä¸ºäº†è‡ªä¹ å®¤çš„å¸¸å®¢ã€æ•™å®¤å‰æ’çš„åšå®ˆè€…ï¼Œ300ä½™é¡µçš„ç¬”è®°ï¼Œ300å¤šä¸ªæ—¥å¤œçš„è¾›å‹¤åŠªåŠ›ï¼Œç»ˆäºåœ¨å¤§äºŒå­¦å¹´ï¼Œæˆ‘å®ç°äº†ä¸“ä¸šæ’åä»**33%**<strong>åˆ°3%*<em><strong>çš„é£è·ƒ</strong>ï¼Œä»</em>*ä»…æœ‰</strong>ä¸€é—¨è¯¾ç¨‹æˆç»©90+ï¼Œåˆ°å¤§äºŒå­¦å¹´10é—¨å¿…ä¿®è¯¾90+ã€‚ï¼ˆç¿»é¡µï¼‰</p>\n<p><strong>äºŒã€åªäº‰æœå¤•ï¼Œç£¨ç ºç§‘æŠ€åˆ›æ–°</strong></p>\n<p>â€‹    æ— è®ºæ˜¯æ˜¥åç§‹å®è¿˜æ˜¯å†¬å†·å¤çƒ­ï¼Œæ´›è°·ã€åŠ›æ‰£è§è¯äº†æˆ‘æ—¥å¤ä¸€æ—¥çš„å‹¤å¥‹ç»ƒä¹ ã€‚å¤§äºŒå­¦å¹´ï¼Œæˆ‘ä»¥æ±—æ°´æµ‡çŒï¼Œå…±è·å¾—äº†12é¡¹ç«èµ›è£èª‰ï¼Œå…¶ä¸­åŒ…æ‹¬8é¡¹å›½å®¶çº§å¥–é¡¹å’Œ2é¡¹çœçº§å¥–é¡¹ï¼Œç§‘åˆ›ç§¯åˆ†ä¹Ÿå®ç°äº†ä»0åˆ°116åˆ†çš„é£è·ƒã€‚ï¼ˆç¿»é¡µï¼‰</p>\n<p>   åœ¨ç§‘ç ”é¢†åŸŸï¼Œæˆ‘ä¸ä»…å·©å›ºäº†ç†è®ºçŸ¥è¯†ï¼Œåœ¨ç ”ç©¶ç”Ÿçš„æŒ‡å¯¼ä¸‹é˜…è¯»äº†10ä½™ç¯‡è®ºæ–‡ï¼Œè¿˜èº¬è¡Œå®è·µï¼Œä¸å›¢é˜Ÿæˆå‘˜å…±åŒå¼€å‘åŒ–å·¥å¤§æ¨¡å‹å¤§åˆ›é¡¹ç›®ã€‚ï¼ˆç¿»é¡µï¼‰</p>\n<p>   æˆ‘ç§¯ææ¢ç´¢åç«¯æœ€æ–°æŠ€æœ¯ï¼Œæ·±å…¥Goè¯­è¨€çš„åº•å±‚åŸç†ï¼Œæ¢ç´¢é«˜æ€§èƒ½æ¶æ„è®¾è®¡ï¼Œç‹¬ç«‹æ­å»ºäº†ä¸ªäººåšå®¢ï¼Œåˆ†äº«æ‰€è§æ‰€é—»ã€‚ï¼ˆç¿»é¡µï¼‰</p>\n<p>   è‡³ä»Šï¼Œå·²æœ‰åº•å±‚åŸç†ç¬”è®°è¿‘<strong>2ä¸‡å­—</strong>ï¼Œ<strong>ç‹¬ç«‹å¼€å‘å¹¶å¼€æº</strong>çŸ­é“¾ç³»ç»Ÿï¼Œå‘å¸ƒ<strong>20</strong>ä½™ç¯‡æŠ€æœ¯æ–‡ç« ï¼Œæ€»å­—æ•°è¶…è¿‡<strong>6ä¸‡å­—</strong>ã€‚ï¼ˆç¿»é¡µï¼‰</p>\n<p><strong>ä¸‰ã€é¥®æ°´æ€æºï¼Œæ•£å‘è¤ç«ä¹‹å…‰</strong></p>\n<p>   ä½œä¸ºè…¾è®¯ç»„çš„æ ¸å¿ƒæˆå‘˜ï¼Œæˆ‘ä¸ä»…ç§¯æå‚ä¸æŠ€æœ¯æ ˆå»ºè®¾ï¼Œä¸ºå›¢é˜Ÿæˆå‘˜æä¾›ä¸°å¯Œçš„å­¦ä¹ èµ„æºï¼Œè¿˜è‡´åŠ›äºåŸ¹å…»å›¢é˜Ÿåç«¯æŠ€æœ¯äººæ‰ï¼Œç§¯æå›åº”å›¢é˜Ÿæˆå‘˜çš„ç–‘é—®ã€‚æŠ€æœ¯æ ˆå·²æ”¶å½•åšå®¢<strong>äºŒå</strong>ç¯‡ ä¸ªäººè´¡çŒ®<strong>3</strong>ç¯‡ 23çº§ç»„å‘˜åäºº <strong>ç™¾åˆ†ç™¾</strong> å­¦ä¹ ä¼˜ç§€å¥–å­¦é‡‘ã€‚ç”¨è¡ŒåŠ¨è¯ é‡Š<strong>â€œ****æœ‰ä¸€åˆ†çƒ­ï¼Œå°±è¦å‘ä¸€åˆ†å…‰â€</strong>çš„ç²¾ç¥ã€‚ï¼ˆç¿»é¡µï¼‰</p>\n<p><strong>æ€»ç»“</strong></p>\n<p>   æˆ‘å§‹ç»ˆåšä¿¡ï¼šä¸é©°äºç©ºæƒ³ï¼Œä¸éª›äºè™šå£°ï¼Œå”¯æœ‰ä»¥<strong>æ±‚å®</strong>çš„æ€åº¦ï¼Œ<strong>è¸å®</strong>çš„å·¥ä½œï¼Œæ‰èƒ½èµ°å¾—æ›´è¿œã€‚ï¼ˆç¿»é¡µï¼‰</p>\n<p>   å±•æœ›æœªæ¥ï¼Œæ„¿æˆ‘ä»¬éƒ½èƒ½ä¸ºçœŸç†çš„<strong>æºè¿œæ ¹æ·±</strong>è€Œåªäº‰æœå¤•ï¼Œä¸ºäº‰åš<strong>å—é‡‘ä¸œç®­</strong>è€Œæ‹¼æå¥‹æ–—ã€‚</p>\n<p>   æˆ‘çš„æ±‡æŠ¥åˆ°æ­¤ç»“æŸï¼Œè°¢è°¢å¤§å®¶ã€‚</p>\n"},{"publish":false,"_content":"\n\n\n# ç”¨æˆ·æ€å’Œå†…æ ¸æ€\n\n> ä¸ºä»€ä¹ˆè¦åŒºåˆ†å†…æ ¸æ€å’Œç”¨æˆ·æ€ï¼Ÿ\n>\n> å†…æ ¸æ€å’Œç”¨æˆ·æ€ä¹‹é—´æ˜¯å¦‚ä½•åˆ‡æ¢çš„ï¼Ÿ\n>\n> ä»€ä¹ˆæ—¶å€™ä¼šé™·å…¥å†…æ ¸æ€ï¼Ÿ\n>\n> ç”¨æˆ·çº¿ç¨‹å’Œå†…æ ¸çº¿ç¨‹çš„åŒºåˆ«ï¼Ÿ\n\n","source":"_posts/ç”¨æˆ·æ€å’Œå†…æ ¸æ€.md","raw":"---\npublish: false\n---\n\n\n\n# ç”¨æˆ·æ€å’Œå†…æ ¸æ€\n\n> ä¸ºä»€ä¹ˆè¦åŒºåˆ†å†…æ ¸æ€å’Œç”¨æˆ·æ€ï¼Ÿ\n>\n> å†…æ ¸æ€å’Œç”¨æˆ·æ€ä¹‹é—´æ˜¯å¦‚ä½•åˆ‡æ¢çš„ï¼Ÿ\n>\n> ä»€ä¹ˆæ—¶å€™ä¼šé™·å…¥å†…æ ¸æ€ï¼Ÿ\n>\n> ç”¨æˆ·çº¿ç¨‹å’Œå†…æ ¸çº¿ç¨‹çš„åŒºåˆ«ï¼Ÿ\n\n","slug":"ç”¨æˆ·æ€å’Œå†…æ ¸æ€","published":1,"date":"2024-12-27T11:03:15.345Z","updated":"2024-12-27T11:03:15.345Z","title":"","comments":1,"layout":"post","photos":[],"_id":"cm6c7md6j0016a5t2d1iubhgl","content":"<h1 id=\"ç”¨æˆ·æ€å’Œå†…æ ¸æ€\"><a href=\"#ç”¨æˆ·æ€å’Œå†…æ ¸æ€\" class=\"headerlink\" title=\"ç”¨æˆ·æ€å’Œå†…æ ¸æ€\"></a>ç”¨æˆ·æ€å’Œå†…æ ¸æ€</h1><blockquote>\n<p>ä¸ºä»€ä¹ˆè¦åŒºåˆ†å†…æ ¸æ€å’Œç”¨æˆ·æ€ï¼Ÿ</p>\n<p>å†…æ ¸æ€å’Œç”¨æˆ·æ€ä¹‹é—´æ˜¯å¦‚ä½•åˆ‡æ¢çš„ï¼Ÿ</p>\n<p>ä»€ä¹ˆæ—¶å€™ä¼šé™·å…¥å†…æ ¸æ€ï¼Ÿ</p>\n<p>ç”¨æˆ·çº¿ç¨‹å’Œå†…æ ¸çº¿ç¨‹çš„åŒºåˆ«ï¼Ÿ</p>\n</blockquote>\n","excerpt":"","more":"<h1 id=\"ç”¨æˆ·æ€å’Œå†…æ ¸æ€\"><a href=\"#ç”¨æˆ·æ€å’Œå†…æ ¸æ€\" class=\"headerlink\" title=\"ç”¨æˆ·æ€å’Œå†…æ ¸æ€\"></a>ç”¨æˆ·æ€å’Œå†…æ ¸æ€</h1><blockquote>\n<p>ä¸ºä»€ä¹ˆè¦åŒºåˆ†å†…æ ¸æ€å’Œç”¨æˆ·æ€ï¼Ÿ</p>\n<p>å†…æ ¸æ€å’Œç”¨æˆ·æ€ä¹‹é—´æ˜¯å¦‚ä½•åˆ‡æ¢çš„ï¼Ÿ</p>\n<p>ä»€ä¹ˆæ—¶å€™ä¼šé™·å…¥å†…æ ¸æ€ï¼Ÿ</p>\n<p>ç”¨æˆ·çº¿ç¨‹å’Œå†…æ ¸çº¿ç¨‹çš„åŒºåˆ«ï¼Ÿ</p>\n</blockquote>\n"},{"title":"çŸ­é“¾ç³»ç»Ÿ","description":"è®°å½•çŸ­é“¾ç³»ç»Ÿåˆ¶ä½œ","publish":true,"_content":"\n\n\n# çŸ­é“¾ç³»ç»Ÿ\n\n## è®¤è¯†çŸ­é“¾\n\nçŸ­é“¾å³çŸ­é“¾æ¥ï¼Œä¾‹å¦‚[è¿™ä¸ªé“¾æ¥](http://gk.link/a/10q2I)ï¼Œå¾ˆç®€çŸ­ã€‚è€Œé•¿é“¾æ¥æˆ–è€…å«åšåŸå§‹é“¾æ¥åˆ™æœ‰ä¸€ç‚¹é•¿ï¼Œä¾‹å¦‚[è¿™ä¸ªé“¾æ¥](https://time.geekbang.org/column/intro/100020801?code=ieY8HeRSlDsFbuRtggbBQGxdTh-1jMASqEIeqzHAKrI%3D)\n\nå¯ä»¥å‘ç°ï¼Œä¸Šè¿°ä¸¤ä¸ªé“¾æ¥éƒ½è·³è½¬è‡³åŒä¸€ä¸ªé¡µé¢ï¼Œé‚£ä¹ˆæœ‰äº†åŸå§‹é“¾æ¥åï¼Œä¸ºä»€ä¹ˆè¿˜è¦ç”Ÿæˆä¸€ä¸ªçŸ­é“¾æ¥ï¼Ÿæˆ–è€…è¯´çŸ­é“¾æ¥æœ‰ä»€ä¹ˆä»·å€¼ğŸ¤”ï¼Ÿ\n\nç›¸æ¯”äºåŸå§‹é“¾æ¥ï¼ŒçŸ­é“¾çš„ä¼˜åŠ¿å°±åœ¨äº**çŸ­**ã€‚å› æ­¤ï¼ŒçŸ­é“¾åœ¨å®é™…åº”ç”¨ä¸­å…·æœ‰å¦‚ä¸‹ä¼˜åŠ¿ï¼š\n\n- **ç®€æ´æ˜äº†**ï¼šåªéœ€è¦ç®€å•å‡ ä¸ªå­—ç¬¦å°±èƒ½å®ç°[è¶…é•¿é“¾æ¥](https://mp.weixin.qq.com/s?__biz=MzA4MjIyNTY0MQ==&mid=2647743787&idx=1&sn=1caec8eb1b81d6ee5dd7ba7fa05ac0f1&chksm=87ad0dadb0da84bb7beb5e4373a14e89fba1130c1bd2a51f4baa8021ec0abe496ce94603b6b4&token=894028224&lang=zh_CN#rd)çš„è·³è½¬åŠŸèƒ½\n- **ä¾¿äºä½¿ç”¨**\n  - ç›¸åŒå­—ç¬¦é™åˆ¶æƒ…å†µä¸‹ï¼ŒçŸ­é“¾å¯ä»¥ä¼ é€’æ›´å¤šä¿¡æ¯\n  - ç”¨çŸ­é“¾ç”Ÿæˆçš„äºŒç»´ç æ›´å®¹æ˜“è¢«è¯†åˆ«\n- **èŠ‚çº¦æˆæœ¬**ï¼šæœ‰äº›å¹³å°çš„çŸ­ä¿¡æœåŠ¡æŒ‰ç…§å­—ç¬¦æ•°è®¡è´¹ï¼Œä»è¿™ä¸ªè§’åº¦å‡ºå‘ï¼ŒçŸ­é“¾å¯ä»¥èŠ‚çº¦æˆæœ¬\n\n### çŸ­é“¾çš„åŸç†\n\nä»¥è¿™ä¸ª[çŸ­é“¾](http://gk.link/a/10q2I)ä¸ºä¾‹å­ï¼Œæ¢ç©¶çŸ­é“¾çš„åŸç†\n\nè¾“å…¥`curl -i http://gk.link/a/10q2I`å‘½ä»¤ï¼Œå…¶ä¸­`-i`è¡¨ç¤º**è¿å¸¦ç›¸åº”å¤´**ä¸€åŒè¾“å‡ºï¼Œç»“æœå¦‚ä¸‹å›¾æ‰€ç¤ºï¼š\n\n![image-20241015184327080](https://raw.githubusercontent.com/lyydsheep/pic/main/202410151843629.png)\n\nå…¶ä¸­æœ‰ä¸¤ä¸ªé‡è¦ä¿¡æ¯å·²ç»è¢«æˆ‘æ¡†èµ·æ¥äº†ã€‚\n\n**ç›¸åº”çŠ¶æ€ç 302**è¡¨ç¤ºä¸´æ—¶é‡å®šå‘ï¼Œç”¨äºå‘ŠçŸ¥æ¥æ”¶æ–¹å½“å‰åœ°å€åªæ˜¯ä¸€ä¸ªä¸´æ—¶åœ°å€ï¼ŒçœŸæ­£çš„åœ°å€åœ¨`Location`å­—æ®µä¸­\n\n**å¤´éƒ¨å­—æ®µLocation**ä»£è¡¨äº†çœŸæ­£çš„ç›®çš„åœ°å€ï¼Œå½“æ¥æ”¶æ–¹æ”¶åˆ°è¿™ä¸ªå“åº”åï¼Œä¼šå–å‡ºå¹¶è®¿é—®Locationå­—æ®µä¸­çš„åœ°å€\n\n![image-20241015185124443](https://raw.githubusercontent.com/lyydsheep/pic/main/202410151851474.png)\n\nç®€å•æ¦‚æ‹¬ï¼Œæˆ‘ä»¬è®¿é—®ä¸€ä¸ªæçŸ­çš„é“¾æ¥ï¼Œç„¶åé‡å®šå‘åˆ°åŸå§‹åœ°å€ï¼ˆä¸€èˆ¬åŸå§‹åœ°å€æ¯”çŸ­é“¾é•¿å¾—å¤šï¼‰\n\n### å¦‚ä½•ç”ŸæˆçŸ­é“¾\n\n#### å“ˆå¸Œç®—æ³•\n\nå¾ˆæ˜¾ç„¶ï¼ŒçŸ­é“¾å’ŒåŸå§‹é“¾æ¥æœ€å¥½æ˜¯ä¸€å¯¹ä¸€å…³ç³»ã€‚é‚£ä¹ˆå¯ä»¥å°†é—®é¢˜è½¬æ¢æˆ**å¦‚ä½•ä¸ºä¸€ä¸ªé“¾æ¥æ‰¾åˆ°å”¯ä¸€çš„å¯¹åº”å€¼ï¼Ÿ**\n\nä¸€ç§å¾ˆç›´æ¥çš„æƒ³æ³•ï¼šæˆ‘ä»¬å¯ä»¥å°†åŸå§‹é“¾æ¥é€šè¿‡ä¸€æ¬¡ï¼ˆæˆ–å¤šæ¬¡ï¼‰**å“ˆå¸Œè®¡ç®—**ï¼Œå¾—åˆ°ä¸€ä¸ªå¯¹åº”å€¼ã€‚ä½†æ˜¯ç°å¦‚ä»Šæœ‰ä¼—å¤šå“ˆå¸Œç®—æ³•ï¼Œä¾‹å¦‚MD5ã€SHA-1ã€SHA-256ï¼Œåˆè¯¥å¦‚ä½•é€‰æ‹©ï¼Ÿ\n\næˆ‘ä»¬å¯ä»¥ä»åŠ å¯†ç¨‹åº¦çš„è§’åº¦å°†å“ˆå¸Œç®—æ³•åˆ†ä¸ºä¸¤å¤§ç±»ï¼š**åŠ å¯†å“ˆå¸Œ**ã€**éåŠ å¯†å“ˆå¸Œ**ã€‚å½“è¾“å…¥å€¼ç»è¿‡åŠ å¯†å“ˆå¸Œè®¡ç®—åï¼Œæ— æ³•ä»è¾“å‡ºå€¼åæ¨å‡ºè¾“å…¥å€¼ï¼Œä¿è¯äº†è¾“å…¥å€¼çš„å®‰å…¨æ€§ï¼Œä½†ä»£ä»·æ˜¯éœ€è¦è€—è´¹æ›´å¤šçš„è®¡ç®—èµ„æºï¼ˆæ—¶é—´ï¼‰ã€‚åœ¨çŸ­é“¾åœºæ™¯ä¸­ï¼Œç›¸è¾ƒäºåŸæ–‡çš„ä¿å¯†æ€§ï¼Œè¿ç®—é€Ÿåº¦æ˜¯æˆ‘ä»¬æ›´åŠ å…³å¿ƒçš„å› ç´ ã€‚å› æ­¤ï¼Œå¯ä»¥é‡‡ç”¨éåŠ å¯†å“ˆå¸Œï¼Œä¾‹å¦‚[MurmurHash](https://www.ifuyun.com/tool/murmurhash)ï¼Œæ¥ç”ŸæˆçŸ­é“¾ã€‚\n\nä½¿ç”¨å“ˆå¸Œç®—æ³•çš„åœºæ™¯ï¼Œä¸å¯é¿å…ä¼šå‡ºç°**å“ˆå¸Œå†²çª**é—®é¢˜å³ä¸åŒçš„è¾“å…¥å€¼é€šè¿‡å“ˆå¸Œè®¡ç®—æ—¶å¾—åˆ°äº†ç›¸åŒçš„è¾“å‡ºå€¼ã€‚å€Ÿé‰´`bcrypt`åŠ å¯†ç®—æ³•ä¸­çš„**åŠ ç›**æ“ä½œï¼Œå½“æŸä¸€ä¸ªè¾“å…¥å€¼å‘ç”Ÿå“ˆå¸Œå†²çªåï¼Œå¯ä»¥åœ¨æ·»åŠ ä¸€æ®µ**ç‰¹æ®Šå­—ç¬¦**åå†è¿›è¡Œå“ˆå¸Œè¿ç®—ï¼Œåå¤æ“ä½œç›´è‡³å†²çªæ¶ˆå¤±ã€‚\n\n```go\n/*\nwww.baidu.com\nå“ˆå¸Œå†²çª ---> æ·»åŠ ç‰¹æ®Šå­—ç¬¦\nwww.baidu.com[hello_world]\n*/\n```\n\né€šè¿‡å“ˆå¸Œç®—æ³•å¾—åˆ°ä¸€ä¸ªæ•°å€¼åï¼Œä¾‹å¦‚3510643912ï¼Œæˆ‘ä»¬è¿˜å¯ä»¥åˆ©ç”¨**62è¿›åˆ¶ï¼ˆ0-9ã€a-zã€A-Zå…±62ä¸ªURLåˆæ³•å­—ç¬¦ï¼‰**å°†ç»“æœè¿›ä¸€æ­¥ç¼©çŸ­\n\nğŸŒ°ï¼š3510643912 ---> 3PAiQUï¼Œè¿™æ ·æˆ‘ä»¬å°±å¯ä»¥åˆ©ç”¨æ›´çŸ­çš„å­—ç¬¦ä¸²ä½œä¸ºçŸ­é“¾\n\n#### å”¯ä¸€IDç®—æ³•\n\né™¤äº†ä½¿ç”¨å“ˆå¸Œç®—æ³•ç®€åŒ–é•¿é“¾ï¼Œè¿˜èƒ½ä¸ºæ¯ä¸€ä¸ªé•¿é“¾è¯·æ±‚åˆ†é…ä¸€ä¸ªå”¯ä¸€çš„IDï¼Œè¿™ä¸ªå”¯ä¸€IDå°±ç›¸å½“äºå“ˆå¸Œç®—æ³•ä¸­çš„å“ˆå¸Œå€¼ã€‚å½“ç„¶ï¼Œå”¯ä¸€IDä¹Ÿèƒ½åœ¨**base62è¿›åˆ¶**ä¸‹è¿›ä¸€æ­¥åŒ–ç®€\n\né‚£ä¹ˆç°åœ¨çš„é—®é¢˜å°±æ˜¯ï¼Œ**å¦‚ä½•è®¾è®¡ä¸€ä¸ªIDåˆ†å·å™¨ï¼Ÿ**\n\n##### MySQLè‡ªå¢IDåˆ†å·\n\né€šè¿‡MySQLè‡ªå¢ä¸»é”®ä¸ºé•¿é“¾åˆ†å‘ä¸€ä¸ªå”¯ä¸€IDï¼Œä½†è¿™ç§æ–¹æ³•å­˜åœ¨**é«˜å¹¶å‘æ€§èƒ½é—®é¢˜**ã€‚ä¸€ç§è§£å†³æ€è·¯æ˜¯ï¼šé¢„å…ˆä¸ºé›†ç¾¤ä¸­çš„æ¯ä¸€ä¸ªæœåŠ¡åˆ†é…ä¸€ä¸ªå¯ç”¨çš„IDèŒƒå›´ï¼Œåªæœ‰å½“æœåŠ¡ä¸­å¯ä½¿ç”¨çš„IDä¸è¶³æ—¶æ‰ä¼šå‘æ•°æ®æºè¯·æ±‚æ–°çš„ID\n\n<img src=\"https://raw.githubusercontent.com/lyydsheep/pic/main/202410161917898.png\" alt=\"image-20241016191703853\" style=\"zoom:50%;\" />\n\nå¦‚ä¸Šå›¾æ‰€ç¤ºï¼Œ`biz_tag`è¡¨ç¤ºä¸šåŠ¡ç±»å‹ï¼Œ`max_id`è¡¨ç¤ºå½“å‰ä¸šåŠ¡å¯åˆ†å‘çš„æœ€å¤§IDï¼Œ`step`è¡¨ç¤ºæ­¥é•¿ï¼Œå³æ¯ä¸ªæœåŠ¡ä¸€æ¬¡é¢„å¯ç”³è¯·å¤šå°‘ä¸ªIDå·ç \n\n<img src=\"https://raw.githubusercontent.com/lyydsheep/pic/main/202410161920030.png\" alt=\"image-20241016191959985\" style=\"zoom:50%;\" />\n\nå½“IDä¸å¤Ÿç”¨äº†ï¼Œå°±åƒæ•°æ®åº“å†ç”³è¯·ä¸€æ‰¹\n\næ­¤å¤–ï¼Œè¿˜å¯ä»¥å¼•å…¥**é˜Ÿåˆ—ç¼“å†² + æ‰¹é‡å†™å…¥**æ¶æ„ï¼Œåœ¨åŒºé—´å¿«æ»¡æ—¶å°±ç”³è¯·ä¸€æ‰¹æ–°çš„IDå·ç ï¼Œç­‰åŒºé—´æ»¡äº†å†ä¸€æ¬¡æ€§å†™å…¥æ•°æ®åº“ä¸­ï¼Œå®ç°å¼‚æ­¥è¿›è¡Œè·å–å’Œå†™å…¥æ“ä½œï¼Œä¿è¯æœåŠ¡æŒç»­çš„é«˜å¹¶å‘\n\nä¾‹å¦‚ï¼Œ**ç°æœ‰10000ä¸ªIDå·ç ï¼Œå½“å‰©ä½™çš„IDå·ä¸è¶³1000æ—¶ï¼Œå°±å‘æ•°æ®æºè¯·æ±‚å†åˆ†å‘10000ä¸ªIDå·ï¼Œåœ¨ä¸Šä¸€æ‰¹IDç”¨å®Œæ—¶ï¼Œå°†æ•°æ®æ‰¹é‡å†™å…¥æ•°æ®åº“ä¸­**\n\nMySQLè‡ªå¢IDä¼˜ç‚¹ï¼š\n\n- ç®€å•æ–¹ä¾¿ï¼Œå®¹æ˜“å®ç°\n\nç¼ºç‚¹ï¼š\n\n- æ•´ä½“æ€§èƒ½ååé‡ä½ï¼Œé«˜å¹¶å‘åœºæ™¯ä¸‹å®¹æ˜“å‡ºç°å•ç‚¹ç“¶é¢ˆ\n\n##### Redisè‡ªå¢ID\n\nRedisåŸºäºå†…å­˜å®ç°ï¼Œå¹¶å‘æ€§èƒ½é«˜ï¼ˆ10wï¼‰ï¼Œä½†ä½¿ç”¨Redisä½œä¸ºåˆ†å·å™¨éœ€è¦è€ƒè™‘**æŒä¹…åŒ–å’Œç¾å¤‡**\n\nä¼˜ç‚¹ï¼š\n\n- æ•´ä½“ååé‡æ¯”æ•°æ®å¥½\n\nç¼ºç‚¹ï¼š\n\n- Rediså®ä¾‹æˆ–é›†ç¾¤å®•æœºåï¼Œå¾ˆéš¾æ‰¾å›æœ€æ–°çš„ID\n\n##### é›ªèŠ±ç®—æ³•ç”ŸæˆID\n\nå‰ä¸¤ç§æ–¹æ¡ˆéƒ½æ˜¯è¿œç¨‹IDç”Ÿæˆï¼Œä¸€èˆ¬æ¥è¯´ï¼Œè¿œç¨‹IDç”Ÿæˆæ•ˆç‡ï¼ˆæœ¬èº«å¯¹åº”çš„ç»„ä»¶è€—æ—¶ + ç½‘ç»œè€—æ—¶ï¼‰ä¸å¦‚æœ¬åœ°IDç”Ÿæˆã€‚é›ªèŠ±ç®—æ³•ç”ŸæˆIDæ–¹æ¡ˆå°±æ˜¯ä¸€ç§æœ¬åœ°IDæ–¹æ¡ˆï¼Œä¸ä¾èµ–äºå…¶ä»–çš„æœåŠ¡ã€‚\n\né›ªèŠ±ç®—æ³•ä½¿ç”¨ä¸€ä¸ªlongç±»å‹çš„æ•´æ•°ï¼ˆ64ä½bitï¼‰æ¥è¡¨ç¤ºä¸€ä¸ªIDï¼Œå…·ä½“ç”±**1bitç©ºé—² + 41bitæ—¶é—´æˆ³ï¼ˆæ¯«ç§’çº§åˆ«ï¼‰ + 10bitæœºå™¨IDï¼ˆæˆ–æœºæˆ¿ID + æœºå™¨IDï¼‰ + 12bitåºåˆ—å·**ç»„æˆã€‚\n\n<img src=\"https://raw.githubusercontent.com/lyydsheep/pic/main/202410161948837.png\" alt=\"image-20241016194848744\" style=\"zoom:50%;\" />\n\nä¼˜ç‚¹ï¼š\n\n- é«˜æ€§èƒ½ã€ä½å»¶è¿Ÿã€å»ä¸­å¿ƒåŒ–ã€æ•´ä½“æŒ‰æ—¶é—´æœ‰åº\n\nç¼ºç‚¹ï¼š\n\n- è¦æ±‚æœºå™¨æ—¶é—´åŒæ­¥åœ¨ç§’çº§åˆ«ï¼Œå¦åˆ™ä¼šäº§ç”ŸIDå†²çª\n- å¦‚æœæŸå°æœºå™¨æ—¶é’Ÿå›æ‹¨è¿™æœ‰å¯èƒ½å‘ç”ŸIDå†²çª\n\n## è®¾è®¡çŸ­é“¾\n\n### é‡å®šå‘çŠ¶æ€ç çš„é€‰æ‹©\n\nç”±ä¹‹å‰çš„åˆ†ææˆ‘ä»¬çŸ¥é“äº†çŸ­é“¾ç³»ç»Ÿçš„å¤§è‡´å·¥ä½œåŸç†ï¼šæµè§ˆå™¨è®¿é—®çŸ­é“¾ï¼ŒçŸ­é“¾æœåŠ¡å‘æµè§ˆå™¨è¿”å›ä¸€ä¸ª**é‡å®šå‘çŠ¶æ€ç **å’Œ**å¯¹åº”çš„é•¿é“¾**ã€‚æ¥ç€ï¼Œæµè§ˆå™¨è®¿é—®é•¿é“¾è·å–å¹¶è·å–åˆ°ç›®æ ‡èµ„æºã€‚\n\n![image-20241015185124443](https://raw.githubusercontent.com/lyydsheep/pic/main/202410182126756.png)\n\nåœ¨çŸ­é“¾ç³»ç»Ÿä¸­ä¸€èˆ¬åªè€ƒè™‘ä½¿ç”¨**æ°¸ä¹…é‡å®šå‘301**æˆ–**ä¸´æ—¶é‡å®šå‘302**çŠ¶æ€ç \n\nä¸¤ä¸ªçŠ¶æ€ç åŒºåˆ«å¦‚ä¸‹ï¼š\n\n- **301çŠ¶æ€ç è¡¨ç¤ºæ°¸ä¹…é‡å®šå‘ï¼Œæµè§ˆå™¨æ”¶åˆ°æ”¹çŠ¶æ€ç æ—¶ï¼Œä¼šå°†`Location`å­—æ®µå€¼ç¼“å­˜åœ¨æœ¬åœ°ï¼Œå½“å°†å†æ¬¡è®¿é—®çŸ­é“¾æ—¶å°±ç›´æ¥ä»ç¼“å­˜ä¸­æ‹¿å‡ºé•¿é“¾åœ°å€å¹¶è®¿é—®ï¼ŒèŠ‚çº¦äº†ä¸€æ¬¡è®¿é—®çŸ­é“¾æœåŠ¡çš„æ¬¡æ•°**\n- **302çŠ¶æ€ç è¡¨ç¤ºä¸´æ—¶é‡å®šå‘ï¼Œæµè§ˆå™¨ä¸ä¼šç¼“å­˜å“åº”å¤´éƒ¨ä¸­çš„`Location`å­—æ®µ**\n- **åœ¨çŸ­é“¾ç³»ç»Ÿä¸­ï¼Œæµè§ˆå™¨çš„ç¼“å­˜è¡Œä¸ºå¯èƒ½å¹¶éæ˜¯æˆ‘ä»¬é¢„æœŸçš„ï¼Œå°¤å…¶éœ€è¦å¯¹çŸ­é“¾è¿›è¡Œåˆ†æçš„æƒ…å†µ**\n  - ğŸŒ°ï¼šå°†ä¸€ä¸ªçŸ­é“¾é€šè¿‡çŸ­ä¿¡å‘é€ç»™1wä¸ªç”¨æˆ·ï¼Œå¦‚æœä½¿ç”¨302çŠ¶æ€ç å°±å¯ä»¥æµ‹è¯•å‡ºè¿™1wä¸ªç”¨æˆ·é’ˆå¯¹çŸ­é“¾çš„ç‚¹å‡»æ¬¡æ•°ã€‚ä½†æ˜¯åœ¨ä½¿ç”¨301çŠ¶æ€ç æƒ…å†µä¸‹ï¼Œæ¯ä¸€ä¸ªç”¨æˆ·æœ€å¤šåªä¼šè¢«ç»Ÿè®¡ä¸€æ¬¡ã€‚ï¼ˆå› ä¸ºæµè§ˆå™¨ç¼“å­˜äº†é•¿é“¾åœ°å€ï¼‰\n\n### æ¥å£è®¾è®¡","source":"_posts/çŸ­é“¾ç³»ç»Ÿ.md","raw":"---\ntitle: çŸ­é“¾ç³»ç»Ÿ\ndescription: è®°å½•çŸ­é“¾ç³»ç»Ÿåˆ¶ä½œ\npublish: true\ntag:\n- é¡¹ç›®\n---\n\n\n\n# çŸ­é“¾ç³»ç»Ÿ\n\n## è®¤è¯†çŸ­é“¾\n\nçŸ­é“¾å³çŸ­é“¾æ¥ï¼Œä¾‹å¦‚[è¿™ä¸ªé“¾æ¥](http://gk.link/a/10q2I)ï¼Œå¾ˆç®€çŸ­ã€‚è€Œé•¿é“¾æ¥æˆ–è€…å«åšåŸå§‹é“¾æ¥åˆ™æœ‰ä¸€ç‚¹é•¿ï¼Œä¾‹å¦‚[è¿™ä¸ªé“¾æ¥](https://time.geekbang.org/column/intro/100020801?code=ieY8HeRSlDsFbuRtggbBQGxdTh-1jMASqEIeqzHAKrI%3D)\n\nå¯ä»¥å‘ç°ï¼Œä¸Šè¿°ä¸¤ä¸ªé“¾æ¥éƒ½è·³è½¬è‡³åŒä¸€ä¸ªé¡µé¢ï¼Œé‚£ä¹ˆæœ‰äº†åŸå§‹é“¾æ¥åï¼Œä¸ºä»€ä¹ˆè¿˜è¦ç”Ÿæˆä¸€ä¸ªçŸ­é“¾æ¥ï¼Ÿæˆ–è€…è¯´çŸ­é“¾æ¥æœ‰ä»€ä¹ˆä»·å€¼ğŸ¤”ï¼Ÿ\n\nç›¸æ¯”äºåŸå§‹é“¾æ¥ï¼ŒçŸ­é“¾çš„ä¼˜åŠ¿å°±åœ¨äº**çŸ­**ã€‚å› æ­¤ï¼ŒçŸ­é“¾åœ¨å®é™…åº”ç”¨ä¸­å…·æœ‰å¦‚ä¸‹ä¼˜åŠ¿ï¼š\n\n- **ç®€æ´æ˜äº†**ï¼šåªéœ€è¦ç®€å•å‡ ä¸ªå­—ç¬¦å°±èƒ½å®ç°[è¶…é•¿é“¾æ¥](https://mp.weixin.qq.com/s?__biz=MzA4MjIyNTY0MQ==&mid=2647743787&idx=1&sn=1caec8eb1b81d6ee5dd7ba7fa05ac0f1&chksm=87ad0dadb0da84bb7beb5e4373a14e89fba1130c1bd2a51f4baa8021ec0abe496ce94603b6b4&token=894028224&lang=zh_CN#rd)çš„è·³è½¬åŠŸèƒ½\n- **ä¾¿äºä½¿ç”¨**\n  - ç›¸åŒå­—ç¬¦é™åˆ¶æƒ…å†µä¸‹ï¼ŒçŸ­é“¾å¯ä»¥ä¼ é€’æ›´å¤šä¿¡æ¯\n  - ç”¨çŸ­é“¾ç”Ÿæˆçš„äºŒç»´ç æ›´å®¹æ˜“è¢«è¯†åˆ«\n- **èŠ‚çº¦æˆæœ¬**ï¼šæœ‰äº›å¹³å°çš„çŸ­ä¿¡æœåŠ¡æŒ‰ç…§å­—ç¬¦æ•°è®¡è´¹ï¼Œä»è¿™ä¸ªè§’åº¦å‡ºå‘ï¼ŒçŸ­é“¾å¯ä»¥èŠ‚çº¦æˆæœ¬\n\n### çŸ­é“¾çš„åŸç†\n\nä»¥è¿™ä¸ª[çŸ­é“¾](http://gk.link/a/10q2I)ä¸ºä¾‹å­ï¼Œæ¢ç©¶çŸ­é“¾çš„åŸç†\n\nè¾“å…¥`curl -i http://gk.link/a/10q2I`å‘½ä»¤ï¼Œå…¶ä¸­`-i`è¡¨ç¤º**è¿å¸¦ç›¸åº”å¤´**ä¸€åŒè¾“å‡ºï¼Œç»“æœå¦‚ä¸‹å›¾æ‰€ç¤ºï¼š\n\n![image-20241015184327080](https://raw.githubusercontent.com/lyydsheep/pic/main/202410151843629.png)\n\nå…¶ä¸­æœ‰ä¸¤ä¸ªé‡è¦ä¿¡æ¯å·²ç»è¢«æˆ‘æ¡†èµ·æ¥äº†ã€‚\n\n**ç›¸åº”çŠ¶æ€ç 302**è¡¨ç¤ºä¸´æ—¶é‡å®šå‘ï¼Œç”¨äºå‘ŠçŸ¥æ¥æ”¶æ–¹å½“å‰åœ°å€åªæ˜¯ä¸€ä¸ªä¸´æ—¶åœ°å€ï¼ŒçœŸæ­£çš„åœ°å€åœ¨`Location`å­—æ®µä¸­\n\n**å¤´éƒ¨å­—æ®µLocation**ä»£è¡¨äº†çœŸæ­£çš„ç›®çš„åœ°å€ï¼Œå½“æ¥æ”¶æ–¹æ”¶åˆ°è¿™ä¸ªå“åº”åï¼Œä¼šå–å‡ºå¹¶è®¿é—®Locationå­—æ®µä¸­çš„åœ°å€\n\n![image-20241015185124443](https://raw.githubusercontent.com/lyydsheep/pic/main/202410151851474.png)\n\nç®€å•æ¦‚æ‹¬ï¼Œæˆ‘ä»¬è®¿é—®ä¸€ä¸ªæçŸ­çš„é“¾æ¥ï¼Œç„¶åé‡å®šå‘åˆ°åŸå§‹åœ°å€ï¼ˆä¸€èˆ¬åŸå§‹åœ°å€æ¯”çŸ­é“¾é•¿å¾—å¤šï¼‰\n\n### å¦‚ä½•ç”ŸæˆçŸ­é“¾\n\n#### å“ˆå¸Œç®—æ³•\n\nå¾ˆæ˜¾ç„¶ï¼ŒçŸ­é“¾å’ŒåŸå§‹é“¾æ¥æœ€å¥½æ˜¯ä¸€å¯¹ä¸€å…³ç³»ã€‚é‚£ä¹ˆå¯ä»¥å°†é—®é¢˜è½¬æ¢æˆ**å¦‚ä½•ä¸ºä¸€ä¸ªé“¾æ¥æ‰¾åˆ°å”¯ä¸€çš„å¯¹åº”å€¼ï¼Ÿ**\n\nä¸€ç§å¾ˆç›´æ¥çš„æƒ³æ³•ï¼šæˆ‘ä»¬å¯ä»¥å°†åŸå§‹é“¾æ¥é€šè¿‡ä¸€æ¬¡ï¼ˆæˆ–å¤šæ¬¡ï¼‰**å“ˆå¸Œè®¡ç®—**ï¼Œå¾—åˆ°ä¸€ä¸ªå¯¹åº”å€¼ã€‚ä½†æ˜¯ç°å¦‚ä»Šæœ‰ä¼—å¤šå“ˆå¸Œç®—æ³•ï¼Œä¾‹å¦‚MD5ã€SHA-1ã€SHA-256ï¼Œåˆè¯¥å¦‚ä½•é€‰æ‹©ï¼Ÿ\n\næˆ‘ä»¬å¯ä»¥ä»åŠ å¯†ç¨‹åº¦çš„è§’åº¦å°†å“ˆå¸Œç®—æ³•åˆ†ä¸ºä¸¤å¤§ç±»ï¼š**åŠ å¯†å“ˆå¸Œ**ã€**éåŠ å¯†å“ˆå¸Œ**ã€‚å½“è¾“å…¥å€¼ç»è¿‡åŠ å¯†å“ˆå¸Œè®¡ç®—åï¼Œæ— æ³•ä»è¾“å‡ºå€¼åæ¨å‡ºè¾“å…¥å€¼ï¼Œä¿è¯äº†è¾“å…¥å€¼çš„å®‰å…¨æ€§ï¼Œä½†ä»£ä»·æ˜¯éœ€è¦è€—è´¹æ›´å¤šçš„è®¡ç®—èµ„æºï¼ˆæ—¶é—´ï¼‰ã€‚åœ¨çŸ­é“¾åœºæ™¯ä¸­ï¼Œç›¸è¾ƒäºåŸæ–‡çš„ä¿å¯†æ€§ï¼Œè¿ç®—é€Ÿåº¦æ˜¯æˆ‘ä»¬æ›´åŠ å…³å¿ƒçš„å› ç´ ã€‚å› æ­¤ï¼Œå¯ä»¥é‡‡ç”¨éåŠ å¯†å“ˆå¸Œï¼Œä¾‹å¦‚[MurmurHash](https://www.ifuyun.com/tool/murmurhash)ï¼Œæ¥ç”ŸæˆçŸ­é“¾ã€‚\n\nä½¿ç”¨å“ˆå¸Œç®—æ³•çš„åœºæ™¯ï¼Œä¸å¯é¿å…ä¼šå‡ºç°**å“ˆå¸Œå†²çª**é—®é¢˜å³ä¸åŒçš„è¾“å…¥å€¼é€šè¿‡å“ˆå¸Œè®¡ç®—æ—¶å¾—åˆ°äº†ç›¸åŒçš„è¾“å‡ºå€¼ã€‚å€Ÿé‰´`bcrypt`åŠ å¯†ç®—æ³•ä¸­çš„**åŠ ç›**æ“ä½œï¼Œå½“æŸä¸€ä¸ªè¾“å…¥å€¼å‘ç”Ÿå“ˆå¸Œå†²çªåï¼Œå¯ä»¥åœ¨æ·»åŠ ä¸€æ®µ**ç‰¹æ®Šå­—ç¬¦**åå†è¿›è¡Œå“ˆå¸Œè¿ç®—ï¼Œåå¤æ“ä½œç›´è‡³å†²çªæ¶ˆå¤±ã€‚\n\n```go\n/*\nwww.baidu.com\nå“ˆå¸Œå†²çª ---> æ·»åŠ ç‰¹æ®Šå­—ç¬¦\nwww.baidu.com[hello_world]\n*/\n```\n\né€šè¿‡å“ˆå¸Œç®—æ³•å¾—åˆ°ä¸€ä¸ªæ•°å€¼åï¼Œä¾‹å¦‚3510643912ï¼Œæˆ‘ä»¬è¿˜å¯ä»¥åˆ©ç”¨**62è¿›åˆ¶ï¼ˆ0-9ã€a-zã€A-Zå…±62ä¸ªURLåˆæ³•å­—ç¬¦ï¼‰**å°†ç»“æœè¿›ä¸€æ­¥ç¼©çŸ­\n\nğŸŒ°ï¼š3510643912 ---> 3PAiQUï¼Œè¿™æ ·æˆ‘ä»¬å°±å¯ä»¥åˆ©ç”¨æ›´çŸ­çš„å­—ç¬¦ä¸²ä½œä¸ºçŸ­é“¾\n\n#### å”¯ä¸€IDç®—æ³•\n\né™¤äº†ä½¿ç”¨å“ˆå¸Œç®—æ³•ç®€åŒ–é•¿é“¾ï¼Œè¿˜èƒ½ä¸ºæ¯ä¸€ä¸ªé•¿é“¾è¯·æ±‚åˆ†é…ä¸€ä¸ªå”¯ä¸€çš„IDï¼Œè¿™ä¸ªå”¯ä¸€IDå°±ç›¸å½“äºå“ˆå¸Œç®—æ³•ä¸­çš„å“ˆå¸Œå€¼ã€‚å½“ç„¶ï¼Œå”¯ä¸€IDä¹Ÿèƒ½åœ¨**base62è¿›åˆ¶**ä¸‹è¿›ä¸€æ­¥åŒ–ç®€\n\né‚£ä¹ˆç°åœ¨çš„é—®é¢˜å°±æ˜¯ï¼Œ**å¦‚ä½•è®¾è®¡ä¸€ä¸ªIDåˆ†å·å™¨ï¼Ÿ**\n\n##### MySQLè‡ªå¢IDåˆ†å·\n\né€šè¿‡MySQLè‡ªå¢ä¸»é”®ä¸ºé•¿é“¾åˆ†å‘ä¸€ä¸ªå”¯ä¸€IDï¼Œä½†è¿™ç§æ–¹æ³•å­˜åœ¨**é«˜å¹¶å‘æ€§èƒ½é—®é¢˜**ã€‚ä¸€ç§è§£å†³æ€è·¯æ˜¯ï¼šé¢„å…ˆä¸ºé›†ç¾¤ä¸­çš„æ¯ä¸€ä¸ªæœåŠ¡åˆ†é…ä¸€ä¸ªå¯ç”¨çš„IDèŒƒå›´ï¼Œåªæœ‰å½“æœåŠ¡ä¸­å¯ä½¿ç”¨çš„IDä¸è¶³æ—¶æ‰ä¼šå‘æ•°æ®æºè¯·æ±‚æ–°çš„ID\n\n<img src=\"https://raw.githubusercontent.com/lyydsheep/pic/main/202410161917898.png\" alt=\"image-20241016191703853\" style=\"zoom:50%;\" />\n\nå¦‚ä¸Šå›¾æ‰€ç¤ºï¼Œ`biz_tag`è¡¨ç¤ºä¸šåŠ¡ç±»å‹ï¼Œ`max_id`è¡¨ç¤ºå½“å‰ä¸šåŠ¡å¯åˆ†å‘çš„æœ€å¤§IDï¼Œ`step`è¡¨ç¤ºæ­¥é•¿ï¼Œå³æ¯ä¸ªæœåŠ¡ä¸€æ¬¡é¢„å¯ç”³è¯·å¤šå°‘ä¸ªIDå·ç \n\n<img src=\"https://raw.githubusercontent.com/lyydsheep/pic/main/202410161920030.png\" alt=\"image-20241016191959985\" style=\"zoom:50%;\" />\n\nå½“IDä¸å¤Ÿç”¨äº†ï¼Œå°±åƒæ•°æ®åº“å†ç”³è¯·ä¸€æ‰¹\n\næ­¤å¤–ï¼Œè¿˜å¯ä»¥å¼•å…¥**é˜Ÿåˆ—ç¼“å†² + æ‰¹é‡å†™å…¥**æ¶æ„ï¼Œåœ¨åŒºé—´å¿«æ»¡æ—¶å°±ç”³è¯·ä¸€æ‰¹æ–°çš„IDå·ç ï¼Œç­‰åŒºé—´æ»¡äº†å†ä¸€æ¬¡æ€§å†™å…¥æ•°æ®åº“ä¸­ï¼Œå®ç°å¼‚æ­¥è¿›è¡Œè·å–å’Œå†™å…¥æ“ä½œï¼Œä¿è¯æœåŠ¡æŒç»­çš„é«˜å¹¶å‘\n\nä¾‹å¦‚ï¼Œ**ç°æœ‰10000ä¸ªIDå·ç ï¼Œå½“å‰©ä½™çš„IDå·ä¸è¶³1000æ—¶ï¼Œå°±å‘æ•°æ®æºè¯·æ±‚å†åˆ†å‘10000ä¸ªIDå·ï¼Œåœ¨ä¸Šä¸€æ‰¹IDç”¨å®Œæ—¶ï¼Œå°†æ•°æ®æ‰¹é‡å†™å…¥æ•°æ®åº“ä¸­**\n\nMySQLè‡ªå¢IDä¼˜ç‚¹ï¼š\n\n- ç®€å•æ–¹ä¾¿ï¼Œå®¹æ˜“å®ç°\n\nç¼ºç‚¹ï¼š\n\n- æ•´ä½“æ€§èƒ½ååé‡ä½ï¼Œé«˜å¹¶å‘åœºæ™¯ä¸‹å®¹æ˜“å‡ºç°å•ç‚¹ç“¶é¢ˆ\n\n##### Redisè‡ªå¢ID\n\nRedisåŸºäºå†…å­˜å®ç°ï¼Œå¹¶å‘æ€§èƒ½é«˜ï¼ˆ10wï¼‰ï¼Œä½†ä½¿ç”¨Redisä½œä¸ºåˆ†å·å™¨éœ€è¦è€ƒè™‘**æŒä¹…åŒ–å’Œç¾å¤‡**\n\nä¼˜ç‚¹ï¼š\n\n- æ•´ä½“ååé‡æ¯”æ•°æ®å¥½\n\nç¼ºç‚¹ï¼š\n\n- Rediså®ä¾‹æˆ–é›†ç¾¤å®•æœºåï¼Œå¾ˆéš¾æ‰¾å›æœ€æ–°çš„ID\n\n##### é›ªèŠ±ç®—æ³•ç”ŸæˆID\n\nå‰ä¸¤ç§æ–¹æ¡ˆéƒ½æ˜¯è¿œç¨‹IDç”Ÿæˆï¼Œä¸€èˆ¬æ¥è¯´ï¼Œè¿œç¨‹IDç”Ÿæˆæ•ˆç‡ï¼ˆæœ¬èº«å¯¹åº”çš„ç»„ä»¶è€—æ—¶ + ç½‘ç»œè€—æ—¶ï¼‰ä¸å¦‚æœ¬åœ°IDç”Ÿæˆã€‚é›ªèŠ±ç®—æ³•ç”ŸæˆIDæ–¹æ¡ˆå°±æ˜¯ä¸€ç§æœ¬åœ°IDæ–¹æ¡ˆï¼Œä¸ä¾èµ–äºå…¶ä»–çš„æœåŠ¡ã€‚\n\né›ªèŠ±ç®—æ³•ä½¿ç”¨ä¸€ä¸ªlongç±»å‹çš„æ•´æ•°ï¼ˆ64ä½bitï¼‰æ¥è¡¨ç¤ºä¸€ä¸ªIDï¼Œå…·ä½“ç”±**1bitç©ºé—² + 41bitæ—¶é—´æˆ³ï¼ˆæ¯«ç§’çº§åˆ«ï¼‰ + 10bitæœºå™¨IDï¼ˆæˆ–æœºæˆ¿ID + æœºå™¨IDï¼‰ + 12bitåºåˆ—å·**ç»„æˆã€‚\n\n<img src=\"https://raw.githubusercontent.com/lyydsheep/pic/main/202410161948837.png\" alt=\"image-20241016194848744\" style=\"zoom:50%;\" />\n\nä¼˜ç‚¹ï¼š\n\n- é«˜æ€§èƒ½ã€ä½å»¶è¿Ÿã€å»ä¸­å¿ƒåŒ–ã€æ•´ä½“æŒ‰æ—¶é—´æœ‰åº\n\nç¼ºç‚¹ï¼š\n\n- è¦æ±‚æœºå™¨æ—¶é—´åŒæ­¥åœ¨ç§’çº§åˆ«ï¼Œå¦åˆ™ä¼šäº§ç”ŸIDå†²çª\n- å¦‚æœæŸå°æœºå™¨æ—¶é’Ÿå›æ‹¨è¿™æœ‰å¯èƒ½å‘ç”ŸIDå†²çª\n\n## è®¾è®¡çŸ­é“¾\n\n### é‡å®šå‘çŠ¶æ€ç çš„é€‰æ‹©\n\nç”±ä¹‹å‰çš„åˆ†ææˆ‘ä»¬çŸ¥é“äº†çŸ­é“¾ç³»ç»Ÿçš„å¤§è‡´å·¥ä½œåŸç†ï¼šæµè§ˆå™¨è®¿é—®çŸ­é“¾ï¼ŒçŸ­é“¾æœåŠ¡å‘æµè§ˆå™¨è¿”å›ä¸€ä¸ª**é‡å®šå‘çŠ¶æ€ç **å’Œ**å¯¹åº”çš„é•¿é“¾**ã€‚æ¥ç€ï¼Œæµè§ˆå™¨è®¿é—®é•¿é“¾è·å–å¹¶è·å–åˆ°ç›®æ ‡èµ„æºã€‚\n\n![image-20241015185124443](https://raw.githubusercontent.com/lyydsheep/pic/main/202410182126756.png)\n\nåœ¨çŸ­é“¾ç³»ç»Ÿä¸­ä¸€èˆ¬åªè€ƒè™‘ä½¿ç”¨**æ°¸ä¹…é‡å®šå‘301**æˆ–**ä¸´æ—¶é‡å®šå‘302**çŠ¶æ€ç \n\nä¸¤ä¸ªçŠ¶æ€ç åŒºåˆ«å¦‚ä¸‹ï¼š\n\n- **301çŠ¶æ€ç è¡¨ç¤ºæ°¸ä¹…é‡å®šå‘ï¼Œæµè§ˆå™¨æ”¶åˆ°æ”¹çŠ¶æ€ç æ—¶ï¼Œä¼šå°†`Location`å­—æ®µå€¼ç¼“å­˜åœ¨æœ¬åœ°ï¼Œå½“å°†å†æ¬¡è®¿é—®çŸ­é“¾æ—¶å°±ç›´æ¥ä»ç¼“å­˜ä¸­æ‹¿å‡ºé•¿é“¾åœ°å€å¹¶è®¿é—®ï¼ŒèŠ‚çº¦äº†ä¸€æ¬¡è®¿é—®çŸ­é“¾æœåŠ¡çš„æ¬¡æ•°**\n- **302çŠ¶æ€ç è¡¨ç¤ºä¸´æ—¶é‡å®šå‘ï¼Œæµè§ˆå™¨ä¸ä¼šç¼“å­˜å“åº”å¤´éƒ¨ä¸­çš„`Location`å­—æ®µ**\n- **åœ¨çŸ­é“¾ç³»ç»Ÿä¸­ï¼Œæµè§ˆå™¨çš„ç¼“å­˜è¡Œä¸ºå¯èƒ½å¹¶éæ˜¯æˆ‘ä»¬é¢„æœŸçš„ï¼Œå°¤å…¶éœ€è¦å¯¹çŸ­é“¾è¿›è¡Œåˆ†æçš„æƒ…å†µ**\n  - ğŸŒ°ï¼šå°†ä¸€ä¸ªçŸ­é“¾é€šè¿‡çŸ­ä¿¡å‘é€ç»™1wä¸ªç”¨æˆ·ï¼Œå¦‚æœä½¿ç”¨302çŠ¶æ€ç å°±å¯ä»¥æµ‹è¯•å‡ºè¿™1wä¸ªç”¨æˆ·é’ˆå¯¹çŸ­é“¾çš„ç‚¹å‡»æ¬¡æ•°ã€‚ä½†æ˜¯åœ¨ä½¿ç”¨301çŠ¶æ€ç æƒ…å†µä¸‹ï¼Œæ¯ä¸€ä¸ªç”¨æˆ·æœ€å¤šåªä¼šè¢«ç»Ÿè®¡ä¸€æ¬¡ã€‚ï¼ˆå› ä¸ºæµè§ˆå™¨ç¼“å­˜äº†é•¿é“¾åœ°å€ï¼‰\n\n### æ¥å£è®¾è®¡","slug":"çŸ­é“¾ç³»ç»Ÿ","published":1,"date":"2024-12-27T11:03:15.345Z","updated":"2024-12-27T11:03:15.345Z","comments":1,"layout":"post","photos":[],"_id":"cm6c7md6k0018a5t20hb54uqq","content":"<h1 id=\"çŸ­é“¾ç³»ç»Ÿ\"><a href=\"#çŸ­é“¾ç³»ç»Ÿ\" class=\"headerlink\" title=\"çŸ­é“¾ç³»ç»Ÿ\"></a>çŸ­é“¾ç³»ç»Ÿ</h1><h2 id=\"è®¤è¯†çŸ­é“¾\"><a href=\"#è®¤è¯†çŸ­é“¾\" class=\"headerlink\" title=\"è®¤è¯†çŸ­é“¾\"></a>è®¤è¯†çŸ­é“¾</h2><p>çŸ­é“¾å³çŸ­é“¾æ¥ï¼Œä¾‹å¦‚<a href=\"http://gk.link/a/10q2I\">è¿™ä¸ªé“¾æ¥</a>ï¼Œå¾ˆç®€çŸ­ã€‚è€Œé•¿é“¾æ¥æˆ–è€…å«åšåŸå§‹é“¾æ¥åˆ™æœ‰ä¸€ç‚¹é•¿ï¼Œä¾‹å¦‚<a href=\"https://time.geekbang.org/column/intro/100020801?code=ieY8HeRSlDsFbuRtggbBQGxdTh-1jMASqEIeqzHAKrI=\">è¿™ä¸ªé“¾æ¥</a></p>\n<p>å¯ä»¥å‘ç°ï¼Œä¸Šè¿°ä¸¤ä¸ªé“¾æ¥éƒ½è·³è½¬è‡³åŒä¸€ä¸ªé¡µé¢ï¼Œé‚£ä¹ˆæœ‰äº†åŸå§‹é“¾æ¥åï¼Œä¸ºä»€ä¹ˆè¿˜è¦ç”Ÿæˆä¸€ä¸ªçŸ­é“¾æ¥ï¼Ÿæˆ–è€…è¯´çŸ­é“¾æ¥æœ‰ä»€ä¹ˆä»·å€¼ğŸ¤”ï¼Ÿ</p>\n<p>ç›¸æ¯”äºåŸå§‹é“¾æ¥ï¼ŒçŸ­é“¾çš„ä¼˜åŠ¿å°±åœ¨äº<strong>çŸ­</strong>ã€‚å› æ­¤ï¼ŒçŸ­é“¾åœ¨å®é™…åº”ç”¨ä¸­å…·æœ‰å¦‚ä¸‹ä¼˜åŠ¿ï¼š</p>\n<ul>\n<li><strong>ç®€æ´æ˜äº†</strong>ï¼šåªéœ€è¦ç®€å•å‡ ä¸ªå­—ç¬¦å°±èƒ½å®ç°<a href=\"https://mp.weixin.qq.com/s?__biz=MzA4MjIyNTY0MQ==&mid=2647743787&idx=1&sn=1caec8eb1b81d6ee5dd7ba7fa05ac0f1&chksm=87ad0dadb0da84bb7beb5e4373a14e89fba1130c1bd2a51f4baa8021ec0abe496ce94603b6b4&token=894028224&lang=zh_CN#rd\">è¶…é•¿é“¾æ¥</a>çš„è·³è½¬åŠŸèƒ½</li>\n<li><strong>ä¾¿äºä½¿ç”¨</strong><ul>\n<li>ç›¸åŒå­—ç¬¦é™åˆ¶æƒ…å†µä¸‹ï¼ŒçŸ­é“¾å¯ä»¥ä¼ é€’æ›´å¤šä¿¡æ¯</li>\n<li>ç”¨çŸ­é“¾ç”Ÿæˆçš„äºŒç»´ç æ›´å®¹æ˜“è¢«è¯†åˆ«</li>\n</ul>\n</li>\n<li><strong>èŠ‚çº¦æˆæœ¬</strong>ï¼šæœ‰äº›å¹³å°çš„çŸ­ä¿¡æœåŠ¡æŒ‰ç…§å­—ç¬¦æ•°è®¡è´¹ï¼Œä»è¿™ä¸ªè§’åº¦å‡ºå‘ï¼ŒçŸ­é“¾å¯ä»¥èŠ‚çº¦æˆæœ¬</li>\n</ul>\n<h3 id=\"çŸ­é“¾çš„åŸç†\"><a href=\"#çŸ­é“¾çš„åŸç†\" class=\"headerlink\" title=\"çŸ­é“¾çš„åŸç†\"></a>çŸ­é“¾çš„åŸç†</h3><p>ä»¥è¿™ä¸ª<a href=\"http://gk.link/a/10q2I\">çŸ­é“¾</a>ä¸ºä¾‹å­ï¼Œæ¢ç©¶çŸ­é“¾çš„åŸç†</p>\n<p>è¾“å…¥<code>curl -i http://gk.link/a/10q2I</code>å‘½ä»¤ï¼Œå…¶ä¸­<code>-i</code>è¡¨ç¤º<strong>è¿å¸¦ç›¸åº”å¤´</strong>ä¸€åŒè¾“å‡ºï¼Œç»“æœå¦‚ä¸‹å›¾æ‰€ç¤ºï¼š</p>\n<p><img src=\"https://raw.githubusercontent.com/lyydsheep/pic/main/202410151843629.png\" alt=\"image-20241015184327080\"></p>\n<p>å…¶ä¸­æœ‰ä¸¤ä¸ªé‡è¦ä¿¡æ¯å·²ç»è¢«æˆ‘æ¡†èµ·æ¥äº†ã€‚</p>\n<p><strong>ç›¸åº”çŠ¶æ€ç 302</strong>è¡¨ç¤ºä¸´æ—¶é‡å®šå‘ï¼Œç”¨äºå‘ŠçŸ¥æ¥æ”¶æ–¹å½“å‰åœ°å€åªæ˜¯ä¸€ä¸ªä¸´æ—¶åœ°å€ï¼ŒçœŸæ­£çš„åœ°å€åœ¨<code>Location</code>å­—æ®µä¸­</p>\n<p><strong>å¤´éƒ¨å­—æ®µLocation</strong>ä»£è¡¨äº†çœŸæ­£çš„ç›®çš„åœ°å€ï¼Œå½“æ¥æ”¶æ–¹æ”¶åˆ°è¿™ä¸ªå“åº”åï¼Œä¼šå–å‡ºå¹¶è®¿é—®Locationå­—æ®µä¸­çš„åœ°å€</p>\n<p><img src=\"https://raw.githubusercontent.com/lyydsheep/pic/main/202410151851474.png\" alt=\"image-20241015185124443\"></p>\n<p>ç®€å•æ¦‚æ‹¬ï¼Œæˆ‘ä»¬è®¿é—®ä¸€ä¸ªæçŸ­çš„é“¾æ¥ï¼Œç„¶åé‡å®šå‘åˆ°åŸå§‹åœ°å€ï¼ˆä¸€èˆ¬åŸå§‹åœ°å€æ¯”çŸ­é“¾é•¿å¾—å¤šï¼‰</p>\n<h3 id=\"å¦‚ä½•ç”ŸæˆçŸ­é“¾\"><a href=\"#å¦‚ä½•ç”ŸæˆçŸ­é“¾\" class=\"headerlink\" title=\"å¦‚ä½•ç”ŸæˆçŸ­é“¾\"></a>å¦‚ä½•ç”ŸæˆçŸ­é“¾</h3><h4 id=\"å“ˆå¸Œç®—æ³•\"><a href=\"#å“ˆå¸Œç®—æ³•\" class=\"headerlink\" title=\"å“ˆå¸Œç®—æ³•\"></a>å“ˆå¸Œç®—æ³•</h4><p>å¾ˆæ˜¾ç„¶ï¼ŒçŸ­é“¾å’ŒåŸå§‹é“¾æ¥æœ€å¥½æ˜¯ä¸€å¯¹ä¸€å…³ç³»ã€‚é‚£ä¹ˆå¯ä»¥å°†é—®é¢˜è½¬æ¢æˆ<strong>å¦‚ä½•ä¸ºä¸€ä¸ªé“¾æ¥æ‰¾åˆ°å”¯ä¸€çš„å¯¹åº”å€¼ï¼Ÿ</strong></p>\n<p>ä¸€ç§å¾ˆç›´æ¥çš„æƒ³æ³•ï¼šæˆ‘ä»¬å¯ä»¥å°†åŸå§‹é“¾æ¥é€šè¿‡ä¸€æ¬¡ï¼ˆæˆ–å¤šæ¬¡ï¼‰<strong>å“ˆå¸Œè®¡ç®—</strong>ï¼Œå¾—åˆ°ä¸€ä¸ªå¯¹åº”å€¼ã€‚ä½†æ˜¯ç°å¦‚ä»Šæœ‰ä¼—å¤šå“ˆå¸Œç®—æ³•ï¼Œä¾‹å¦‚MD5ã€SHA-1ã€SHA-256ï¼Œåˆè¯¥å¦‚ä½•é€‰æ‹©ï¼Ÿ</p>\n<p>æˆ‘ä»¬å¯ä»¥ä»åŠ å¯†ç¨‹åº¦çš„è§’åº¦å°†å“ˆå¸Œç®—æ³•åˆ†ä¸ºä¸¤å¤§ç±»ï¼š<strong>åŠ å¯†å“ˆå¸Œ</strong>ã€<strong>éåŠ å¯†å“ˆå¸Œ</strong>ã€‚å½“è¾“å…¥å€¼ç»è¿‡åŠ å¯†å“ˆå¸Œè®¡ç®—åï¼Œæ— æ³•ä»è¾“å‡ºå€¼åæ¨å‡ºè¾“å…¥å€¼ï¼Œä¿è¯äº†è¾“å…¥å€¼çš„å®‰å…¨æ€§ï¼Œä½†ä»£ä»·æ˜¯éœ€è¦è€—è´¹æ›´å¤šçš„è®¡ç®—èµ„æºï¼ˆæ—¶é—´ï¼‰ã€‚åœ¨çŸ­é“¾åœºæ™¯ä¸­ï¼Œç›¸è¾ƒäºåŸæ–‡çš„ä¿å¯†æ€§ï¼Œè¿ç®—é€Ÿåº¦æ˜¯æˆ‘ä»¬æ›´åŠ å…³å¿ƒçš„å› ç´ ã€‚å› æ­¤ï¼Œå¯ä»¥é‡‡ç”¨éåŠ å¯†å“ˆå¸Œï¼Œä¾‹å¦‚<a href=\"https://www.ifuyun.com/tool/murmurhash\">MurmurHash</a>ï¼Œæ¥ç”ŸæˆçŸ­é“¾ã€‚</p>\n<p>ä½¿ç”¨å“ˆå¸Œç®—æ³•çš„åœºæ™¯ï¼Œä¸å¯é¿å…ä¼šå‡ºç°<strong>å“ˆå¸Œå†²çª</strong>é—®é¢˜å³ä¸åŒçš„è¾“å…¥å€¼é€šè¿‡å“ˆå¸Œè®¡ç®—æ—¶å¾—åˆ°äº†ç›¸åŒçš„è¾“å‡ºå€¼ã€‚å€Ÿé‰´<code>bcrypt</code>åŠ å¯†ç®—æ³•ä¸­çš„<strong>åŠ ç›</strong>æ“ä½œï¼Œå½“æŸä¸€ä¸ªè¾“å…¥å€¼å‘ç”Ÿå“ˆå¸Œå†²çªåï¼Œå¯ä»¥åœ¨æ·»åŠ ä¸€æ®µ<strong>ç‰¹æ®Šå­—ç¬¦</strong>åå†è¿›è¡Œå“ˆå¸Œè¿ç®—ï¼Œåå¤æ“ä½œç›´è‡³å†²çªæ¶ˆå¤±ã€‚</p>\n<figure class=\"highlight go\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\">/*</span></span><br><span class=\"line\"><span class=\"comment\">www.baidu.com</span></span><br><span class=\"line\"><span class=\"comment\">å“ˆå¸Œå†²çª ---&gt; æ·»åŠ ç‰¹æ®Šå­—ç¬¦</span></span><br><span class=\"line\"><span class=\"comment\">www.baidu.com[hello_world]</span></span><br><span class=\"line\"><span class=\"comment\">*/</span></span><br></pre></td></tr></table></figure>\n\n<p>é€šè¿‡å“ˆå¸Œç®—æ³•å¾—åˆ°ä¸€ä¸ªæ•°å€¼åï¼Œä¾‹å¦‚3510643912ï¼Œæˆ‘ä»¬è¿˜å¯ä»¥åˆ©ç”¨<strong>62è¿›åˆ¶ï¼ˆ0-9ã€a-zã€A-Zå…±62ä¸ªURLåˆæ³•å­—ç¬¦ï¼‰</strong>å°†ç»“æœè¿›ä¸€æ­¥ç¼©çŸ­</p>\n<p>ğŸŒ°ï¼š3510643912 â€”&gt; 3PAiQUï¼Œè¿™æ ·æˆ‘ä»¬å°±å¯ä»¥åˆ©ç”¨æ›´çŸ­çš„å­—ç¬¦ä¸²ä½œä¸ºçŸ­é“¾</p>\n<h4 id=\"å”¯ä¸€IDç®—æ³•\"><a href=\"#å”¯ä¸€IDç®—æ³•\" class=\"headerlink\" title=\"å”¯ä¸€IDç®—æ³•\"></a>å”¯ä¸€IDç®—æ³•</h4><p>é™¤äº†ä½¿ç”¨å“ˆå¸Œç®—æ³•ç®€åŒ–é•¿é“¾ï¼Œè¿˜èƒ½ä¸ºæ¯ä¸€ä¸ªé•¿é“¾è¯·æ±‚åˆ†é…ä¸€ä¸ªå”¯ä¸€çš„IDï¼Œè¿™ä¸ªå”¯ä¸€IDå°±ç›¸å½“äºå“ˆå¸Œç®—æ³•ä¸­çš„å“ˆå¸Œå€¼ã€‚å½“ç„¶ï¼Œå”¯ä¸€IDä¹Ÿèƒ½åœ¨<strong>base62è¿›åˆ¶</strong>ä¸‹è¿›ä¸€æ­¥åŒ–ç®€</p>\n<p>é‚£ä¹ˆç°åœ¨çš„é—®é¢˜å°±æ˜¯ï¼Œ<strong>å¦‚ä½•è®¾è®¡ä¸€ä¸ªIDåˆ†å·å™¨ï¼Ÿ</strong></p>\n<h5 id=\"MySQLè‡ªå¢IDåˆ†å·\"><a href=\"#MySQLè‡ªå¢IDåˆ†å·\" class=\"headerlink\" title=\"MySQLè‡ªå¢IDåˆ†å·\"></a>MySQLè‡ªå¢IDåˆ†å·</h5><p>é€šè¿‡MySQLè‡ªå¢ä¸»é”®ä¸ºé•¿é“¾åˆ†å‘ä¸€ä¸ªå”¯ä¸€IDï¼Œä½†è¿™ç§æ–¹æ³•å­˜åœ¨<strong>é«˜å¹¶å‘æ€§èƒ½é—®é¢˜</strong>ã€‚ä¸€ç§è§£å†³æ€è·¯æ˜¯ï¼šé¢„å…ˆä¸ºé›†ç¾¤ä¸­çš„æ¯ä¸€ä¸ªæœåŠ¡åˆ†é…ä¸€ä¸ªå¯ç”¨çš„IDèŒƒå›´ï¼Œåªæœ‰å½“æœåŠ¡ä¸­å¯ä½¿ç”¨çš„IDä¸è¶³æ—¶æ‰ä¼šå‘æ•°æ®æºè¯·æ±‚æ–°çš„ID</p>\n<img src=\"https://raw.githubusercontent.com/lyydsheep/pic/main/202410161917898.png\" alt=\"image-20241016191703853\" style=\"zoom:50%;\" />\n\n<p>å¦‚ä¸Šå›¾æ‰€ç¤ºï¼Œ<code>biz_tag</code>è¡¨ç¤ºä¸šåŠ¡ç±»å‹ï¼Œ<code>max_id</code>è¡¨ç¤ºå½“å‰ä¸šåŠ¡å¯åˆ†å‘çš„æœ€å¤§IDï¼Œ<code>step</code>è¡¨ç¤ºæ­¥é•¿ï¼Œå³æ¯ä¸ªæœåŠ¡ä¸€æ¬¡é¢„å¯ç”³è¯·å¤šå°‘ä¸ªIDå·ç </p>\n<img src=\"https://raw.githubusercontent.com/lyydsheep/pic/main/202410161920030.png\" alt=\"image-20241016191959985\" style=\"zoom:50%;\" />\n\n<p>å½“IDä¸å¤Ÿç”¨äº†ï¼Œå°±åƒæ•°æ®åº“å†ç”³è¯·ä¸€æ‰¹</p>\n<p>æ­¤å¤–ï¼Œè¿˜å¯ä»¥å¼•å…¥<strong>é˜Ÿåˆ—ç¼“å†² + æ‰¹é‡å†™å…¥</strong>æ¶æ„ï¼Œåœ¨åŒºé—´å¿«æ»¡æ—¶å°±ç”³è¯·ä¸€æ‰¹æ–°çš„IDå·ç ï¼Œç­‰åŒºé—´æ»¡äº†å†ä¸€æ¬¡æ€§å†™å…¥æ•°æ®åº“ä¸­ï¼Œå®ç°å¼‚æ­¥è¿›è¡Œè·å–å’Œå†™å…¥æ“ä½œï¼Œä¿è¯æœåŠ¡æŒç»­çš„é«˜å¹¶å‘</p>\n<p>ä¾‹å¦‚ï¼Œ<strong>ç°æœ‰10000ä¸ªIDå·ç ï¼Œå½“å‰©ä½™çš„IDå·ä¸è¶³1000æ—¶ï¼Œå°±å‘æ•°æ®æºè¯·æ±‚å†åˆ†å‘10000ä¸ªIDå·ï¼Œåœ¨ä¸Šä¸€æ‰¹IDç”¨å®Œæ—¶ï¼Œå°†æ•°æ®æ‰¹é‡å†™å…¥æ•°æ®åº“ä¸­</strong></p>\n<p>MySQLè‡ªå¢IDä¼˜ç‚¹ï¼š</p>\n<ul>\n<li>ç®€å•æ–¹ä¾¿ï¼Œå®¹æ˜“å®ç°</li>\n</ul>\n<p>ç¼ºç‚¹ï¼š</p>\n<ul>\n<li>æ•´ä½“æ€§èƒ½ååé‡ä½ï¼Œé«˜å¹¶å‘åœºæ™¯ä¸‹å®¹æ˜“å‡ºç°å•ç‚¹ç“¶é¢ˆ</li>\n</ul>\n<h5 id=\"Redisè‡ªå¢ID\"><a href=\"#Redisè‡ªå¢ID\" class=\"headerlink\" title=\"Redisè‡ªå¢ID\"></a>Redisè‡ªå¢ID</h5><p>RedisåŸºäºå†…å­˜å®ç°ï¼Œå¹¶å‘æ€§èƒ½é«˜ï¼ˆ10wï¼‰ï¼Œä½†ä½¿ç”¨Redisä½œä¸ºåˆ†å·å™¨éœ€è¦è€ƒè™‘<strong>æŒä¹…åŒ–å’Œç¾å¤‡</strong></p>\n<p>ä¼˜ç‚¹ï¼š</p>\n<ul>\n<li>æ•´ä½“ååé‡æ¯”æ•°æ®å¥½</li>\n</ul>\n<p>ç¼ºç‚¹ï¼š</p>\n<ul>\n<li>Rediså®ä¾‹æˆ–é›†ç¾¤å®•æœºåï¼Œå¾ˆéš¾æ‰¾å›æœ€æ–°çš„ID</li>\n</ul>\n<h5 id=\"é›ªèŠ±ç®—æ³•ç”ŸæˆID\"><a href=\"#é›ªèŠ±ç®—æ³•ç”ŸæˆID\" class=\"headerlink\" title=\"é›ªèŠ±ç®—æ³•ç”ŸæˆID\"></a>é›ªèŠ±ç®—æ³•ç”ŸæˆID</h5><p>å‰ä¸¤ç§æ–¹æ¡ˆéƒ½æ˜¯è¿œç¨‹IDç”Ÿæˆï¼Œä¸€èˆ¬æ¥è¯´ï¼Œè¿œç¨‹IDç”Ÿæˆæ•ˆç‡ï¼ˆæœ¬èº«å¯¹åº”çš„ç»„ä»¶è€—æ—¶ + ç½‘ç»œè€—æ—¶ï¼‰ä¸å¦‚æœ¬åœ°IDç”Ÿæˆã€‚é›ªèŠ±ç®—æ³•ç”ŸæˆIDæ–¹æ¡ˆå°±æ˜¯ä¸€ç§æœ¬åœ°IDæ–¹æ¡ˆï¼Œä¸ä¾èµ–äºå…¶ä»–çš„æœåŠ¡ã€‚</p>\n<p>é›ªèŠ±ç®—æ³•ä½¿ç”¨ä¸€ä¸ªlongç±»å‹çš„æ•´æ•°ï¼ˆ64ä½bitï¼‰æ¥è¡¨ç¤ºä¸€ä¸ªIDï¼Œå…·ä½“ç”±<strong>1bitç©ºé—² + 41bitæ—¶é—´æˆ³ï¼ˆæ¯«ç§’çº§åˆ«ï¼‰ + 10bitæœºå™¨IDï¼ˆæˆ–æœºæˆ¿ID + æœºå™¨IDï¼‰ + 12bitåºåˆ—å·</strong>ç»„æˆã€‚</p>\n<img src=\"https://raw.githubusercontent.com/lyydsheep/pic/main/202410161948837.png\" alt=\"image-20241016194848744\" style=\"zoom:50%;\" />\n\n<p>ä¼˜ç‚¹ï¼š</p>\n<ul>\n<li>é«˜æ€§èƒ½ã€ä½å»¶è¿Ÿã€å»ä¸­å¿ƒåŒ–ã€æ•´ä½“æŒ‰æ—¶é—´æœ‰åº</li>\n</ul>\n<p>ç¼ºç‚¹ï¼š</p>\n<ul>\n<li>è¦æ±‚æœºå™¨æ—¶é—´åŒæ­¥åœ¨ç§’çº§åˆ«ï¼Œå¦åˆ™ä¼šäº§ç”ŸIDå†²çª</li>\n<li>å¦‚æœæŸå°æœºå™¨æ—¶é’Ÿå›æ‹¨è¿™æœ‰å¯èƒ½å‘ç”ŸIDå†²çª</li>\n</ul>\n<h2 id=\"è®¾è®¡çŸ­é“¾\"><a href=\"#è®¾è®¡çŸ­é“¾\" class=\"headerlink\" title=\"è®¾è®¡çŸ­é“¾\"></a>è®¾è®¡çŸ­é“¾</h2><h3 id=\"é‡å®šå‘çŠ¶æ€ç çš„é€‰æ‹©\"><a href=\"#é‡å®šå‘çŠ¶æ€ç çš„é€‰æ‹©\" class=\"headerlink\" title=\"é‡å®šå‘çŠ¶æ€ç çš„é€‰æ‹©\"></a>é‡å®šå‘çŠ¶æ€ç çš„é€‰æ‹©</h3><p>ç”±ä¹‹å‰çš„åˆ†ææˆ‘ä»¬çŸ¥é“äº†çŸ­é“¾ç³»ç»Ÿçš„å¤§è‡´å·¥ä½œåŸç†ï¼šæµè§ˆå™¨è®¿é—®çŸ­é“¾ï¼ŒçŸ­é“¾æœåŠ¡å‘æµè§ˆå™¨è¿”å›ä¸€ä¸ª<strong>é‡å®šå‘çŠ¶æ€ç </strong>å’Œ<strong>å¯¹åº”çš„é•¿é“¾</strong>ã€‚æ¥ç€ï¼Œæµè§ˆå™¨è®¿é—®é•¿é“¾è·å–å¹¶è·å–åˆ°ç›®æ ‡èµ„æºã€‚</p>\n<p><img src=\"https://raw.githubusercontent.com/lyydsheep/pic/main/202410182126756.png\" alt=\"image-20241015185124443\"></p>\n<p>åœ¨çŸ­é“¾ç³»ç»Ÿä¸­ä¸€èˆ¬åªè€ƒè™‘ä½¿ç”¨<strong>æ°¸ä¹…é‡å®šå‘301</strong>æˆ–<strong>ä¸´æ—¶é‡å®šå‘302</strong>çŠ¶æ€ç </p>\n<p>ä¸¤ä¸ªçŠ¶æ€ç åŒºåˆ«å¦‚ä¸‹ï¼š</p>\n<ul>\n<li><strong>301çŠ¶æ€ç è¡¨ç¤ºæ°¸ä¹…é‡å®šå‘ï¼Œæµè§ˆå™¨æ”¶åˆ°æ”¹çŠ¶æ€ç æ—¶ï¼Œä¼šå°†<code>Location</code>å­—æ®µå€¼ç¼“å­˜åœ¨æœ¬åœ°ï¼Œå½“å°†å†æ¬¡è®¿é—®çŸ­é“¾æ—¶å°±ç›´æ¥ä»ç¼“å­˜ä¸­æ‹¿å‡ºé•¿é“¾åœ°å€å¹¶è®¿é—®ï¼ŒèŠ‚çº¦äº†ä¸€æ¬¡è®¿é—®çŸ­é“¾æœåŠ¡çš„æ¬¡æ•°</strong></li>\n<li><strong>302çŠ¶æ€ç è¡¨ç¤ºä¸´æ—¶é‡å®šå‘ï¼Œæµè§ˆå™¨ä¸ä¼šç¼“å­˜å“åº”å¤´éƒ¨ä¸­çš„<code>Location</code>å­—æ®µ</strong></li>\n<li><strong>åœ¨çŸ­é“¾ç³»ç»Ÿä¸­ï¼Œæµè§ˆå™¨çš„ç¼“å­˜è¡Œä¸ºå¯èƒ½å¹¶éæ˜¯æˆ‘ä»¬é¢„æœŸçš„ï¼Œå°¤å…¶éœ€è¦å¯¹çŸ­é“¾è¿›è¡Œåˆ†æçš„æƒ…å†µ</strong><ul>\n<li>ğŸŒ°ï¼šå°†ä¸€ä¸ªçŸ­é“¾é€šè¿‡çŸ­ä¿¡å‘é€ç»™1wä¸ªç”¨æˆ·ï¼Œå¦‚æœä½¿ç”¨302çŠ¶æ€ç å°±å¯ä»¥æµ‹è¯•å‡ºè¿™1wä¸ªç”¨æˆ·é’ˆå¯¹çŸ­é“¾çš„ç‚¹å‡»æ¬¡æ•°ã€‚ä½†æ˜¯åœ¨ä½¿ç”¨301çŠ¶æ€ç æƒ…å†µä¸‹ï¼Œæ¯ä¸€ä¸ªç”¨æˆ·æœ€å¤šåªä¼šè¢«ç»Ÿè®¡ä¸€æ¬¡ã€‚ï¼ˆå› ä¸ºæµè§ˆå™¨ç¼“å­˜äº†é•¿é“¾åœ°å€ï¼‰</li>\n</ul>\n</li>\n</ul>\n<h3 id=\"æ¥å£è®¾è®¡\"><a href=\"#æ¥å£è®¾è®¡\" class=\"headerlink\" title=\"æ¥å£è®¾è®¡\"></a>æ¥å£è®¾è®¡</h3>","excerpt":"","more":"<h1 id=\"çŸ­é“¾ç³»ç»Ÿ\"><a href=\"#çŸ­é“¾ç³»ç»Ÿ\" class=\"headerlink\" title=\"çŸ­é“¾ç³»ç»Ÿ\"></a>çŸ­é“¾ç³»ç»Ÿ</h1><h2 id=\"è®¤è¯†çŸ­é“¾\"><a href=\"#è®¤è¯†çŸ­é“¾\" class=\"headerlink\" title=\"è®¤è¯†çŸ­é“¾\"></a>è®¤è¯†çŸ­é“¾</h2><p>çŸ­é“¾å³çŸ­é“¾æ¥ï¼Œä¾‹å¦‚<a href=\"http://gk.link/a/10q2I\">è¿™ä¸ªé“¾æ¥</a>ï¼Œå¾ˆç®€çŸ­ã€‚è€Œé•¿é“¾æ¥æˆ–è€…å«åšåŸå§‹é“¾æ¥åˆ™æœ‰ä¸€ç‚¹é•¿ï¼Œä¾‹å¦‚<a href=\"https://time.geekbang.org/column/intro/100020801?code=ieY8HeRSlDsFbuRtggbBQGxdTh-1jMASqEIeqzHAKrI=\">è¿™ä¸ªé“¾æ¥</a></p>\n<p>å¯ä»¥å‘ç°ï¼Œä¸Šè¿°ä¸¤ä¸ªé“¾æ¥éƒ½è·³è½¬è‡³åŒä¸€ä¸ªé¡µé¢ï¼Œé‚£ä¹ˆæœ‰äº†åŸå§‹é“¾æ¥åï¼Œä¸ºä»€ä¹ˆè¿˜è¦ç”Ÿæˆä¸€ä¸ªçŸ­é“¾æ¥ï¼Ÿæˆ–è€…è¯´çŸ­é“¾æ¥æœ‰ä»€ä¹ˆä»·å€¼ğŸ¤”ï¼Ÿ</p>\n<p>ç›¸æ¯”äºåŸå§‹é“¾æ¥ï¼ŒçŸ­é“¾çš„ä¼˜åŠ¿å°±åœ¨äº<strong>çŸ­</strong>ã€‚å› æ­¤ï¼ŒçŸ­é“¾åœ¨å®é™…åº”ç”¨ä¸­å…·æœ‰å¦‚ä¸‹ä¼˜åŠ¿ï¼š</p>\n<ul>\n<li><strong>ç®€æ´æ˜äº†</strong>ï¼šåªéœ€è¦ç®€å•å‡ ä¸ªå­—ç¬¦å°±èƒ½å®ç°<a href=\"https://mp.weixin.qq.com/s?__biz=MzA4MjIyNTY0MQ==&mid=2647743787&idx=1&sn=1caec8eb1b81d6ee5dd7ba7fa05ac0f1&chksm=87ad0dadb0da84bb7beb5e4373a14e89fba1130c1bd2a51f4baa8021ec0abe496ce94603b6b4&token=894028224&lang=zh_CN#rd\">è¶…é•¿é“¾æ¥</a>çš„è·³è½¬åŠŸèƒ½</li>\n<li><strong>ä¾¿äºä½¿ç”¨</strong><ul>\n<li>ç›¸åŒå­—ç¬¦é™åˆ¶æƒ…å†µä¸‹ï¼ŒçŸ­é“¾å¯ä»¥ä¼ é€’æ›´å¤šä¿¡æ¯</li>\n<li>ç”¨çŸ­é“¾ç”Ÿæˆçš„äºŒç»´ç æ›´å®¹æ˜“è¢«è¯†åˆ«</li>\n</ul>\n</li>\n<li><strong>èŠ‚çº¦æˆæœ¬</strong>ï¼šæœ‰äº›å¹³å°çš„çŸ­ä¿¡æœåŠ¡æŒ‰ç…§å­—ç¬¦æ•°è®¡è´¹ï¼Œä»è¿™ä¸ªè§’åº¦å‡ºå‘ï¼ŒçŸ­é“¾å¯ä»¥èŠ‚çº¦æˆæœ¬</li>\n</ul>\n<h3 id=\"çŸ­é“¾çš„åŸç†\"><a href=\"#çŸ­é“¾çš„åŸç†\" class=\"headerlink\" title=\"çŸ­é“¾çš„åŸç†\"></a>çŸ­é“¾çš„åŸç†</h3><p>ä»¥è¿™ä¸ª<a href=\"http://gk.link/a/10q2I\">çŸ­é“¾</a>ä¸ºä¾‹å­ï¼Œæ¢ç©¶çŸ­é“¾çš„åŸç†</p>\n<p>è¾“å…¥<code>curl -i http://gk.link/a/10q2I</code>å‘½ä»¤ï¼Œå…¶ä¸­<code>-i</code>è¡¨ç¤º<strong>è¿å¸¦ç›¸åº”å¤´</strong>ä¸€åŒè¾“å‡ºï¼Œç»“æœå¦‚ä¸‹å›¾æ‰€ç¤ºï¼š</p>\n<p><img src=\"https://raw.githubusercontent.com/lyydsheep/pic/main/202410151843629.png\" alt=\"image-20241015184327080\"></p>\n<p>å…¶ä¸­æœ‰ä¸¤ä¸ªé‡è¦ä¿¡æ¯å·²ç»è¢«æˆ‘æ¡†èµ·æ¥äº†ã€‚</p>\n<p><strong>ç›¸åº”çŠ¶æ€ç 302</strong>è¡¨ç¤ºä¸´æ—¶é‡å®šå‘ï¼Œç”¨äºå‘ŠçŸ¥æ¥æ”¶æ–¹å½“å‰åœ°å€åªæ˜¯ä¸€ä¸ªä¸´æ—¶åœ°å€ï¼ŒçœŸæ­£çš„åœ°å€åœ¨<code>Location</code>å­—æ®µä¸­</p>\n<p><strong>å¤´éƒ¨å­—æ®µLocation</strong>ä»£è¡¨äº†çœŸæ­£çš„ç›®çš„åœ°å€ï¼Œå½“æ¥æ”¶æ–¹æ”¶åˆ°è¿™ä¸ªå“åº”åï¼Œä¼šå–å‡ºå¹¶è®¿é—®Locationå­—æ®µä¸­çš„åœ°å€</p>\n<p><img src=\"https://raw.githubusercontent.com/lyydsheep/pic/main/202410151851474.png\" alt=\"image-20241015185124443\"></p>\n<p>ç®€å•æ¦‚æ‹¬ï¼Œæˆ‘ä»¬è®¿é—®ä¸€ä¸ªæçŸ­çš„é“¾æ¥ï¼Œç„¶åé‡å®šå‘åˆ°åŸå§‹åœ°å€ï¼ˆä¸€èˆ¬åŸå§‹åœ°å€æ¯”çŸ­é“¾é•¿å¾—å¤šï¼‰</p>\n<h3 id=\"å¦‚ä½•ç”ŸæˆçŸ­é“¾\"><a href=\"#å¦‚ä½•ç”ŸæˆçŸ­é“¾\" class=\"headerlink\" title=\"å¦‚ä½•ç”ŸæˆçŸ­é“¾\"></a>å¦‚ä½•ç”ŸæˆçŸ­é“¾</h3><h4 id=\"å“ˆå¸Œç®—æ³•\"><a href=\"#å“ˆå¸Œç®—æ³•\" class=\"headerlink\" title=\"å“ˆå¸Œç®—æ³•\"></a>å“ˆå¸Œç®—æ³•</h4><p>å¾ˆæ˜¾ç„¶ï¼ŒçŸ­é“¾å’ŒåŸå§‹é“¾æ¥æœ€å¥½æ˜¯ä¸€å¯¹ä¸€å…³ç³»ã€‚é‚£ä¹ˆå¯ä»¥å°†é—®é¢˜è½¬æ¢æˆ<strong>å¦‚ä½•ä¸ºä¸€ä¸ªé“¾æ¥æ‰¾åˆ°å”¯ä¸€çš„å¯¹åº”å€¼ï¼Ÿ</strong></p>\n<p>ä¸€ç§å¾ˆç›´æ¥çš„æƒ³æ³•ï¼šæˆ‘ä»¬å¯ä»¥å°†åŸå§‹é“¾æ¥é€šè¿‡ä¸€æ¬¡ï¼ˆæˆ–å¤šæ¬¡ï¼‰<strong>å“ˆå¸Œè®¡ç®—</strong>ï¼Œå¾—åˆ°ä¸€ä¸ªå¯¹åº”å€¼ã€‚ä½†æ˜¯ç°å¦‚ä»Šæœ‰ä¼—å¤šå“ˆå¸Œç®—æ³•ï¼Œä¾‹å¦‚MD5ã€SHA-1ã€SHA-256ï¼Œåˆè¯¥å¦‚ä½•é€‰æ‹©ï¼Ÿ</p>\n<p>æˆ‘ä»¬å¯ä»¥ä»åŠ å¯†ç¨‹åº¦çš„è§’åº¦å°†å“ˆå¸Œç®—æ³•åˆ†ä¸ºä¸¤å¤§ç±»ï¼š<strong>åŠ å¯†å“ˆå¸Œ</strong>ã€<strong>éåŠ å¯†å“ˆå¸Œ</strong>ã€‚å½“è¾“å…¥å€¼ç»è¿‡åŠ å¯†å“ˆå¸Œè®¡ç®—åï¼Œæ— æ³•ä»è¾“å‡ºå€¼åæ¨å‡ºè¾“å…¥å€¼ï¼Œä¿è¯äº†è¾“å…¥å€¼çš„å®‰å…¨æ€§ï¼Œä½†ä»£ä»·æ˜¯éœ€è¦è€—è´¹æ›´å¤šçš„è®¡ç®—èµ„æºï¼ˆæ—¶é—´ï¼‰ã€‚åœ¨çŸ­é“¾åœºæ™¯ä¸­ï¼Œç›¸è¾ƒäºåŸæ–‡çš„ä¿å¯†æ€§ï¼Œè¿ç®—é€Ÿåº¦æ˜¯æˆ‘ä»¬æ›´åŠ å…³å¿ƒçš„å› ç´ ã€‚å› æ­¤ï¼Œå¯ä»¥é‡‡ç”¨éåŠ å¯†å“ˆå¸Œï¼Œä¾‹å¦‚<a href=\"https://www.ifuyun.com/tool/murmurhash\">MurmurHash</a>ï¼Œæ¥ç”ŸæˆçŸ­é“¾ã€‚</p>\n<p>ä½¿ç”¨å“ˆå¸Œç®—æ³•çš„åœºæ™¯ï¼Œä¸å¯é¿å…ä¼šå‡ºç°<strong>å“ˆå¸Œå†²çª</strong>é—®é¢˜å³ä¸åŒçš„è¾“å…¥å€¼é€šè¿‡å“ˆå¸Œè®¡ç®—æ—¶å¾—åˆ°äº†ç›¸åŒçš„è¾“å‡ºå€¼ã€‚å€Ÿé‰´<code>bcrypt</code>åŠ å¯†ç®—æ³•ä¸­çš„<strong>åŠ ç›</strong>æ“ä½œï¼Œå½“æŸä¸€ä¸ªè¾“å…¥å€¼å‘ç”Ÿå“ˆå¸Œå†²çªåï¼Œå¯ä»¥åœ¨æ·»åŠ ä¸€æ®µ<strong>ç‰¹æ®Šå­—ç¬¦</strong>åå†è¿›è¡Œå“ˆå¸Œè¿ç®—ï¼Œåå¤æ“ä½œç›´è‡³å†²çªæ¶ˆå¤±ã€‚</p>\n<figure class=\"highlight go\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\">/*</span></span><br><span class=\"line\"><span class=\"comment\">www.baidu.com</span></span><br><span class=\"line\"><span class=\"comment\">å“ˆå¸Œå†²çª ---&gt; æ·»åŠ ç‰¹æ®Šå­—ç¬¦</span></span><br><span class=\"line\"><span class=\"comment\">www.baidu.com[hello_world]</span></span><br><span class=\"line\"><span class=\"comment\">*/</span></span><br></pre></td></tr></table></figure>\n\n<p>é€šè¿‡å“ˆå¸Œç®—æ³•å¾—åˆ°ä¸€ä¸ªæ•°å€¼åï¼Œä¾‹å¦‚3510643912ï¼Œæˆ‘ä»¬è¿˜å¯ä»¥åˆ©ç”¨<strong>62è¿›åˆ¶ï¼ˆ0-9ã€a-zã€A-Zå…±62ä¸ªURLåˆæ³•å­—ç¬¦ï¼‰</strong>å°†ç»“æœè¿›ä¸€æ­¥ç¼©çŸ­</p>\n<p>ğŸŒ°ï¼š3510643912 â€”&gt; 3PAiQUï¼Œè¿™æ ·æˆ‘ä»¬å°±å¯ä»¥åˆ©ç”¨æ›´çŸ­çš„å­—ç¬¦ä¸²ä½œä¸ºçŸ­é“¾</p>\n<h4 id=\"å”¯ä¸€IDç®—æ³•\"><a href=\"#å”¯ä¸€IDç®—æ³•\" class=\"headerlink\" title=\"å”¯ä¸€IDç®—æ³•\"></a>å”¯ä¸€IDç®—æ³•</h4><p>é™¤äº†ä½¿ç”¨å“ˆå¸Œç®—æ³•ç®€åŒ–é•¿é“¾ï¼Œè¿˜èƒ½ä¸ºæ¯ä¸€ä¸ªé•¿é“¾è¯·æ±‚åˆ†é…ä¸€ä¸ªå”¯ä¸€çš„IDï¼Œè¿™ä¸ªå”¯ä¸€IDå°±ç›¸å½“äºå“ˆå¸Œç®—æ³•ä¸­çš„å“ˆå¸Œå€¼ã€‚å½“ç„¶ï¼Œå”¯ä¸€IDä¹Ÿèƒ½åœ¨<strong>base62è¿›åˆ¶</strong>ä¸‹è¿›ä¸€æ­¥åŒ–ç®€</p>\n<p>é‚£ä¹ˆç°åœ¨çš„é—®é¢˜å°±æ˜¯ï¼Œ<strong>å¦‚ä½•è®¾è®¡ä¸€ä¸ªIDåˆ†å·å™¨ï¼Ÿ</strong></p>\n<h5 id=\"MySQLè‡ªå¢IDåˆ†å·\"><a href=\"#MySQLè‡ªå¢IDåˆ†å·\" class=\"headerlink\" title=\"MySQLè‡ªå¢IDåˆ†å·\"></a>MySQLè‡ªå¢IDåˆ†å·</h5><p>é€šè¿‡MySQLè‡ªå¢ä¸»é”®ä¸ºé•¿é“¾åˆ†å‘ä¸€ä¸ªå”¯ä¸€IDï¼Œä½†è¿™ç§æ–¹æ³•å­˜åœ¨<strong>é«˜å¹¶å‘æ€§èƒ½é—®é¢˜</strong>ã€‚ä¸€ç§è§£å†³æ€è·¯æ˜¯ï¼šé¢„å…ˆä¸ºé›†ç¾¤ä¸­çš„æ¯ä¸€ä¸ªæœåŠ¡åˆ†é…ä¸€ä¸ªå¯ç”¨çš„IDèŒƒå›´ï¼Œåªæœ‰å½“æœåŠ¡ä¸­å¯ä½¿ç”¨çš„IDä¸è¶³æ—¶æ‰ä¼šå‘æ•°æ®æºè¯·æ±‚æ–°çš„ID</p>\n<img src=\"https://raw.githubusercontent.com/lyydsheep/pic/main/202410161917898.png\" alt=\"image-20241016191703853\" style=\"zoom:50%;\" />\n\n<p>å¦‚ä¸Šå›¾æ‰€ç¤ºï¼Œ<code>biz_tag</code>è¡¨ç¤ºä¸šåŠ¡ç±»å‹ï¼Œ<code>max_id</code>è¡¨ç¤ºå½“å‰ä¸šåŠ¡å¯åˆ†å‘çš„æœ€å¤§IDï¼Œ<code>step</code>è¡¨ç¤ºæ­¥é•¿ï¼Œå³æ¯ä¸ªæœåŠ¡ä¸€æ¬¡é¢„å¯ç”³è¯·å¤šå°‘ä¸ªIDå·ç </p>\n<img src=\"https://raw.githubusercontent.com/lyydsheep/pic/main/202410161920030.png\" alt=\"image-20241016191959985\" style=\"zoom:50%;\" />\n\n<p>å½“IDä¸å¤Ÿç”¨äº†ï¼Œå°±åƒæ•°æ®åº“å†ç”³è¯·ä¸€æ‰¹</p>\n<p>æ­¤å¤–ï¼Œè¿˜å¯ä»¥å¼•å…¥<strong>é˜Ÿåˆ—ç¼“å†² + æ‰¹é‡å†™å…¥</strong>æ¶æ„ï¼Œåœ¨åŒºé—´å¿«æ»¡æ—¶å°±ç”³è¯·ä¸€æ‰¹æ–°çš„IDå·ç ï¼Œç­‰åŒºé—´æ»¡äº†å†ä¸€æ¬¡æ€§å†™å…¥æ•°æ®åº“ä¸­ï¼Œå®ç°å¼‚æ­¥è¿›è¡Œè·å–å’Œå†™å…¥æ“ä½œï¼Œä¿è¯æœåŠ¡æŒç»­çš„é«˜å¹¶å‘</p>\n<p>ä¾‹å¦‚ï¼Œ<strong>ç°æœ‰10000ä¸ªIDå·ç ï¼Œå½“å‰©ä½™çš„IDå·ä¸è¶³1000æ—¶ï¼Œå°±å‘æ•°æ®æºè¯·æ±‚å†åˆ†å‘10000ä¸ªIDå·ï¼Œåœ¨ä¸Šä¸€æ‰¹IDç”¨å®Œæ—¶ï¼Œå°†æ•°æ®æ‰¹é‡å†™å…¥æ•°æ®åº“ä¸­</strong></p>\n<p>MySQLè‡ªå¢IDä¼˜ç‚¹ï¼š</p>\n<ul>\n<li>ç®€å•æ–¹ä¾¿ï¼Œå®¹æ˜“å®ç°</li>\n</ul>\n<p>ç¼ºç‚¹ï¼š</p>\n<ul>\n<li>æ•´ä½“æ€§èƒ½ååé‡ä½ï¼Œé«˜å¹¶å‘åœºæ™¯ä¸‹å®¹æ˜“å‡ºç°å•ç‚¹ç“¶é¢ˆ</li>\n</ul>\n<h5 id=\"Redisè‡ªå¢ID\"><a href=\"#Redisè‡ªå¢ID\" class=\"headerlink\" title=\"Redisè‡ªå¢ID\"></a>Redisè‡ªå¢ID</h5><p>RedisåŸºäºå†…å­˜å®ç°ï¼Œå¹¶å‘æ€§èƒ½é«˜ï¼ˆ10wï¼‰ï¼Œä½†ä½¿ç”¨Redisä½œä¸ºåˆ†å·å™¨éœ€è¦è€ƒè™‘<strong>æŒä¹…åŒ–å’Œç¾å¤‡</strong></p>\n<p>ä¼˜ç‚¹ï¼š</p>\n<ul>\n<li>æ•´ä½“ååé‡æ¯”æ•°æ®å¥½</li>\n</ul>\n<p>ç¼ºç‚¹ï¼š</p>\n<ul>\n<li>Rediså®ä¾‹æˆ–é›†ç¾¤å®•æœºåï¼Œå¾ˆéš¾æ‰¾å›æœ€æ–°çš„ID</li>\n</ul>\n<h5 id=\"é›ªèŠ±ç®—æ³•ç”ŸæˆID\"><a href=\"#é›ªèŠ±ç®—æ³•ç”ŸæˆID\" class=\"headerlink\" title=\"é›ªèŠ±ç®—æ³•ç”ŸæˆID\"></a>é›ªèŠ±ç®—æ³•ç”ŸæˆID</h5><p>å‰ä¸¤ç§æ–¹æ¡ˆéƒ½æ˜¯è¿œç¨‹IDç”Ÿæˆï¼Œä¸€èˆ¬æ¥è¯´ï¼Œè¿œç¨‹IDç”Ÿæˆæ•ˆç‡ï¼ˆæœ¬èº«å¯¹åº”çš„ç»„ä»¶è€—æ—¶ + ç½‘ç»œè€—æ—¶ï¼‰ä¸å¦‚æœ¬åœ°IDç”Ÿæˆã€‚é›ªèŠ±ç®—æ³•ç”ŸæˆIDæ–¹æ¡ˆå°±æ˜¯ä¸€ç§æœ¬åœ°IDæ–¹æ¡ˆï¼Œä¸ä¾èµ–äºå…¶ä»–çš„æœåŠ¡ã€‚</p>\n<p>é›ªèŠ±ç®—æ³•ä½¿ç”¨ä¸€ä¸ªlongç±»å‹çš„æ•´æ•°ï¼ˆ64ä½bitï¼‰æ¥è¡¨ç¤ºä¸€ä¸ªIDï¼Œå…·ä½“ç”±<strong>1bitç©ºé—² + 41bitæ—¶é—´æˆ³ï¼ˆæ¯«ç§’çº§åˆ«ï¼‰ + 10bitæœºå™¨IDï¼ˆæˆ–æœºæˆ¿ID + æœºå™¨IDï¼‰ + 12bitåºåˆ—å·</strong>ç»„æˆã€‚</p>\n<img src=\"https://raw.githubusercontent.com/lyydsheep/pic/main/202410161948837.png\" alt=\"image-20241016194848744\" style=\"zoom:50%;\" />\n\n<p>ä¼˜ç‚¹ï¼š</p>\n<ul>\n<li>é«˜æ€§èƒ½ã€ä½å»¶è¿Ÿã€å»ä¸­å¿ƒåŒ–ã€æ•´ä½“æŒ‰æ—¶é—´æœ‰åº</li>\n</ul>\n<p>ç¼ºç‚¹ï¼š</p>\n<ul>\n<li>è¦æ±‚æœºå™¨æ—¶é—´åŒæ­¥åœ¨ç§’çº§åˆ«ï¼Œå¦åˆ™ä¼šäº§ç”ŸIDå†²çª</li>\n<li>å¦‚æœæŸå°æœºå™¨æ—¶é’Ÿå›æ‹¨è¿™æœ‰å¯èƒ½å‘ç”ŸIDå†²çª</li>\n</ul>\n<h2 id=\"è®¾è®¡çŸ­é“¾\"><a href=\"#è®¾è®¡çŸ­é“¾\" class=\"headerlink\" title=\"è®¾è®¡çŸ­é“¾\"></a>è®¾è®¡çŸ­é“¾</h2><h3 id=\"é‡å®šå‘çŠ¶æ€ç çš„é€‰æ‹©\"><a href=\"#é‡å®šå‘çŠ¶æ€ç çš„é€‰æ‹©\" class=\"headerlink\" title=\"é‡å®šå‘çŠ¶æ€ç çš„é€‰æ‹©\"></a>é‡å®šå‘çŠ¶æ€ç çš„é€‰æ‹©</h3><p>ç”±ä¹‹å‰çš„åˆ†ææˆ‘ä»¬çŸ¥é“äº†çŸ­é“¾ç³»ç»Ÿçš„å¤§è‡´å·¥ä½œåŸç†ï¼šæµè§ˆå™¨è®¿é—®çŸ­é“¾ï¼ŒçŸ­é“¾æœåŠ¡å‘æµè§ˆå™¨è¿”å›ä¸€ä¸ª<strong>é‡å®šå‘çŠ¶æ€ç </strong>å’Œ<strong>å¯¹åº”çš„é•¿é“¾</strong>ã€‚æ¥ç€ï¼Œæµè§ˆå™¨è®¿é—®é•¿é“¾è·å–å¹¶è·å–åˆ°ç›®æ ‡èµ„æºã€‚</p>\n<p><img src=\"https://raw.githubusercontent.com/lyydsheep/pic/main/202410182126756.png\" alt=\"image-20241015185124443\"></p>\n<p>åœ¨çŸ­é“¾ç³»ç»Ÿä¸­ä¸€èˆ¬åªè€ƒè™‘ä½¿ç”¨<strong>æ°¸ä¹…é‡å®šå‘301</strong>æˆ–<strong>ä¸´æ—¶é‡å®šå‘302</strong>çŠ¶æ€ç </p>\n<p>ä¸¤ä¸ªçŠ¶æ€ç åŒºåˆ«å¦‚ä¸‹ï¼š</p>\n<ul>\n<li><strong>301çŠ¶æ€ç è¡¨ç¤ºæ°¸ä¹…é‡å®šå‘ï¼Œæµè§ˆå™¨æ”¶åˆ°æ”¹çŠ¶æ€ç æ—¶ï¼Œä¼šå°†<code>Location</code>å­—æ®µå€¼ç¼“å­˜åœ¨æœ¬åœ°ï¼Œå½“å°†å†æ¬¡è®¿é—®çŸ­é“¾æ—¶å°±ç›´æ¥ä»ç¼“å­˜ä¸­æ‹¿å‡ºé•¿é“¾åœ°å€å¹¶è®¿é—®ï¼ŒèŠ‚çº¦äº†ä¸€æ¬¡è®¿é—®çŸ­é“¾æœåŠ¡çš„æ¬¡æ•°</strong></li>\n<li><strong>302çŠ¶æ€ç è¡¨ç¤ºä¸´æ—¶é‡å®šå‘ï¼Œæµè§ˆå™¨ä¸ä¼šç¼“å­˜å“åº”å¤´éƒ¨ä¸­çš„<code>Location</code>å­—æ®µ</strong></li>\n<li><strong>åœ¨çŸ­é“¾ç³»ç»Ÿä¸­ï¼Œæµè§ˆå™¨çš„ç¼“å­˜è¡Œä¸ºå¯èƒ½å¹¶éæ˜¯æˆ‘ä»¬é¢„æœŸçš„ï¼Œå°¤å…¶éœ€è¦å¯¹çŸ­é“¾è¿›è¡Œåˆ†æçš„æƒ…å†µ</strong><ul>\n<li>ğŸŒ°ï¼šå°†ä¸€ä¸ªçŸ­é“¾é€šè¿‡çŸ­ä¿¡å‘é€ç»™1wä¸ªç”¨æˆ·ï¼Œå¦‚æœä½¿ç”¨302çŠ¶æ€ç å°±å¯ä»¥æµ‹è¯•å‡ºè¿™1wä¸ªç”¨æˆ·é’ˆå¯¹çŸ­é“¾çš„ç‚¹å‡»æ¬¡æ•°ã€‚ä½†æ˜¯åœ¨ä½¿ç”¨301çŠ¶æ€ç æƒ…å†µä¸‹ï¼Œæ¯ä¸€ä¸ªç”¨æˆ·æœ€å¤šåªä¼šè¢«ç»Ÿè®¡ä¸€æ¬¡ã€‚ï¼ˆå› ä¸ºæµè§ˆå™¨ç¼“å­˜äº†é•¿é“¾åœ°å€ï¼‰</li>\n</ul>\n</li>\n</ul>\n<h3 id=\"æ¥å£è®¾è®¡\"><a href=\"#æ¥å£è®¾è®¡\" class=\"headerlink\" title=\"æ¥å£è®¾è®¡\"></a>æ¥å£è®¾è®¡</h3>"},{"title":"ç½‘ç»œä»£ç†","publish":true,"description":"è®°å½•ä¸€äº›æœ‰å…³ç½‘ç»œä»£ç†çš„çŸ¥è¯†ç‚¹","date":"2024-09-26T16:00:00.000Z","sticky":2,"_content":"\n\n\n# ç½‘ç»œä»£ç†\n\n## æ­£å‘ä»£ç†å’Œåå‘ä»£ç†\n\n### æ­£å‘ä»£ç†\n\n**æ­£å‘ä»£ç†ï¼ˆforward proxyï¼‰**ï¼šæ˜¯ä¸€ä¸ªä½äºå®¢æˆ·ç«¯å’ŒæœåŠ¡å™¨ä¹‹é—´çš„ä»£ç†æœåŠ¡å™¨ï¼Œå®¢æˆ·ç«¯ä¸ºäº†è·å–æœåŠ¡å™¨ä¸Šçš„å†…å®¹ï¼Œå°†åŸæœ¬è¦å‘é€ç»™æœåŠ¡å™¨çš„èµ„æºè¯·æ±‚å‘é€ç»™ä»£ç†æœåŠ¡å™¨ï¼Œç„¶åä»£ç†æœåŠ¡å™¨å°†è¯·æ±‚è½¬äº¤ç»™ç›®æ ‡æœåŠ¡å™¨ï¼Œæœ€åä»£ç†æœåŠ¡å™¨æŠŠèµ„æºç»“æœè¿”å›ç»™å®¢æˆ·ç«¯\n\næŠ½è±¡åœ°ç†è§£ğŸŒŸï¼Œæ­£å‘ä»£ç†å°±æ˜¯ä»£ç†æœåŠ¡å™¨å»**ä»£ç†**å®¢æˆ·ç«¯\n\næ­£å‘ä»£ç†ä¸€èˆ¬æœ‰å¦‚ä¸‹ç”¨é€”ï¼š\n\n- **çªç ´è®¿é—®é™åˆ¶**ï¼šé€šè¿‡ä»£ç†æœåŠ¡å™¨ï¼Œå¯ä»¥çªç ´å®¢æˆ·ç«¯è‡ªèº«çš„IPè®¿é—®é™åˆ¶\n- **æé«˜è®¿é—®é€Ÿåº¦**ï¼šä»£ç†æœåŠ¡å™¨ä¸€èˆ¬éƒ½é…æœ‰è¾ƒå¤§çš„ç¡¬ç›˜ç¼“å†²åŒºï¼Œä¼šå°†éƒ¨åˆ†è¯·æ±‚çš„å“åº”ä¿å­˜åœ¨ç¼“å†²åŒºä¸­ï¼Œå½“ä»£ç†æœåŠ¡å™¨å†æ¬¡æ¥æ”¶åˆ°ç›¸åŒçš„è¯·æ±‚æ—¶ï¼Œå¯ç›´æ¥è¿”å›ç¼“å†²åŒºä¸­çš„ç»“æœï¼Œæé«˜è®¿é—®é€Ÿåº¦\n- **éšè—å®¢æˆ·ç«¯IP**ï¼šå®¢æˆ·ç«¯å¯ä»¥éšè—è‡ªèº«çš„IPï¼Œå…å—æ”»å‡»\n\n### åå‘ä»£ç†\n\nåå‘ä»£ç†ï¼ˆreverse proxyï¼‰ï¼šä»£ç†æœåŠ¡å™¨æ¥æ”¶å®¢æˆ·ç«¯çš„è¯·æ±‚ï¼Œç„¶åå°†è¯¥è¯·æ±‚è½¬å‘ç»™å†…éƒ¨ç½‘ç»œä¸Šçš„æœåŠ¡å™¨ï¼Œæœ€åå°†è¯·æ±‚çš„å“åº”è¿”å›ç»™å®¢æˆ·ç«¯\n\næŠ½è±¡åœ°ç†è§£ğŸŒŸï¼šåå‘ä»£ç†å°±æ˜¯â€œä»£ç†æœåŠ¡å™¨â€**ä»£ç†**ç›®æ ‡æœåŠ¡å™¨å»å’Œå®¢æˆ·ç«¯è¿›è¡Œäº¤äº’\n\nåå‘ä»£ç†ä¸€èˆ¬æœ‰å¦‚ä¸‹ç”¨é€”ï¼š\n\n- **è´Ÿè½½å‡è¡¡**ï¼šä»£ç†æœåŠ¡å™¨å¯ä»¥æ ¹æ®æ‰€æœ‰çœŸå®æœåŠ¡å™¨çš„è´Ÿè½½æƒ…å†µï¼Œå°†å®¢æˆ·è¯·æ±‚è½¬å‘è‡³ä¸åŒçš„çœŸå®æœåŠ¡å™¨ä¸Š\n- **æé«˜è®¿é—®é€Ÿåº¦**\n- **éšè—æœåŠ¡å™¨IP**\n- **æä¾›å®‰å…¨ä¿éšœ**ï¼šåå‘ä»£ç†æœåŠ¡å™¨å¯ä»¥ä½œä¸º**åº”ç”¨å±‚**ä¸Šçš„é˜²ç«å¢™ï¼Œä¸ºç½‘ç«™æä¾›åº”å¯¹ç½‘ç»œæ”»å‡»ï¼ˆä¾‹å¦‚DDOSï¼‰çš„é˜²æŠ¤\n\n### åŒºåˆ«\n\n- æ­£å‘ä»£ç†æ˜¯å®¢æˆ·ç«¯çš„ä»£ç†ï¼Œåå‘ä»£ç†æ˜¯æœåŠ¡ç«¯çš„ä»£ç†\n- æ­£å‘ä»£ç†ä¸€èˆ¬æ˜¯å®¢æˆ·ç«¯æ¶è®¾çš„ï¼Œè€Œåå‘ä»£ç†æ˜¯ä¸€èˆ¬æ˜¯æœåŠ¡ç«¯æ¶è®¾çš„\n- æ­£å‘ä»£ç†å¤šç”¨äºçªç ´è®¿é—®é™åˆ¶ï¼Œè€Œåå‘ä»£ç†å¤šç”¨äºè´Ÿè½½å‡è¡¡ã€å®‰å…¨é˜²æŠ¤ç­‰\n\n## è´Ÿè½½å‡è¡¡\n\n> å¸¸è§çš„è´Ÿè½½å‡è¡¡æœ‰å“ªäº›æ–¹æ¡ˆï¼Ÿ\n>\n> å››å±‚è´Ÿè½½å’Œä¸ƒå±‚è´Ÿè½½æœ‰ä»€ä¹ˆåŒºåˆ«ï¼Ÿ\n\n**è´Ÿè½½å‡è¡¡ï¼ˆLoad Balancingï¼‰**ï¼šè°ƒåº¦åæ–¹çš„å¤šå°æœºå™¨ï¼Œä»¥ç»Ÿä¸€çš„æ¥å£å¯¹å¤–æä¾›æœåŠ¡ï¼Œæ‰¿æ‹…æ­¤èŒè´£çš„æŠ€æœ¯ç»„ä»¶å°±è¢«ç§°ä¸ºâ€œè´Ÿè½½å‡è¡¡â€","source":"_posts/ç½‘ç»œä»£ç†.md","raw":"---\ntitle: ç½‘ç»œä»£ç†\npublish: true\ndescription: è®°å½•ä¸€äº›æœ‰å…³ç½‘ç»œä»£ç†çš„çŸ¥è¯†ç‚¹\ndate: 2024-09-27\ntag: è®¡ç®—æœºç½‘ç»œ\nsticky: 2\n---\n\n\n\n# ç½‘ç»œä»£ç†\n\n## æ­£å‘ä»£ç†å’Œåå‘ä»£ç†\n\n### æ­£å‘ä»£ç†\n\n**æ­£å‘ä»£ç†ï¼ˆforward proxyï¼‰**ï¼šæ˜¯ä¸€ä¸ªä½äºå®¢æˆ·ç«¯å’ŒæœåŠ¡å™¨ä¹‹é—´çš„ä»£ç†æœåŠ¡å™¨ï¼Œå®¢æˆ·ç«¯ä¸ºäº†è·å–æœåŠ¡å™¨ä¸Šçš„å†…å®¹ï¼Œå°†åŸæœ¬è¦å‘é€ç»™æœåŠ¡å™¨çš„èµ„æºè¯·æ±‚å‘é€ç»™ä»£ç†æœåŠ¡å™¨ï¼Œç„¶åä»£ç†æœåŠ¡å™¨å°†è¯·æ±‚è½¬äº¤ç»™ç›®æ ‡æœåŠ¡å™¨ï¼Œæœ€åä»£ç†æœåŠ¡å™¨æŠŠèµ„æºç»“æœè¿”å›ç»™å®¢æˆ·ç«¯\n\næŠ½è±¡åœ°ç†è§£ğŸŒŸï¼Œæ­£å‘ä»£ç†å°±æ˜¯ä»£ç†æœåŠ¡å™¨å»**ä»£ç†**å®¢æˆ·ç«¯\n\næ­£å‘ä»£ç†ä¸€èˆ¬æœ‰å¦‚ä¸‹ç”¨é€”ï¼š\n\n- **çªç ´è®¿é—®é™åˆ¶**ï¼šé€šè¿‡ä»£ç†æœåŠ¡å™¨ï¼Œå¯ä»¥çªç ´å®¢æˆ·ç«¯è‡ªèº«çš„IPè®¿é—®é™åˆ¶\n- **æé«˜è®¿é—®é€Ÿåº¦**ï¼šä»£ç†æœåŠ¡å™¨ä¸€èˆ¬éƒ½é…æœ‰è¾ƒå¤§çš„ç¡¬ç›˜ç¼“å†²åŒºï¼Œä¼šå°†éƒ¨åˆ†è¯·æ±‚çš„å“åº”ä¿å­˜åœ¨ç¼“å†²åŒºä¸­ï¼Œå½“ä»£ç†æœåŠ¡å™¨å†æ¬¡æ¥æ”¶åˆ°ç›¸åŒçš„è¯·æ±‚æ—¶ï¼Œå¯ç›´æ¥è¿”å›ç¼“å†²åŒºä¸­çš„ç»“æœï¼Œæé«˜è®¿é—®é€Ÿåº¦\n- **éšè—å®¢æˆ·ç«¯IP**ï¼šå®¢æˆ·ç«¯å¯ä»¥éšè—è‡ªèº«çš„IPï¼Œå…å—æ”»å‡»\n\n### åå‘ä»£ç†\n\nåå‘ä»£ç†ï¼ˆreverse proxyï¼‰ï¼šä»£ç†æœåŠ¡å™¨æ¥æ”¶å®¢æˆ·ç«¯çš„è¯·æ±‚ï¼Œç„¶åå°†è¯¥è¯·æ±‚è½¬å‘ç»™å†…éƒ¨ç½‘ç»œä¸Šçš„æœåŠ¡å™¨ï¼Œæœ€åå°†è¯·æ±‚çš„å“åº”è¿”å›ç»™å®¢æˆ·ç«¯\n\næŠ½è±¡åœ°ç†è§£ğŸŒŸï¼šåå‘ä»£ç†å°±æ˜¯â€œä»£ç†æœåŠ¡å™¨â€**ä»£ç†**ç›®æ ‡æœåŠ¡å™¨å»å’Œå®¢æˆ·ç«¯è¿›è¡Œäº¤äº’\n\nåå‘ä»£ç†ä¸€èˆ¬æœ‰å¦‚ä¸‹ç”¨é€”ï¼š\n\n- **è´Ÿè½½å‡è¡¡**ï¼šä»£ç†æœåŠ¡å™¨å¯ä»¥æ ¹æ®æ‰€æœ‰çœŸå®æœåŠ¡å™¨çš„è´Ÿè½½æƒ…å†µï¼Œå°†å®¢æˆ·è¯·æ±‚è½¬å‘è‡³ä¸åŒçš„çœŸå®æœåŠ¡å™¨ä¸Š\n- **æé«˜è®¿é—®é€Ÿåº¦**\n- **éšè—æœåŠ¡å™¨IP**\n- **æä¾›å®‰å…¨ä¿éšœ**ï¼šåå‘ä»£ç†æœåŠ¡å™¨å¯ä»¥ä½œä¸º**åº”ç”¨å±‚**ä¸Šçš„é˜²ç«å¢™ï¼Œä¸ºç½‘ç«™æä¾›åº”å¯¹ç½‘ç»œæ”»å‡»ï¼ˆä¾‹å¦‚DDOSï¼‰çš„é˜²æŠ¤\n\n### åŒºåˆ«\n\n- æ­£å‘ä»£ç†æ˜¯å®¢æˆ·ç«¯çš„ä»£ç†ï¼Œåå‘ä»£ç†æ˜¯æœåŠ¡ç«¯çš„ä»£ç†\n- æ­£å‘ä»£ç†ä¸€èˆ¬æ˜¯å®¢æˆ·ç«¯æ¶è®¾çš„ï¼Œè€Œåå‘ä»£ç†æ˜¯ä¸€èˆ¬æ˜¯æœåŠ¡ç«¯æ¶è®¾çš„\n- æ­£å‘ä»£ç†å¤šç”¨äºçªç ´è®¿é—®é™åˆ¶ï¼Œè€Œåå‘ä»£ç†å¤šç”¨äºè´Ÿè½½å‡è¡¡ã€å®‰å…¨é˜²æŠ¤ç­‰\n\n## è´Ÿè½½å‡è¡¡\n\n> å¸¸è§çš„è´Ÿè½½å‡è¡¡æœ‰å“ªäº›æ–¹æ¡ˆï¼Ÿ\n>\n> å››å±‚è´Ÿè½½å’Œä¸ƒå±‚è´Ÿè½½æœ‰ä»€ä¹ˆåŒºåˆ«ï¼Ÿ\n\n**è´Ÿè½½å‡è¡¡ï¼ˆLoad Balancingï¼‰**ï¼šè°ƒåº¦åæ–¹çš„å¤šå°æœºå™¨ï¼Œä»¥ç»Ÿä¸€çš„æ¥å£å¯¹å¤–æä¾›æœåŠ¡ï¼Œæ‰¿æ‹…æ­¤èŒè´£çš„æŠ€æœ¯ç»„ä»¶å°±è¢«ç§°ä¸ºâ€œè´Ÿè½½å‡è¡¡â€","slug":"ç½‘ç»œä»£ç†","published":1,"updated":"2024-12-27T11:03:15.345Z","comments":1,"layout":"post","photos":[],"_id":"cm6c7md6l001aa5t26g27ffq2","content":"<h1 id=\"ç½‘ç»œä»£ç†\"><a href=\"#ç½‘ç»œä»£ç†\" class=\"headerlink\" title=\"ç½‘ç»œä»£ç†\"></a>ç½‘ç»œä»£ç†</h1><h2 id=\"æ­£å‘ä»£ç†å’Œåå‘ä»£ç†\"><a href=\"#æ­£å‘ä»£ç†å’Œåå‘ä»£ç†\" class=\"headerlink\" title=\"æ­£å‘ä»£ç†å’Œåå‘ä»£ç†\"></a>æ­£å‘ä»£ç†å’Œåå‘ä»£ç†</h2><h3 id=\"æ­£å‘ä»£ç†\"><a href=\"#æ­£å‘ä»£ç†\" class=\"headerlink\" title=\"æ­£å‘ä»£ç†\"></a>æ­£å‘ä»£ç†</h3><p><strong>æ­£å‘ä»£ç†ï¼ˆforward proxyï¼‰</strong>ï¼šæ˜¯ä¸€ä¸ªä½äºå®¢æˆ·ç«¯å’ŒæœåŠ¡å™¨ä¹‹é—´çš„ä»£ç†æœåŠ¡å™¨ï¼Œå®¢æˆ·ç«¯ä¸ºäº†è·å–æœåŠ¡å™¨ä¸Šçš„å†…å®¹ï¼Œå°†åŸæœ¬è¦å‘é€ç»™æœåŠ¡å™¨çš„èµ„æºè¯·æ±‚å‘é€ç»™ä»£ç†æœåŠ¡å™¨ï¼Œç„¶åä»£ç†æœåŠ¡å™¨å°†è¯·æ±‚è½¬äº¤ç»™ç›®æ ‡æœåŠ¡å™¨ï¼Œæœ€åä»£ç†æœåŠ¡å™¨æŠŠèµ„æºç»“æœè¿”å›ç»™å®¢æˆ·ç«¯</p>\n<p>æŠ½è±¡åœ°ç†è§£ğŸŒŸï¼Œæ­£å‘ä»£ç†å°±æ˜¯ä»£ç†æœåŠ¡å™¨å»<strong>ä»£ç†</strong>å®¢æˆ·ç«¯</p>\n<p>æ­£å‘ä»£ç†ä¸€èˆ¬æœ‰å¦‚ä¸‹ç”¨é€”ï¼š</p>\n<ul>\n<li><strong>çªç ´è®¿é—®é™åˆ¶</strong>ï¼šé€šè¿‡ä»£ç†æœåŠ¡å™¨ï¼Œå¯ä»¥çªç ´å®¢æˆ·ç«¯è‡ªèº«çš„IPè®¿é—®é™åˆ¶</li>\n<li><strong>æé«˜è®¿é—®é€Ÿåº¦</strong>ï¼šä»£ç†æœåŠ¡å™¨ä¸€èˆ¬éƒ½é…æœ‰è¾ƒå¤§çš„ç¡¬ç›˜ç¼“å†²åŒºï¼Œä¼šå°†éƒ¨åˆ†è¯·æ±‚çš„å“åº”ä¿å­˜åœ¨ç¼“å†²åŒºä¸­ï¼Œå½“ä»£ç†æœåŠ¡å™¨å†æ¬¡æ¥æ”¶åˆ°ç›¸åŒçš„è¯·æ±‚æ—¶ï¼Œå¯ç›´æ¥è¿”å›ç¼“å†²åŒºä¸­çš„ç»“æœï¼Œæé«˜è®¿é—®é€Ÿåº¦</li>\n<li><strong>éšè—å®¢æˆ·ç«¯IP</strong>ï¼šå®¢æˆ·ç«¯å¯ä»¥éšè—è‡ªèº«çš„IPï¼Œå…å—æ”»å‡»</li>\n</ul>\n<h3 id=\"åå‘ä»£ç†\"><a href=\"#åå‘ä»£ç†\" class=\"headerlink\" title=\"åå‘ä»£ç†\"></a>åå‘ä»£ç†</h3><p>åå‘ä»£ç†ï¼ˆreverse proxyï¼‰ï¼šä»£ç†æœåŠ¡å™¨æ¥æ”¶å®¢æˆ·ç«¯çš„è¯·æ±‚ï¼Œç„¶åå°†è¯¥è¯·æ±‚è½¬å‘ç»™å†…éƒ¨ç½‘ç»œä¸Šçš„æœåŠ¡å™¨ï¼Œæœ€åå°†è¯·æ±‚çš„å“åº”è¿”å›ç»™å®¢æˆ·ç«¯</p>\n<p>æŠ½è±¡åœ°ç†è§£ğŸŒŸï¼šåå‘ä»£ç†å°±æ˜¯â€œä»£ç†æœåŠ¡å™¨â€<strong>ä»£ç†</strong>ç›®æ ‡æœåŠ¡å™¨å»å’Œå®¢æˆ·ç«¯è¿›è¡Œäº¤äº’</p>\n<p>åå‘ä»£ç†ä¸€èˆ¬æœ‰å¦‚ä¸‹ç”¨é€”ï¼š</p>\n<ul>\n<li><strong>è´Ÿè½½å‡è¡¡</strong>ï¼šä»£ç†æœåŠ¡å™¨å¯ä»¥æ ¹æ®æ‰€æœ‰çœŸå®æœåŠ¡å™¨çš„è´Ÿè½½æƒ…å†µï¼Œå°†å®¢æˆ·è¯·æ±‚è½¬å‘è‡³ä¸åŒçš„çœŸå®æœåŠ¡å™¨ä¸Š</li>\n<li><strong>æé«˜è®¿é—®é€Ÿåº¦</strong></li>\n<li><strong>éšè—æœåŠ¡å™¨IP</strong></li>\n<li><strong>æä¾›å®‰å…¨ä¿éšœ</strong>ï¼šåå‘ä»£ç†æœåŠ¡å™¨å¯ä»¥ä½œä¸º<strong>åº”ç”¨å±‚</strong>ä¸Šçš„é˜²ç«å¢™ï¼Œä¸ºç½‘ç«™æä¾›åº”å¯¹ç½‘ç»œæ”»å‡»ï¼ˆä¾‹å¦‚DDOSï¼‰çš„é˜²æŠ¤</li>\n</ul>\n<h3 id=\"åŒºåˆ«\"><a href=\"#åŒºåˆ«\" class=\"headerlink\" title=\"åŒºåˆ«\"></a>åŒºåˆ«</h3><ul>\n<li>æ­£å‘ä»£ç†æ˜¯å®¢æˆ·ç«¯çš„ä»£ç†ï¼Œåå‘ä»£ç†æ˜¯æœåŠ¡ç«¯çš„ä»£ç†</li>\n<li>æ­£å‘ä»£ç†ä¸€èˆ¬æ˜¯å®¢æˆ·ç«¯æ¶è®¾çš„ï¼Œè€Œåå‘ä»£ç†æ˜¯ä¸€èˆ¬æ˜¯æœåŠ¡ç«¯æ¶è®¾çš„</li>\n<li>æ­£å‘ä»£ç†å¤šç”¨äºçªç ´è®¿é—®é™åˆ¶ï¼Œè€Œåå‘ä»£ç†å¤šç”¨äºè´Ÿè½½å‡è¡¡ã€å®‰å…¨é˜²æŠ¤ç­‰</li>\n</ul>\n<h2 id=\"è´Ÿè½½å‡è¡¡\"><a href=\"#è´Ÿè½½å‡è¡¡\" class=\"headerlink\" title=\"è´Ÿè½½å‡è¡¡\"></a>è´Ÿè½½å‡è¡¡</h2><blockquote>\n<p>å¸¸è§çš„è´Ÿè½½å‡è¡¡æœ‰å“ªäº›æ–¹æ¡ˆï¼Ÿ</p>\n<p>å››å±‚è´Ÿè½½å’Œä¸ƒå±‚è´Ÿè½½æœ‰ä»€ä¹ˆåŒºåˆ«ï¼Ÿ</p>\n</blockquote>\n<p><strong>è´Ÿè½½å‡è¡¡ï¼ˆLoad Balancingï¼‰</strong>ï¼šè°ƒåº¦åæ–¹çš„å¤šå°æœºå™¨ï¼Œä»¥ç»Ÿä¸€çš„æ¥å£å¯¹å¤–æä¾›æœåŠ¡ï¼Œæ‰¿æ‹…æ­¤èŒè´£çš„æŠ€æœ¯ç»„ä»¶å°±è¢«ç§°ä¸ºâ€œè´Ÿè½½å‡è¡¡â€</p>\n","excerpt":"","more":"<h1 id=\"ç½‘ç»œä»£ç†\"><a href=\"#ç½‘ç»œä»£ç†\" class=\"headerlink\" title=\"ç½‘ç»œä»£ç†\"></a>ç½‘ç»œä»£ç†</h1><h2 id=\"æ­£å‘ä»£ç†å’Œåå‘ä»£ç†\"><a href=\"#æ­£å‘ä»£ç†å’Œåå‘ä»£ç†\" class=\"headerlink\" title=\"æ­£å‘ä»£ç†å’Œåå‘ä»£ç†\"></a>æ­£å‘ä»£ç†å’Œåå‘ä»£ç†</h2><h3 id=\"æ­£å‘ä»£ç†\"><a href=\"#æ­£å‘ä»£ç†\" class=\"headerlink\" title=\"æ­£å‘ä»£ç†\"></a>æ­£å‘ä»£ç†</h3><p><strong>æ­£å‘ä»£ç†ï¼ˆforward proxyï¼‰</strong>ï¼šæ˜¯ä¸€ä¸ªä½äºå®¢æˆ·ç«¯å’ŒæœåŠ¡å™¨ä¹‹é—´çš„ä»£ç†æœåŠ¡å™¨ï¼Œå®¢æˆ·ç«¯ä¸ºäº†è·å–æœåŠ¡å™¨ä¸Šçš„å†…å®¹ï¼Œå°†åŸæœ¬è¦å‘é€ç»™æœåŠ¡å™¨çš„èµ„æºè¯·æ±‚å‘é€ç»™ä»£ç†æœåŠ¡å™¨ï¼Œç„¶åä»£ç†æœåŠ¡å™¨å°†è¯·æ±‚è½¬äº¤ç»™ç›®æ ‡æœåŠ¡å™¨ï¼Œæœ€åä»£ç†æœåŠ¡å™¨æŠŠèµ„æºç»“æœè¿”å›ç»™å®¢æˆ·ç«¯</p>\n<p>æŠ½è±¡åœ°ç†è§£ğŸŒŸï¼Œæ­£å‘ä»£ç†å°±æ˜¯ä»£ç†æœåŠ¡å™¨å»<strong>ä»£ç†</strong>å®¢æˆ·ç«¯</p>\n<p>æ­£å‘ä»£ç†ä¸€èˆ¬æœ‰å¦‚ä¸‹ç”¨é€”ï¼š</p>\n<ul>\n<li><strong>çªç ´è®¿é—®é™åˆ¶</strong>ï¼šé€šè¿‡ä»£ç†æœåŠ¡å™¨ï¼Œå¯ä»¥çªç ´å®¢æˆ·ç«¯è‡ªèº«çš„IPè®¿é—®é™åˆ¶</li>\n<li><strong>æé«˜è®¿é—®é€Ÿåº¦</strong>ï¼šä»£ç†æœåŠ¡å™¨ä¸€èˆ¬éƒ½é…æœ‰è¾ƒå¤§çš„ç¡¬ç›˜ç¼“å†²åŒºï¼Œä¼šå°†éƒ¨åˆ†è¯·æ±‚çš„å“åº”ä¿å­˜åœ¨ç¼“å†²åŒºä¸­ï¼Œå½“ä»£ç†æœåŠ¡å™¨å†æ¬¡æ¥æ”¶åˆ°ç›¸åŒçš„è¯·æ±‚æ—¶ï¼Œå¯ç›´æ¥è¿”å›ç¼“å†²åŒºä¸­çš„ç»“æœï¼Œæé«˜è®¿é—®é€Ÿåº¦</li>\n<li><strong>éšè—å®¢æˆ·ç«¯IP</strong>ï¼šå®¢æˆ·ç«¯å¯ä»¥éšè—è‡ªèº«çš„IPï¼Œå…å—æ”»å‡»</li>\n</ul>\n<h3 id=\"åå‘ä»£ç†\"><a href=\"#åå‘ä»£ç†\" class=\"headerlink\" title=\"åå‘ä»£ç†\"></a>åå‘ä»£ç†</h3><p>åå‘ä»£ç†ï¼ˆreverse proxyï¼‰ï¼šä»£ç†æœåŠ¡å™¨æ¥æ”¶å®¢æˆ·ç«¯çš„è¯·æ±‚ï¼Œç„¶åå°†è¯¥è¯·æ±‚è½¬å‘ç»™å†…éƒ¨ç½‘ç»œä¸Šçš„æœåŠ¡å™¨ï¼Œæœ€åå°†è¯·æ±‚çš„å“åº”è¿”å›ç»™å®¢æˆ·ç«¯</p>\n<p>æŠ½è±¡åœ°ç†è§£ğŸŒŸï¼šåå‘ä»£ç†å°±æ˜¯â€œä»£ç†æœåŠ¡å™¨â€<strong>ä»£ç†</strong>ç›®æ ‡æœåŠ¡å™¨å»å’Œå®¢æˆ·ç«¯è¿›è¡Œäº¤äº’</p>\n<p>åå‘ä»£ç†ä¸€èˆ¬æœ‰å¦‚ä¸‹ç”¨é€”ï¼š</p>\n<ul>\n<li><strong>è´Ÿè½½å‡è¡¡</strong>ï¼šä»£ç†æœåŠ¡å™¨å¯ä»¥æ ¹æ®æ‰€æœ‰çœŸå®æœåŠ¡å™¨çš„è´Ÿè½½æƒ…å†µï¼Œå°†å®¢æˆ·è¯·æ±‚è½¬å‘è‡³ä¸åŒçš„çœŸå®æœåŠ¡å™¨ä¸Š</li>\n<li><strong>æé«˜è®¿é—®é€Ÿåº¦</strong></li>\n<li><strong>éšè—æœåŠ¡å™¨IP</strong></li>\n<li><strong>æä¾›å®‰å…¨ä¿éšœ</strong>ï¼šåå‘ä»£ç†æœåŠ¡å™¨å¯ä»¥ä½œä¸º<strong>åº”ç”¨å±‚</strong>ä¸Šçš„é˜²ç«å¢™ï¼Œä¸ºç½‘ç«™æä¾›åº”å¯¹ç½‘ç»œæ”»å‡»ï¼ˆä¾‹å¦‚DDOSï¼‰çš„é˜²æŠ¤</li>\n</ul>\n<h3 id=\"åŒºåˆ«\"><a href=\"#åŒºåˆ«\" class=\"headerlink\" title=\"åŒºåˆ«\"></a>åŒºåˆ«</h3><ul>\n<li>æ­£å‘ä»£ç†æ˜¯å®¢æˆ·ç«¯çš„ä»£ç†ï¼Œåå‘ä»£ç†æ˜¯æœåŠ¡ç«¯çš„ä»£ç†</li>\n<li>æ­£å‘ä»£ç†ä¸€èˆ¬æ˜¯å®¢æˆ·ç«¯æ¶è®¾çš„ï¼Œè€Œåå‘ä»£ç†æ˜¯ä¸€èˆ¬æ˜¯æœåŠ¡ç«¯æ¶è®¾çš„</li>\n<li>æ­£å‘ä»£ç†å¤šç”¨äºçªç ´è®¿é—®é™åˆ¶ï¼Œè€Œåå‘ä»£ç†å¤šç”¨äºè´Ÿè½½å‡è¡¡ã€å®‰å…¨é˜²æŠ¤ç­‰</li>\n</ul>\n<h2 id=\"è´Ÿè½½å‡è¡¡\"><a href=\"#è´Ÿè½½å‡è¡¡\" class=\"headerlink\" title=\"è´Ÿè½½å‡è¡¡\"></a>è´Ÿè½½å‡è¡¡</h2><blockquote>\n<p>å¸¸è§çš„è´Ÿè½½å‡è¡¡æœ‰å“ªäº›æ–¹æ¡ˆï¼Ÿ</p>\n<p>å››å±‚è´Ÿè½½å’Œä¸ƒå±‚è´Ÿè½½æœ‰ä»€ä¹ˆåŒºåˆ«ï¼Ÿ</p>\n</blockquote>\n<p><strong>è´Ÿè½½å‡è¡¡ï¼ˆLoad Balancingï¼‰</strong>ï¼šè°ƒåº¦åæ–¹çš„å¤šå°æœºå™¨ï¼Œä»¥ç»Ÿä¸€çš„æ¥å£å¯¹å¤–æä¾›æœåŠ¡ï¼Œæ‰¿æ‹…æ­¤èŒè´£çš„æŠ€æœ¯ç»„ä»¶å°±è¢«ç§°ä¸ºâ€œè´Ÿè½½å‡è¡¡â€</p>\n"},{"title":"ç½‘ç»œå±‚çŸ¥è¯†ç‚¹","publish":true,"description":"è®°å½•äº†ä¸€äº›ç½‘ç»œå±‚çš„çŸ¥è¯†ç‚¹","date":"2024-09-21T10:29:00.000Z","sticky":3,"_content":"\n\n\n# ç½‘ç»œå±‚çŸ¥è¯†ç‚¹\n\n## IP\n\n> IPæ˜¯ä»€ä¹ˆï¼ŸæŠ¥æ–‡æ ¼å¼æ˜¯æ€æ ·çš„ï¼Ÿ\n>\n> IPåœ°å€çš„åˆ†ç±»ï¼Ÿ\n>\n> å¦‚ä½•è¿›è¡Œè·¯ç”±ï¼Ÿ\n\n[å‚è€ƒæ–‡ç« ](https://xiaolincoding.com/network/4_ip/ip_base.html)\n\n### IPåŸºæœ¬è®¤è¯†\n\nç½‘ç»œå±‚çš„ä¸»è¦ä½œç”¨æ˜¯**å®ç°ç«¯åˆ°ç«¯ï¼ˆä¸»æœºåˆ°ä¸»æœºï¼‰ä¹‹é—´çš„é€šä¿¡**\n\n> IPå’ŒMACçš„å…³ç³»\n\nMACè´Ÿè´£å®ç°åŒä¸€ä¸ªç½‘ç»œå†…**ç›´è¿**çš„ä¸¤å°è®¾å¤‡ä¹‹é—´çš„é€šä¿¡ï¼Œè€ŒIPè´Ÿè´£å®ç°ä¸åŒç½‘ç»œçš„ä¸¤å°**ä¸ç›¸è¿**çš„è®¾å¤‡ä¹‹é—´çš„é€šä¿¡\n\nåœ¨æ•°æ®ä¼ è¾“è¿‡ç¨‹ä¸­ï¼ŒæºIPåœ°å€å’Œç›®æ ‡IPåœ°å€ä¸€èˆ¬æ˜¯ä¸ä¼šå˜åŒ–çš„ï¼Œè€ŒæºMACåœ°å€å’Œç›®æ ‡MACåœ°å€æ˜¯ä¸€ç›´åœ¨å˜åŒ–çš„ã€‚\n\n### IPåœ°å€\n\nIPv4åœ°å€ç”±32ä½0ã€1æ­£æ•´æ•°è¡¨ç¤º\n\nğŸŒ°ï¼š`11000000  10101000  00000001  00000001`\n\n32ä½æ•´æ•°ä¸­æœ‰ä¸€éƒ¨åˆ†å……å½“**ç½‘ç»œå·**ï¼Œå¦ä¸€éƒ¨åˆ†å……å½“**ä¸»æœºå·**ï¼Œæ‰€ä»¥å¯ä»¥è¯´IPåœ°å€æ˜¯ç”±<font color='blue'>**ç½‘ç»œæ ‡è¯†**</font>å’Œ<font color='blue'>**ä¸»æœºæ ‡è¯†**</font>è¿™ä¸¤éƒ¨åˆ†æ„æˆ\n\n> ä¸ºä»€ä¹ˆè¦åˆ†ç¦»ç½‘ç»œå·å’Œä¸»æœºå·ï¼Ÿ\n\nå› ä¸ºä¸¤å°è®¾å¤‡åœ¨è¿›è¡Œé€šä¿¡ä¹‹å‰ï¼Œå…ˆåˆ¤æ–­æ˜¯å¦åœ¨åŒä¸€ä¸ªå¹¿æ’­åŸŸå†…ï¼Œå³ç½‘ç»œå·æ˜¯å¦ç›¸åŒï¼Œå¦‚æœæ˜¯åˆ™å¯ä»¥æŠŠæ•°æ®åŒ…ç›´æ¥å‘é€åˆ°ç›®æ ‡ä¸»æœº\n\nä¸ºäº†è¡¨ç¤ºæ–¹ä¾¿ï¼Œå¯ä»¥å°†æ¯8ä½åˆ†ä¸ºä¸€ç»„ï¼Œæ¯ç»„ç”¨åè¿›åˆ¶è¡¨ç¤ºï¼Œç”¨**`.`**ä½œä¸ºç»„ä¸ç»„ä¹‹é—´çš„åˆ†éš”ç¬¦å·\n\nğŸŒ°ï¼š`192.168.1.1`\n\nIPåœ°å€å¹¶éä»¥ä¸»æœºä¸ºæœ€å°é…ç½®å•ä½ï¼Œè€Œæ˜¯ä»¥ç½‘å¡æ¥é…ç½®çš„ã€‚å³ä¸€å°æœåŠ¡å™¨ã€è·¯ç”±å™¨è‡³å°‘æœ‰ä¸¤ä¸ªç½‘å¡ï¼Œç­‰ä»·äºè‡³å°‘æœ‰ä¸¤ä¸ªIPåœ°å€\n\n![image-20240921105702834](https://raw.githubusercontent.com/lyydsheep/pic/main/202409211057876.png)\n\n#### IPåœ°å€çš„åˆ†ç±»\n\n> äº’è”ç½‘è¯ç”Ÿä¹‹åˆï¼ŒIP åœ°å€æ˜¾å¾—å¾ˆå……è£•ï¼Œäºæ˜¯è®¡ç®—æœºç§‘å­¦å®¶ä»¬è®¾è®¡äº†**åˆ†ç±»åœ°å€**ã€‚\n>\n> ï¼ˆä½†æ˜¯ç°åœ¨IPv4æ—©å°±ä¸å¤Ÿç”¨å“©ğŸ¤ªï¼Œäºæ˜¯å°±æœ‰äº†IPv6ï¼‰\n\nIPv4åœ°å€åˆ†ä¸º5å¤§ç±»ï¼šAã€Bã€Cã€Dã€Eç±»ï¼Œéœ€è¦é‡ç‚¹å…³æ³¨çš„åªæœ‰Aã€Bã€Cè¿™ä¸‰ç±»IPåœ°å€\n\nç”±å‰æ–‡çŸ¥ï¼ŒIPåœ°å€ç”±ç½‘ç»œå·å’Œä¸»æœºå·æ„æˆï¼ŒAã€Bã€Cä¸‰ç±»IPåœ°å€çš„åŒºåˆ«å°±åœ¨äºä¸»æœºå·çš„ä½æ•°ï¼Œå…·ä½“å¦‚ä¸‹å›¾ï¼š\n\n![image-20240921132334887](https://raw.githubusercontent.com/lyydsheep/pic/main/202409211323959.png)\n\nä»¥Cç±»IPåœ°å€ä¸ºä¾‹ï¼Œè™½ç„¶Cç±»ä¸»æœºå·å æœ‰8ä½ï¼Œä½†æ˜¯Cç±»åœ°å€çš„æœ€å¤§ä¸»æœºä¸ªæ•°ä¸ºï¼š$$ 2^8 - 2 = 254 $$\n\nè¿™é‡Œ**å‡2**æ˜¯å‡å»ä¸¤ä¸ªæ¯”è¾ƒç‰¹æ®Šçš„ä¸»æœºå·ï¼š\n\n- ä¸»æœºå·å…¨0\n  - æŒ‡å®šæŸä¸ªç½‘ç»œ\n- ä¸»æœºå·å…¨1\n  - æŒ‡å®šæŸä¸ªç½‘ç»œä¸‹çš„æ‰€æœ‰ä¸»æœºï¼Œç”¨äºå¹¿æ’­\n\nIPåˆ†ç±»çš„ä¼˜ç‚¹å°±æ˜¯ç®€å•æ˜äº†ã€é€‰è·¯ï¼ˆåŸºäºç½‘ç»œåœ°å€ï¼‰ç®€å•\n\nç¼ºç‚¹ä¹Ÿæ˜¯æœ‰çš„ğŸ˜‘ï¼š\n\n- æŸä¸€ç±»ç½‘ç»œä¸‹**æ— æ³•å†ç»†åˆ†IPåœ°å€ç±»å‹**ï¼ŒğŸŒ°ï¼šä¸€ä¸ªå­¦æ ¡ä½¿ç”¨äº†Bç±»çš„IPåœ°å€ï¼Œç°æœ‰æŒ‰ç…§ä¸åŒå­¦é™¢åˆ’åˆ†åœ°å€å±‚æ¬¡çš„éœ€æ±‚ï¼Œä½†æ˜¯IPåˆ†ç±»æ˜¯æ— æ³•å®ç°è¿™ç±»éœ€æ±‚çš„ï¼Œ**çµæ´»æ€§è¾ƒå·®**\n\n- **ä¸èƒ½å¾ˆå¥½çš„ä¸ç°å®ç½‘ç»œåŒ¹é…**ï¼šè¦ä¹ˆIPåœ°å€åŒ…å«çš„ä¸»æœºæ•°é‡å¤ªå¤šï¼Œè¦ä¹ˆå°±æ˜¯å¤ªå°‘\n\n#### æ— åˆ†ç±»åœ°å€CIDR\n\nå–æ¶ˆå¯¹IPåœ°å€åˆ†ç±»çš„æ¦‚å¿µï¼Œé‡‡ç”¨`a.b.c.d/x`çš„å½¢å¼æ ‡è¯†ä¸€ä¸ªIPåœ°å€ã€‚å…¶ä¸­å‰`x`ä½å±äºç½‘ç»œå·ï¼Œè¿™ä½¿å¾—IPåœ°å€æ›´åŠ çµæ´»\n\n##### å­ç½‘æ©ç \n\nå­ç½‘æ©ç å¯ä»¥ä¹Ÿå¯ä»¥ç”¨äºåŒºåˆ†ç½‘ç»œå·å’Œä¸»æœºå·ï¼Œä½†æ˜¯è¿™é‡Œçš„ç½‘ç»œå·æ—¢åŒ…å«äº†ç½‘ç»œåœ°å€åˆåŒ…å«äº†å­ç½‘ç½‘ç»œåœ°å€ï¼Œå¦‚ä¸‹å›¾\n\n![image-20240921135312707](https://raw.githubusercontent.com/lyydsheep/pic/main/202409211353765.png)\n\n- æœªåšå­ç½‘åˆ’åˆ†çš„IPåœ°å€ï¼šç½‘ç»œåœ°å€ + ä¸»æœºåœ°å€\n- åšå­ç½‘åˆ’åˆ†çš„IPåœ°å€ï¼šç½‘ç»œåœ°å€ + ï¼ˆå­ç½‘ç½‘ç»œåœ°å€ + å­ç½‘ä¸»æœºåœ°å€ï¼‰\n\nå­ç½‘æ©ç æ›´å¤šæ˜¯å’Œåˆ†ç±»IPåœ°å€æˆ–æ— åˆ†ç±»IPåœ°å€ä¸€åŒä½¿ç”¨ï¼Œç”¨äºåœ¨æŸä¸ªç½‘æ®µä¸‹é¢ç»†åˆ†å­ç½‘ç±»å‹\n\nğŸŒ°ï¼š![image-20240921135545704](https://raw.githubusercontent.com/lyydsheep/pic/main/202409211355750.png)\n\nè¿™é‡ŒCç±»IPåœ°å€ä¸­ä¸»æœºåœ°å€åŸæœ¬æœ‰8ä½ï¼Œç°å€Ÿå‡º2ä½ä½œä¸º**å­ç½‘ç½‘ç»œåœ°å€**ï¼Œå› æ­¤åœ¨ä¾‹å­ä¸­ï¼Œå…±æœ‰4ä¸ªå­ç½‘ï¼Œå¦‚ä¸‹å›¾\n\n![image-20240921135737594](https://raw.githubusercontent.com/lyydsheep/pic/main/202409211357645.png)\n\n#### å…¬æœ‰IPåœ°å€ä¸ç§æœ‰IPåœ°å€\n\nåœ¨Aã€Bã€Cä¸‰ç±»IPåœ°å€ä¸­ï¼Œå®é™…ä¸Šåˆ†æœ‰å…¬æœ‰IPåœ°å€å’Œç§æœ‰IPåœ°å€\n\n![image-20240921140902040](https://raw.githubusercontent.com/lyydsheep/pic/main/202409211409097.png)\n\nåœ¨ä¸åŒçš„åœ°åŸŸä¸­ï¼Œç§æœ‰IPåœ°å€å¯ä»¥é‡å¤ï¼Œä½†å…¬æœ‰IPåœ°å€åœ¨æ•´ä¸ªäº’è”ç½‘èŒƒå›´å†…æ˜¯å”¯ä¸€çš„\n\n#### IPåœ°å€ä¸è·¯ç”±æ§åˆ¶\n\nåœ¨å‘é€IPåŒ…æ—¶ï¼Œé¦–å…ˆæ‹¿ç€IPåŒ…ä¸­çš„ç›®æ ‡åœ°å€å’Œæœ¬ä¸»æœºï¼ˆè·¯ç”±å™¨ï¼‰çš„è·¯ç”±è¡¨è¿›è¡ŒåŒ¹é…ï¼Œæ‰¾åˆ°å…·æœ‰ç›¸åŒ**ç½‘ç»œåœ°å€**çš„è®°å½•ï¼Œå†æ ¹æ®è¯¥è®°å½•å°†IPåŒ…è½¬å‘è‡³ä¸‹ä¸€ä¸ªè·¯ç”±å™¨æˆ–ä¸»æœºã€‚å¦‚æœåŒ¹é…è¿‡ç¨‹ä¸­å‘ç°æœ‰å¤šä¸ªç›¸åŒçš„ç½‘ç»œåœ°å€ï¼Œåˆ™é€‰æ‹©ç›¸åŒä½æ•°æœ€å¤šçš„ç½‘ç»œåœ°å€ï¼Œå³æœ€é•¿åŒ¹é…ï¼›åä¹‹ï¼Œå¦‚æœåŒ¹é…è¿‡ç¨‹ä¸­æ²¡æœ‰ä¸€ä¸ªåŒ¹é…æˆåŠŸğŸ˜ªï¼Œåˆ™è½¬å‘è‡³é»˜è®¤ä¸‹ä¸€è·³åœ°å€\n\n> æ¢å›åœ°å€ä¸ä¼šæµå‘ç½‘ç»œ\n\nç‰¹æ®ŠIPåœ°å€<font color='blue'>**127.0.0.1**</font>è¢«è®¡ç®—æœºä½œä¸º<font color='blue'>**ç¯å›åœ°å€**</font>ï¼ˆåŒ`localhost`ï¼‰ã€‚ä½¿ç”¨è¿™ä¸ªIPåœ°å€æ—¶ï¼Œæ•°æ®åŒ…æ˜¯ä¸ä¼šæµå‘ç½‘ç»œçš„\n","source":"_posts/ç½‘ç»œå±‚çŸ¥è¯†ç‚¹.md","raw":"---\ntitle: ç½‘ç»œå±‚çŸ¥è¯†ç‚¹\npublish: true\ndescription: è®°å½•äº†ä¸€äº›ç½‘ç»œå±‚çš„çŸ¥è¯†ç‚¹\ndate: 2024-09-21 18:29:00\ntag: è®¡ç®—æœºç½‘ç»œ\nsticky: 3\n---\n\n\n\n# ç½‘ç»œå±‚çŸ¥è¯†ç‚¹\n\n## IP\n\n> IPæ˜¯ä»€ä¹ˆï¼ŸæŠ¥æ–‡æ ¼å¼æ˜¯æ€æ ·çš„ï¼Ÿ\n>\n> IPåœ°å€çš„åˆ†ç±»ï¼Ÿ\n>\n> å¦‚ä½•è¿›è¡Œè·¯ç”±ï¼Ÿ\n\n[å‚è€ƒæ–‡ç« ](https://xiaolincoding.com/network/4_ip/ip_base.html)\n\n### IPåŸºæœ¬è®¤è¯†\n\nç½‘ç»œå±‚çš„ä¸»è¦ä½œç”¨æ˜¯**å®ç°ç«¯åˆ°ç«¯ï¼ˆä¸»æœºåˆ°ä¸»æœºï¼‰ä¹‹é—´çš„é€šä¿¡**\n\n> IPå’ŒMACçš„å…³ç³»\n\nMACè´Ÿè´£å®ç°åŒä¸€ä¸ªç½‘ç»œå†…**ç›´è¿**çš„ä¸¤å°è®¾å¤‡ä¹‹é—´çš„é€šä¿¡ï¼Œè€ŒIPè´Ÿè´£å®ç°ä¸åŒç½‘ç»œçš„ä¸¤å°**ä¸ç›¸è¿**çš„è®¾å¤‡ä¹‹é—´çš„é€šä¿¡\n\nåœ¨æ•°æ®ä¼ è¾“è¿‡ç¨‹ä¸­ï¼ŒæºIPåœ°å€å’Œç›®æ ‡IPåœ°å€ä¸€èˆ¬æ˜¯ä¸ä¼šå˜åŒ–çš„ï¼Œè€ŒæºMACåœ°å€å’Œç›®æ ‡MACåœ°å€æ˜¯ä¸€ç›´åœ¨å˜åŒ–çš„ã€‚\n\n### IPåœ°å€\n\nIPv4åœ°å€ç”±32ä½0ã€1æ­£æ•´æ•°è¡¨ç¤º\n\nğŸŒ°ï¼š`11000000  10101000  00000001  00000001`\n\n32ä½æ•´æ•°ä¸­æœ‰ä¸€éƒ¨åˆ†å……å½“**ç½‘ç»œå·**ï¼Œå¦ä¸€éƒ¨åˆ†å……å½“**ä¸»æœºå·**ï¼Œæ‰€ä»¥å¯ä»¥è¯´IPåœ°å€æ˜¯ç”±<font color='blue'>**ç½‘ç»œæ ‡è¯†**</font>å’Œ<font color='blue'>**ä¸»æœºæ ‡è¯†**</font>è¿™ä¸¤éƒ¨åˆ†æ„æˆ\n\n> ä¸ºä»€ä¹ˆè¦åˆ†ç¦»ç½‘ç»œå·å’Œä¸»æœºå·ï¼Ÿ\n\nå› ä¸ºä¸¤å°è®¾å¤‡åœ¨è¿›è¡Œé€šä¿¡ä¹‹å‰ï¼Œå…ˆåˆ¤æ–­æ˜¯å¦åœ¨åŒä¸€ä¸ªå¹¿æ’­åŸŸå†…ï¼Œå³ç½‘ç»œå·æ˜¯å¦ç›¸åŒï¼Œå¦‚æœæ˜¯åˆ™å¯ä»¥æŠŠæ•°æ®åŒ…ç›´æ¥å‘é€åˆ°ç›®æ ‡ä¸»æœº\n\nä¸ºäº†è¡¨ç¤ºæ–¹ä¾¿ï¼Œå¯ä»¥å°†æ¯8ä½åˆ†ä¸ºä¸€ç»„ï¼Œæ¯ç»„ç”¨åè¿›åˆ¶è¡¨ç¤ºï¼Œç”¨**`.`**ä½œä¸ºç»„ä¸ç»„ä¹‹é—´çš„åˆ†éš”ç¬¦å·\n\nğŸŒ°ï¼š`192.168.1.1`\n\nIPåœ°å€å¹¶éä»¥ä¸»æœºä¸ºæœ€å°é…ç½®å•ä½ï¼Œè€Œæ˜¯ä»¥ç½‘å¡æ¥é…ç½®çš„ã€‚å³ä¸€å°æœåŠ¡å™¨ã€è·¯ç”±å™¨è‡³å°‘æœ‰ä¸¤ä¸ªç½‘å¡ï¼Œç­‰ä»·äºè‡³å°‘æœ‰ä¸¤ä¸ªIPåœ°å€\n\n![image-20240921105702834](https://raw.githubusercontent.com/lyydsheep/pic/main/202409211057876.png)\n\n#### IPåœ°å€çš„åˆ†ç±»\n\n> äº’è”ç½‘è¯ç”Ÿä¹‹åˆï¼ŒIP åœ°å€æ˜¾å¾—å¾ˆå……è£•ï¼Œäºæ˜¯è®¡ç®—æœºç§‘å­¦å®¶ä»¬è®¾è®¡äº†**åˆ†ç±»åœ°å€**ã€‚\n>\n> ï¼ˆä½†æ˜¯ç°åœ¨IPv4æ—©å°±ä¸å¤Ÿç”¨å“©ğŸ¤ªï¼Œäºæ˜¯å°±æœ‰äº†IPv6ï¼‰\n\nIPv4åœ°å€åˆ†ä¸º5å¤§ç±»ï¼šAã€Bã€Cã€Dã€Eç±»ï¼Œéœ€è¦é‡ç‚¹å…³æ³¨çš„åªæœ‰Aã€Bã€Cè¿™ä¸‰ç±»IPåœ°å€\n\nç”±å‰æ–‡çŸ¥ï¼ŒIPåœ°å€ç”±ç½‘ç»œå·å’Œä¸»æœºå·æ„æˆï¼ŒAã€Bã€Cä¸‰ç±»IPåœ°å€çš„åŒºåˆ«å°±åœ¨äºä¸»æœºå·çš„ä½æ•°ï¼Œå…·ä½“å¦‚ä¸‹å›¾ï¼š\n\n![image-20240921132334887](https://raw.githubusercontent.com/lyydsheep/pic/main/202409211323959.png)\n\nä»¥Cç±»IPåœ°å€ä¸ºä¾‹ï¼Œè™½ç„¶Cç±»ä¸»æœºå·å æœ‰8ä½ï¼Œä½†æ˜¯Cç±»åœ°å€çš„æœ€å¤§ä¸»æœºä¸ªæ•°ä¸ºï¼š$$ 2^8 - 2 = 254 $$\n\nè¿™é‡Œ**å‡2**æ˜¯å‡å»ä¸¤ä¸ªæ¯”è¾ƒç‰¹æ®Šçš„ä¸»æœºå·ï¼š\n\n- ä¸»æœºå·å…¨0\n  - æŒ‡å®šæŸä¸ªç½‘ç»œ\n- ä¸»æœºå·å…¨1\n  - æŒ‡å®šæŸä¸ªç½‘ç»œä¸‹çš„æ‰€æœ‰ä¸»æœºï¼Œç”¨äºå¹¿æ’­\n\nIPåˆ†ç±»çš„ä¼˜ç‚¹å°±æ˜¯ç®€å•æ˜äº†ã€é€‰è·¯ï¼ˆåŸºäºç½‘ç»œåœ°å€ï¼‰ç®€å•\n\nç¼ºç‚¹ä¹Ÿæ˜¯æœ‰çš„ğŸ˜‘ï¼š\n\n- æŸä¸€ç±»ç½‘ç»œä¸‹**æ— æ³•å†ç»†åˆ†IPåœ°å€ç±»å‹**ï¼ŒğŸŒ°ï¼šä¸€ä¸ªå­¦æ ¡ä½¿ç”¨äº†Bç±»çš„IPåœ°å€ï¼Œç°æœ‰æŒ‰ç…§ä¸åŒå­¦é™¢åˆ’åˆ†åœ°å€å±‚æ¬¡çš„éœ€æ±‚ï¼Œä½†æ˜¯IPåˆ†ç±»æ˜¯æ— æ³•å®ç°è¿™ç±»éœ€æ±‚çš„ï¼Œ**çµæ´»æ€§è¾ƒå·®**\n\n- **ä¸èƒ½å¾ˆå¥½çš„ä¸ç°å®ç½‘ç»œåŒ¹é…**ï¼šè¦ä¹ˆIPåœ°å€åŒ…å«çš„ä¸»æœºæ•°é‡å¤ªå¤šï¼Œè¦ä¹ˆå°±æ˜¯å¤ªå°‘\n\n#### æ— åˆ†ç±»åœ°å€CIDR\n\nå–æ¶ˆå¯¹IPåœ°å€åˆ†ç±»çš„æ¦‚å¿µï¼Œé‡‡ç”¨`a.b.c.d/x`çš„å½¢å¼æ ‡è¯†ä¸€ä¸ªIPåœ°å€ã€‚å…¶ä¸­å‰`x`ä½å±äºç½‘ç»œå·ï¼Œè¿™ä½¿å¾—IPåœ°å€æ›´åŠ çµæ´»\n\n##### å­ç½‘æ©ç \n\nå­ç½‘æ©ç å¯ä»¥ä¹Ÿå¯ä»¥ç”¨äºåŒºåˆ†ç½‘ç»œå·å’Œä¸»æœºå·ï¼Œä½†æ˜¯è¿™é‡Œçš„ç½‘ç»œå·æ—¢åŒ…å«äº†ç½‘ç»œåœ°å€åˆåŒ…å«äº†å­ç½‘ç½‘ç»œåœ°å€ï¼Œå¦‚ä¸‹å›¾\n\n![image-20240921135312707](https://raw.githubusercontent.com/lyydsheep/pic/main/202409211353765.png)\n\n- æœªåšå­ç½‘åˆ’åˆ†çš„IPåœ°å€ï¼šç½‘ç»œåœ°å€ + ä¸»æœºåœ°å€\n- åšå­ç½‘åˆ’åˆ†çš„IPåœ°å€ï¼šç½‘ç»œåœ°å€ + ï¼ˆå­ç½‘ç½‘ç»œåœ°å€ + å­ç½‘ä¸»æœºåœ°å€ï¼‰\n\nå­ç½‘æ©ç æ›´å¤šæ˜¯å’Œåˆ†ç±»IPåœ°å€æˆ–æ— åˆ†ç±»IPåœ°å€ä¸€åŒä½¿ç”¨ï¼Œç”¨äºåœ¨æŸä¸ªç½‘æ®µä¸‹é¢ç»†åˆ†å­ç½‘ç±»å‹\n\nğŸŒ°ï¼š![image-20240921135545704](https://raw.githubusercontent.com/lyydsheep/pic/main/202409211355750.png)\n\nè¿™é‡ŒCç±»IPåœ°å€ä¸­ä¸»æœºåœ°å€åŸæœ¬æœ‰8ä½ï¼Œç°å€Ÿå‡º2ä½ä½œä¸º**å­ç½‘ç½‘ç»œåœ°å€**ï¼Œå› æ­¤åœ¨ä¾‹å­ä¸­ï¼Œå…±æœ‰4ä¸ªå­ç½‘ï¼Œå¦‚ä¸‹å›¾\n\n![image-20240921135737594](https://raw.githubusercontent.com/lyydsheep/pic/main/202409211357645.png)\n\n#### å…¬æœ‰IPåœ°å€ä¸ç§æœ‰IPåœ°å€\n\nåœ¨Aã€Bã€Cä¸‰ç±»IPåœ°å€ä¸­ï¼Œå®é™…ä¸Šåˆ†æœ‰å…¬æœ‰IPåœ°å€å’Œç§æœ‰IPåœ°å€\n\n![image-20240921140902040](https://raw.githubusercontent.com/lyydsheep/pic/main/202409211409097.png)\n\nåœ¨ä¸åŒçš„åœ°åŸŸä¸­ï¼Œç§æœ‰IPåœ°å€å¯ä»¥é‡å¤ï¼Œä½†å…¬æœ‰IPåœ°å€åœ¨æ•´ä¸ªäº’è”ç½‘èŒƒå›´å†…æ˜¯å”¯ä¸€çš„\n\n#### IPåœ°å€ä¸è·¯ç”±æ§åˆ¶\n\nåœ¨å‘é€IPåŒ…æ—¶ï¼Œé¦–å…ˆæ‹¿ç€IPåŒ…ä¸­çš„ç›®æ ‡åœ°å€å’Œæœ¬ä¸»æœºï¼ˆè·¯ç”±å™¨ï¼‰çš„è·¯ç”±è¡¨è¿›è¡ŒåŒ¹é…ï¼Œæ‰¾åˆ°å…·æœ‰ç›¸åŒ**ç½‘ç»œåœ°å€**çš„è®°å½•ï¼Œå†æ ¹æ®è¯¥è®°å½•å°†IPåŒ…è½¬å‘è‡³ä¸‹ä¸€ä¸ªè·¯ç”±å™¨æˆ–ä¸»æœºã€‚å¦‚æœåŒ¹é…è¿‡ç¨‹ä¸­å‘ç°æœ‰å¤šä¸ªç›¸åŒçš„ç½‘ç»œåœ°å€ï¼Œåˆ™é€‰æ‹©ç›¸åŒä½æ•°æœ€å¤šçš„ç½‘ç»œåœ°å€ï¼Œå³æœ€é•¿åŒ¹é…ï¼›åä¹‹ï¼Œå¦‚æœåŒ¹é…è¿‡ç¨‹ä¸­æ²¡æœ‰ä¸€ä¸ªåŒ¹é…æˆåŠŸğŸ˜ªï¼Œåˆ™è½¬å‘è‡³é»˜è®¤ä¸‹ä¸€è·³åœ°å€\n\n> æ¢å›åœ°å€ä¸ä¼šæµå‘ç½‘ç»œ\n\nç‰¹æ®ŠIPåœ°å€<font color='blue'>**127.0.0.1**</font>è¢«è®¡ç®—æœºä½œä¸º<font color='blue'>**ç¯å›åœ°å€**</font>ï¼ˆåŒ`localhost`ï¼‰ã€‚ä½¿ç”¨è¿™ä¸ªIPåœ°å€æ—¶ï¼Œæ•°æ®åŒ…æ˜¯ä¸ä¼šæµå‘ç½‘ç»œçš„\n","slug":"ç½‘ç»œå±‚çŸ¥è¯†ç‚¹","published":1,"updated":"2024-12-27T11:03:15.345Z","comments":1,"layout":"post","photos":[],"_id":"cm6c7md6l001ba5t2dt3q415q","content":"<h1 id=\"ç½‘ç»œå±‚çŸ¥è¯†ç‚¹\"><a href=\"#ç½‘ç»œå±‚çŸ¥è¯†ç‚¹\" class=\"headerlink\" title=\"ç½‘ç»œå±‚çŸ¥è¯†ç‚¹\"></a>ç½‘ç»œå±‚çŸ¥è¯†ç‚¹</h1><h2 id=\"IP\"><a href=\"#IP\" class=\"headerlink\" title=\"IP\"></a>IP</h2><blockquote>\n<p>IPæ˜¯ä»€ä¹ˆï¼ŸæŠ¥æ–‡æ ¼å¼æ˜¯æ€æ ·çš„ï¼Ÿ</p>\n<p>IPåœ°å€çš„åˆ†ç±»ï¼Ÿ</p>\n<p>å¦‚ä½•è¿›è¡Œè·¯ç”±ï¼Ÿ</p>\n</blockquote>\n<p><a href=\"https://xiaolincoding.com/network/4_ip/ip_base.html\">å‚è€ƒæ–‡ç« </a></p>\n<h3 id=\"IPåŸºæœ¬è®¤è¯†\"><a href=\"#IPåŸºæœ¬è®¤è¯†\" class=\"headerlink\" title=\"IPåŸºæœ¬è®¤è¯†\"></a>IPåŸºæœ¬è®¤è¯†</h3><p>ç½‘ç»œå±‚çš„ä¸»è¦ä½œç”¨æ˜¯<strong>å®ç°ç«¯åˆ°ç«¯ï¼ˆä¸»æœºåˆ°ä¸»æœºï¼‰ä¹‹é—´çš„é€šä¿¡</strong></p>\n<blockquote>\n<p>IPå’ŒMACçš„å…³ç³»</p>\n</blockquote>\n<p>MACè´Ÿè´£å®ç°åŒä¸€ä¸ªç½‘ç»œå†…<strong>ç›´è¿</strong>çš„ä¸¤å°è®¾å¤‡ä¹‹é—´çš„é€šä¿¡ï¼Œè€ŒIPè´Ÿè´£å®ç°ä¸åŒç½‘ç»œçš„ä¸¤å°<strong>ä¸ç›¸è¿</strong>çš„è®¾å¤‡ä¹‹é—´çš„é€šä¿¡</p>\n<p>åœ¨æ•°æ®ä¼ è¾“è¿‡ç¨‹ä¸­ï¼ŒæºIPåœ°å€å’Œç›®æ ‡IPåœ°å€ä¸€èˆ¬æ˜¯ä¸ä¼šå˜åŒ–çš„ï¼Œè€ŒæºMACåœ°å€å’Œç›®æ ‡MACåœ°å€æ˜¯ä¸€ç›´åœ¨å˜åŒ–çš„ã€‚</p>\n<h3 id=\"IPåœ°å€\"><a href=\"#IPåœ°å€\" class=\"headerlink\" title=\"IPåœ°å€\"></a>IPåœ°å€</h3><p>IPv4åœ°å€ç”±32ä½0ã€1æ­£æ•´æ•°è¡¨ç¤º</p>\n<p>ğŸŒ°ï¼š<code>11000000  10101000  00000001  00000001</code></p>\n<p>32ä½æ•´æ•°ä¸­æœ‰ä¸€éƒ¨åˆ†å……å½“<strong>ç½‘ç»œå·</strong>ï¼Œå¦ä¸€éƒ¨åˆ†å……å½“<strong>ä¸»æœºå·</strong>ï¼Œæ‰€ä»¥å¯ä»¥è¯´IPåœ°å€æ˜¯ç”±<font color='blue'><strong>ç½‘ç»œæ ‡è¯†</strong></font>å’Œ<font color='blue'><strong>ä¸»æœºæ ‡è¯†</strong></font>è¿™ä¸¤éƒ¨åˆ†æ„æˆ</p>\n<blockquote>\n<p>ä¸ºä»€ä¹ˆè¦åˆ†ç¦»ç½‘ç»œå·å’Œä¸»æœºå·ï¼Ÿ</p>\n</blockquote>\n<p>å› ä¸ºä¸¤å°è®¾å¤‡åœ¨è¿›è¡Œé€šä¿¡ä¹‹å‰ï¼Œå…ˆåˆ¤æ–­æ˜¯å¦åœ¨åŒä¸€ä¸ªå¹¿æ’­åŸŸå†…ï¼Œå³ç½‘ç»œå·æ˜¯å¦ç›¸åŒï¼Œå¦‚æœæ˜¯åˆ™å¯ä»¥æŠŠæ•°æ®åŒ…ç›´æ¥å‘é€åˆ°ç›®æ ‡ä¸»æœº</p>\n<p>ä¸ºäº†è¡¨ç¤ºæ–¹ä¾¿ï¼Œå¯ä»¥å°†æ¯8ä½åˆ†ä¸ºä¸€ç»„ï¼Œæ¯ç»„ç”¨åè¿›åˆ¶è¡¨ç¤ºï¼Œç”¨**<code>.</code>**ä½œä¸ºç»„ä¸ç»„ä¹‹é—´çš„åˆ†éš”ç¬¦å·</p>\n<p>ğŸŒ°ï¼š<code>192.168.1.1</code></p>\n<p>IPåœ°å€å¹¶éä»¥ä¸»æœºä¸ºæœ€å°é…ç½®å•ä½ï¼Œè€Œæ˜¯ä»¥ç½‘å¡æ¥é…ç½®çš„ã€‚å³ä¸€å°æœåŠ¡å™¨ã€è·¯ç”±å™¨è‡³å°‘æœ‰ä¸¤ä¸ªç½‘å¡ï¼Œç­‰ä»·äºè‡³å°‘æœ‰ä¸¤ä¸ªIPåœ°å€</p>\n<p><img src=\"https://raw.githubusercontent.com/lyydsheep/pic/main/202409211057876.png\" alt=\"image-20240921105702834\"></p>\n<h4 id=\"IPåœ°å€çš„åˆ†ç±»\"><a href=\"#IPåœ°å€çš„åˆ†ç±»\" class=\"headerlink\" title=\"IPåœ°å€çš„åˆ†ç±»\"></a>IPåœ°å€çš„åˆ†ç±»</h4><blockquote>\n<p>äº’è”ç½‘è¯ç”Ÿä¹‹åˆï¼ŒIP åœ°å€æ˜¾å¾—å¾ˆå……è£•ï¼Œäºæ˜¯è®¡ç®—æœºç§‘å­¦å®¶ä»¬è®¾è®¡äº†<strong>åˆ†ç±»åœ°å€</strong>ã€‚</p>\n<p>ï¼ˆä½†æ˜¯ç°åœ¨IPv4æ—©å°±ä¸å¤Ÿç”¨å“©ğŸ¤ªï¼Œäºæ˜¯å°±æœ‰äº†IPv6ï¼‰</p>\n</blockquote>\n<p>IPv4åœ°å€åˆ†ä¸º5å¤§ç±»ï¼šAã€Bã€Cã€Dã€Eç±»ï¼Œéœ€è¦é‡ç‚¹å…³æ³¨çš„åªæœ‰Aã€Bã€Cè¿™ä¸‰ç±»IPåœ°å€</p>\n<p>ç”±å‰æ–‡çŸ¥ï¼ŒIPåœ°å€ç”±ç½‘ç»œå·å’Œä¸»æœºå·æ„æˆï¼ŒAã€Bã€Cä¸‰ç±»IPåœ°å€çš„åŒºåˆ«å°±åœ¨äºä¸»æœºå·çš„ä½æ•°ï¼Œå…·ä½“å¦‚ä¸‹å›¾ï¼š</p>\n<p><img src=\"https://raw.githubusercontent.com/lyydsheep/pic/main/202409211323959.png\" alt=\"image-20240921132334887\"></p>\n<p>ä»¥Cç±»IPåœ°å€ä¸ºä¾‹ï¼Œè™½ç„¶Cç±»ä¸»æœºå·å æœ‰8ä½ï¼Œä½†æ˜¯Cç±»åœ°å€çš„æœ€å¤§ä¸»æœºä¸ªæ•°ä¸ºï¼š$$ 2^8 - 2 &#x3D; 254 $$</p>\n<p>è¿™é‡Œ<strong>å‡2</strong>æ˜¯å‡å»ä¸¤ä¸ªæ¯”è¾ƒç‰¹æ®Šçš„ä¸»æœºå·ï¼š</p>\n<ul>\n<li>ä¸»æœºå·å…¨0<ul>\n<li>æŒ‡å®šæŸä¸ªç½‘ç»œ</li>\n</ul>\n</li>\n<li>ä¸»æœºå·å…¨1<ul>\n<li>æŒ‡å®šæŸä¸ªç½‘ç»œä¸‹çš„æ‰€æœ‰ä¸»æœºï¼Œç”¨äºå¹¿æ’­</li>\n</ul>\n</li>\n</ul>\n<p>IPåˆ†ç±»çš„ä¼˜ç‚¹å°±æ˜¯ç®€å•æ˜äº†ã€é€‰è·¯ï¼ˆåŸºäºç½‘ç»œåœ°å€ï¼‰ç®€å•</p>\n<p>ç¼ºç‚¹ä¹Ÿæ˜¯æœ‰çš„ğŸ˜‘ï¼š</p>\n<ul>\n<li><p>æŸä¸€ç±»ç½‘ç»œä¸‹<strong>æ— æ³•å†ç»†åˆ†IPåœ°å€ç±»å‹</strong>ï¼ŒğŸŒ°ï¼šä¸€ä¸ªå­¦æ ¡ä½¿ç”¨äº†Bç±»çš„IPåœ°å€ï¼Œç°æœ‰æŒ‰ç…§ä¸åŒå­¦é™¢åˆ’åˆ†åœ°å€å±‚æ¬¡çš„éœ€æ±‚ï¼Œä½†æ˜¯IPåˆ†ç±»æ˜¯æ— æ³•å®ç°è¿™ç±»éœ€æ±‚çš„ï¼Œ<strong>çµæ´»æ€§è¾ƒå·®</strong></p>\n</li>\n<li><p><strong>ä¸èƒ½å¾ˆå¥½çš„ä¸ç°å®ç½‘ç»œåŒ¹é…</strong>ï¼šè¦ä¹ˆIPåœ°å€åŒ…å«çš„ä¸»æœºæ•°é‡å¤ªå¤šï¼Œè¦ä¹ˆå°±æ˜¯å¤ªå°‘</p>\n</li>\n</ul>\n<h4 id=\"æ— åˆ†ç±»åœ°å€CIDR\"><a href=\"#æ— åˆ†ç±»åœ°å€CIDR\" class=\"headerlink\" title=\"æ— åˆ†ç±»åœ°å€CIDR\"></a>æ— åˆ†ç±»åœ°å€CIDR</h4><p>å–æ¶ˆå¯¹IPåœ°å€åˆ†ç±»çš„æ¦‚å¿µï¼Œé‡‡ç”¨<code>a.b.c.d/x</code>çš„å½¢å¼æ ‡è¯†ä¸€ä¸ªIPåœ°å€ã€‚å…¶ä¸­å‰<code>x</code>ä½å±äºç½‘ç»œå·ï¼Œè¿™ä½¿å¾—IPåœ°å€æ›´åŠ çµæ´»</p>\n<h5 id=\"å­ç½‘æ©ç \"><a href=\"#å­ç½‘æ©ç \" class=\"headerlink\" title=\"å­ç½‘æ©ç \"></a>å­ç½‘æ©ç </h5><p>å­ç½‘æ©ç å¯ä»¥ä¹Ÿå¯ä»¥ç”¨äºåŒºåˆ†ç½‘ç»œå·å’Œä¸»æœºå·ï¼Œä½†æ˜¯è¿™é‡Œçš„ç½‘ç»œå·æ—¢åŒ…å«äº†ç½‘ç»œåœ°å€åˆåŒ…å«äº†å­ç½‘ç½‘ç»œåœ°å€ï¼Œå¦‚ä¸‹å›¾</p>\n<p><img src=\"https://raw.githubusercontent.com/lyydsheep/pic/main/202409211353765.png\" alt=\"image-20240921135312707\"></p>\n<ul>\n<li>æœªåšå­ç½‘åˆ’åˆ†çš„IPåœ°å€ï¼šç½‘ç»œåœ°å€ + ä¸»æœºåœ°å€</li>\n<li>åšå­ç½‘åˆ’åˆ†çš„IPåœ°å€ï¼šç½‘ç»œåœ°å€ + ï¼ˆå­ç½‘ç½‘ç»œåœ°å€ + å­ç½‘ä¸»æœºåœ°å€ï¼‰</li>\n</ul>\n<p>å­ç½‘æ©ç æ›´å¤šæ˜¯å’Œåˆ†ç±»IPåœ°å€æˆ–æ— åˆ†ç±»IPåœ°å€ä¸€åŒä½¿ç”¨ï¼Œç”¨äºåœ¨æŸä¸ªç½‘æ®µä¸‹é¢ç»†åˆ†å­ç½‘ç±»å‹</p>\n<p>ğŸŒ°ï¼š<img src=\"https://raw.githubusercontent.com/lyydsheep/pic/main/202409211355750.png\" alt=\"image-20240921135545704\"></p>\n<p>è¿™é‡ŒCç±»IPåœ°å€ä¸­ä¸»æœºåœ°å€åŸæœ¬æœ‰8ä½ï¼Œç°å€Ÿå‡º2ä½ä½œä¸º<strong>å­ç½‘ç½‘ç»œåœ°å€</strong>ï¼Œå› æ­¤åœ¨ä¾‹å­ä¸­ï¼Œå…±æœ‰4ä¸ªå­ç½‘ï¼Œå¦‚ä¸‹å›¾</p>\n<p><img src=\"https://raw.githubusercontent.com/lyydsheep/pic/main/202409211357645.png\" alt=\"image-20240921135737594\"></p>\n<h4 id=\"å…¬æœ‰IPåœ°å€ä¸ç§æœ‰IPåœ°å€\"><a href=\"#å…¬æœ‰IPåœ°å€ä¸ç§æœ‰IPåœ°å€\" class=\"headerlink\" title=\"å…¬æœ‰IPåœ°å€ä¸ç§æœ‰IPåœ°å€\"></a>å…¬æœ‰IPåœ°å€ä¸ç§æœ‰IPåœ°å€</h4><p>åœ¨Aã€Bã€Cä¸‰ç±»IPåœ°å€ä¸­ï¼Œå®é™…ä¸Šåˆ†æœ‰å…¬æœ‰IPåœ°å€å’Œç§æœ‰IPåœ°å€</p>\n<p><img src=\"https://raw.githubusercontent.com/lyydsheep/pic/main/202409211409097.png\" alt=\"image-20240921140902040\"></p>\n<p>åœ¨ä¸åŒçš„åœ°åŸŸä¸­ï¼Œç§æœ‰IPåœ°å€å¯ä»¥é‡å¤ï¼Œä½†å…¬æœ‰IPåœ°å€åœ¨æ•´ä¸ªäº’è”ç½‘èŒƒå›´å†…æ˜¯å”¯ä¸€çš„</p>\n<h4 id=\"IPåœ°å€ä¸è·¯ç”±æ§åˆ¶\"><a href=\"#IPåœ°å€ä¸è·¯ç”±æ§åˆ¶\" class=\"headerlink\" title=\"IPåœ°å€ä¸è·¯ç”±æ§åˆ¶\"></a>IPåœ°å€ä¸è·¯ç”±æ§åˆ¶</h4><p>åœ¨å‘é€IPåŒ…æ—¶ï¼Œé¦–å…ˆæ‹¿ç€IPåŒ…ä¸­çš„ç›®æ ‡åœ°å€å’Œæœ¬ä¸»æœºï¼ˆè·¯ç”±å™¨ï¼‰çš„è·¯ç”±è¡¨è¿›è¡ŒåŒ¹é…ï¼Œæ‰¾åˆ°å…·æœ‰ç›¸åŒ<strong>ç½‘ç»œåœ°å€</strong>çš„è®°å½•ï¼Œå†æ ¹æ®è¯¥è®°å½•å°†IPåŒ…è½¬å‘è‡³ä¸‹ä¸€ä¸ªè·¯ç”±å™¨æˆ–ä¸»æœºã€‚å¦‚æœåŒ¹é…è¿‡ç¨‹ä¸­å‘ç°æœ‰å¤šä¸ªç›¸åŒçš„ç½‘ç»œåœ°å€ï¼Œåˆ™é€‰æ‹©ç›¸åŒä½æ•°æœ€å¤šçš„ç½‘ç»œåœ°å€ï¼Œå³æœ€é•¿åŒ¹é…ï¼›åä¹‹ï¼Œå¦‚æœåŒ¹é…è¿‡ç¨‹ä¸­æ²¡æœ‰ä¸€ä¸ªåŒ¹é…æˆåŠŸğŸ˜ªï¼Œåˆ™è½¬å‘è‡³é»˜è®¤ä¸‹ä¸€è·³åœ°å€</p>\n<blockquote>\n<p>æ¢å›åœ°å€ä¸ä¼šæµå‘ç½‘ç»œ</p>\n</blockquote>\n<p>ç‰¹æ®ŠIPåœ°å€<font color='blue'><strong>127.0.0.1</strong></font>è¢«è®¡ç®—æœºä½œä¸º<font color='blue'><strong>ç¯å›åœ°å€</strong></font>ï¼ˆåŒ<code>localhost</code>ï¼‰ã€‚ä½¿ç”¨è¿™ä¸ªIPåœ°å€æ—¶ï¼Œæ•°æ®åŒ…æ˜¯ä¸ä¼šæµå‘ç½‘ç»œçš„</p>\n","excerpt":"","more":"<h1 id=\"ç½‘ç»œå±‚çŸ¥è¯†ç‚¹\"><a href=\"#ç½‘ç»œå±‚çŸ¥è¯†ç‚¹\" class=\"headerlink\" title=\"ç½‘ç»œå±‚çŸ¥è¯†ç‚¹\"></a>ç½‘ç»œå±‚çŸ¥è¯†ç‚¹</h1><h2 id=\"IP\"><a href=\"#IP\" class=\"headerlink\" title=\"IP\"></a>IP</h2><blockquote>\n<p>IPæ˜¯ä»€ä¹ˆï¼ŸæŠ¥æ–‡æ ¼å¼æ˜¯æ€æ ·çš„ï¼Ÿ</p>\n<p>IPåœ°å€çš„åˆ†ç±»ï¼Ÿ</p>\n<p>å¦‚ä½•è¿›è¡Œè·¯ç”±ï¼Ÿ</p>\n</blockquote>\n<p><a href=\"https://xiaolincoding.com/network/4_ip/ip_base.html\">å‚è€ƒæ–‡ç« </a></p>\n<h3 id=\"IPåŸºæœ¬è®¤è¯†\"><a href=\"#IPåŸºæœ¬è®¤è¯†\" class=\"headerlink\" title=\"IPåŸºæœ¬è®¤è¯†\"></a>IPåŸºæœ¬è®¤è¯†</h3><p>ç½‘ç»œå±‚çš„ä¸»è¦ä½œç”¨æ˜¯<strong>å®ç°ç«¯åˆ°ç«¯ï¼ˆä¸»æœºåˆ°ä¸»æœºï¼‰ä¹‹é—´çš„é€šä¿¡</strong></p>\n<blockquote>\n<p>IPå’ŒMACçš„å…³ç³»</p>\n</blockquote>\n<p>MACè´Ÿè´£å®ç°åŒä¸€ä¸ªç½‘ç»œå†…<strong>ç›´è¿</strong>çš„ä¸¤å°è®¾å¤‡ä¹‹é—´çš„é€šä¿¡ï¼Œè€ŒIPè´Ÿè´£å®ç°ä¸åŒç½‘ç»œçš„ä¸¤å°<strong>ä¸ç›¸è¿</strong>çš„è®¾å¤‡ä¹‹é—´çš„é€šä¿¡</p>\n<p>åœ¨æ•°æ®ä¼ è¾“è¿‡ç¨‹ä¸­ï¼ŒæºIPåœ°å€å’Œç›®æ ‡IPåœ°å€ä¸€èˆ¬æ˜¯ä¸ä¼šå˜åŒ–çš„ï¼Œè€ŒæºMACåœ°å€å’Œç›®æ ‡MACåœ°å€æ˜¯ä¸€ç›´åœ¨å˜åŒ–çš„ã€‚</p>\n<h3 id=\"IPåœ°å€\"><a href=\"#IPåœ°å€\" class=\"headerlink\" title=\"IPåœ°å€\"></a>IPåœ°å€</h3><p>IPv4åœ°å€ç”±32ä½0ã€1æ­£æ•´æ•°è¡¨ç¤º</p>\n<p>ğŸŒ°ï¼š<code>11000000  10101000  00000001  00000001</code></p>\n<p>32ä½æ•´æ•°ä¸­æœ‰ä¸€éƒ¨åˆ†å……å½“<strong>ç½‘ç»œå·</strong>ï¼Œå¦ä¸€éƒ¨åˆ†å……å½“<strong>ä¸»æœºå·</strong>ï¼Œæ‰€ä»¥å¯ä»¥è¯´IPåœ°å€æ˜¯ç”±<font color='blue'><strong>ç½‘ç»œæ ‡è¯†</strong></font>å’Œ<font color='blue'><strong>ä¸»æœºæ ‡è¯†</strong></font>è¿™ä¸¤éƒ¨åˆ†æ„æˆ</p>\n<blockquote>\n<p>ä¸ºä»€ä¹ˆè¦åˆ†ç¦»ç½‘ç»œå·å’Œä¸»æœºå·ï¼Ÿ</p>\n</blockquote>\n<p>å› ä¸ºä¸¤å°è®¾å¤‡åœ¨è¿›è¡Œé€šä¿¡ä¹‹å‰ï¼Œå…ˆåˆ¤æ–­æ˜¯å¦åœ¨åŒä¸€ä¸ªå¹¿æ’­åŸŸå†…ï¼Œå³ç½‘ç»œå·æ˜¯å¦ç›¸åŒï¼Œå¦‚æœæ˜¯åˆ™å¯ä»¥æŠŠæ•°æ®åŒ…ç›´æ¥å‘é€åˆ°ç›®æ ‡ä¸»æœº</p>\n<p>ä¸ºäº†è¡¨ç¤ºæ–¹ä¾¿ï¼Œå¯ä»¥å°†æ¯8ä½åˆ†ä¸ºä¸€ç»„ï¼Œæ¯ç»„ç”¨åè¿›åˆ¶è¡¨ç¤ºï¼Œç”¨**<code>.</code>**ä½œä¸ºç»„ä¸ç»„ä¹‹é—´çš„åˆ†éš”ç¬¦å·</p>\n<p>ğŸŒ°ï¼š<code>192.168.1.1</code></p>\n<p>IPåœ°å€å¹¶éä»¥ä¸»æœºä¸ºæœ€å°é…ç½®å•ä½ï¼Œè€Œæ˜¯ä»¥ç½‘å¡æ¥é…ç½®çš„ã€‚å³ä¸€å°æœåŠ¡å™¨ã€è·¯ç”±å™¨è‡³å°‘æœ‰ä¸¤ä¸ªç½‘å¡ï¼Œç­‰ä»·äºè‡³å°‘æœ‰ä¸¤ä¸ªIPåœ°å€</p>\n<p><img src=\"https://raw.githubusercontent.com/lyydsheep/pic/main/202409211057876.png\" alt=\"image-20240921105702834\"></p>\n<h4 id=\"IPåœ°å€çš„åˆ†ç±»\"><a href=\"#IPåœ°å€çš„åˆ†ç±»\" class=\"headerlink\" title=\"IPåœ°å€çš„åˆ†ç±»\"></a>IPåœ°å€çš„åˆ†ç±»</h4><blockquote>\n<p>äº’è”ç½‘è¯ç”Ÿä¹‹åˆï¼ŒIP åœ°å€æ˜¾å¾—å¾ˆå……è£•ï¼Œäºæ˜¯è®¡ç®—æœºç§‘å­¦å®¶ä»¬è®¾è®¡äº†<strong>åˆ†ç±»åœ°å€</strong>ã€‚</p>\n<p>ï¼ˆä½†æ˜¯ç°åœ¨IPv4æ—©å°±ä¸å¤Ÿç”¨å“©ğŸ¤ªï¼Œäºæ˜¯å°±æœ‰äº†IPv6ï¼‰</p>\n</blockquote>\n<p>IPv4åœ°å€åˆ†ä¸º5å¤§ç±»ï¼šAã€Bã€Cã€Dã€Eç±»ï¼Œéœ€è¦é‡ç‚¹å…³æ³¨çš„åªæœ‰Aã€Bã€Cè¿™ä¸‰ç±»IPåœ°å€</p>\n<p>ç”±å‰æ–‡çŸ¥ï¼ŒIPåœ°å€ç”±ç½‘ç»œå·å’Œä¸»æœºå·æ„æˆï¼ŒAã€Bã€Cä¸‰ç±»IPåœ°å€çš„åŒºåˆ«å°±åœ¨äºä¸»æœºå·çš„ä½æ•°ï¼Œå…·ä½“å¦‚ä¸‹å›¾ï¼š</p>\n<p><img src=\"https://raw.githubusercontent.com/lyydsheep/pic/main/202409211323959.png\" alt=\"image-20240921132334887\"></p>\n<p>ä»¥Cç±»IPåœ°å€ä¸ºä¾‹ï¼Œè™½ç„¶Cç±»ä¸»æœºå·å æœ‰8ä½ï¼Œä½†æ˜¯Cç±»åœ°å€çš„æœ€å¤§ä¸»æœºä¸ªæ•°ä¸ºï¼š$$ 2^8 - 2 &#x3D; 254 $$</p>\n<p>è¿™é‡Œ<strong>å‡2</strong>æ˜¯å‡å»ä¸¤ä¸ªæ¯”è¾ƒç‰¹æ®Šçš„ä¸»æœºå·ï¼š</p>\n<ul>\n<li>ä¸»æœºå·å…¨0<ul>\n<li>æŒ‡å®šæŸä¸ªç½‘ç»œ</li>\n</ul>\n</li>\n<li>ä¸»æœºå·å…¨1<ul>\n<li>æŒ‡å®šæŸä¸ªç½‘ç»œä¸‹çš„æ‰€æœ‰ä¸»æœºï¼Œç”¨äºå¹¿æ’­</li>\n</ul>\n</li>\n</ul>\n<p>IPåˆ†ç±»çš„ä¼˜ç‚¹å°±æ˜¯ç®€å•æ˜äº†ã€é€‰è·¯ï¼ˆåŸºäºç½‘ç»œåœ°å€ï¼‰ç®€å•</p>\n<p>ç¼ºç‚¹ä¹Ÿæ˜¯æœ‰çš„ğŸ˜‘ï¼š</p>\n<ul>\n<li><p>æŸä¸€ç±»ç½‘ç»œä¸‹<strong>æ— æ³•å†ç»†åˆ†IPåœ°å€ç±»å‹</strong>ï¼ŒğŸŒ°ï¼šä¸€ä¸ªå­¦æ ¡ä½¿ç”¨äº†Bç±»çš„IPåœ°å€ï¼Œç°æœ‰æŒ‰ç…§ä¸åŒå­¦é™¢åˆ’åˆ†åœ°å€å±‚æ¬¡çš„éœ€æ±‚ï¼Œä½†æ˜¯IPåˆ†ç±»æ˜¯æ— æ³•å®ç°è¿™ç±»éœ€æ±‚çš„ï¼Œ<strong>çµæ´»æ€§è¾ƒå·®</strong></p>\n</li>\n<li><p><strong>ä¸èƒ½å¾ˆå¥½çš„ä¸ç°å®ç½‘ç»œåŒ¹é…</strong>ï¼šè¦ä¹ˆIPåœ°å€åŒ…å«çš„ä¸»æœºæ•°é‡å¤ªå¤šï¼Œè¦ä¹ˆå°±æ˜¯å¤ªå°‘</p>\n</li>\n</ul>\n<h4 id=\"æ— åˆ†ç±»åœ°å€CIDR\"><a href=\"#æ— åˆ†ç±»åœ°å€CIDR\" class=\"headerlink\" title=\"æ— åˆ†ç±»åœ°å€CIDR\"></a>æ— åˆ†ç±»åœ°å€CIDR</h4><p>å–æ¶ˆå¯¹IPåœ°å€åˆ†ç±»çš„æ¦‚å¿µï¼Œé‡‡ç”¨<code>a.b.c.d/x</code>çš„å½¢å¼æ ‡è¯†ä¸€ä¸ªIPåœ°å€ã€‚å…¶ä¸­å‰<code>x</code>ä½å±äºç½‘ç»œå·ï¼Œè¿™ä½¿å¾—IPåœ°å€æ›´åŠ çµæ´»</p>\n<h5 id=\"å­ç½‘æ©ç \"><a href=\"#å­ç½‘æ©ç \" class=\"headerlink\" title=\"å­ç½‘æ©ç \"></a>å­ç½‘æ©ç </h5><p>å­ç½‘æ©ç å¯ä»¥ä¹Ÿå¯ä»¥ç”¨äºåŒºåˆ†ç½‘ç»œå·å’Œä¸»æœºå·ï¼Œä½†æ˜¯è¿™é‡Œçš„ç½‘ç»œå·æ—¢åŒ…å«äº†ç½‘ç»œåœ°å€åˆåŒ…å«äº†å­ç½‘ç½‘ç»œåœ°å€ï¼Œå¦‚ä¸‹å›¾</p>\n<p><img src=\"https://raw.githubusercontent.com/lyydsheep/pic/main/202409211353765.png\" alt=\"image-20240921135312707\"></p>\n<ul>\n<li>æœªåšå­ç½‘åˆ’åˆ†çš„IPåœ°å€ï¼šç½‘ç»œåœ°å€ + ä¸»æœºåœ°å€</li>\n<li>åšå­ç½‘åˆ’åˆ†çš„IPåœ°å€ï¼šç½‘ç»œåœ°å€ + ï¼ˆå­ç½‘ç½‘ç»œåœ°å€ + å­ç½‘ä¸»æœºåœ°å€ï¼‰</li>\n</ul>\n<p>å­ç½‘æ©ç æ›´å¤šæ˜¯å’Œåˆ†ç±»IPåœ°å€æˆ–æ— åˆ†ç±»IPåœ°å€ä¸€åŒä½¿ç”¨ï¼Œç”¨äºåœ¨æŸä¸ªç½‘æ®µä¸‹é¢ç»†åˆ†å­ç½‘ç±»å‹</p>\n<p>ğŸŒ°ï¼š<img src=\"https://raw.githubusercontent.com/lyydsheep/pic/main/202409211355750.png\" alt=\"image-20240921135545704\"></p>\n<p>è¿™é‡ŒCç±»IPåœ°å€ä¸­ä¸»æœºåœ°å€åŸæœ¬æœ‰8ä½ï¼Œç°å€Ÿå‡º2ä½ä½œä¸º<strong>å­ç½‘ç½‘ç»œåœ°å€</strong>ï¼Œå› æ­¤åœ¨ä¾‹å­ä¸­ï¼Œå…±æœ‰4ä¸ªå­ç½‘ï¼Œå¦‚ä¸‹å›¾</p>\n<p><img src=\"https://raw.githubusercontent.com/lyydsheep/pic/main/202409211357645.png\" alt=\"image-20240921135737594\"></p>\n<h4 id=\"å…¬æœ‰IPåœ°å€ä¸ç§æœ‰IPåœ°å€\"><a href=\"#å…¬æœ‰IPåœ°å€ä¸ç§æœ‰IPåœ°å€\" class=\"headerlink\" title=\"å…¬æœ‰IPåœ°å€ä¸ç§æœ‰IPåœ°å€\"></a>å…¬æœ‰IPåœ°å€ä¸ç§æœ‰IPåœ°å€</h4><p>åœ¨Aã€Bã€Cä¸‰ç±»IPåœ°å€ä¸­ï¼Œå®é™…ä¸Šåˆ†æœ‰å…¬æœ‰IPåœ°å€å’Œç§æœ‰IPåœ°å€</p>\n<p><img src=\"https://raw.githubusercontent.com/lyydsheep/pic/main/202409211409097.png\" alt=\"image-20240921140902040\"></p>\n<p>åœ¨ä¸åŒçš„åœ°åŸŸä¸­ï¼Œç§æœ‰IPåœ°å€å¯ä»¥é‡å¤ï¼Œä½†å…¬æœ‰IPåœ°å€åœ¨æ•´ä¸ªäº’è”ç½‘èŒƒå›´å†…æ˜¯å”¯ä¸€çš„</p>\n<h4 id=\"IPåœ°å€ä¸è·¯ç”±æ§åˆ¶\"><a href=\"#IPåœ°å€ä¸è·¯ç”±æ§åˆ¶\" class=\"headerlink\" title=\"IPåœ°å€ä¸è·¯ç”±æ§åˆ¶\"></a>IPåœ°å€ä¸è·¯ç”±æ§åˆ¶</h4><p>åœ¨å‘é€IPåŒ…æ—¶ï¼Œé¦–å…ˆæ‹¿ç€IPåŒ…ä¸­çš„ç›®æ ‡åœ°å€å’Œæœ¬ä¸»æœºï¼ˆè·¯ç”±å™¨ï¼‰çš„è·¯ç”±è¡¨è¿›è¡ŒåŒ¹é…ï¼Œæ‰¾åˆ°å…·æœ‰ç›¸åŒ<strong>ç½‘ç»œåœ°å€</strong>çš„è®°å½•ï¼Œå†æ ¹æ®è¯¥è®°å½•å°†IPåŒ…è½¬å‘è‡³ä¸‹ä¸€ä¸ªè·¯ç”±å™¨æˆ–ä¸»æœºã€‚å¦‚æœåŒ¹é…è¿‡ç¨‹ä¸­å‘ç°æœ‰å¤šä¸ªç›¸åŒçš„ç½‘ç»œåœ°å€ï¼Œåˆ™é€‰æ‹©ç›¸åŒä½æ•°æœ€å¤šçš„ç½‘ç»œåœ°å€ï¼Œå³æœ€é•¿åŒ¹é…ï¼›åä¹‹ï¼Œå¦‚æœåŒ¹é…è¿‡ç¨‹ä¸­æ²¡æœ‰ä¸€ä¸ªåŒ¹é…æˆåŠŸğŸ˜ªï¼Œåˆ™è½¬å‘è‡³é»˜è®¤ä¸‹ä¸€è·³åœ°å€</p>\n<blockquote>\n<p>æ¢å›åœ°å€ä¸ä¼šæµå‘ç½‘ç»œ</p>\n</blockquote>\n<p>ç‰¹æ®ŠIPåœ°å€<font color='blue'><strong>127.0.0.1</strong></font>è¢«è®¡ç®—æœºä½œä¸º<font color='blue'><strong>ç¯å›åœ°å€</strong></font>ï¼ˆåŒ<code>localhost</code>ï¼‰ã€‚ä½¿ç”¨è¿™ä¸ªIPåœ°å€æ—¶ï¼Œæ•°æ®åŒ…æ˜¯ä¸ä¼šæµå‘ç½‘ç»œçš„</p>\n"},{"_content":"---\n\n---\nä¸¤é˜¶æ®µæäº¤ï¼ˆ2PCï¼‰\n\t- å‡†å¤‡é˜¶æ®µ\n\t- æäº¤é˜¶æ®µ\n\t- é¢‘ç¹çš„é”ï¼Œæ­»é”é—®é¢˜\n\t- å¾ˆå¤šçš„é”ï¼Œæ•°æ®å»¶è¿Ÿé«˜\n\t- æ•°æ®ä¸¢å¤±\n\nåŸºäºMQçš„æ¶ˆæ¯æŠ•é€’\n-  MQè‡ªåŠ¨åº”ç­”æœºåˆ¶å¯¼è‡´æ¶ˆæ¯ä¸¢å¤±ï¼šè¦ç¡®ä¿æ•°æ®çœŸæ­£æŒä¹…åŒ–åˆ°æ•°æ®åº“åæ‰èƒ½å°†MQä¸­çš„æ¶ˆæ¯åˆ é™¤\n- é«˜å¹¶å‘åœºæ™¯ä¸‹æ¶ˆæ¯ç§¯å‹ï¼šä½¿ç”¨åŒå‘æ¶ˆæ¯é˜Ÿåˆ— + æ•°æ®åº“æŒä¹…åŒ–ä»»åŠ¡ï¼Œç¡®ä¿æ¯ä¸€ä¸ªä»»åŠ¡èƒ½å¤Ÿå®Œæˆ","source":"_posts/è‰ç¨¿.md","raw":"---\n\n---\nä¸¤é˜¶æ®µæäº¤ï¼ˆ2PCï¼‰\n\t- å‡†å¤‡é˜¶æ®µ\n\t- æäº¤é˜¶æ®µ\n\t- é¢‘ç¹çš„é”ï¼Œæ­»é”é—®é¢˜\n\t- å¾ˆå¤šçš„é”ï¼Œæ•°æ®å»¶è¿Ÿé«˜\n\t- æ•°æ®ä¸¢å¤±\n\nåŸºäºMQçš„æ¶ˆæ¯æŠ•é€’\n-  MQè‡ªåŠ¨åº”ç­”æœºåˆ¶å¯¼è‡´æ¶ˆæ¯ä¸¢å¤±ï¼šè¦ç¡®ä¿æ•°æ®çœŸæ­£æŒä¹…åŒ–åˆ°æ•°æ®åº“åæ‰èƒ½å°†MQä¸­çš„æ¶ˆæ¯åˆ é™¤\n- é«˜å¹¶å‘åœºæ™¯ä¸‹æ¶ˆæ¯ç§¯å‹ï¼šä½¿ç”¨åŒå‘æ¶ˆæ¯é˜Ÿåˆ— + æ•°æ®åº“æŒä¹…åŒ–ä»»åŠ¡ï¼Œç¡®ä¿æ¯ä¸€ä¸ªä»»åŠ¡èƒ½å¤Ÿå®Œæˆ","slug":"è‰ç¨¿","published":1,"date":"2024-12-27T11:03:15.345Z","updated":"2024-12-27T11:03:15.345Z","title":"","comments":1,"layout":"post","photos":[],"_id":"cm6c7md6l001da5t2ciorfwlo","content":"<hr>\n<hr>\n<p>ä¸¤é˜¶æ®µæäº¤ï¼ˆ2PCï¼‰<br>    - å‡†å¤‡é˜¶æ®µ<br>    - æäº¤é˜¶æ®µ<br>    - é¢‘ç¹çš„é”ï¼Œæ­»é”é—®é¢˜<br>    - å¾ˆå¤šçš„é”ï¼Œæ•°æ®å»¶è¿Ÿé«˜<br>    - æ•°æ®ä¸¢å¤±</p>\n<p>åŸºäºMQçš„æ¶ˆæ¯æŠ•é€’</p>\n<ul>\n<li>MQè‡ªåŠ¨åº”ç­”æœºåˆ¶å¯¼è‡´æ¶ˆæ¯ä¸¢å¤±ï¼šè¦ç¡®ä¿æ•°æ®çœŸæ­£æŒä¹…åŒ–åˆ°æ•°æ®åº“åæ‰èƒ½å°†MQä¸­çš„æ¶ˆæ¯åˆ é™¤</li>\n<li>é«˜å¹¶å‘åœºæ™¯ä¸‹æ¶ˆæ¯ç§¯å‹ï¼šä½¿ç”¨åŒå‘æ¶ˆæ¯é˜Ÿåˆ— + æ•°æ®åº“æŒä¹…åŒ–ä»»åŠ¡ï¼Œç¡®ä¿æ¯ä¸€ä¸ªä»»åŠ¡èƒ½å¤Ÿå®Œæˆ</li>\n</ul>\n","excerpt":"","more":"<hr>\n<hr>\n<p>ä¸¤é˜¶æ®µæäº¤ï¼ˆ2PCï¼‰<br>    - å‡†å¤‡é˜¶æ®µ<br>    - æäº¤é˜¶æ®µ<br>    - é¢‘ç¹çš„é”ï¼Œæ­»é”é—®é¢˜<br>    - å¾ˆå¤šçš„é”ï¼Œæ•°æ®å»¶è¿Ÿé«˜<br>    - æ•°æ®ä¸¢å¤±</p>\n<p>åŸºäºMQçš„æ¶ˆæ¯æŠ•é€’</p>\n<ul>\n<li>MQè‡ªåŠ¨åº”ç­”æœºåˆ¶å¯¼è‡´æ¶ˆæ¯ä¸¢å¤±ï¼šè¦ç¡®ä¿æ•°æ®çœŸæ­£æŒä¹…åŒ–åˆ°æ•°æ®åº“åæ‰èƒ½å°†MQä¸­çš„æ¶ˆæ¯åˆ é™¤</li>\n<li>é«˜å¹¶å‘åœºæ™¯ä¸‹æ¶ˆæ¯ç§¯å‹ï¼šä½¿ç”¨åŒå‘æ¶ˆæ¯é˜Ÿåˆ— + æ•°æ®åº“æŒä¹…åŒ–ä»»åŠ¡ï¼Œç¡®ä¿æ¯ä¸€ä¸ªä»»åŠ¡èƒ½å¤Ÿå®Œæˆ</li>\n</ul>\n"},{"date":"2024-12-14T16:00:00.000Z","_content":"\n# è®¾è®¡æ¨¡å¼\n\n> è¿™æ˜¯[Easyæå®šGolangè®¾è®¡æ¨¡å¼](https://www.bilibili.com/video/BV1Eg411m7rV/?spm_id_from=333.1387.collection.video_card.click&vd_source=a15269894d9b8114cb5f9bb663d22be9)çš„å­¦ä¹ è®°å½•\n\n## é¢å‘å¯¹è±¡è®¾è®¡åŸåˆ™\n\n### å•ä¸€èŒè´£åŸåˆ™\n\nç±»çš„èŒè´£å•ä¸€ï¼Œå¯¹å¤–åªæä¾›ä¸€ç§åŠŸèƒ½ï¼Œè€Œå¼•èµ·ç±»çš„å˜åŒ–çš„åŸå› é€šå¸¸åªæœ‰ä¸€ä¸ªã€‚è¿™æ˜¯ä¸ºäº†é¿å…åˆ«äººçœ‹ä»£ç æ—¶äº§ç”Ÿæ­§ä¹‰ï¼Œæé«˜ä»£ç çš„é€»è¾‘æ€§\n\nè®¾è®¡ä¸€ä¸ªç±»ï¼Œå¯¹å¤–æä¾›çš„åŠŸèƒ½åº”è¯¥å•ä¸€ï¼Œæ¥å£å•ä¸€ï¼Œä»…æœ‰è¿™ä¸ªæ¥å£ä¼šå½±å“è¿™ä¸ªç±»ã€‚ä¸€ä¸ªç±»çš„ä¸€ä¸ªæ¥å£åº”å…·å¤‡è¿™ä¸ªç±»çš„åŠŸèƒ½å«ä¹‰ï¼ŒèŒè´£å•ä¸€å¹¶ä¸”ä¸å¤æ‚\n\n### å¼€é—­åŸåˆ™\n\n> å¯¹æ‰©å±•å¼€æ”¾ï¼Œå¯¹ä¿®æ”¹å…³é—­\n\nå¦‚æœæˆ‘ä»¬æƒ³ä¸ºæŸä¸ªç±»å¢æ·»æ–°çš„åŠŸèƒ½ï¼Œæœ€å¥½çš„æ–¹æ³•æ˜¯åŸºäºæ¥å£æˆ–è€…ç»„åˆçš„æ–¹å¼å¯¹å…¶è¿›è¡Œæ‰©å±•ï¼Œè€Œä¸æ˜¯åœ¨åŸæœ‰çš„ç±»ä»£ç ä¸Šè¿›è¡Œä¿®æ”¹ã€‚æ¯”å¦‚ä¸€ä¸ªç±»å·²ç»æœ‰äº†99ä¸ªæ–¹æ³•ï¼Œé‚£ä¹ˆå¢æ·»ç¬¬100ä¸ªæ–¹æ³•æ—¶å°±å¾ˆæœ‰å¯èƒ½å¯¼è‡´å‰é¢99ä¸ªæ–¹æ³•æ— æ³•æ­£å¸¸å·¥ä½œï¼ˆæ¯•ç«Ÿè°çŸ¥é“é‚£99ä¸ªæ–¹æ³•ç”¨äº†ä»€ä¹ˆå¥‡æŠ€æ·«å·§ï¼‰\n\næ‰€ä»¥å¼€é—­åŸåˆ™çš„æ ¸å¿ƒæ€æƒ³å°±æ˜¯ï¼šä¸æ˜¯é€šè¿‡ä¿®æ”¹ä»£ç ,è€Œæ˜¯é€šè¿‡å¢æ·»ä»£ç æ¥ç»™ç³»ç»Ÿæ·»åŠ åŠŸèƒ½\n\n### ä¾èµ–å€’è½¬åŸåˆ™ï¼ˆé‡è¦ï¼‰\n\næ„Ÿè§‰ä¾èµ–å€’è½¬åŸåˆ™çš„æ ¸å¿ƒå°±æ˜¯**é¢å‘æ¥å£ç¼–ç¨‹**\n<img src=\"https://raw.githubusercontent.com/lyydsheep/pic/main/202412121814145.png\" />\n\né¦–å…ˆéœ€è¦åšå¥½ä¸­é—´æŠ½è±¡å±‚çš„è®¾è®¡ï¼Œç„¶åä¾ç…§è¿™æŠ½è±¡å±‚ä¸€æ¬¡å°†å®ç°å±‚çš„æ¯ä¸€ä¸ªæ¨¡å—è¿›è¡Œå®ç°ã€‚è¿™ä¸€æ­¥æç°äº†å®ç°å±‚**å‘ä¸Šä¾èµ–æŠ½è±¡å±‚**\nå¦ä¸€æ–¹é¢ï¼ŒæŠ½è±¡å±‚å‘ä¸šåŠ¡é€»è¾‘å±‚æš´éœ²å‡ºåŠŸèƒ½çš„æ¥å£ï¼Œä¸šåŠ¡é€»è¾‘å±‚åªéœ€è¦æ ¹æ®æš´éœ²å‡ºæ¥çš„æ¥å£å®ç°å¯¹ä¹Ÿçš„ä¸šåŠ¡é€»è¾‘å³å¯ï¼Œæ— éœ€å…³ç³»åŠŸèƒ½å…·ä½“æ˜¯å¦‚ä½•å®ç°\n\n### åˆæˆå¤ç”¨åŸåˆ™\n\nå¦‚æœä½¿ç”¨ç»§æ‰¿ï¼Œä¼šå¯¼è‡´çˆ¶ç±»çš„ä»»ä½•å˜æ¢éƒ½å¯èƒ½å½±å“åˆ°å­ç±»çš„è¡Œä¸ºã€‚å¦‚æœä½¿ç”¨ç»„åˆï¼Œå°±å¤§å¤§é™ä½äº†è¿™ç§ä¾èµ–å…³ç³»ã€‚å¯¹äºç»„åˆå’Œç»§æ‰¿ï¼Œä¼˜å…ˆä½¿ç”¨ç»„åˆã€‚ï¼ˆGoå¤©ç„¶å®ç°ç»„åˆğŸ˜‚ï¼‰\næ¯”å¦‚çˆ¶ç±»æœ‰100ä¸ªæ–¹æ³•ï¼Œè€Œå­ç±»åªæƒ³ä½¿ç”¨å…¶ä¸­çš„æŸä¸€ä¸ªæ–¹æ³•ï¼Œé‚£ä¹ˆå­ç±»é‡‡ç”¨ç»„åˆçš„æ–¹å¼å°±èƒ½å±è”½æ‰çˆ¶ç±»çš„å…¶ä»–99ä¸ªæ–¹æ³•\n\n### è¿ªç±³ç‰¹æ³•åˆ™\n\nä¸€ä¸ªå¯¹è±¡åº”å½“å¯¹å…¶ä»–å¯¹è±¡å°½å¯èƒ½äº†è§£å¾—å°‘ï¼Œä»è€Œé™ä½å„ä¸ªå¯¹è±¡ä¹‹é—´çš„è€¦åˆï¼Œæé«˜ç³»ç»Ÿçš„å¯ç»´æŠ¤æ€§ã€‚\n\n## åˆ›å»ºå‹æ¨¡å¼\n### ç®€å•å·¥å‚æ¨¡å¼\n\n**ä¸šåŠ¡é€»è¾‘å±‚ --->  å·¥å‚æ¨¡å— ---> åŸºç¡€ç±»æ¨¡å—**\n\nåä¾‹ï¼šä¸šåŠ¡é€»è¾‘å±‚ ---> åŸºç¡€ç±»æ¨¡å—\n```go\ntype Fruit struct {  \n}  \n  \nfunc (f *Fruit) Name() {  \n    }  \n  \nfunc NewFruit(name string) *Fruit {  \n    res := &Fruit{}  \n    switch {  \n    case name == \"apple\":  \n       // do something  \n    case name == \"pear\":  \n       // do something  \n    default:  \n       // do something  \n    }  \n    return res  \n}  \n  \nfunc main() {  \n    apple := NewFruit(\"apple\")  \n    apple.Name()  \n    pear := NewFruit(\"pear\")  \n    pear.Name()  \n}\n```\nç®€å•å·¥å‚æ¨¡å¼å®ç°ä»£ç ï¼š\n```go\ntype Fruit interface {  \n    Show()  \n}  \n  \ntype Apple struct {  \n}  \n  \nfunc (a *Apple) Show() {  \n}  \n  \ntype Pear struct{  \n}  \n  \nfunc (p *Pear) Show() {  \n}  \n  \ntype Banana struct{  \n}  \n  \nfunc (b *Banana) Show() {  \n}  \n  \ntype Factory struct{}  \n  \nfunc (f *Factory) CreateFruit(name string) (Fruit, bool) {  \n    var fruit Fruit  \n    ok := false  \n    switch {  \n    case name == \"apple\":  \n       fruit, ok = new(Apple), true  \n    case name == \"pear\":  \n       fruit, ok = new(Pear), true  \n    case name == \"banana\":  \n       fruit, ok = new(Banana), true  \n    }  \n    return fruit, ok  \n}  \n  \n\n```\n\n![image.png](https://raw.githubusercontent.com/lyydsheep/pic/main/202412151724598.png)\n\n**ä¼˜ç‚¹**ï¼š\n1. å®ç°äº†å¯¹è±¡åˆ›å»ºå’Œä½¿ç”¨çš„åˆ†ç¦»\n**ç¼ºç‚¹**ï¼š\n1. è¿æ³•â€œå¼€é—­åŸåˆ™â€\n2. å·¥å‚ç±»èŒè´£è¿‡é‡ï¼Œä¸€æ—¦ä¸èƒ½å·¥ä½œï¼Œç³»ç»Ÿæ·±å—å½±å“\n3. å¤æ‚åº¦å’Œç†è§£åº¦éšç€ç±»çš„ä¸ªæ•°å¢åŠ \n\n### å·¥å‚æ¨¡å¼\n\nå·¥å‚æ¨¡å¼å°±æ˜¯â€œç®€å•å·¥å‚æ¨¡å¼ + å¼€é—­åŸåˆ™â€\nåœ¨Goé‡Œé¢ï¼Œå®ç°å·¥å‚æ¨¡å¼æ¯”è¾ƒå¸¸è§çš„å†™æ³•å°±æ˜¯`Newxxx()`\n```go\nfunc NewFactory() *Factory {  \n    return &Factory{}  \n}\n```\n### å•ä¾‹æ¨¡å¼\n\n> ä¿è¯ä¸€ä¸ªç±»æ°¸è¿œåªèƒ½æœ‰ä¸€ä¸ªå¯¹è±¡ï¼Œä¸”è¯¥å¯¹è±¡çš„åŠŸèƒ½ä¾ç„¶èƒ½è¢«å…¶ä»–æ¨¡å—ä½¿ç”¨\n\n**é¥¿æ±‰å¼**ï¼š\n```go\ntype single struct{}  \n  \nvar instance = new(single)  \n  \nfunc (s *single) Show() {  \n    // do something  \n}  \n  \nfunc GetInstance() *single {  \n    return instance  \n}\n```\n**æ‡’æ±‰å¼**ï¼šå»¶è¿Ÿåˆå§‹åŒ–ï¼Œç›´åˆ°è°ƒç”¨GetInstanceæ–¹æ³•æ—¶æ‰è¿›è¡Œåˆå§‹åŒ–ã€‚éœ€è¦é‡ç‚¹å…³å¿ƒçš„æ˜¯å¦‚ä½•ä¿è¯å¹¶å‘å®‰å…¨\n\t- é”\n\t- åŸå­æ“ä½œ\n\t- once\n```go\ntype single struct{}  \n  \nvar (  \n    instance *single  \n    mtx sync.RWMutex  \n    lock uint32  \n    once sync.Once  \n)  \n  \nfunc GetInstance() *single {  \n    // ä¿è¯å¹¶å‘å®‰å…¨ï¼šé”ã€åŸå­æ“ä½œã€once  \n    // åŸå­æ“ä½œ  \n    //if atomic.LoadUint32(&lock) == 1 {  \n    // return instance    //}    //mtx.Lock()    //defer mtx.Unlock()    //instance = new(single)    //return instance        // once  \n    once.Do(func() {  \n       instance = new(single)  \n    })  \n    return instance  \n}\n```\n## ç»“æ„å‹æ¨¡å¼\n\n### ä»£ç†æ¨¡å¼\n![image.png](https://raw.githubusercontent.com/lyydsheep/pic/main/202412182052160.png)\n\n**Subject**ï¼šå…·ä½“ä¸»é¢˜å’Œä»£ç†ä¸»é¢˜çš„å…¬å…±æ¥å£\n**RealSubject**ï¼šå…·ä½“ä¸»é¢˜\n**Proxy**ï¼šä»£ç†ä¸»é¢˜ï¼Œ**åŒ…å«äº†å¯¹å…·ä½“ä¸»é¢˜è§’è‰²çš„å¼•ç”¨**ï¼Œé€šå¸¸å¯ä»¥åœ¨ä»£ç†ä¸»é¢˜ä¸­å°è£…å…·ä½“ä¸»é¢˜éœ€è¦æ‰§è¡Œçš„ä¸€äº›æµç¨‹ï¼Œæé«˜ä»£ç å¤ç”¨æ€§\n\n```go\ntype D interface {  \n    Dance()  \n}  \n  \ntype KunDance struct {  \n}  \n  \nfunc (k *KunDance) Dance() {  \n    fmt.Println(\"KunDance\")  \n}  \n  \ntype KunKunDance struct{}  \n  \nfunc (k *KunKunDance) Dance() {}  \n  \ntype SingDanceRap struct {  \n    d D  \n}  \n  \nfunc (s *SingDanceRap) Dance() {  \n    s.Sing()  \n    // åŠ¨æ€è°ƒç”¨æŸä¸€ä¸ªDanceæ–¹æ³•  \n    s.d.Dance()  \n    s.Rap()  \n}  \n  \nfunc (s *SingDanceRap) Sing() {}  \n  \nfunc (s *SingDanceRap) Rap() {}  \n  \nfunc NewSingDanceRap(d D) D {  \n    return &SingDanceRap{  \n       d: d,  \n    }  \n}\n```\næ„Ÿè§‰æ ¸å¿ƒç‚¹åœ¨äºï¼Œå®ç°ä¸€ä¸ªå…¬å…±çš„æ¥å£ï¼Œå°è£…ä¸€äº›é‡å¤æ€§çš„ä»£ç ï¼Œæé«˜å¤ç”¨ğŸ¤”\n\n### è£…é¥°å™¨æ¨¡å¼\n\nè£…é¥°å™¨æ¨¡å¼å’Œä»£ç†æ¨¡å¼å¾ˆåƒï¼Œéƒ½æ˜¯åœ¨åŸæœ‰æ¥å£ä¸Šè¿›è¡ŒåŠŸèƒ½çš„æ‰©å±•ã€‚å…¸å‹çš„æ¨¡æ¿å°±æ˜¯**ç»“æ„ä½“ ç»„åˆ å¾…æ‰©å±•çš„æ¥å£**\n```go\ntype Phone interface {  \n    Show()  \n}  \n  \ntype Hua struct {  \n}  \n  \nfunc (h *Hua) Show() {  \n  \n}  \n  \ntype PhonePlus struct {  \n    Phone  \n}  \n  \nfunc (pp *PhonePlus) Show() {  \n  \n}  \n  \nfunc (pp *PhonePlus) AnotherMethod() {  \n  \n}\n```\n\n### é€‚é…å™¨æ¨¡å¼\n\né€‚é…å™¨æ¨¡å¼å¯ä»¥å®ç°ä¸€ä¸ªç±»æˆ–æ¥å£èƒ½å¤Ÿåœ¨ä¸€ä¸ªä¸ä¹‹æ¯«ä¸ç›¸å¹²çš„æ¥å£ç¯å¢ƒè¿è¡Œã€ä½œç”¨\n\n![image.png](https://raw.githubusercontent.com/lyydsheep/pic/main/202412202127687.png)\n\n```go\ntype V5 interface{  \n    Use5() }  \n  \ntype V220 interface{  \n    Use220()  \n}  \n  \ntype Adapter struct {  \n    v220 V220  \n}  \n  \nfunc (a *Adapter) Use5() {  \n    a.v220.Use220()  \n}  \n  \nfunc NewAdapter(v220 V220) *Adapter {  \n    return &Adapter{v220: v220}  \n}\n```\n\n### å¤–è§‚æ¨¡å¼\n\nå¤–è§‚æ¨¡å¼æœ¬è´¨ä¸Šå°±æ˜¯æ·»åŠ ä¸€ä¸ªä¸­é—´å±‚ï¼Œè¿™ä¸ªä¸­é—´å±‚å‘ä¸Šå±‚æä¾›äº†åº•å±‚APIçš„å°è£…ï¼Œé™ä½äº†ä¸šåŠ¡å±‚å’Œåº•å±‚çš„è€¦åˆ\n```go\ntype A struct {}  \n  \nfunc (a *A)work() {  \n    }  \n  \ntype T struct {  \n    a *A  \n}\n```\n\n## è¡Œä¸ºå‹æ¨¡å¼\n### æ¨¡æ¿æ–¹æ³•æ¨¡å¼\n\næ¨¡æ¿æ–¹æ³•æ¨¡å¼å¯ä»¥ç”¨äºç»Ÿä¸€æ¥å£æ–¹æ³•çš„æ“ä½œæ­¥éª¤ï¼Œå¿½è§†æ¯ä¸ªå®ä¾‹å¯¹äºæ–¹æ³•çš„å…·ä½“å®ç°\nï¼ˆGoç¡®å®ä¸é€‚åˆæŒ‰ç…§ä¸¥æ ¼çš„è®¾è®¡æ¨¡å¼ç±»å›¾è¿›è¡Œç¼–ç ï¼‰\n\n```go\ntype Work interface {  \n    Step1()  \n    Step2()  \n    Step3()  \n}  \n  \ntype WorkFlow interface {  \n    DoSomething()  \n}  \n  \ntype BasicWorkFlow struct {  \n    Work  \n}  \n  \nfunc (wf *BasicWorkFlow) DoSomething() {  \n    wf.Step1()  \n    wf.Step2()  \n    wf.Step3()  \n}\n```\n\n### å‘½ä»¤æ¨¡å¼\n\nå‘½ä»¤æ¨¡å¼æ˜¯åœ¨ä¸€ä¸ªåŠŸèƒ½ç±»ä¸Šæä¾›ç‰¹æ®Šçš„å‘½ä»¤ç±»ï¼Œç”¨äºåŒºåˆ†åŠŸèƒ½ç±»ä¸­çš„ç‰¹å®šåŠŸèƒ½ã€‚å‘ä¸šåŠ¡æ–¹å±è”½äº†åŠŸèƒ½ç±»çš„å…·ä½“ç»†èŠ‚ã€‚åœ¨å‘½ä»¤ç±»çš„åŸºç¡€ä¸Šç»„åˆå‡ºä¸€ä¸ªä¸­é—´ç±»ï¼Œä¸­é—´ç±»å‘ä¸šåŠ¡æ–¹æä¾›ç»Ÿä¸€çš„æ¥å£ï¼Œè¿›ä¸€æ­¥å±è”½äº†ä¸åŒå‘½ä»¤ä¹‹é—´çš„å·®å¼‚\n\n```go\ntype Doctor struct {}  \n  \nfunc (d *Doctor) treatEye() {  \n    }  \n  \ntype Cmd interface {  \n    Treat()  \n}  \n  \ntype Nurse struct {  \n    cmds []Cmd  \n}  \n  \nfunc (n *Nurse) Notify() {  \n    if n.cmds == nil {  \n       return  \n    }  \n    for i := range n.cmds {  \n       n.cmds[i].Treat()  \n    }  \n}  \n  \nfunc (d *Doctor) treatNose() {}  \n  \ntype cmdEye struct {  \n    d *Doctor  \n}  \n  \nfunc (c *cmdEye) Treat() {  \n    c.d.treatEye()  \n}  \n  \ntype cmdNose struct {  \n    d *Doctor  \n}\n```\n### ç­–ç•¥æ¨¡å¼\n\nä¸ºç¯å¢ƒç±»é…ç½®ä¸€ä¸ªæ¥å£ï¼Œé€šè¿‡è¿™ä¸ªæ¥å£ç”¨æˆ·å¯ä»¥è‡ªç”±åˆ‡æ¢åŠŸèƒ½ç›¸åŒä½†å®ç°ä¸åŒçš„ç®—æ³•\n\n![image.png](https://raw.githubusercontent.com/lyydsheep/pic/main/202412242041157.png)\n\n```go\ntype Strategy interface {  \n    UseWeapon()  \n}  \n  \ntype AK struct{}  \n  \nfunc (a *AK) UseWeapon() {  \n    fmt.Println(\"ak\")  \n}  \n  \ntype Knife struct{}  \n  \nfunc (k *Knife) UseWeapon() { fmt.Println(\"k\") }  \n  \ntype Person struct {  \n    s Strategy  \n}  \n  \nfunc (p *Person) SetStrategy(s Strategy) {  \n    p.s = s  \n}  \n  \nfunc (p *Person) Fight() {  \n    p.s.UseWeapon()  \n}\n\n```\n### è§‚å¯Ÿè€…æ¨¡å¼\n\nå¦‚æœç³»ç»Ÿéœ€è¦åˆ›å»ºä¸€ä¸ªè§¦å‘é“¾ï¼ŒAå¯¹è±¡çš„è¡Œä¸ºå½±å“Bå¯¹è±¡ï¼ŒBå¯¹è±¡çš„è¡Œä¸ºå½±å“Cå¯¹è±¡...ï¼Œå°±å¯ä»¥ä½¿ç”¨è§‚å¯Ÿè€…æ¨¡å¼åˆ›å»ºä¸€ç§é“¾å¼è§¦å‘æœºåˆ¶\n![image.png](https://raw.githubusercontent.com/lyydsheep/pic/main/202412242129694.png)\n\n```go\ntype Listener interface {  \n    OnTeacherComing()  \n}  \n  \ntype StuZ3 struct {  \n    badThing string  \n}  \n  \nfunc (s *StuZ3) OnTeacherComing() {  \n    fmt.Println(\"z3 stop\", s.badThing)  \n}  \n  \ntype StuZ4 struct {  \n    badThing string  \n}  \n  \nfunc (s *StuZ4) OnTeacherComing() {  \n    fmt.Println(\"z3 stop\", s.badThing)  \n}  \n  \ntype StuW5 struct {  \n    badThing string  \n}  \n  \nfunc (s *StuW5) OnTeacherComing() {  \n    fmt.Println(\"z3 stop\", s.badThing)  \n}  \n  \ntype Notifier interface {  \n    Add(l Listener)  \n    Del(l Listener)  \n    Notify()  \n}  \n  \ntype Monitor struct {  \n    listeners []Listener  \n}  \n  \nfunc (m *Monitor) Add(l Listener) {  \n    if m.listeners != nil {  \n       m.listeners = append(m.listeners, l)  \n    }  \n}  \n  \nfunc (m *Monitor) Del(l Listener) {  \n    //TODO implement me  \n    panic(\"implement me\")  \n}  \n  \nfunc (m *Monitor) Notify() {  \n    for i := range m.listeners {  \n       m.listeners[i].OnTeacherComing()  \n    }  \n}\n```\n","source":"_posts/è®¾è®¡æ¨¡å¼.md","raw":"---\ndate: 2024-12-15\n---\n\n# è®¾è®¡æ¨¡å¼\n\n> è¿™æ˜¯[Easyæå®šGolangè®¾è®¡æ¨¡å¼](https://www.bilibili.com/video/BV1Eg411m7rV/?spm_id_from=333.1387.collection.video_card.click&vd_source=a15269894d9b8114cb5f9bb663d22be9)çš„å­¦ä¹ è®°å½•\n\n## é¢å‘å¯¹è±¡è®¾è®¡åŸåˆ™\n\n### å•ä¸€èŒè´£åŸåˆ™\n\nç±»çš„èŒè´£å•ä¸€ï¼Œå¯¹å¤–åªæä¾›ä¸€ç§åŠŸèƒ½ï¼Œè€Œå¼•èµ·ç±»çš„å˜åŒ–çš„åŸå› é€šå¸¸åªæœ‰ä¸€ä¸ªã€‚è¿™æ˜¯ä¸ºäº†é¿å…åˆ«äººçœ‹ä»£ç æ—¶äº§ç”Ÿæ­§ä¹‰ï¼Œæé«˜ä»£ç çš„é€»è¾‘æ€§\n\nè®¾è®¡ä¸€ä¸ªç±»ï¼Œå¯¹å¤–æä¾›çš„åŠŸèƒ½åº”è¯¥å•ä¸€ï¼Œæ¥å£å•ä¸€ï¼Œä»…æœ‰è¿™ä¸ªæ¥å£ä¼šå½±å“è¿™ä¸ªç±»ã€‚ä¸€ä¸ªç±»çš„ä¸€ä¸ªæ¥å£åº”å…·å¤‡è¿™ä¸ªç±»çš„åŠŸèƒ½å«ä¹‰ï¼ŒèŒè´£å•ä¸€å¹¶ä¸”ä¸å¤æ‚\n\n### å¼€é—­åŸåˆ™\n\n> å¯¹æ‰©å±•å¼€æ”¾ï¼Œå¯¹ä¿®æ”¹å…³é—­\n\nå¦‚æœæˆ‘ä»¬æƒ³ä¸ºæŸä¸ªç±»å¢æ·»æ–°çš„åŠŸèƒ½ï¼Œæœ€å¥½çš„æ–¹æ³•æ˜¯åŸºäºæ¥å£æˆ–è€…ç»„åˆçš„æ–¹å¼å¯¹å…¶è¿›è¡Œæ‰©å±•ï¼Œè€Œä¸æ˜¯åœ¨åŸæœ‰çš„ç±»ä»£ç ä¸Šè¿›è¡Œä¿®æ”¹ã€‚æ¯”å¦‚ä¸€ä¸ªç±»å·²ç»æœ‰äº†99ä¸ªæ–¹æ³•ï¼Œé‚£ä¹ˆå¢æ·»ç¬¬100ä¸ªæ–¹æ³•æ—¶å°±å¾ˆæœ‰å¯èƒ½å¯¼è‡´å‰é¢99ä¸ªæ–¹æ³•æ— æ³•æ­£å¸¸å·¥ä½œï¼ˆæ¯•ç«Ÿè°çŸ¥é“é‚£99ä¸ªæ–¹æ³•ç”¨äº†ä»€ä¹ˆå¥‡æŠ€æ·«å·§ï¼‰\n\næ‰€ä»¥å¼€é—­åŸåˆ™çš„æ ¸å¿ƒæ€æƒ³å°±æ˜¯ï¼šä¸æ˜¯é€šè¿‡ä¿®æ”¹ä»£ç ,è€Œæ˜¯é€šè¿‡å¢æ·»ä»£ç æ¥ç»™ç³»ç»Ÿæ·»åŠ åŠŸèƒ½\n\n### ä¾èµ–å€’è½¬åŸåˆ™ï¼ˆé‡è¦ï¼‰\n\næ„Ÿè§‰ä¾èµ–å€’è½¬åŸåˆ™çš„æ ¸å¿ƒå°±æ˜¯**é¢å‘æ¥å£ç¼–ç¨‹**\n<img src=\"https://raw.githubusercontent.com/lyydsheep/pic/main/202412121814145.png\" />\n\né¦–å…ˆéœ€è¦åšå¥½ä¸­é—´æŠ½è±¡å±‚çš„è®¾è®¡ï¼Œç„¶åä¾ç…§è¿™æŠ½è±¡å±‚ä¸€æ¬¡å°†å®ç°å±‚çš„æ¯ä¸€ä¸ªæ¨¡å—è¿›è¡Œå®ç°ã€‚è¿™ä¸€æ­¥æç°äº†å®ç°å±‚**å‘ä¸Šä¾èµ–æŠ½è±¡å±‚**\nå¦ä¸€æ–¹é¢ï¼ŒæŠ½è±¡å±‚å‘ä¸šåŠ¡é€»è¾‘å±‚æš´éœ²å‡ºåŠŸèƒ½çš„æ¥å£ï¼Œä¸šåŠ¡é€»è¾‘å±‚åªéœ€è¦æ ¹æ®æš´éœ²å‡ºæ¥çš„æ¥å£å®ç°å¯¹ä¹Ÿçš„ä¸šåŠ¡é€»è¾‘å³å¯ï¼Œæ— éœ€å…³ç³»åŠŸèƒ½å…·ä½“æ˜¯å¦‚ä½•å®ç°\n\n### åˆæˆå¤ç”¨åŸåˆ™\n\nå¦‚æœä½¿ç”¨ç»§æ‰¿ï¼Œä¼šå¯¼è‡´çˆ¶ç±»çš„ä»»ä½•å˜æ¢éƒ½å¯èƒ½å½±å“åˆ°å­ç±»çš„è¡Œä¸ºã€‚å¦‚æœä½¿ç”¨ç»„åˆï¼Œå°±å¤§å¤§é™ä½äº†è¿™ç§ä¾èµ–å…³ç³»ã€‚å¯¹äºç»„åˆå’Œç»§æ‰¿ï¼Œä¼˜å…ˆä½¿ç”¨ç»„åˆã€‚ï¼ˆGoå¤©ç„¶å®ç°ç»„åˆğŸ˜‚ï¼‰\næ¯”å¦‚çˆ¶ç±»æœ‰100ä¸ªæ–¹æ³•ï¼Œè€Œå­ç±»åªæƒ³ä½¿ç”¨å…¶ä¸­çš„æŸä¸€ä¸ªæ–¹æ³•ï¼Œé‚£ä¹ˆå­ç±»é‡‡ç”¨ç»„åˆçš„æ–¹å¼å°±èƒ½å±è”½æ‰çˆ¶ç±»çš„å…¶ä»–99ä¸ªæ–¹æ³•\n\n### è¿ªç±³ç‰¹æ³•åˆ™\n\nä¸€ä¸ªå¯¹è±¡åº”å½“å¯¹å…¶ä»–å¯¹è±¡å°½å¯èƒ½äº†è§£å¾—å°‘ï¼Œä»è€Œé™ä½å„ä¸ªå¯¹è±¡ä¹‹é—´çš„è€¦åˆï¼Œæé«˜ç³»ç»Ÿçš„å¯ç»´æŠ¤æ€§ã€‚\n\n## åˆ›å»ºå‹æ¨¡å¼\n### ç®€å•å·¥å‚æ¨¡å¼\n\n**ä¸šåŠ¡é€»è¾‘å±‚ --->  å·¥å‚æ¨¡å— ---> åŸºç¡€ç±»æ¨¡å—**\n\nåä¾‹ï¼šä¸šåŠ¡é€»è¾‘å±‚ ---> åŸºç¡€ç±»æ¨¡å—\n```go\ntype Fruit struct {  \n}  \n  \nfunc (f *Fruit) Name() {  \n    }  \n  \nfunc NewFruit(name string) *Fruit {  \n    res := &Fruit{}  \n    switch {  \n    case name == \"apple\":  \n       // do something  \n    case name == \"pear\":  \n       // do something  \n    default:  \n       // do something  \n    }  \n    return res  \n}  \n  \nfunc main() {  \n    apple := NewFruit(\"apple\")  \n    apple.Name()  \n    pear := NewFruit(\"pear\")  \n    pear.Name()  \n}\n```\nç®€å•å·¥å‚æ¨¡å¼å®ç°ä»£ç ï¼š\n```go\ntype Fruit interface {  \n    Show()  \n}  \n  \ntype Apple struct {  \n}  \n  \nfunc (a *Apple) Show() {  \n}  \n  \ntype Pear struct{  \n}  \n  \nfunc (p *Pear) Show() {  \n}  \n  \ntype Banana struct{  \n}  \n  \nfunc (b *Banana) Show() {  \n}  \n  \ntype Factory struct{}  \n  \nfunc (f *Factory) CreateFruit(name string) (Fruit, bool) {  \n    var fruit Fruit  \n    ok := false  \n    switch {  \n    case name == \"apple\":  \n       fruit, ok = new(Apple), true  \n    case name == \"pear\":  \n       fruit, ok = new(Pear), true  \n    case name == \"banana\":  \n       fruit, ok = new(Banana), true  \n    }  \n    return fruit, ok  \n}  \n  \n\n```\n\n![image.png](https://raw.githubusercontent.com/lyydsheep/pic/main/202412151724598.png)\n\n**ä¼˜ç‚¹**ï¼š\n1. å®ç°äº†å¯¹è±¡åˆ›å»ºå’Œä½¿ç”¨çš„åˆ†ç¦»\n**ç¼ºç‚¹**ï¼š\n1. è¿æ³•â€œå¼€é—­åŸåˆ™â€\n2. å·¥å‚ç±»èŒè´£è¿‡é‡ï¼Œä¸€æ—¦ä¸èƒ½å·¥ä½œï¼Œç³»ç»Ÿæ·±å—å½±å“\n3. å¤æ‚åº¦å’Œç†è§£åº¦éšç€ç±»çš„ä¸ªæ•°å¢åŠ \n\n### å·¥å‚æ¨¡å¼\n\nå·¥å‚æ¨¡å¼å°±æ˜¯â€œç®€å•å·¥å‚æ¨¡å¼ + å¼€é—­åŸåˆ™â€\nåœ¨Goé‡Œé¢ï¼Œå®ç°å·¥å‚æ¨¡å¼æ¯”è¾ƒå¸¸è§çš„å†™æ³•å°±æ˜¯`Newxxx()`\n```go\nfunc NewFactory() *Factory {  \n    return &Factory{}  \n}\n```\n### å•ä¾‹æ¨¡å¼\n\n> ä¿è¯ä¸€ä¸ªç±»æ°¸è¿œåªèƒ½æœ‰ä¸€ä¸ªå¯¹è±¡ï¼Œä¸”è¯¥å¯¹è±¡çš„åŠŸèƒ½ä¾ç„¶èƒ½è¢«å…¶ä»–æ¨¡å—ä½¿ç”¨\n\n**é¥¿æ±‰å¼**ï¼š\n```go\ntype single struct{}  \n  \nvar instance = new(single)  \n  \nfunc (s *single) Show() {  \n    // do something  \n}  \n  \nfunc GetInstance() *single {  \n    return instance  \n}\n```\n**æ‡’æ±‰å¼**ï¼šå»¶è¿Ÿåˆå§‹åŒ–ï¼Œç›´åˆ°è°ƒç”¨GetInstanceæ–¹æ³•æ—¶æ‰è¿›è¡Œåˆå§‹åŒ–ã€‚éœ€è¦é‡ç‚¹å…³å¿ƒçš„æ˜¯å¦‚ä½•ä¿è¯å¹¶å‘å®‰å…¨\n\t- é”\n\t- åŸå­æ“ä½œ\n\t- once\n```go\ntype single struct{}  \n  \nvar (  \n    instance *single  \n    mtx sync.RWMutex  \n    lock uint32  \n    once sync.Once  \n)  \n  \nfunc GetInstance() *single {  \n    // ä¿è¯å¹¶å‘å®‰å…¨ï¼šé”ã€åŸå­æ“ä½œã€once  \n    // åŸå­æ“ä½œ  \n    //if atomic.LoadUint32(&lock) == 1 {  \n    // return instance    //}    //mtx.Lock()    //defer mtx.Unlock()    //instance = new(single)    //return instance        // once  \n    once.Do(func() {  \n       instance = new(single)  \n    })  \n    return instance  \n}\n```\n## ç»“æ„å‹æ¨¡å¼\n\n### ä»£ç†æ¨¡å¼\n![image.png](https://raw.githubusercontent.com/lyydsheep/pic/main/202412182052160.png)\n\n**Subject**ï¼šå…·ä½“ä¸»é¢˜å’Œä»£ç†ä¸»é¢˜çš„å…¬å…±æ¥å£\n**RealSubject**ï¼šå…·ä½“ä¸»é¢˜\n**Proxy**ï¼šä»£ç†ä¸»é¢˜ï¼Œ**åŒ…å«äº†å¯¹å…·ä½“ä¸»é¢˜è§’è‰²çš„å¼•ç”¨**ï¼Œé€šå¸¸å¯ä»¥åœ¨ä»£ç†ä¸»é¢˜ä¸­å°è£…å…·ä½“ä¸»é¢˜éœ€è¦æ‰§è¡Œçš„ä¸€äº›æµç¨‹ï¼Œæé«˜ä»£ç å¤ç”¨æ€§\n\n```go\ntype D interface {  \n    Dance()  \n}  \n  \ntype KunDance struct {  \n}  \n  \nfunc (k *KunDance) Dance() {  \n    fmt.Println(\"KunDance\")  \n}  \n  \ntype KunKunDance struct{}  \n  \nfunc (k *KunKunDance) Dance() {}  \n  \ntype SingDanceRap struct {  \n    d D  \n}  \n  \nfunc (s *SingDanceRap) Dance() {  \n    s.Sing()  \n    // åŠ¨æ€è°ƒç”¨æŸä¸€ä¸ªDanceæ–¹æ³•  \n    s.d.Dance()  \n    s.Rap()  \n}  \n  \nfunc (s *SingDanceRap) Sing() {}  \n  \nfunc (s *SingDanceRap) Rap() {}  \n  \nfunc NewSingDanceRap(d D) D {  \n    return &SingDanceRap{  \n       d: d,  \n    }  \n}\n```\næ„Ÿè§‰æ ¸å¿ƒç‚¹åœ¨äºï¼Œå®ç°ä¸€ä¸ªå…¬å…±çš„æ¥å£ï¼Œå°è£…ä¸€äº›é‡å¤æ€§çš„ä»£ç ï¼Œæé«˜å¤ç”¨ğŸ¤”\n\n### è£…é¥°å™¨æ¨¡å¼\n\nè£…é¥°å™¨æ¨¡å¼å’Œä»£ç†æ¨¡å¼å¾ˆåƒï¼Œéƒ½æ˜¯åœ¨åŸæœ‰æ¥å£ä¸Šè¿›è¡ŒåŠŸèƒ½çš„æ‰©å±•ã€‚å…¸å‹çš„æ¨¡æ¿å°±æ˜¯**ç»“æ„ä½“ ç»„åˆ å¾…æ‰©å±•çš„æ¥å£**\n```go\ntype Phone interface {  \n    Show()  \n}  \n  \ntype Hua struct {  \n}  \n  \nfunc (h *Hua) Show() {  \n  \n}  \n  \ntype PhonePlus struct {  \n    Phone  \n}  \n  \nfunc (pp *PhonePlus) Show() {  \n  \n}  \n  \nfunc (pp *PhonePlus) AnotherMethod() {  \n  \n}\n```\n\n### é€‚é…å™¨æ¨¡å¼\n\né€‚é…å™¨æ¨¡å¼å¯ä»¥å®ç°ä¸€ä¸ªç±»æˆ–æ¥å£èƒ½å¤Ÿåœ¨ä¸€ä¸ªä¸ä¹‹æ¯«ä¸ç›¸å¹²çš„æ¥å£ç¯å¢ƒè¿è¡Œã€ä½œç”¨\n\n![image.png](https://raw.githubusercontent.com/lyydsheep/pic/main/202412202127687.png)\n\n```go\ntype V5 interface{  \n    Use5() }  \n  \ntype V220 interface{  \n    Use220()  \n}  \n  \ntype Adapter struct {  \n    v220 V220  \n}  \n  \nfunc (a *Adapter) Use5() {  \n    a.v220.Use220()  \n}  \n  \nfunc NewAdapter(v220 V220) *Adapter {  \n    return &Adapter{v220: v220}  \n}\n```\n\n### å¤–è§‚æ¨¡å¼\n\nå¤–è§‚æ¨¡å¼æœ¬è´¨ä¸Šå°±æ˜¯æ·»åŠ ä¸€ä¸ªä¸­é—´å±‚ï¼Œè¿™ä¸ªä¸­é—´å±‚å‘ä¸Šå±‚æä¾›äº†åº•å±‚APIçš„å°è£…ï¼Œé™ä½äº†ä¸šåŠ¡å±‚å’Œåº•å±‚çš„è€¦åˆ\n```go\ntype A struct {}  \n  \nfunc (a *A)work() {  \n    }  \n  \ntype T struct {  \n    a *A  \n}\n```\n\n## è¡Œä¸ºå‹æ¨¡å¼\n### æ¨¡æ¿æ–¹æ³•æ¨¡å¼\n\næ¨¡æ¿æ–¹æ³•æ¨¡å¼å¯ä»¥ç”¨äºç»Ÿä¸€æ¥å£æ–¹æ³•çš„æ“ä½œæ­¥éª¤ï¼Œå¿½è§†æ¯ä¸ªå®ä¾‹å¯¹äºæ–¹æ³•çš„å…·ä½“å®ç°\nï¼ˆGoç¡®å®ä¸é€‚åˆæŒ‰ç…§ä¸¥æ ¼çš„è®¾è®¡æ¨¡å¼ç±»å›¾è¿›è¡Œç¼–ç ï¼‰\n\n```go\ntype Work interface {  \n    Step1()  \n    Step2()  \n    Step3()  \n}  \n  \ntype WorkFlow interface {  \n    DoSomething()  \n}  \n  \ntype BasicWorkFlow struct {  \n    Work  \n}  \n  \nfunc (wf *BasicWorkFlow) DoSomething() {  \n    wf.Step1()  \n    wf.Step2()  \n    wf.Step3()  \n}\n```\n\n### å‘½ä»¤æ¨¡å¼\n\nå‘½ä»¤æ¨¡å¼æ˜¯åœ¨ä¸€ä¸ªåŠŸèƒ½ç±»ä¸Šæä¾›ç‰¹æ®Šçš„å‘½ä»¤ç±»ï¼Œç”¨äºåŒºåˆ†åŠŸèƒ½ç±»ä¸­çš„ç‰¹å®šåŠŸèƒ½ã€‚å‘ä¸šåŠ¡æ–¹å±è”½äº†åŠŸèƒ½ç±»çš„å…·ä½“ç»†èŠ‚ã€‚åœ¨å‘½ä»¤ç±»çš„åŸºç¡€ä¸Šç»„åˆå‡ºä¸€ä¸ªä¸­é—´ç±»ï¼Œä¸­é—´ç±»å‘ä¸šåŠ¡æ–¹æä¾›ç»Ÿä¸€çš„æ¥å£ï¼Œè¿›ä¸€æ­¥å±è”½äº†ä¸åŒå‘½ä»¤ä¹‹é—´çš„å·®å¼‚\n\n```go\ntype Doctor struct {}  \n  \nfunc (d *Doctor) treatEye() {  \n    }  \n  \ntype Cmd interface {  \n    Treat()  \n}  \n  \ntype Nurse struct {  \n    cmds []Cmd  \n}  \n  \nfunc (n *Nurse) Notify() {  \n    if n.cmds == nil {  \n       return  \n    }  \n    for i := range n.cmds {  \n       n.cmds[i].Treat()  \n    }  \n}  \n  \nfunc (d *Doctor) treatNose() {}  \n  \ntype cmdEye struct {  \n    d *Doctor  \n}  \n  \nfunc (c *cmdEye) Treat() {  \n    c.d.treatEye()  \n}  \n  \ntype cmdNose struct {  \n    d *Doctor  \n}\n```\n### ç­–ç•¥æ¨¡å¼\n\nä¸ºç¯å¢ƒç±»é…ç½®ä¸€ä¸ªæ¥å£ï¼Œé€šè¿‡è¿™ä¸ªæ¥å£ç”¨æˆ·å¯ä»¥è‡ªç”±åˆ‡æ¢åŠŸèƒ½ç›¸åŒä½†å®ç°ä¸åŒçš„ç®—æ³•\n\n![image.png](https://raw.githubusercontent.com/lyydsheep/pic/main/202412242041157.png)\n\n```go\ntype Strategy interface {  \n    UseWeapon()  \n}  \n  \ntype AK struct{}  \n  \nfunc (a *AK) UseWeapon() {  \n    fmt.Println(\"ak\")  \n}  \n  \ntype Knife struct{}  \n  \nfunc (k *Knife) UseWeapon() { fmt.Println(\"k\") }  \n  \ntype Person struct {  \n    s Strategy  \n}  \n  \nfunc (p *Person) SetStrategy(s Strategy) {  \n    p.s = s  \n}  \n  \nfunc (p *Person) Fight() {  \n    p.s.UseWeapon()  \n}\n\n```\n### è§‚å¯Ÿè€…æ¨¡å¼\n\nå¦‚æœç³»ç»Ÿéœ€è¦åˆ›å»ºä¸€ä¸ªè§¦å‘é“¾ï¼ŒAå¯¹è±¡çš„è¡Œä¸ºå½±å“Bå¯¹è±¡ï¼ŒBå¯¹è±¡çš„è¡Œä¸ºå½±å“Cå¯¹è±¡...ï¼Œå°±å¯ä»¥ä½¿ç”¨è§‚å¯Ÿè€…æ¨¡å¼åˆ›å»ºä¸€ç§é“¾å¼è§¦å‘æœºåˆ¶\n![image.png](https://raw.githubusercontent.com/lyydsheep/pic/main/202412242129694.png)\n\n```go\ntype Listener interface {  \n    OnTeacherComing()  \n}  \n  \ntype StuZ3 struct {  \n    badThing string  \n}  \n  \nfunc (s *StuZ3) OnTeacherComing() {  \n    fmt.Println(\"z3 stop\", s.badThing)  \n}  \n  \ntype StuZ4 struct {  \n    badThing string  \n}  \n  \nfunc (s *StuZ4) OnTeacherComing() {  \n    fmt.Println(\"z3 stop\", s.badThing)  \n}  \n  \ntype StuW5 struct {  \n    badThing string  \n}  \n  \nfunc (s *StuW5) OnTeacherComing() {  \n    fmt.Println(\"z3 stop\", s.badThing)  \n}  \n  \ntype Notifier interface {  \n    Add(l Listener)  \n    Del(l Listener)  \n    Notify()  \n}  \n  \ntype Monitor struct {  \n    listeners []Listener  \n}  \n  \nfunc (m *Monitor) Add(l Listener) {  \n    if m.listeners != nil {  \n       m.listeners = append(m.listeners, l)  \n    }  \n}  \n  \nfunc (m *Monitor) Del(l Listener) {  \n    //TODO implement me  \n    panic(\"implement me\")  \n}  \n  \nfunc (m *Monitor) Notify() {  \n    for i := range m.listeners {  \n       m.listeners[i].OnTeacherComing()  \n    }  \n}\n```\n","slug":"è®¾è®¡æ¨¡å¼","published":1,"updated":"2024-12-27T11:31:47.220Z","title":"","comments":1,"layout":"post","photos":[],"_id":"cm6c7md6l001ga5t2foln64hw","content":"<h1 id=\"è®¾è®¡æ¨¡å¼\"><a href=\"#è®¾è®¡æ¨¡å¼\" class=\"headerlink\" title=\"è®¾è®¡æ¨¡å¼\"></a>è®¾è®¡æ¨¡å¼</h1><blockquote>\n<p>è¿™æ˜¯<a href=\"https://www.bilibili.com/video/BV1Eg411m7rV/?spm_id_from=333.1387.collection.video_card.click&vd_source=a15269894d9b8114cb5f9bb663d22be9\">Easyæå®šGolangè®¾è®¡æ¨¡å¼</a>çš„å­¦ä¹ è®°å½•</p>\n</blockquote>\n<h2 id=\"é¢å‘å¯¹è±¡è®¾è®¡åŸåˆ™\"><a href=\"#é¢å‘å¯¹è±¡è®¾è®¡åŸåˆ™\" class=\"headerlink\" title=\"é¢å‘å¯¹è±¡è®¾è®¡åŸåˆ™\"></a>é¢å‘å¯¹è±¡è®¾è®¡åŸåˆ™</h2><h3 id=\"å•ä¸€èŒè´£åŸåˆ™\"><a href=\"#å•ä¸€èŒè´£åŸåˆ™\" class=\"headerlink\" title=\"å•ä¸€èŒè´£åŸåˆ™\"></a>å•ä¸€èŒè´£åŸåˆ™</h3><p>ç±»çš„èŒè´£å•ä¸€ï¼Œå¯¹å¤–åªæä¾›ä¸€ç§åŠŸèƒ½ï¼Œè€Œå¼•èµ·ç±»çš„å˜åŒ–çš„åŸå› é€šå¸¸åªæœ‰ä¸€ä¸ªã€‚è¿™æ˜¯ä¸ºäº†é¿å…åˆ«äººçœ‹ä»£ç æ—¶äº§ç”Ÿæ­§ä¹‰ï¼Œæé«˜ä»£ç çš„é€»è¾‘æ€§</p>\n<p>è®¾è®¡ä¸€ä¸ªç±»ï¼Œå¯¹å¤–æä¾›çš„åŠŸèƒ½åº”è¯¥å•ä¸€ï¼Œæ¥å£å•ä¸€ï¼Œä»…æœ‰è¿™ä¸ªæ¥å£ä¼šå½±å“è¿™ä¸ªç±»ã€‚ä¸€ä¸ªç±»çš„ä¸€ä¸ªæ¥å£åº”å…·å¤‡è¿™ä¸ªç±»çš„åŠŸèƒ½å«ä¹‰ï¼ŒèŒè´£å•ä¸€å¹¶ä¸”ä¸å¤æ‚</p>\n<h3 id=\"å¼€é—­åŸåˆ™\"><a href=\"#å¼€é—­åŸåˆ™\" class=\"headerlink\" title=\"å¼€é—­åŸåˆ™\"></a>å¼€é—­åŸåˆ™</h3><blockquote>\n<p>å¯¹æ‰©å±•å¼€æ”¾ï¼Œå¯¹ä¿®æ”¹å…³é—­</p>\n</blockquote>\n<p>å¦‚æœæˆ‘ä»¬æƒ³ä¸ºæŸä¸ªç±»å¢æ·»æ–°çš„åŠŸèƒ½ï¼Œæœ€å¥½çš„æ–¹æ³•æ˜¯åŸºäºæ¥å£æˆ–è€…ç»„åˆçš„æ–¹å¼å¯¹å…¶è¿›è¡Œæ‰©å±•ï¼Œè€Œä¸æ˜¯åœ¨åŸæœ‰çš„ç±»ä»£ç ä¸Šè¿›è¡Œä¿®æ”¹ã€‚æ¯”å¦‚ä¸€ä¸ªç±»å·²ç»æœ‰äº†99ä¸ªæ–¹æ³•ï¼Œé‚£ä¹ˆå¢æ·»ç¬¬100ä¸ªæ–¹æ³•æ—¶å°±å¾ˆæœ‰å¯èƒ½å¯¼è‡´å‰é¢99ä¸ªæ–¹æ³•æ— æ³•æ­£å¸¸å·¥ä½œï¼ˆæ¯•ç«Ÿè°çŸ¥é“é‚£99ä¸ªæ–¹æ³•ç”¨äº†ä»€ä¹ˆå¥‡æŠ€æ·«å·§ï¼‰</p>\n<p>æ‰€ä»¥å¼€é—­åŸåˆ™çš„æ ¸å¿ƒæ€æƒ³å°±æ˜¯ï¼šä¸æ˜¯é€šè¿‡ä¿®æ”¹ä»£ç ,è€Œæ˜¯é€šè¿‡å¢æ·»ä»£ç æ¥ç»™ç³»ç»Ÿæ·»åŠ åŠŸèƒ½</p>\n<h3 id=\"ä¾èµ–å€’è½¬åŸåˆ™ï¼ˆé‡è¦ï¼‰\"><a href=\"#ä¾èµ–å€’è½¬åŸåˆ™ï¼ˆé‡è¦ï¼‰\" class=\"headerlink\" title=\"ä¾èµ–å€’è½¬åŸåˆ™ï¼ˆé‡è¦ï¼‰\"></a>ä¾èµ–å€’è½¬åŸåˆ™ï¼ˆé‡è¦ï¼‰</h3><p>æ„Ÿè§‰ä¾èµ–å€’è½¬åŸåˆ™çš„æ ¸å¿ƒå°±æ˜¯<strong>é¢å‘æ¥å£ç¼–ç¨‹</strong><br><img src=\"https://raw.githubusercontent.com/lyydsheep/pic/main/202412121814145.png\" /></p>\n<p>é¦–å…ˆéœ€è¦åšå¥½ä¸­é—´æŠ½è±¡å±‚çš„è®¾è®¡ï¼Œç„¶åä¾ç…§è¿™æŠ½è±¡å±‚ä¸€æ¬¡å°†å®ç°å±‚çš„æ¯ä¸€ä¸ªæ¨¡å—è¿›è¡Œå®ç°ã€‚è¿™ä¸€æ­¥æç°äº†å®ç°å±‚<strong>å‘ä¸Šä¾èµ–æŠ½è±¡å±‚</strong><br>å¦ä¸€æ–¹é¢ï¼ŒæŠ½è±¡å±‚å‘ä¸šåŠ¡é€»è¾‘å±‚æš´éœ²å‡ºåŠŸèƒ½çš„æ¥å£ï¼Œä¸šåŠ¡é€»è¾‘å±‚åªéœ€è¦æ ¹æ®æš´éœ²å‡ºæ¥çš„æ¥å£å®ç°å¯¹ä¹Ÿçš„ä¸šåŠ¡é€»è¾‘å³å¯ï¼Œæ— éœ€å…³ç³»åŠŸèƒ½å…·ä½“æ˜¯å¦‚ä½•å®ç°</p>\n<h3 id=\"åˆæˆå¤ç”¨åŸåˆ™\"><a href=\"#åˆæˆå¤ç”¨åŸåˆ™\" class=\"headerlink\" title=\"åˆæˆå¤ç”¨åŸåˆ™\"></a>åˆæˆå¤ç”¨åŸåˆ™</h3><p>å¦‚æœä½¿ç”¨ç»§æ‰¿ï¼Œä¼šå¯¼è‡´çˆ¶ç±»çš„ä»»ä½•å˜æ¢éƒ½å¯èƒ½å½±å“åˆ°å­ç±»çš„è¡Œä¸ºã€‚å¦‚æœä½¿ç”¨ç»„åˆï¼Œå°±å¤§å¤§é™ä½äº†è¿™ç§ä¾èµ–å…³ç³»ã€‚å¯¹äºç»„åˆå’Œç»§æ‰¿ï¼Œä¼˜å…ˆä½¿ç”¨ç»„åˆã€‚ï¼ˆGoå¤©ç„¶å®ç°ç»„åˆğŸ˜‚ï¼‰<br>æ¯”å¦‚çˆ¶ç±»æœ‰100ä¸ªæ–¹æ³•ï¼Œè€Œå­ç±»åªæƒ³ä½¿ç”¨å…¶ä¸­çš„æŸä¸€ä¸ªæ–¹æ³•ï¼Œé‚£ä¹ˆå­ç±»é‡‡ç”¨ç»„åˆçš„æ–¹å¼å°±èƒ½å±è”½æ‰çˆ¶ç±»çš„å…¶ä»–99ä¸ªæ–¹æ³•</p>\n<h3 id=\"è¿ªç±³ç‰¹æ³•åˆ™\"><a href=\"#è¿ªç±³ç‰¹æ³•åˆ™\" class=\"headerlink\" title=\"è¿ªç±³ç‰¹æ³•åˆ™\"></a>è¿ªç±³ç‰¹æ³•åˆ™</h3><p>ä¸€ä¸ªå¯¹è±¡åº”å½“å¯¹å…¶ä»–å¯¹è±¡å°½å¯èƒ½äº†è§£å¾—å°‘ï¼Œä»è€Œé™ä½å„ä¸ªå¯¹è±¡ä¹‹é—´çš„è€¦åˆï¼Œæé«˜ç³»ç»Ÿçš„å¯ç»´æŠ¤æ€§ã€‚</p>\n<h2 id=\"åˆ›å»ºå‹æ¨¡å¼\"><a href=\"#åˆ›å»ºå‹æ¨¡å¼\" class=\"headerlink\" title=\"åˆ›å»ºå‹æ¨¡å¼\"></a>åˆ›å»ºå‹æ¨¡å¼</h2><h3 id=\"ç®€å•å·¥å‚æ¨¡å¼\"><a href=\"#ç®€å•å·¥å‚æ¨¡å¼\" class=\"headerlink\" title=\"ç®€å•å·¥å‚æ¨¡å¼\"></a>ç®€å•å·¥å‚æ¨¡å¼</h3><p><strong>ä¸šåŠ¡é€»è¾‘å±‚ â€”&gt;  å·¥å‚æ¨¡å— â€”&gt; åŸºç¡€ç±»æ¨¡å—</strong></p>\n<p>åä¾‹ï¼šä¸šåŠ¡é€»è¾‘å±‚ â€”&gt; åŸºç¡€ç±»æ¨¡å—</p>\n<figure class=\"highlight go\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">type</span> Fruit <span class=\"keyword\">struct</span> &#123;  </span><br><span class=\"line\">&#125;  </span><br><span class=\"line\">  </span><br><span class=\"line\"><span class=\"function\"><span class=\"keyword\">func</span> <span class=\"params\">(f *Fruit)</span></span> Name() &#123;  </span><br><span class=\"line\">    &#125;  </span><br><span class=\"line\">  </span><br><span class=\"line\"><span class=\"function\"><span class=\"keyword\">func</span> <span class=\"title\">NewFruit</span><span class=\"params\">(name <span class=\"type\">string</span>)</span></span> *Fruit &#123;  </span><br><span class=\"line\">    res := &amp;Fruit&#123;&#125;  </span><br><span class=\"line\">    <span class=\"keyword\">switch</span> &#123;  </span><br><span class=\"line\">    <span class=\"keyword\">case</span> name == <span class=\"string\">&quot;apple&quot;</span>:  </span><br><span class=\"line\">       <span class=\"comment\">// do something  </span></span><br><span class=\"line\">    <span class=\"keyword\">case</span> name == <span class=\"string\">&quot;pear&quot;</span>:  </span><br><span class=\"line\">       <span class=\"comment\">// do something  </span></span><br><span class=\"line\">    <span class=\"keyword\">default</span>:  </span><br><span class=\"line\">       <span class=\"comment\">// do something  </span></span><br><span class=\"line\">    &#125;  </span><br><span class=\"line\">    <span class=\"keyword\">return</span> res  </span><br><span class=\"line\">&#125;  </span><br><span class=\"line\">  </span><br><span class=\"line\"><span class=\"function\"><span class=\"keyword\">func</span> <span class=\"title\">main</span><span class=\"params\">()</span></span> &#123;  </span><br><span class=\"line\">    apple := NewFruit(<span class=\"string\">&quot;apple&quot;</span>)  </span><br><span class=\"line\">    apple.Name()  </span><br><span class=\"line\">    pear := NewFruit(<span class=\"string\">&quot;pear&quot;</span>)  </span><br><span class=\"line\">    pear.Name()  </span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n<p>ç®€å•å·¥å‚æ¨¡å¼å®ç°ä»£ç ï¼š</p>\n<figure class=\"highlight go\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br><span class=\"line\">31</span><br><span class=\"line\">32</span><br><span class=\"line\">33</span><br><span class=\"line\">34</span><br><span class=\"line\">35</span><br><span class=\"line\">36</span><br><span class=\"line\">37</span><br><span class=\"line\">38</span><br><span class=\"line\">39</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">type</span> Fruit <span class=\"keyword\">interface</span> &#123;  </span><br><span class=\"line\">    Show()  </span><br><span class=\"line\">&#125;  </span><br><span class=\"line\">  </span><br><span class=\"line\"><span class=\"keyword\">type</span> Apple <span class=\"keyword\">struct</span> &#123;  </span><br><span class=\"line\">&#125;  </span><br><span class=\"line\">  </span><br><span class=\"line\"><span class=\"function\"><span class=\"keyword\">func</span> <span class=\"params\">(a *Apple)</span></span> Show() &#123;  </span><br><span class=\"line\">&#125;  </span><br><span class=\"line\">  </span><br><span class=\"line\"><span class=\"keyword\">type</span> Pear <span class=\"keyword\">struct</span>&#123;  </span><br><span class=\"line\">&#125;  </span><br><span class=\"line\">  </span><br><span class=\"line\"><span class=\"function\"><span class=\"keyword\">func</span> <span class=\"params\">(p *Pear)</span></span> Show() &#123;  </span><br><span class=\"line\">&#125;  </span><br><span class=\"line\">  </span><br><span class=\"line\"><span class=\"keyword\">type</span> Banana <span class=\"keyword\">struct</span>&#123;  </span><br><span class=\"line\">&#125;  </span><br><span class=\"line\">  </span><br><span class=\"line\"><span class=\"function\"><span class=\"keyword\">func</span> <span class=\"params\">(b *Banana)</span></span> Show() &#123;  </span><br><span class=\"line\">&#125;  </span><br><span class=\"line\">  </span><br><span class=\"line\"><span class=\"keyword\">type</span> Factory <span class=\"keyword\">struct</span>&#123;&#125;  </span><br><span class=\"line\">  </span><br><span class=\"line\"><span class=\"function\"><span class=\"keyword\">func</span> <span class=\"params\">(f *Factory)</span></span> CreateFruit(name <span class=\"type\">string</span>) (Fruit, <span class=\"type\">bool</span>) &#123;  </span><br><span class=\"line\">    <span class=\"keyword\">var</span> fruit Fruit  </span><br><span class=\"line\">    ok := <span class=\"literal\">false</span>  </span><br><span class=\"line\">    <span class=\"keyword\">switch</span> &#123;  </span><br><span class=\"line\">    <span class=\"keyword\">case</span> name == <span class=\"string\">&quot;apple&quot;</span>:  </span><br><span class=\"line\">       fruit, ok = <span class=\"built_in\">new</span>(Apple), <span class=\"literal\">true</span>  </span><br><span class=\"line\">    <span class=\"keyword\">case</span> name == <span class=\"string\">&quot;pear&quot;</span>:  </span><br><span class=\"line\">       fruit, ok = <span class=\"built_in\">new</span>(Pear), <span class=\"literal\">true</span>  </span><br><span class=\"line\">    <span class=\"keyword\">case</span> name == <span class=\"string\">&quot;banana&quot;</span>:  </span><br><span class=\"line\">       fruit, ok = <span class=\"built_in\">new</span>(Banana), <span class=\"literal\">true</span>  </span><br><span class=\"line\">    &#125;  </span><br><span class=\"line\">    <span class=\"keyword\">return</span> fruit, ok  </span><br><span class=\"line\">&#125;  </span><br><span class=\"line\">  </span><br><span class=\"line\"></span><br></pre></td></tr></table></figure>\n\n<p><img src=\"https://raw.githubusercontent.com/lyydsheep/pic/main/202412151724598.png\" alt=\"image.png\"></p>\n<p><strong>ä¼˜ç‚¹</strong>ï¼š</p>\n<ol>\n<li>å®ç°äº†å¯¹è±¡åˆ›å»ºå’Œä½¿ç”¨çš„åˆ†ç¦»<br><strong>ç¼ºç‚¹</strong>ï¼š</li>\n<li>è¿æ³•â€œå¼€é—­åŸåˆ™â€</li>\n<li>å·¥å‚ç±»èŒè´£è¿‡é‡ï¼Œä¸€æ—¦ä¸èƒ½å·¥ä½œï¼Œç³»ç»Ÿæ·±å—å½±å“</li>\n<li>å¤æ‚åº¦å’Œç†è§£åº¦éšç€ç±»çš„ä¸ªæ•°å¢åŠ </li>\n</ol>\n<h3 id=\"å·¥å‚æ¨¡å¼\"><a href=\"#å·¥å‚æ¨¡å¼\" class=\"headerlink\" title=\"å·¥å‚æ¨¡å¼\"></a>å·¥å‚æ¨¡å¼</h3><p>å·¥å‚æ¨¡å¼å°±æ˜¯â€œç®€å•å·¥å‚æ¨¡å¼ + å¼€é—­åŸåˆ™â€<br>åœ¨Goé‡Œé¢ï¼Œå®ç°å·¥å‚æ¨¡å¼æ¯”è¾ƒå¸¸è§çš„å†™æ³•å°±æ˜¯<code>Newxxx()</code></p>\n<figure class=\"highlight go\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"function\"><span class=\"keyword\">func</span> <span class=\"title\">NewFactory</span><span class=\"params\">()</span></span> *Factory &#123;  </span><br><span class=\"line\">    <span class=\"keyword\">return</span> &amp;Factory&#123;&#125;  </span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n<h3 id=\"å•ä¾‹æ¨¡å¼\"><a href=\"#å•ä¾‹æ¨¡å¼\" class=\"headerlink\" title=\"å•ä¾‹æ¨¡å¼\"></a>å•ä¾‹æ¨¡å¼</h3><blockquote>\n<p>ä¿è¯ä¸€ä¸ªç±»æ°¸è¿œåªèƒ½æœ‰ä¸€ä¸ªå¯¹è±¡ï¼Œä¸”è¯¥å¯¹è±¡çš„åŠŸèƒ½ä¾ç„¶èƒ½è¢«å…¶ä»–æ¨¡å—ä½¿ç”¨</p>\n</blockquote>\n<p><strong>é¥¿æ±‰å¼</strong>ï¼š</p>\n<figure class=\"highlight go\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">type</span> single <span class=\"keyword\">struct</span>&#123;&#125;  </span><br><span class=\"line\">  </span><br><span class=\"line\"><span class=\"keyword\">var</span> instance = <span class=\"built_in\">new</span>(single)  </span><br><span class=\"line\">  </span><br><span class=\"line\"><span class=\"function\"><span class=\"keyword\">func</span> <span class=\"params\">(s *single)</span></span> Show() &#123;  </span><br><span class=\"line\">    <span class=\"comment\">// do something  </span></span><br><span class=\"line\">&#125;  </span><br><span class=\"line\">  </span><br><span class=\"line\"><span class=\"function\"><span class=\"keyword\">func</span> <span class=\"title\">GetInstance</span><span class=\"params\">()</span></span> *single &#123;  </span><br><span class=\"line\">    <span class=\"keyword\">return</span> instance  </span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n<p><strong>æ‡’æ±‰å¼</strong>ï¼šå»¶è¿Ÿåˆå§‹åŒ–ï¼Œç›´åˆ°è°ƒç”¨GetInstanceæ–¹æ³•æ—¶æ‰è¿›è¡Œåˆå§‹åŒ–ã€‚éœ€è¦é‡ç‚¹å…³å¿ƒçš„æ˜¯å¦‚ä½•ä¿è¯å¹¶å‘å®‰å…¨<br>    - é”<br>    - åŸå­æ“ä½œ<br>    - once</p>\n<figure class=\"highlight go\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">type</span> single <span class=\"keyword\">struct</span>&#123;&#125;  </span><br><span class=\"line\">  </span><br><span class=\"line\"><span class=\"keyword\">var</span> (  </span><br><span class=\"line\">    instance *single  </span><br><span class=\"line\">    mtx sync.RWMutex  </span><br><span class=\"line\">    lock <span class=\"type\">uint32</span>  </span><br><span class=\"line\">    once sync.Once  </span><br><span class=\"line\">)  </span><br><span class=\"line\">  </span><br><span class=\"line\"><span class=\"function\"><span class=\"keyword\">func</span> <span class=\"title\">GetInstance</span><span class=\"params\">()</span></span> *single &#123;  </span><br><span class=\"line\">    <span class=\"comment\">// ä¿è¯å¹¶å‘å®‰å…¨ï¼šé”ã€åŸå­æ“ä½œã€once  </span></span><br><span class=\"line\">    <span class=\"comment\">// åŸå­æ“ä½œ  </span></span><br><span class=\"line\">    <span class=\"comment\">//if atomic.LoadUint32(&amp;lock) == 1 &#123;  </span></span><br><span class=\"line\">    <span class=\"comment\">// return instance    //&#125;    //mtx.Lock()    //defer mtx.Unlock()    //instance = new(single)    //return instance        // once  </span></span><br><span class=\"line\">    once.Do(<span class=\"function\"><span class=\"keyword\">func</span><span class=\"params\">()</span></span> &#123;  </span><br><span class=\"line\">       instance = <span class=\"built_in\">new</span>(single)  </span><br><span class=\"line\">    &#125;)  </span><br><span class=\"line\">    <span class=\"keyword\">return</span> instance  </span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n<h2 id=\"ç»“æ„å‹æ¨¡å¼\"><a href=\"#ç»“æ„å‹æ¨¡å¼\" class=\"headerlink\" title=\"ç»“æ„å‹æ¨¡å¼\"></a>ç»“æ„å‹æ¨¡å¼</h2><h3 id=\"ä»£ç†æ¨¡å¼\"><a href=\"#ä»£ç†æ¨¡å¼\" class=\"headerlink\" title=\"ä»£ç†æ¨¡å¼\"></a>ä»£ç†æ¨¡å¼</h3><p><img src=\"https://raw.githubusercontent.com/lyydsheep/pic/main/202412182052160.png\" alt=\"image.png\"></p>\n<p><strong>Subject</strong>ï¼šå…·ä½“ä¸»é¢˜å’Œä»£ç†ä¸»é¢˜çš„å…¬å…±æ¥å£<br><strong>RealSubject</strong>ï¼šå…·ä½“ä¸»é¢˜<br><strong>Proxy</strong>ï¼šä»£ç†ä¸»é¢˜ï¼Œ<strong>åŒ…å«äº†å¯¹å…·ä½“ä¸»é¢˜è§’è‰²çš„å¼•ç”¨</strong>ï¼Œé€šå¸¸å¯ä»¥åœ¨ä»£ç†ä¸»é¢˜ä¸­å°è£…å…·ä½“ä¸»é¢˜éœ€è¦æ‰§è¡Œçš„ä¸€äº›æµç¨‹ï¼Œæé«˜ä»£ç å¤ç”¨æ€§</p>\n<figure class=\"highlight go\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br><span class=\"line\">31</span><br><span class=\"line\">32</span><br><span class=\"line\">33</span><br><span class=\"line\">34</span><br><span class=\"line\">35</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">type</span> D <span class=\"keyword\">interface</span> &#123;  </span><br><span class=\"line\">    Dance()  </span><br><span class=\"line\">&#125;  </span><br><span class=\"line\">  </span><br><span class=\"line\"><span class=\"keyword\">type</span> KunDance <span class=\"keyword\">struct</span> &#123;  </span><br><span class=\"line\">&#125;  </span><br><span class=\"line\">  </span><br><span class=\"line\"><span class=\"function\"><span class=\"keyword\">func</span> <span class=\"params\">(k *KunDance)</span></span> Dance() &#123;  </span><br><span class=\"line\">    fmt.Println(<span class=\"string\">&quot;KunDance&quot;</span>)  </span><br><span class=\"line\">&#125;  </span><br><span class=\"line\">  </span><br><span class=\"line\"><span class=\"keyword\">type</span> KunKunDance <span class=\"keyword\">struct</span>&#123;&#125;  </span><br><span class=\"line\">  </span><br><span class=\"line\"><span class=\"function\"><span class=\"keyword\">func</span> <span class=\"params\">(k *KunKunDance)</span></span> Dance() &#123;&#125;  </span><br><span class=\"line\">  </span><br><span class=\"line\"><span class=\"keyword\">type</span> SingDanceRap <span class=\"keyword\">struct</span> &#123;  </span><br><span class=\"line\">    d D  </span><br><span class=\"line\">&#125;  </span><br><span class=\"line\">  </span><br><span class=\"line\"><span class=\"function\"><span class=\"keyword\">func</span> <span class=\"params\">(s *SingDanceRap)</span></span> Dance() &#123;  </span><br><span class=\"line\">    s.Sing()  </span><br><span class=\"line\">    <span class=\"comment\">// åŠ¨æ€è°ƒç”¨æŸä¸€ä¸ªDanceæ–¹æ³•  </span></span><br><span class=\"line\">    s.d.Dance()  </span><br><span class=\"line\">    s.Rap()  </span><br><span class=\"line\">&#125;  </span><br><span class=\"line\">  </span><br><span class=\"line\"><span class=\"function\"><span class=\"keyword\">func</span> <span class=\"params\">(s *SingDanceRap)</span></span> Sing() &#123;&#125;  </span><br><span class=\"line\">  </span><br><span class=\"line\"><span class=\"function\"><span class=\"keyword\">func</span> <span class=\"params\">(s *SingDanceRap)</span></span> Rap() &#123;&#125;  </span><br><span class=\"line\">  </span><br><span class=\"line\"><span class=\"function\"><span class=\"keyword\">func</span> <span class=\"title\">NewSingDanceRap</span><span class=\"params\">(d D)</span></span> D &#123;  </span><br><span class=\"line\">    <span class=\"keyword\">return</span> &amp;SingDanceRap&#123;  </span><br><span class=\"line\">       d: d,  </span><br><span class=\"line\">    &#125;  </span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n<p>æ„Ÿè§‰æ ¸å¿ƒç‚¹åœ¨äºï¼Œå®ç°ä¸€ä¸ªå…¬å…±çš„æ¥å£ï¼Œå°è£…ä¸€äº›é‡å¤æ€§çš„ä»£ç ï¼Œæé«˜å¤ç”¨ğŸ¤”</p>\n<h3 id=\"è£…é¥°å™¨æ¨¡å¼\"><a href=\"#è£…é¥°å™¨æ¨¡å¼\" class=\"headerlink\" title=\"è£…é¥°å™¨æ¨¡å¼\"></a>è£…é¥°å™¨æ¨¡å¼</h3><p>è£…é¥°å™¨æ¨¡å¼å’Œä»£ç†æ¨¡å¼å¾ˆåƒï¼Œéƒ½æ˜¯åœ¨åŸæœ‰æ¥å£ä¸Šè¿›è¡ŒåŠŸèƒ½çš„æ‰©å±•ã€‚å…¸å‹çš„æ¨¡æ¿å°±æ˜¯<strong>ç»“æ„ä½“ ç»„åˆ å¾…æ‰©å±•çš„æ¥å£</strong></p>\n<figure class=\"highlight go\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">type</span> Phone <span class=\"keyword\">interface</span> &#123;  </span><br><span class=\"line\">    Show()  </span><br><span class=\"line\">&#125;  </span><br><span class=\"line\">  </span><br><span class=\"line\"><span class=\"keyword\">type</span> Hua <span class=\"keyword\">struct</span> &#123;  </span><br><span class=\"line\">&#125;  </span><br><span class=\"line\">  </span><br><span class=\"line\"><span class=\"function\"><span class=\"keyword\">func</span> <span class=\"params\">(h *Hua)</span></span> Show() &#123;  </span><br><span class=\"line\">  </span><br><span class=\"line\">&#125;  </span><br><span class=\"line\">  </span><br><span class=\"line\"><span class=\"keyword\">type</span> PhonePlus <span class=\"keyword\">struct</span> &#123;  </span><br><span class=\"line\">    Phone  </span><br><span class=\"line\">&#125;  </span><br><span class=\"line\">  </span><br><span class=\"line\"><span class=\"function\"><span class=\"keyword\">func</span> <span class=\"params\">(pp *PhonePlus)</span></span> Show() &#123;  </span><br><span class=\"line\">  </span><br><span class=\"line\">&#125;  </span><br><span class=\"line\">  </span><br><span class=\"line\"><span class=\"function\"><span class=\"keyword\">func</span> <span class=\"params\">(pp *PhonePlus)</span></span> AnotherMethod() &#123;  </span><br><span class=\"line\">  </span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n\n<h3 id=\"é€‚é…å™¨æ¨¡å¼\"><a href=\"#é€‚é…å™¨æ¨¡å¼\" class=\"headerlink\" title=\"é€‚é…å™¨æ¨¡å¼\"></a>é€‚é…å™¨æ¨¡å¼</h3><p>é€‚é…å™¨æ¨¡å¼å¯ä»¥å®ç°ä¸€ä¸ªç±»æˆ–æ¥å£èƒ½å¤Ÿåœ¨ä¸€ä¸ªä¸ä¹‹æ¯«ä¸ç›¸å¹²çš„æ¥å£ç¯å¢ƒè¿è¡Œã€ä½œç”¨</p>\n<p><img src=\"https://raw.githubusercontent.com/lyydsheep/pic/main/202412202127687.png\" alt=\"image.png\"></p>\n<figure class=\"highlight go\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">type</span> V5 <span class=\"keyword\">interface</span>&#123;  </span><br><span class=\"line\">    Use5() &#125;  </span><br><span class=\"line\">  </span><br><span class=\"line\"><span class=\"keyword\">type</span> V220 <span class=\"keyword\">interface</span>&#123;  </span><br><span class=\"line\">    Use220()  </span><br><span class=\"line\">&#125;  </span><br><span class=\"line\">  </span><br><span class=\"line\"><span class=\"keyword\">type</span> Adapter <span class=\"keyword\">struct</span> &#123;  </span><br><span class=\"line\">    v220 V220  </span><br><span class=\"line\">&#125;  </span><br><span class=\"line\">  </span><br><span class=\"line\"><span class=\"function\"><span class=\"keyword\">func</span> <span class=\"params\">(a *Adapter)</span></span> Use5() &#123;  </span><br><span class=\"line\">    a.v220.Use220()  </span><br><span class=\"line\">&#125;  </span><br><span class=\"line\">  </span><br><span class=\"line\"><span class=\"function\"><span class=\"keyword\">func</span> <span class=\"title\">NewAdapter</span><span class=\"params\">(v220 V220)</span></span> *Adapter &#123;  </span><br><span class=\"line\">    <span class=\"keyword\">return</span> &amp;Adapter&#123;v220: v220&#125;  </span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n\n<h3 id=\"å¤–è§‚æ¨¡å¼\"><a href=\"#å¤–è§‚æ¨¡å¼\" class=\"headerlink\" title=\"å¤–è§‚æ¨¡å¼\"></a>å¤–è§‚æ¨¡å¼</h3><p>å¤–è§‚æ¨¡å¼æœ¬è´¨ä¸Šå°±æ˜¯æ·»åŠ ä¸€ä¸ªä¸­é—´å±‚ï¼Œè¿™ä¸ªä¸­é—´å±‚å‘ä¸Šå±‚æä¾›äº†åº•å±‚APIçš„å°è£…ï¼Œé™ä½äº†ä¸šåŠ¡å±‚å’Œåº•å±‚çš„è€¦åˆ</p>\n<figure class=\"highlight go\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">type</span> A <span class=\"keyword\">struct</span> &#123;&#125;  </span><br><span class=\"line\">  </span><br><span class=\"line\"><span class=\"function\"><span class=\"keyword\">func</span> <span class=\"params\">(a *A)</span></span>work() &#123;  </span><br><span class=\"line\">    &#125;  </span><br><span class=\"line\">  </span><br><span class=\"line\"><span class=\"keyword\">type</span> T <span class=\"keyword\">struct</span> &#123;  </span><br><span class=\"line\">    a *A  </span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n\n<h2 id=\"è¡Œä¸ºå‹æ¨¡å¼\"><a href=\"#è¡Œä¸ºå‹æ¨¡å¼\" class=\"headerlink\" title=\"è¡Œä¸ºå‹æ¨¡å¼\"></a>è¡Œä¸ºå‹æ¨¡å¼</h2><h3 id=\"æ¨¡æ¿æ–¹æ³•æ¨¡å¼\"><a href=\"#æ¨¡æ¿æ–¹æ³•æ¨¡å¼\" class=\"headerlink\" title=\"æ¨¡æ¿æ–¹æ³•æ¨¡å¼\"></a>æ¨¡æ¿æ–¹æ³•æ¨¡å¼</h3><p>æ¨¡æ¿æ–¹æ³•æ¨¡å¼å¯ä»¥ç”¨äºç»Ÿä¸€æ¥å£æ–¹æ³•çš„æ“ä½œæ­¥éª¤ï¼Œå¿½è§†æ¯ä¸ªå®ä¾‹å¯¹äºæ–¹æ³•çš„å…·ä½“å®ç°<br>ï¼ˆGoç¡®å®ä¸é€‚åˆæŒ‰ç…§ä¸¥æ ¼çš„è®¾è®¡æ¨¡å¼ç±»å›¾è¿›è¡Œç¼–ç ï¼‰</p>\n<figure class=\"highlight go\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">type</span> Work <span class=\"keyword\">interface</span> &#123;  </span><br><span class=\"line\">    Step1()  </span><br><span class=\"line\">    Step2()  </span><br><span class=\"line\">    Step3()  </span><br><span class=\"line\">&#125;  </span><br><span class=\"line\">  </span><br><span class=\"line\"><span class=\"keyword\">type</span> WorkFlow <span class=\"keyword\">interface</span> &#123;  </span><br><span class=\"line\">    DoSomething()  </span><br><span class=\"line\">&#125;  </span><br><span class=\"line\">  </span><br><span class=\"line\"><span class=\"keyword\">type</span> BasicWorkFlow <span class=\"keyword\">struct</span> &#123;  </span><br><span class=\"line\">    Work  </span><br><span class=\"line\">&#125;  </span><br><span class=\"line\">  </span><br><span class=\"line\"><span class=\"function\"><span class=\"keyword\">func</span> <span class=\"params\">(wf *BasicWorkFlow)</span></span> DoSomething() &#123;  </span><br><span class=\"line\">    wf.Step1()  </span><br><span class=\"line\">    wf.Step2()  </span><br><span class=\"line\">    wf.Step3()  </span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n\n<h3 id=\"å‘½ä»¤æ¨¡å¼\"><a href=\"#å‘½ä»¤æ¨¡å¼\" class=\"headerlink\" title=\"å‘½ä»¤æ¨¡å¼\"></a>å‘½ä»¤æ¨¡å¼</h3><p>å‘½ä»¤æ¨¡å¼æ˜¯åœ¨ä¸€ä¸ªåŠŸèƒ½ç±»ä¸Šæä¾›ç‰¹æ®Šçš„å‘½ä»¤ç±»ï¼Œç”¨äºåŒºåˆ†åŠŸèƒ½ç±»ä¸­çš„ç‰¹å®šåŠŸèƒ½ã€‚å‘ä¸šåŠ¡æ–¹å±è”½äº†åŠŸèƒ½ç±»çš„å…·ä½“ç»†èŠ‚ã€‚åœ¨å‘½ä»¤ç±»çš„åŸºç¡€ä¸Šç»„åˆå‡ºä¸€ä¸ªä¸­é—´ç±»ï¼Œä¸­é—´ç±»å‘ä¸šåŠ¡æ–¹æä¾›ç»Ÿä¸€çš„æ¥å£ï¼Œè¿›ä¸€æ­¥å±è”½äº†ä¸åŒå‘½ä»¤ä¹‹é—´çš„å·®å¼‚</p>\n<figure class=\"highlight go\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br><span class=\"line\">31</span><br><span class=\"line\">32</span><br><span class=\"line\">33</span><br><span class=\"line\">34</span><br><span class=\"line\">35</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">type</span> Doctor <span class=\"keyword\">struct</span> &#123;&#125;  </span><br><span class=\"line\">  </span><br><span class=\"line\"><span class=\"function\"><span class=\"keyword\">func</span> <span class=\"params\">(d *Doctor)</span></span> treatEye() &#123;  </span><br><span class=\"line\">    &#125;  </span><br><span class=\"line\">  </span><br><span class=\"line\"><span class=\"keyword\">type</span> Cmd <span class=\"keyword\">interface</span> &#123;  </span><br><span class=\"line\">    Treat()  </span><br><span class=\"line\">&#125;  </span><br><span class=\"line\">  </span><br><span class=\"line\"><span class=\"keyword\">type</span> Nurse <span class=\"keyword\">struct</span> &#123;  </span><br><span class=\"line\">    cmds []Cmd  </span><br><span class=\"line\">&#125;  </span><br><span class=\"line\">  </span><br><span class=\"line\"><span class=\"function\"><span class=\"keyword\">func</span> <span class=\"params\">(n *Nurse)</span></span> Notify() &#123;  </span><br><span class=\"line\">    <span class=\"keyword\">if</span> n.cmds == <span class=\"literal\">nil</span> &#123;  </span><br><span class=\"line\">       <span class=\"keyword\">return</span>  </span><br><span class=\"line\">    &#125;  </span><br><span class=\"line\">    <span class=\"keyword\">for</span> i := <span class=\"keyword\">range</span> n.cmds &#123;  </span><br><span class=\"line\">       n.cmds[i].Treat()  </span><br><span class=\"line\">    &#125;  </span><br><span class=\"line\">&#125;  </span><br><span class=\"line\">  </span><br><span class=\"line\"><span class=\"function\"><span class=\"keyword\">func</span> <span class=\"params\">(d *Doctor)</span></span> treatNose() &#123;&#125;  </span><br><span class=\"line\">  </span><br><span class=\"line\"><span class=\"keyword\">type</span> cmdEye <span class=\"keyword\">struct</span> &#123;  </span><br><span class=\"line\">    d *Doctor  </span><br><span class=\"line\">&#125;  </span><br><span class=\"line\">  </span><br><span class=\"line\"><span class=\"function\"><span class=\"keyword\">func</span> <span class=\"params\">(c *cmdEye)</span></span> Treat() &#123;  </span><br><span class=\"line\">    c.d.treatEye()  </span><br><span class=\"line\">&#125;  </span><br><span class=\"line\">  </span><br><span class=\"line\"><span class=\"keyword\">type</span> cmdNose <span class=\"keyword\">struct</span> &#123;  </span><br><span class=\"line\">    d *Doctor  </span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n<h3 id=\"ç­–ç•¥æ¨¡å¼\"><a href=\"#ç­–ç•¥æ¨¡å¼\" class=\"headerlink\" title=\"ç­–ç•¥æ¨¡å¼\"></a>ç­–ç•¥æ¨¡å¼</h3><p>ä¸ºç¯å¢ƒç±»é…ç½®ä¸€ä¸ªæ¥å£ï¼Œé€šè¿‡è¿™ä¸ªæ¥å£ç”¨æˆ·å¯ä»¥è‡ªç”±åˆ‡æ¢åŠŸèƒ½ç›¸åŒä½†å®ç°ä¸åŒçš„ç®—æ³•</p>\n<p><img src=\"https://raw.githubusercontent.com/lyydsheep/pic/main/202412242041157.png\" alt=\"image.png\"></p>\n<figure class=\"highlight go\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">type</span> Strategy <span class=\"keyword\">interface</span> &#123;  </span><br><span class=\"line\">    UseWeapon()  </span><br><span class=\"line\">&#125;  </span><br><span class=\"line\">  </span><br><span class=\"line\"><span class=\"keyword\">type</span> AK <span class=\"keyword\">struct</span>&#123;&#125;  </span><br><span class=\"line\">  </span><br><span class=\"line\"><span class=\"function\"><span class=\"keyword\">func</span> <span class=\"params\">(a *AK)</span></span> UseWeapon() &#123;  </span><br><span class=\"line\">    fmt.Println(<span class=\"string\">&quot;ak&quot;</span>)  </span><br><span class=\"line\">&#125;  </span><br><span class=\"line\">  </span><br><span class=\"line\"><span class=\"keyword\">type</span> Knife <span class=\"keyword\">struct</span>&#123;&#125;  </span><br><span class=\"line\">  </span><br><span class=\"line\"><span class=\"function\"><span class=\"keyword\">func</span> <span class=\"params\">(k *Knife)</span></span> UseWeapon() &#123; fmt.Println(<span class=\"string\">&quot;k&quot;</span>) &#125;  </span><br><span class=\"line\">  </span><br><span class=\"line\"><span class=\"keyword\">type</span> Person <span class=\"keyword\">struct</span> &#123;  </span><br><span class=\"line\">    s Strategy  </span><br><span class=\"line\">&#125;  </span><br><span class=\"line\">  </span><br><span class=\"line\"><span class=\"function\"><span class=\"keyword\">func</span> <span class=\"params\">(p *Person)</span></span> SetStrategy(s Strategy) &#123;  </span><br><span class=\"line\">    p.s = s  </span><br><span class=\"line\">&#125;  </span><br><span class=\"line\">  </span><br><span class=\"line\"><span class=\"function\"><span class=\"keyword\">func</span> <span class=\"params\">(p *Person)</span></span> Fight() &#123;  </span><br><span class=\"line\">    p.s.UseWeapon()  </span><br><span class=\"line\">&#125;</span><br><span class=\"line\"></span><br></pre></td></tr></table></figure>\n<h3 id=\"è§‚å¯Ÿè€…æ¨¡å¼\"><a href=\"#è§‚å¯Ÿè€…æ¨¡å¼\" class=\"headerlink\" title=\"è§‚å¯Ÿè€…æ¨¡å¼\"></a>è§‚å¯Ÿè€…æ¨¡å¼</h3><p>å¦‚æœç³»ç»Ÿéœ€è¦åˆ›å»ºä¸€ä¸ªè§¦å‘é“¾ï¼ŒAå¯¹è±¡çš„è¡Œä¸ºå½±å“Bå¯¹è±¡ï¼ŒBå¯¹è±¡çš„è¡Œä¸ºå½±å“Cå¯¹è±¡â€¦ï¼Œå°±å¯ä»¥ä½¿ç”¨è§‚å¯Ÿè€…æ¨¡å¼åˆ›å»ºä¸€ç§é“¾å¼è§¦å‘æœºåˆ¶<br><img src=\"https://raw.githubusercontent.com/lyydsheep/pic/main/202412242129694.png\" alt=\"image.png\"></p>\n<figure class=\"highlight go\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br><span class=\"line\">31</span><br><span class=\"line\">32</span><br><span class=\"line\">33</span><br><span class=\"line\">34</span><br><span class=\"line\">35</span><br><span class=\"line\">36</span><br><span class=\"line\">37</span><br><span class=\"line\">38</span><br><span class=\"line\">39</span><br><span class=\"line\">40</span><br><span class=\"line\">41</span><br><span class=\"line\">42</span><br><span class=\"line\">43</span><br><span class=\"line\">44</span><br><span class=\"line\">45</span><br><span class=\"line\">46</span><br><span class=\"line\">47</span><br><span class=\"line\">48</span><br><span class=\"line\">49</span><br><span class=\"line\">50</span><br><span class=\"line\">51</span><br><span class=\"line\">52</span><br><span class=\"line\">53</span><br><span class=\"line\">54</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">type</span> Listener <span class=\"keyword\">interface</span> &#123;  </span><br><span class=\"line\">    OnTeacherComing()  </span><br><span class=\"line\">&#125;  </span><br><span class=\"line\">  </span><br><span class=\"line\"><span class=\"keyword\">type</span> StuZ3 <span class=\"keyword\">struct</span> &#123;  </span><br><span class=\"line\">    badThing <span class=\"type\">string</span>  </span><br><span class=\"line\">&#125;  </span><br><span class=\"line\">  </span><br><span class=\"line\"><span class=\"function\"><span class=\"keyword\">func</span> <span class=\"params\">(s *StuZ3)</span></span> OnTeacherComing() &#123;  </span><br><span class=\"line\">    fmt.Println(<span class=\"string\">&quot;z3 stop&quot;</span>, s.badThing)  </span><br><span class=\"line\">&#125;  </span><br><span class=\"line\">  </span><br><span class=\"line\"><span class=\"keyword\">type</span> StuZ4 <span class=\"keyword\">struct</span> &#123;  </span><br><span class=\"line\">    badThing <span class=\"type\">string</span>  </span><br><span class=\"line\">&#125;  </span><br><span class=\"line\">  </span><br><span class=\"line\"><span class=\"function\"><span class=\"keyword\">func</span> <span class=\"params\">(s *StuZ4)</span></span> OnTeacherComing() &#123;  </span><br><span class=\"line\">    fmt.Println(<span class=\"string\">&quot;z3 stop&quot;</span>, s.badThing)  </span><br><span class=\"line\">&#125;  </span><br><span class=\"line\">  </span><br><span class=\"line\"><span class=\"keyword\">type</span> StuW5 <span class=\"keyword\">struct</span> &#123;  </span><br><span class=\"line\">    badThing <span class=\"type\">string</span>  </span><br><span class=\"line\">&#125;  </span><br><span class=\"line\">  </span><br><span class=\"line\"><span class=\"function\"><span class=\"keyword\">func</span> <span class=\"params\">(s *StuW5)</span></span> OnTeacherComing() &#123;  </span><br><span class=\"line\">    fmt.Println(<span class=\"string\">&quot;z3 stop&quot;</span>, s.badThing)  </span><br><span class=\"line\">&#125;  </span><br><span class=\"line\">  </span><br><span class=\"line\"><span class=\"keyword\">type</span> Notifier <span class=\"keyword\">interface</span> &#123;  </span><br><span class=\"line\">    Add(l Listener)  </span><br><span class=\"line\">    Del(l Listener)  </span><br><span class=\"line\">    Notify()  </span><br><span class=\"line\">&#125;  </span><br><span class=\"line\">  </span><br><span class=\"line\"><span class=\"keyword\">type</span> Monitor <span class=\"keyword\">struct</span> &#123;  </span><br><span class=\"line\">    listeners []Listener  </span><br><span class=\"line\">&#125;  </span><br><span class=\"line\">  </span><br><span class=\"line\"><span class=\"function\"><span class=\"keyword\">func</span> <span class=\"params\">(m *Monitor)</span></span> Add(l Listener) &#123;  </span><br><span class=\"line\">    <span class=\"keyword\">if</span> m.listeners != <span class=\"literal\">nil</span> &#123;  </span><br><span class=\"line\">       m.listeners = <span class=\"built_in\">append</span>(m.listeners, l)  </span><br><span class=\"line\">    &#125;  </span><br><span class=\"line\">&#125;  </span><br><span class=\"line\">  </span><br><span class=\"line\"><span class=\"function\"><span class=\"keyword\">func</span> <span class=\"params\">(m *Monitor)</span></span> Del(l Listener) &#123;  </span><br><span class=\"line\">    <span class=\"comment\">//TODO implement me  </span></span><br><span class=\"line\">    <span class=\"built_in\">panic</span>(<span class=\"string\">&quot;implement me&quot;</span>)  </span><br><span class=\"line\">&#125;  </span><br><span class=\"line\">  </span><br><span class=\"line\"><span class=\"function\"><span class=\"keyword\">func</span> <span class=\"params\">(m *Monitor)</span></span> Notify() &#123;  </span><br><span class=\"line\">    <span class=\"keyword\">for</span> i := <span class=\"keyword\">range</span> m.listeners &#123;  </span><br><span class=\"line\">       m.listeners[i].OnTeacherComing()  </span><br><span class=\"line\">    &#125;  </span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n","excerpt":"","more":"<h1 id=\"è®¾è®¡æ¨¡å¼\"><a href=\"#è®¾è®¡æ¨¡å¼\" class=\"headerlink\" title=\"è®¾è®¡æ¨¡å¼\"></a>è®¾è®¡æ¨¡å¼</h1><blockquote>\n<p>è¿™æ˜¯<a href=\"https://www.bilibili.com/video/BV1Eg411m7rV/?spm_id_from=333.1387.collection.video_card.click&vd_source=a15269894d9b8114cb5f9bb663d22be9\">Easyæå®šGolangè®¾è®¡æ¨¡å¼</a>çš„å­¦ä¹ è®°å½•</p>\n</blockquote>\n<h2 id=\"é¢å‘å¯¹è±¡è®¾è®¡åŸåˆ™\"><a href=\"#é¢å‘å¯¹è±¡è®¾è®¡åŸåˆ™\" class=\"headerlink\" title=\"é¢å‘å¯¹è±¡è®¾è®¡åŸåˆ™\"></a>é¢å‘å¯¹è±¡è®¾è®¡åŸåˆ™</h2><h3 id=\"å•ä¸€èŒè´£åŸåˆ™\"><a href=\"#å•ä¸€èŒè´£åŸåˆ™\" class=\"headerlink\" title=\"å•ä¸€èŒè´£åŸåˆ™\"></a>å•ä¸€èŒè´£åŸåˆ™</h3><p>ç±»çš„èŒè´£å•ä¸€ï¼Œå¯¹å¤–åªæä¾›ä¸€ç§åŠŸèƒ½ï¼Œè€Œå¼•èµ·ç±»çš„å˜åŒ–çš„åŸå› é€šå¸¸åªæœ‰ä¸€ä¸ªã€‚è¿™æ˜¯ä¸ºäº†é¿å…åˆ«äººçœ‹ä»£ç æ—¶äº§ç”Ÿæ­§ä¹‰ï¼Œæé«˜ä»£ç çš„é€»è¾‘æ€§</p>\n<p>è®¾è®¡ä¸€ä¸ªç±»ï¼Œå¯¹å¤–æä¾›çš„åŠŸèƒ½åº”è¯¥å•ä¸€ï¼Œæ¥å£å•ä¸€ï¼Œä»…æœ‰è¿™ä¸ªæ¥å£ä¼šå½±å“è¿™ä¸ªç±»ã€‚ä¸€ä¸ªç±»çš„ä¸€ä¸ªæ¥å£åº”å…·å¤‡è¿™ä¸ªç±»çš„åŠŸèƒ½å«ä¹‰ï¼ŒèŒè´£å•ä¸€å¹¶ä¸”ä¸å¤æ‚</p>\n<h3 id=\"å¼€é—­åŸåˆ™\"><a href=\"#å¼€é—­åŸåˆ™\" class=\"headerlink\" title=\"å¼€é—­åŸåˆ™\"></a>å¼€é—­åŸåˆ™</h3><blockquote>\n<p>å¯¹æ‰©å±•å¼€æ”¾ï¼Œå¯¹ä¿®æ”¹å…³é—­</p>\n</blockquote>\n<p>å¦‚æœæˆ‘ä»¬æƒ³ä¸ºæŸä¸ªç±»å¢æ·»æ–°çš„åŠŸèƒ½ï¼Œæœ€å¥½çš„æ–¹æ³•æ˜¯åŸºäºæ¥å£æˆ–è€…ç»„åˆçš„æ–¹å¼å¯¹å…¶è¿›è¡Œæ‰©å±•ï¼Œè€Œä¸æ˜¯åœ¨åŸæœ‰çš„ç±»ä»£ç ä¸Šè¿›è¡Œä¿®æ”¹ã€‚æ¯”å¦‚ä¸€ä¸ªç±»å·²ç»æœ‰äº†99ä¸ªæ–¹æ³•ï¼Œé‚£ä¹ˆå¢æ·»ç¬¬100ä¸ªæ–¹æ³•æ—¶å°±å¾ˆæœ‰å¯èƒ½å¯¼è‡´å‰é¢99ä¸ªæ–¹æ³•æ— æ³•æ­£å¸¸å·¥ä½œï¼ˆæ¯•ç«Ÿè°çŸ¥é“é‚£99ä¸ªæ–¹æ³•ç”¨äº†ä»€ä¹ˆå¥‡æŠ€æ·«å·§ï¼‰</p>\n<p>æ‰€ä»¥å¼€é—­åŸåˆ™çš„æ ¸å¿ƒæ€æƒ³å°±æ˜¯ï¼šä¸æ˜¯é€šè¿‡ä¿®æ”¹ä»£ç ,è€Œæ˜¯é€šè¿‡å¢æ·»ä»£ç æ¥ç»™ç³»ç»Ÿæ·»åŠ åŠŸèƒ½</p>\n<h3 id=\"ä¾èµ–å€’è½¬åŸåˆ™ï¼ˆé‡è¦ï¼‰\"><a href=\"#ä¾èµ–å€’è½¬åŸåˆ™ï¼ˆé‡è¦ï¼‰\" class=\"headerlink\" title=\"ä¾èµ–å€’è½¬åŸåˆ™ï¼ˆé‡è¦ï¼‰\"></a>ä¾èµ–å€’è½¬åŸåˆ™ï¼ˆé‡è¦ï¼‰</h3><p>æ„Ÿè§‰ä¾èµ–å€’è½¬åŸåˆ™çš„æ ¸å¿ƒå°±æ˜¯<strong>é¢å‘æ¥å£ç¼–ç¨‹</strong><br><img src=\"https://raw.githubusercontent.com/lyydsheep/pic/main/202412121814145.png\" /></p>\n<p>é¦–å…ˆéœ€è¦åšå¥½ä¸­é—´æŠ½è±¡å±‚çš„è®¾è®¡ï¼Œç„¶åä¾ç…§è¿™æŠ½è±¡å±‚ä¸€æ¬¡å°†å®ç°å±‚çš„æ¯ä¸€ä¸ªæ¨¡å—è¿›è¡Œå®ç°ã€‚è¿™ä¸€æ­¥æç°äº†å®ç°å±‚<strong>å‘ä¸Šä¾èµ–æŠ½è±¡å±‚</strong><br>å¦ä¸€æ–¹é¢ï¼ŒæŠ½è±¡å±‚å‘ä¸šåŠ¡é€»è¾‘å±‚æš´éœ²å‡ºåŠŸèƒ½çš„æ¥å£ï¼Œä¸šåŠ¡é€»è¾‘å±‚åªéœ€è¦æ ¹æ®æš´éœ²å‡ºæ¥çš„æ¥å£å®ç°å¯¹ä¹Ÿçš„ä¸šåŠ¡é€»è¾‘å³å¯ï¼Œæ— éœ€å…³ç³»åŠŸèƒ½å…·ä½“æ˜¯å¦‚ä½•å®ç°</p>\n<h3 id=\"åˆæˆå¤ç”¨åŸåˆ™\"><a href=\"#åˆæˆå¤ç”¨åŸåˆ™\" class=\"headerlink\" title=\"åˆæˆå¤ç”¨åŸåˆ™\"></a>åˆæˆå¤ç”¨åŸåˆ™</h3><p>å¦‚æœä½¿ç”¨ç»§æ‰¿ï¼Œä¼šå¯¼è‡´çˆ¶ç±»çš„ä»»ä½•å˜æ¢éƒ½å¯èƒ½å½±å“åˆ°å­ç±»çš„è¡Œä¸ºã€‚å¦‚æœä½¿ç”¨ç»„åˆï¼Œå°±å¤§å¤§é™ä½äº†è¿™ç§ä¾èµ–å…³ç³»ã€‚å¯¹äºç»„åˆå’Œç»§æ‰¿ï¼Œä¼˜å…ˆä½¿ç”¨ç»„åˆã€‚ï¼ˆGoå¤©ç„¶å®ç°ç»„åˆğŸ˜‚ï¼‰<br>æ¯”å¦‚çˆ¶ç±»æœ‰100ä¸ªæ–¹æ³•ï¼Œè€Œå­ç±»åªæƒ³ä½¿ç”¨å…¶ä¸­çš„æŸä¸€ä¸ªæ–¹æ³•ï¼Œé‚£ä¹ˆå­ç±»é‡‡ç”¨ç»„åˆçš„æ–¹å¼å°±èƒ½å±è”½æ‰çˆ¶ç±»çš„å…¶ä»–99ä¸ªæ–¹æ³•</p>\n<h3 id=\"è¿ªç±³ç‰¹æ³•åˆ™\"><a href=\"#è¿ªç±³ç‰¹æ³•åˆ™\" class=\"headerlink\" title=\"è¿ªç±³ç‰¹æ³•åˆ™\"></a>è¿ªç±³ç‰¹æ³•åˆ™</h3><p>ä¸€ä¸ªå¯¹è±¡åº”å½“å¯¹å…¶ä»–å¯¹è±¡å°½å¯èƒ½äº†è§£å¾—å°‘ï¼Œä»è€Œé™ä½å„ä¸ªå¯¹è±¡ä¹‹é—´çš„è€¦åˆï¼Œæé«˜ç³»ç»Ÿçš„å¯ç»´æŠ¤æ€§ã€‚</p>\n<h2 id=\"åˆ›å»ºå‹æ¨¡å¼\"><a href=\"#åˆ›å»ºå‹æ¨¡å¼\" class=\"headerlink\" title=\"åˆ›å»ºå‹æ¨¡å¼\"></a>åˆ›å»ºå‹æ¨¡å¼</h2><h3 id=\"ç®€å•å·¥å‚æ¨¡å¼\"><a href=\"#ç®€å•å·¥å‚æ¨¡å¼\" class=\"headerlink\" title=\"ç®€å•å·¥å‚æ¨¡å¼\"></a>ç®€å•å·¥å‚æ¨¡å¼</h3><p><strong>ä¸šåŠ¡é€»è¾‘å±‚ â€”&gt;  å·¥å‚æ¨¡å— â€”&gt; åŸºç¡€ç±»æ¨¡å—</strong></p>\n<p>åä¾‹ï¼šä¸šåŠ¡é€»è¾‘å±‚ â€”&gt; åŸºç¡€ç±»æ¨¡å—</p>\n<figure class=\"highlight go\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">type</span> Fruit <span class=\"keyword\">struct</span> &#123;  </span><br><span class=\"line\">&#125;  </span><br><span class=\"line\">  </span><br><span class=\"line\"><span class=\"function\"><span class=\"keyword\">func</span> <span class=\"params\">(f *Fruit)</span></span> Name() &#123;  </span><br><span class=\"line\">    &#125;  </span><br><span class=\"line\">  </span><br><span class=\"line\"><span class=\"function\"><span class=\"keyword\">func</span> <span class=\"title\">NewFruit</span><span class=\"params\">(name <span class=\"type\">string</span>)</span></span> *Fruit &#123;  </span><br><span class=\"line\">    res := &amp;Fruit&#123;&#125;  </span><br><span class=\"line\">    <span class=\"keyword\">switch</span> &#123;  </span><br><span class=\"line\">    <span class=\"keyword\">case</span> name == <span class=\"string\">&quot;apple&quot;</span>:  </span><br><span class=\"line\">       <span class=\"comment\">// do something  </span></span><br><span class=\"line\">    <span class=\"keyword\">case</span> name == <span class=\"string\">&quot;pear&quot;</span>:  </span><br><span class=\"line\">       <span class=\"comment\">// do something  </span></span><br><span class=\"line\">    <span class=\"keyword\">default</span>:  </span><br><span class=\"line\">       <span class=\"comment\">// do something  </span></span><br><span class=\"line\">    &#125;  </span><br><span class=\"line\">    <span class=\"keyword\">return</span> res  </span><br><span class=\"line\">&#125;  </span><br><span class=\"line\">  </span><br><span class=\"line\"><span class=\"function\"><span class=\"keyword\">func</span> <span class=\"title\">main</span><span class=\"params\">()</span></span> &#123;  </span><br><span class=\"line\">    apple := NewFruit(<span class=\"string\">&quot;apple&quot;</span>)  </span><br><span class=\"line\">    apple.Name()  </span><br><span class=\"line\">    pear := NewFruit(<span class=\"string\">&quot;pear&quot;</span>)  </span><br><span class=\"line\">    pear.Name()  </span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n<p>ç®€å•å·¥å‚æ¨¡å¼å®ç°ä»£ç ï¼š</p>\n<figure class=\"highlight go\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br><span class=\"line\">31</span><br><span class=\"line\">32</span><br><span class=\"line\">33</span><br><span class=\"line\">34</span><br><span class=\"line\">35</span><br><span class=\"line\">36</span><br><span class=\"line\">37</span><br><span class=\"line\">38</span><br><span class=\"line\">39</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">type</span> Fruit <span class=\"keyword\">interface</span> &#123;  </span><br><span class=\"line\">    Show()  </span><br><span class=\"line\">&#125;  </span><br><span class=\"line\">  </span><br><span class=\"line\"><span class=\"keyword\">type</span> Apple <span class=\"keyword\">struct</span> &#123;  </span><br><span class=\"line\">&#125;  </span><br><span class=\"line\">  </span><br><span class=\"line\"><span class=\"function\"><span class=\"keyword\">func</span> <span class=\"params\">(a *Apple)</span></span> Show() &#123;  </span><br><span class=\"line\">&#125;  </span><br><span class=\"line\">  </span><br><span class=\"line\"><span class=\"keyword\">type</span> Pear <span class=\"keyword\">struct</span>&#123;  </span><br><span class=\"line\">&#125;  </span><br><span class=\"line\">  </span><br><span class=\"line\"><span class=\"function\"><span class=\"keyword\">func</span> <span class=\"params\">(p *Pear)</span></span> Show() &#123;  </span><br><span class=\"line\">&#125;  </span><br><span class=\"line\">  </span><br><span class=\"line\"><span class=\"keyword\">type</span> Banana <span class=\"keyword\">struct</span>&#123;  </span><br><span class=\"line\">&#125;  </span><br><span class=\"line\">  </span><br><span class=\"line\"><span class=\"function\"><span class=\"keyword\">func</span> <span class=\"params\">(b *Banana)</span></span> Show() &#123;  </span><br><span class=\"line\">&#125;  </span><br><span class=\"line\">  </span><br><span class=\"line\"><span class=\"keyword\">type</span> Factory <span class=\"keyword\">struct</span>&#123;&#125;  </span><br><span class=\"line\">  </span><br><span class=\"line\"><span class=\"function\"><span class=\"keyword\">func</span> <span class=\"params\">(f *Factory)</span></span> CreateFruit(name <span class=\"type\">string</span>) (Fruit, <span class=\"type\">bool</span>) &#123;  </span><br><span class=\"line\">    <span class=\"keyword\">var</span> fruit Fruit  </span><br><span class=\"line\">    ok := <span class=\"literal\">false</span>  </span><br><span class=\"line\">    <span class=\"keyword\">switch</span> &#123;  </span><br><span class=\"line\">    <span class=\"keyword\">case</span> name == <span class=\"string\">&quot;apple&quot;</span>:  </span><br><span class=\"line\">       fruit, ok = <span class=\"built_in\">new</span>(Apple), <span class=\"literal\">true</span>  </span><br><span class=\"line\">    <span class=\"keyword\">case</span> name == <span class=\"string\">&quot;pear&quot;</span>:  </span><br><span class=\"line\">       fruit, ok = <span class=\"built_in\">new</span>(Pear), <span class=\"literal\">true</span>  </span><br><span class=\"line\">    <span class=\"keyword\">case</span> name == <span class=\"string\">&quot;banana&quot;</span>:  </span><br><span class=\"line\">       fruit, ok = <span class=\"built_in\">new</span>(Banana), <span class=\"literal\">true</span>  </span><br><span class=\"line\">    &#125;  </span><br><span class=\"line\">    <span class=\"keyword\">return</span> fruit, ok  </span><br><span class=\"line\">&#125;  </span><br><span class=\"line\">  </span><br><span class=\"line\"></span><br></pre></td></tr></table></figure>\n\n<p><img src=\"https://raw.githubusercontent.com/lyydsheep/pic/main/202412151724598.png\" alt=\"image.png\"></p>\n<p><strong>ä¼˜ç‚¹</strong>ï¼š</p>\n<ol>\n<li>å®ç°äº†å¯¹è±¡åˆ›å»ºå’Œä½¿ç”¨çš„åˆ†ç¦»<br><strong>ç¼ºç‚¹</strong>ï¼š</li>\n<li>è¿æ³•â€œå¼€é—­åŸåˆ™â€</li>\n<li>å·¥å‚ç±»èŒè´£è¿‡é‡ï¼Œä¸€æ—¦ä¸èƒ½å·¥ä½œï¼Œç³»ç»Ÿæ·±å—å½±å“</li>\n<li>å¤æ‚åº¦å’Œç†è§£åº¦éšç€ç±»çš„ä¸ªæ•°å¢åŠ </li>\n</ol>\n<h3 id=\"å·¥å‚æ¨¡å¼\"><a href=\"#å·¥å‚æ¨¡å¼\" class=\"headerlink\" title=\"å·¥å‚æ¨¡å¼\"></a>å·¥å‚æ¨¡å¼</h3><p>å·¥å‚æ¨¡å¼å°±æ˜¯â€œç®€å•å·¥å‚æ¨¡å¼ + å¼€é—­åŸåˆ™â€<br>åœ¨Goé‡Œé¢ï¼Œå®ç°å·¥å‚æ¨¡å¼æ¯”è¾ƒå¸¸è§çš„å†™æ³•å°±æ˜¯<code>Newxxx()</code></p>\n<figure class=\"highlight go\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"function\"><span class=\"keyword\">func</span> <span class=\"title\">NewFactory</span><span class=\"params\">()</span></span> *Factory &#123;  </span><br><span class=\"line\">    <span class=\"keyword\">return</span> &amp;Factory&#123;&#125;  </span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n<h3 id=\"å•ä¾‹æ¨¡å¼\"><a href=\"#å•ä¾‹æ¨¡å¼\" class=\"headerlink\" title=\"å•ä¾‹æ¨¡å¼\"></a>å•ä¾‹æ¨¡å¼</h3><blockquote>\n<p>ä¿è¯ä¸€ä¸ªç±»æ°¸è¿œåªèƒ½æœ‰ä¸€ä¸ªå¯¹è±¡ï¼Œä¸”è¯¥å¯¹è±¡çš„åŠŸèƒ½ä¾ç„¶èƒ½è¢«å…¶ä»–æ¨¡å—ä½¿ç”¨</p>\n</blockquote>\n<p><strong>é¥¿æ±‰å¼</strong>ï¼š</p>\n<figure class=\"highlight go\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">type</span> single <span class=\"keyword\">struct</span>&#123;&#125;  </span><br><span class=\"line\">  </span><br><span class=\"line\"><span class=\"keyword\">var</span> instance = <span class=\"built_in\">new</span>(single)  </span><br><span class=\"line\">  </span><br><span class=\"line\"><span class=\"function\"><span class=\"keyword\">func</span> <span class=\"params\">(s *single)</span></span> Show() &#123;  </span><br><span class=\"line\">    <span class=\"comment\">// do something  </span></span><br><span class=\"line\">&#125;  </span><br><span class=\"line\">  </span><br><span class=\"line\"><span class=\"function\"><span class=\"keyword\">func</span> <span class=\"title\">GetInstance</span><span class=\"params\">()</span></span> *single &#123;  </span><br><span class=\"line\">    <span class=\"keyword\">return</span> instance  </span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n<p><strong>æ‡’æ±‰å¼</strong>ï¼šå»¶è¿Ÿåˆå§‹åŒ–ï¼Œç›´åˆ°è°ƒç”¨GetInstanceæ–¹æ³•æ—¶æ‰è¿›è¡Œåˆå§‹åŒ–ã€‚éœ€è¦é‡ç‚¹å…³å¿ƒçš„æ˜¯å¦‚ä½•ä¿è¯å¹¶å‘å®‰å…¨<br>    - é”<br>    - åŸå­æ“ä½œ<br>    - once</p>\n<figure class=\"highlight go\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">type</span> single <span class=\"keyword\">struct</span>&#123;&#125;  </span><br><span class=\"line\">  </span><br><span class=\"line\"><span class=\"keyword\">var</span> (  </span><br><span class=\"line\">    instance *single  </span><br><span class=\"line\">    mtx sync.RWMutex  </span><br><span class=\"line\">    lock <span class=\"type\">uint32</span>  </span><br><span class=\"line\">    once sync.Once  </span><br><span class=\"line\">)  </span><br><span class=\"line\">  </span><br><span class=\"line\"><span class=\"function\"><span class=\"keyword\">func</span> <span class=\"title\">GetInstance</span><span class=\"params\">()</span></span> *single &#123;  </span><br><span class=\"line\">    <span class=\"comment\">// ä¿è¯å¹¶å‘å®‰å…¨ï¼šé”ã€åŸå­æ“ä½œã€once  </span></span><br><span class=\"line\">    <span class=\"comment\">// åŸå­æ“ä½œ  </span></span><br><span class=\"line\">    <span class=\"comment\">//if atomic.LoadUint32(&amp;lock) == 1 &#123;  </span></span><br><span class=\"line\">    <span class=\"comment\">// return instance    //&#125;    //mtx.Lock()    //defer mtx.Unlock()    //instance = new(single)    //return instance        // once  </span></span><br><span class=\"line\">    once.Do(<span class=\"function\"><span class=\"keyword\">func</span><span class=\"params\">()</span></span> &#123;  </span><br><span class=\"line\">       instance = <span class=\"built_in\">new</span>(single)  </span><br><span class=\"line\">    &#125;)  </span><br><span class=\"line\">    <span class=\"keyword\">return</span> instance  </span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n<h2 id=\"ç»“æ„å‹æ¨¡å¼\"><a href=\"#ç»“æ„å‹æ¨¡å¼\" class=\"headerlink\" title=\"ç»“æ„å‹æ¨¡å¼\"></a>ç»“æ„å‹æ¨¡å¼</h2><h3 id=\"ä»£ç†æ¨¡å¼\"><a href=\"#ä»£ç†æ¨¡å¼\" class=\"headerlink\" title=\"ä»£ç†æ¨¡å¼\"></a>ä»£ç†æ¨¡å¼</h3><p><img src=\"https://raw.githubusercontent.com/lyydsheep/pic/main/202412182052160.png\" alt=\"image.png\"></p>\n<p><strong>Subject</strong>ï¼šå…·ä½“ä¸»é¢˜å’Œä»£ç†ä¸»é¢˜çš„å…¬å…±æ¥å£<br><strong>RealSubject</strong>ï¼šå…·ä½“ä¸»é¢˜<br><strong>Proxy</strong>ï¼šä»£ç†ä¸»é¢˜ï¼Œ<strong>åŒ…å«äº†å¯¹å…·ä½“ä¸»é¢˜è§’è‰²çš„å¼•ç”¨</strong>ï¼Œé€šå¸¸å¯ä»¥åœ¨ä»£ç†ä¸»é¢˜ä¸­å°è£…å…·ä½“ä¸»é¢˜éœ€è¦æ‰§è¡Œçš„ä¸€äº›æµç¨‹ï¼Œæé«˜ä»£ç å¤ç”¨æ€§</p>\n<figure class=\"highlight go\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br><span class=\"line\">31</span><br><span class=\"line\">32</span><br><span class=\"line\">33</span><br><span class=\"line\">34</span><br><span class=\"line\">35</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">type</span> D <span class=\"keyword\">interface</span> &#123;  </span><br><span class=\"line\">    Dance()  </span><br><span class=\"line\">&#125;  </span><br><span class=\"line\">  </span><br><span class=\"line\"><span class=\"keyword\">type</span> KunDance <span class=\"keyword\">struct</span> &#123;  </span><br><span class=\"line\">&#125;  </span><br><span class=\"line\">  </span><br><span class=\"line\"><span class=\"function\"><span class=\"keyword\">func</span> <span class=\"params\">(k *KunDance)</span></span> Dance() &#123;  </span><br><span class=\"line\">    fmt.Println(<span class=\"string\">&quot;KunDance&quot;</span>)  </span><br><span class=\"line\">&#125;  </span><br><span class=\"line\">  </span><br><span class=\"line\"><span class=\"keyword\">type</span> KunKunDance <span class=\"keyword\">struct</span>&#123;&#125;  </span><br><span class=\"line\">  </span><br><span class=\"line\"><span class=\"function\"><span class=\"keyword\">func</span> <span class=\"params\">(k *KunKunDance)</span></span> Dance() &#123;&#125;  </span><br><span class=\"line\">  </span><br><span class=\"line\"><span class=\"keyword\">type</span> SingDanceRap <span class=\"keyword\">struct</span> &#123;  </span><br><span class=\"line\">    d D  </span><br><span class=\"line\">&#125;  </span><br><span class=\"line\">  </span><br><span class=\"line\"><span class=\"function\"><span class=\"keyword\">func</span> <span class=\"params\">(s *SingDanceRap)</span></span> Dance() &#123;  </span><br><span class=\"line\">    s.Sing()  </span><br><span class=\"line\">    <span class=\"comment\">// åŠ¨æ€è°ƒç”¨æŸä¸€ä¸ªDanceæ–¹æ³•  </span></span><br><span class=\"line\">    s.d.Dance()  </span><br><span class=\"line\">    s.Rap()  </span><br><span class=\"line\">&#125;  </span><br><span class=\"line\">  </span><br><span class=\"line\"><span class=\"function\"><span class=\"keyword\">func</span> <span class=\"params\">(s *SingDanceRap)</span></span> Sing() &#123;&#125;  </span><br><span class=\"line\">  </span><br><span class=\"line\"><span class=\"function\"><span class=\"keyword\">func</span> <span class=\"params\">(s *SingDanceRap)</span></span> Rap() &#123;&#125;  </span><br><span class=\"line\">  </span><br><span class=\"line\"><span class=\"function\"><span class=\"keyword\">func</span> <span class=\"title\">NewSingDanceRap</span><span class=\"params\">(d D)</span></span> D &#123;  </span><br><span class=\"line\">    <span class=\"keyword\">return</span> &amp;SingDanceRap&#123;  </span><br><span class=\"line\">       d: d,  </span><br><span class=\"line\">    &#125;  </span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n<p>æ„Ÿè§‰æ ¸å¿ƒç‚¹åœ¨äºï¼Œå®ç°ä¸€ä¸ªå…¬å…±çš„æ¥å£ï¼Œå°è£…ä¸€äº›é‡å¤æ€§çš„ä»£ç ï¼Œæé«˜å¤ç”¨ğŸ¤”</p>\n<h3 id=\"è£…é¥°å™¨æ¨¡å¼\"><a href=\"#è£…é¥°å™¨æ¨¡å¼\" class=\"headerlink\" title=\"è£…é¥°å™¨æ¨¡å¼\"></a>è£…é¥°å™¨æ¨¡å¼</h3><p>è£…é¥°å™¨æ¨¡å¼å’Œä»£ç†æ¨¡å¼å¾ˆåƒï¼Œéƒ½æ˜¯åœ¨åŸæœ‰æ¥å£ä¸Šè¿›è¡ŒåŠŸèƒ½çš„æ‰©å±•ã€‚å…¸å‹çš„æ¨¡æ¿å°±æ˜¯<strong>ç»“æ„ä½“ ç»„åˆ å¾…æ‰©å±•çš„æ¥å£</strong></p>\n<figure class=\"highlight go\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">type</span> Phone <span class=\"keyword\">interface</span> &#123;  </span><br><span class=\"line\">    Show()  </span><br><span class=\"line\">&#125;  </span><br><span class=\"line\">  </span><br><span class=\"line\"><span class=\"keyword\">type</span> Hua <span class=\"keyword\">struct</span> &#123;  </span><br><span class=\"line\">&#125;  </span><br><span class=\"line\">  </span><br><span class=\"line\"><span class=\"function\"><span class=\"keyword\">func</span> <span class=\"params\">(h *Hua)</span></span> Show() &#123;  </span><br><span class=\"line\">  </span><br><span class=\"line\">&#125;  </span><br><span class=\"line\">  </span><br><span class=\"line\"><span class=\"keyword\">type</span> PhonePlus <span class=\"keyword\">struct</span> &#123;  </span><br><span class=\"line\">    Phone  </span><br><span class=\"line\">&#125;  </span><br><span class=\"line\">  </span><br><span class=\"line\"><span class=\"function\"><span class=\"keyword\">func</span> <span class=\"params\">(pp *PhonePlus)</span></span> Show() &#123;  </span><br><span class=\"line\">  </span><br><span class=\"line\">&#125;  </span><br><span class=\"line\">  </span><br><span class=\"line\"><span class=\"function\"><span class=\"keyword\">func</span> <span class=\"params\">(pp *PhonePlus)</span></span> AnotherMethod() &#123;  </span><br><span class=\"line\">  </span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n\n<h3 id=\"é€‚é…å™¨æ¨¡å¼\"><a href=\"#é€‚é…å™¨æ¨¡å¼\" class=\"headerlink\" title=\"é€‚é…å™¨æ¨¡å¼\"></a>é€‚é…å™¨æ¨¡å¼</h3><p>é€‚é…å™¨æ¨¡å¼å¯ä»¥å®ç°ä¸€ä¸ªç±»æˆ–æ¥å£èƒ½å¤Ÿåœ¨ä¸€ä¸ªä¸ä¹‹æ¯«ä¸ç›¸å¹²çš„æ¥å£ç¯å¢ƒè¿è¡Œã€ä½œç”¨</p>\n<p><img src=\"https://raw.githubusercontent.com/lyydsheep/pic/main/202412202127687.png\" alt=\"image.png\"></p>\n<figure class=\"highlight go\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">type</span> V5 <span class=\"keyword\">interface</span>&#123;  </span><br><span class=\"line\">    Use5() &#125;  </span><br><span class=\"line\">  </span><br><span class=\"line\"><span class=\"keyword\">type</span> V220 <span class=\"keyword\">interface</span>&#123;  </span><br><span class=\"line\">    Use220()  </span><br><span class=\"line\">&#125;  </span><br><span class=\"line\">  </span><br><span class=\"line\"><span class=\"keyword\">type</span> Adapter <span class=\"keyword\">struct</span> &#123;  </span><br><span class=\"line\">    v220 V220  </span><br><span class=\"line\">&#125;  </span><br><span class=\"line\">  </span><br><span class=\"line\"><span class=\"function\"><span class=\"keyword\">func</span> <span class=\"params\">(a *Adapter)</span></span> Use5() &#123;  </span><br><span class=\"line\">    a.v220.Use220()  </span><br><span class=\"line\">&#125;  </span><br><span class=\"line\">  </span><br><span class=\"line\"><span class=\"function\"><span class=\"keyword\">func</span> <span class=\"title\">NewAdapter</span><span class=\"params\">(v220 V220)</span></span> *Adapter &#123;  </span><br><span class=\"line\">    <span class=\"keyword\">return</span> &amp;Adapter&#123;v220: v220&#125;  </span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n\n<h3 id=\"å¤–è§‚æ¨¡å¼\"><a href=\"#å¤–è§‚æ¨¡å¼\" class=\"headerlink\" title=\"å¤–è§‚æ¨¡å¼\"></a>å¤–è§‚æ¨¡å¼</h3><p>å¤–è§‚æ¨¡å¼æœ¬è´¨ä¸Šå°±æ˜¯æ·»åŠ ä¸€ä¸ªä¸­é—´å±‚ï¼Œè¿™ä¸ªä¸­é—´å±‚å‘ä¸Šå±‚æä¾›äº†åº•å±‚APIçš„å°è£…ï¼Œé™ä½äº†ä¸šåŠ¡å±‚å’Œåº•å±‚çš„è€¦åˆ</p>\n<figure class=\"highlight go\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">type</span> A <span class=\"keyword\">struct</span> &#123;&#125;  </span><br><span class=\"line\">  </span><br><span class=\"line\"><span class=\"function\"><span class=\"keyword\">func</span> <span class=\"params\">(a *A)</span></span>work() &#123;  </span><br><span class=\"line\">    &#125;  </span><br><span class=\"line\">  </span><br><span class=\"line\"><span class=\"keyword\">type</span> T <span class=\"keyword\">struct</span> &#123;  </span><br><span class=\"line\">    a *A  </span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n\n<h2 id=\"è¡Œä¸ºå‹æ¨¡å¼\"><a href=\"#è¡Œä¸ºå‹æ¨¡å¼\" class=\"headerlink\" title=\"è¡Œä¸ºå‹æ¨¡å¼\"></a>è¡Œä¸ºå‹æ¨¡å¼</h2><h3 id=\"æ¨¡æ¿æ–¹æ³•æ¨¡å¼\"><a href=\"#æ¨¡æ¿æ–¹æ³•æ¨¡å¼\" class=\"headerlink\" title=\"æ¨¡æ¿æ–¹æ³•æ¨¡å¼\"></a>æ¨¡æ¿æ–¹æ³•æ¨¡å¼</h3><p>æ¨¡æ¿æ–¹æ³•æ¨¡å¼å¯ä»¥ç”¨äºç»Ÿä¸€æ¥å£æ–¹æ³•çš„æ“ä½œæ­¥éª¤ï¼Œå¿½è§†æ¯ä¸ªå®ä¾‹å¯¹äºæ–¹æ³•çš„å…·ä½“å®ç°<br>ï¼ˆGoç¡®å®ä¸é€‚åˆæŒ‰ç…§ä¸¥æ ¼çš„è®¾è®¡æ¨¡å¼ç±»å›¾è¿›è¡Œç¼–ç ï¼‰</p>\n<figure class=\"highlight go\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">type</span> Work <span class=\"keyword\">interface</span> &#123;  </span><br><span class=\"line\">    Step1()  </span><br><span class=\"line\">    Step2()  </span><br><span class=\"line\">    Step3()  </span><br><span class=\"line\">&#125;  </span><br><span class=\"line\">  </span><br><span class=\"line\"><span class=\"keyword\">type</span> WorkFlow <span class=\"keyword\">interface</span> &#123;  </span><br><span class=\"line\">    DoSomething()  </span><br><span class=\"line\">&#125;  </span><br><span class=\"line\">  </span><br><span class=\"line\"><span class=\"keyword\">type</span> BasicWorkFlow <span class=\"keyword\">struct</span> &#123;  </span><br><span class=\"line\">    Work  </span><br><span class=\"line\">&#125;  </span><br><span class=\"line\">  </span><br><span class=\"line\"><span class=\"function\"><span class=\"keyword\">func</span> <span class=\"params\">(wf *BasicWorkFlow)</span></span> DoSomething() &#123;  </span><br><span class=\"line\">    wf.Step1()  </span><br><span class=\"line\">    wf.Step2()  </span><br><span class=\"line\">    wf.Step3()  </span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n\n<h3 id=\"å‘½ä»¤æ¨¡å¼\"><a href=\"#å‘½ä»¤æ¨¡å¼\" class=\"headerlink\" title=\"å‘½ä»¤æ¨¡å¼\"></a>å‘½ä»¤æ¨¡å¼</h3><p>å‘½ä»¤æ¨¡å¼æ˜¯åœ¨ä¸€ä¸ªåŠŸèƒ½ç±»ä¸Šæä¾›ç‰¹æ®Šçš„å‘½ä»¤ç±»ï¼Œç”¨äºåŒºåˆ†åŠŸèƒ½ç±»ä¸­çš„ç‰¹å®šåŠŸèƒ½ã€‚å‘ä¸šåŠ¡æ–¹å±è”½äº†åŠŸèƒ½ç±»çš„å…·ä½“ç»†èŠ‚ã€‚åœ¨å‘½ä»¤ç±»çš„åŸºç¡€ä¸Šç»„åˆå‡ºä¸€ä¸ªä¸­é—´ç±»ï¼Œä¸­é—´ç±»å‘ä¸šåŠ¡æ–¹æä¾›ç»Ÿä¸€çš„æ¥å£ï¼Œè¿›ä¸€æ­¥å±è”½äº†ä¸åŒå‘½ä»¤ä¹‹é—´çš„å·®å¼‚</p>\n<figure class=\"highlight go\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br><span class=\"line\">31</span><br><span class=\"line\">32</span><br><span class=\"line\">33</span><br><span class=\"line\">34</span><br><span class=\"line\">35</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">type</span> Doctor <span class=\"keyword\">struct</span> &#123;&#125;  </span><br><span class=\"line\">  </span><br><span class=\"line\"><span class=\"function\"><span class=\"keyword\">func</span> <span class=\"params\">(d *Doctor)</span></span> treatEye() &#123;  </span><br><span class=\"line\">    &#125;  </span><br><span class=\"line\">  </span><br><span class=\"line\"><span class=\"keyword\">type</span> Cmd <span class=\"keyword\">interface</span> &#123;  </span><br><span class=\"line\">    Treat()  </span><br><span class=\"line\">&#125;  </span><br><span class=\"line\">  </span><br><span class=\"line\"><span class=\"keyword\">type</span> Nurse <span class=\"keyword\">struct</span> &#123;  </span><br><span class=\"line\">    cmds []Cmd  </span><br><span class=\"line\">&#125;  </span><br><span class=\"line\">  </span><br><span class=\"line\"><span class=\"function\"><span class=\"keyword\">func</span> <span class=\"params\">(n *Nurse)</span></span> Notify() &#123;  </span><br><span class=\"line\">    <span class=\"keyword\">if</span> n.cmds == <span class=\"literal\">nil</span> &#123;  </span><br><span class=\"line\">       <span class=\"keyword\">return</span>  </span><br><span class=\"line\">    &#125;  </span><br><span class=\"line\">    <span class=\"keyword\">for</span> i := <span class=\"keyword\">range</span> n.cmds &#123;  </span><br><span class=\"line\">       n.cmds[i].Treat()  </span><br><span class=\"line\">    &#125;  </span><br><span class=\"line\">&#125;  </span><br><span class=\"line\">  </span><br><span class=\"line\"><span class=\"function\"><span class=\"keyword\">func</span> <span class=\"params\">(d *Doctor)</span></span> treatNose() &#123;&#125;  </span><br><span class=\"line\">  </span><br><span class=\"line\"><span class=\"keyword\">type</span> cmdEye <span class=\"keyword\">struct</span> &#123;  </span><br><span class=\"line\">    d *Doctor  </span><br><span class=\"line\">&#125;  </span><br><span class=\"line\">  </span><br><span class=\"line\"><span class=\"function\"><span class=\"keyword\">func</span> <span class=\"params\">(c *cmdEye)</span></span> Treat() &#123;  </span><br><span class=\"line\">    c.d.treatEye()  </span><br><span class=\"line\">&#125;  </span><br><span class=\"line\">  </span><br><span class=\"line\"><span class=\"keyword\">type</span> cmdNose <span class=\"keyword\">struct</span> &#123;  </span><br><span class=\"line\">    d *Doctor  </span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n<h3 id=\"ç­–ç•¥æ¨¡å¼\"><a href=\"#ç­–ç•¥æ¨¡å¼\" class=\"headerlink\" title=\"ç­–ç•¥æ¨¡å¼\"></a>ç­–ç•¥æ¨¡å¼</h3><p>ä¸ºç¯å¢ƒç±»é…ç½®ä¸€ä¸ªæ¥å£ï¼Œé€šè¿‡è¿™ä¸ªæ¥å£ç”¨æˆ·å¯ä»¥è‡ªç”±åˆ‡æ¢åŠŸèƒ½ç›¸åŒä½†å®ç°ä¸åŒçš„ç®—æ³•</p>\n<p><img src=\"https://raw.githubusercontent.com/lyydsheep/pic/main/202412242041157.png\" alt=\"image.png\"></p>\n<figure class=\"highlight go\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">type</span> Strategy <span class=\"keyword\">interface</span> &#123;  </span><br><span class=\"line\">    UseWeapon()  </span><br><span class=\"line\">&#125;  </span><br><span class=\"line\">  </span><br><span class=\"line\"><span class=\"keyword\">type</span> AK <span class=\"keyword\">struct</span>&#123;&#125;  </span><br><span class=\"line\">  </span><br><span class=\"line\"><span class=\"function\"><span class=\"keyword\">func</span> <span class=\"params\">(a *AK)</span></span> UseWeapon() &#123;  </span><br><span class=\"line\">    fmt.Println(<span class=\"string\">&quot;ak&quot;</span>)  </span><br><span class=\"line\">&#125;  </span><br><span class=\"line\">  </span><br><span class=\"line\"><span class=\"keyword\">type</span> Knife <span class=\"keyword\">struct</span>&#123;&#125;  </span><br><span class=\"line\">  </span><br><span class=\"line\"><span class=\"function\"><span class=\"keyword\">func</span> <span class=\"params\">(k *Knife)</span></span> UseWeapon() &#123; fmt.Println(<span class=\"string\">&quot;k&quot;</span>) &#125;  </span><br><span class=\"line\">  </span><br><span class=\"line\"><span class=\"keyword\">type</span> Person <span class=\"keyword\">struct</span> &#123;  </span><br><span class=\"line\">    s Strategy  </span><br><span class=\"line\">&#125;  </span><br><span class=\"line\">  </span><br><span class=\"line\"><span class=\"function\"><span class=\"keyword\">func</span> <span class=\"params\">(p *Person)</span></span> SetStrategy(s Strategy) &#123;  </span><br><span class=\"line\">    p.s = s  </span><br><span class=\"line\">&#125;  </span><br><span class=\"line\">  </span><br><span class=\"line\"><span class=\"function\"><span class=\"keyword\">func</span> <span class=\"params\">(p *Person)</span></span> Fight() &#123;  </span><br><span class=\"line\">    p.s.UseWeapon()  </span><br><span class=\"line\">&#125;</span><br><span class=\"line\"></span><br></pre></td></tr></table></figure>\n<h3 id=\"è§‚å¯Ÿè€…æ¨¡å¼\"><a href=\"#è§‚å¯Ÿè€…æ¨¡å¼\" class=\"headerlink\" title=\"è§‚å¯Ÿè€…æ¨¡å¼\"></a>è§‚å¯Ÿè€…æ¨¡å¼</h3><p>å¦‚æœç³»ç»Ÿéœ€è¦åˆ›å»ºä¸€ä¸ªè§¦å‘é“¾ï¼ŒAå¯¹è±¡çš„è¡Œä¸ºå½±å“Bå¯¹è±¡ï¼ŒBå¯¹è±¡çš„è¡Œä¸ºå½±å“Cå¯¹è±¡â€¦ï¼Œå°±å¯ä»¥ä½¿ç”¨è§‚å¯Ÿè€…æ¨¡å¼åˆ›å»ºä¸€ç§é“¾å¼è§¦å‘æœºåˆ¶<br><img src=\"https://raw.githubusercontent.com/lyydsheep/pic/main/202412242129694.png\" alt=\"image.png\"></p>\n<figure class=\"highlight go\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br><span class=\"line\">31</span><br><span class=\"line\">32</span><br><span class=\"line\">33</span><br><span class=\"line\">34</span><br><span class=\"line\">35</span><br><span class=\"line\">36</span><br><span class=\"line\">37</span><br><span class=\"line\">38</span><br><span class=\"line\">39</span><br><span class=\"line\">40</span><br><span class=\"line\">41</span><br><span class=\"line\">42</span><br><span class=\"line\">43</span><br><span class=\"line\">44</span><br><span class=\"line\">45</span><br><span class=\"line\">46</span><br><span class=\"line\">47</span><br><span class=\"line\">48</span><br><span class=\"line\">49</span><br><span class=\"line\">50</span><br><span class=\"line\">51</span><br><span class=\"line\">52</span><br><span class=\"line\">53</span><br><span class=\"line\">54</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">type</span> Listener <span class=\"keyword\">interface</span> &#123;  </span><br><span class=\"line\">    OnTeacherComing()  </span><br><span class=\"line\">&#125;  </span><br><span class=\"line\">  </span><br><span class=\"line\"><span class=\"keyword\">type</span> StuZ3 <span class=\"keyword\">struct</span> &#123;  </span><br><span class=\"line\">    badThing <span class=\"type\">string</span>  </span><br><span class=\"line\">&#125;  </span><br><span class=\"line\">  </span><br><span class=\"line\"><span class=\"function\"><span class=\"keyword\">func</span> <span class=\"params\">(s *StuZ3)</span></span> OnTeacherComing() &#123;  </span><br><span class=\"line\">    fmt.Println(<span class=\"string\">&quot;z3 stop&quot;</span>, s.badThing)  </span><br><span class=\"line\">&#125;  </span><br><span class=\"line\">  </span><br><span class=\"line\"><span class=\"keyword\">type</span> StuZ4 <span class=\"keyword\">struct</span> &#123;  </span><br><span class=\"line\">    badThing <span class=\"type\">string</span>  </span><br><span class=\"line\">&#125;  </span><br><span class=\"line\">  </span><br><span class=\"line\"><span class=\"function\"><span class=\"keyword\">func</span> <span class=\"params\">(s *StuZ4)</span></span> OnTeacherComing() &#123;  </span><br><span class=\"line\">    fmt.Println(<span class=\"string\">&quot;z3 stop&quot;</span>, s.badThing)  </span><br><span class=\"line\">&#125;  </span><br><span class=\"line\">  </span><br><span class=\"line\"><span class=\"keyword\">type</span> StuW5 <span class=\"keyword\">struct</span> &#123;  </span><br><span class=\"line\">    badThing <span class=\"type\">string</span>  </span><br><span class=\"line\">&#125;  </span><br><span class=\"line\">  </span><br><span class=\"line\"><span class=\"function\"><span class=\"keyword\">func</span> <span class=\"params\">(s *StuW5)</span></span> OnTeacherComing() &#123;  </span><br><span class=\"line\">    fmt.Println(<span class=\"string\">&quot;z3 stop&quot;</span>, s.badThing)  </span><br><span class=\"line\">&#125;  </span><br><span class=\"line\">  </span><br><span class=\"line\"><span class=\"keyword\">type</span> Notifier <span class=\"keyword\">interface</span> &#123;  </span><br><span class=\"line\">    Add(l Listener)  </span><br><span class=\"line\">    Del(l Listener)  </span><br><span class=\"line\">    Notify()  </span><br><span class=\"line\">&#125;  </span><br><span class=\"line\">  </span><br><span class=\"line\"><span class=\"keyword\">type</span> Monitor <span class=\"keyword\">struct</span> &#123;  </span><br><span class=\"line\">    listeners []Listener  </span><br><span class=\"line\">&#125;  </span><br><span class=\"line\">  </span><br><span class=\"line\"><span class=\"function\"><span class=\"keyword\">func</span> <span class=\"params\">(m *Monitor)</span></span> Add(l Listener) &#123;  </span><br><span class=\"line\">    <span class=\"keyword\">if</span> m.listeners != <span class=\"literal\">nil</span> &#123;  </span><br><span class=\"line\">       m.listeners = <span class=\"built_in\">append</span>(m.listeners, l)  </span><br><span class=\"line\">    &#125;  </span><br><span class=\"line\">&#125;  </span><br><span class=\"line\">  </span><br><span class=\"line\"><span class=\"function\"><span class=\"keyword\">func</span> <span class=\"params\">(m *Monitor)</span></span> Del(l Listener) &#123;  </span><br><span class=\"line\">    <span class=\"comment\">//TODO implement me  </span></span><br><span class=\"line\">    <span class=\"built_in\">panic</span>(<span class=\"string\">&quot;implement me&quot;</span>)  </span><br><span class=\"line\">&#125;  </span><br><span class=\"line\">  </span><br><span class=\"line\"><span class=\"function\"><span class=\"keyword\">func</span> <span class=\"params\">(m *Monitor)</span></span> Notify() &#123;  </span><br><span class=\"line\">    <span class=\"keyword\">for</span> i := <span class=\"keyword\">range</span> m.listeners &#123;  </span><br><span class=\"line\">       m.listeners[i].OnTeacherComing()  </span><br><span class=\"line\">    &#125;  </span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n"},{"publish":false,"_content":"# è¯»ä¹¦ç¬”è®°\n\n## èº«ä»½èµ„æœ¬\n\nè¿™ä¸€ç« çš„è§‚ç‚¹ï¼š**é‚£äº›çœŸæ­£å†³å®šä½ æœªæ¥èŒä¸šé“è·¯çš„ï¼Œå¹¶ä¸æ˜¯ä½ åœ¨å­¦æ ¡å­¦çš„ä¸“ä¸šå’ŒGPAï¼Œè€Œæ˜¯ä¸¤ä¸‰ä¸ªèƒ½è®©åˆ«äººå¯¹ä½ äº§ç”Ÿå…´è¶£çš„èº«ä»½èµ„æœ¬ã€‚**\n\nå¯¹äºèº«ä»½èµ„æœ¬çš„ç†è§£ï¼šæ˜¯ä¸€ä¸ªäººçš„è¿‡å¾€ç»å†ã€æŠ€èƒ½ï¼Œç›´è§‚ä¸Šå°±æ˜¯**ç®€å†**\n\næ­£å¦‚ã€ŠåŠå­¦ã€‹ï¼š**å¾å°ç»ˆæ—¥è€Œæ€çŸ£ï¼Œä¸å¦‚é¡»è‡¾ä¹‹æ‰€å­¦ä¹Ÿ**ã€‚ä¸å…¶è¿‡åº¦çš„è¿›è¡Œè‡ªæˆ‘æ¢ç´¢ï¼Œä¸å¦‚èŠ±æ›´å¤šçš„æ—¶é—´ç§¯ç´¯èº«ä»½èµ„æœ¬ã€‚ä½†è¿™ä¹Ÿå¹¶ä¸æ„å‘³ç€ä¸éœ€è¦è¿›è¡Œè‡ªæˆ‘æ¢ç´¢ï¼Œä½œè€…å€ŸåŠ©**åŸƒé‡Œå…‹æ£®æ±‚å­¦ç»å†**è¯´æ˜**ç»å†èº«ä»½è®¤åŒå±æœºå’Œç§¯ç´¯èº«ä»½èµ„æœ¬ï¼Œå¯ä»¥è€Œä¸”åº”è¯¥åŒæ—¶è¿›è¡Œ**\n\nè¿™ä¸€ç« è¿˜æœ‰ä¸€ä¸ªæ¯”è¾ƒé‡è¦çš„ç‚¹å°±æ˜¯**è¦ç§¯ç´¯æœ‰ä»·å€¼çš„èº«ä»½èµ„æœ¬**\n\nå€ŸåŠ©æ–‡ç« ä¸­çš„ğŸŒ°ï¼šä¸€ä¸ªäººå¯ä»¥é€‰æ‹©å»å’–å•¡é¦†å……å½“æœåŠ¡ç”Ÿï¼Œä½†è¿™ç§èº«ä»½èµ„æœ¬å¹¶æ²¡æœ‰æ˜¾è‘—çš„ä»·å€¼ï¼Œæ— æ³•å¼•èµ·åˆ«äººçš„å…³æ³¨ï¼›è€Œä½œä¸ºä¸€ååŠ¨ç”»åˆ¶ä½œè€…ï¼Œå…·æœ‰ä¸€å®šçš„æŠ€æœ¯èƒ½åŠ›ï¼Œç›¸è¾ƒäºå‰è€…åˆ™æ›´æœ‰ä»·å€¼\n\n## å¼±è¿æ¥\n\n> å¯Œå…°å…‹æ—æ•ˆåº”ï¼šå½“ä½ ä¸ºæŸäººæä¾›å¸®åŠ©ä¹‹åï¼Œä½ ä¼šæ›´å–œæ¬¢ï¼ˆå¸®åŠ©ï¼‰è¿™ä¸ªäºº\n\nè¿™ä¸€ç« çš„è§‚ç‚¹ï¼š**é‚£äº›æˆ‘ä»¬ä¸æ€ä¹ˆäº†è§£ã€ä¸æ€ä¹ˆè®¤è¯†çš„äººï¼Œå¾€å¾€æ˜¯å¯¹æˆ‘ä»¬çš„äººç”Ÿæ”¹å˜æœ€å¤§ã€å¸®åŠ©æœ€å¤§çš„äººã€‚**\n\nä¸€ä¸ªäººçš„å¼ºè¿æ¥å°±æ˜¯ä»–ç†Ÿæ‚‰çš„ä¸€ç¾¤äººï¼Œå¯ä»¥è¯´å°±æ˜¯ä»–æ‰€å¤„çš„åœˆå­ï¼›åä¹‹ï¼Œå¼±è¿æ¥å°±æ˜¯åœˆå­ä¹‹å¤–çš„äºº\n\nå¤è¯­äº‘ï¼š**ç‰©ä»¥ç±»èšï¼Œäººä»¥ç¾¤åˆ†**ã€‚æ€§æ ¼ã€çŸ¥è¯†å‚¨å¤‡é‡è¶Šç›¸è¿‘çš„äººè¶Šå®¹æ˜“èšæˆä¸€åœˆï¼Œå½¢æˆå¼ºè¿æ¥ï¼Œæ­¤æ—¶æƒ³è¦æœ‰æ‰€çªç ´ï¼Œé‚£ä¹ˆå¿…å®šéœ€è¦å€ŸåŠ©åœˆå­ä¹‹å¤–çš„åŠ›é‡ï¼ˆ**ä»–å±±ä¹‹ç‰ï¼Œå¯ä»¥æ”»çŸ³**ï¼‰ã€‚ä½œè€…å€Ÿä»¥ä»–è‡ªèº«ä¸ºä¾‹ï¼Œè¯å®**å¼±è¿æ¥æœ‰æ—¶ä¼šå¸¦æ¥æ„æƒ³ä¸åˆ°çš„èµ„æº**\n\nä½†å½“æˆ‘ä»¬æ±‚åŠ©äº**å¼±è¿æ¥**æ—¶ï¼Œåº”è¯¥æ³¨æ„æˆ‘ä»¬çš„æé—®æ–¹å¼åº”è¯¥**å…·ä½“ã€é’ˆå¯¹æ€§å¼º**ï¼Œä¸å…¶ç©ºæ³›åœ°é—®å¦‚ä½•åšï¼Œä¸å¦‚ç›´æ¥çœ‹ä»–äººçš„æˆåŠŸçš„å‡­è¯ï¼ˆäº§å‡ºã€ç»“æœï¼‰ã€‚\n\nğŸŒ°ï¼š~~è¯·é—®è¿™ä¸ªå›¾ä¹¦ææ¡ˆæ€ä¹ˆå†™ï¼Ÿ~~\tè¯·é—®èƒ½å€Ÿæˆ‘çœ‹çœ‹ä½ çš„å›¾ä¹¦ææ¡ˆå—ï¼Ÿ","source":"_posts/è¯»ä¹¦ç¬”è®°.md","raw":"---\npublish: false\n---\n# è¯»ä¹¦ç¬”è®°\n\n## èº«ä»½èµ„æœ¬\n\nè¿™ä¸€ç« çš„è§‚ç‚¹ï¼š**é‚£äº›çœŸæ­£å†³å®šä½ æœªæ¥èŒä¸šé“è·¯çš„ï¼Œå¹¶ä¸æ˜¯ä½ åœ¨å­¦æ ¡å­¦çš„ä¸“ä¸šå’ŒGPAï¼Œè€Œæ˜¯ä¸¤ä¸‰ä¸ªèƒ½è®©åˆ«äººå¯¹ä½ äº§ç”Ÿå…´è¶£çš„èº«ä»½èµ„æœ¬ã€‚**\n\nå¯¹äºèº«ä»½èµ„æœ¬çš„ç†è§£ï¼šæ˜¯ä¸€ä¸ªäººçš„è¿‡å¾€ç»å†ã€æŠ€èƒ½ï¼Œç›´è§‚ä¸Šå°±æ˜¯**ç®€å†**\n\næ­£å¦‚ã€ŠåŠå­¦ã€‹ï¼š**å¾å°ç»ˆæ—¥è€Œæ€çŸ£ï¼Œä¸å¦‚é¡»è‡¾ä¹‹æ‰€å­¦ä¹Ÿ**ã€‚ä¸å…¶è¿‡åº¦çš„è¿›è¡Œè‡ªæˆ‘æ¢ç´¢ï¼Œä¸å¦‚èŠ±æ›´å¤šçš„æ—¶é—´ç§¯ç´¯èº«ä»½èµ„æœ¬ã€‚ä½†è¿™ä¹Ÿå¹¶ä¸æ„å‘³ç€ä¸éœ€è¦è¿›è¡Œè‡ªæˆ‘æ¢ç´¢ï¼Œä½œè€…å€ŸåŠ©**åŸƒé‡Œå…‹æ£®æ±‚å­¦ç»å†**è¯´æ˜**ç»å†èº«ä»½è®¤åŒå±æœºå’Œç§¯ç´¯èº«ä»½èµ„æœ¬ï¼Œå¯ä»¥è€Œä¸”åº”è¯¥åŒæ—¶è¿›è¡Œ**\n\nè¿™ä¸€ç« è¿˜æœ‰ä¸€ä¸ªæ¯”è¾ƒé‡è¦çš„ç‚¹å°±æ˜¯**è¦ç§¯ç´¯æœ‰ä»·å€¼çš„èº«ä»½èµ„æœ¬**\n\nå€ŸåŠ©æ–‡ç« ä¸­çš„ğŸŒ°ï¼šä¸€ä¸ªäººå¯ä»¥é€‰æ‹©å»å’–å•¡é¦†å……å½“æœåŠ¡ç”Ÿï¼Œä½†è¿™ç§èº«ä»½èµ„æœ¬å¹¶æ²¡æœ‰æ˜¾è‘—çš„ä»·å€¼ï¼Œæ— æ³•å¼•èµ·åˆ«äººçš„å…³æ³¨ï¼›è€Œä½œä¸ºä¸€ååŠ¨ç”»åˆ¶ä½œè€…ï¼Œå…·æœ‰ä¸€å®šçš„æŠ€æœ¯èƒ½åŠ›ï¼Œç›¸è¾ƒäºå‰è€…åˆ™æ›´æœ‰ä»·å€¼\n\n## å¼±è¿æ¥\n\n> å¯Œå…°å…‹æ—æ•ˆåº”ï¼šå½“ä½ ä¸ºæŸäººæä¾›å¸®åŠ©ä¹‹åï¼Œä½ ä¼šæ›´å–œæ¬¢ï¼ˆå¸®åŠ©ï¼‰è¿™ä¸ªäºº\n\nè¿™ä¸€ç« çš„è§‚ç‚¹ï¼š**é‚£äº›æˆ‘ä»¬ä¸æ€ä¹ˆäº†è§£ã€ä¸æ€ä¹ˆè®¤è¯†çš„äººï¼Œå¾€å¾€æ˜¯å¯¹æˆ‘ä»¬çš„äººç”Ÿæ”¹å˜æœ€å¤§ã€å¸®åŠ©æœ€å¤§çš„äººã€‚**\n\nä¸€ä¸ªäººçš„å¼ºè¿æ¥å°±æ˜¯ä»–ç†Ÿæ‚‰çš„ä¸€ç¾¤äººï¼Œå¯ä»¥è¯´å°±æ˜¯ä»–æ‰€å¤„çš„åœˆå­ï¼›åä¹‹ï¼Œå¼±è¿æ¥å°±æ˜¯åœˆå­ä¹‹å¤–çš„äºº\n\nå¤è¯­äº‘ï¼š**ç‰©ä»¥ç±»èšï¼Œäººä»¥ç¾¤åˆ†**ã€‚æ€§æ ¼ã€çŸ¥è¯†å‚¨å¤‡é‡è¶Šç›¸è¿‘çš„äººè¶Šå®¹æ˜“èšæˆä¸€åœˆï¼Œå½¢æˆå¼ºè¿æ¥ï¼Œæ­¤æ—¶æƒ³è¦æœ‰æ‰€çªç ´ï¼Œé‚£ä¹ˆå¿…å®šéœ€è¦å€ŸåŠ©åœˆå­ä¹‹å¤–çš„åŠ›é‡ï¼ˆ**ä»–å±±ä¹‹ç‰ï¼Œå¯ä»¥æ”»çŸ³**ï¼‰ã€‚ä½œè€…å€Ÿä»¥ä»–è‡ªèº«ä¸ºä¾‹ï¼Œè¯å®**å¼±è¿æ¥æœ‰æ—¶ä¼šå¸¦æ¥æ„æƒ³ä¸åˆ°çš„èµ„æº**\n\nä½†å½“æˆ‘ä»¬æ±‚åŠ©äº**å¼±è¿æ¥**æ—¶ï¼Œåº”è¯¥æ³¨æ„æˆ‘ä»¬çš„æé—®æ–¹å¼åº”è¯¥**å…·ä½“ã€é’ˆå¯¹æ€§å¼º**ï¼Œä¸å…¶ç©ºæ³›åœ°é—®å¦‚ä½•åšï¼Œä¸å¦‚ç›´æ¥çœ‹ä»–äººçš„æˆåŠŸçš„å‡­è¯ï¼ˆäº§å‡ºã€ç»“æœï¼‰ã€‚\n\nğŸŒ°ï¼š~~è¯·é—®è¿™ä¸ªå›¾ä¹¦ææ¡ˆæ€ä¹ˆå†™ï¼Ÿ~~\tè¯·é—®èƒ½å€Ÿæˆ‘çœ‹çœ‹ä½ çš„å›¾ä¹¦ææ¡ˆå—ï¼Ÿ","slug":"è¯»ä¹¦ç¬”è®°","published":1,"date":"2024-12-27T11:03:15.345Z","updated":"2024-12-27T11:03:15.345Z","title":"","comments":1,"layout":"post","photos":[],"_id":"cm6c7md6l001ia5t287w23lc6","content":"<h1 id=\"è¯»ä¹¦ç¬”è®°\"><a href=\"#è¯»ä¹¦ç¬”è®°\" class=\"headerlink\" title=\"è¯»ä¹¦ç¬”è®°\"></a>è¯»ä¹¦ç¬”è®°</h1><h2 id=\"èº«ä»½èµ„æœ¬\"><a href=\"#èº«ä»½èµ„æœ¬\" class=\"headerlink\" title=\"èº«ä»½èµ„æœ¬\"></a>èº«ä»½èµ„æœ¬</h2><p>è¿™ä¸€ç« çš„è§‚ç‚¹ï¼š<strong>é‚£äº›çœŸæ­£å†³å®šä½ æœªæ¥èŒä¸šé“è·¯çš„ï¼Œå¹¶ä¸æ˜¯ä½ åœ¨å­¦æ ¡å­¦çš„ä¸“ä¸šå’ŒGPAï¼Œè€Œæ˜¯ä¸¤ä¸‰ä¸ªèƒ½è®©åˆ«äººå¯¹ä½ äº§ç”Ÿå…´è¶£çš„èº«ä»½èµ„æœ¬ã€‚</strong></p>\n<p>å¯¹äºèº«ä»½èµ„æœ¬çš„ç†è§£ï¼šæ˜¯ä¸€ä¸ªäººçš„è¿‡å¾€ç»å†ã€æŠ€èƒ½ï¼Œç›´è§‚ä¸Šå°±æ˜¯<strong>ç®€å†</strong></p>\n<p>æ­£å¦‚ã€ŠåŠå­¦ã€‹ï¼š<strong>å¾å°ç»ˆæ—¥è€Œæ€çŸ£ï¼Œä¸å¦‚é¡»è‡¾ä¹‹æ‰€å­¦ä¹Ÿ</strong>ã€‚ä¸å…¶è¿‡åº¦çš„è¿›è¡Œè‡ªæˆ‘æ¢ç´¢ï¼Œä¸å¦‚èŠ±æ›´å¤šçš„æ—¶é—´ç§¯ç´¯èº«ä»½èµ„æœ¬ã€‚ä½†è¿™ä¹Ÿå¹¶ä¸æ„å‘³ç€ä¸éœ€è¦è¿›è¡Œè‡ªæˆ‘æ¢ç´¢ï¼Œä½œè€…å€ŸåŠ©<strong>åŸƒé‡Œå…‹æ£®æ±‚å­¦ç»å†</strong>è¯´æ˜<strong>ç»å†èº«ä»½è®¤åŒå±æœºå’Œç§¯ç´¯èº«ä»½èµ„æœ¬ï¼Œå¯ä»¥è€Œä¸”åº”è¯¥åŒæ—¶è¿›è¡Œ</strong></p>\n<p>è¿™ä¸€ç« è¿˜æœ‰ä¸€ä¸ªæ¯”è¾ƒé‡è¦çš„ç‚¹å°±æ˜¯<strong>è¦ç§¯ç´¯æœ‰ä»·å€¼çš„èº«ä»½èµ„æœ¬</strong></p>\n<p>å€ŸåŠ©æ–‡ç« ä¸­çš„ğŸŒ°ï¼šä¸€ä¸ªäººå¯ä»¥é€‰æ‹©å»å’–å•¡é¦†å……å½“æœåŠ¡ç”Ÿï¼Œä½†è¿™ç§èº«ä»½èµ„æœ¬å¹¶æ²¡æœ‰æ˜¾è‘—çš„ä»·å€¼ï¼Œæ— æ³•å¼•èµ·åˆ«äººçš„å…³æ³¨ï¼›è€Œä½œä¸ºä¸€ååŠ¨ç”»åˆ¶ä½œè€…ï¼Œå…·æœ‰ä¸€å®šçš„æŠ€æœ¯èƒ½åŠ›ï¼Œç›¸è¾ƒäºå‰è€…åˆ™æ›´æœ‰ä»·å€¼</p>\n<h2 id=\"å¼±è¿æ¥\"><a href=\"#å¼±è¿æ¥\" class=\"headerlink\" title=\"å¼±è¿æ¥\"></a>å¼±è¿æ¥</h2><blockquote>\n<p>å¯Œå…°å…‹æ—æ•ˆåº”ï¼šå½“ä½ ä¸ºæŸäººæä¾›å¸®åŠ©ä¹‹åï¼Œä½ ä¼šæ›´å–œæ¬¢ï¼ˆå¸®åŠ©ï¼‰è¿™ä¸ªäºº</p>\n</blockquote>\n<p>è¿™ä¸€ç« çš„è§‚ç‚¹ï¼š<strong>é‚£äº›æˆ‘ä»¬ä¸æ€ä¹ˆäº†è§£ã€ä¸æ€ä¹ˆè®¤è¯†çš„äººï¼Œå¾€å¾€æ˜¯å¯¹æˆ‘ä»¬çš„äººç”Ÿæ”¹å˜æœ€å¤§ã€å¸®åŠ©æœ€å¤§çš„äººã€‚</strong></p>\n<p>ä¸€ä¸ªäººçš„å¼ºè¿æ¥å°±æ˜¯ä»–ç†Ÿæ‚‰çš„ä¸€ç¾¤äººï¼Œå¯ä»¥è¯´å°±æ˜¯ä»–æ‰€å¤„çš„åœˆå­ï¼›åä¹‹ï¼Œå¼±è¿æ¥å°±æ˜¯åœˆå­ä¹‹å¤–çš„äºº</p>\n<p>å¤è¯­äº‘ï¼š<strong>ç‰©ä»¥ç±»èšï¼Œäººä»¥ç¾¤åˆ†</strong>ã€‚æ€§æ ¼ã€çŸ¥è¯†å‚¨å¤‡é‡è¶Šç›¸è¿‘çš„äººè¶Šå®¹æ˜“èšæˆä¸€åœˆï¼Œå½¢æˆå¼ºè¿æ¥ï¼Œæ­¤æ—¶æƒ³è¦æœ‰æ‰€çªç ´ï¼Œé‚£ä¹ˆå¿…å®šéœ€è¦å€ŸåŠ©åœˆå­ä¹‹å¤–çš„åŠ›é‡ï¼ˆ<strong>ä»–å±±ä¹‹ç‰ï¼Œå¯ä»¥æ”»çŸ³</strong>ï¼‰ã€‚ä½œè€…å€Ÿä»¥ä»–è‡ªèº«ä¸ºä¾‹ï¼Œè¯å®<strong>å¼±è¿æ¥æœ‰æ—¶ä¼šå¸¦æ¥æ„æƒ³ä¸åˆ°çš„èµ„æº</strong></p>\n<p>ä½†å½“æˆ‘ä»¬æ±‚åŠ©äº<strong>å¼±è¿æ¥</strong>æ—¶ï¼Œåº”è¯¥æ³¨æ„æˆ‘ä»¬çš„æé—®æ–¹å¼åº”è¯¥<strong>å…·ä½“ã€é’ˆå¯¹æ€§å¼º</strong>ï¼Œä¸å…¶ç©ºæ³›åœ°é—®å¦‚ä½•åšï¼Œä¸å¦‚ç›´æ¥çœ‹ä»–äººçš„æˆåŠŸçš„å‡­è¯ï¼ˆäº§å‡ºã€ç»“æœï¼‰ã€‚</p>\n<p>ğŸŒ°ï¼š<del>è¯·é—®è¿™ä¸ªå›¾ä¹¦ææ¡ˆæ€ä¹ˆå†™ï¼Ÿ</del>\tè¯·é—®èƒ½å€Ÿæˆ‘çœ‹çœ‹ä½ çš„å›¾ä¹¦ææ¡ˆå—ï¼Ÿ</p>\n","excerpt":"","more":"<h1 id=\"è¯»ä¹¦ç¬”è®°\"><a href=\"#è¯»ä¹¦ç¬”è®°\" class=\"headerlink\" title=\"è¯»ä¹¦ç¬”è®°\"></a>è¯»ä¹¦ç¬”è®°</h1><h2 id=\"èº«ä»½èµ„æœ¬\"><a href=\"#èº«ä»½èµ„æœ¬\" class=\"headerlink\" title=\"èº«ä»½èµ„æœ¬\"></a>èº«ä»½èµ„æœ¬</h2><p>è¿™ä¸€ç« çš„è§‚ç‚¹ï¼š<strong>é‚£äº›çœŸæ­£å†³å®šä½ æœªæ¥èŒä¸šé“è·¯çš„ï¼Œå¹¶ä¸æ˜¯ä½ åœ¨å­¦æ ¡å­¦çš„ä¸“ä¸šå’ŒGPAï¼Œè€Œæ˜¯ä¸¤ä¸‰ä¸ªèƒ½è®©åˆ«äººå¯¹ä½ äº§ç”Ÿå…´è¶£çš„èº«ä»½èµ„æœ¬ã€‚</strong></p>\n<p>å¯¹äºèº«ä»½èµ„æœ¬çš„ç†è§£ï¼šæ˜¯ä¸€ä¸ªäººçš„è¿‡å¾€ç»å†ã€æŠ€èƒ½ï¼Œç›´è§‚ä¸Šå°±æ˜¯<strong>ç®€å†</strong></p>\n<p>æ­£å¦‚ã€ŠåŠå­¦ã€‹ï¼š<strong>å¾å°ç»ˆæ—¥è€Œæ€çŸ£ï¼Œä¸å¦‚é¡»è‡¾ä¹‹æ‰€å­¦ä¹Ÿ</strong>ã€‚ä¸å…¶è¿‡åº¦çš„è¿›è¡Œè‡ªæˆ‘æ¢ç´¢ï¼Œä¸å¦‚èŠ±æ›´å¤šçš„æ—¶é—´ç§¯ç´¯èº«ä»½èµ„æœ¬ã€‚ä½†è¿™ä¹Ÿå¹¶ä¸æ„å‘³ç€ä¸éœ€è¦è¿›è¡Œè‡ªæˆ‘æ¢ç´¢ï¼Œä½œè€…å€ŸåŠ©<strong>åŸƒé‡Œå…‹æ£®æ±‚å­¦ç»å†</strong>è¯´æ˜<strong>ç»å†èº«ä»½è®¤åŒå±æœºå’Œç§¯ç´¯èº«ä»½èµ„æœ¬ï¼Œå¯ä»¥è€Œä¸”åº”è¯¥åŒæ—¶è¿›è¡Œ</strong></p>\n<p>è¿™ä¸€ç« è¿˜æœ‰ä¸€ä¸ªæ¯”è¾ƒé‡è¦çš„ç‚¹å°±æ˜¯<strong>è¦ç§¯ç´¯æœ‰ä»·å€¼çš„èº«ä»½èµ„æœ¬</strong></p>\n<p>å€ŸåŠ©æ–‡ç« ä¸­çš„ğŸŒ°ï¼šä¸€ä¸ªäººå¯ä»¥é€‰æ‹©å»å’–å•¡é¦†å……å½“æœåŠ¡ç”Ÿï¼Œä½†è¿™ç§èº«ä»½èµ„æœ¬å¹¶æ²¡æœ‰æ˜¾è‘—çš„ä»·å€¼ï¼Œæ— æ³•å¼•èµ·åˆ«äººçš„å…³æ³¨ï¼›è€Œä½œä¸ºä¸€ååŠ¨ç”»åˆ¶ä½œè€…ï¼Œå…·æœ‰ä¸€å®šçš„æŠ€æœ¯èƒ½åŠ›ï¼Œç›¸è¾ƒäºå‰è€…åˆ™æ›´æœ‰ä»·å€¼</p>\n<h2 id=\"å¼±è¿æ¥\"><a href=\"#å¼±è¿æ¥\" class=\"headerlink\" title=\"å¼±è¿æ¥\"></a>å¼±è¿æ¥</h2><blockquote>\n<p>å¯Œå…°å…‹æ—æ•ˆåº”ï¼šå½“ä½ ä¸ºæŸäººæä¾›å¸®åŠ©ä¹‹åï¼Œä½ ä¼šæ›´å–œæ¬¢ï¼ˆå¸®åŠ©ï¼‰è¿™ä¸ªäºº</p>\n</blockquote>\n<p>è¿™ä¸€ç« çš„è§‚ç‚¹ï¼š<strong>é‚£äº›æˆ‘ä»¬ä¸æ€ä¹ˆäº†è§£ã€ä¸æ€ä¹ˆè®¤è¯†çš„äººï¼Œå¾€å¾€æ˜¯å¯¹æˆ‘ä»¬çš„äººç”Ÿæ”¹å˜æœ€å¤§ã€å¸®åŠ©æœ€å¤§çš„äººã€‚</strong></p>\n<p>ä¸€ä¸ªäººçš„å¼ºè¿æ¥å°±æ˜¯ä»–ç†Ÿæ‚‰çš„ä¸€ç¾¤äººï¼Œå¯ä»¥è¯´å°±æ˜¯ä»–æ‰€å¤„çš„åœˆå­ï¼›åä¹‹ï¼Œå¼±è¿æ¥å°±æ˜¯åœˆå­ä¹‹å¤–çš„äºº</p>\n<p>å¤è¯­äº‘ï¼š<strong>ç‰©ä»¥ç±»èšï¼Œäººä»¥ç¾¤åˆ†</strong>ã€‚æ€§æ ¼ã€çŸ¥è¯†å‚¨å¤‡é‡è¶Šç›¸è¿‘çš„äººè¶Šå®¹æ˜“èšæˆä¸€åœˆï¼Œå½¢æˆå¼ºè¿æ¥ï¼Œæ­¤æ—¶æƒ³è¦æœ‰æ‰€çªç ´ï¼Œé‚£ä¹ˆå¿…å®šéœ€è¦å€ŸåŠ©åœˆå­ä¹‹å¤–çš„åŠ›é‡ï¼ˆ<strong>ä»–å±±ä¹‹ç‰ï¼Œå¯ä»¥æ”»çŸ³</strong>ï¼‰ã€‚ä½œè€…å€Ÿä»¥ä»–è‡ªèº«ä¸ºä¾‹ï¼Œè¯å®<strong>å¼±è¿æ¥æœ‰æ—¶ä¼šå¸¦æ¥æ„æƒ³ä¸åˆ°çš„èµ„æº</strong></p>\n<p>ä½†å½“æˆ‘ä»¬æ±‚åŠ©äº<strong>å¼±è¿æ¥</strong>æ—¶ï¼Œåº”è¯¥æ³¨æ„æˆ‘ä»¬çš„æé—®æ–¹å¼åº”è¯¥<strong>å…·ä½“ã€é’ˆå¯¹æ€§å¼º</strong>ï¼Œä¸å…¶ç©ºæ³›åœ°é—®å¦‚ä½•åšï¼Œä¸å¦‚ç›´æ¥çœ‹ä»–äººçš„æˆåŠŸçš„å‡­è¯ï¼ˆäº§å‡ºã€ç»“æœï¼‰ã€‚</p>\n<p>ğŸŒ°ï¼š<del>è¯·é—®è¿™ä¸ªå›¾ä¹¦ææ¡ˆæ€ä¹ˆå†™ï¼Ÿ</del>\tè¯·é—®èƒ½å€Ÿæˆ‘çœ‹çœ‹ä½ çš„å›¾ä¹¦ææ¡ˆå—ï¼Ÿ</p>\n"},{"_content":"- è¡¨\n\t- ä»»åŠ¡ä¿¡æ¯è¡¨\n\t- æ¶ˆè´¹è€…ç±»å‹è¡¨\n\t- ä»»åŠ¡ä½ç½®è¡¨\n- åˆ†å¸ƒå¼é”ï¼ˆçœ‹é—¨ç‹—æœºåˆ¶ï¼‰\n- æœ€å¤§é‡è¯•é—´éš”\n\t- æ¸è¿›å¼é‡è¯•ï¼ˆæ­£æ•°è¡¨ç¤ºï¼‰ï¼Œç›´è‡³æœ€å¤§é‡è¯•é—´éš”ã€æœ€å¤§é‡è¯•æ¬¡æ•°\n\t- å‡åŒ€é‡è¯•ï¼ˆè´Ÿæ•°è¡¨ç¤ºï¼‰ï¼Œç›´è‡³æœ€å¤§é‡è¯•æ¬¡æ•°\n- æ’åºå­—æ®µè®¾è®¡ï¼ˆèåˆä¼˜å…ˆçº§ï¼‰\n\t- æ—¶é—´\n\t\t- ä»»åŠ¡åˆ›å»ºæ—¶é—´\n\t\t\t- é¥¥é¥¿\n\t\t- ä»»åŠ¡ä¿®æ”¹æ—¶é—´\n\t\t\t- ä¸¢å¤±é‡è¯•é—´éš”\n\t- ä¼˜å…ˆçº§ï¼ˆé‡è¦æ€§ï¼‰\n\t\t- è”åˆç´¢å¼•\n\t- order_time\n\t\t- åˆ›å»ºæ—¶é—´ - ä¼˜å…ˆçº§\n\t\t- æ›´æ–°æ—¶é—´ - ä¼˜å…ˆçº§\n\t\t- æ›´æ–°æ—¶é—´ + é‡è¯•é—´éš”\n\t\t- åªæœ‰å°äºå½“å‰æ—¶é—´çš„order_timeæ‰ä¼šè¢«è°ƒåº¦\n- æ»šè¡¨\n\t","source":"_posts/Asyncflow/è‰ç¨¿.md","raw":"- è¡¨\n\t- ä»»åŠ¡ä¿¡æ¯è¡¨\n\t- æ¶ˆè´¹è€…ç±»å‹è¡¨\n\t- ä»»åŠ¡ä½ç½®è¡¨\n- åˆ†å¸ƒå¼é”ï¼ˆçœ‹é—¨ç‹—æœºåˆ¶ï¼‰\n- æœ€å¤§é‡è¯•é—´éš”\n\t- æ¸è¿›å¼é‡è¯•ï¼ˆæ­£æ•°è¡¨ç¤ºï¼‰ï¼Œç›´è‡³æœ€å¤§é‡è¯•é—´éš”ã€æœ€å¤§é‡è¯•æ¬¡æ•°\n\t- å‡åŒ€é‡è¯•ï¼ˆè´Ÿæ•°è¡¨ç¤ºï¼‰ï¼Œç›´è‡³æœ€å¤§é‡è¯•æ¬¡æ•°\n- æ’åºå­—æ®µè®¾è®¡ï¼ˆèåˆä¼˜å…ˆçº§ï¼‰\n\t- æ—¶é—´\n\t\t- ä»»åŠ¡åˆ›å»ºæ—¶é—´\n\t\t\t- é¥¥é¥¿\n\t\t- ä»»åŠ¡ä¿®æ”¹æ—¶é—´\n\t\t\t- ä¸¢å¤±é‡è¯•é—´éš”\n\t- ä¼˜å…ˆçº§ï¼ˆé‡è¦æ€§ï¼‰\n\t\t- è”åˆç´¢å¼•\n\t- order_time\n\t\t- åˆ›å»ºæ—¶é—´ - ä¼˜å…ˆçº§\n\t\t- æ›´æ–°æ—¶é—´ - ä¼˜å…ˆçº§\n\t\t- æ›´æ–°æ—¶é—´ + é‡è¯•é—´éš”\n\t\t- åªæœ‰å°äºå½“å‰æ—¶é—´çš„order_timeæ‰ä¼šè¢«è°ƒåº¦\n- æ»šè¡¨\n\t","slug":"Asyncflow/è‰ç¨¿","published":1,"date":"2024-12-27T11:03:15.342Z","updated":"2025-01-20T13:35:53.875Z","title":"","comments":1,"layout":"post","photos":[],"_id":"cm6c7md6l001la5t227e25nl2","content":"<ul>\n<li>è¡¨<ul>\n<li>ä»»åŠ¡ä¿¡æ¯è¡¨</li>\n<li>æ¶ˆè´¹è€…ç±»å‹è¡¨</li>\n<li>ä»»åŠ¡ä½ç½®è¡¨</li>\n</ul>\n</li>\n<li>åˆ†å¸ƒå¼é”ï¼ˆçœ‹é—¨ç‹—æœºåˆ¶ï¼‰</li>\n<li>æœ€å¤§é‡è¯•é—´éš”<ul>\n<li>æ¸è¿›å¼é‡è¯•ï¼ˆæ­£æ•°è¡¨ç¤ºï¼‰ï¼Œç›´è‡³æœ€å¤§é‡è¯•é—´éš”ã€æœ€å¤§é‡è¯•æ¬¡æ•°</li>\n<li>å‡åŒ€é‡è¯•ï¼ˆè´Ÿæ•°è¡¨ç¤ºï¼‰ï¼Œç›´è‡³æœ€å¤§é‡è¯•æ¬¡æ•°</li>\n</ul>\n</li>\n<li>æ’åºå­—æ®µè®¾è®¡ï¼ˆèåˆä¼˜å…ˆçº§ï¼‰<ul>\n<li>æ—¶é—´<ul>\n<li>ä»»åŠ¡åˆ›å»ºæ—¶é—´<ul>\n<li>é¥¥é¥¿</li>\n</ul>\n</li>\n<li>ä»»åŠ¡ä¿®æ”¹æ—¶é—´<ul>\n<li>ä¸¢å¤±é‡è¯•é—´éš”</li>\n</ul>\n</li>\n</ul>\n</li>\n<li>ä¼˜å…ˆçº§ï¼ˆé‡è¦æ€§ï¼‰<ul>\n<li>è”åˆç´¢å¼•</li>\n</ul>\n</li>\n<li>order_time<ul>\n<li>åˆ›å»ºæ—¶é—´ - ä¼˜å…ˆçº§</li>\n<li>æ›´æ–°æ—¶é—´ - ä¼˜å…ˆçº§</li>\n<li>æ›´æ–°æ—¶é—´ + é‡è¯•é—´éš”</li>\n<li>åªæœ‰å°äºå½“å‰æ—¶é—´çš„order_timeæ‰ä¼šè¢«è°ƒåº¦</li>\n</ul>\n</li>\n</ul>\n</li>\n<li>æ»šè¡¨</li>\n</ul>\n","excerpt":"","more":"<ul>\n<li>è¡¨<ul>\n<li>ä»»åŠ¡ä¿¡æ¯è¡¨</li>\n<li>æ¶ˆè´¹è€…ç±»å‹è¡¨</li>\n<li>ä»»åŠ¡ä½ç½®è¡¨</li>\n</ul>\n</li>\n<li>åˆ†å¸ƒå¼é”ï¼ˆçœ‹é—¨ç‹—æœºåˆ¶ï¼‰</li>\n<li>æœ€å¤§é‡è¯•é—´éš”<ul>\n<li>æ¸è¿›å¼é‡è¯•ï¼ˆæ­£æ•°è¡¨ç¤ºï¼‰ï¼Œç›´è‡³æœ€å¤§é‡è¯•é—´éš”ã€æœ€å¤§é‡è¯•æ¬¡æ•°</li>\n<li>å‡åŒ€é‡è¯•ï¼ˆè´Ÿæ•°è¡¨ç¤ºï¼‰ï¼Œç›´è‡³æœ€å¤§é‡è¯•æ¬¡æ•°</li>\n</ul>\n</li>\n<li>æ’åºå­—æ®µè®¾è®¡ï¼ˆèåˆä¼˜å…ˆçº§ï¼‰<ul>\n<li>æ—¶é—´<ul>\n<li>ä»»åŠ¡åˆ›å»ºæ—¶é—´<ul>\n<li>é¥¥é¥¿</li>\n</ul>\n</li>\n<li>ä»»åŠ¡ä¿®æ”¹æ—¶é—´<ul>\n<li>ä¸¢å¤±é‡è¯•é—´éš”</li>\n</ul>\n</li>\n</ul>\n</li>\n<li>ä¼˜å…ˆçº§ï¼ˆé‡è¦æ€§ï¼‰<ul>\n<li>è”åˆç´¢å¼•</li>\n</ul>\n</li>\n<li>order_time<ul>\n<li>åˆ›å»ºæ—¶é—´ - ä¼˜å…ˆçº§</li>\n<li>æ›´æ–°æ—¶é—´ - ä¼˜å…ˆçº§</li>\n<li>æ›´æ–°æ—¶é—´ + é‡è¯•é—´éš”</li>\n<li>åªæœ‰å°äºå½“å‰æ—¶é—´çš„order_timeæ‰ä¼šè¢«è°ƒåº¦</li>\n</ul>\n</li>\n</ul>\n</li>\n<li>æ»šè¡¨</li>\n</ul>\n"},{"excalidraw-plugin":"parsed","_content":"==âš   Switch to EXCALIDRAW VIEW in the MORE OPTIONS menu of this document. âš == You can decompress Drawing data with the command palette: 'Decompress current Excalidraw file'. For more info check in plugin settings under 'Saving'\n\n\n# Excalidraw Data\n## Text Elements\nBroker ^vpVFc8Jz\n\nConsumer ^HlcmoCYz\n\nPull Message ^iEKLY3mc\n\nProcessing ^4SqNDxs2\n\nsuccess ^i4gc31t0\n\nTrue ^6S02Vu74\n\nFalse ^thrRj5N6\n\n%%\n## Drawing\n```compressed-json\nN4KAkARALgngDgUwgLgAQQQDwMYEMA2AlgCYBOuA7hADTgQBuCpAzoQPYB2KqATLZMzYBXUtiRoIACyhQ4zZAHoFAc0JRJQgEYA6bGwC2CgF7N6hbEcK4OCtptbErHALRY8RMpWdx8Q1TdIEfARcZgRmBShcZQUebQA2bQAOGjoghH0EDihmbgBtcDBQMBLoeHF0QOwojmVg1JLIRhZ2LjQARgAGABYAVn5S5tZOADlOMW52pKSAZk6eTt6pgchC\n\nZgARdKgEYm4AMwIwlYgSbggAIQBOegB9dcIARwA1ACUAUQBZAFVcbBYoZ7MLjHPaEfD4ADKsHqEj+bGYzGcklwUGwkgapWYUFIbAA1ggAOokdTcPiFATYvEIKEwGHoQQeDGQHF+SQccK5NCdY5sOC/NQwSadbnkiDWOoVEWNCCYbjOGbxADsyW67RmSXafUV8Xi7R4iuOgrQ8vaiR1ip4vRmMx4l0VSWOWJx+IAwmx8GxSGcAMTCv2dJkQTS/XHK\n\nFkcYhuj1eiTesTEbrEXCBijE9FoeIzbSXToKy62i2LU39UWSBCEZTSSbtS7aHhJeJJS4zXrde229WOhA7SZ9U25pbdY5h4RwACSxE5qAKjUgAEVcABBboE0gzCEEmaKmZPPaaCh7Hg3B4ABQg5IAuo7KfiIcjSHB2Qizsx73BA5phBG3sFMtkpzOjTFLOJy7BInQIA8HyEIqY57AAWnOHAnh8NyEE8STnE8YxMqUsCIGcuCkDiVDkmAAC+l7HEIc\n\nBJtsYGoO027xJ0LEzJcvS6vExxEBwuLcBwQjgjxbDYPiDEHPgRyioQEZYIRvSBns5CZBOAlCfgxzhsQT5ToJ4KFORAzAZA+EVNAWBQIGQytJM8SWscNmjOMFSKm2OpMTMQ4yRsWw9mgknSdKpwSPQcBPAAYtgSQAFJGEpYKQtC5nImiIhINezqEmmkyZVSNJ0hADKnFpwiVrpuWiry/KwEKUqlOKdL1ZAsrGuxnTaFMLbNoqJbSkaqDOFMHWqtMa\n\nrtL0lw6kk3nSk6VJRp6Pr+sKH4hiOQgRotMboNi1jMHygTZCmOUdF02hbpcbbdPElxXXaPBktKZYVlWaDdHEDYWr0vTTI9Sw9F2/moFaXQFq2w4suOk75GREALsuq7rpu267vuh7HmeVGivNt5vhVEivkR77HJ+m3ED+GRZDksOziZpQhegBLrOcADSuAABJPDFAAyIwcLJPMGM4mCSJ0ADiuGmeUhHEWwpGzpRjRXqKNF0cDnksSxlo2jdPGyfx\n\naD6ZpooemJwOBQgIKcFAEKEEYFReXWzZJD0iqLK7nSzNb2QRbg+hggN7THNsmBWRI5xZV6pOhEEskVMsoqh1Ai5EMobToMEexWY5TBQOYBCpxWGfQLygZ6NkuDx6QalGxpPKkBWskEAAKpZZyR1S0cyXJrXoLg8RKSpCC16gxuleTBNj/XorkBQbdhx3UeBrgQhQGwLzhPbFTYkIVum/HHPlpW4eMXWvSGcZScyxIvEZaKTkZ9Mly5y0zkcBMHSd\n\nIqUxtgs3E+U2MEei+xDj72CgxCAAArXAUxxas2IPEAA8usKBUlzjtByJIH4DwErggKuZOECIkQojRIGXG2ViAkjQE9TEN5qTJRfO6Eqs8ypsg5NwZqEBqrYAFHVY4jVJTHD7vKFinUli9TbM/boH0ZiGjlHMLMbYugaiSD/SaNY8qundEtWMK0AwxzEhtLaOidoQDjDsRMyZjipioemVA3QkjZnzLMPU9pegWluscF6J9uBZibGo1sPAugyIkaaB\n\nAQ05E427AxLW3RhQyNoZADa0MAJwwRiuNcG4tw7j3AeI8p5zzKy0dSfGHCJDaQ/F+Cmv5qYARVtKNWKINbMVYvMfsM19Z8XUsJU2olxKgKkuAuhREoDnFko4WoPSTbSiyMQcZEZZLKGmTxUIUA3T6ADjIHYJ42CyVPuPHGURSApzlhQMsuAGKHNmRGRcZyLlXJntKOAez/y00aIBRozUSidDIg0j5ZEwCOOcfWGYbikgeJ4F4wF/jLiBI+iEvsP9\n\n4gRLVH87GwVe6EUVEPf2I9Hm9OlNpKe9MygERoeSJWFEr7SjMmcO+1kmDDAzvmYOD8mWtDGB/BOix3bKI+scNYQCEAgICmAwVkD1g8FIAADUwGwVmDwhBszCsoHmmB4IQkuAATWwHgpKtJCE4mIciVE6ISlEjsaSEpBCmGMgnuVcpqAuE8L4V/LhgjOHCIUWI9Uk1eisS6PmfUfVSgDWcLaOI3Qcw/R4C2FsrZtwlO2stFaa0jHaRTbGeMViTpWv\n\nek4u6oLwWQuhc9Y+b1UCwvhcEnoSLwmRKBgxK6Ux2hdVmqUFJE40kgQyUjbJqM8kY0KRiuhWU7zEynhASppNqmUz/DTNAeR/mQCaaKxirTtYdI7ZAXihtp6EtKGbAZYqhnXlGQsyZyy66HsgHMy9SyVmmzWRsrZ9Fdn7KfXNY5pySIPK/aUOZdy/0hAJTM0oLz9k9oBbOMA3y4N/JWGAT5JRgVFtcfqCFniX4wuSHCyRtbQlMQbWi2cF5R2rCxRI\n\nXAKQQTD1Htc0oxKnWkrpRSxoVKjKFBMmS8yDLX7Mu4DmKJ0pH5cs/hu+JbbrSJ2Cr5YBFtxUyUgRzFuUA5wQpuASF48RWY8BeGwOcMx6D6BPJ0XYIJEq2thMaxEpqyEWtOrwG1jDCbMIs6w1kU8XV8l4bVd1AjahNW9W1MR3R1Q5mbJcINOYAH9TlPWdo2gAbzFBT9fsoaKRZSzegX0abDGhkzaYn0Oakx5uoQ4wtLiwWYdLTh8tr1T7VoI4isJK\n\nLG3ROBg2YJipepXUhqObt7zSh9qySjXJ6MClY2KUc8dZTnwVOqVU8m866n5BXRANdLSFRtOCSxTpB9uk3vA7u/pimz1HIvRMx9x3jj3uu1M27z6sSvrUO+15BynkjJOcB+W/6ns3OIL985oGAOQEg28pdZEUNwaQwhsjSGYdoeqyW7DcPmtBNa8R9rpHlYUZOFR/ulxcWqTAxPCMJK4Zsd4JSy+3Hr7kszvHRlb8WXfwE5yly3ALSON6LaHUgr5M\n\nivO0FBmkCzD7naOcIQzAPhQDeBzKBzgYAcBgLdIQHnpSgnwa59ARC7OkPNbNqklqKtJKKvQ6z9J3OBhZI6hbzqeS+bdYxYUgWJRetFCInb2hwtNk6FFmLrF5HGn1B1Pn90ZNuXtGy792Xit6Py6KYMGbqk5fMaV6xopbEVeR8W2raPSwVqa3hmtWPkWopE5iGJpIwa5mEzuiAXaYZQ97UuTJyMclo3yZjIpJQNsUInQ+KdM7k9ztqZD6cG2tsMU1\n\nrt7dXT92MdO+bCSSnv1XcWY9g9J2MARgfdv5fEB8AvoMG+nZH2wcW9GcD/7O+7u3PuaDgHEGPvQZKDD+DvyEfQ8BXnjD7ihesGGOCKdabWle6KM2mKxA8k1Gi4JO+KV+zGDurGN8NOHGdOJQPG1OFki8HOnAkwAaDo7KrO4mCckarEW4SQ5uQqfka+F2ECZwHM+A2A+gbALo2q8UlmOuhqdqLCceJuTmseY6+UuuRUNuDq7CDuwhkArq/mruHqQW\n\nQiXucoqocQ7EM0W4mWEAQc8QvQyQ9e1BoMOo0WyaCeuW+i6ahWae5hEA5yag980oOe9imotYCwaiTEehpoeh5uPilaH0nU0w3UvUVovWj0TavYaijinQYMA2NEQ2re0o6wDwc4uImASCHwkgSQewLcPA4sewnQLoY4RgbwIwVk+Og+82U4RUb4y234E+i6U+1EtEzSs+m67S+2jee6V+x6IuwykAewNsdsDsfiWYvUrEairs4WMRvWcWpQgxvs/s\n\ngclUtK7cEgboHAzAQgmQ3c0owYYQDKHQxBqxYcRc6c9KCA2cLO+c7gZxJc68JMooFcUQ1cDGX2shjc/grcax6AGxWxOxgYEysB/cksdGeKbxt6061SU8R+c8C8p8EAfx2xTAK8a8G8W8IxaAu8/Rx+h8xekw58mBRQDO5kQQRAcgjhgwHKBBNC6o5uYmXOaA6ofKFo7sguwq66lsEqZwPAbwnQygEI8ElwmR5wzAEIcApAMAuI2qUC2qY4EI+qVu\n\nEA+uJCZq5C9Cpu9i5ug+YhxUmuTGbC3mTuNUQcbuoonqXIIWg0YKbh9o4WHkv0nE9WYa3AP0nU0eehswxaP0jeFC6eeW/oVhxikYthFiCYZWNiTm1oF0HYM0Ae0w8QH0cxkAfhp8tonUmYwSKiehlB1oERaArsloRZDYcRqSw2kA2APMNwLwkgMqzAFAIwuoPABIIQ3QMqBIYwc4uEEATw8QuRrMygxAIwUuiCzAi4rBbAmAjcBI3ZyRqR6RmR2R\n\nuR+RhRxRpR5RUBIheMk6TqNRxMdRNSVMk+y6zR6sbRO2W6nRi+PRZ29BoulGMBfcYoHMCBEJu+yBekGkRJ2BaBGA4IhAFJLOgmNCSZ+BHAZBpItoiSwSjetBCmd5OJjMEAiouACAQgLoUAJ4LorMLwzAWmUALwi4MUPATwkgY4ipYhKp9mRuAh+Imp1qxut4upEhnm9uU4PmJp/C5pShnu0o3u+Y4icaP8ioU00apoIeIMiQE0Hh+ot0rYiw2hfp\n\noZlhBWwZ/pme5W9i0ZNoLs8ScKDYoFRejWpItYpoNobaXsOZmYeZnWDEXkzYMiSoxxnaUMCR04cMlZ1ZtZ9ZjZeoLZuAbZHZhm3ZvZ/Zg5w55wo545bBU5hAM5SGEAc5aRGRWROReRBRRRJRZRfeYAA+luVRL4tRs6K2DR9Sp5rRkw7Re2XsXRBsN5q+gy95BOj5hE5FYJpOSB0JTqxs35JJ9KzOYFpILEzpTQ1J4FjJIMHE7soMzlqwQunJ6+Yu\n\nZwLchAXwrgLwuIMqcAQgHMc4Oo8EkgMUm8ewVA3BBqhUVFhu6pWU9FNCLmvBbm9qrFUh7FxpfmppihHulpKhbUbkyWmonEw1EWjiBoooQcbpWs3Wj0MeDYs1Fu8e0YqagZqlRWiN2aliEZ2eTm7syW0arEmYGW2o3i+JGYn0wS0WbkcKCwMR2pNeBZCacwbYXCze7+FZVZNZdZDZTZ/lgVnZIVfZPAA5Q5I58QY5E5sV8VcMSVC5qVy5GVa52VFR\n\n+VO5DuUJ5MB5q2x50+LR66c+l5NV15L+K+J6qAXJl2JyB+169+oo92W+VtR+J+L2Z+b2F+n6Rt1+P2T+lyV+QGXtZOooEOjRKGn+cO3+m5H+gKyoOYrhQS24cKMicOzgqoCQ9YcKmo0eQaF8P+s4MO0ZDYCaXUTE38t0yZJQzg9kyQ5NTE0a1BwoeoiGv+sGk0ldnEXscaLEpoJZgKSdUl7susOYrinEMwDdOdkd4eeNOoYKLEHipdYASdMZUKH0\n\nCwPAjiDYzYI9MGs4X+kB/egqhOYoMUr5/tRKXVKBVOaBPAtOJQXGWBfVEgZJAFYQQFtktJcaYFEFHQlo4WMaAugCdBjViFkC4s4F6wXwY42q+RMAnQNwUCIwvQBIi4Lo9ATwOKZ1Spl1apjm+azmjFDCD11uT1J9XmTqHF71XF0oFpjuP11pnEyQUwURXkMirE/WYN3AYiaoQSaiehcKllZhaNFhSeex60qNuiuWGlkZ2DConUWZ5NVo1BmoehxN\n\nxlTJSW09ad7sHEUWvpdNjEOomY4WN05uLN5Zyp7N3lXNflrZ7ZfNCVoVgt4VItYtMV05s5KRyVi5aVK5mV65OVeVc2Kt1RRMD4GtpV5Z9MqwkCzMbMnM3MfMAsHAQs+gIsYsoJgKvGssJEOVFE+OM+lVF58wVoK92h3R7tvRCFe9LV1GrMR9nVk83VX519NKeEv5/GJBwFG64RbTnO3KvYejV0vUcNcFwu5TymZwIwNwbwLomwPM8QUA+ApAHMXw\n\nMUCAyg2A2AFAJ4uQaDlFtmqpDmuDt1ODtFeDhUeptuhpJDb1LuXQn1wW1D8oloMZEx0aLseoyZOhQmTi9o0WM9EKqorYI18NC0ylgjpQKe1h5M6lGNWeThTmtDSZ9kUKU05odoSjviGYWYmo8SvWvWU0PQZa1eGsGoP89YUFpZblKGPZAtQtEVUV4tLjCV0tKVS56Vq5WVG5u9uDQ+j4u5o+ex4+R5Qd2tZ5eTWsHRBth2S+7xx+t5AD56FtD29t\n\n0rttV6PRp+myLtxAH6x07tWIN+ftPtj+IG3t7tgdrNIdgKYdnLo9sGXzNot0/YMeAzidtY8SMiW4bauobaqoG9EdsGpo0jUwrKd0bsyLidmonU+NP0SoqoSoTElwvryGgK9YyQEKiwjYgNslnE4b3Q2gvWcZba1BN038GoibudyouovWjiN0MifQNo4bcQ2oU9N0HiHiU0V0Zbf+WYk9fQrs7UQRgM3diQPQHiAeHiNbYKNYnbsGbYCQUWYKXs0w\n\nAaVejQcQjYt0tdUedbWd4dSbTdSWPObraoDYeo9bgKaovu9lXQxYaiNosw07s4bpXsYKU9nsrsv9sGK9gRoK1BcKkKuYw92dm9jQ8LUKiLJdKLoNwBcQPzEesWEWjYD7IH+hz740jYwo77s9ydiZ1BwSg4CwzESHqGtYGjpo2oao24aoK9cOfQCQ9ot0fQmY7bj0RHQK6hNYU07s/0woHENHFb87KiS7uYl9QHfrs4YKyWhY6oz8hZ9YWHTiConE\n\n2ok0P839Inu7MOX7fzv06oExeh9kK7qGyoqWUwP0rs0bt0rHX7UwP7toWGNYmWJQW4CQTEbkM0iZoSbYVnSW0ajp9keh7ErJSSTnSW/70nAS7S97one7s4AbIlCoW47s24sbfOcOj0GZ2oMxzEkW3QrH50xdNn9kTD0aDkgKrrdaHrpobaeofOrH29ZG+OQJT5uAPMNT7tH53AqBjO6n2TjT9OtKLTA1XTNJvAMx79E1ANSw9Yji7zQzC1DBS1Eg\n\nCE+gIwUCY4+A2q3QLw2AygLwLocAUC+gMq2ALoIwFF+Dypuz1F11gh2D2pluzFhDBpxDDupD1zZpFDPF31fFCibpP0+YVoCobY1ogLA0cKebDr3hOYwogNfDoj5iKlyewjNh/DGe0Lmlrpubqox7lbTEaiuYaLlaehyQC7k0Go+oIl0a+ZqA01FoX0cNxjiRpQdjNLjj0Vk5DLUtbjMtLLXjCtHLuVNqBVi26txV9RgrZVqsOt22Yr1VB20oJT1t\n\nCvsrp6TVerCrdthr8yirarTtGr2yWrl+urP6t+z+SvgGRrf2ZvR+Zr5ZFrsGVrgvjds45deb1dP0bdzY5oP0idyoEW1NGicauYbarHQ0ubXQOo0bbkZH9eDb2gAemoNYrhcn8ZofUKyQG7CwW7TlO6ZdeoEPzbehvUIl5oofLYCQBTbaUWnE7r4bHU0eLiVHG7v0SQof2Hjij0E0moBHQPidubuYbsjNdo9kuYbf+hTlDHQ97bfQNHebJnEKv0Cl\n\n9kbfJHCfSouoOSWLjnYAE0vuAaCjt038rYCaofVo8fTlHEE0Swd0FoaXUlPDbncadbbaPXTvNrLvrYvu0mJ7wl+PhnYATsZsMXUTI1YkurYU/lmFYjfMlg6WG/sFyBTdt9Gi/ftjNHaBt9+O7EBdtMDTYz8/8GA5sIJzTb6g2+HUYfu5Bh7RYFQvUOHEsHj585PSmYYPmojL4dRHofze0NuDw7B5AUZ/KAU2BgHX8poO7a1sBzz5OJXY0wNyHGke\n\niPQP2j7SARfwEEcdqCofJiL7gC5ekJomYUGFB1nDxJsw2ocgYsEoE/xVBUlYJE2HJo5hHE6OXNkAO1AgC3EbSYQW/1EFz0I2EfPQkp1jZ90RqJQLTq2B07vsGwrbUPk4jaRXRhqHEFemN3PY+cawSoIHgHnzDWhAOGnS1qHR3quCHywJMUB8Da7m9mQp9KcF1wqA9dOMTTCJmcE6DnBFcDwTAC3HFhCB1gMqIwEYFxC4BOgMUDmBFCCCBgcCrTH7\n\nqFn75SDescwJsMinebhoI+2YZvnJxjSKIJGueJxCvU0Z2h86cwAPI3lTK9g4grYJsBm2mp9A2w7uOkJi3VBahi+vOQIfdwRrw9fQaiPYL0E0BBkRGZib0PEmwC8pzuhUVKBoECA3c6KQhe6qcxYpEM2KKxUoHIQ+rksW87lECH0A+AxQXQpAIQC3A5g8xcAIwVeL0BuCKp4ILwGYL4yF4BMzgfLQlrPm1hgp7Q1BQamgCtDzBxuPTekeZWix2hYK\n\n81PomL0PILo3KNvN/HbwyGWs6u4iaLPMCkxjDpg+LOHF0GVDbgxhMeDiDERbAijhQbkRjkGx6BVdMwugxoHqA6jChzK3fHSn0ATbRdNOvuGaFNAsrChOi2bc9o8zmAFgvYnHdiL9Dy5JYX+7iTUGCimL5gZR6ZGkaCmuhzAawr/FdDF1Xbj8poloJiB4lmAAd4B40QItGg+iuwxhSnVjuxBTrrCHod0W6HCgDGFoAW6iK6HpUVCsdZ2wnGPHWiEH\n\nsQAx3bR6AOG1B2g3OlY8IdqDUT6hL+1XBUDKJrDSMCaJXCRAsBcERikcKwuNEsCLquc5OufHfgHnPjp0JoGjaCu2MjaoCLQFlEStwNgy1hcwEKK6BCg37Vs0B5ovASqH4F09BwN0GQmXRGj84Qi00VUPKIrHniZ2ubcYu5xkEWg06idfQluJ9I1gFKWorMZOMbB/NLBP/ROl8w2HzA6eXvaNFZyzDdQdQdaRMnZytDhsksSQy0NqHrDxlR+742Lj\n\n53YjRZ9OyQ7rC60roMdlRIlG/pmCs7n9pxTYG6Dkjujexu6ubDfqkJXpeFdQtXYiY0GcAGioUi7Gqj9AtBeQJo8AkSef2B6jstCUAkdnV0yENdw6x+dVufkN5u1ChHtMZDr3doqsbsek9Xr+it4ms9JvtY1sfQZj71cACpdqogXa7FDOu59brpSm5Ga0hW5VXWlVQXySt6qJtS2L1UYISAIQDwDUPQHwC9AhAzgJIC6CaFfAIoMqVmFAAJB2B+hg\n\n3dkIGG9wV0NEGgzDH+0bzhptQdYe1o2CzID0sJWNbBjdDzZx182IlfUE/0J6nw20bvb+JaBjTiiawK7MUF9yrSdQLhHiK4Qvz6C3DgWqPB4YqCeEvCUaKPeHntE2KHRqYPw8yGcywYVYZCQLJihd02nPUp4O06EeQxcqDY4RlLREciNRHojMR2IoQLiPxGEjiRXLYXpUCWzU9pqNzekmNRMoCphu41ZkYxBK4+i9CHIjklyLHwlVBWfI6VrbyZ6R\n\nifkak9If63KmPQHKIlWGu2Fn7TQE+6bJ0rqFy5CSSgiQVsHozbZTVbonTW1slhmgz0foEWIHvEDy7dsbO01WQYmm37nQOIOonDkeKhRpCRBYnVdtxKmi4cA0MaX6G5H7HulLQ38KLFClBTMziZAAitrGJq6sRF6JwsrgkCK5NhIhNdOmZWP0JxjLoQggNPqE1Cz9TQOYQApNCbKcRKxiQMYa2LUT5gpJ84uSXIx6xCDyOCaVvupKFmaS9e2k7Vp9\n\nkhJmTLaWvKOcb31Y2StepvSyUfia6EQW4BQ2Eq5LQClDSQnkqGeLwXSS9Gk0vc8rLwCkK86qpTFXqbTAShTFu6ACKPpmMw8xNArMUWPECgRfANMBIKBBCHWAwBzgWUxnLiRylWlREkAmPDIhJYyY5BkAcNDaDrDTUIUbaQGjpW0LOFuA9UxMgUxkRuycyvhEmqgFrDMlfRcwffvZGlncUvqQ049pcPHbjTUuuDf0l7FmnPDXhi0sxMtIOhEQ1p2z\n\nfaWCK3KUJtpIIjaf/KKEvcpwx053PIRuawjWaEAK6SiLREYisROIvEQ8AJFEila/jYfLyw+m2VSQ38G0M/Psh0iq038RvAySBlqg5gXEJyuyX/qq8cSZMfOdTFhmQl4Z8ItwfVxRmxc6w9YXrHWihSw0F+6OPNqqBbQcRVE8lesKx1Jndjo03UK0LGj8FgBEgY0diI2Eo584FFLMyTs2AVBSi2w/qXUSUFgkCy8eiZd2XCis7cTFZ/YfpvbJUXFi\n\nW+slcLCJRCJZjlQEiQIYsCoLyM4cco44Xzn4Wksp2Ks2jvi1kFWjcw6o2eihPEXWglFEKWtGeJ4WNBN58SL+iDSEGMju6I0MFOFh9KUEvCdoLIRtkdrrJnaBvMOVfkjmGSrJ++epUfjMmJzbJd6S3iDiTnSsU51GL4OnOlYdcs57ksobnP5bQyC562XyTL3nxXlAplchqowtrnSwh5D9QCqQpYjxImREmd2CXSiI0FORIzMKegDXhIJ9AioJBMGE\n\nXDtB4IXwD4PYB5hfAng2ATYutL4L6ksst3IBVy0e78FnuEIjoFc2gUfcGog084XTN6x3yfSD8oYdaUzAxleoxGMGPWAkpY9WSO2FsBNGiFw0lK005+XNLfmQtQyewYlRj3ejKhbQXQKgVvwmltTa88fIpmMK3BeDmp1PPUIvVNByzYFJjBBTdOQX3THp6C56VgvyhvS9ywTCprkNwBPB+lkJQZXpOYU8i1sS6YVhVQ6D+TZl5co7HpLKYAMlloEM\n\n4JIFxBzg5wPMIwDzCSAUAvg8EFuDAAQDnBxYPMEIEgh4CDzzIVQGoB7lHlXRksw/TiKV3iz0iSO8YmrksK1IXsBwWg/1aUB2FfwxiwfKNZAEoZcIcV9w9oAgDTVpqCVJiVHp/NWnHRf5oIp7h8qBF3dgFby85uAt4pQioFMI0UIzyaKihlI4JNpc1UlWS0iGFOFjMMr8SjKKRlVK0PEiUmkKd5WyhONwwsqFi/68FOVnnMVXHkyI4TfVRHCgAjAX\n\nQ9y9YDMBuD4B2gmAegBzHaA8xOg2qL4IPDhzpNqMZyLJjfSAhpMkKXwZgPtjHCsxCAmRJBNgAtBfBcQkgB4IQBii4Iz1OBIiJkzIhUpshm2YuaKzaQg8bOhtbVVXJCl9db6RyiAFE3ZhcxeY/MQWMLFFgSxXVGTeWLlIUTqh4+NWbQgND5x1g5KpG0NQSTFGRrtCMaxiBCn+p+rtCSauHu8IzXprKSkAcFmpVsK5rv5+axtVZh+XvLdpgCrUmWse\n\nq/KwF/yqhtKBOkBY61rlC6RtibUdV3aPS/uPBArWdqz6IEanOUNZUtsYiPQHMKQuAmjrXSh/fhV0HoXTrGFXk0JgjMXU4Fk4UsJdegEIBvBWYPMbVDMH0B6oQNOTCDWqvyagpLQxTCuXBoWXVyFu4OAUQjPt5b1VB2Ya9qxvDbMaYB9kMcfjgqWvZqlRvThXn3S0xFMtZEIaNlvo1K1N8qrIZSBHSC8igGIDMBhAz2BQMYGcDBBkgxQbdlBi2AGX\n\nJwjoFbgZuzDDUG0i4YJVlAuAd8GgGVCBJO6YeP1DTUc4QBQQmAV2jqx3y9r2l2vTXg1tmQNFR4DAcKFFFihcE4YA2obVyHj5XQupAHH+Iwwmi58m8s2jeRdEWBsS+c0fbcJNASobatt4c/ALtv0mtKE5BrC9Zkzuz4BPwFAPonqqQo+a/NAWoLXhokAebR58SUgYY0W0U98wJUuUBRv0qJYE1dhIQnGnS13QpgEKsztrIazoteAbGwacmvoT+kuN\n\nmahaYSpzXkAVpQmnOCJp4KFrZNEmw5pNL2nC7xNduF6lWtkI1rTpySVTYXPmL0YW12msUPBGlXk4dI9TCOToxq7+zYslm3UQwDGof0HEy8hznrCnXDMZ1YylhZPiPy5NwtsvNyPMH6mK8Ha8GxaqZB+IQATwGkVAB8A5DRAeN06SgPCTOAB7wQQekPcoDD0LFbY28AhT7CgB+wA4+AcjSHEsh3EzgYgbICiVfg3FC4acEuAHGIDEB6gxwZ4lXHZA\n\n1xImLMNDbE0w0JNsNKTQMJ6CbgcBvii8CQNHvwCx6EQoe1EuvE3isBMSqAbEl0gQBHxlGZ8S0IjsgTnAV1a65gDzA3Vbqd1e6g9UepPXo7+4l60eYvU+2HitCElcHjEWIyBIaNHQCuivQsHUCjKjOjqF9Bp3M6r5rOu4Zxu42c6keqebnUtN51fyjoAurXKJr/lFrRdTmcXScxAWQHpdRpKqPLuU3Sh61J5Rtarqvzq7cA80zzPppKHdr2MiGvtW\n\ndBtKU04aj8UkC2Gs3zapEM0CwQ5tt1ObZ13k5XaujC0boItV0esNFq1Ve64tZtZ5ElpK2IzYcwolWRyrrAIpr9lrDPj/ECRlLVkIczVjUoRmSH79b+pDC/rjYKGNJdSg7Q0v231bUApKJrawsgSGrjVpq81ZautW2r7Vjq3AM6v62iQbtzqcqWyuPF84F+g4ExW9rm0091BMhkCIDp0nbaeqHGeVuZM6UtrrJFkyBEBoI0w64dCO4gzxiQrdAIpI\n\nwdYJgGYAuqQ4v5THfczP73QH9ZGoTMZzbTyHH9sLbBgDQuh9Z1QAXK6JNH3lz7qDl8u5sc3Z0/6w9fGt4WcEE0gHXlMm8TRQjF3SaCGIuhA5cyQOcUUDZ0+ImpqclvkJVzXKXZnNMk6NZBsWGCpZveaUKJMNYHFpQIhg275uTVBVawavzO7ODYrcYeQtg38HgpPu3AgiRPA4gxACIR9FpAj1+6PjokDkD8cbVDFk9NCOGonvT3LF6R2e04qXouJX\n\nEi9BcfALnox1lxq9NsWvUwFWNVRPizcfAJHr72fGgTUyARGiTH1gnJ9qInEnfFn2M6ksC+tI6MwkBwA9gi4ZQDFEwDtA4Ai4S4BQHwAcxcAEUGKOcCgRPBxYyyAo0PMcD+xOA4mkRNV19x4seo5R0PGVKoK7G150BqYBX0jUvM7od0bYQfO3DlS3F7+rowAp6Ncas1IZHnftDzWgH5i4ByXYCMk0MVjmSpA6eCJl3fdq18xhQlyuVUrG1d9ksPXK\n\nuzlEHqU+Co4laEzDHiDjv0tAORJoMOIyZhg/ZRDMOVgsBWEy1zbesgT3rH1z619e+p4Cfrv1v6/9Wk0A2XqQNSGNzYUfbhnqkd3QVZmCigABg6zC6/M9UMgjQRYICEJCChDQgYQsIOEADb+USMKxIj3Z2DF5ouBlERg2qAkFAA+BjgZU4sD4NyZ4AmYRgLcBUJ5prPAbFYoWkVi7raTKJpoTx6VjqsWVMnkNhAVs9gHbMGI76u0Js/c2zEahAa7n\n\nLcONsJ2h4KN38eNVqewZ/UosQApUNH3YhGm59ZO9jY/NDIc6+jyPAAx/KAMOmRjUxsYxqWgOTHxC8Bi5q90BW1rUDSuyZRgebVYHQzWuvAzrodzNL9dV/NibqC4SUH6RRNAGebs4FBEbQGZhhfFsuM5mlVek243rQPHIsPdMW545DJOIIktiazDhL8fnh+6FLXxrZiCeyDDEyhXCSE0sUz2ulYTKceE7CGpiF6SCxelEyZfQDl7K9Yemva8UgSsn\n\n2TnJ7k7yf5OCnhTop8U5KdxNd6e98loQIpefBknR9GJHeNSen10nK0DJndtevSMFmH1XsJ9S+skBvqP1X6n9X+v31ihD91DaMaDDJ3kanEXQMmcEdKDryaEFfKSXSQkSUDOJDOytJaHEFmcl5xfZ+acOULdGkLvRm0+niGM/zBd51OAyLvGN4XvlEB6Y0RdepzGyGCxxXedLYPrbMDWm+yXsD030WCDhmi+qDrCDAxWj+YuRusrVApnqao23zuDI\n\nEuCHsz4ykS+gaLlnm7jF5yYYC0903nvdCWiABwuDpCiHeafaq3Glqvxtj2//CNL9GSCtXvF7sZgYHLA0Faql72XSShm+QRpoyolTQr1Fq0a9jDph47RYaNUmqzVFqq1TartUOqnV+Rq7a4anBySPYbi9iC/34Felpt72joAkD5xeQz9V2wgJtrCPA7Qdxk7fLjZhlOW2THJrkzyb5MCmhTIpsUxKZcODaabBoyeeFiYirCpg2gvwf4b8TZhq2VK9\n\nUMNECEA6ebQO6ZLtZN6Q7DD4OqHUkZtqw75YqRqM0hrrkQAIIUEGCHBEQjIRUI6ETCNhDYA5WpzhG40N6zoYM2ZGZmpYBJQjTJ1MB+NczhPXeaVWmNa7ApYaLdn8DaVVVkwuFhtJ9AA81oOGghe6vTTkLfVgTRhf51YWCLo13C6WomsunJCiBxTcgYDMqbFrFFrXCtb0nYGaKz3fA25O2seSZzc0fXRqCLSP9LNyKrixN2h44s02jBi40wuEvzq6\n\nY1Zxs3gR7MSB4gEIeYE8CEBuQr1p51VU9Y2UvXrzkJW84JZxLfXneXyZGULNENVbU7modO5jN47d012DHGTC0YLvqhFDz2Spfr0RvbaUMQ0ESjGWkM1HhJa7WtCqaxsGSDDwt5rWcGcvi23LUtzy7LZ8sK23DtNhJPMCbLHHGBbsO8draZJzsf40dH+J4dVDG3ebqhnbSPYt5GGTJyD8wx3GuB3BHgrwT4D8D+BYhAQwIKm4reG3/xZKHnVo6aFe\n\n0zaAjiQErloT/bDUN+9D028dnNtxz4jEO+OTbdOp22UjCFRfWcB3t72D73QHK0UZhURoU2a9SaGJXjIeJo7UWvhfmy8jwS62/U5O7RzbCHWFg+YrYVnaZ2dXZdEmq09xvLt2m+dwxgtSNZws3VxrHpsTRWvk1vcgVzNci0Gcouaae79kwgBtZhLSs9rDEUcQGhiKOVSFJuw4wnE7F1oIUgzA5XbpusO7GiTujg+JfiQQS4ab1y+x9aaoeaJALcak\n\n7bj+O970AgzveEpFBMT6FgqeqEwZZhNJwc91l5UmZd2JUkTkyJ1EzZZIB2Xy4mJxy72fdsDmvbw5322OYDsNx/LBJv3eM7D2rwwr4+iK3vCisHzYrRjiQO0CEAjACQkgG4L0A4BIIXkEUKCOLGIAUANU+gN4DldWVP0rS3Uy0WaYkplSObiL2qRVgEqRoxZ0DlMgfOmB5ssX5prq5aZ6vWmud2a1Nb1ZiflqtpUmhu7E+Sc+mFNfpua23bIsd3Mn\n\nXdqi6tcqb9woE+TrtUPZGXMOBAOjSqX48kWkL0ZKZxPjGIFlcI5uslpp3OqDqzmQISFc4IueXOrn1zm57c7uf3Onr17Q8oOyFo0liX2iHfZkhfd3xX2ENTt4ksho1crqtXa5jc1ubgA7mVuBrwO3lZhUqJ4+nkTvtJ37A7Tw0MQ2WU/ybaMdUWaLrUsKGzCsQZ6+jDiPaMatNZ8uRBJmgW3ebF3iXpdyl3/ohbkvv9pLoa56dAVQH67iTyaxscrW\n\n+m5d/pmBe3aWNLWNNzknJzy7FD8RtdBTvXRrELaYCzjomRM6gF/Ypn3F8EhULNwafMH7dyr1mg2aHmWO1XkCdQKQBeBQJegjZI+2a7acWvqCVruZbFpeOfXb77/e++IbSUlBjj2YfDvR0Lbzj6+rEmQUgNujuxUlj9zTvG9ixJv7K0bdHBm5qrQ2pMysvHBpPhvAO1HIh9GefwTUADFg2YDG8ILyp1a2HcMMw9kBO1oPXLktjyzLe8vy2Ad1NuUK\n\nJPMpL1/o5nQ6yzYCNkPQjjDiI8Qb20xyTD6HvG2cE+ffPfn/zwF2wGBcfBQX4L+CJC9wfsV4+49qFL9Bp0ui+61HthmIrdaU9i60WcLKo75tm3hXYOy20fjiMxH8Nejo7QY91X3mXba7jd1u8NcDcl3H5mFQRIhtqJ335EhjlMISy0C/o5PUCxVgDR1gOO9s7wqxZN2Mb4LLOjjT6DLtkvbTFL0t2AaF30uaX7pgBeW8It1umXDbll027ZctvO7K\n\nurlx28lX4B+XDFwp/rp45ZlZgFCkdxQbN0TdMlKiQh4vcVe8aV7LT6Vua/yZag/V1rkSAIdeP9P65YCYZypdGcQA/YQySZ1pcpMzPNLae/S1nsWdwni4ee1Z9cU2fLPbLVep4vs7r0nanXS5lc6691cev9XB5y518WudDeRvsL80uSfCvcAp9h2Gfa88JLX1wADSMUHADgBQhmkg90yGWEyD9VfEAwBgIQAQAUBzgqF4tz6GJVQ/1rgPwbcRFYXb\n\nB9AUIL/aF4LelA4fIBscIj7B//6IfsYML4UGVIiBMfiPiKM6di+E+MfCPjIMj8+W0v0fxP6n0j4e41uMQRP+H5h8R8GZkv9UdnyT4yCAvG3wKvn0z4ig2w5ns3hnxz6gBY+MgYv8b9M959U/OfGQeEls+PyXFHTIvlX8z80e6eX82vmX4j7eAdK78uV6HZT8Z86/gcNqoeUE0eKYg4Q4IGVGwxsqO+cQ4IbVBvKkYVbSgRgNgAYG+9NACAEzjoES\n\nUN+y/9A3PgeyLwjBs+wwJAbSynsJ8J/iAUIBAAEdDRN5G4xAD4GwBgIm+cDwQLM9n5IA5YeM5wd0JAlIDKBgwAACh6zUBeATEJv43/cO9AAAlIGE3jKAhIREMkbX9wAN+5grfkf7wDH/h4u/4f5X7bHoSAv84nAT8oemWt4pN4ckRuELZtrd7NAxf275FaeLkk9/zz0UN3r+9Yl9/imteIcSpN7xw/dgKBAgGqBilu9cAPPwX+3+7/Z3ia6oIQEY\n\nAtwA/+XodrLKG0ukA/+BBNXoy468PoC2+FQDJZZmu6Gsjjk+cH/4AB6nr1w3062mCDhAnXJRDkQQAA==\n```\n%%","source":"_posts/Excalidraw/Drawing 2024-12-17 15.07.21.excalidraw.md","raw":"---\n\nexcalidraw-plugin: parsed\ntags: [excalidraw]\n\n---\n==âš   Switch to EXCALIDRAW VIEW in the MORE OPTIONS menu of this document. âš == You can decompress Drawing data with the command palette: 'Decompress current Excalidraw file'. For more info check in plugin settings under 'Saving'\n\n\n# Excalidraw Data\n## Text Elements\nBroker ^vpVFc8Jz\n\nConsumer ^HlcmoCYz\n\nPull Message ^iEKLY3mc\n\nProcessing ^4SqNDxs2\n\nsuccess ^i4gc31t0\n\nTrue ^6S02Vu74\n\nFalse ^thrRj5N6\n\n%%\n## Drawing\n```compressed-json\nN4KAkARALgngDgUwgLgAQQQDwMYEMA2AlgCYBOuA7hADTgQBuCpAzoQPYB2KqATLZMzYBXUtiRoIACyhQ4zZAHoFAc0JRJQgEYA6bGwC2CgF7N6hbEcK4OCtptbErHALRY8RMpWdx8Q1TdIEfARcZgRmBShcZQUebQA2bQAOGjoghH0EDihmbgBtcDBQMBLoeHF0QOwojmVg1JLIRhZ2LjQARgAGABYAVn5S5tZOADlOMW52pKSAZk6eTt6pgchC\n\nZgARdKgEYm4AMwIwlYgSbggAIQBOegB9dcIARwA1ACUAUQBZAFVcbBYoZ7MLjHPaEfD4ADKsHqEj+bGYzGcklwUGwkgapWYUFIbAA1ggAOokdTcPiFATYvEIKEwGHoQQeDGQHF+SQccK5NCdY5sOC/NQwSadbnkiDWOoVEWNCCYbjOGbxADsyW67RmSXafUV8Xi7R4iuOgrQ8vaiR1ip4vRmMx4l0VSWOWJx+IAwmx8GxSGcAMTCv2dJkQTS/XHK\n\nFkcYhuj1eiTesTEbrEXCBijE9FoeIzbSXToKy62i2LU39UWSBCEZTSSbtS7aHhJeJJS4zXrde229WOhA7SZ9U25pbdY5h4RwACSxE5qAKjUgAEVcABBboE0gzCEEmaKmZPPaaCh7Hg3B4ABQg5IAuo7KfiIcjSHB2Qizsx73BA5phBG3sFMtkpzOjTFLOJy7BInQIA8HyEIqY57AAWnOHAnh8NyEE8STnE8YxMqUsCIGcuCkDiVDkmAAC+l7HEIc\n\nBJtsYGoO027xJ0LEzJcvS6vExxEBwuLcBwQjgjxbDYPiDEHPgRyioQEZYIRvSBns5CZBOAlCfgxzhsQT5ToJ4KFORAzAZA+EVNAWBQIGQytJM8SWscNmjOMFSKm2OpMTMQ4yRsWw9mgknSdKpwSPQcBPAAYtgSQAFJGEpYKQtC5nImiIhINezqEmmkyZVSNJ0hADKnFpwiVrpuWiry/KwEKUqlOKdL1ZAsrGuxnTaFMLbNoqJbSkaqDOFMHWqtMa\n\nrtL0lw6kk3nSk6VJRp6Pr+sKH4hiOQgRotMboNi1jMHygTZCmOUdF02hbpcbbdPElxXXaPBktKZYVlWaDdHEDYWr0vTTI9Sw9F2/moFaXQFq2w4suOk75GREALsuq7rpu267vuh7HmeVGivNt5vhVEivkR77HJ+m3ED+GRZDksOziZpQhegBLrOcADSuAABJPDFAAyIwcLJPMGM4mCSJ0ADiuGmeUhHEWwpGzpRjRXqKNF0cDnksSxlo2jdPGyfx\n\naD6ZpooemJwOBQgIKcFAEKEEYFReXWzZJD0iqLK7nSzNb2QRbg+hggN7THNsmBWRI5xZV6pOhEEskVMsoqh1Ai5EMobToMEexWY5TBQOYBCpxWGfQLygZ6NkuDx6QalGxpPKkBWskEAAKpZZyR1S0cyXJrXoLg8RKSpCC16gxuleTBNj/XorkBQbdhx3UeBrgQhQGwLzhPbFTYkIVum/HHPlpW4eMXWvSGcZScyxIvEZaKTkZ9Mly5y0zkcBMHSd\n\nIqUxtgs3E+U2MEei+xDj72CgxCAAArXAUxxas2IPEAA8usKBUlzjtByJIH4DwErggKuZOECIkQojRIGXG2ViAkjQE9TEN5qTJRfO6Eqs8ypsg5NwZqEBqrYAFHVY4jVJTHD7vKFinUli9TbM/boH0ZiGjlHMLMbYugaiSD/SaNY8qundEtWMK0AwxzEhtLaOidoQDjDsRMyZjipioemVA3QkjZnzLMPU9pegWluscF6J9uBZibGo1sPAugyIkaaB\n\nAQ05E427AxLW3RhQyNoZADa0MAJwwRiuNcG4tw7j3AeI8p5zzKy0dSfGHCJDaQ/F+Cmv5qYARVtKNWKINbMVYvMfsM19Z8XUsJU2olxKgKkuAuhREoDnFko4WoPSTbSiyMQcZEZZLKGmTxUIUA3T6ADjIHYJ42CyVPuPHGURSApzlhQMsuAGKHNmRGRcZyLlXJntKOAez/y00aIBRozUSidDIg0j5ZEwCOOcfWGYbikgeJ4F4wF/jLiBI+iEvsP9\n\n4gRLVH87GwVe6EUVEPf2I9Hm9OlNpKe9MygERoeSJWFEr7SjMmcO+1kmDDAzvmYOD8mWtDGB/BOix3bKI+scNYQCEAgICmAwVkD1g8FIAADUwGwVmDwhBszCsoHmmB4IQkuAATWwHgpKtJCE4mIciVE6ISlEjsaSEpBCmGMgnuVcpqAuE8L4V/LhgjOHCIUWI9Uk1eisS6PmfUfVSgDWcLaOI3Qcw/R4C2FsrZtwlO2stFaa0jHaRTbGeMViTpWv\n\nek4u6oLwWQuhc9Y+b1UCwvhcEnoSLwmRKBgxK6Ux2hdVmqUFJE40kgQyUjbJqM8kY0KRiuhWU7zEynhASppNqmUz/DTNAeR/mQCaaKxirTtYdI7ZAXihtp6EtKGbAZYqhnXlGQsyZyy66HsgHMy9SyVmmzWRsrZ9Fdn7KfXNY5pySIPK/aUOZdy/0hAJTM0oLz9k9oBbOMA3y4N/JWGAT5JRgVFtcfqCFniX4wuSHCyRtbQlMQbWi2cF5R2rCxRI\n\nXAKQQTD1Htc0oxKnWkrpRSxoVKjKFBMmS8yDLX7Mu4DmKJ0pH5cs/hu+JbbrSJ2Cr5YBFtxUyUgRzFuUA5wQpuASF48RWY8BeGwOcMx6D6BPJ0XYIJEq2thMaxEpqyEWtOrwG1jDCbMIs6w1kU8XV8l4bVd1AjahNW9W1MR3R1Q5mbJcINOYAH9TlPWdo2gAbzFBT9fsoaKRZSzegX0abDGhkzaYn0Oakx5uoQ4wtLiwWYdLTh8tr1T7VoI4isJK\n\nLG3ROBg2YJipepXUhqObt7zSh9qySjXJ6MClY2KUc8dZTnwVOqVU8m866n5BXRANdLSFRtOCSxTpB9uk3vA7u/pimz1HIvRMx9x3jj3uu1M27z6sSvrUO+15BynkjJOcB+W/6ns3OIL985oGAOQEg28pdZEUNwaQwhsjSGYdoeqyW7DcPmtBNa8R9rpHlYUZOFR/ulxcWqTAxPCMJK4Zsd4JSy+3Hr7kszvHRlb8WXfwE5yly3ALSON6LaHUgr5M\n\nivO0FBmkCzD7naOcIQzAPhQDeBzKBzgYAcBgLdIQHnpSgnwa59ARC7OkPNbNqklqKtJKKvQ6z9J3OBhZI6hbzqeS+bdYxYUgWJRetFCInb2hwtNk6FFmLrF5HGn1B1Pn90ZNuXtGy792Xit6Py6KYMGbqk5fMaV6xopbEVeR8W2raPSwVqa3hmtWPkWopE5iGJpIwa5mEzuiAXaYZQ97UuTJyMclo3yZjIpJQNsUInQ+KdM7k9ztqZD6cG2tsMU1\n\nrt7dXT92MdO+bCSSnv1XcWY9g9J2MARgfdv5fEB8AvoMG+nZH2wcW9GcD/7O+7u3PuaDgHEGPvQZKDD+DvyEfQ8BXnjD7ihesGGOCKdabWle6KM2mKxA8k1Gi4JO+KV+zGDurGN8NOHGdOJQPG1OFki8HOnAkwAaDo7KrO4mCckarEW4SQ5uQqfka+F2ECZwHM+A2A+gbALo2q8UlmOuhqdqLCceJuTmseY6+UuuRUNuDq7CDuwhkArq/mruHqQW\n\nQiXucoqocQ7EM0W4mWEAQc8QvQyQ9e1BoMOo0WyaCeuW+i6ahWae5hEA5yag980oOe9imotYCwaiTEehpoeh5uPilaH0nU0w3UvUVovWj0TavYaijinQYMA2NEQ2re0o6wDwc4uImASCHwkgSQewLcPA4sewnQLoY4RgbwIwVk+Og+82U4RUb4y234E+i6U+1EtEzSs+m67S+2jee6V+x6IuwykAewNsdsDsfiWYvUrEairs4WMRvWcWpQgxvs/s\n\ngclUtK7cEgboHAzAQgmQ3c0owYYQDKHQxBqxYcRc6c9KCA2cLO+c7gZxJc68JMooFcUQ1cDGX2shjc/grcax6AGxWxOxgYEysB/cksdGeKbxt6061SU8R+c8C8p8EAfx2xTAK8a8G8W8IxaAu8/Rx+h8xekw58mBRQDO5kQQRAcgjhgwHKBBNC6o5uYmXOaA6ofKFo7sguwq66lsEqZwPAbwnQygEI8ElwmR5wzAEIcApAMAuI2qUC2qY4EI+qVu\n\nEA+uJCZq5C9Cpu9i5ug+YhxUmuTGbC3mTuNUQcbuoonqXIIWg0YKbh9o4WHkv0nE9WYa3AP0nU0eehswxaP0jeFC6eeW/oVhxikYthFiCYZWNiTm1oF0HYM0Ae0w8QH0cxkAfhp8tonUmYwSKiehlB1oERaArsloRZDYcRqSw2kA2APMNwLwkgMqzAFAIwuoPABIIQ3QMqBIYwc4uEEATw8QuRrMygxAIwUuiCzAi4rBbAmAjcBI3ZyRqR6RmR2R\n\nuR+RhRxRpR5RUBIheMk6TqNRxMdRNSVMk+y6zR6sbRO2W6nRi+PRZ29BoulGMBfcYoHMCBEJu+yBekGkRJ2BaBGA4IhAFJLOgmNCSZ+BHAZBpItoiSwSjetBCmd5OJjMEAiouACAQgLoUAJ4LorMLwzAWmUALwi4MUPATwkgY4ipYhKp9mRuAh+Imp1qxut4upEhnm9uU4PmJp/C5pShnu0o3u+Y4icaP8ioU00apoIeIMiQE0Hh+ot0rYiw2hfp\n\noZlhBWwZ/pme5W9i0ZNoLs8ScKDYoFRejWpItYpoNobaXsOZmYeZnWDEXkzYMiSoxxnaUMCR04cMlZ1ZtZ9ZjZeoLZuAbZHZhm3ZvZ/Zg5w55wo545bBU5hAM5SGEAc5aRGRWROReRBRRRJRZRfeYAA+luVRL4tRs6K2DR9Sp5rRkw7Re2XsXRBsN5q+gy95BOj5hE5FYJpOSB0JTqxs35JJ9KzOYFpILEzpTQ1J4FjJIMHE7soMzlqwQunJ6+Yu\n\nZwLchAXwrgLwuIMqcAQgHMc4Oo8EkgMUm8ewVA3BBqhUVFhu6pWU9FNCLmvBbm9qrFUh7FxpfmppihHulpKhbUbkyWmonEw1EWjiBoooQcbpWs3Wj0MeDYs1Fu8e0YqagZqlRWiN2aliEZ2eTm7syW0arEmYGW2o3i+JGYn0wS0WbkcKCwMR2pNeBZCacwbYXCze7+FZVZNZdZDZTZ/lgVnZIVfZPAA5Q5I58QY5E5sV8VcMSVC5qVy5GVa52VFR\n\n+VO5DuUJ5MB5q2x50+LR66c+l5NV15L+K+J6qAXJl2JyB+169+oo92W+VtR+J+L2Z+b2F+n6Rt1+P2T+lyV+QGXtZOooEOjRKGn+cO3+m5H+gKyoOYrhQS24cKMicOzgqoCQ9YcKmo0eQaF8P+s4MO0ZDYCaXUTE38t0yZJQzg9kyQ5NTE0a1BwoeoiGv+sGk0ldnEXscaLEpoJZgKSdUl7susOYrinEMwDdOdkd4eeNOoYKLEHipdYASdMZUKH0\n\nCwPAjiDYzYI9MGs4X+kB/egqhOYoMUr5/tRKXVKBVOaBPAtOJQXGWBfVEgZJAFYQQFtktJcaYFEFHQlo4WMaAugCdBjViFkC4s4F6wXwY42q+RMAnQNwUCIwvQBIi4Lo9ATwOKZ1Spl1apjm+azmjFDCD11uT1J9XmTqHF71XF0oFpjuP11pnEyQUwURXkMirE/WYN3AYiaoQSaiehcKllZhaNFhSeex60qNuiuWGlkZ2DConUWZ5NVo1BmoehxN\n\nxlTJSW09ad7sHEUWvpdNjEOomY4WN05uLN5Zyp7N3lXNflrZ7ZfNCVoVgt4VItYtMV05s5KRyVi5aVK5mV65OVeVc2Kt1RRMD4GtpV5Z9MqwkCzMbMnM3MfMAsHAQs+gIsYsoJgKvGssJEOVFE+OM+lVF58wVoK92h3R7tvRCFe9LV1GrMR9nVk83VX519NKeEv5/GJBwFG64RbTnO3KvYejV0vUcNcFwu5TymZwIwNwbwLomwPM8QUA+ApAHMXw\n\nMUCAyg2A2AFAJ4uQaDlFtmqpDmuDt1ODtFeDhUeptuhpJDb1LuXQn1wW1D8oloMZEx0aLseoyZOhQmTi9o0WM9EKqorYI18NC0ylgjpQKe1h5M6lGNWeThTmtDSZ9kUKU05odoSjviGYWYmo8SvWvWU0PQZa1eGsGoP89YUFpZblKGPZAtQtEVUV4tLjCV0tKVS56Vq5WVG5u9uDQ+j4u5o+ex4+R5Qd2tZ5eTWsHRBth2S+7xx+t5AD56FtD29t\n\n0rttV6PRp+myLtxAH6x07tWIN+ftPtj+IG3t7tgdrNIdgKYdnLo9sGXzNot0/YMeAzidtY8SMiW4bauobaqoG9EdsGpo0jUwrKd0bsyLidmonU+NP0SoqoSoTElwvryGgK9YyQEKiwjYgNslnE4b3Q2gvWcZba1BN038GoibudyouovWjiN0MifQNo4bcQ2oU9N0HiHiU0V0Zbf+WYk9fQrs7UQRgM3diQPQHiAeHiNbYKNYnbsGbYCQUWYKXs0w\n\nAaVejQcQjYt0tdUedbWd4dSbTdSWPObraoDYeo9bgKaovu9lXQxYaiNosw07s4bpXsYKU9nsrsv9sGK9gRoK1BcKkKuYw92dm9jQ8LUKiLJdKLoNwBcQPzEesWEWjYD7IH+hz740jYwo77s9ydiZ1BwSg4CwzESHqGtYGjpo2oao24aoK9cOfQCQ9ot0fQmY7bj0RHQK6hNYU07s/0woHENHFb87KiS7uYl9QHfrs4YKyWhY6oz8hZ9YWHTiConE\n\n2ok0P839Inu7MOX7fzv06oExeh9kK7qGyoqWUwP0rs0bt0rHX7UwP7toWGNYmWJQW4CQTEbkM0iZoSbYVnSW0ajp9keh7ErJSSTnSW/70nAS7S97one7s4AbIlCoW47s24sbfOcOj0GZ2oMxzEkW3QrH50xdNn9kTD0aDkgKrrdaHrpobaeofOrH29ZG+OQJT5uAPMNT7tH53AqBjO6n2TjT9OtKLTA1XTNJvAMx79E1ANSw9Yji7zQzC1DBS1Eg\n\nCE+gIwUCY4+A2q3QLw2AygLwLocAUC+gMq2ALoIwFF+Dypuz1F11gh2D2pluzFhDBpxDDupD1zZpFDPF31fFCibpP0+YVoCobY1ogLA0cKebDr3hOYwogNfDoj5iKlyewjNh/DGe0Lmlrpubqox7lbTEaiuYaLlaehyQC7k0Go+oIl0a+ZqA01FoX0cNxjiRpQdjNLjj0Vk5DLUtbjMtLLXjCtHLuVNqBVi26txV9RgrZVqsOt22Yr1VB20oJT1t\n\nCvsrp6TVerCrdthr8yirarTtGr2yWrl+urP6t+z+SvgGRrf2ZvR+Zr5ZFrsGVrgvjds45deb1dP0bdzY5oP0idyoEW1NGicauYbarHQ0ubXQOo0bbkZH9eDb2gAemoNYrhcn8ZofUKyQG7CwW7TlO6ZdeoEPzbehvUIl5oofLYCQBTbaUWnE7r4bHU0eLiVHG7v0SQof2Hjij0E0moBHQPidubuYbsjNdo9kuYbf+hTlDHQ97bfQNHebJnEKv0Cl\n\n9kbfJHCfSouoOSWLjnYAE0vuAaCjt038rYCaofVo8fTlHEE0Swd0FoaXUlPDbncadbbaPXTvNrLvrYvu0mJ7wl+PhnYATsZsMXUTI1YkurYU/lmFYjfMlg6WG/sFyBTdt9Gi/ftjNHaBt9+O7EBdtMDTYz8/8GA5sIJzTb6g2+HUYfu5Bh7RYFQvUOHEsHj585PSmYYPmojL4dRHofze0NuDw7B5AUZ/KAU2BgHX8poO7a1sBzz5OJXY0wNyHGke\n\niPQP2j7SARfwEEcdqCofJiL7gC5ekJomYUGFB1nDxJsw2ocgYsEoE/xVBUlYJE2HJo5hHE6OXNkAO1AgC3EbSYQW/1EFz0I2EfPQkp1jZ90RqJQLTq2B07vsGwrbUPk4jaRXRhqHEFemN3PY+cawSoIHgHnzDWhAOGnS1qHR3quCHywJMUB8Da7m9mQp9KcF1wqA9dOMTTCJmcE6DnBFcDwTAC3HFhCB1gMqIwEYFxC4BOgMUDmBFCCCBgcCrTH7\n\nqFn75SDescwJsMinebhoI+2YZvnJxjSKIJGueJxCvU0Z2h86cwAPI3lTK9g4grYJsBm2mp9A2w7uOkJi3VBahi+vOQIfdwRrw9fQaiPYL0E0BBkRGZib0PEmwC8pzuhUVKBoECA3c6KQhe6qcxYpEM2KKxUoHIQ+rksW87lECH0A+AxQXQpAIQC3A5g8xcAIwVeL0BuCKp4ILwGYL4yF4BMzgfLQlrPm1hgp7Q1BQamgCtDzBxuPTekeZWix2hYK\n\n81PomL0PILo3KNvN/HbwyGWs6u4iaLPMCkxjDpg+LOHF0GVDbgxhMeDiDERbAijhQbkRjkGx6BVdMwugxoHqA6jChzK3fHSn0ATbRdNOvuGaFNAsrChOi2bc9o8zmAFgvYnHdiL9Dy5JYX+7iTUGCimL5gZR6ZGkaCmuhzAawr/FdDF1Xbj8poloJiB4lmAAd4B40QItGg+iuwxhSnVjuxBTrrCHod0W6HCgDGFoAW6iK6HpUVCsdZ2wnGPHWiEH\n\nsQAx3bR6AOG1B2g3OlY8IdqDUT6hL+1XBUDKJrDSMCaJXCRAsBcERikcKwuNEsCLquc5OufHfgHnPjp0JoGjaCu2MjaoCLQFlEStwNgy1hcwEKK6BCg37Vs0B5ovASqH4F09BwN0GQmXRGj84Qi00VUPKIrHniZ2ubcYu5xkEWg06idfQluJ9I1gFKWorMZOMbB/NLBP/ROl8w2HzA6eXvaNFZyzDdQdQdaRMnZytDhsksSQy0NqHrDxlR+742Lj\n\n53YjRZ9OyQ7rC60roMdlRIlG/pmCs7n9pxTYG6Dkjujexu6ubDfqkJXpeFdQtXYiY0GcAGioUi7Gqj9AtBeQJo8AkSef2B6jstCUAkdnV0yENdw6x+dVufkN5u1ChHtMZDr3doqsbsek9Xr+it4ms9JvtY1sfQZj71cACpdqogXa7FDOu59brpSm5Ga0hW5VXWlVQXySt6qJtS2L1UYISAIQDwDUPQHwC9AhAzgJIC6CaFfAIoMqVmFAAJB2B+hg\n\n3dkIGG9wV0NEGgzDH+0bzhptQdYe1o2CzID0sJWNbBjdDzZx182IlfUE/0J6nw20bvb+JaBjTiiawK7MUF9yrSdQLhHiK4Qvz6C3DgWqPB4YqCeEvCUaKPeHntE2KHRqYPw8yGcywYVYZCQLJihd02nPUp4O06EeQxcqDY4RlLREciNRHojMR2IoQLiPxGEjiRXLYXpUCWzU9pqNzekmNRMoCphu41ZkYxBK4+i9CHIjklyLHwlVBWfI6VrbyZ6R\n\nifkak9If63KmPQHKIlWGu2Fn7TQE+6bJ0rqFy5CSSgiQVsHozbZTVbonTW1slhmgz0foEWIHvEDy7dsbO01WQYmm37nQOIOonDkeKhRpCRBYnVdtxKmi4cA0MaX6G5H7HulLQ38KLFClBTMziZAAitrGJq6sRF6JwsrgkCK5NhIhNdOmZWP0JxjLoQggNPqE1Cz9TQOYQApNCbKcRKxiQMYa2LUT5gpJ84uSXIx6xCDyOCaVvupKFmaS9e2k7Vp9\n\nkhJmTLaWvKOcb31Y2StepvSyUfia6EQW4BQ2Eq5LQClDSQnkqGeLwXSS9Gk0vc8rLwCkK86qpTFXqbTAShTFu6ACKPpmMw8xNArMUWPECgRfANMBIKBBCHWAwBzgWUxnLiRylWlREkAmPDIhJYyY5BkAcNDaDrDTUIUbaQGjpW0LOFuA9UxMgUxkRuycyvhEmqgFrDMlfRcwffvZGlncUvqQ049pcPHbjTUuuDf0l7FmnPDXhi0sxMtIOhEQ1p2z\n\nfaWCK3KUJtpIIjaf/KKEvcpwx053PIRuawjWaEAK6SiLREYisROIvEQ8AJFEila/jYfLyw+m2VSQ38G0M/Psh0iq038RvAySBlqg5gXEJyuyX/qq8cSZMfOdTFhmQl4Z8ItwfVxRmxc6w9YXrHWihSw0F+6OPNqqBbQcRVE8lesKx1Jndjo03UK0LGj8FgBEgY0diI2Eo584FFLMyTs2AVBSi2w/qXUSUFgkCy8eiZd2XCis7cTFZ/YfpvbJUXFi\n\nW+slcLCJRCJZjlQEiQIYsCoLyM4cco44Xzn4Wksp2Ks2jvi1kFWjcw6o2eihPEXWglFEKWtGeJ4WNBN58SL+iDSEGMju6I0MFOFh9KUEvCdoLIRtkdrrJnaBvMOVfkjmGSrJ++epUfjMmJzbJd6S3iDiTnSsU51GL4OnOlYdcs57ksobnP5bQyC562XyTL3nxXlAplchqowtrnSwh5D9QCqQpYjxImREmd2CXSiI0FORIzMKegDXhIJ9AioJBMGE\n\nXDtB4IXwD4PYB5hfAng2ATYutL4L6ksst3IBVy0e78FnuEIjoFc2gUfcGog084XTN6x3yfSD8oYdaUzAxleoxGMGPWAkpY9WSO2FsBNGiFw0lK005+XNLfmQtQyewYlRj3ejKhbQXQKgVvwmltTa88fIpmMK3BeDmp1PPUIvVNByzYFJjBBTdOQX3THp6C56VgvyhvS9ywTCprkNwBPB+lkJQZXpOYU8i1sS6YVhVQ6D+TZl5co7HpLKYAMlloEM\n\n4JIFxBzg5wPMIwDzCSAUAvg8EFuDAAQDnBxYPMEIEgh4CDzzIVQGoB7lHlXRksw/TiKV3iz0iSO8YmrksK1IXsBwWg/1aUB2FfwxiwfKNZAEoZcIcV9w9oAgDTVpqCVJiVHp/NWnHRf5oIp7h8qBF3dgFby85uAt4pQioFMI0UIzyaKihlI4JNpc1UlWS0iGFOFjMMr8SjKKRlVK0PEiUmkKd5WyhONwwsqFi/68FOVnnMVXHkyI4TfVRHCgAjAX\n\nQ9y9YDMBuD4B2gmAegBzHaA8xOg2qL4IPDhzpNqMZyLJjfSAhpMkKXwZgPtjHCsxCAmRJBNgAtBfBcQkgB4IQBii4Iz1OBIiJkzIhUpshm2YuaKzaQg8bOhtbVVXJCl9db6RyiAFE3ZhcxeY/MQWMLFFgSxXVGTeWLlIUTqh4+NWbQgND5x1g5KpG0NQSTFGRrtCMaxiBCn+p+rtCSauHu8IzXprKSkAcFmpVsK5rv5+axtVZh+XvLdpgCrUmWse\n\nq/KwF/yqhtKBOkBY61rlC6RtibUdV3aPS/uPBArWdqz6IEanOUNZUtsYiPQHMKQuAmjrXSh/fhV0HoXTrGFXk0JgjMXU4Fk4UsJdegEIBvBWYPMbVDMH0B6oQNOTCDWqvyagpLQxTCuXBoWXVyFu4OAUQjPt5b1VB2Ya9qxvDbMaYB9kMcfjgqWvZqlRvThXn3S0xFMtZEIaNlvo1K1N8qrIZSBHSC8igGIDMBhAz2BQMYGcDBBkgxQbdlBi2AGX\n\nJwjoFbgZuzDDUG0i4YJVlAuAd8GgGVCBJO6YeP1DTUc4QBQQmAV2jqx3y9r2l2vTXg1tmQNFR4DAcKFFFihcE4YA2obVyHj5XQupAHH+Iwwmi58m8s2jeRdEWBsS+c0fbcJNASobatt4c/ALtv0mtKE5BrC9Zkzuz4BPwFAPonqqQo+a/NAWoLXhokAebR58SUgYY0W0U98wJUuUBRv0qJYE1dhIQnGnS13QpgEKsztrIazoteAbGwacmvoT+kuN\n\nmahaYSpzXkAVpQmnOCJp4KFrZNEmw5pNL2nC7xNduF6lWtkI1rTpySVTYXPmL0YW12msUPBGlXk4dI9TCOToxq7+zYslm3UQwDGof0HEy8hznrCnXDMZ1YylhZPiPy5NwtsvNyPMH6mK8Ha8GxaqZB+IQATwGkVAB8A5DRAeN06SgPCTOAB7wQQekPcoDD0LFbY28AhT7CgB+wA4+AcjSHEsh3EzgYgbICiVfg3FC4acEuAHGIDEB6gxwZ4lXHZA\n\n1xImLMNDbE0w0JNsNKTQMJ6CbgcBvii8CQNHvwCx6EQoe1EuvE3isBMSqAbEl0gQBHxlGZ8S0IjsgTnAV1a65gDzA3Vbqd1e6g9UepPXo7+4l60eYvU+2HitCElcHjEWIyBIaNHQCuivQsHUCjKjOjqF9Bp3M6r5rOu4Zxu42c6keqebnUtN51fyjoAurXKJr/lFrRdTmcXScxAWQHpdRpKqPLuU3Sh61J5Rtarqvzq7cA80zzPppKHdr2MiGvtW\n\ndBtKU04aj8UkC2Gs3zapEM0CwQ5tt1ObZ13k5XaujC0boItV0esNFq1Ve64tZtZ5ElpK2IzYcwolWRyrrAIpr9lrDPj/ECRlLVkIczVjUoRmSH79b+pDC/rjYKGNJdSg7Q0v231bUApKJrawsgSGrjVpq81ZautW2r7Vjq3AM6v62iQbtzqcqWyuPF84F+g4ExW9rm0091BMhkCIDp0nbaeqHGeVuZM6UtrrJFkyBEBoI0w64dCO4gzxiQrdAIpI\n\nwdYJgGYAuqQ4v5THfczP73QH9ZGoTMZzbTyHH9sLbBgDQuh9Z1QAXK6JNH3lz7qDl8u5sc3Z0/6w9fGt4WcEE0gHXlMm8TRQjF3SaCGIuhA5cyQOcUUDZ0+ImpqclvkJVzXKXZnNMk6NZBsWGCpZveaUKJMNYHFpQIhg275uTVBVawavzO7ODYrcYeQtg38HgpPu3AgiRPA4gxACIR9FpAj1+6PjokDkD8cbVDFk9NCOGonvT3LF6R2e04qXouJX\n\nEi9BcfALnox1lxq9NsWvUwFWNVRPizcfAJHr72fGgTUyARGiTH1gnJ9qInEnfFn2M6ksC+tI6MwkBwA9gi4ZQDFEwDtA4Ai4S4BQHwAcxcAEUGKOcCgRPBxYyyAo0PMcD+xOA4mkRNV19x4seo5R0PGVKoK7G150BqYBX0jUvM7od0bYQfO3DlS3F7+rowAp6Ncas1IZHnftDzWgH5i4ByXYCMk0MVjmSpA6eCJl3fdq18xhQlyuVUrG1d9ksPXK\n\nuzlEHqU+Co4laEzDHiDjv0tAORJoMOIyZhg/ZRDMOVgsBWEy1zbesgT3rH1z619e+p4Cfrv1v6/9Wk0A2XqQNSGNzYUfbhnqkd3QVZmCigABg6zC6/M9UMgjQRYICEJCChDQgYQsIOEADb+USMKxIj3Z2DF5ouBlERg2qAkFAA+BjgZU4sD4NyZ4AmYRgLcBUJ5prPAbFYoWkVi7raTKJpoTx6VjqsWVMnkNhAVs9gHbMGI76u0Js/c2zEahAa7n\n\nLcONsJ2h4KN38eNVqewZ/UosQApUNH3YhGm59ZO9jY/NDIc6+jyPAAx/KAMOmRjUxsYxqWgOTHxC8Bi5q90BW1rUDSuyZRgebVYHQzWuvAzrodzNL9dV/NibqC4SUH6RRNAGebs4FBEbQGZhhfFsuM5mlVek243rQPHIsPdMW545DJOIIktiazDhL8fnh+6FLXxrZiCeyDDEyhXCSE0sUz2ulYTKceE7CGpiF6SCxelEyZfQDl7K9Yemva8UgSsn\n\n2TnJ7k7yf5OCnhTop8U5KdxNd6e98loQIpefBknR9GJHeNSen10nK0DJndtevSMFmH1XsJ9S+skBvqP1X6n9X+v31ihD91DaMaDDJ3kanEXQMmcEdKDryaEFfKSXSQkSUDOJDOytJaHEFmcl5xfZ+acOULdGkLvRm0+niGM/zBd51OAyLvGN4XvlEB6Y0RdepzGyGCxxXedLYPrbMDWm+yXsD030WCDhmi+qDrCDAxWj+YuRusrVApnqao23zuDI\n\nEuCHsz4ykS+gaLlnm7jF5yYYC0903nvdCWiABwuDpCiHeafaq3Glqvxtj2//CNL9GSCtXvF7sZgYHLA0Faql72XSShm+QRpoyolTQr1Fq0a9jDph47RYaNUmqzVFqq1TartUOqnV+Rq7a4anBySPYbi9iC/34Felpt72joAkD5xeQz9V2wgJtrCPA7Qdxk7fLjZhlOW2THJrkzyb5MCmhTIpsUxKZcODaabBoyeeFiYirCpg2gvwf4b8TZhq2VK9\n\nUMNECEA6ebQO6ZLtZN6Q7DD4OqHUkZtqw75YqRqM0hrrkQAIIUEGCHBEQjIRUI6ETCNhDYA5WpzhG40N6zoYM2ZGZmpYBJQjTJ1MB+NczhPXeaVWmNa7ApYaLdn8DaVVVkwuFhtJ9AA81oOGghe6vTTkLfVgTRhf51YWCLo13C6WomsunJCiBxTcgYDMqbFrFFrXCtb0nYGaKz3fA25O2seSZzc0fXRqCLSP9LNyKrixN2h44s02jBi40wuEvzq6\n\nY1Zxs3gR7MSB4gEIeYE8CEBuQr1p51VU9Y2UvXrzkJW84JZxLfXneXyZGULNENVbU7modO5jN47d012DHGTC0YLvqhFDz2Spfr0RvbaUMQ0ESjGWkM1HhJa7WtCqaxsGSDDwt5rWcGcvi23LUtzy7LZ8sK23DtNhJPMCbLHHGBbsO8draZJzsf40dH+J4dVDG3ebqhnbSPYt5GGTJyD8wx3GuB3BHgrwT4D8D+BYhAQwIKm4reG3/xZKHnVo6aFe\n\n0zaAjiQErloT/bDUN+9D028dnNtxz4jEO+OTbdOp22UjCFRfWcB3t72D73QHK0UZhURoU2a9SaGJXjIeJo7UWvhfmy8jwS62/U5O7RzbCHWFg+YrYVnaZ2dXZdEmq09xvLt2m+dwxgtSNZws3VxrHpsTRWvk1vcgVzNci0Gcouaae79kwgBtZhLSs9rDEUcQGhiKOVSFJuw4wnE7F1oIUgzA5XbpusO7GiTujg+JfiQQS4ab1y+x9aaoeaJALcak\n\n7bj+O970AgzveEpFBMT6FgqeqEwZZhNJwc91l5UmZd2JUkTkyJ1EzZZIB2Xy4mJxy72fdsDmvbw5322OYDsNx/LBJv3eM7D2rwwr4+iK3vCisHzYrRjiQO0CEAjACQkgG4L0A4BIIXkEUKCOLGIAUANU+gN4DldWVP0rS3Uy0WaYkplSObiL2qRVgEqRoxZ0DlMgfOmB5ssX5prq5aZ6vWmud2a1Nb1ZiflqtpUmhu7E+Sc+mFNfpua23bIsd3Mn\n\nXdqi6tcqb9woE+TrtUPZGXMOBAOjSqX48kWkL0ZKZxPjGIFlcI5uslpp3OqDqzmQISFc4IueXOrn1zm57c7uf3Onr17Q8oOyFo0liX2iHfZkhfd3xX2ENTt4ksho1crqtXa5jc1ubgA7mVuBrwO3lZhUqJ4+nkTvtJ37A7Tw0MQ2WU/ybaMdUWaLrUsKGzCsQZ6+jDiPaMatNZ8uRBJmgW3ebF3iXpdyl3/ohbkvv9pLoa56dAVQH67iTyaxscrW\n\n+m5d/pmBe3aWNLWNNzknJzy7FD8RtdBTvXRrELaYCzjomRM6gF/Ypn3F8EhULNwafMH7dyr1mg2aHmWO1XkCdQKQBeBQJegjZI+2a7acWvqCVruZbFpeOfXb77/e++IbSUlBjj2YfDvR0Lbzj6+rEmQUgNujuxUlj9zTvG9ixJv7K0bdHBm5qrQ2pMysvHBpPhvAO1HIh9GefwTUADFg2YDG8ILyp1a2HcMMw9kBO1oPXLktjyzLe8vy2Ad1NuUK\n\nJPMpL1/o5nQ6yzYCNkPQjjDiI8Qb20xyTD6HvG2cE+ffPfn/zwF2wGBcfBQX4L+CJC9wfsV4+49qFL9Bp0ui+61HthmIrdaU9i60WcLKo75tm3hXYOy20fjiMxH8Nejo7QY91X3mXba7jd1u8NcDcl3H5mFQRIhtqJ335EhjlMISy0C/o5PUCxVgDR1gOO9s7wqxZN2Mb4LLOjjT6DLtkvbTFL0t2AaF30uaX7pgBeW8It1umXDbll027ZctvO7K\n\nurlx28lX4B+XDFwp/rp45ZlZgFCkdxQbN0TdMlKiQh4vcVe8aV7LT6Vua/yZag/V1rkSAIdeP9P65YCYZypdGcQA/YQySZ1pcpMzPNLae/S1nsWdwni4ee1Z9cU2fLPbLVep4vs7r0nanXS5lc6691cev9XB5y518WudDeRvsL80uSfCvcAp9h2Gfa88JLX1wADSMUHADgBQhmkg90yGWEyD9VfEAwBgIQAQAUBzgqF4tz6GJVQ/1rgPwbcRFYXb\n\nB9AUIL/aF4LelA4fIBscIj7B//6IfsYML4UGVIiBMfiPiKM6di+E+MfCPjIMj8+W0v0fxP6n0j4e41uMQRP+H5h8R8GZkv9UdnyT4yCAvG3wKvn0z4ig2w5ns3hnxz6gBY+MgYv8b9M959U/OfGQeEls+PyXFHTIvlX8z80e6eX82vmX4j7eAdK78uV6HZT8Z86/gcNqoeUE0eKYg4Q4IGVGwxsqO+cQ4IbVBvKkYVbSgRgNgAYG+9NACAEzjoES\n\nUN+y/9A3PgeyLwjBs+wwJAbSynsJ8J/iAUIBAAEdDRN5G4xAD4GwBgIm+cDwQLM9n5IA5YeM5wd0JAlIDKBgwAACh6zUBeATEJv43/cO9AAAlIGE3jKAhIREMkbX9wAN+5grfkf7wDH/h4u/4f5X7bHoSAv84nAT8oemWt4pN4ckRuELZtrd7NAxf275FaeLkk9/zz0UN3r+9Yl9/imteIcSpN7xw/dgKBAgGqBilu9cAPPwX+3+7/Z3ia6oIQEY\n\nAtwA/+XodrLKG0ukA/+BBNXoy468PoC2+FQDJZZmu6Gsjjk+cH/4AB6nr1w3062mCDhAnXJRDkQQAA==\n```\n%%","slug":"Excalidraw/Drawing 2024-12-17 15.07.21.excalidraw","published":1,"date":"2024-12-27T11:03:15.342Z","updated":"2025-01-05T07:01:31.935Z","title":"","comments":1,"layout":"post","photos":[],"_id":"cm6c7md6l001na5t2bas2f99k","content":"<p>&#x3D;&#x3D;âš   Switch to EXCALIDRAW VIEW in the MORE OPTIONS menu of this document. âš &#x3D;&#x3D; You can decompress Drawing data with the command palette: â€˜Decompress current Excalidraw fileâ€™. For more info check in plugin settings under â€˜Savingâ€™</p>\n<h1 id=\"Excalidraw-Data\"><a href=\"#Excalidraw-Data\" class=\"headerlink\" title=\"Excalidraw Data\"></a>Excalidraw Data</h1><h2 id=\"Text-Elements\"><a href=\"#Text-Elements\" class=\"headerlink\" title=\"Text Elements\"></a>Text Elements</h2><p>Broker ^vpVFc8Jz</p>\n<p>Consumer ^HlcmoCYz</p>\n<p>Pull Message ^iEKLY3mc</p>\n<p>Processing ^4SqNDxs2</p>\n<p>success ^i4gc31t0</p>\n<p>True ^6S02Vu74</p>\n<p>False ^thrRj5N6</p>\n<p>%%</p>\n<h2 id=\"Drawing\"><a href=\"#Drawing\" class=\"headerlink\" title=\"Drawing\"></a>Drawing</h2><figure class=\"highlight plaintext\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br><span class=\"line\">31</span><br><span class=\"line\">32</span><br><span class=\"line\">33</span><br><span class=\"line\">34</span><br><span class=\"line\">35</span><br><span class=\"line\">36</span><br><span class=\"line\">37</span><br><span class=\"line\">38</span><br><span class=\"line\">39</span><br><span class=\"line\">40</span><br><span class=\"line\">41</span><br><span class=\"line\">42</span><br><span class=\"line\">43</span><br><span class=\"line\">44</span><br><span class=\"line\">45</span><br><span class=\"line\">46</span><br><span class=\"line\">47</span><br><span class=\"line\">48</span><br><span class=\"line\">49</span><br><span class=\"line\">50</span><br><span class=\"line\">51</span><br><span class=\"line\">52</span><br><span class=\"line\">53</span><br><span class=\"line\">54</span><br><span class=\"line\">55</span><br><span class=\"line\">56</span><br><span class=\"line\">57</span><br><span class=\"line\">58</span><br><span class=\"line\">59</span><br><span class=\"line\">60</span><br><span class=\"line\">61</span><br><span class=\"line\">62</span><br><span class=\"line\">63</span><br><span class=\"line\">64</span><br><span class=\"line\">65</span><br><span class=\"line\">66</span><br><span class=\"line\">67</span><br><span class=\"line\">68</span><br><span class=\"line\">69</span><br><span class=\"line\">70</span><br><span class=\"line\">71</span><br><span class=\"line\">72</span><br><span class=\"line\">73</span><br><span class=\"line\">74</span><br><span class=\"line\">75</span><br><span class=\"line\">76</span><br><span class=\"line\">77</span><br><span class=\"line\">78</span><br><span class=\"line\">79</span><br><span class=\"line\">80</span><br><span class=\"line\">81</span><br><span class=\"line\">82</span><br><span class=\"line\">83</span><br><span class=\"line\">84</span><br><span class=\"line\">85</span><br><span class=\"line\">86</span><br><span class=\"line\">87</span><br><span class=\"line\">88</span><br><span class=\"line\">89</span><br><span class=\"line\">90</span><br><span class=\"line\">91</span><br><span class=\"line\">92</span><br><span class=\"line\">93</span><br><span class=\"line\">94</span><br><span class=\"line\">95</span><br><span class=\"line\">96</span><br><span class=\"line\">97</span><br><span class=\"line\">98</span><br><span class=\"line\">99</span><br><span class=\"line\">100</span><br><span class=\"line\">101</span><br><span class=\"line\">102</span><br><span class=\"line\">103</span><br><span class=\"line\">104</span><br><span class=\"line\">105</span><br><span class=\"line\">106</span><br><span class=\"line\">107</span><br><span class=\"line\">108</span><br><span class=\"line\">109</span><br><span class=\"line\">110</span><br><span class=\"line\">111</span><br><span class=\"line\">112</span><br><span class=\"line\">113</span><br><span class=\"line\">114</span><br><span class=\"line\">115</span><br><span class=\"line\">116</span><br><span class=\"line\">117</span><br><span class=\"line\">118</span><br><span class=\"line\">119</span><br><span class=\"line\">120</span><br><span class=\"line\">121</span><br><span class=\"line\">122</span><br><span class=\"line\">123</span><br><span class=\"line\">124</span><br><span class=\"line\">125</span><br><span class=\"line\">126</span><br><span class=\"line\">127</span><br><span class=\"line\">128</span><br><span class=\"line\">129</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">N4KAkARALgngDgUwgLgAQQQDwMYEMA2AlgCYBOuA7hADTgQBuCpAzoQPYB2KqATLZMzYBXUtiRoIACyhQ4zZAHoFAc0JRJQgEYA6bGwC2CgF7N6hbEcK4OCtptbErHALRY8RMpWdx8Q1TdIEfARcZgRmBShcZQUebQA2bQAOGjoghH0EDihmbgBtcDBQMBLoeHF0QOwojmVg1JLIRhZ2LjQARgAGABYAVn5S5tZOADlOMW52pKSAZk6eTt6pgchC</span><br><span class=\"line\"></span><br><span class=\"line\">ZgARdKgEYm4AMwIwlYgSbggAIQBOegB9dcIARwA1ACUAUQBZAFVcbBYoZ7MLjHPaEfD4ADKsHqEj+bGYzGcklwUGwkgapWYUFIbAA1ggAOokdTcPiFATYvEIKEwGHoQQeDGQHF+SQccK5NCdY5sOC/NQwSadbnkiDWOoVEWNCCYbjOGbxADsyW67RmSXafUV8Xi7R4iuOgrQ8vaiR1ip4vRmMx4l0VSWOWJx+IAwmx8GxSGcAMTCv2dJkQTS/XHK</span><br><span class=\"line\"></span><br><span class=\"line\">FkcYhuj1eiTesTEbrEXCBijE9FoeIzbSXToKy62i2LU39UWSBCEZTSSbtS7aHhJeJJS4zXrde229WOhA7SZ9U25pbdY5h4RwACSxE5qAKjUgAEVcABBboE0gzCEEmaKmZPPaaCh7Hg3B4ABQg5IAuo7KfiIcjSHB2Qizsx73BA5phBG3sFMtkpzOjTFLOJy7BInQIA8HyEIqY57AAWnOHAnh8NyEE8STnE8YxMqUsCIGcuCkDiVDkmAAC+l7HEIc</span><br><span class=\"line\"></span><br><span class=\"line\">BJtsYGoO027xJ0LEzJcvS6vExxEBwuLcBwQjgjxbDYPiDEHPgRyioQEZYIRvSBns5CZBOAlCfgxzhsQT5ToJ4KFORAzAZA+EVNAWBQIGQytJM8SWscNmjOMFSKm2OpMTMQ4yRsWw9mgknSdKpwSPQcBPAAYtgSQAFJGEpYKQtC5nImiIhINezqEmmkyZVSNJ0hADKnFpwiVrpuWiry/KwEKUqlOKdL1ZAsrGuxnTaFMLbNoqJbSkaqDOFMHWqtMa</span><br><span class=\"line\"></span><br><span class=\"line\">rtL0lw6kk3nSk6VJRp6Pr+sKH4hiOQgRotMboNi1jMHygTZCmOUdF02hbpcbbdPElxXXaPBktKZYVlWaDdHEDYWr0vTTI9Sw9F2/moFaXQFq2w4suOk75GREALsuq7rpu267vuh7HmeVGivNt5vhVEivkR77HJ+m3ED+GRZDksOziZpQhegBLrOcADSuAABJPDFAAyIwcLJPMGM4mCSJ0ADiuGmeUhHEWwpGzpRjRXqKNF0cDnksSxlo2jdPGyfx</span><br><span class=\"line\"></span><br><span class=\"line\">aD6ZpooemJwOBQgIKcFAEKEEYFReXWzZJD0iqLK7nSzNb2QRbg+hggN7THNsmBWRI5xZV6pOhEEskVMsoqh1Ai5EMobToMEexWY5TBQOYBCpxWGfQLygZ6NkuDx6QalGxpPKkBWskEAAKpZZyR1S0cyXJrXoLg8RKSpCC16gxuleTBNj/XorkBQbdhx3UeBrgQhQGwLzhPbFTYkIVum/HHPlpW4eMXWvSGcZScyxIvEZaKTkZ9Mly5y0zkcBMHSd</span><br><span class=\"line\"></span><br><span class=\"line\">IqUxtgs3E+U2MEei+xDj72CgxCAAArXAUxxas2IPEAA8usKBUlzjtByJIH4DwErggKuZOECIkQojRIGXG2ViAkjQE9TEN5qTJRfO6Eqs8ypsg5NwZqEBqrYAFHVY4jVJTHD7vKFinUli9TbM/boH0ZiGjlHMLMbYugaiSD/SaNY8qundEtWMK0AwxzEhtLaOidoQDjDsRMyZjipioemVA3QkjZnzLMPU9pegWluscF6J9uBZibGo1sPAugyIkaaB</span><br><span class=\"line\"></span><br><span class=\"line\">AQ05E427AxLW3RhQyNoZADa0MAJwwRiuNcG4tw7j3AeI8p5zzKy0dSfGHCJDaQ/F+Cmv5qYARVtKNWKINbMVYvMfsM19Z8XUsJU2olxKgKkuAuhREoDnFko4WoPSTbSiyMQcZEZZLKGmTxUIUA3T6ADjIHYJ42CyVPuPHGURSApzlhQMsuAGKHNmRGRcZyLlXJntKOAez/y00aIBRozUSidDIg0j5ZEwCOOcfWGYbikgeJ4F4wF/jLiBI+iEvsP9</span><br><span class=\"line\"></span><br><span class=\"line\">4gRLVH87GwVe6EUVEPf2I9Hm9OlNpKe9MygERoeSJWFEr7SjMmcO+1kmDDAzvmYOD8mWtDGB/BOix3bKI+scNYQCEAgICmAwVkD1g8FIAADUwGwVmDwhBszCsoHmmB4IQkuAATWwHgpKtJCE4mIciVE6ISlEjsaSEpBCmGMgnuVcpqAuE8L4V/LhgjOHCIUWI9Uk1eisS6PmfUfVSgDWcLaOI3Qcw/R4C2FsrZtwlO2stFaa0jHaRTbGeMViTpWv</span><br><span class=\"line\"></span><br><span class=\"line\">ek4u6oLwWQuhc9Y+b1UCwvhcEnoSLwmRKBgxK6Ux2hdVmqUFJE40kgQyUjbJqM8kY0KRiuhWU7zEynhASppNqmUz/DTNAeR/mQCaaKxirTtYdI7ZAXihtp6EtKGbAZYqhnXlGQsyZyy66HsgHMy9SyVmmzWRsrZ9Fdn7KfXNY5pySIPK/aUOZdy/0hAJTM0oLz9k9oBbOMA3y4N/JWGAT5JRgVFtcfqCFniX4wuSHCyRtbQlMQbWi2cF5R2rCxRI</span><br><span class=\"line\"></span><br><span class=\"line\">XAKQQTD1Htc0oxKnWkrpRSxoVKjKFBMmS8yDLX7Mu4DmKJ0pH5cs/hu+JbbrSJ2Cr5YBFtxUyUgRzFuUA5wQpuASF48RWY8BeGwOcMx6D6BPJ0XYIJEq2thMaxEpqyEWtOrwG1jDCbMIs6w1kU8XV8l4bVd1AjahNW9W1MR3R1Q5mbJcINOYAH9TlPWdo2gAbzFBT9fsoaKRZSzegX0abDGhkzaYn0Oakx5uoQ4wtLiwWYdLTh8tr1T7VoI4isJK</span><br><span class=\"line\"></span><br><span class=\"line\">LG3ROBg2YJipepXUhqObt7zSh9qySjXJ6MClY2KUc8dZTnwVOqVU8m866n5BXRANdLSFRtOCSxTpB9uk3vA7u/pimz1HIvRMx9x3jj3uu1M27z6sSvrUO+15BynkjJOcB+W/6ns3OIL985oGAOQEg28pdZEUNwaQwhsjSGYdoeqyW7DcPmtBNa8R9rpHlYUZOFR/ulxcWqTAxPCMJK4Zsd4JSy+3Hr7kszvHRlb8WXfwE5yly3ALSON6LaHUgr5M</span><br><span class=\"line\"></span><br><span class=\"line\">ivO0FBmkCzD7naOcIQzAPhQDeBzKBzgYAcBgLdIQHnpSgnwa59ARC7OkPNbNqklqKtJKKvQ6z9J3OBhZI6hbzqeS+bdYxYUgWJRetFCInb2hwtNk6FFmLrF5HGn1B1Pn90ZNuXtGy792Xit6Py6KYMGbqk5fMaV6xopbEVeR8W2raPSwVqa3hmtWPkWopE5iGJpIwa5mEzuiAXaYZQ97UuTJyMclo3yZjIpJQNsUInQ+KdM7k9ztqZD6cG2tsMU1</span><br><span class=\"line\"></span><br><span class=\"line\">rt7dXT92MdO+bCSSnv1XcWY9g9J2MARgfdv5fEB8AvoMG+nZH2wcW9GcD/7O+7u3PuaDgHEGPvQZKDD+DvyEfQ8BXnjD7ihesGGOCKdabWle6KM2mKxA8k1Gi4JO+KV+zGDurGN8NOHGdOJQPG1OFki8HOnAkwAaDo7KrO4mCckarEW4SQ5uQqfka+F2ECZwHM+A2A+gbALo2q8UlmOuhqdqLCceJuTmseY6+UuuRUNuDq7CDuwhkArq/mruHqQW</span><br><span class=\"line\"></span><br><span class=\"line\">QiXucoqocQ7EM0W4mWEAQc8QvQyQ9e1BoMOo0WyaCeuW+i6ahWae5hEA5yag980oOe9imotYCwaiTEehpoeh5uPilaH0nU0w3UvUVovWj0TavYaijinQYMA2NEQ2re0o6wDwc4uImASCHwkgSQewLcPA4sewnQLoY4RgbwIwVk+Og+82U4RUb4y234E+i6U+1EtEzSs+m67S+2jee6V+x6IuwykAewNsdsDsfiWYvUrEairs4WMRvWcWpQgxvs/s</span><br><span class=\"line\"></span><br><span class=\"line\">gclUtK7cEgboHAzAQgmQ3c0owYYQDKHQxBqxYcRc6c9KCA2cLO+c7gZxJc68JMooFcUQ1cDGX2shjc/grcax6AGxWxOxgYEysB/cksdGeKbxt6061SU8R+c8C8p8EAfx2xTAK8a8G8W8IxaAu8/Rx+h8xekw58mBRQDO5kQQRAcgjhgwHKBBNC6o5uYmXOaA6ofKFo7sguwq66lsEqZwPAbwnQygEI8ElwmR5wzAEIcApAMAuI2qUC2qY4EI+qVu</span><br><span class=\"line\"></span><br><span class=\"line\">EA+uJCZq5C9Cpu9i5ug+YhxUmuTGbC3mTuNUQcbuoonqXIIWg0YKbh9o4WHkv0nE9WYa3AP0nU0eehswxaP0jeFC6eeW/oVhxikYthFiCYZWNiTm1oF0HYM0Ae0w8QH0cxkAfhp8tonUmYwSKiehlB1oERaArsloRZDYcRqSw2kA2APMNwLwkgMqzAFAIwuoPABIIQ3QMqBIYwc4uEEATw8QuRrMygxAIwUuiCzAi4rBbAmAjcBI3ZyRqR6RmR2R</span><br><span class=\"line\"></span><br><span class=\"line\">uR+RhRxRpR5RUBIheMk6TqNRxMdRNSVMk+y6zR6sbRO2W6nRi+PRZ29BoulGMBfcYoHMCBEJu+yBekGkRJ2BaBGA4IhAFJLOgmNCSZ+BHAZBpItoiSwSjetBCmd5OJjMEAiouACAQgLoUAJ4LorMLwzAWmUALwi4MUPATwkgY4ipYhKp9mRuAh+Imp1qxut4upEhnm9uU4PmJp/C5pShnu0o3u+Y4icaP8ioU00apoIeIMiQE0Hh+ot0rYiw2hfp</span><br><span class=\"line\"></span><br><span class=\"line\">oZlhBWwZ/pme5W9i0ZNoLs8ScKDYoFRejWpItYpoNobaXsOZmYeZnWDEXkzYMiSoxxnaUMCR04cMlZ1ZtZ9ZjZeoLZuAbZHZhm3ZvZ/Zg5w55wo545bBU5hAM5SGEAc5aRGRWROReRBRRRJRZRfeYAA+luVRL4tRs6K2DR9Sp5rRkw7Re2XsXRBsN5q+gy95BOj5hE5FYJpOSB0JTqxs35JJ9KzOYFpILEzpTQ1J4FjJIMHE7soMzlqwQunJ6+Yu</span><br><span class=\"line\"></span><br><span class=\"line\">ZwLchAXwrgLwuIMqcAQgHMc4Oo8EkgMUm8ewVA3BBqhUVFhu6pWU9FNCLmvBbm9qrFUh7FxpfmppihHulpKhbUbkyWmonEw1EWjiBoooQcbpWs3Wj0MeDYs1Fu8e0YqagZqlRWiN2aliEZ2eTm7syW0arEmYGW2o3i+JGYn0wS0WbkcKCwMR2pNeBZCacwbYXCze7+FZVZNZdZDZTZ/lgVnZIVfZPAA5Q5I58QY5E5sV8VcMSVC5qVy5GVa52VFR</span><br><span class=\"line\"></span><br><span class=\"line\">+VO5DuUJ5MB5q2x50+LR66c+l5NV15L+K+J6qAXJl2JyB+169+oo92W+VtR+J+L2Z+b2F+n6Rt1+P2T+lyV+QGXtZOooEOjRKGn+cO3+m5H+gKyoOYrhQS24cKMicOzgqoCQ9YcKmo0eQaF8P+s4MO0ZDYCaXUTE38t0yZJQzg9kyQ5NTE0a1BwoeoiGv+sGk0ldnEXscaLEpoJZgKSdUl7susOYrinEMwDdOdkd4eeNOoYKLEHipdYASdMZUKH0</span><br><span class=\"line\"></span><br><span class=\"line\">CwPAjiDYzYI9MGs4X+kB/egqhOYoMUr5/tRKXVKBVOaBPAtOJQXGWBfVEgZJAFYQQFtktJcaYFEFHQlo4WMaAugCdBjViFkC4s4F6wXwY42q+RMAnQNwUCIwvQBIi4Lo9ATwOKZ1Spl1apjm+azmjFDCD11uT1J9XmTqHF71XF0oFpjuP11pnEyQUwURXkMirE/WYN3AYiaoQSaiehcKllZhaNFhSeex60qNuiuWGlkZ2DConUWZ5NVo1BmoehxN</span><br><span class=\"line\"></span><br><span class=\"line\">xlTJSW09ad7sHEUWvpdNjEOomY4WN05uLN5Zyp7N3lXNflrZ7ZfNCVoVgt4VItYtMV05s5KRyVi5aVK5mV65OVeVc2Kt1RRMD4GtpV5Z9MqwkCzMbMnM3MfMAsHAQs+gIsYsoJgKvGssJEOVFE+OM+lVF58wVoK92h3R7tvRCFe9LV1GrMR9nVk83VX519NKeEv5/GJBwFG64RbTnO3KvYejV0vUcNcFwu5TymZwIwNwbwLomwPM8QUA+ApAHMXw</span><br><span class=\"line\"></span><br><span class=\"line\">MUCAyg2A2AFAJ4uQaDlFtmqpDmuDt1ODtFeDhUeptuhpJDb1LuXQn1wW1D8oloMZEx0aLseoyZOhQmTi9o0WM9EKqorYI18NC0ylgjpQKe1h5M6lGNWeThTmtDSZ9kUKU05odoSjviGYWYmo8SvWvWU0PQZa1eGsGoP89YUFpZblKGPZAtQtEVUV4tLjCV0tKVS56Vq5WVG5u9uDQ+j4u5o+ex4+R5Qd2tZ5eTWsHRBth2S+7xx+t5AD56FtD29t</span><br><span class=\"line\"></span><br><span class=\"line\">0rttV6PRp+myLtxAH6x07tWIN+ftPtj+IG3t7tgdrNIdgKYdnLo9sGXzNot0/YMeAzidtY8SMiW4bauobaqoG9EdsGpo0jUwrKd0bsyLidmonU+NP0SoqoSoTElwvryGgK9YyQEKiwjYgNslnE4b3Q2gvWcZba1BN038GoibudyouovWjiN0MifQNo4bcQ2oU9N0HiHiU0V0Zbf+WYk9fQrs7UQRgM3diQPQHiAeHiNbYKNYnbsGbYCQUWYKXs0w</span><br><span class=\"line\"></span><br><span class=\"line\">AaVejQcQjYt0tdUedbWd4dSbTdSWPObraoDYeo9bgKaovu9lXQxYaiNosw07s4bpXsYKU9nsrsv9sGK9gRoK1BcKkKuYw92dm9jQ8LUKiLJdKLoNwBcQPzEesWEWjYD7IH+hz740jYwo77s9ydiZ1BwSg4CwzESHqGtYGjpo2oao24aoK9cOfQCQ9ot0fQmY7bj0RHQK6hNYU07s/0woHENHFb87KiS7uYl9QHfrs4YKyWhY6oz8hZ9YWHTiConE</span><br><span class=\"line\"></span><br><span class=\"line\">2ok0P839Inu7MOX7fzv06oExeh9kK7qGyoqWUwP0rs0bt0rHX7UwP7toWGNYmWJQW4CQTEbkM0iZoSbYVnSW0ajp9keh7ErJSSTnSW/70nAS7S97one7s4AbIlCoW47s24sbfOcOj0GZ2oMxzEkW3QrH50xdNn9kTD0aDkgKrrdaHrpobaeofOrH29ZG+OQJT5uAPMNT7tH53AqBjO6n2TjT9OtKLTA1XTNJvAMx79E1ANSw9Yji7zQzC1DBS1Eg</span><br><span class=\"line\"></span><br><span class=\"line\">CE+gIwUCY4+A2q3QLw2AygLwLocAUC+gMq2ALoIwFF+Dypuz1F11gh2D2pluzFhDBpxDDupD1zZpFDPF31fFCibpP0+YVoCobY1ogLA0cKebDr3hOYwogNfDoj5iKlyewjNh/DGe0Lmlrpubqox7lbTEaiuYaLlaehyQC7k0Go+oIl0a+ZqA01FoX0cNxjiRpQdjNLjj0Vk5DLUtbjMtLLXjCtHLuVNqBVi26txV9RgrZVqsOt22Yr1VB20oJT1t</span><br><span class=\"line\"></span><br><span class=\"line\">Cvsrp6TVerCrdthr8yirarTtGr2yWrl+urP6t+z+SvgGRrf2ZvR+Zr5ZFrsGVrgvjds45deb1dP0bdzY5oP0idyoEW1NGicauYbarHQ0ubXQOo0bbkZH9eDb2gAemoNYrhcn8ZofUKyQG7CwW7TlO6ZdeoEPzbehvUIl5oofLYCQBTbaUWnE7r4bHU0eLiVHG7v0SQof2Hjij0E0moBHQPidubuYbsjNdo9kuYbf+hTlDHQ97bfQNHebJnEKv0Cl</span><br><span class=\"line\"></span><br><span class=\"line\">9kbfJHCfSouoOSWLjnYAE0vuAaCjt038rYCaofVo8fTlHEE0Swd0FoaXUlPDbncadbbaPXTvNrLvrYvu0mJ7wl+PhnYATsZsMXUTI1YkurYU/lmFYjfMlg6WG/sFyBTdt9Gi/ftjNHaBt9+O7EBdtMDTYz8/8GA5sIJzTb6g2+HUYfu5Bh7RYFQvUOHEsHj585PSmYYPmojL4dRHofze0NuDw7B5AUZ/KAU2BgHX8poO7a1sBzz5OJXY0wNyHGke</span><br><span class=\"line\"></span><br><span class=\"line\">iPQP2j7SARfwEEcdqCofJiL7gC5ekJomYUGFB1nDxJsw2ocgYsEoE/xVBUlYJE2HJo5hHE6OXNkAO1AgC3EbSYQW/1EFz0I2EfPQkp1jZ90RqJQLTq2B07vsGwrbUPk4jaRXRhqHEFemN3PY+cawSoIHgHnzDWhAOGnS1qHR3quCHywJMUB8Da7m9mQp9KcF1wqA9dOMTTCJmcE6DnBFcDwTAC3HFhCB1gMqIwEYFxC4BOgMUDmBFCCCBgcCrTH7</span><br><span class=\"line\"></span><br><span class=\"line\">qFn75SDescwJsMinebhoI+2YZvnJxjSKIJGueJxCvU0Z2h86cwAPI3lTK9g4grYJsBm2mp9A2w7uOkJi3VBahi+vOQIfdwRrw9fQaiPYL0E0BBkRGZib0PEmwC8pzuhUVKBoECA3c6KQhe6qcxYpEM2KKxUoHIQ+rksW87lECH0A+AxQXQpAIQC3A5g8xcAIwVeL0BuCKp4ILwGYL4yF4BMzgfLQlrPm1hgp7Q1BQamgCtDzBxuPTekeZWix2hYK</span><br><span class=\"line\"></span><br><span class=\"line\">81PomL0PILo3KNvN/HbwyGWs6u4iaLPMCkxjDpg+LOHF0GVDbgxhMeDiDERbAijhQbkRjkGx6BVdMwugxoHqA6jChzK3fHSn0ATbRdNOvuGaFNAsrChOi2bc9o8zmAFgvYnHdiL9Dy5JYX+7iTUGCimL5gZR6ZGkaCmuhzAawr/FdDF1Xbj8poloJiB4lmAAd4B40QItGg+iuwxhSnVjuxBTrrCHod0W6HCgDGFoAW6iK6HpUVCsdZ2wnGPHWiEH</span><br><span class=\"line\"></span><br><span class=\"line\">sQAx3bR6AOG1B2g3OlY8IdqDUT6hL+1XBUDKJrDSMCaJXCRAsBcERikcKwuNEsCLquc5OufHfgHnPjp0JoGjaCu2MjaoCLQFlEStwNgy1hcwEKK6BCg37Vs0B5ovASqH4F09BwN0GQmXRGj84Qi00VUPKIrHniZ2ubcYu5xkEWg06idfQluJ9I1gFKWorMZOMbB/NLBP/ROl8w2HzA6eXvaNFZyzDdQdQdaRMnZytDhsksSQy0NqHrDxlR+742Lj</span><br><span class=\"line\"></span><br><span class=\"line\">53YjRZ9OyQ7rC60roMdlRIlG/pmCs7n9pxTYG6Dkjujexu6ubDfqkJXpeFdQtXYiY0GcAGioUi7Gqj9AtBeQJo8AkSef2B6jstCUAkdnV0yENdw6x+dVufkN5u1ChHtMZDr3doqsbsek9Xr+it4ms9JvtY1sfQZj71cACpdqogXa7FDOu59brpSm5Ga0hW5VXWlVQXySt6qJtS2L1UYISAIQDwDUPQHwC9AhAzgJIC6CaFfAIoMqVmFAAJB2B+hg</span><br><span class=\"line\"></span><br><span class=\"line\">3dkIGG9wV0NEGgzDH+0bzhptQdYe1o2CzID0sJWNbBjdDzZx182IlfUE/0J6nw20bvb+JaBjTiiawK7MUF9yrSdQLhHiK4Qvz6C3DgWqPB4YqCeEvCUaKPeHntE2KHRqYPw8yGcywYVYZCQLJihd02nPUp4O06EeQxcqDY4RlLREciNRHojMR2IoQLiPxGEjiRXLYXpUCWzU9pqNzekmNRMoCphu41ZkYxBK4+i9CHIjklyLHwlVBWfI6VrbyZ6R</span><br><span class=\"line\"></span><br><span class=\"line\">ifkak9If63KmPQHKIlWGu2Fn7TQE+6bJ0rqFy5CSSgiQVsHozbZTVbonTW1slhmgz0foEWIHvEDy7dsbO01WQYmm37nQOIOonDkeKhRpCRBYnVdtxKmi4cA0MaX6G5H7HulLQ38KLFClBTMziZAAitrGJq6sRF6JwsrgkCK5NhIhNdOmZWP0JxjLoQggNPqE1Cz9TQOYQApNCbKcRKxiQMYa2LUT5gpJ84uSXIx6xCDyOCaVvupKFmaS9e2k7Vp9</span><br><span class=\"line\"></span><br><span class=\"line\">khJmTLaWvKOcb31Y2StepvSyUfia6EQW4BQ2Eq5LQClDSQnkqGeLwXSS9Gk0vc8rLwCkK86qpTFXqbTAShTFu6ACKPpmMw8xNArMUWPECgRfANMBIKBBCHWAwBzgWUxnLiRylWlREkAmPDIhJYyY5BkAcNDaDrDTUIUbaQGjpW0LOFuA9UxMgUxkRuycyvhEmqgFrDMlfRcwffvZGlncUvqQ049pcPHbjTUuuDf0l7FmnPDXhi0sxMtIOhEQ1p2z</span><br><span class=\"line\"></span><br><span class=\"line\">faWCK3KUJtpIIjaf/KKEvcpwx053PIRuawjWaEAK6SiLREYisROIvEQ8AJFEila/jYfLyw+m2VSQ38G0M/Psh0iq038RvAySBlqg5gXEJyuyX/qq8cSZMfOdTFhmQl4Z8ItwfVxRmxc6w9YXrHWihSw0F+6OPNqqBbQcRVE8lesKx1Jndjo03UK0LGj8FgBEgY0diI2Eo584FFLMyTs2AVBSi2w/qXUSUFgkCy8eiZd2XCis7cTFZ/YfpvbJUXFi</span><br><span class=\"line\"></span><br><span class=\"line\">W+slcLCJRCJZjlQEiQIYsCoLyM4cco44Xzn4Wksp2Ks2jvi1kFWjcw6o2eihPEXWglFEKWtGeJ4WNBN58SL+iDSEGMju6I0MFOFh9KUEvCdoLIRtkdrrJnaBvMOVfkjmGSrJ++epUfjMmJzbJd6S3iDiTnSsU51GL4OnOlYdcs57ksobnP5bQyC562XyTL3nxXlAplchqowtrnSwh5D9QCqQpYjxImREmd2CXSiI0FORIzMKegDXhIJ9AioJBMGE</span><br><span class=\"line\"></span><br><span class=\"line\">XDtB4IXwD4PYB5hfAng2ATYutL4L6ksst3IBVy0e78FnuEIjoFc2gUfcGog084XTN6x3yfSD8oYdaUzAxleoxGMGPWAkpY9WSO2FsBNGiFw0lK005+XNLfmQtQyewYlRj3ejKhbQXQKgVvwmltTa88fIpmMK3BeDmp1PPUIvVNByzYFJjBBTdOQX3THp6C56VgvyhvS9ywTCprkNwBPB+lkJQZXpOYU8i1sS6YVhVQ6D+TZl5co7HpLKYAMlloEM</span><br><span class=\"line\"></span><br><span class=\"line\">4JIFxBzg5wPMIwDzCSAUAvg8EFuDAAQDnBxYPMEIEgh4CDzzIVQGoB7lHlXRksw/TiKV3iz0iSO8YmrksK1IXsBwWg/1aUB2FfwxiwfKNZAEoZcIcV9w9oAgDTVpqCVJiVHp/NWnHRf5oIp7h8qBF3dgFby85uAt4pQioFMI0UIzyaKihlI4JNpc1UlWS0iGFOFjMMr8SjKKRlVK0PEiUmkKd5WyhONwwsqFi/68FOVnnMVXHkyI4TfVRHCgAjAX</span><br><span class=\"line\"></span><br><span class=\"line\">Q9y9YDMBuD4B2gmAegBzHaA8xOg2qL4IPDhzpNqMZyLJjfSAhpMkKXwZgPtjHCsxCAmRJBNgAtBfBcQkgB4IQBii4Iz1OBIiJkzIhUpshm2YuaKzaQg8bOhtbVVXJCl9db6RyiAFE3ZhcxeY/MQWMLFFgSxXVGTeWLlIUTqh4+NWbQgND5x1g5KpG0NQSTFGRrtCMaxiBCn+p+rtCSauHu8IzXprKSkAcFmpVsK5rv5+axtVZh+XvLdpgCrUmWse</span><br><span class=\"line\"></span><br><span class=\"line\">q/KwF/yqhtKBOkBY61rlC6RtibUdV3aPS/uPBArWdqz6IEanOUNZUtsYiPQHMKQuAmjrXSh/fhV0HoXTrGFXk0JgjMXU4Fk4UsJdegEIBvBWYPMbVDMH0B6oQNOTCDWqvyagpLQxTCuXBoWXVyFu4OAUQjPt5b1VB2Ya9qxvDbMaYB9kMcfjgqWvZqlRvThXn3S0xFMtZEIaNlvo1K1N8qrIZSBHSC8igGIDMBhAz2BQMYGcDBBkgxQbdlBi2AGX</span><br><span class=\"line\"></span><br><span class=\"line\">JwjoFbgZuzDDUG0i4YJVlAuAd8GgGVCBJO6YeP1DTUc4QBQQmAV2jqx3y9r2l2vTXg1tmQNFR4DAcKFFFihcE4YA2obVyHj5XQupAHH+Iwwmi58m8s2jeRdEWBsS+c0fbcJNASobatt4c/ALtv0mtKE5BrC9Zkzuz4BPwFAPonqqQo+a/NAWoLXhokAebR58SUgYY0W0U98wJUuUBRv0qJYE1dhIQnGnS13QpgEKsztrIazoteAbGwacmvoT+kuN</span><br><span class=\"line\"></span><br><span class=\"line\">mahaYSpzXkAVpQmnOCJp4KFrZNEmw5pNL2nC7xNduF6lWtkI1rTpySVTYXPmL0YW12msUPBGlXk4dI9TCOToxq7+zYslm3UQwDGof0HEy8hznrCnXDMZ1YylhZPiPy5NwtsvNyPMH6mK8Ha8GxaqZB+IQATwGkVAB8A5DRAeN06SgPCTOAB7wQQekPcoDD0LFbY28AhT7CgB+wA4+AcjSHEsh3EzgYgbICiVfg3FC4acEuAHGIDEB6gxwZ4lXHZA</span><br><span class=\"line\"></span><br><span class=\"line\">1xImLMNDbE0w0JNsNKTQMJ6CbgcBvii8CQNHvwCx6EQoe1EuvE3isBMSqAbEl0gQBHxlGZ8S0IjsgTnAV1a65gDzA3Vbqd1e6g9UepPXo7+4l60eYvU+2HitCElcHjEWIyBIaNHQCuivQsHUCjKjOjqF9Bp3M6r5rOu4Zxu42c6keqebnUtN51fyjoAurXKJr/lFrRdTmcXScxAWQHpdRpKqPLuU3Sh61J5Rtarqvzq7cA80zzPppKHdr2MiGvtW</span><br><span class=\"line\"></span><br><span class=\"line\">dBtKU04aj8UkC2Gs3zapEM0CwQ5tt1ObZ13k5XaujC0boItV0esNFq1Ve64tZtZ5ElpK2IzYcwolWRyrrAIpr9lrDPj/ECRlLVkIczVjUoRmSH79b+pDC/rjYKGNJdSg7Q0v231bUApKJrawsgSGrjVpq81ZautW2r7Vjq3AM6v62iQbtzqcqWyuPF84F+g4ExW9rm0091BMhkCIDp0nbaeqHGeVuZM6UtrrJFkyBEBoI0w64dCO4gzxiQrdAIpI</span><br><span class=\"line\"></span><br><span class=\"line\">wdYJgGYAuqQ4v5THfczP73QH9ZGoTMZzbTyHH9sLbBgDQuh9Z1QAXK6JNH3lz7qDl8u5sc3Z0/6w9fGt4WcEE0gHXlMm8TRQjF3SaCGIuhA5cyQOcUUDZ0+ImpqclvkJVzXKXZnNMk6NZBsWGCpZveaUKJMNYHFpQIhg275uTVBVawavzO7ODYrcYeQtg38HgpPu3AgiRPA4gxACIR9FpAj1+6PjokDkD8cbVDFk9NCOGonvT3LF6R2e04qXouJX</span><br><span class=\"line\"></span><br><span class=\"line\">Ei9BcfALnox1lxq9NsWvUwFWNVRPizcfAJHr72fGgTUyARGiTH1gnJ9qInEnfFn2M6ksC+tI6MwkBwA9gi4ZQDFEwDtA4Ai4S4BQHwAcxcAEUGKOcCgRPBxYyyAo0PMcD+xOA4mkRNV19x4seo5R0PGVKoK7G150BqYBX0jUvM7od0bYQfO3DlS3F7+rowAp6Ncas1IZHnftDzWgH5i4ByXYCMk0MVjmSpA6eCJl3fdq18xhQlyuVUrG1d9ksPXK</span><br><span class=\"line\"></span><br><span class=\"line\">uzlEHqU+Co4laEzDHiDjv0tAORJoMOIyZhg/ZRDMOVgsBWEy1zbesgT3rH1z619e+p4Cfrv1v6/9Wk0A2XqQNSGNzYUfbhnqkd3QVZmCigABg6zC6/M9UMgjQRYICEJCChDQgYQsIOEADb+USMKxIj3Z2DF5ouBlERg2qAkFAA+BjgZU4sD4NyZ4AmYRgLcBUJ5prPAbFYoWkVi7raTKJpoTx6VjqsWVMnkNhAVs9gHbMGI76u0Js/c2zEahAa7n</span><br><span class=\"line\"></span><br><span class=\"line\">LcONsJ2h4KN38eNVqewZ/UosQApUNH3YhGm59ZO9jY/NDIc6+jyPAAx/KAMOmRjUxsYxqWgOTHxC8Bi5q90BW1rUDSuyZRgebVYHQzWuvAzrodzNL9dV/NibqC4SUH6RRNAGebs4FBEbQGZhhfFsuM5mlVek243rQPHIsPdMW545DJOIIktiazDhL8fnh+6FLXxrZiCeyDDEyhXCSE0sUz2ulYTKceE7CGpiF6SCxelEyZfQDl7K9Yemva8UgSsn</span><br><span class=\"line\"></span><br><span class=\"line\">2TnJ7k7yf5OCnhTop8U5KdxNd6e98loQIpefBknR9GJHeNSen10nK0DJndtevSMFmH1XsJ9S+skBvqP1X6n9X+v31ihD91DaMaDDJ3kanEXQMmcEdKDryaEFfKSXSQkSUDOJDOytJaHEFmcl5xfZ+acOULdGkLvRm0+niGM/zBd51OAyLvGN4XvlEB6Y0RdepzGyGCxxXedLYPrbMDWm+yXsD030WCDhmi+qDrCDAxWj+YuRusrVApnqao23zuDI</span><br><span class=\"line\"></span><br><span class=\"line\">EuCHsz4ykS+gaLlnm7jF5yYYC0903nvdCWiABwuDpCiHeafaq3Glqvxtj2//CNL9GSCtXvF7sZgYHLA0Faql72XSShm+QRpoyolTQr1Fq0a9jDph47RYaNUmqzVFqq1TartUOqnV+Rq7a4anBySPYbi9iC/34Felpt72joAkD5xeQz9V2wgJtrCPA7Qdxk7fLjZhlOW2THJrkzyb5MCmhTIpsUxKZcODaabBoyeeFiYirCpg2gvwf4b8TZhq2VK9</span><br><span class=\"line\"></span><br><span class=\"line\">UMNECEA6ebQO6ZLtZN6Q7DD4OqHUkZtqw75YqRqM0hrrkQAIIUEGCHBEQjIRUI6ETCNhDYA5WpzhG40N6zoYM2ZGZmpYBJQjTJ1MB+NczhPXeaVWmNa7ApYaLdn8DaVVVkwuFhtJ9AA81oOGghe6vTTkLfVgTRhf51YWCLo13C6WomsunJCiBxTcgYDMqbFrFFrXCtb0nYGaKz3fA25O2seSZzc0fXRqCLSP9LNyKrixN2h44s02jBi40wuEvzq6</span><br><span class=\"line\"></span><br><span class=\"line\">Y1Zxs3gR7MSB4gEIeYE8CEBuQr1p51VU9Y2UvXrzkJW84JZxLfXneXyZGULNENVbU7modO5jN47d012DHGTC0YLvqhFDz2Spfr0RvbaUMQ0ESjGWkM1HhJa7WtCqaxsGSDDwt5rWcGcvi23LUtzy7LZ8sK23DtNhJPMCbLHHGBbsO8draZJzsf40dH+J4dVDG3ebqhnbSPYt5GGTJyD8wx3GuB3BHgrwT4D8D+BYhAQwIKm4reG3/xZKHnVo6aFe</span><br><span class=\"line\"></span><br><span class=\"line\">0zaAjiQErloT/bDUN+9D028dnNtxz4jEO+OTbdOp22UjCFRfWcB3t72D73QHK0UZhURoU2a9SaGJXjIeJo7UWvhfmy8jwS62/U5O7RzbCHWFg+YrYVnaZ2dXZdEmq09xvLt2m+dwxgtSNZws3VxrHpsTRWvk1vcgVzNci0Gcouaae79kwgBtZhLSs9rDEUcQGhiKOVSFJuw4wnE7F1oIUgzA5XbpusO7GiTujg+JfiQQS4ab1y+x9aaoeaJALcak</span><br><span class=\"line\"></span><br><span class=\"line\">7bj+O970AgzveEpFBMT6FgqeqEwZZhNJwc91l5UmZd2JUkTkyJ1EzZZIB2Xy4mJxy72fdsDmvbw5322OYDsNx/LBJv3eM7D2rwwr4+iK3vCisHzYrRjiQO0CEAjACQkgG4L0A4BIIXkEUKCOLGIAUANU+gN4DldWVP0rS3Uy0WaYkplSObiL2qRVgEqRoxZ0DlMgfOmB5ssX5prq5aZ6vWmud2a1Nb1ZiflqtpUmhu7E+Sc+mFNfpua23bIsd3Mn</span><br><span class=\"line\"></span><br><span class=\"line\">Xdqi6tcqb9woE+TrtUPZGXMOBAOjSqX48kWkL0ZKZxPjGIFlcI5uslpp3OqDqzmQISFc4IueXOrn1zm57c7uf3Onr17Q8oOyFo0liX2iHfZkhfd3xX2ENTt4ksho1crqtXa5jc1ubgA7mVuBrwO3lZhUqJ4+nkTvtJ37A7Tw0MQ2WU/ybaMdUWaLrUsKGzCsQZ6+jDiPaMatNZ8uRBJmgW3ebF3iXpdyl3/ohbkvv9pLoa56dAVQH67iTyaxscrW</span><br><span class=\"line\"></span><br><span class=\"line\">+m5d/pmBe3aWNLWNNzknJzy7FD8RtdBTvXRrELaYCzjomRM6gF/Ypn3F8EhULNwafMH7dyr1mg2aHmWO1XkCdQKQBeBQJegjZI+2a7acWvqCVruZbFpeOfXb77/e++IbSUlBjj2YfDvR0Lbzj6+rEmQUgNujuxUlj9zTvG9ixJv7K0bdHBm5qrQ2pMysvHBpPhvAO1HIh9GefwTUADFg2YDG8ILyp1a2HcMMw9kBO1oPXLktjyzLe8vy2Ad1NuUK</span><br><span class=\"line\"></span><br><span class=\"line\">JPMpL1/o5nQ6yzYCNkPQjjDiI8Qb20xyTD6HvG2cE+ffPfn/zwF2wGBcfBQX4L+CJC9wfsV4+49qFL9Bp0ui+61HthmIrdaU9i60WcLKo75tm3hXYOy20fjiMxH8Nejo7QY91X3mXba7jd1u8NcDcl3H5mFQRIhtqJ335EhjlMISy0C/o5PUCxVgDR1gOO9s7wqxZN2Mb4LLOjjT6DLtkvbTFL0t2AaF30uaX7pgBeW8It1umXDbll027ZctvO7K</span><br><span class=\"line\"></span><br><span class=\"line\">urlx28lX4B+XDFwp/rp45ZlZgFCkdxQbN0TdMlKiQh4vcVe8aV7LT6Vua/yZag/V1rkSAIdeP9P65YCYZypdGcQA/YQySZ1pcpMzPNLae/S1nsWdwni4ee1Z9cU2fLPbLVep4vs7r0nanXS5lc6691cev9XB5y518WudDeRvsL80uSfCvcAp9h2Gfa88JLX1wADSMUHADgBQhmkg90yGWEyD9VfEAwBgIQAQAUBzgqF4tz6GJVQ/1rgPwbcRFYXb</span><br><span class=\"line\"></span><br><span class=\"line\">B9AUIL/aF4LelA4fIBscIj7B//6IfsYML4UGVIiBMfiPiKM6di+E+MfCPjIMj8+W0v0fxP6n0j4e41uMQRP+H5h8R8GZkv9UdnyT4yCAvG3wKvn0z4ig2w5ns3hnxz6gBY+MgYv8b9M959U/OfGQeEls+PyXFHTIvlX8z80e6eX82vmX4j7eAdK78uV6HZT8Z86/gcNqoeUE0eKYg4Q4IGVGwxsqO+cQ4IbVBvKkYVbSgRgNgAYG+9NACAEzjoES</span><br><span class=\"line\"></span><br><span class=\"line\">UN+y/9A3PgeyLwjBs+wwJAbSynsJ8J/iAUIBAAEdDRN5G4xAD4GwBgIm+cDwQLM9n5IA5YeM5wd0JAlIDKBgwAACh6zUBeATEJv43/cO9AAAlIGE3jKAhIREMkbX9wAN+5grfkf7wDH/h4u/4f5X7bHoSAv84nAT8oemWt4pN4ckRuELZtrd7NAxf275FaeLkk9/zz0UN3r+9Yl9/imteIcSpN7xw/dgKBAgGqBilu9cAPPwX+3+7/Z3ia6oIQEY</span><br><span class=\"line\"></span><br><span class=\"line\">AtwA/+XodrLKG0ukA/+BBNXoy468PoC2+FQDJZZmu6Gsjjk+cH/4AB6nr1w3062mCDhAnXJRDkQQAA==</span><br></pre></td></tr></table></figure>\n<p>%%</p>\n","excerpt":"","more":"<p>&#x3D;&#x3D;âš   Switch to EXCALIDRAW VIEW in the MORE OPTIONS menu of this document. âš &#x3D;&#x3D; You can decompress Drawing data with the command palette: â€˜Decompress current Excalidraw fileâ€™. For more info check in plugin settings under â€˜Savingâ€™</p>\n<h1 id=\"Excalidraw-Data\"><a href=\"#Excalidraw-Data\" class=\"headerlink\" title=\"Excalidraw Data\"></a>Excalidraw Data</h1><h2 id=\"Text-Elements\"><a href=\"#Text-Elements\" class=\"headerlink\" title=\"Text Elements\"></a>Text Elements</h2><p>Broker ^vpVFc8Jz</p>\n<p>Consumer ^HlcmoCYz</p>\n<p>Pull Message ^iEKLY3mc</p>\n<p>Processing ^4SqNDxs2</p>\n<p>success ^i4gc31t0</p>\n<p>True ^6S02Vu74</p>\n<p>False ^thrRj5N6</p>\n<p>%%</p>\n<h2 id=\"Drawing\"><a href=\"#Drawing\" class=\"headerlink\" title=\"Drawing\"></a>Drawing</h2><figure class=\"highlight plaintext\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br><span class=\"line\">31</span><br><span class=\"line\">32</span><br><span class=\"line\">33</span><br><span class=\"line\">34</span><br><span class=\"line\">35</span><br><span class=\"line\">36</span><br><span class=\"line\">37</span><br><span class=\"line\">38</span><br><span class=\"line\">39</span><br><span class=\"line\">40</span><br><span class=\"line\">41</span><br><span class=\"line\">42</span><br><span class=\"line\">43</span><br><span class=\"line\">44</span><br><span class=\"line\">45</span><br><span class=\"line\">46</span><br><span class=\"line\">47</span><br><span class=\"line\">48</span><br><span class=\"line\">49</span><br><span class=\"line\">50</span><br><span class=\"line\">51</span><br><span class=\"line\">52</span><br><span class=\"line\">53</span><br><span class=\"line\">54</span><br><span class=\"line\">55</span><br><span class=\"line\">56</span><br><span class=\"line\">57</span><br><span class=\"line\">58</span><br><span class=\"line\">59</span><br><span class=\"line\">60</span><br><span class=\"line\">61</span><br><span class=\"line\">62</span><br><span class=\"line\">63</span><br><span class=\"line\">64</span><br><span class=\"line\">65</span><br><span class=\"line\">66</span><br><span class=\"line\">67</span><br><span class=\"line\">68</span><br><span class=\"line\">69</span><br><span class=\"line\">70</span><br><span class=\"line\">71</span><br><span class=\"line\">72</span><br><span class=\"line\">73</span><br><span class=\"line\">74</span><br><span class=\"line\">75</span><br><span class=\"line\">76</span><br><span class=\"line\">77</span><br><span class=\"line\">78</span><br><span class=\"line\">79</span><br><span class=\"line\">80</span><br><span class=\"line\">81</span><br><span class=\"line\">82</span><br><span class=\"line\">83</span><br><span class=\"line\">84</span><br><span class=\"line\">85</span><br><span class=\"line\">86</span><br><span class=\"line\">87</span><br><span class=\"line\">88</span><br><span class=\"line\">89</span><br><span class=\"line\">90</span><br><span class=\"line\">91</span><br><span class=\"line\">92</span><br><span class=\"line\">93</span><br><span class=\"line\">94</span><br><span class=\"line\">95</span><br><span class=\"line\">96</span><br><span class=\"line\">97</span><br><span class=\"line\">98</span><br><span class=\"line\">99</span><br><span class=\"line\">100</span><br><span class=\"line\">101</span><br><span class=\"line\">102</span><br><span class=\"line\">103</span><br><span class=\"line\">104</span><br><span class=\"line\">105</span><br><span class=\"line\">106</span><br><span class=\"line\">107</span><br><span class=\"line\">108</span><br><span class=\"line\">109</span><br><span class=\"line\">110</span><br><span class=\"line\">111</span><br><span class=\"line\">112</span><br><span class=\"line\">113</span><br><span class=\"line\">114</span><br><span class=\"line\">115</span><br><span class=\"line\">116</span><br><span class=\"line\">117</span><br><span class=\"line\">118</span><br><span class=\"line\">119</span><br><span class=\"line\">120</span><br><span class=\"line\">121</span><br><span class=\"line\">122</span><br><span class=\"line\">123</span><br><span class=\"line\">124</span><br><span class=\"line\">125</span><br><span class=\"line\">126</span><br><span class=\"line\">127</span><br><span class=\"line\">128</span><br><span class=\"line\">129</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">N4KAkARALgngDgUwgLgAQQQDwMYEMA2AlgCYBOuA7hADTgQBuCpAzoQPYB2KqATLZMzYBXUtiRoIACyhQ4zZAHoFAc0JRJQgEYA6bGwC2CgF7N6hbEcK4OCtptbErHALRY8RMpWdx8Q1TdIEfARcZgRmBShcZQUebQA2bQAOGjoghH0EDihmbgBtcDBQMBLoeHF0QOwojmVg1JLIRhZ2LjQARgAGABYAVn5S5tZOADlOMW52pKSAZk6eTt6pgchC</span><br><span class=\"line\"></span><br><span class=\"line\">ZgARdKgEYm4AMwIwlYgSbggAIQBOegB9dcIARwA1ACUAUQBZAFVcbBYoZ7MLjHPaEfD4ADKsHqEj+bGYzGcklwUGwkgapWYUFIbAA1ggAOokdTcPiFATYvEIKEwGHoQQeDGQHF+SQccK5NCdY5sOC/NQwSadbnkiDWOoVEWNCCYbjOGbxADsyW67RmSXafUV8Xi7R4iuOgrQ8vaiR1ip4vRmMx4l0VSWOWJx+IAwmx8GxSGcAMTCv2dJkQTS/XHK</span><br><span class=\"line\"></span><br><span class=\"line\">FkcYhuj1eiTesTEbrEXCBijE9FoeIzbSXToKy62i2LU39UWSBCEZTSSbtS7aHhJeJJS4zXrde229WOhA7SZ9U25pbdY5h4RwACSxE5qAKjUgAEVcABBboE0gzCEEmaKmZPPaaCh7Hg3B4ABQg5IAuo7KfiIcjSHB2Qizsx73BA5phBG3sFMtkpzOjTFLOJy7BInQIA8HyEIqY57AAWnOHAnh8NyEE8STnE8YxMqUsCIGcuCkDiVDkmAAC+l7HEIc</span><br><span class=\"line\"></span><br><span class=\"line\">BJtsYGoO027xJ0LEzJcvS6vExxEBwuLcBwQjgjxbDYPiDEHPgRyioQEZYIRvSBns5CZBOAlCfgxzhsQT5ToJ4KFORAzAZA+EVNAWBQIGQytJM8SWscNmjOMFSKm2OpMTMQ4yRsWw9mgknSdKpwSPQcBPAAYtgSQAFJGEpYKQtC5nImiIhINezqEmmkyZVSNJ0hADKnFpwiVrpuWiry/KwEKUqlOKdL1ZAsrGuxnTaFMLbNoqJbSkaqDOFMHWqtMa</span><br><span class=\"line\"></span><br><span class=\"line\">rtL0lw6kk3nSk6VJRp6Pr+sKH4hiOQgRotMboNi1jMHygTZCmOUdF02hbpcbbdPElxXXaPBktKZYVlWaDdHEDYWr0vTTI9Sw9F2/moFaXQFq2w4suOk75GREALsuq7rpu267vuh7HmeVGivNt5vhVEivkR77HJ+m3ED+GRZDksOziZpQhegBLrOcADSuAABJPDFAAyIwcLJPMGM4mCSJ0ADiuGmeUhHEWwpGzpRjRXqKNF0cDnksSxlo2jdPGyfx</span><br><span class=\"line\"></span><br><span class=\"line\">aD6ZpooemJwOBQgIKcFAEKEEYFReXWzZJD0iqLK7nSzNb2QRbg+hggN7THNsmBWRI5xZV6pOhEEskVMsoqh1Ai5EMobToMEexWY5TBQOYBCpxWGfQLygZ6NkuDx6QalGxpPKkBWskEAAKpZZyR1S0cyXJrXoLg8RKSpCC16gxuleTBNj/XorkBQbdhx3UeBrgQhQGwLzhPbFTYkIVum/HHPlpW4eMXWvSGcZScyxIvEZaKTkZ9Mly5y0zkcBMHSd</span><br><span class=\"line\"></span><br><span class=\"line\">IqUxtgs3E+U2MEei+xDj72CgxCAAArXAUxxas2IPEAA8usKBUlzjtByJIH4DwErggKuZOECIkQojRIGXG2ViAkjQE9TEN5qTJRfO6Eqs8ypsg5NwZqEBqrYAFHVY4jVJTHD7vKFinUli9TbM/boH0ZiGjlHMLMbYugaiSD/SaNY8qundEtWMK0AwxzEhtLaOidoQDjDsRMyZjipioemVA3QkjZnzLMPU9pegWluscF6J9uBZibGo1sPAugyIkaaB</span><br><span class=\"line\"></span><br><span class=\"line\">AQ05E427AxLW3RhQyNoZADa0MAJwwRiuNcG4tw7j3AeI8p5zzKy0dSfGHCJDaQ/F+Cmv5qYARVtKNWKINbMVYvMfsM19Z8XUsJU2olxKgKkuAuhREoDnFko4WoPSTbSiyMQcZEZZLKGmTxUIUA3T6ADjIHYJ42CyVPuPHGURSApzlhQMsuAGKHNmRGRcZyLlXJntKOAez/y00aIBRozUSidDIg0j5ZEwCOOcfWGYbikgeJ4F4wF/jLiBI+iEvsP9</span><br><span class=\"line\"></span><br><span class=\"line\">4gRLVH87GwVe6EUVEPf2I9Hm9OlNpKe9MygERoeSJWFEr7SjMmcO+1kmDDAzvmYOD8mWtDGB/BOix3bKI+scNYQCEAgICmAwVkD1g8FIAADUwGwVmDwhBszCsoHmmB4IQkuAATWwHgpKtJCE4mIciVE6ISlEjsaSEpBCmGMgnuVcpqAuE8L4V/LhgjOHCIUWI9Uk1eisS6PmfUfVSgDWcLaOI3Qcw/R4C2FsrZtwlO2stFaa0jHaRTbGeMViTpWv</span><br><span class=\"line\"></span><br><span class=\"line\">ek4u6oLwWQuhc9Y+b1UCwvhcEnoSLwmRKBgxK6Ux2hdVmqUFJE40kgQyUjbJqM8kY0KRiuhWU7zEynhASppNqmUz/DTNAeR/mQCaaKxirTtYdI7ZAXihtp6EtKGbAZYqhnXlGQsyZyy66HsgHMy9SyVmmzWRsrZ9Fdn7KfXNY5pySIPK/aUOZdy/0hAJTM0oLz9k9oBbOMA3y4N/JWGAT5JRgVFtcfqCFniX4wuSHCyRtbQlMQbWi2cF5R2rCxRI</span><br><span class=\"line\"></span><br><span class=\"line\">XAKQQTD1Htc0oxKnWkrpRSxoVKjKFBMmS8yDLX7Mu4DmKJ0pH5cs/hu+JbbrSJ2Cr5YBFtxUyUgRzFuUA5wQpuASF48RWY8BeGwOcMx6D6BPJ0XYIJEq2thMaxEpqyEWtOrwG1jDCbMIs6w1kU8XV8l4bVd1AjahNW9W1MR3R1Q5mbJcINOYAH9TlPWdo2gAbzFBT9fsoaKRZSzegX0abDGhkzaYn0Oakx5uoQ4wtLiwWYdLTh8tr1T7VoI4isJK</span><br><span class=\"line\"></span><br><span class=\"line\">LG3ROBg2YJipepXUhqObt7zSh9qySjXJ6MClY2KUc8dZTnwVOqVU8m866n5BXRANdLSFRtOCSxTpB9uk3vA7u/pimz1HIvRMx9x3jj3uu1M27z6sSvrUO+15BynkjJOcB+W/6ns3OIL985oGAOQEg28pdZEUNwaQwhsjSGYdoeqyW7DcPmtBNa8R9rpHlYUZOFR/ulxcWqTAxPCMJK4Zsd4JSy+3Hr7kszvHRlb8WXfwE5yly3ALSON6LaHUgr5M</span><br><span class=\"line\"></span><br><span class=\"line\">ivO0FBmkCzD7naOcIQzAPhQDeBzKBzgYAcBgLdIQHnpSgnwa59ARC7OkPNbNqklqKtJKKvQ6z9J3OBhZI6hbzqeS+bdYxYUgWJRetFCInb2hwtNk6FFmLrF5HGn1B1Pn90ZNuXtGy792Xit6Py6KYMGbqk5fMaV6xopbEVeR8W2raPSwVqa3hmtWPkWopE5iGJpIwa5mEzuiAXaYZQ97UuTJyMclo3yZjIpJQNsUInQ+KdM7k9ztqZD6cG2tsMU1</span><br><span class=\"line\"></span><br><span class=\"line\">rt7dXT92MdO+bCSSnv1XcWY9g9J2MARgfdv5fEB8AvoMG+nZH2wcW9GcD/7O+7u3PuaDgHEGPvQZKDD+DvyEfQ8BXnjD7ihesGGOCKdabWle6KM2mKxA8k1Gi4JO+KV+zGDurGN8NOHGdOJQPG1OFki8HOnAkwAaDo7KrO4mCckarEW4SQ5uQqfka+F2ECZwHM+A2A+gbALo2q8UlmOuhqdqLCceJuTmseY6+UuuRUNuDq7CDuwhkArq/mruHqQW</span><br><span class=\"line\"></span><br><span class=\"line\">QiXucoqocQ7EM0W4mWEAQc8QvQyQ9e1BoMOo0WyaCeuW+i6ahWae5hEA5yag980oOe9imotYCwaiTEehpoeh5uPilaH0nU0w3UvUVovWj0TavYaijinQYMA2NEQ2re0o6wDwc4uImASCHwkgSQewLcPA4sewnQLoY4RgbwIwVk+Og+82U4RUb4y234E+i6U+1EtEzSs+m67S+2jee6V+x6IuwykAewNsdsDsfiWYvUrEairs4WMRvWcWpQgxvs/s</span><br><span class=\"line\"></span><br><span class=\"line\">gclUtK7cEgboHAzAQgmQ3c0owYYQDKHQxBqxYcRc6c9KCA2cLO+c7gZxJc68JMooFcUQ1cDGX2shjc/grcax6AGxWxOxgYEysB/cksdGeKbxt6061SU8R+c8C8p8EAfx2xTAK8a8G8W8IxaAu8/Rx+h8xekw58mBRQDO5kQQRAcgjhgwHKBBNC6o5uYmXOaA6ofKFo7sguwq66lsEqZwPAbwnQygEI8ElwmR5wzAEIcApAMAuI2qUC2qY4EI+qVu</span><br><span class=\"line\"></span><br><span class=\"line\">EA+uJCZq5C9Cpu9i5ug+YhxUmuTGbC3mTuNUQcbuoonqXIIWg0YKbh9o4WHkv0nE9WYa3AP0nU0eehswxaP0jeFC6eeW/oVhxikYthFiCYZWNiTm1oF0HYM0Ae0w8QH0cxkAfhp8tonUmYwSKiehlB1oERaArsloRZDYcRqSw2kA2APMNwLwkgMqzAFAIwuoPABIIQ3QMqBIYwc4uEEATw8QuRrMygxAIwUuiCzAi4rBbAmAjcBI3ZyRqR6RmR2R</span><br><span class=\"line\"></span><br><span class=\"line\">uR+RhRxRpR5RUBIheMk6TqNRxMdRNSVMk+y6zR6sbRO2W6nRi+PRZ29BoulGMBfcYoHMCBEJu+yBekGkRJ2BaBGA4IhAFJLOgmNCSZ+BHAZBpItoiSwSjetBCmd5OJjMEAiouACAQgLoUAJ4LorMLwzAWmUALwi4MUPATwkgY4ipYhKp9mRuAh+Imp1qxut4upEhnm9uU4PmJp/C5pShnu0o3u+Y4icaP8ioU00apoIeIMiQE0Hh+ot0rYiw2hfp</span><br><span class=\"line\"></span><br><span class=\"line\">oZlhBWwZ/pme5W9i0ZNoLs8ScKDYoFRejWpItYpoNobaXsOZmYeZnWDEXkzYMiSoxxnaUMCR04cMlZ1ZtZ9ZjZeoLZuAbZHZhm3ZvZ/Zg5w55wo545bBU5hAM5SGEAc5aRGRWROReRBRRRJRZRfeYAA+luVRL4tRs6K2DR9Sp5rRkw7Re2XsXRBsN5q+gy95BOj5hE5FYJpOSB0JTqxs35JJ9KzOYFpILEzpTQ1J4FjJIMHE7soMzlqwQunJ6+Yu</span><br><span class=\"line\"></span><br><span class=\"line\">ZwLchAXwrgLwuIMqcAQgHMc4Oo8EkgMUm8ewVA3BBqhUVFhu6pWU9FNCLmvBbm9qrFUh7FxpfmppihHulpKhbUbkyWmonEw1EWjiBoooQcbpWs3Wj0MeDYs1Fu8e0YqagZqlRWiN2aliEZ2eTm7syW0arEmYGW2o3i+JGYn0wS0WbkcKCwMR2pNeBZCacwbYXCze7+FZVZNZdZDZTZ/lgVnZIVfZPAA5Q5I58QY5E5sV8VcMSVC5qVy5GVa52VFR</span><br><span class=\"line\"></span><br><span class=\"line\">+VO5DuUJ5MB5q2x50+LR66c+l5NV15L+K+J6qAXJl2JyB+169+oo92W+VtR+J+L2Z+b2F+n6Rt1+P2T+lyV+QGXtZOooEOjRKGn+cO3+m5H+gKyoOYrhQS24cKMicOzgqoCQ9YcKmo0eQaF8P+s4MO0ZDYCaXUTE38t0yZJQzg9kyQ5NTE0a1BwoeoiGv+sGk0ldnEXscaLEpoJZgKSdUl7susOYrinEMwDdOdkd4eeNOoYKLEHipdYASdMZUKH0</span><br><span class=\"line\"></span><br><span class=\"line\">CwPAjiDYzYI9MGs4X+kB/egqhOYoMUr5/tRKXVKBVOaBPAtOJQXGWBfVEgZJAFYQQFtktJcaYFEFHQlo4WMaAugCdBjViFkC4s4F6wXwY42q+RMAnQNwUCIwvQBIi4Lo9ATwOKZ1Spl1apjm+azmjFDCD11uT1J9XmTqHF71XF0oFpjuP11pnEyQUwURXkMirE/WYN3AYiaoQSaiehcKllZhaNFhSeex60qNuiuWGlkZ2DConUWZ5NVo1BmoehxN</span><br><span class=\"line\"></span><br><span class=\"line\">xlTJSW09ad7sHEUWvpdNjEOomY4WN05uLN5Zyp7N3lXNflrZ7ZfNCVoVgt4VItYtMV05s5KRyVi5aVK5mV65OVeVc2Kt1RRMD4GtpV5Z9MqwkCzMbMnM3MfMAsHAQs+gIsYsoJgKvGssJEOVFE+OM+lVF58wVoK92h3R7tvRCFe9LV1GrMR9nVk83VX519NKeEv5/GJBwFG64RbTnO3KvYejV0vUcNcFwu5TymZwIwNwbwLomwPM8QUA+ApAHMXw</span><br><span class=\"line\"></span><br><span class=\"line\">MUCAyg2A2AFAJ4uQaDlFtmqpDmuDt1ODtFeDhUeptuhpJDb1LuXQn1wW1D8oloMZEx0aLseoyZOhQmTi9o0WM9EKqorYI18NC0ylgjpQKe1h5M6lGNWeThTmtDSZ9kUKU05odoSjviGYWYmo8SvWvWU0PQZa1eGsGoP89YUFpZblKGPZAtQtEVUV4tLjCV0tKVS56Vq5WVG5u9uDQ+j4u5o+ex4+R5Qd2tZ5eTWsHRBth2S+7xx+t5AD56FtD29t</span><br><span class=\"line\"></span><br><span class=\"line\">0rttV6PRp+myLtxAH6x07tWIN+ftPtj+IG3t7tgdrNIdgKYdnLo9sGXzNot0/YMeAzidtY8SMiW4bauobaqoG9EdsGpo0jUwrKd0bsyLidmonU+NP0SoqoSoTElwvryGgK9YyQEKiwjYgNslnE4b3Q2gvWcZba1BN038GoibudyouovWjiN0MifQNo4bcQ2oU9N0HiHiU0V0Zbf+WYk9fQrs7UQRgM3diQPQHiAeHiNbYKNYnbsGbYCQUWYKXs0w</span><br><span class=\"line\"></span><br><span class=\"line\">AaVejQcQjYt0tdUedbWd4dSbTdSWPObraoDYeo9bgKaovu9lXQxYaiNosw07s4bpXsYKU9nsrsv9sGK9gRoK1BcKkKuYw92dm9jQ8LUKiLJdKLoNwBcQPzEesWEWjYD7IH+hz740jYwo77s9ydiZ1BwSg4CwzESHqGtYGjpo2oao24aoK9cOfQCQ9ot0fQmY7bj0RHQK6hNYU07s/0woHENHFb87KiS7uYl9QHfrs4YKyWhY6oz8hZ9YWHTiConE</span><br><span class=\"line\"></span><br><span class=\"line\">2ok0P839Inu7MOX7fzv06oExeh9kK7qGyoqWUwP0rs0bt0rHX7UwP7toWGNYmWJQW4CQTEbkM0iZoSbYVnSW0ajp9keh7ErJSSTnSW/70nAS7S97one7s4AbIlCoW47s24sbfOcOj0GZ2oMxzEkW3QrH50xdNn9kTD0aDkgKrrdaHrpobaeofOrH29ZG+OQJT5uAPMNT7tH53AqBjO6n2TjT9OtKLTA1XTNJvAMx79E1ANSw9Yji7zQzC1DBS1Eg</span><br><span class=\"line\"></span><br><span class=\"line\">CE+gIwUCY4+A2q3QLw2AygLwLocAUC+gMq2ALoIwFF+Dypuz1F11gh2D2pluzFhDBpxDDupD1zZpFDPF31fFCibpP0+YVoCobY1ogLA0cKebDr3hOYwogNfDoj5iKlyewjNh/DGe0Lmlrpubqox7lbTEaiuYaLlaehyQC7k0Go+oIl0a+ZqA01FoX0cNxjiRpQdjNLjj0Vk5DLUtbjMtLLXjCtHLuVNqBVi26txV9RgrZVqsOt22Yr1VB20oJT1t</span><br><span class=\"line\"></span><br><span class=\"line\">Cvsrp6TVerCrdthr8yirarTtGr2yWrl+urP6t+z+SvgGRrf2ZvR+Zr5ZFrsGVrgvjds45deb1dP0bdzY5oP0idyoEW1NGicauYbarHQ0ubXQOo0bbkZH9eDb2gAemoNYrhcn8ZofUKyQG7CwW7TlO6ZdeoEPzbehvUIl5oofLYCQBTbaUWnE7r4bHU0eLiVHG7v0SQof2Hjij0E0moBHQPidubuYbsjNdo9kuYbf+hTlDHQ97bfQNHebJnEKv0Cl</span><br><span class=\"line\"></span><br><span class=\"line\">9kbfJHCfSouoOSWLjnYAE0vuAaCjt038rYCaofVo8fTlHEE0Swd0FoaXUlPDbncadbbaPXTvNrLvrYvu0mJ7wl+PhnYATsZsMXUTI1YkurYU/lmFYjfMlg6WG/sFyBTdt9Gi/ftjNHaBt9+O7EBdtMDTYz8/8GA5sIJzTb6g2+HUYfu5Bh7RYFQvUOHEsHj585PSmYYPmojL4dRHofze0NuDw7B5AUZ/KAU2BgHX8poO7a1sBzz5OJXY0wNyHGke</span><br><span class=\"line\"></span><br><span class=\"line\">iPQP2j7SARfwEEcdqCofJiL7gC5ekJomYUGFB1nDxJsw2ocgYsEoE/xVBUlYJE2HJo5hHE6OXNkAO1AgC3EbSYQW/1EFz0I2EfPQkp1jZ90RqJQLTq2B07vsGwrbUPk4jaRXRhqHEFemN3PY+cawSoIHgHnzDWhAOGnS1qHR3quCHywJMUB8Da7m9mQp9KcF1wqA9dOMTTCJmcE6DnBFcDwTAC3HFhCB1gMqIwEYFxC4BOgMUDmBFCCCBgcCrTH7</span><br><span class=\"line\"></span><br><span class=\"line\">qFn75SDescwJsMinebhoI+2YZvnJxjSKIJGueJxCvU0Z2h86cwAPI3lTK9g4grYJsBm2mp9A2w7uOkJi3VBahi+vOQIfdwRrw9fQaiPYL0E0BBkRGZib0PEmwC8pzuhUVKBoECA3c6KQhe6qcxYpEM2KKxUoHIQ+rksW87lECH0A+AxQXQpAIQC3A5g8xcAIwVeL0BuCKp4ILwGYL4yF4BMzgfLQlrPm1hgp7Q1BQamgCtDzBxuPTekeZWix2hYK</span><br><span class=\"line\"></span><br><span class=\"line\">81PomL0PILo3KNvN/HbwyGWs6u4iaLPMCkxjDpg+LOHF0GVDbgxhMeDiDERbAijhQbkRjkGx6BVdMwugxoHqA6jChzK3fHSn0ATbRdNOvuGaFNAsrChOi2bc9o8zmAFgvYnHdiL9Dy5JYX+7iTUGCimL5gZR6ZGkaCmuhzAawr/FdDF1Xbj8poloJiB4lmAAd4B40QItGg+iuwxhSnVjuxBTrrCHod0W6HCgDGFoAW6iK6HpUVCsdZ2wnGPHWiEH</span><br><span class=\"line\"></span><br><span class=\"line\">sQAx3bR6AOG1B2g3OlY8IdqDUT6hL+1XBUDKJrDSMCaJXCRAsBcERikcKwuNEsCLquc5OufHfgHnPjp0JoGjaCu2MjaoCLQFlEStwNgy1hcwEKK6BCg37Vs0B5ovASqH4F09BwN0GQmXRGj84Qi00VUPKIrHniZ2ubcYu5xkEWg06idfQluJ9I1gFKWorMZOMbB/NLBP/ROl8w2HzA6eXvaNFZyzDdQdQdaRMnZytDhsksSQy0NqHrDxlR+742Lj</span><br><span class=\"line\"></span><br><span class=\"line\">53YjRZ9OyQ7rC60roMdlRIlG/pmCs7n9pxTYG6Dkjujexu6ubDfqkJXpeFdQtXYiY0GcAGioUi7Gqj9AtBeQJo8AkSef2B6jstCUAkdnV0yENdw6x+dVufkN5u1ChHtMZDr3doqsbsek9Xr+it4ms9JvtY1sfQZj71cACpdqogXa7FDOu59brpSm5Ga0hW5VXWlVQXySt6qJtS2L1UYISAIQDwDUPQHwC9AhAzgJIC6CaFfAIoMqVmFAAJB2B+hg</span><br><span class=\"line\"></span><br><span class=\"line\">3dkIGG9wV0NEGgzDH+0bzhptQdYe1o2CzID0sJWNbBjdDzZx182IlfUE/0J6nw20bvb+JaBjTiiawK7MUF9yrSdQLhHiK4Qvz6C3DgWqPB4YqCeEvCUaKPeHntE2KHRqYPw8yGcywYVYZCQLJihd02nPUp4O06EeQxcqDY4RlLREciNRHojMR2IoQLiPxGEjiRXLYXpUCWzU9pqNzekmNRMoCphu41ZkYxBK4+i9CHIjklyLHwlVBWfI6VrbyZ6R</span><br><span class=\"line\"></span><br><span class=\"line\">ifkak9If63KmPQHKIlWGu2Fn7TQE+6bJ0rqFy5CSSgiQVsHozbZTVbonTW1slhmgz0foEWIHvEDy7dsbO01WQYmm37nQOIOonDkeKhRpCRBYnVdtxKmi4cA0MaX6G5H7HulLQ38KLFClBTMziZAAitrGJq6sRF6JwsrgkCK5NhIhNdOmZWP0JxjLoQggNPqE1Cz9TQOYQApNCbKcRKxiQMYa2LUT5gpJ84uSXIx6xCDyOCaVvupKFmaS9e2k7Vp9</span><br><span class=\"line\"></span><br><span class=\"line\">khJmTLaWvKOcb31Y2StepvSyUfia6EQW4BQ2Eq5LQClDSQnkqGeLwXSS9Gk0vc8rLwCkK86qpTFXqbTAShTFu6ACKPpmMw8xNArMUWPECgRfANMBIKBBCHWAwBzgWUxnLiRylWlREkAmPDIhJYyY5BkAcNDaDrDTUIUbaQGjpW0LOFuA9UxMgUxkRuycyvhEmqgFrDMlfRcwffvZGlncUvqQ049pcPHbjTUuuDf0l7FmnPDXhi0sxMtIOhEQ1p2z</span><br><span class=\"line\"></span><br><span class=\"line\">faWCK3KUJtpIIjaf/KKEvcpwx053PIRuawjWaEAK6SiLREYisROIvEQ8AJFEila/jYfLyw+m2VSQ38G0M/Psh0iq038RvAySBlqg5gXEJyuyX/qq8cSZMfOdTFhmQl4Z8ItwfVxRmxc6w9YXrHWihSw0F+6OPNqqBbQcRVE8lesKx1Jndjo03UK0LGj8FgBEgY0diI2Eo584FFLMyTs2AVBSi2w/qXUSUFgkCy8eiZd2XCis7cTFZ/YfpvbJUXFi</span><br><span class=\"line\"></span><br><span class=\"line\">W+slcLCJRCJZjlQEiQIYsCoLyM4cco44Xzn4Wksp2Ks2jvi1kFWjcw6o2eihPEXWglFEKWtGeJ4WNBN58SL+iDSEGMju6I0MFOFh9KUEvCdoLIRtkdrrJnaBvMOVfkjmGSrJ++epUfjMmJzbJd6S3iDiTnSsU51GL4OnOlYdcs57ksobnP5bQyC562XyTL3nxXlAplchqowtrnSwh5D9QCqQpYjxImREmd2CXSiI0FORIzMKegDXhIJ9AioJBMGE</span><br><span class=\"line\"></span><br><span class=\"line\">XDtB4IXwD4PYB5hfAng2ATYutL4L6ksst3IBVy0e78FnuEIjoFc2gUfcGog084XTN6x3yfSD8oYdaUzAxleoxGMGPWAkpY9WSO2FsBNGiFw0lK005+XNLfmQtQyewYlRj3ejKhbQXQKgVvwmltTa88fIpmMK3BeDmp1PPUIvVNByzYFJjBBTdOQX3THp6C56VgvyhvS9ywTCprkNwBPB+lkJQZXpOYU8i1sS6YVhVQ6D+TZl5co7HpLKYAMlloEM</span><br><span class=\"line\"></span><br><span class=\"line\">4JIFxBzg5wPMIwDzCSAUAvg8EFuDAAQDnBxYPMEIEgh4CDzzIVQGoB7lHlXRksw/TiKV3iz0iSO8YmrksK1IXsBwWg/1aUB2FfwxiwfKNZAEoZcIcV9w9oAgDTVpqCVJiVHp/NWnHRf5oIp7h8qBF3dgFby85uAt4pQioFMI0UIzyaKihlI4JNpc1UlWS0iGFOFjMMr8SjKKRlVK0PEiUmkKd5WyhONwwsqFi/68FOVnnMVXHkyI4TfVRHCgAjAX</span><br><span class=\"line\"></span><br><span class=\"line\">Q9y9YDMBuD4B2gmAegBzHaA8xOg2qL4IPDhzpNqMZyLJjfSAhpMkKXwZgPtjHCsxCAmRJBNgAtBfBcQkgB4IQBii4Iz1OBIiJkzIhUpshm2YuaKzaQg8bOhtbVVXJCl9db6RyiAFE3ZhcxeY/MQWMLFFgSxXVGTeWLlIUTqh4+NWbQgND5x1g5KpG0NQSTFGRrtCMaxiBCn+p+rtCSauHu8IzXprKSkAcFmpVsK5rv5+axtVZh+XvLdpgCrUmWse</span><br><span class=\"line\"></span><br><span class=\"line\">q/KwF/yqhtKBOkBY61rlC6RtibUdV3aPS/uPBArWdqz6IEanOUNZUtsYiPQHMKQuAmjrXSh/fhV0HoXTrGFXk0JgjMXU4Fk4UsJdegEIBvBWYPMbVDMH0B6oQNOTCDWqvyagpLQxTCuXBoWXVyFu4OAUQjPt5b1VB2Ya9qxvDbMaYB9kMcfjgqWvZqlRvThXn3S0xFMtZEIaNlvo1K1N8qrIZSBHSC8igGIDMBhAz2BQMYGcDBBkgxQbdlBi2AGX</span><br><span class=\"line\"></span><br><span class=\"line\">JwjoFbgZuzDDUG0i4YJVlAuAd8GgGVCBJO6YeP1DTUc4QBQQmAV2jqx3y9r2l2vTXg1tmQNFR4DAcKFFFihcE4YA2obVyHj5XQupAHH+Iwwmi58m8s2jeRdEWBsS+c0fbcJNASobatt4c/ALtv0mtKE5BrC9Zkzuz4BPwFAPonqqQo+a/NAWoLXhokAebR58SUgYY0W0U98wJUuUBRv0qJYE1dhIQnGnS13QpgEKsztrIazoteAbGwacmvoT+kuN</span><br><span class=\"line\"></span><br><span class=\"line\">mahaYSpzXkAVpQmnOCJp4KFrZNEmw5pNL2nC7xNduF6lWtkI1rTpySVTYXPmL0YW12msUPBGlXk4dI9TCOToxq7+zYslm3UQwDGof0HEy8hznrCnXDMZ1YylhZPiPy5NwtsvNyPMH6mK8Ha8GxaqZB+IQATwGkVAB8A5DRAeN06SgPCTOAB7wQQekPcoDD0LFbY28AhT7CgB+wA4+AcjSHEsh3EzgYgbICiVfg3FC4acEuAHGIDEB6gxwZ4lXHZA</span><br><span class=\"line\"></span><br><span class=\"line\">1xImLMNDbE0w0JNsNKTQMJ6CbgcBvii8CQNHvwCx6EQoe1EuvE3isBMSqAbEl0gQBHxlGZ8S0IjsgTnAV1a65gDzA3Vbqd1e6g9UepPXo7+4l60eYvU+2HitCElcHjEWIyBIaNHQCuivQsHUCjKjOjqF9Bp3M6r5rOu4Zxu42c6keqebnUtN51fyjoAurXKJr/lFrRdTmcXScxAWQHpdRpKqPLuU3Sh61J5Rtarqvzq7cA80zzPppKHdr2MiGvtW</span><br><span class=\"line\"></span><br><span class=\"line\">dBtKU04aj8UkC2Gs3zapEM0CwQ5tt1ObZ13k5XaujC0boItV0esNFq1Ve64tZtZ5ElpK2IzYcwolWRyrrAIpr9lrDPj/ECRlLVkIczVjUoRmSH79b+pDC/rjYKGNJdSg7Q0v231bUApKJrawsgSGrjVpq81ZautW2r7Vjq3AM6v62iQbtzqcqWyuPF84F+g4ExW9rm0091BMhkCIDp0nbaeqHGeVuZM6UtrrJFkyBEBoI0w64dCO4gzxiQrdAIpI</span><br><span class=\"line\"></span><br><span class=\"line\">wdYJgGYAuqQ4v5THfczP73QH9ZGoTMZzbTyHH9sLbBgDQuh9Z1QAXK6JNH3lz7qDl8u5sc3Z0/6w9fGt4WcEE0gHXlMm8TRQjF3SaCGIuhA5cyQOcUUDZ0+ImpqclvkJVzXKXZnNMk6NZBsWGCpZveaUKJMNYHFpQIhg275uTVBVawavzO7ODYrcYeQtg38HgpPu3AgiRPA4gxACIR9FpAj1+6PjokDkD8cbVDFk9NCOGonvT3LF6R2e04qXouJX</span><br><span class=\"line\"></span><br><span class=\"line\">Ei9BcfALnox1lxq9NsWvUwFWNVRPizcfAJHr72fGgTUyARGiTH1gnJ9qInEnfFn2M6ksC+tI6MwkBwA9gi4ZQDFEwDtA4Ai4S4BQHwAcxcAEUGKOcCgRPBxYyyAo0PMcD+xOA4mkRNV19x4seo5R0PGVKoK7G150BqYBX0jUvM7od0bYQfO3DlS3F7+rowAp6Ncas1IZHnftDzWgH5i4ByXYCMk0MVjmSpA6eCJl3fdq18xhQlyuVUrG1d9ksPXK</span><br><span class=\"line\"></span><br><span class=\"line\">uzlEHqU+Co4laEzDHiDjv0tAORJoMOIyZhg/ZRDMOVgsBWEy1zbesgT3rH1z619e+p4Cfrv1v6/9Wk0A2XqQNSGNzYUfbhnqkd3QVZmCigABg6zC6/M9UMgjQRYICEJCChDQgYQsIOEADb+USMKxIj3Z2DF5ouBlERg2qAkFAA+BjgZU4sD4NyZ4AmYRgLcBUJ5prPAbFYoWkVi7raTKJpoTx6VjqsWVMnkNhAVs9gHbMGI76u0Js/c2zEahAa7n</span><br><span class=\"line\"></span><br><span class=\"line\">LcONsJ2h4KN38eNVqewZ/UosQApUNH3YhGm59ZO9jY/NDIc6+jyPAAx/KAMOmRjUxsYxqWgOTHxC8Bi5q90BW1rUDSuyZRgebVYHQzWuvAzrodzNL9dV/NibqC4SUH6RRNAGebs4FBEbQGZhhfFsuM5mlVek243rQPHIsPdMW545DJOIIktiazDhL8fnh+6FLXxrZiCeyDDEyhXCSE0sUz2ulYTKceE7CGpiF6SCxelEyZfQDl7K9Yemva8UgSsn</span><br><span class=\"line\"></span><br><span class=\"line\">2TnJ7k7yf5OCnhTop8U5KdxNd6e98loQIpefBknR9GJHeNSen10nK0DJndtevSMFmH1XsJ9S+skBvqP1X6n9X+v31ihD91DaMaDDJ3kanEXQMmcEdKDryaEFfKSXSQkSUDOJDOytJaHEFmcl5xfZ+acOULdGkLvRm0+niGM/zBd51OAyLvGN4XvlEB6Y0RdepzGyGCxxXedLYPrbMDWm+yXsD030WCDhmi+qDrCDAxWj+YuRusrVApnqao23zuDI</span><br><span class=\"line\"></span><br><span class=\"line\">EuCHsz4ykS+gaLlnm7jF5yYYC0903nvdCWiABwuDpCiHeafaq3Glqvxtj2//CNL9GSCtXvF7sZgYHLA0Faql72XSShm+QRpoyolTQr1Fq0a9jDph47RYaNUmqzVFqq1TartUOqnV+Rq7a4anBySPYbi9iC/34Felpt72joAkD5xeQz9V2wgJtrCPA7Qdxk7fLjZhlOW2THJrkzyb5MCmhTIpsUxKZcODaabBoyeeFiYirCpg2gvwf4b8TZhq2VK9</span><br><span class=\"line\"></span><br><span class=\"line\">UMNECEA6ebQO6ZLtZN6Q7DD4OqHUkZtqw75YqRqM0hrrkQAIIUEGCHBEQjIRUI6ETCNhDYA5WpzhG40N6zoYM2ZGZmpYBJQjTJ1MB+NczhPXeaVWmNa7ApYaLdn8DaVVVkwuFhtJ9AA81oOGghe6vTTkLfVgTRhf51YWCLo13C6WomsunJCiBxTcgYDMqbFrFFrXCtb0nYGaKz3fA25O2seSZzc0fXRqCLSP9LNyKrixN2h44s02jBi40wuEvzq6</span><br><span class=\"line\"></span><br><span class=\"line\">Y1Zxs3gR7MSB4gEIeYE8CEBuQr1p51VU9Y2UvXrzkJW84JZxLfXneXyZGULNENVbU7modO5jN47d012DHGTC0YLvqhFDz2Spfr0RvbaUMQ0ESjGWkM1HhJa7WtCqaxsGSDDwt5rWcGcvi23LUtzy7LZ8sK23DtNhJPMCbLHHGBbsO8draZJzsf40dH+J4dVDG3ebqhnbSPYt5GGTJyD8wx3GuB3BHgrwT4D8D+BYhAQwIKm4reG3/xZKHnVo6aFe</span><br><span class=\"line\"></span><br><span class=\"line\">0zaAjiQErloT/bDUN+9D028dnNtxz4jEO+OTbdOp22UjCFRfWcB3t72D73QHK0UZhURoU2a9SaGJXjIeJo7UWvhfmy8jwS62/U5O7RzbCHWFg+YrYVnaZ2dXZdEmq09xvLt2m+dwxgtSNZws3VxrHpsTRWvk1vcgVzNci0Gcouaae79kwgBtZhLSs9rDEUcQGhiKOVSFJuw4wnE7F1oIUgzA5XbpusO7GiTujg+JfiQQS4ab1y+x9aaoeaJALcak</span><br><span class=\"line\"></span><br><span class=\"line\">7bj+O970AgzveEpFBMT6FgqeqEwZZhNJwc91l5UmZd2JUkTkyJ1EzZZIB2Xy4mJxy72fdsDmvbw5322OYDsNx/LBJv3eM7D2rwwr4+iK3vCisHzYrRjiQO0CEAjACQkgG4L0A4BIIXkEUKCOLGIAUANU+gN4DldWVP0rS3Uy0WaYkplSObiL2qRVgEqRoxZ0DlMgfOmB5ssX5prq5aZ6vWmud2a1Nb1ZiflqtpUmhu7E+Sc+mFNfpua23bIsd3Mn</span><br><span class=\"line\"></span><br><span class=\"line\">Xdqi6tcqb9woE+TrtUPZGXMOBAOjSqX48kWkL0ZKZxPjGIFlcI5uslpp3OqDqzmQISFc4IueXOrn1zm57c7uf3Onr17Q8oOyFo0liX2iHfZkhfd3xX2ENTt4ksho1crqtXa5jc1ubgA7mVuBrwO3lZhUqJ4+nkTvtJ37A7Tw0MQ2WU/ybaMdUWaLrUsKGzCsQZ6+jDiPaMatNZ8uRBJmgW3ebF3iXpdyl3/ohbkvv9pLoa56dAVQH67iTyaxscrW</span><br><span class=\"line\"></span><br><span class=\"line\">+m5d/pmBe3aWNLWNNzknJzy7FD8RtdBTvXRrELaYCzjomRM6gF/Ypn3F8EhULNwafMH7dyr1mg2aHmWO1XkCdQKQBeBQJegjZI+2a7acWvqCVruZbFpeOfXb77/e++IbSUlBjj2YfDvR0Lbzj6+rEmQUgNujuxUlj9zTvG9ixJv7K0bdHBm5qrQ2pMysvHBpPhvAO1HIh9GefwTUADFg2YDG8ILyp1a2HcMMw9kBO1oPXLktjyzLe8vy2Ad1NuUK</span><br><span class=\"line\"></span><br><span class=\"line\">JPMpL1/o5nQ6yzYCNkPQjjDiI8Qb20xyTD6HvG2cE+ffPfn/zwF2wGBcfBQX4L+CJC9wfsV4+49qFL9Bp0ui+61HthmIrdaU9i60WcLKo75tm3hXYOy20fjiMxH8Nejo7QY91X3mXba7jd1u8NcDcl3H5mFQRIhtqJ335EhjlMISy0C/o5PUCxVgDR1gOO9s7wqxZN2Mb4LLOjjT6DLtkvbTFL0t2AaF30uaX7pgBeW8It1umXDbll027ZctvO7K</span><br><span class=\"line\"></span><br><span class=\"line\">urlx28lX4B+XDFwp/rp45ZlZgFCkdxQbN0TdMlKiQh4vcVe8aV7LT6Vua/yZag/V1rkSAIdeP9P65YCYZypdGcQA/YQySZ1pcpMzPNLae/S1nsWdwni4ee1Z9cU2fLPbLVep4vs7r0nanXS5lc6691cev9XB5y518WudDeRvsL80uSfCvcAp9h2Gfa88JLX1wADSMUHADgBQhmkg90yGWEyD9VfEAwBgIQAQAUBzgqF4tz6GJVQ/1rgPwbcRFYXb</span><br><span class=\"line\"></span><br><span class=\"line\">B9AUIL/aF4LelA4fIBscIj7B//6IfsYML4UGVIiBMfiPiKM6di+E+MfCPjIMj8+W0v0fxP6n0j4e41uMQRP+H5h8R8GZkv9UdnyT4yCAvG3wKvn0z4ig2w5ns3hnxz6gBY+MgYv8b9M959U/OfGQeEls+PyXFHTIvlX8z80e6eX82vmX4j7eAdK78uV6HZT8Z86/gcNqoeUE0eKYg4Q4IGVGwxsqO+cQ4IbVBvKkYVbSgRgNgAYG+9NACAEzjoES</span><br><span class=\"line\"></span><br><span class=\"line\">UN+y/9A3PgeyLwjBs+wwJAbSynsJ8J/iAUIBAAEdDRN5G4xAD4GwBgIm+cDwQLM9n5IA5YeM5wd0JAlIDKBgwAACh6zUBeATEJv43/cO9AAAlIGE3jKAhIREMkbX9wAN+5grfkf7wDH/h4u/4f5X7bHoSAv84nAT8oemWt4pN4ckRuELZtrd7NAxf275FaeLkk9/zz0UN3r+9Yl9/imteIcSpN7xw/dgKBAgGqBilu9cAPPwX+3+7/Z3ia6oIQEY</span><br><span class=\"line\"></span><br><span class=\"line\">AtwA/+XodrLKG0ukA/+BBNXoy468PoC2+FQDJZZmu6Gsjjk+cH/4AB6nr1w3062mCDhAnXJRDkQQAA==</span><br></pre></td></tr></table></figure>\n<p>%%</p>\n"},{"_content":"## GCæ˜¯ä»€ä¹ˆï¼Ÿ\nGCï¼ˆGarbage Collectionï¼‰å³åƒåœ¾å›æ”¶ï¼Œå®è´¨ä¸Šå°±æ˜¯å›æ”¶åƒåœ¾å†…å­˜ã€‚ç”±äºæ ˆä¸Šçš„å†…å­˜æ˜¯æœ‰ç¼–è¯‘å™¨åˆ†é…å’Œé‡Šæ”¾çš„ï¼Œæ‰€ä»¥GCéƒ½æ˜¯å¯¹å †ä¸Šä¸å†ä½¿ç”¨çš„å†…å­˜è¿›è¡Œå›æ”¶ï¼Œè®©è¿™äº›å†…å­˜èƒ½å¤Ÿå†æ¬¡è¢«åˆ©ç”¨\n\n## ä¸ºä»€ä¹ˆéœ€è¦GCï¼Ÿ\nåœ¨çœŸå®ä¸šåŠ¡åœºæ™¯ä¸­ï¼Œå¯¹è±¡ä¸ªæ•°éå¸¸å¤šï¼Œå¼•ç”¨å…³ç³»é”™ç»¼å¤æ‚ï¼Œå¦‚æœå…¨é ç¨‹åºå‘˜æ‰‹åŠ¨é‡Šæ”¾å†…å­˜å¾ˆéš¾é¿å…æŒ‡é’ˆæ‚¬æŒ‚é”™è¯¯ã€‚æ‰€ä»¥ä¸€é—¨æ‹¥æœ‰è‡ªåŠ¨è¯†åˆ«å¹¶å›æ”¶åƒåœ¾å†…å­˜çš„è¯­è¨€ï¼ˆå¦‚Javaã€Pythonã€Goï¼‰åœ¨å¼€å‘æ•ˆç‡ä¸Šæ˜¯è¿œè¿œé«˜äºæ²¡æœ‰GCæœºåˆ¶çš„è¯­è¨€çš„\n\n## å¸¸è§çš„GCç®—æ³•\n\n### å¼•ç”¨è®¡æ•°æ³•\n\nå¼•ç”¨è®¡æ•°æ³•ä¼šä¸ºæ¯ä¸€ä¸ªå¯¹è±¡åˆ†é…ä¸€ä¸ªç©ºé—´ï¼ˆâ€œè®¡æ•°å™¨â€ï¼‰ï¼Œè¿™ä¸ªç©ºé—´ä¸“é—¨ç”¨æ¥å­˜å‚¨å¯¹è±¡è¢«å¼•ç”¨çš„æ¬¡æ•°ã€‚å¦‚æœæœ‰å…¶ä»–å…¶ä»–å¯¹è±¡å¼•ç”¨Aå¯¹è±¡ï¼Œé‚£ä¹ˆAå¯¹è±¡çš„è®¡æ•°å™¨å°±ä¼š+1ï¼›åä¹‹ï¼Œå¼•ç”¨Açš„å¯¹è±¡åˆ é™¤å¯¹Açš„å¼•ç”¨åï¼ŒAçš„è®¡æ•°å™¨ä¾¿ä¼š-1ï¼Œå½“è®¡æ•°å™¨å‡è‡³0æ—¶ï¼Œè¯¥å¯¹è±¡çš„å†…å­˜ç©ºé—´å°±ä¼šè¢«å›æ”¶\n![image.png](https://raw.githubusercontent.com/lyydsheep/pic/main/202412252008887.png)\n\n\n- ä¼˜ç‚¹ï¼šç®€å•ç›´æ¥ï¼Œå›æ”¶é€Ÿåº¦å¿«ï¼Œä¸ä¼šå‡ºç°å†…å­˜è€—å°½æˆ–è¾¾åˆ°é˜ˆå€¼æ‰è¿›è¡Œå›æ”¶çš„ç°è±¡\n- ç¼ºç‚¹ï¼š\n\t- éœ€è¦é¢å¤–ç©ºé—´ç»´æŠ¤å¯¹è±¡çš„â€œå¼•ç”¨â€\n\t- æ— æ³•è§£å†³å¾ªç¯å¼•ç”¨é—®é¢˜\n\n### æ ‡è®°æ¸…é™¤æ³•\n\næ ‡è®°æ¸…é™¤æ³•å¯ä»¥åˆ†ä¸ºä¸¤æ­¥ï¼š\n- æ ‡è®°å¯¹è±¡ï¼šä»æ ¹å¯¹è±¡å¼€å§‹ï¼Œéå†æ‰€æœ‰çš„å¯¹è±¡åŠå…¶å­å¯¹è±¡ï¼Œå¹¶æ ‡è®°å®ƒä»¬çš„å¯è¾¾çŠ¶æ€\n- æ¸…é™¤å¯¹è±¡ï¼šå†ä¸€æ¬¡éå†å †ä¸­ä¸­æ‰€æœ‰çš„å¯¹è±¡ï¼Œå°†æ²¡æœ‰è¢«æ ‡è®°çš„å¯¹è±¡åˆ é™¤\n![image.png](https://raw.githubusercontent.com/lyydsheep/pic/main/202412252008711.png)\n\n\n- ä¼˜ç‚¹ï¼šç®€å•æ˜“å®ç°ï¼Œä¸éœ€è¦é¢å¤–çš„å­˜å‚¨ç©ºé—´ï¼Œé€‚ç”¨äºå¯¹è±¡ä¸ªæ•°å°‘çš„åœºæ™¯\n- ç¼ºç‚¹ï¼šä¼šé€ æˆå†…å­˜ç¢ç‰‡ï¼Œå¯¼è‡´åç»­åˆ›å»ºå¤§å¯¹è±¡æ—¶ï¼Œå³ä½¿æœ‰è¶³å¤Ÿçš„å†…å­˜ç©ºé—´ä¹Ÿå¯èƒ½æ— æ³•æˆåŠŸåˆ›å»ºï¼Œé™ä½äº†å†…å­˜çš„ä½¿ç”¨ç‡\n\n### å¤åˆ¶æ³•\n\nå¤åˆ¶æ³•å°†å†…å­˜åˆ†ä¸ºå¤§å°ç›¸ç­‰çš„ä¸¤å—åŒºåŸŸï¼Œæ¯ä¸€æ—¶åˆ»åªèƒ½ä½¿ç”¨å…¶ä¸­çš„ä¸€å—å†…å­˜ã€‚å½“ä¸€å—åŒºåŸŸçš„å†…å­˜è¢«ç”¨å®Œæ—¶ï¼Œå°±éœ€è¦æŠŠè¯¥åŒºåŸŸè¿˜åœ¨ä½¿ç”¨çš„å¯¹è±¡ç§»åŠ¨åˆ°å¦ä¸€å—åŒºåŸŸï¼ŒåŒæ—¶å°†å·²ä½¿ç”¨çš„å†…å­˜å…¨éƒ¨æ¸…é™¤\n![image.png](https://raw.githubusercontent.com/lyydsheep/pic/main/202412252008571.png)\n\n- ä¼˜ç‚¹ï¼šä¸ä¼šäº§ç”Ÿå†…å­˜ç¢ç‰‡ï¼Œæ¯æ¬¡éƒ½æ˜¯æ¸…é™¤æ•´å—å†…å­˜\n- ç¼ºç‚¹ï¼šå†…å­˜è¢«ä¸€åˆ†ä¸ºäºŒï¼Œåˆ©ç”¨ç‡ä½ï¼Œå¦‚æœå¯¹è±¡ä¸ªæ•°è¾ƒå¤šï¼Œå¤åˆ¶å¯¹è±¡çš„è¿‡ç¨‹è€—æ—¶é•¿ï¼Œæ•ˆç‡ä½ä¸‹\n\n### æ ‡è®°æ•´ç†æ³•\n\næ ‡è®°æ•´ç†æ³•å’Œæ ‡è®°æ¸…é™¤æ³•ç±»ä¼¼ï¼ŒåŒæ ·æ˜¯éœ€è¦ä¸¤é˜¶æ®µå®ŒæˆGCæ“ä½œ\n- æ ‡è®°é˜¶æ®µï¼šä»GCçš„æ ¹èŠ‚ç‚¹éå†æ‰€æœ‰çš„å¯¹è±¡ï¼ŒæŠŠè¿˜åœ¨ä½¿ç”¨çš„å¯¹è±¡æ ‡è®°\n- æ•´ç†é˜¶æ®µï¼šæ‰€æœ‰å­˜æ´»çš„å¯¹è±¡è¢«ç§»åŠ¨åˆ°ç©ºé—²å†…å­˜çš„ä¸€ç«¯ï¼ŒæŒ‰ç…§åœ°å€é¡ºåºæ’åˆ—ï¼Œå¹¶æ›´æ–°å¯¹è±¡å¼•ç”¨æŒ‡é’ˆã€‚æœ€åå°†æœ«ç«¯åœ°å€ä¹‹å¤–çš„å†…å­˜ç©ºé—´æ¸…é™¤\n![image.png](https://raw.githubusercontent.com/lyydsheep/pic/main/202412260904789.png)\n\n\n## Goè¯­è¨€çš„GCç®—æ³•\n\nGoè¯­è¨€çš„GCé‡‡ç”¨çš„æ˜¯å¹¶å‘ä¸‰è‰²æ ‡è®°æ³• + å±éšœæŠ€æœ¯å®ç°çš„ã€‚ä¸‰è‰²æ ‡è®°æ³•æœ¬è´¨å°±æ˜¯æ ‡è®°æ¸…ç†ç®—æ³•ï¼Œå¹¶æ²¡æœ‰å¯¹è±¡åˆ†ä»£ã€å†…å­˜æ•´ç†çš„è¡Œä¸ºï¼Œä¸‰è‰²æ ‡è®°åªæ˜¯å¯¹å…¶æ ‡è®°é˜¶æ®µçš„ä¸€ç§ç®€å•æè¿°ã€‚\n\n### ä¸ºä»€ä¹ˆä¸éœ€è¦å†…å­˜æ•´ç†ï¼ˆä¸ºä»€ä¹ˆä¸é‡‡ç”¨æ ‡è®°æ•´ç†ç®—æ³•æˆ–å¤åˆ¶ç®—æ³• ï¼‰ï¼Ÿ\nGoè¯­è¨€çš„å†…å­˜åˆ†é…ç®—æ³•æ˜¯åŸºäºTCMallocï¼Œè™½ç„¶ä¸èƒ½åƒæ ‡è®°æ•´ç†æ³•/å¤åˆ¶æ³•æ¶ˆé™¤å†…å­˜ç¢ç‰‡ï¼Œä½†ä¹Ÿèƒ½æœ‰æ•ˆçš„é™ä½å†…å­˜ç¢ç‰‡ç‡ã€‚æ­¤å¤–ï¼ŒThread Cacheæœºåˆ¶ä½¿å¾—Goåœ¨å¤§éƒ¨åˆ†åˆ†é…åœºæ™¯ä¸‹å¯ä»¥é¿å…ä½¿ç”¨é”ï¼Œåœ¨é«˜å¹¶å‘ç¯å¢ƒä¸‹å…·æœ‰æä½³çš„æ€§èƒ½ä¼˜åŠ¿\n\n### ä¸ºä»€ä¹ˆä¸é‡‡ç”¨åˆ†ä»£æ³•ï¼Ÿ\nåˆ†ä»£æ³•çš„æœ€å¤§ä¼˜åŠ¿å°±æ˜¯åŒºåˆ†é•¿ç”Ÿå‘½å‘¨æœŸå’ŒçŸ­ç”Ÿå‘½å‘¨æœŸçš„å¯¹è±¡ï¼Œä»è€Œå¿«é€Ÿå›æ”¶æ®µç”Ÿå‘½å‘¨æœŸå¯¹è±¡ã€‚ä½†Goè¯­è¨€åœ¨ç¼–è¯‘æœŸä¼šåšé€ƒé€¸åˆ†æï¼Œå¯ä»¥å°†çŸ­ç”Ÿå‘½å‘¨æœŸçš„structåˆ†é…åˆ°æ ˆä¸Šï¼Œè€ƒè™‘åˆ°ä¸€æ–¹é¢æ ˆä¸Šçš„å†…å­˜å›æ”¶æ˜¯éå¸¸å¿«çš„ï¼Œå¦ä¸€æ–¹é¢åœ¨Goä¸­çŸ­ç”Ÿå‘½å‘¨æœŸå¯¹è±¡ä¸ªæ•°å¹¶ä¸å¤šï¼Œæ‰€ä»¥åˆ†ä»£æ³•åœ¨Goä¸­ä¼˜åŠ¿å¹¶ä¸æ˜æ˜¾ã€‚ç›¸ååœ°ï¼Œåˆ†ä»£æ³•éœ€è¦é¢å¤–çš„å±éšœæ¥ç»´æŠ¤è€å¹´ä»£å¯¹è±¡å¯¹æ–°å¹´ä»£å¯¹è±¡çš„å¼•ç”¨å…³ç³»ï¼Œå¢åŠ äº†GCè´Ÿæ‹…\n\n## Goçš„GC\n\n### æ ‡è®°æ¸…é™¤æ³•çš„ç“¶é¢ˆ\n\næ ‡è®°æ¸…é™¤æ³•åœ¨GCä¹‹å‰éœ€è¦STWï¼Œå³æš‚åœè¿™ä¸ªåº”ç”¨ç¨‹åºï¼Œå¦åˆ™ä¼šå¯¼è‡´é”™è¯¯åœ°åˆ é™¤è¢«å¼•ç”¨çš„å¯¹è±¡ã€‚ä½†STWä¼šç»™å¼•ç”¨æ€§èƒ½å¸¦æ¥æå¤§çš„æŸè€—\n\n\n\n\næ˜¯ä»€ä¹ˆï¼Œæœ‰ä»€ä¹ˆä¼˜åŠ¿ï¼Œå®é™…æƒ…å†µï¼Œç‰¹æ®Šæ€§ï¼Œä¸é€‚ç”¨","source":"_posts/Go/GC.md","raw":"## GCæ˜¯ä»€ä¹ˆï¼Ÿ\nGCï¼ˆGarbage Collectionï¼‰å³åƒåœ¾å›æ”¶ï¼Œå®è´¨ä¸Šå°±æ˜¯å›æ”¶åƒåœ¾å†…å­˜ã€‚ç”±äºæ ˆä¸Šçš„å†…å­˜æ˜¯æœ‰ç¼–è¯‘å™¨åˆ†é…å’Œé‡Šæ”¾çš„ï¼Œæ‰€ä»¥GCéƒ½æ˜¯å¯¹å †ä¸Šä¸å†ä½¿ç”¨çš„å†…å­˜è¿›è¡Œå›æ”¶ï¼Œè®©è¿™äº›å†…å­˜èƒ½å¤Ÿå†æ¬¡è¢«åˆ©ç”¨\n\n## ä¸ºä»€ä¹ˆéœ€è¦GCï¼Ÿ\nåœ¨çœŸå®ä¸šåŠ¡åœºæ™¯ä¸­ï¼Œå¯¹è±¡ä¸ªæ•°éå¸¸å¤šï¼Œå¼•ç”¨å…³ç³»é”™ç»¼å¤æ‚ï¼Œå¦‚æœå…¨é ç¨‹åºå‘˜æ‰‹åŠ¨é‡Šæ”¾å†…å­˜å¾ˆéš¾é¿å…æŒ‡é’ˆæ‚¬æŒ‚é”™è¯¯ã€‚æ‰€ä»¥ä¸€é—¨æ‹¥æœ‰è‡ªåŠ¨è¯†åˆ«å¹¶å›æ”¶åƒåœ¾å†…å­˜çš„è¯­è¨€ï¼ˆå¦‚Javaã€Pythonã€Goï¼‰åœ¨å¼€å‘æ•ˆç‡ä¸Šæ˜¯è¿œè¿œé«˜äºæ²¡æœ‰GCæœºåˆ¶çš„è¯­è¨€çš„\n\n## å¸¸è§çš„GCç®—æ³•\n\n### å¼•ç”¨è®¡æ•°æ³•\n\nå¼•ç”¨è®¡æ•°æ³•ä¼šä¸ºæ¯ä¸€ä¸ªå¯¹è±¡åˆ†é…ä¸€ä¸ªç©ºé—´ï¼ˆâ€œè®¡æ•°å™¨â€ï¼‰ï¼Œè¿™ä¸ªç©ºé—´ä¸“é—¨ç”¨æ¥å­˜å‚¨å¯¹è±¡è¢«å¼•ç”¨çš„æ¬¡æ•°ã€‚å¦‚æœæœ‰å…¶ä»–å…¶ä»–å¯¹è±¡å¼•ç”¨Aå¯¹è±¡ï¼Œé‚£ä¹ˆAå¯¹è±¡çš„è®¡æ•°å™¨å°±ä¼š+1ï¼›åä¹‹ï¼Œå¼•ç”¨Açš„å¯¹è±¡åˆ é™¤å¯¹Açš„å¼•ç”¨åï¼ŒAçš„è®¡æ•°å™¨ä¾¿ä¼š-1ï¼Œå½“è®¡æ•°å™¨å‡è‡³0æ—¶ï¼Œè¯¥å¯¹è±¡çš„å†…å­˜ç©ºé—´å°±ä¼šè¢«å›æ”¶\n![image.png](https://raw.githubusercontent.com/lyydsheep/pic/main/202412252008887.png)\n\n\n- ä¼˜ç‚¹ï¼šç®€å•ç›´æ¥ï¼Œå›æ”¶é€Ÿåº¦å¿«ï¼Œä¸ä¼šå‡ºç°å†…å­˜è€—å°½æˆ–è¾¾åˆ°é˜ˆå€¼æ‰è¿›è¡Œå›æ”¶çš„ç°è±¡\n- ç¼ºç‚¹ï¼š\n\t- éœ€è¦é¢å¤–ç©ºé—´ç»´æŠ¤å¯¹è±¡çš„â€œå¼•ç”¨â€\n\t- æ— æ³•è§£å†³å¾ªç¯å¼•ç”¨é—®é¢˜\n\n### æ ‡è®°æ¸…é™¤æ³•\n\næ ‡è®°æ¸…é™¤æ³•å¯ä»¥åˆ†ä¸ºä¸¤æ­¥ï¼š\n- æ ‡è®°å¯¹è±¡ï¼šä»æ ¹å¯¹è±¡å¼€å§‹ï¼Œéå†æ‰€æœ‰çš„å¯¹è±¡åŠå…¶å­å¯¹è±¡ï¼Œå¹¶æ ‡è®°å®ƒä»¬çš„å¯è¾¾çŠ¶æ€\n- æ¸…é™¤å¯¹è±¡ï¼šå†ä¸€æ¬¡éå†å †ä¸­ä¸­æ‰€æœ‰çš„å¯¹è±¡ï¼Œå°†æ²¡æœ‰è¢«æ ‡è®°çš„å¯¹è±¡åˆ é™¤\n![image.png](https://raw.githubusercontent.com/lyydsheep/pic/main/202412252008711.png)\n\n\n- ä¼˜ç‚¹ï¼šç®€å•æ˜“å®ç°ï¼Œä¸éœ€è¦é¢å¤–çš„å­˜å‚¨ç©ºé—´ï¼Œé€‚ç”¨äºå¯¹è±¡ä¸ªæ•°å°‘çš„åœºæ™¯\n- ç¼ºç‚¹ï¼šä¼šé€ æˆå†…å­˜ç¢ç‰‡ï¼Œå¯¼è‡´åç»­åˆ›å»ºå¤§å¯¹è±¡æ—¶ï¼Œå³ä½¿æœ‰è¶³å¤Ÿçš„å†…å­˜ç©ºé—´ä¹Ÿå¯èƒ½æ— æ³•æˆåŠŸåˆ›å»ºï¼Œé™ä½äº†å†…å­˜çš„ä½¿ç”¨ç‡\n\n### å¤åˆ¶æ³•\n\nå¤åˆ¶æ³•å°†å†…å­˜åˆ†ä¸ºå¤§å°ç›¸ç­‰çš„ä¸¤å—åŒºåŸŸï¼Œæ¯ä¸€æ—¶åˆ»åªèƒ½ä½¿ç”¨å…¶ä¸­çš„ä¸€å—å†…å­˜ã€‚å½“ä¸€å—åŒºåŸŸçš„å†…å­˜è¢«ç”¨å®Œæ—¶ï¼Œå°±éœ€è¦æŠŠè¯¥åŒºåŸŸè¿˜åœ¨ä½¿ç”¨çš„å¯¹è±¡ç§»åŠ¨åˆ°å¦ä¸€å—åŒºåŸŸï¼ŒåŒæ—¶å°†å·²ä½¿ç”¨çš„å†…å­˜å…¨éƒ¨æ¸…é™¤\n![image.png](https://raw.githubusercontent.com/lyydsheep/pic/main/202412252008571.png)\n\n- ä¼˜ç‚¹ï¼šä¸ä¼šäº§ç”Ÿå†…å­˜ç¢ç‰‡ï¼Œæ¯æ¬¡éƒ½æ˜¯æ¸…é™¤æ•´å—å†…å­˜\n- ç¼ºç‚¹ï¼šå†…å­˜è¢«ä¸€åˆ†ä¸ºäºŒï¼Œåˆ©ç”¨ç‡ä½ï¼Œå¦‚æœå¯¹è±¡ä¸ªæ•°è¾ƒå¤šï¼Œå¤åˆ¶å¯¹è±¡çš„è¿‡ç¨‹è€—æ—¶é•¿ï¼Œæ•ˆç‡ä½ä¸‹\n\n### æ ‡è®°æ•´ç†æ³•\n\næ ‡è®°æ•´ç†æ³•å’Œæ ‡è®°æ¸…é™¤æ³•ç±»ä¼¼ï¼ŒåŒæ ·æ˜¯éœ€è¦ä¸¤é˜¶æ®µå®ŒæˆGCæ“ä½œ\n- æ ‡è®°é˜¶æ®µï¼šä»GCçš„æ ¹èŠ‚ç‚¹éå†æ‰€æœ‰çš„å¯¹è±¡ï¼ŒæŠŠè¿˜åœ¨ä½¿ç”¨çš„å¯¹è±¡æ ‡è®°\n- æ•´ç†é˜¶æ®µï¼šæ‰€æœ‰å­˜æ´»çš„å¯¹è±¡è¢«ç§»åŠ¨åˆ°ç©ºé—²å†…å­˜çš„ä¸€ç«¯ï¼ŒæŒ‰ç…§åœ°å€é¡ºåºæ’åˆ—ï¼Œå¹¶æ›´æ–°å¯¹è±¡å¼•ç”¨æŒ‡é’ˆã€‚æœ€åå°†æœ«ç«¯åœ°å€ä¹‹å¤–çš„å†…å­˜ç©ºé—´æ¸…é™¤\n![image.png](https://raw.githubusercontent.com/lyydsheep/pic/main/202412260904789.png)\n\n\n## Goè¯­è¨€çš„GCç®—æ³•\n\nGoè¯­è¨€çš„GCé‡‡ç”¨çš„æ˜¯å¹¶å‘ä¸‰è‰²æ ‡è®°æ³• + å±éšœæŠ€æœ¯å®ç°çš„ã€‚ä¸‰è‰²æ ‡è®°æ³•æœ¬è´¨å°±æ˜¯æ ‡è®°æ¸…ç†ç®—æ³•ï¼Œå¹¶æ²¡æœ‰å¯¹è±¡åˆ†ä»£ã€å†…å­˜æ•´ç†çš„è¡Œä¸ºï¼Œä¸‰è‰²æ ‡è®°åªæ˜¯å¯¹å…¶æ ‡è®°é˜¶æ®µçš„ä¸€ç§ç®€å•æè¿°ã€‚\n\n### ä¸ºä»€ä¹ˆä¸éœ€è¦å†…å­˜æ•´ç†ï¼ˆä¸ºä»€ä¹ˆä¸é‡‡ç”¨æ ‡è®°æ•´ç†ç®—æ³•æˆ–å¤åˆ¶ç®—æ³• ï¼‰ï¼Ÿ\nGoè¯­è¨€çš„å†…å­˜åˆ†é…ç®—æ³•æ˜¯åŸºäºTCMallocï¼Œè™½ç„¶ä¸èƒ½åƒæ ‡è®°æ•´ç†æ³•/å¤åˆ¶æ³•æ¶ˆé™¤å†…å­˜ç¢ç‰‡ï¼Œä½†ä¹Ÿèƒ½æœ‰æ•ˆçš„é™ä½å†…å­˜ç¢ç‰‡ç‡ã€‚æ­¤å¤–ï¼ŒThread Cacheæœºåˆ¶ä½¿å¾—Goåœ¨å¤§éƒ¨åˆ†åˆ†é…åœºæ™¯ä¸‹å¯ä»¥é¿å…ä½¿ç”¨é”ï¼Œåœ¨é«˜å¹¶å‘ç¯å¢ƒä¸‹å…·æœ‰æä½³çš„æ€§èƒ½ä¼˜åŠ¿\n\n### ä¸ºä»€ä¹ˆä¸é‡‡ç”¨åˆ†ä»£æ³•ï¼Ÿ\nåˆ†ä»£æ³•çš„æœ€å¤§ä¼˜åŠ¿å°±æ˜¯åŒºåˆ†é•¿ç”Ÿå‘½å‘¨æœŸå’ŒçŸ­ç”Ÿå‘½å‘¨æœŸçš„å¯¹è±¡ï¼Œä»è€Œå¿«é€Ÿå›æ”¶æ®µç”Ÿå‘½å‘¨æœŸå¯¹è±¡ã€‚ä½†Goè¯­è¨€åœ¨ç¼–è¯‘æœŸä¼šåšé€ƒé€¸åˆ†æï¼Œå¯ä»¥å°†çŸ­ç”Ÿå‘½å‘¨æœŸçš„structåˆ†é…åˆ°æ ˆä¸Šï¼Œè€ƒè™‘åˆ°ä¸€æ–¹é¢æ ˆä¸Šçš„å†…å­˜å›æ”¶æ˜¯éå¸¸å¿«çš„ï¼Œå¦ä¸€æ–¹é¢åœ¨Goä¸­çŸ­ç”Ÿå‘½å‘¨æœŸå¯¹è±¡ä¸ªæ•°å¹¶ä¸å¤šï¼Œæ‰€ä»¥åˆ†ä»£æ³•åœ¨Goä¸­ä¼˜åŠ¿å¹¶ä¸æ˜æ˜¾ã€‚ç›¸ååœ°ï¼Œåˆ†ä»£æ³•éœ€è¦é¢å¤–çš„å±éšœæ¥ç»´æŠ¤è€å¹´ä»£å¯¹è±¡å¯¹æ–°å¹´ä»£å¯¹è±¡çš„å¼•ç”¨å…³ç³»ï¼Œå¢åŠ äº†GCè´Ÿæ‹…\n\n## Goçš„GC\n\n### æ ‡è®°æ¸…é™¤æ³•çš„ç“¶é¢ˆ\n\næ ‡è®°æ¸…é™¤æ³•åœ¨GCä¹‹å‰éœ€è¦STWï¼Œå³æš‚åœè¿™ä¸ªåº”ç”¨ç¨‹åºï¼Œå¦åˆ™ä¼šå¯¼è‡´é”™è¯¯åœ°åˆ é™¤è¢«å¼•ç”¨çš„å¯¹è±¡ã€‚ä½†STWä¼šç»™å¼•ç”¨æ€§èƒ½å¸¦æ¥æå¤§çš„æŸè€—\n\n\n\n\næ˜¯ä»€ä¹ˆï¼Œæœ‰ä»€ä¹ˆä¼˜åŠ¿ï¼Œå®é™…æƒ…å†µï¼Œç‰¹æ®Šæ€§ï¼Œä¸é€‚ç”¨","slug":"Go/GC","published":1,"date":"2024-12-27T11:03:15.342Z","updated":"2024-12-27T11:03:15.342Z","title":"","comments":1,"layout":"post","photos":[],"_id":"cm6c7md6l001pa5t2g8i62d7u","content":"<h2 id=\"GCæ˜¯ä»€ä¹ˆï¼Ÿ\"><a href=\"#GCæ˜¯ä»€ä¹ˆï¼Ÿ\" class=\"headerlink\" title=\"GCæ˜¯ä»€ä¹ˆï¼Ÿ\"></a>GCæ˜¯ä»€ä¹ˆï¼Ÿ</h2><p>GCï¼ˆGarbage Collectionï¼‰å³åƒåœ¾å›æ”¶ï¼Œå®è´¨ä¸Šå°±æ˜¯å›æ”¶åƒåœ¾å†…å­˜ã€‚ç”±äºæ ˆä¸Šçš„å†…å­˜æ˜¯æœ‰ç¼–è¯‘å™¨åˆ†é…å’Œé‡Šæ”¾çš„ï¼Œæ‰€ä»¥GCéƒ½æ˜¯å¯¹å †ä¸Šä¸å†ä½¿ç”¨çš„å†…å­˜è¿›è¡Œå›æ”¶ï¼Œè®©è¿™äº›å†…å­˜èƒ½å¤Ÿå†æ¬¡è¢«åˆ©ç”¨</p>\n<h2 id=\"ä¸ºä»€ä¹ˆéœ€è¦GCï¼Ÿ\"><a href=\"#ä¸ºä»€ä¹ˆéœ€è¦GCï¼Ÿ\" class=\"headerlink\" title=\"ä¸ºä»€ä¹ˆéœ€è¦GCï¼Ÿ\"></a>ä¸ºä»€ä¹ˆéœ€è¦GCï¼Ÿ</h2><p>åœ¨çœŸå®ä¸šåŠ¡åœºæ™¯ä¸­ï¼Œå¯¹è±¡ä¸ªæ•°éå¸¸å¤šï¼Œå¼•ç”¨å…³ç³»é”™ç»¼å¤æ‚ï¼Œå¦‚æœå…¨é ç¨‹åºå‘˜æ‰‹åŠ¨é‡Šæ”¾å†…å­˜å¾ˆéš¾é¿å…æŒ‡é’ˆæ‚¬æŒ‚é”™è¯¯ã€‚æ‰€ä»¥ä¸€é—¨æ‹¥æœ‰è‡ªåŠ¨è¯†åˆ«å¹¶å›æ”¶åƒåœ¾å†…å­˜çš„è¯­è¨€ï¼ˆå¦‚Javaã€Pythonã€Goï¼‰åœ¨å¼€å‘æ•ˆç‡ä¸Šæ˜¯è¿œè¿œé«˜äºæ²¡æœ‰GCæœºåˆ¶çš„è¯­è¨€çš„</p>\n<h2 id=\"å¸¸è§çš„GCç®—æ³•\"><a href=\"#å¸¸è§çš„GCç®—æ³•\" class=\"headerlink\" title=\"å¸¸è§çš„GCç®—æ³•\"></a>å¸¸è§çš„GCç®—æ³•</h2><h3 id=\"å¼•ç”¨è®¡æ•°æ³•\"><a href=\"#å¼•ç”¨è®¡æ•°æ³•\" class=\"headerlink\" title=\"å¼•ç”¨è®¡æ•°æ³•\"></a>å¼•ç”¨è®¡æ•°æ³•</h3><p>å¼•ç”¨è®¡æ•°æ³•ä¼šä¸ºæ¯ä¸€ä¸ªå¯¹è±¡åˆ†é…ä¸€ä¸ªç©ºé—´ï¼ˆâ€œè®¡æ•°å™¨â€ï¼‰ï¼Œè¿™ä¸ªç©ºé—´ä¸“é—¨ç”¨æ¥å­˜å‚¨å¯¹è±¡è¢«å¼•ç”¨çš„æ¬¡æ•°ã€‚å¦‚æœæœ‰å…¶ä»–å…¶ä»–å¯¹è±¡å¼•ç”¨Aå¯¹è±¡ï¼Œé‚£ä¹ˆAå¯¹è±¡çš„è®¡æ•°å™¨å°±ä¼š+1ï¼›åä¹‹ï¼Œå¼•ç”¨Açš„å¯¹è±¡åˆ é™¤å¯¹Açš„å¼•ç”¨åï¼ŒAçš„è®¡æ•°å™¨ä¾¿ä¼š-1ï¼Œå½“è®¡æ•°å™¨å‡è‡³0æ—¶ï¼Œè¯¥å¯¹è±¡çš„å†…å­˜ç©ºé—´å°±ä¼šè¢«å›æ”¶<br><img src=\"https://raw.githubusercontent.com/lyydsheep/pic/main/202412252008887.png\" alt=\"image.png\"></p>\n<ul>\n<li>ä¼˜ç‚¹ï¼šç®€å•ç›´æ¥ï¼Œå›æ”¶é€Ÿåº¦å¿«ï¼Œä¸ä¼šå‡ºç°å†…å­˜è€—å°½æˆ–è¾¾åˆ°é˜ˆå€¼æ‰è¿›è¡Œå›æ”¶çš„ç°è±¡</li>\n<li>ç¼ºç‚¹ï¼š<ul>\n<li>éœ€è¦é¢å¤–ç©ºé—´ç»´æŠ¤å¯¹è±¡çš„â€œå¼•ç”¨â€</li>\n<li>æ— æ³•è§£å†³å¾ªç¯å¼•ç”¨é—®é¢˜</li>\n</ul>\n</li>\n</ul>\n<h3 id=\"æ ‡è®°æ¸…é™¤æ³•\"><a href=\"#æ ‡è®°æ¸…é™¤æ³•\" class=\"headerlink\" title=\"æ ‡è®°æ¸…é™¤æ³•\"></a>æ ‡è®°æ¸…é™¤æ³•</h3><p>æ ‡è®°æ¸…é™¤æ³•å¯ä»¥åˆ†ä¸ºä¸¤æ­¥ï¼š</p>\n<ul>\n<li><p>æ ‡è®°å¯¹è±¡ï¼šä»æ ¹å¯¹è±¡å¼€å§‹ï¼Œéå†æ‰€æœ‰çš„å¯¹è±¡åŠå…¶å­å¯¹è±¡ï¼Œå¹¶æ ‡è®°å®ƒä»¬çš„å¯è¾¾çŠ¶æ€</p>\n</li>\n<li><p>æ¸…é™¤å¯¹è±¡ï¼šå†ä¸€æ¬¡éå†å †ä¸­ä¸­æ‰€æœ‰çš„å¯¹è±¡ï¼Œå°†æ²¡æœ‰è¢«æ ‡è®°çš„å¯¹è±¡åˆ é™¤<br><img src=\"https://raw.githubusercontent.com/lyydsheep/pic/main/202412252008711.png\" alt=\"image.png\"></p>\n</li>\n<li><p>ä¼˜ç‚¹ï¼šç®€å•æ˜“å®ç°ï¼Œä¸éœ€è¦é¢å¤–çš„å­˜å‚¨ç©ºé—´ï¼Œé€‚ç”¨äºå¯¹è±¡ä¸ªæ•°å°‘çš„åœºæ™¯</p>\n</li>\n<li><p>ç¼ºç‚¹ï¼šä¼šé€ æˆå†…å­˜ç¢ç‰‡ï¼Œå¯¼è‡´åç»­åˆ›å»ºå¤§å¯¹è±¡æ—¶ï¼Œå³ä½¿æœ‰è¶³å¤Ÿçš„å†…å­˜ç©ºé—´ä¹Ÿå¯èƒ½æ— æ³•æˆåŠŸåˆ›å»ºï¼Œé™ä½äº†å†…å­˜çš„ä½¿ç”¨ç‡</p>\n</li>\n</ul>\n<h3 id=\"å¤åˆ¶æ³•\"><a href=\"#å¤åˆ¶æ³•\" class=\"headerlink\" title=\"å¤åˆ¶æ³•\"></a>å¤åˆ¶æ³•</h3><p>å¤åˆ¶æ³•å°†å†…å­˜åˆ†ä¸ºå¤§å°ç›¸ç­‰çš„ä¸¤å—åŒºåŸŸï¼Œæ¯ä¸€æ—¶åˆ»åªèƒ½ä½¿ç”¨å…¶ä¸­çš„ä¸€å—å†…å­˜ã€‚å½“ä¸€å—åŒºåŸŸçš„å†…å­˜è¢«ç”¨å®Œæ—¶ï¼Œå°±éœ€è¦æŠŠè¯¥åŒºåŸŸè¿˜åœ¨ä½¿ç”¨çš„å¯¹è±¡ç§»åŠ¨åˆ°å¦ä¸€å—åŒºåŸŸï¼ŒåŒæ—¶å°†å·²ä½¿ç”¨çš„å†…å­˜å…¨éƒ¨æ¸…é™¤<br><img src=\"https://raw.githubusercontent.com/lyydsheep/pic/main/202412252008571.png\" alt=\"image.png\"></p>\n<ul>\n<li>ä¼˜ç‚¹ï¼šä¸ä¼šäº§ç”Ÿå†…å­˜ç¢ç‰‡ï¼Œæ¯æ¬¡éƒ½æ˜¯æ¸…é™¤æ•´å—å†…å­˜</li>\n<li>ç¼ºç‚¹ï¼šå†…å­˜è¢«ä¸€åˆ†ä¸ºäºŒï¼Œåˆ©ç”¨ç‡ä½ï¼Œå¦‚æœå¯¹è±¡ä¸ªæ•°è¾ƒå¤šï¼Œå¤åˆ¶å¯¹è±¡çš„è¿‡ç¨‹è€—æ—¶é•¿ï¼Œæ•ˆç‡ä½ä¸‹</li>\n</ul>\n<h3 id=\"æ ‡è®°æ•´ç†æ³•\"><a href=\"#æ ‡è®°æ•´ç†æ³•\" class=\"headerlink\" title=\"æ ‡è®°æ•´ç†æ³•\"></a>æ ‡è®°æ•´ç†æ³•</h3><p>æ ‡è®°æ•´ç†æ³•å’Œæ ‡è®°æ¸…é™¤æ³•ç±»ä¼¼ï¼ŒåŒæ ·æ˜¯éœ€è¦ä¸¤é˜¶æ®µå®ŒæˆGCæ“ä½œ</p>\n<ul>\n<li>æ ‡è®°é˜¶æ®µï¼šä»GCçš„æ ¹èŠ‚ç‚¹éå†æ‰€æœ‰çš„å¯¹è±¡ï¼ŒæŠŠè¿˜åœ¨ä½¿ç”¨çš„å¯¹è±¡æ ‡è®°</li>\n<li>æ•´ç†é˜¶æ®µï¼šæ‰€æœ‰å­˜æ´»çš„å¯¹è±¡è¢«ç§»åŠ¨åˆ°ç©ºé—²å†…å­˜çš„ä¸€ç«¯ï¼ŒæŒ‰ç…§åœ°å€é¡ºåºæ’åˆ—ï¼Œå¹¶æ›´æ–°å¯¹è±¡å¼•ç”¨æŒ‡é’ˆã€‚æœ€åå°†æœ«ç«¯åœ°å€ä¹‹å¤–çš„å†…å­˜ç©ºé—´æ¸…é™¤<br><img src=\"https://raw.githubusercontent.com/lyydsheep/pic/main/202412260904789.png\" alt=\"image.png\"></li>\n</ul>\n<h2 id=\"Goè¯­è¨€çš„GCç®—æ³•\"><a href=\"#Goè¯­è¨€çš„GCç®—æ³•\" class=\"headerlink\" title=\"Goè¯­è¨€çš„GCç®—æ³•\"></a>Goè¯­è¨€çš„GCç®—æ³•</h2><p>Goè¯­è¨€çš„GCé‡‡ç”¨çš„æ˜¯å¹¶å‘ä¸‰è‰²æ ‡è®°æ³• + å±éšœæŠ€æœ¯å®ç°çš„ã€‚ä¸‰è‰²æ ‡è®°æ³•æœ¬è´¨å°±æ˜¯æ ‡è®°æ¸…ç†ç®—æ³•ï¼Œå¹¶æ²¡æœ‰å¯¹è±¡åˆ†ä»£ã€å†…å­˜æ•´ç†çš„è¡Œä¸ºï¼Œä¸‰è‰²æ ‡è®°åªæ˜¯å¯¹å…¶æ ‡è®°é˜¶æ®µçš„ä¸€ç§ç®€å•æè¿°ã€‚</p>\n<h3 id=\"ä¸ºä»€ä¹ˆä¸éœ€è¦å†…å­˜æ•´ç†ï¼ˆä¸ºä»€ä¹ˆä¸é‡‡ç”¨æ ‡è®°æ•´ç†ç®—æ³•æˆ–å¤åˆ¶ç®—æ³•-ï¼‰ï¼Ÿ\"><a href=\"#ä¸ºä»€ä¹ˆä¸éœ€è¦å†…å­˜æ•´ç†ï¼ˆä¸ºä»€ä¹ˆä¸é‡‡ç”¨æ ‡è®°æ•´ç†ç®—æ³•æˆ–å¤åˆ¶ç®—æ³•-ï¼‰ï¼Ÿ\" class=\"headerlink\" title=\"ä¸ºä»€ä¹ˆä¸éœ€è¦å†…å­˜æ•´ç†ï¼ˆä¸ºä»€ä¹ˆä¸é‡‡ç”¨æ ‡è®°æ•´ç†ç®—æ³•æˆ–å¤åˆ¶ç®—æ³• ï¼‰ï¼Ÿ\"></a>ä¸ºä»€ä¹ˆä¸éœ€è¦å†…å­˜æ•´ç†ï¼ˆä¸ºä»€ä¹ˆä¸é‡‡ç”¨æ ‡è®°æ•´ç†ç®—æ³•æˆ–å¤åˆ¶ç®—æ³• ï¼‰ï¼Ÿ</h3><p>Goè¯­è¨€çš„å†…å­˜åˆ†é…ç®—æ³•æ˜¯åŸºäºTCMallocï¼Œè™½ç„¶ä¸èƒ½åƒæ ‡è®°æ•´ç†æ³•&#x2F;å¤åˆ¶æ³•æ¶ˆé™¤å†…å­˜ç¢ç‰‡ï¼Œä½†ä¹Ÿèƒ½æœ‰æ•ˆçš„é™ä½å†…å­˜ç¢ç‰‡ç‡ã€‚æ­¤å¤–ï¼ŒThread Cacheæœºåˆ¶ä½¿å¾—Goåœ¨å¤§éƒ¨åˆ†åˆ†é…åœºæ™¯ä¸‹å¯ä»¥é¿å…ä½¿ç”¨é”ï¼Œåœ¨é«˜å¹¶å‘ç¯å¢ƒä¸‹å…·æœ‰æä½³çš„æ€§èƒ½ä¼˜åŠ¿</p>\n<h3 id=\"ä¸ºä»€ä¹ˆä¸é‡‡ç”¨åˆ†ä»£æ³•ï¼Ÿ\"><a href=\"#ä¸ºä»€ä¹ˆä¸é‡‡ç”¨åˆ†ä»£æ³•ï¼Ÿ\" class=\"headerlink\" title=\"ä¸ºä»€ä¹ˆä¸é‡‡ç”¨åˆ†ä»£æ³•ï¼Ÿ\"></a>ä¸ºä»€ä¹ˆä¸é‡‡ç”¨åˆ†ä»£æ³•ï¼Ÿ</h3><p>åˆ†ä»£æ³•çš„æœ€å¤§ä¼˜åŠ¿å°±æ˜¯åŒºåˆ†é•¿ç”Ÿå‘½å‘¨æœŸå’ŒçŸ­ç”Ÿå‘½å‘¨æœŸçš„å¯¹è±¡ï¼Œä»è€Œå¿«é€Ÿå›æ”¶æ®µç”Ÿå‘½å‘¨æœŸå¯¹è±¡ã€‚ä½†Goè¯­è¨€åœ¨ç¼–è¯‘æœŸä¼šåšé€ƒé€¸åˆ†æï¼Œå¯ä»¥å°†çŸ­ç”Ÿå‘½å‘¨æœŸçš„structåˆ†é…åˆ°æ ˆä¸Šï¼Œè€ƒè™‘åˆ°ä¸€æ–¹é¢æ ˆä¸Šçš„å†…å­˜å›æ”¶æ˜¯éå¸¸å¿«çš„ï¼Œå¦ä¸€æ–¹é¢åœ¨Goä¸­çŸ­ç”Ÿå‘½å‘¨æœŸå¯¹è±¡ä¸ªæ•°å¹¶ä¸å¤šï¼Œæ‰€ä»¥åˆ†ä»£æ³•åœ¨Goä¸­ä¼˜åŠ¿å¹¶ä¸æ˜æ˜¾ã€‚ç›¸ååœ°ï¼Œåˆ†ä»£æ³•éœ€è¦é¢å¤–çš„å±éšœæ¥ç»´æŠ¤è€å¹´ä»£å¯¹è±¡å¯¹æ–°å¹´ä»£å¯¹è±¡çš„å¼•ç”¨å…³ç³»ï¼Œå¢åŠ äº†GCè´Ÿæ‹…</p>\n<h2 id=\"Goçš„GC\"><a href=\"#Goçš„GC\" class=\"headerlink\" title=\"Goçš„GC\"></a>Goçš„GC</h2><h3 id=\"æ ‡è®°æ¸…é™¤æ³•çš„ç“¶é¢ˆ\"><a href=\"#æ ‡è®°æ¸…é™¤æ³•çš„ç“¶é¢ˆ\" class=\"headerlink\" title=\"æ ‡è®°æ¸…é™¤æ³•çš„ç“¶é¢ˆ\"></a>æ ‡è®°æ¸…é™¤æ³•çš„ç“¶é¢ˆ</h3><p>æ ‡è®°æ¸…é™¤æ³•åœ¨GCä¹‹å‰éœ€è¦STWï¼Œå³æš‚åœè¿™ä¸ªåº”ç”¨ç¨‹åºï¼Œå¦åˆ™ä¼šå¯¼è‡´é”™è¯¯åœ°åˆ é™¤è¢«å¼•ç”¨çš„å¯¹è±¡ã€‚ä½†STWä¼šç»™å¼•ç”¨æ€§èƒ½å¸¦æ¥æå¤§çš„æŸè€—</p>\n<p>æ˜¯ä»€ä¹ˆï¼Œæœ‰ä»€ä¹ˆä¼˜åŠ¿ï¼Œå®é™…æƒ…å†µï¼Œç‰¹æ®Šæ€§ï¼Œä¸é€‚ç”¨</p>\n","excerpt":"","more":"<h2 id=\"GCæ˜¯ä»€ä¹ˆï¼Ÿ\"><a href=\"#GCæ˜¯ä»€ä¹ˆï¼Ÿ\" class=\"headerlink\" title=\"GCæ˜¯ä»€ä¹ˆï¼Ÿ\"></a>GCæ˜¯ä»€ä¹ˆï¼Ÿ</h2><p>GCï¼ˆGarbage Collectionï¼‰å³åƒåœ¾å›æ”¶ï¼Œå®è´¨ä¸Šå°±æ˜¯å›æ”¶åƒåœ¾å†…å­˜ã€‚ç”±äºæ ˆä¸Šçš„å†…å­˜æ˜¯æœ‰ç¼–è¯‘å™¨åˆ†é…å’Œé‡Šæ”¾çš„ï¼Œæ‰€ä»¥GCéƒ½æ˜¯å¯¹å †ä¸Šä¸å†ä½¿ç”¨çš„å†…å­˜è¿›è¡Œå›æ”¶ï¼Œè®©è¿™äº›å†…å­˜èƒ½å¤Ÿå†æ¬¡è¢«åˆ©ç”¨</p>\n<h2 id=\"ä¸ºä»€ä¹ˆéœ€è¦GCï¼Ÿ\"><a href=\"#ä¸ºä»€ä¹ˆéœ€è¦GCï¼Ÿ\" class=\"headerlink\" title=\"ä¸ºä»€ä¹ˆéœ€è¦GCï¼Ÿ\"></a>ä¸ºä»€ä¹ˆéœ€è¦GCï¼Ÿ</h2><p>åœ¨çœŸå®ä¸šåŠ¡åœºæ™¯ä¸­ï¼Œå¯¹è±¡ä¸ªæ•°éå¸¸å¤šï¼Œå¼•ç”¨å…³ç³»é”™ç»¼å¤æ‚ï¼Œå¦‚æœå…¨é ç¨‹åºå‘˜æ‰‹åŠ¨é‡Šæ”¾å†…å­˜å¾ˆéš¾é¿å…æŒ‡é’ˆæ‚¬æŒ‚é”™è¯¯ã€‚æ‰€ä»¥ä¸€é—¨æ‹¥æœ‰è‡ªåŠ¨è¯†åˆ«å¹¶å›æ”¶åƒåœ¾å†…å­˜çš„è¯­è¨€ï¼ˆå¦‚Javaã€Pythonã€Goï¼‰åœ¨å¼€å‘æ•ˆç‡ä¸Šæ˜¯è¿œè¿œé«˜äºæ²¡æœ‰GCæœºåˆ¶çš„è¯­è¨€çš„</p>\n<h2 id=\"å¸¸è§çš„GCç®—æ³•\"><a href=\"#å¸¸è§çš„GCç®—æ³•\" class=\"headerlink\" title=\"å¸¸è§çš„GCç®—æ³•\"></a>å¸¸è§çš„GCç®—æ³•</h2><h3 id=\"å¼•ç”¨è®¡æ•°æ³•\"><a href=\"#å¼•ç”¨è®¡æ•°æ³•\" class=\"headerlink\" title=\"å¼•ç”¨è®¡æ•°æ³•\"></a>å¼•ç”¨è®¡æ•°æ³•</h3><p>å¼•ç”¨è®¡æ•°æ³•ä¼šä¸ºæ¯ä¸€ä¸ªå¯¹è±¡åˆ†é…ä¸€ä¸ªç©ºé—´ï¼ˆâ€œè®¡æ•°å™¨â€ï¼‰ï¼Œè¿™ä¸ªç©ºé—´ä¸“é—¨ç”¨æ¥å­˜å‚¨å¯¹è±¡è¢«å¼•ç”¨çš„æ¬¡æ•°ã€‚å¦‚æœæœ‰å…¶ä»–å…¶ä»–å¯¹è±¡å¼•ç”¨Aå¯¹è±¡ï¼Œé‚£ä¹ˆAå¯¹è±¡çš„è®¡æ•°å™¨å°±ä¼š+1ï¼›åä¹‹ï¼Œå¼•ç”¨Açš„å¯¹è±¡åˆ é™¤å¯¹Açš„å¼•ç”¨åï¼ŒAçš„è®¡æ•°å™¨ä¾¿ä¼š-1ï¼Œå½“è®¡æ•°å™¨å‡è‡³0æ—¶ï¼Œè¯¥å¯¹è±¡çš„å†…å­˜ç©ºé—´å°±ä¼šè¢«å›æ”¶<br><img src=\"https://raw.githubusercontent.com/lyydsheep/pic/main/202412252008887.png\" alt=\"image.png\"></p>\n<ul>\n<li>ä¼˜ç‚¹ï¼šç®€å•ç›´æ¥ï¼Œå›æ”¶é€Ÿåº¦å¿«ï¼Œä¸ä¼šå‡ºç°å†…å­˜è€—å°½æˆ–è¾¾åˆ°é˜ˆå€¼æ‰è¿›è¡Œå›æ”¶çš„ç°è±¡</li>\n<li>ç¼ºç‚¹ï¼š<ul>\n<li>éœ€è¦é¢å¤–ç©ºé—´ç»´æŠ¤å¯¹è±¡çš„â€œå¼•ç”¨â€</li>\n<li>æ— æ³•è§£å†³å¾ªç¯å¼•ç”¨é—®é¢˜</li>\n</ul>\n</li>\n</ul>\n<h3 id=\"æ ‡è®°æ¸…é™¤æ³•\"><a href=\"#æ ‡è®°æ¸…é™¤æ³•\" class=\"headerlink\" title=\"æ ‡è®°æ¸…é™¤æ³•\"></a>æ ‡è®°æ¸…é™¤æ³•</h3><p>æ ‡è®°æ¸…é™¤æ³•å¯ä»¥åˆ†ä¸ºä¸¤æ­¥ï¼š</p>\n<ul>\n<li><p>æ ‡è®°å¯¹è±¡ï¼šä»æ ¹å¯¹è±¡å¼€å§‹ï¼Œéå†æ‰€æœ‰çš„å¯¹è±¡åŠå…¶å­å¯¹è±¡ï¼Œå¹¶æ ‡è®°å®ƒä»¬çš„å¯è¾¾çŠ¶æ€</p>\n</li>\n<li><p>æ¸…é™¤å¯¹è±¡ï¼šå†ä¸€æ¬¡éå†å †ä¸­ä¸­æ‰€æœ‰çš„å¯¹è±¡ï¼Œå°†æ²¡æœ‰è¢«æ ‡è®°çš„å¯¹è±¡åˆ é™¤<br><img src=\"https://raw.githubusercontent.com/lyydsheep/pic/main/202412252008711.png\" alt=\"image.png\"></p>\n</li>\n<li><p>ä¼˜ç‚¹ï¼šç®€å•æ˜“å®ç°ï¼Œä¸éœ€è¦é¢å¤–çš„å­˜å‚¨ç©ºé—´ï¼Œé€‚ç”¨äºå¯¹è±¡ä¸ªæ•°å°‘çš„åœºæ™¯</p>\n</li>\n<li><p>ç¼ºç‚¹ï¼šä¼šé€ æˆå†…å­˜ç¢ç‰‡ï¼Œå¯¼è‡´åç»­åˆ›å»ºå¤§å¯¹è±¡æ—¶ï¼Œå³ä½¿æœ‰è¶³å¤Ÿçš„å†…å­˜ç©ºé—´ä¹Ÿå¯èƒ½æ— æ³•æˆåŠŸåˆ›å»ºï¼Œé™ä½äº†å†…å­˜çš„ä½¿ç”¨ç‡</p>\n</li>\n</ul>\n<h3 id=\"å¤åˆ¶æ³•\"><a href=\"#å¤åˆ¶æ³•\" class=\"headerlink\" title=\"å¤åˆ¶æ³•\"></a>å¤åˆ¶æ³•</h3><p>å¤åˆ¶æ³•å°†å†…å­˜åˆ†ä¸ºå¤§å°ç›¸ç­‰çš„ä¸¤å—åŒºåŸŸï¼Œæ¯ä¸€æ—¶åˆ»åªèƒ½ä½¿ç”¨å…¶ä¸­çš„ä¸€å—å†…å­˜ã€‚å½“ä¸€å—åŒºåŸŸçš„å†…å­˜è¢«ç”¨å®Œæ—¶ï¼Œå°±éœ€è¦æŠŠè¯¥åŒºåŸŸè¿˜åœ¨ä½¿ç”¨çš„å¯¹è±¡ç§»åŠ¨åˆ°å¦ä¸€å—åŒºåŸŸï¼ŒåŒæ—¶å°†å·²ä½¿ç”¨çš„å†…å­˜å…¨éƒ¨æ¸…é™¤<br><img src=\"https://raw.githubusercontent.com/lyydsheep/pic/main/202412252008571.png\" alt=\"image.png\"></p>\n<ul>\n<li>ä¼˜ç‚¹ï¼šä¸ä¼šäº§ç”Ÿå†…å­˜ç¢ç‰‡ï¼Œæ¯æ¬¡éƒ½æ˜¯æ¸…é™¤æ•´å—å†…å­˜</li>\n<li>ç¼ºç‚¹ï¼šå†…å­˜è¢«ä¸€åˆ†ä¸ºäºŒï¼Œåˆ©ç”¨ç‡ä½ï¼Œå¦‚æœå¯¹è±¡ä¸ªæ•°è¾ƒå¤šï¼Œå¤åˆ¶å¯¹è±¡çš„è¿‡ç¨‹è€—æ—¶é•¿ï¼Œæ•ˆç‡ä½ä¸‹</li>\n</ul>\n<h3 id=\"æ ‡è®°æ•´ç†æ³•\"><a href=\"#æ ‡è®°æ•´ç†æ³•\" class=\"headerlink\" title=\"æ ‡è®°æ•´ç†æ³•\"></a>æ ‡è®°æ•´ç†æ³•</h3><p>æ ‡è®°æ•´ç†æ³•å’Œæ ‡è®°æ¸…é™¤æ³•ç±»ä¼¼ï¼ŒåŒæ ·æ˜¯éœ€è¦ä¸¤é˜¶æ®µå®ŒæˆGCæ“ä½œ</p>\n<ul>\n<li>æ ‡è®°é˜¶æ®µï¼šä»GCçš„æ ¹èŠ‚ç‚¹éå†æ‰€æœ‰çš„å¯¹è±¡ï¼ŒæŠŠè¿˜åœ¨ä½¿ç”¨çš„å¯¹è±¡æ ‡è®°</li>\n<li>æ•´ç†é˜¶æ®µï¼šæ‰€æœ‰å­˜æ´»çš„å¯¹è±¡è¢«ç§»åŠ¨åˆ°ç©ºé—²å†…å­˜çš„ä¸€ç«¯ï¼ŒæŒ‰ç…§åœ°å€é¡ºåºæ’åˆ—ï¼Œå¹¶æ›´æ–°å¯¹è±¡å¼•ç”¨æŒ‡é’ˆã€‚æœ€åå°†æœ«ç«¯åœ°å€ä¹‹å¤–çš„å†…å­˜ç©ºé—´æ¸…é™¤<br><img src=\"https://raw.githubusercontent.com/lyydsheep/pic/main/202412260904789.png\" alt=\"image.png\"></li>\n</ul>\n<h2 id=\"Goè¯­è¨€çš„GCç®—æ³•\"><a href=\"#Goè¯­è¨€çš„GCç®—æ³•\" class=\"headerlink\" title=\"Goè¯­è¨€çš„GCç®—æ³•\"></a>Goè¯­è¨€çš„GCç®—æ³•</h2><p>Goè¯­è¨€çš„GCé‡‡ç”¨çš„æ˜¯å¹¶å‘ä¸‰è‰²æ ‡è®°æ³• + å±éšœæŠ€æœ¯å®ç°çš„ã€‚ä¸‰è‰²æ ‡è®°æ³•æœ¬è´¨å°±æ˜¯æ ‡è®°æ¸…ç†ç®—æ³•ï¼Œå¹¶æ²¡æœ‰å¯¹è±¡åˆ†ä»£ã€å†…å­˜æ•´ç†çš„è¡Œä¸ºï¼Œä¸‰è‰²æ ‡è®°åªæ˜¯å¯¹å…¶æ ‡è®°é˜¶æ®µçš„ä¸€ç§ç®€å•æè¿°ã€‚</p>\n<h3 id=\"ä¸ºä»€ä¹ˆä¸éœ€è¦å†…å­˜æ•´ç†ï¼ˆä¸ºä»€ä¹ˆä¸é‡‡ç”¨æ ‡è®°æ•´ç†ç®—æ³•æˆ–å¤åˆ¶ç®—æ³•-ï¼‰ï¼Ÿ\"><a href=\"#ä¸ºä»€ä¹ˆä¸éœ€è¦å†…å­˜æ•´ç†ï¼ˆä¸ºä»€ä¹ˆä¸é‡‡ç”¨æ ‡è®°æ•´ç†ç®—æ³•æˆ–å¤åˆ¶ç®—æ³•-ï¼‰ï¼Ÿ\" class=\"headerlink\" title=\"ä¸ºä»€ä¹ˆä¸éœ€è¦å†…å­˜æ•´ç†ï¼ˆä¸ºä»€ä¹ˆä¸é‡‡ç”¨æ ‡è®°æ•´ç†ç®—æ³•æˆ–å¤åˆ¶ç®—æ³• ï¼‰ï¼Ÿ\"></a>ä¸ºä»€ä¹ˆä¸éœ€è¦å†…å­˜æ•´ç†ï¼ˆä¸ºä»€ä¹ˆä¸é‡‡ç”¨æ ‡è®°æ•´ç†ç®—æ³•æˆ–å¤åˆ¶ç®—æ³• ï¼‰ï¼Ÿ</h3><p>Goè¯­è¨€çš„å†…å­˜åˆ†é…ç®—æ³•æ˜¯åŸºäºTCMallocï¼Œè™½ç„¶ä¸èƒ½åƒæ ‡è®°æ•´ç†æ³•&#x2F;å¤åˆ¶æ³•æ¶ˆé™¤å†…å­˜ç¢ç‰‡ï¼Œä½†ä¹Ÿèƒ½æœ‰æ•ˆçš„é™ä½å†…å­˜ç¢ç‰‡ç‡ã€‚æ­¤å¤–ï¼ŒThread Cacheæœºåˆ¶ä½¿å¾—Goåœ¨å¤§éƒ¨åˆ†åˆ†é…åœºæ™¯ä¸‹å¯ä»¥é¿å…ä½¿ç”¨é”ï¼Œåœ¨é«˜å¹¶å‘ç¯å¢ƒä¸‹å…·æœ‰æä½³çš„æ€§èƒ½ä¼˜åŠ¿</p>\n<h3 id=\"ä¸ºä»€ä¹ˆä¸é‡‡ç”¨åˆ†ä»£æ³•ï¼Ÿ\"><a href=\"#ä¸ºä»€ä¹ˆä¸é‡‡ç”¨åˆ†ä»£æ³•ï¼Ÿ\" class=\"headerlink\" title=\"ä¸ºä»€ä¹ˆä¸é‡‡ç”¨åˆ†ä»£æ³•ï¼Ÿ\"></a>ä¸ºä»€ä¹ˆä¸é‡‡ç”¨åˆ†ä»£æ³•ï¼Ÿ</h3><p>åˆ†ä»£æ³•çš„æœ€å¤§ä¼˜åŠ¿å°±æ˜¯åŒºåˆ†é•¿ç”Ÿå‘½å‘¨æœŸå’ŒçŸ­ç”Ÿå‘½å‘¨æœŸçš„å¯¹è±¡ï¼Œä»è€Œå¿«é€Ÿå›æ”¶æ®µç”Ÿå‘½å‘¨æœŸå¯¹è±¡ã€‚ä½†Goè¯­è¨€åœ¨ç¼–è¯‘æœŸä¼šåšé€ƒé€¸åˆ†æï¼Œå¯ä»¥å°†çŸ­ç”Ÿå‘½å‘¨æœŸçš„structåˆ†é…åˆ°æ ˆä¸Šï¼Œè€ƒè™‘åˆ°ä¸€æ–¹é¢æ ˆä¸Šçš„å†…å­˜å›æ”¶æ˜¯éå¸¸å¿«çš„ï¼Œå¦ä¸€æ–¹é¢åœ¨Goä¸­çŸ­ç”Ÿå‘½å‘¨æœŸå¯¹è±¡ä¸ªæ•°å¹¶ä¸å¤šï¼Œæ‰€ä»¥åˆ†ä»£æ³•åœ¨Goä¸­ä¼˜åŠ¿å¹¶ä¸æ˜æ˜¾ã€‚ç›¸ååœ°ï¼Œåˆ†ä»£æ³•éœ€è¦é¢å¤–çš„å±éšœæ¥ç»´æŠ¤è€å¹´ä»£å¯¹è±¡å¯¹æ–°å¹´ä»£å¯¹è±¡çš„å¼•ç”¨å…³ç³»ï¼Œå¢åŠ äº†GCè´Ÿæ‹…</p>\n<h2 id=\"Goçš„GC\"><a href=\"#Goçš„GC\" class=\"headerlink\" title=\"Goçš„GC\"></a>Goçš„GC</h2><h3 id=\"æ ‡è®°æ¸…é™¤æ³•çš„ç“¶é¢ˆ\"><a href=\"#æ ‡è®°æ¸…é™¤æ³•çš„ç“¶é¢ˆ\" class=\"headerlink\" title=\"æ ‡è®°æ¸…é™¤æ³•çš„ç“¶é¢ˆ\"></a>æ ‡è®°æ¸…é™¤æ³•çš„ç“¶é¢ˆ</h3><p>æ ‡è®°æ¸…é™¤æ³•åœ¨GCä¹‹å‰éœ€è¦STWï¼Œå³æš‚åœè¿™ä¸ªåº”ç”¨ç¨‹åºï¼Œå¦åˆ™ä¼šå¯¼è‡´é”™è¯¯åœ°åˆ é™¤è¢«å¼•ç”¨çš„å¯¹è±¡ã€‚ä½†STWä¼šç»™å¼•ç”¨æ€§èƒ½å¸¦æ¥æå¤§çš„æŸè€—</p>\n<p>æ˜¯ä»€ä¹ˆï¼Œæœ‰ä»€ä¹ˆä¼˜åŠ¿ï¼Œå®é™…æƒ…å†µï¼Œç‰¹æ®Šæ€§ï¼Œä¸é€‚ç”¨</p>\n"},{"description":"è®°å½•go:embedçš„ä¸€äº›ä½¿ç”¨æ–¹æ³•","_content":"\n\n\n# embedä½¿ç”¨\n\n## èƒŒæ™¯\n\nå¯¹äºä¸€ä¸ªGoé¡¹ç›®ï¼Œæˆ‘ä»¬ä¸€èˆ¬å°†ä»£ç ç¼–è¯‘æˆå‡ºæ¥çš„äºŒè¿›åˆ¶å¯æ‰§è¡Œæ–‡ä»¶ï¼Œè¿™ä¸ªæ–‡ä»¶éå¸¸é€‚åˆå¤åˆ¶å’Œéƒ¨ç½²ã€‚ä½†åœ¨å®é™…ä½¿ç”¨ä¸­ï¼Œé™¤äº†ä»£ç ï¼Œä¸€äº›**é…ç½®æ–‡ä»¶æˆ–è€…é™æ€æ–‡ä»¶**ä¹Ÿéœ€è¦ä¸€åŒæ‰“åŒ…è‡³äºŒè¿›åˆ¶æ–‡ä»¶ä¸­ã€‚\n\n## åµŒå…¥\n\nåµŒå…¥çš„å†…å®¹æ—¶åªè¯»çš„ï¼Œä¹Ÿå°±æ˜¯è¯´ï¼ŒåµŒå…¥å†…å®¹åœ¨ç¼–è¯‘æœŸå°±å®šæ­»å¹¶ä¸”æ˜¯å¹¶å‘å®‰å…¨çš„\n\nğŸŒ°ï¼šå½“å‰æœ‰ä¸€ä¸ªtxtæ–‡ä»¶ï¼Œå…·ä½“å†…å®¹ä¸º`Hello World!`\n\n### åµŒå…¥ä¸ºå­—ç¬¦ä¸²\n\n```go\n//go:embed hello.txt\nvar s string\n\nfunc TestEmbed(t *testing.T) {\n\tfmt.Println(s)\n}\n```\n\n### åµŒå…¥ä¸ºå­—èŠ‚åˆ‡ç‰‡\n\n```go\n//go:embed hello.txt\nvar s []byte\n\nfunc TestEmbed(t *testing.T) {\n\tfmt.Println(s)\n}\n```\n\n### åµŒå…¥ä¸ºæ–‡ä»¶ç³»ç»Ÿ\n\nå½“éœ€è¦ä¸€æ¬¡æ€§åµŒå…¥å¤šä¸ªæ–‡ä»¶æ—¶ï¼Œé€‰æ‹©æ–‡ä»¶ç³»ç»Ÿä½œä¸ºåµŒå…¥çš„ç±»å‹æœ‰åŠ©äºæˆ‘ä»¬é«˜æ•ˆç®¡ç†åµŒå…¥çš„å¤šä¸ªæ–‡ä»¶\n\n```go\n//go:embed *.txt\n// åŒ¹é…å¤šä¸ªæ–‡ä»¶\nvar fs embed.FS\n\nfunc TestEmbed(t *testing.T) {\n\tfb1, _ := fs.ReadFile(\"hello.txt\")\n\tfb2, _ := fs.ReadFile(\"hello2.txt\")\n\tfmt.Println(fb1)\n\tfmt.Println(fb2)\n}\n```\n\n### å‡ ç§go:embedå†™æ³•\n\n```go\n//go:embed hello.txt hello2.txt\nvar fs embed.FS\n\n\n//go:embed hello.txt\n//go:embed hello2.txt\nvar fs embed.FS\n\n//go:embed p\nvar fs embed.FS // pæ˜¯ä¸€ä¸ªå­ç›®å½•\n\n//go:embed *.txt\nvar fs embed.FS // åŒ¹é…æ¨¡å¼\n```\n\n\n\n","source":"_posts/Go/Go embedä½¿ç”¨.md","raw":"---\ndescription: è®°å½•go:embedçš„ä¸€äº›ä½¿ç”¨æ–¹æ³•\ntag: Go\n---\n\n\n\n# embedä½¿ç”¨\n\n## èƒŒæ™¯\n\nå¯¹äºä¸€ä¸ªGoé¡¹ç›®ï¼Œæˆ‘ä»¬ä¸€èˆ¬å°†ä»£ç ç¼–è¯‘æˆå‡ºæ¥çš„äºŒè¿›åˆ¶å¯æ‰§è¡Œæ–‡ä»¶ï¼Œè¿™ä¸ªæ–‡ä»¶éå¸¸é€‚åˆå¤åˆ¶å’Œéƒ¨ç½²ã€‚ä½†åœ¨å®é™…ä½¿ç”¨ä¸­ï¼Œé™¤äº†ä»£ç ï¼Œä¸€äº›**é…ç½®æ–‡ä»¶æˆ–è€…é™æ€æ–‡ä»¶**ä¹Ÿéœ€è¦ä¸€åŒæ‰“åŒ…è‡³äºŒè¿›åˆ¶æ–‡ä»¶ä¸­ã€‚\n\n## åµŒå…¥\n\nåµŒå…¥çš„å†…å®¹æ—¶åªè¯»çš„ï¼Œä¹Ÿå°±æ˜¯è¯´ï¼ŒåµŒå…¥å†…å®¹åœ¨ç¼–è¯‘æœŸå°±å®šæ­»å¹¶ä¸”æ˜¯å¹¶å‘å®‰å…¨çš„\n\nğŸŒ°ï¼šå½“å‰æœ‰ä¸€ä¸ªtxtæ–‡ä»¶ï¼Œå…·ä½“å†…å®¹ä¸º`Hello World!`\n\n### åµŒå…¥ä¸ºå­—ç¬¦ä¸²\n\n```go\n//go:embed hello.txt\nvar s string\n\nfunc TestEmbed(t *testing.T) {\n\tfmt.Println(s)\n}\n```\n\n### åµŒå…¥ä¸ºå­—èŠ‚åˆ‡ç‰‡\n\n```go\n//go:embed hello.txt\nvar s []byte\n\nfunc TestEmbed(t *testing.T) {\n\tfmt.Println(s)\n}\n```\n\n### åµŒå…¥ä¸ºæ–‡ä»¶ç³»ç»Ÿ\n\nå½“éœ€è¦ä¸€æ¬¡æ€§åµŒå…¥å¤šä¸ªæ–‡ä»¶æ—¶ï¼Œé€‰æ‹©æ–‡ä»¶ç³»ç»Ÿä½œä¸ºåµŒå…¥çš„ç±»å‹æœ‰åŠ©äºæˆ‘ä»¬é«˜æ•ˆç®¡ç†åµŒå…¥çš„å¤šä¸ªæ–‡ä»¶\n\n```go\n//go:embed *.txt\n// åŒ¹é…å¤šä¸ªæ–‡ä»¶\nvar fs embed.FS\n\nfunc TestEmbed(t *testing.T) {\n\tfb1, _ := fs.ReadFile(\"hello.txt\")\n\tfb2, _ := fs.ReadFile(\"hello2.txt\")\n\tfmt.Println(fb1)\n\tfmt.Println(fb2)\n}\n```\n\n### å‡ ç§go:embedå†™æ³•\n\n```go\n//go:embed hello.txt hello2.txt\nvar fs embed.FS\n\n\n//go:embed hello.txt\n//go:embed hello2.txt\nvar fs embed.FS\n\n//go:embed p\nvar fs embed.FS // pæ˜¯ä¸€ä¸ªå­ç›®å½•\n\n//go:embed *.txt\nvar fs embed.FS // åŒ¹é…æ¨¡å¼\n```\n\n\n\n","slug":"Go/Go embedä½¿ç”¨","published":1,"date":"2024-12-27T11:03:15.342Z","updated":"2024-12-27T11:03:15.342Z","title":"","comments":1,"layout":"post","photos":[],"_id":"cm6c7md6m001ra5t24ban8agk","content":"<h1 id=\"embedä½¿ç”¨\"><a href=\"#embedä½¿ç”¨\" class=\"headerlink\" title=\"embedä½¿ç”¨\"></a>embedä½¿ç”¨</h1><h2 id=\"èƒŒæ™¯\"><a href=\"#èƒŒæ™¯\" class=\"headerlink\" title=\"èƒŒæ™¯\"></a>èƒŒæ™¯</h2><p>å¯¹äºä¸€ä¸ªGoé¡¹ç›®ï¼Œæˆ‘ä»¬ä¸€èˆ¬å°†ä»£ç ç¼–è¯‘æˆå‡ºæ¥çš„äºŒè¿›åˆ¶å¯æ‰§è¡Œæ–‡ä»¶ï¼Œè¿™ä¸ªæ–‡ä»¶éå¸¸é€‚åˆå¤åˆ¶å’Œéƒ¨ç½²ã€‚ä½†åœ¨å®é™…ä½¿ç”¨ä¸­ï¼Œé™¤äº†ä»£ç ï¼Œä¸€äº›<strong>é…ç½®æ–‡ä»¶æˆ–è€…é™æ€æ–‡ä»¶</strong>ä¹Ÿéœ€è¦ä¸€åŒæ‰“åŒ…è‡³äºŒè¿›åˆ¶æ–‡ä»¶ä¸­ã€‚</p>\n<h2 id=\"åµŒå…¥\"><a href=\"#åµŒå…¥\" class=\"headerlink\" title=\"åµŒå…¥\"></a>åµŒå…¥</h2><p>åµŒå…¥çš„å†…å®¹æ—¶åªè¯»çš„ï¼Œä¹Ÿå°±æ˜¯è¯´ï¼ŒåµŒå…¥å†…å®¹åœ¨ç¼–è¯‘æœŸå°±å®šæ­»å¹¶ä¸”æ˜¯å¹¶å‘å®‰å…¨çš„</p>\n<p>ğŸŒ°ï¼šå½“å‰æœ‰ä¸€ä¸ªtxtæ–‡ä»¶ï¼Œå…·ä½“å†…å®¹ä¸º<code>Hello World!</code></p>\n<h3 id=\"åµŒå…¥ä¸ºå­—ç¬¦ä¸²\"><a href=\"#åµŒå…¥ä¸ºå­—ç¬¦ä¸²\" class=\"headerlink\" title=\"åµŒå…¥ä¸ºå­—ç¬¦ä¸²\"></a>åµŒå…¥ä¸ºå­—ç¬¦ä¸²</h3><figure class=\"highlight go\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\">//go:embed hello.txt</span></span><br><span class=\"line\"><span class=\"keyword\">var</span> s <span class=\"type\">string</span></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"function\"><span class=\"keyword\">func</span> <span class=\"title\">TestEmbed</span><span class=\"params\">(t *testing.T)</span></span> &#123;</span><br><span class=\"line\">\tfmt.Println(s)</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n\n<h3 id=\"åµŒå…¥ä¸ºå­—èŠ‚åˆ‡ç‰‡\"><a href=\"#åµŒå…¥ä¸ºå­—èŠ‚åˆ‡ç‰‡\" class=\"headerlink\" title=\"åµŒå…¥ä¸ºå­—èŠ‚åˆ‡ç‰‡\"></a>åµŒå…¥ä¸ºå­—èŠ‚åˆ‡ç‰‡</h3><figure class=\"highlight go\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\">//go:embed hello.txt</span></span><br><span class=\"line\"><span class=\"keyword\">var</span> s []<span class=\"type\">byte</span></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"function\"><span class=\"keyword\">func</span> <span class=\"title\">TestEmbed</span><span class=\"params\">(t *testing.T)</span></span> &#123;</span><br><span class=\"line\">\tfmt.Println(s)</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n\n<h3 id=\"åµŒå…¥ä¸ºæ–‡ä»¶ç³»ç»Ÿ\"><a href=\"#åµŒå…¥ä¸ºæ–‡ä»¶ç³»ç»Ÿ\" class=\"headerlink\" title=\"åµŒå…¥ä¸ºæ–‡ä»¶ç³»ç»Ÿ\"></a>åµŒå…¥ä¸ºæ–‡ä»¶ç³»ç»Ÿ</h3><p>å½“éœ€è¦ä¸€æ¬¡æ€§åµŒå…¥å¤šä¸ªæ–‡ä»¶æ—¶ï¼Œé€‰æ‹©æ–‡ä»¶ç³»ç»Ÿä½œä¸ºåµŒå…¥çš„ç±»å‹æœ‰åŠ©äºæˆ‘ä»¬é«˜æ•ˆç®¡ç†åµŒå…¥çš„å¤šä¸ªæ–‡ä»¶</p>\n<figure class=\"highlight go\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\">//go:embed *.txt</span></span><br><span class=\"line\"><span class=\"comment\">// åŒ¹é…å¤šä¸ªæ–‡ä»¶</span></span><br><span class=\"line\"><span class=\"keyword\">var</span> fs embed.FS</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"function\"><span class=\"keyword\">func</span> <span class=\"title\">TestEmbed</span><span class=\"params\">(t *testing.T)</span></span> &#123;</span><br><span class=\"line\">\tfb1, _ := fs.ReadFile(<span class=\"string\">&quot;hello.txt&quot;</span>)</span><br><span class=\"line\">\tfb2, _ := fs.ReadFile(<span class=\"string\">&quot;hello2.txt&quot;</span>)</span><br><span class=\"line\">\tfmt.Println(fb1)</span><br><span class=\"line\">\tfmt.Println(fb2)</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n\n<h3 id=\"å‡ ç§go-embedå†™æ³•\"><a href=\"#å‡ ç§go-embedå†™æ³•\" class=\"headerlink\" title=\"å‡ ç§go:embedå†™æ³•\"></a>å‡ ç§go:embedå†™æ³•</h3><figure class=\"highlight go\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\">//go:embed hello.txt hello2.txt</span></span><br><span class=\"line\"><span class=\"keyword\">var</span> fs embed.FS</span><br><span class=\"line\"></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\">//go:embed hello.txt</span></span><br><span class=\"line\"><span class=\"comment\">//go:embed hello2.txt</span></span><br><span class=\"line\"><span class=\"keyword\">var</span> fs embed.FS</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\">//go:embed p</span></span><br><span class=\"line\"><span class=\"keyword\">var</span> fs embed.FS <span class=\"comment\">// pæ˜¯ä¸€ä¸ªå­ç›®å½•</span></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\">//go:embed *.txt</span></span><br><span class=\"line\"><span class=\"keyword\">var</span> fs embed.FS <span class=\"comment\">// åŒ¹é…æ¨¡å¼</span></span><br></pre></td></tr></table></figure>\n\n\n\n","excerpt":"","more":"<h1 id=\"embedä½¿ç”¨\"><a href=\"#embedä½¿ç”¨\" class=\"headerlink\" title=\"embedä½¿ç”¨\"></a>embedä½¿ç”¨</h1><h2 id=\"èƒŒæ™¯\"><a href=\"#èƒŒæ™¯\" class=\"headerlink\" title=\"èƒŒæ™¯\"></a>èƒŒæ™¯</h2><p>å¯¹äºä¸€ä¸ªGoé¡¹ç›®ï¼Œæˆ‘ä»¬ä¸€èˆ¬å°†ä»£ç ç¼–è¯‘æˆå‡ºæ¥çš„äºŒè¿›åˆ¶å¯æ‰§è¡Œæ–‡ä»¶ï¼Œè¿™ä¸ªæ–‡ä»¶éå¸¸é€‚åˆå¤åˆ¶å’Œéƒ¨ç½²ã€‚ä½†åœ¨å®é™…ä½¿ç”¨ä¸­ï¼Œé™¤äº†ä»£ç ï¼Œä¸€äº›<strong>é…ç½®æ–‡ä»¶æˆ–è€…é™æ€æ–‡ä»¶</strong>ä¹Ÿéœ€è¦ä¸€åŒæ‰“åŒ…è‡³äºŒè¿›åˆ¶æ–‡ä»¶ä¸­ã€‚</p>\n<h2 id=\"åµŒå…¥\"><a href=\"#åµŒå…¥\" class=\"headerlink\" title=\"åµŒå…¥\"></a>åµŒå…¥</h2><p>åµŒå…¥çš„å†…å®¹æ—¶åªè¯»çš„ï¼Œä¹Ÿå°±æ˜¯è¯´ï¼ŒåµŒå…¥å†…å®¹åœ¨ç¼–è¯‘æœŸå°±å®šæ­»å¹¶ä¸”æ˜¯å¹¶å‘å®‰å…¨çš„</p>\n<p>ğŸŒ°ï¼šå½“å‰æœ‰ä¸€ä¸ªtxtæ–‡ä»¶ï¼Œå…·ä½“å†…å®¹ä¸º<code>Hello World!</code></p>\n<h3 id=\"åµŒå…¥ä¸ºå­—ç¬¦ä¸²\"><a href=\"#åµŒå…¥ä¸ºå­—ç¬¦ä¸²\" class=\"headerlink\" title=\"åµŒå…¥ä¸ºå­—ç¬¦ä¸²\"></a>åµŒå…¥ä¸ºå­—ç¬¦ä¸²</h3><figure class=\"highlight go\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\">//go:embed hello.txt</span></span><br><span class=\"line\"><span class=\"keyword\">var</span> s <span class=\"type\">string</span></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"function\"><span class=\"keyword\">func</span> <span class=\"title\">TestEmbed</span><span class=\"params\">(t *testing.T)</span></span> &#123;</span><br><span class=\"line\">\tfmt.Println(s)</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n\n<h3 id=\"åµŒå…¥ä¸ºå­—èŠ‚åˆ‡ç‰‡\"><a href=\"#åµŒå…¥ä¸ºå­—èŠ‚åˆ‡ç‰‡\" class=\"headerlink\" title=\"åµŒå…¥ä¸ºå­—èŠ‚åˆ‡ç‰‡\"></a>åµŒå…¥ä¸ºå­—èŠ‚åˆ‡ç‰‡</h3><figure class=\"highlight go\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\">//go:embed hello.txt</span></span><br><span class=\"line\"><span class=\"keyword\">var</span> s []<span class=\"type\">byte</span></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"function\"><span class=\"keyword\">func</span> <span class=\"title\">TestEmbed</span><span class=\"params\">(t *testing.T)</span></span> &#123;</span><br><span class=\"line\">\tfmt.Println(s)</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n\n<h3 id=\"åµŒå…¥ä¸ºæ–‡ä»¶ç³»ç»Ÿ\"><a href=\"#åµŒå…¥ä¸ºæ–‡ä»¶ç³»ç»Ÿ\" class=\"headerlink\" title=\"åµŒå…¥ä¸ºæ–‡ä»¶ç³»ç»Ÿ\"></a>åµŒå…¥ä¸ºæ–‡ä»¶ç³»ç»Ÿ</h3><p>å½“éœ€è¦ä¸€æ¬¡æ€§åµŒå…¥å¤šä¸ªæ–‡ä»¶æ—¶ï¼Œé€‰æ‹©æ–‡ä»¶ç³»ç»Ÿä½œä¸ºåµŒå…¥çš„ç±»å‹æœ‰åŠ©äºæˆ‘ä»¬é«˜æ•ˆç®¡ç†åµŒå…¥çš„å¤šä¸ªæ–‡ä»¶</p>\n<figure class=\"highlight go\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\">//go:embed *.txt</span></span><br><span class=\"line\"><span class=\"comment\">// åŒ¹é…å¤šä¸ªæ–‡ä»¶</span></span><br><span class=\"line\"><span class=\"keyword\">var</span> fs embed.FS</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"function\"><span class=\"keyword\">func</span> <span class=\"title\">TestEmbed</span><span class=\"params\">(t *testing.T)</span></span> &#123;</span><br><span class=\"line\">\tfb1, _ := fs.ReadFile(<span class=\"string\">&quot;hello.txt&quot;</span>)</span><br><span class=\"line\">\tfb2, _ := fs.ReadFile(<span class=\"string\">&quot;hello2.txt&quot;</span>)</span><br><span class=\"line\">\tfmt.Println(fb1)</span><br><span class=\"line\">\tfmt.Println(fb2)</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n\n<h3 id=\"å‡ ç§go-embedå†™æ³•\"><a href=\"#å‡ ç§go-embedå†™æ³•\" class=\"headerlink\" title=\"å‡ ç§go:embedå†™æ³•\"></a>å‡ ç§go:embedå†™æ³•</h3><figure class=\"highlight go\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\">//go:embed hello.txt hello2.txt</span></span><br><span class=\"line\"><span class=\"keyword\">var</span> fs embed.FS</span><br><span class=\"line\"></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\">//go:embed hello.txt</span></span><br><span class=\"line\"><span class=\"comment\">//go:embed hello2.txt</span></span><br><span class=\"line\"><span class=\"keyword\">var</span> fs embed.FS</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\">//go:embed p</span></span><br><span class=\"line\"><span class=\"keyword\">var</span> fs embed.FS <span class=\"comment\">// pæ˜¯ä¸€ä¸ªå­ç›®å½•</span></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\">//go:embed *.txt</span></span><br><span class=\"line\"><span class=\"keyword\">var</span> fs embed.FS <span class=\"comment\">// åŒ¹é…æ¨¡å¼</span></span><br></pre></td></tr></table></figure>\n\n\n\n"},{"_content":"[Golangæ·±å…¥ç†è§£GPMæ¨¡å‹](https://www.bilibili.com/video/BV19r4y1w7Nx/?spm_id_from=333.1387.homepage.video_card.click)å­¦ä¹ ç¬”è®°\n\nåç¨‹è°ƒåº¦å™¨çš„æ ¸å¿ƒä½œç”¨å°±æ˜¯å°†åç¨‹å…³è”åˆ°å†…æ ¸çº¿ç¨‹ï¼Œå†…æ ¸çº¿ç¨‹æ— éœ€åˆ‡æ¢å°±èƒ½æ‰§è¡Œç”¨æˆ·æ€ä¸­çš„ä¸åŒåŠŸèƒ½ï¼Œæé«˜äº†å¹¶å‘åº¦\n\n## GMPæ¨¡å‹\n\nGMPæ¨¡å‹è®¾è®¡å¸ƒå±€å¦‚ä¸‹å›¾æ‰€ç¤ºï¼š\n\n<img src=\"https://raw.githubusercontent.com/lyydsheep/pic/main/202412212114507.png\" style=\"zoom:80%\">\n\n- **G**ï¼šGoroutineï¼ŒGoåç¨‹\n- **P**ï¼šProcessorï¼Œé€»è¾‘å¤„ç†å™¨\n- **M**ï¼šMachineï¼Œç³»ç»Ÿçº§çº¿ç¨‹\n- **å…¨å±€é˜Ÿåˆ—**ï¼šå­˜æ”¾å¾…è°ƒåº¦çš„Goroutine\n- **æœ¬åœ°é˜Ÿåˆ—**ï¼šå­˜æ”¾æŸä¸€ä¸ªProcessorå³å°†è°ƒåº¦çš„Goroutine\n\t- ä¸€ä¸ªæœ¬åœ°é˜Ÿåˆ—ä¸­æœ€å¤šå®¹çº³256ä¸ªGoroutine\n\t- å½“åˆ›å»ºä¸€ä¸ªGoroutineæ—¶ï¼Œä¼šä¼˜å…ˆå°†Goroutineæ”¾åœ¨æœ¬åœ°é˜Ÿåˆ—ä¸­ã€‚å¦‚æœæ²¡æœ‰æœ¬åœ°é˜Ÿåˆ—å­˜åœ¨ç©ºé—²ç©ºé—´ï¼Œé‚£ä¹ˆæ–°åˆ›å»ºçš„Goroutineå°±ä¼šè¢«æ”¾å…¥å…¨å±€é˜Ÿåˆ—\n- **GOMAXPROCS**ï¼šé…ç½®é€»è¾‘å¤„ç†å™¨ä¸ªæ•°çš„å‚æ•°ï¼Œå†³å®šäº†Goroutineçš„**å¹¶è¡Œ**èƒ½åŠ›\n\t- å¯é€šè¿‡ç¯å¢ƒå˜é‡`$GOMAXPROCS`è®¾ç½®\n\t- æˆ–è€…åœ¨ç¨‹åºä¸­é€šè¿‡`runtime.GOMAXPROCS()`æ¥è®¾ç½®\n\n## è°ƒåº¦å™¨çš„è®¾è®¡ç­–ç•¥\n\n- **å¤ç”¨çº¿ç¨‹**ï¼šé¿å…é¢‘ç¹åˆ›å»ºã€é”€æ¯çº¿ç¨‹å¸¦æ¥å·¨å¤§çš„å¼€é”€\n\t- work stealingï¼šå½“æœ¬çº¿ç¨‹æ— å¯è°ƒåº¦çš„Goroutineæ—¶ï¼Œå°±ä¼šâ€œå·å–â€å…¶ä»–çº¿ç¨‹å¾…æ‰§è¡Œçš„Goroutineæ¥æ‰§è¡Œ\n\t- hand offï¼šå½“æœ¬çº¿ç¨‹è¿è¡Œçš„Goroutineå‘ç”Ÿäº†é˜»å¡ï¼Œå°±ä¼šåˆ›å»º/å”¤é†’ä¸€ä¸ªæ–°çš„çº¿ç¨‹ï¼Œæ–°çº¿ç¨‹æ¥ç®¡è¿™ä¸ªé˜»å¡Gçš„P\n- **åˆ©ç”¨å¹¶è¡Œ**ï¼šé€šè¿‡`GOMAXPROCS`å‚æ•°è°ƒèŠ‚å¯åŒæ—¶å·¥ä½œçš„Processorï¼Œå³æœ€å¤šæœ‰`GOMAXPROCS`ä¸ªåç¨‹å¹¶è¡Œå·¥ä½œ\n- **æŠ¢å **ï¼šcoroutineæ˜¯åä½œå¼çš„ï¼Œåªèƒ½ç”±coroutineä¸»åŠ¨è®©å‡ºCPUèµ„æºã€‚è€ŒGoè°ƒåº¦å™¨ä¸ºäº†è°ƒåº¦å…¬å¹³ï¼Œè§„å®šæ¯ä¸ªGoroutineæœ€å¤šå ç”¨10msCPUæ—¶é—´ï¼Œè¶…è¿‡è¿™ä¸ªæ—¶é—´å°±ä¼šè¢«å¼ºåˆ¶ä¸‹çº¿\n- **å…¨å±€é˜Ÿåˆ—**ï¼šå½“çº¿ç¨‹æ— æ³•ä»åˆ«çš„çº¿ç¨‹ä¸­â€œå·å–â€å¯è°ƒåº¦çš„Goroutineæ—¶ï¼Œå°±ä¼šä»å…¨å±€é˜Ÿåˆ—ä¸­è·å–ä¸€ä¸ªGoroutineè¿›è¡Œæ‰§è¡Œ\n\n## GoæŒ‡ä»¤çš„è°ƒåº¦æµç¨‹\n\n![image.png](https://raw.githubusercontent.com/lyydsheep/pic/main/202412221837093.png)\n\n\ngo func()å‘½ä»¤çš„æ‰§è¡Œæµç¨‹ï¼š\n1. åˆ›å»ºä¸€ä¸ªGoroutine\n2. å°è¯•å°†Goroutineæ”¾å…¥æœ¬çº¿ç¨‹ç»‘å®šçš„Pçš„æœ¬åœ°é˜Ÿåˆ—ä¸­ï¼Œå¦‚æœæœ¬åœ°é˜Ÿåˆ—å·²æ»¡ï¼Œé‚£ä¹ˆå°±æŠŠGoroutineæ”¾å…¥å…¨å±€é˜Ÿåˆ—ä¸­\n3. Mä¼šä»Pçš„æœ¬åœ°é˜Ÿåˆ—ä¸­å–å‡ºä¸€ä¸ªGoroutineæ‰§è¡Œï¼Œè‹¥æœ¬åœ°é˜Ÿåˆ—ä¸ºç©ºï¼Œé‚£å°±ä»åˆ«çš„MPç»„åˆæˆ–å…¨å±€é˜Ÿåˆ—ä¸­â€œå·â€ä¸€ä¸ªGoroutineæ‰§è¡Œ\n4. Må¾ªç¯è°ƒåº¦ä¸åŒçš„G\n5. å½“Måœ¨æ‰§è¡ŒGæ—¶å‘ç”Ÿäº†é˜»å¡ï¼Œruntimeä¼šæŠŠè¿™ä¸ªMå’ŒPè§£é™¤å…³è”ï¼Œç„¶ååˆ›å»º/å”¤é†’ä¸€ä¸ªçº¿ç¨‹ï¼Œæ¥ç€è®©è¿™ä¸ªçº¿ç¨‹å–æœåŠ¡è§£é™¤å…³è”çš„P\n6. å½“Mè°ƒåº¦ç»“æŸåï¼ŒGä¼šå°è¯•è·å–ä¸€ä¸ªç©ºé—²çš„Pï¼Œå¹¶è¿›å…¥è¯¥Pçš„æœ¬åœ°é˜Ÿåˆ—ä¸­ï¼ŒMå’ŒPé‡æ–°å…³è”ã€‚å¦‚æœè·å–ä¸åˆ°ï¼Œé‚£ä¹ˆGä¼šè¢«æ”¾å…¥å…¨å±€é˜Ÿåˆ—ï¼ŒMåˆ™æ˜¯åŠ å…¥ç©ºé—²çº¿ç¨‹ä¸­ï¼Œè¿›å…¥ä¼‘çœ çŠ¶æ€\n\n## Goå¯åŠ¨å‘¨æœŸçš„M0å’ŒG0\n\n**M0**ï¼šè¿›ç¨‹å¯åŠ¨æ—¶åˆ›å»ºçš„ç¬¬ä¸€ä¸ªçº¿ç¨‹ï¼Œç§°ä¸ºM0ã€‚M0å®ä¾‹ä¼šåœ¨å…¨å±€å˜é‡runtime.m0ä¸­ï¼Œä¸éœ€è¦åœ¨heapä¸­åˆ†é…ä¸­é—´ã€‚M0è´Ÿè´£æ‰§è¡Œä¸€äº›åˆå§‹åŒ–æ“ä½œï¼Œæ¥ç€ä¾¿å’Œæ™®é€šçº¿ç¨‹æ— å¼‚\n**G0**ï¼šæ¯ä¸€ä¸ªçº¿ç¨‹åœ¨è¢«åˆ›å»ºä¹‹åï¼Œä¼šç«‹å³åˆ›å»ºä¸€ä¸ªGoroutineï¼Œç§°ä¸ºG0ï¼Œå³æ¯ä¸€ä¸ªçº¿ç¨‹éƒ½æœ‰ä¸€ä¸ªå±äºè‡ªå·±çš„G0ã€‚G0ä¸æŒ‡å‘æŸä¸ªå…·ä½“çš„å‡½æ•°ï¼Œè€Œæ˜¯ä¸“é—¨è´Ÿè´£è°ƒåº¦æœ¬åœ°é˜Ÿåˆ—ä¸­çš„Gã€‚åœ¨è°ƒåº¦æˆ–ç³»ç»Ÿè°ƒåº¦æ—¶ï¼Œä¼šä½¿ç”¨G0çš„æ ˆç©ºé—´ï¼Œå…¨å±€å˜é‡G0å°±æ˜¯M0æ‰€åˆ›å»ºçš„G0\n\n## GMPå¯è§†åŒ–è°ƒè¯•\n\n```go\n\t// åˆ›å»ºtrace.outæ–‡ä»¶\n\tf, err := os.Create(\"trace.out\")\n\tif err != nil {}\n\t// å¯åŠ¨trace\n\terr = trace.Start(f)\n\tif err != nil {}\n\t// do something\n\t// è¿™é‡Œæ˜¯ä¸šåŠ¡ä»£ç \n\n\t// åœæ­¢trace\n\ttrace.Stop()\n```\nè¿è¡Œç¨‹åºåï¼Œä¼šç”Ÿæˆä¸€ä¸ªåä¸ºtrace.outçš„æ–‡ä»¶ï¼Œå¯ä»¥ä½¿ç”¨`go tool trace $filename`å‘½ä»¤å¯¹è¿™ä¸ªæ–‡ä»¶è¿›è¡Œå¯è§†åŒ–åˆ†æ\n![image.png](https://raw.githubusercontent.com/lyydsheep/pic/main/202412221942758.png)\n\nå·¦æ è‡ªä¸Šè€Œä¸‹ä¾æ¬¡æ˜¯ï¼šGåç¨‹ä¿¡æ¯ã€å †æ ˆä¿¡æ¯ã€Mçº¿ç¨‹ä¿¡æ¯ã€Pè°ƒåº¦å™¨ä¿¡æ¯\n\n## GMPè°ƒåº¦åœºæ™¯å…¨è¿‡ç¨‹åˆ†æ\n\n### G1åˆ›å»ºGâ€™\n\nPæ‹¥æœ‰G1ï¼ŒG1åœ¨è¿è¡Œè¿‡ç¨‹ä¸­è°ƒç”¨`go fun()`åˆ›å»ºäº†Gâ€˜ã€‚è€ƒè™‘åˆ°å±€éƒ¨æ€§ï¼Œä¼˜å…ˆå°†G2æ”¾å…¥åˆ°è¯¥Pçš„æœ¬åœ°é˜Ÿåˆ—ä¸­\n<img src=\"https://raw.githubusercontent.com/lyydsheep/pic/main/202412221958378.png\" style=\"zoom:70%\">\n\n### G1æ‰§è¡Œå®Œæ¯•\n\nG1è¿è¡Œå®Œæ¯•åï¼ŒG0åˆ‡æ¢åˆ°Mä¸Šè¿è¡Œï¼ŒG0æ‰§è¡Œè°ƒåº¦å·¥ä½œï¼ˆscheduleå‡½æ•°)ï¼šä»Pçš„æœ¬åœ°é˜Ÿåˆ—ä¸­å–å‡ºG2ï¼ŒMä¸Šè¿è¡Œçš„Goroutineä»G0åˆ‡æ¢è‡³G2ï¼Œå¹¶å¼€å§‹è¿è¡ŒG2ï¼ˆexecuteå‡½æ•°ï¼‰ã€‚å®ç°çº¿ç¨‹çš„å¤ç”¨\n![image.png](https://raw.githubusercontent.com/lyydsheep/pic/main/202412222006838.png)\n\n### æœ¬åœ°é˜Ÿåˆ—å·²æ»¡ï¼Œå†åˆ›å»ºG\n\nå¦‚æœå½“å‰è¿è¡Œçš„Gåˆ›å»ºäº†ä¸€ä¸ªGï¼Œæ°å·§Pçš„æœ¬åœ°é˜Ÿåˆ—æ— æ³•å†å®¹çº³æ–°åˆ›å»ºçš„Gæ—¶ï¼Œéœ€è¦å°†æœ¬åœ°é˜Ÿåˆ—ä¸­**å‰åŠéƒ¨åˆ†çš„Gæ‰“ä¹±é¡ºåº**ï¼Œè¿åŒæ–°åˆ›å»ºçš„Gä¸€èµ·æ”¾å…¥å…¨å±€é˜Ÿåˆ—ä¸­\n![image.png](https://raw.githubusercontent.com/lyydsheep/pic/main/202412222017907.png)\n\n### å”¤é†’æ­£åœ¨ä¼‘çœ çš„M\n\nåœ¨ä¸€ä¸ªGåˆ›å»ºä¸€ä¸ªæ–°çš„Gæ—¶ï¼Œä¼šå°è¯•å”¤é†’ç­‰å¾…é˜Ÿåˆ—ä¸­çš„Mã€‚å‡è®¾å”¤é†’äº†M2ï¼ŒM2ä¼šå¯»æ‰¾ä¸€ä¸ªç©ºé—²çš„Pè¿›è¡Œç»‘å®šï¼Œå¹¶è¿è¡ŒG0ï¼Œæ‰§è¡Œåç¨‹çš„è°ƒåº¦ã€‚å¦‚æœPçš„æœ¬åœ°é˜Ÿåˆ—ä¸ºç©ºï¼Œé‚£ä¹ˆM2äºŸéœ€å¯»æ‰¾ä¸€ä¸ªGæ¥æ‰§è¡Œï¼Œæ­¤æ—¶M2å°±æ˜¯**è‡ªæ—‹çº¿ç¨‹**\n![image.png](https://raw.githubusercontent.com/lyydsheep/pic/main/202412222026925.png)\n\n### è¢«å”¤é†’çš„M2ä»å…¨å±€é˜Ÿåˆ—ä¸­æ‰¹é‡å–G\n\nè‡ªæ—‹çº¿ç¨‹M2ä¼šå°è¯•ä»å…¨å±€é˜Ÿåˆ—ä¸­è·å–Gæ‰§è¡Œï¼Œè·å–çš„Gçš„æ•°é‡ç”±`min(len(GQ)/2 + 1, len(GQ)/2)`å†³å®šï¼Œå…¶ä¸­`len(GQ)`è¡¨ç¤ºå…¨å±€é˜Ÿåˆ—ä¸­å…ƒç´ ä¸ªæ•°ã€‚M2æ‰¹é‡è·å–Gçš„è¿‡ç¨‹å«åšâ€**ä»å…¨å±€é˜Ÿåˆ—åˆ°æœ¬åœ°é˜Ÿåˆ—çš„è´Ÿè½½å‡è¡¡**â€œã€‚(æ„Ÿè§‰å°±æ˜¯ä¸ºäº†é¿å…æ‹‰å–å¤ªå¤šçš„Gï¼Œä¸€æ˜¯å¯¼è‡´æœ¬çº¿ç¨‹æ¶ˆåŒ–ä¸äº†ï¼ŒäºŒæ˜¯é¥¿æ­»åˆ«çš„çº¿ç¨‹ï¼‰\n![image.png](https://raw.githubusercontent.com/lyydsheep/pic/main/202412222048979.png)\n\n### å·å–Mçš„G\n\nå¦‚æœå…¨å±€é˜Ÿåˆ—å·²ç»æ²¡æœ‰Gäº†ï¼Œè‡ªæ—‹çº¿ç¨‹M2å°±ä¼šå°è¯•ä»åˆ«çš„çº¿ç¨‹ï¼ˆM1ï¼‰ä¸­å·å–ä¸€æ‰¹Gï¼Œæ”¾å…¥æœ¬åœ°é˜Ÿåˆ—ä¸­å‡†å¤‡è°ƒåº¦ã€‚å…·ä½“åœ°ï¼ŒM2ä¼šå·å–ï¼ŒM1æœ¬åœ°é˜Ÿåˆ—ä¸­**ååŠéƒ¨åˆ†**çš„Gä½œä¸ºæœ¬çº¿ç¨‹å³å°†æ‰§è¡Œè°ƒåº¦çš„Gï¼Œä¸‹å›¾ä¸­P1çš„æœ¬åœ°é˜Ÿåˆ—ååŠéƒ¨åˆ†åªæœ‰G8ï¼Œå› æ­¤G8è¢«M2å·å–æ‰§è¡Œ\n![image.png](https://raw.githubusercontent.com/lyydsheep/pic/main/202412222131818.png)\n\n### è‡ªæ—‹çº¿ç¨‹çš„é™åˆ¶\n\næœ€å¤šæœ‰**GOMAXPROCS**ä¸ªè‡ªæ—‹çº¿ç¨‹ï¼Œå³ä½¿æœ‰å†å¤šçš„çº¿ç¨‹ï¼Œä¹Ÿä¼šå› ä¸ºæ²¡æœ‰ç©ºé—²çš„Pè¿›è¡Œè°ƒåº¦è¿›å…¥ä¼‘çœ çŠ¶æ€\n\n### Gå‘ç”Ÿè°ƒç”¨é˜»å¡\n\nå½“G8å‘ç”Ÿäº†è°ƒç”¨é˜»å¡ï¼ŒP2ä¼šç«‹å³å’ŒM2è§£ç»‘ã€‚æ¥ä¸‹æ¥P2ä¼šåˆ¤æ–­æ˜¯å¦æœ‰çº¿ç¨‹å¤„äºä¼‘çœ çŠ¶æ€ï¼Œå¦‚æœæœ‰ï¼Œå°±å”¤é†’ä¸€ä¸ªçº¿ç¨‹å¹¶ä¸ä¹‹ç»‘å®šï¼Œå¦åˆ™P2ä¼šåŠ å…¥ç©ºé—²Påˆ—è¡¨ä¸­ï¼Œç­‰å¾…Mæ¥è·å–\n![image.png](https://raw.githubusercontent.com/lyydsheep/pic/main/202412240928105.png)\n\nGå‘ç”Ÿç³»ç»Ÿè°ƒç”¨/éé˜»å¡\n\nå½“G8ä»é˜»å¡çŠ¶æ€ä¸­æ¢å¤åï¼ŒM2æƒ³è¦è¿è¡ŒG8å¿…é¡»è¦æœ‰Pçš„æ”¯æŒã€‚é‚£ä¹ˆM2ä¼šå°è¯•é‡æ–°è·å–P2ï¼Œå¦‚æœå‘ç°P2å·²ç»è¢«ç»‘å®šï¼Œå°±å†å°è¯•ä»ç©ºé—²Pé˜Ÿåˆ—ä¸­è·å–ä¸€ä¸ªPã€‚å¦‚æœè·å–På¤±è´¥ï¼ŒG8å°±ä¼šè¢«æ”¾å…¥å…¨å±€é˜Ÿåˆ—ï¼ŒM2è¿›å…¥ä¼‘çœ çº¿ç¨‹é˜Ÿåˆ—\n![image.png](https://raw.githubusercontent.com/lyydsheep/pic/main/202412240936232.png)\n","source":"_posts/Go/GMPåŸç†.md","raw":"[Golangæ·±å…¥ç†è§£GPMæ¨¡å‹](https://www.bilibili.com/video/BV19r4y1w7Nx/?spm_id_from=333.1387.homepage.video_card.click)å­¦ä¹ ç¬”è®°\n\nåç¨‹è°ƒåº¦å™¨çš„æ ¸å¿ƒä½œç”¨å°±æ˜¯å°†åç¨‹å…³è”åˆ°å†…æ ¸çº¿ç¨‹ï¼Œå†…æ ¸çº¿ç¨‹æ— éœ€åˆ‡æ¢å°±èƒ½æ‰§è¡Œç”¨æˆ·æ€ä¸­çš„ä¸åŒåŠŸèƒ½ï¼Œæé«˜äº†å¹¶å‘åº¦\n\n## GMPæ¨¡å‹\n\nGMPæ¨¡å‹è®¾è®¡å¸ƒå±€å¦‚ä¸‹å›¾æ‰€ç¤ºï¼š\n\n<img src=\"https://raw.githubusercontent.com/lyydsheep/pic/main/202412212114507.png\" style=\"zoom:80%\">\n\n- **G**ï¼šGoroutineï¼ŒGoåç¨‹\n- **P**ï¼šProcessorï¼Œé€»è¾‘å¤„ç†å™¨\n- **M**ï¼šMachineï¼Œç³»ç»Ÿçº§çº¿ç¨‹\n- **å…¨å±€é˜Ÿåˆ—**ï¼šå­˜æ”¾å¾…è°ƒåº¦çš„Goroutine\n- **æœ¬åœ°é˜Ÿåˆ—**ï¼šå­˜æ”¾æŸä¸€ä¸ªProcessorå³å°†è°ƒåº¦çš„Goroutine\n\t- ä¸€ä¸ªæœ¬åœ°é˜Ÿåˆ—ä¸­æœ€å¤šå®¹çº³256ä¸ªGoroutine\n\t- å½“åˆ›å»ºä¸€ä¸ªGoroutineæ—¶ï¼Œä¼šä¼˜å…ˆå°†Goroutineæ”¾åœ¨æœ¬åœ°é˜Ÿåˆ—ä¸­ã€‚å¦‚æœæ²¡æœ‰æœ¬åœ°é˜Ÿåˆ—å­˜åœ¨ç©ºé—²ç©ºé—´ï¼Œé‚£ä¹ˆæ–°åˆ›å»ºçš„Goroutineå°±ä¼šè¢«æ”¾å…¥å…¨å±€é˜Ÿåˆ—\n- **GOMAXPROCS**ï¼šé…ç½®é€»è¾‘å¤„ç†å™¨ä¸ªæ•°çš„å‚æ•°ï¼Œå†³å®šäº†Goroutineçš„**å¹¶è¡Œ**èƒ½åŠ›\n\t- å¯é€šè¿‡ç¯å¢ƒå˜é‡`$GOMAXPROCS`è®¾ç½®\n\t- æˆ–è€…åœ¨ç¨‹åºä¸­é€šè¿‡`runtime.GOMAXPROCS()`æ¥è®¾ç½®\n\n## è°ƒåº¦å™¨çš„è®¾è®¡ç­–ç•¥\n\n- **å¤ç”¨çº¿ç¨‹**ï¼šé¿å…é¢‘ç¹åˆ›å»ºã€é”€æ¯çº¿ç¨‹å¸¦æ¥å·¨å¤§çš„å¼€é”€\n\t- work stealingï¼šå½“æœ¬çº¿ç¨‹æ— å¯è°ƒåº¦çš„Goroutineæ—¶ï¼Œå°±ä¼šâ€œå·å–â€å…¶ä»–çº¿ç¨‹å¾…æ‰§è¡Œçš„Goroutineæ¥æ‰§è¡Œ\n\t- hand offï¼šå½“æœ¬çº¿ç¨‹è¿è¡Œçš„Goroutineå‘ç”Ÿäº†é˜»å¡ï¼Œå°±ä¼šåˆ›å»º/å”¤é†’ä¸€ä¸ªæ–°çš„çº¿ç¨‹ï¼Œæ–°çº¿ç¨‹æ¥ç®¡è¿™ä¸ªé˜»å¡Gçš„P\n- **åˆ©ç”¨å¹¶è¡Œ**ï¼šé€šè¿‡`GOMAXPROCS`å‚æ•°è°ƒèŠ‚å¯åŒæ—¶å·¥ä½œçš„Processorï¼Œå³æœ€å¤šæœ‰`GOMAXPROCS`ä¸ªåç¨‹å¹¶è¡Œå·¥ä½œ\n- **æŠ¢å **ï¼šcoroutineæ˜¯åä½œå¼çš„ï¼Œåªèƒ½ç”±coroutineä¸»åŠ¨è®©å‡ºCPUèµ„æºã€‚è€ŒGoè°ƒåº¦å™¨ä¸ºäº†è°ƒåº¦å…¬å¹³ï¼Œè§„å®šæ¯ä¸ªGoroutineæœ€å¤šå ç”¨10msCPUæ—¶é—´ï¼Œè¶…è¿‡è¿™ä¸ªæ—¶é—´å°±ä¼šè¢«å¼ºåˆ¶ä¸‹çº¿\n- **å…¨å±€é˜Ÿåˆ—**ï¼šå½“çº¿ç¨‹æ— æ³•ä»åˆ«çš„çº¿ç¨‹ä¸­â€œå·å–â€å¯è°ƒåº¦çš„Goroutineæ—¶ï¼Œå°±ä¼šä»å…¨å±€é˜Ÿåˆ—ä¸­è·å–ä¸€ä¸ªGoroutineè¿›è¡Œæ‰§è¡Œ\n\n## GoæŒ‡ä»¤çš„è°ƒåº¦æµç¨‹\n\n![image.png](https://raw.githubusercontent.com/lyydsheep/pic/main/202412221837093.png)\n\n\ngo func()å‘½ä»¤çš„æ‰§è¡Œæµç¨‹ï¼š\n1. åˆ›å»ºä¸€ä¸ªGoroutine\n2. å°è¯•å°†Goroutineæ”¾å…¥æœ¬çº¿ç¨‹ç»‘å®šçš„Pçš„æœ¬åœ°é˜Ÿåˆ—ä¸­ï¼Œå¦‚æœæœ¬åœ°é˜Ÿåˆ—å·²æ»¡ï¼Œé‚£ä¹ˆå°±æŠŠGoroutineæ”¾å…¥å…¨å±€é˜Ÿåˆ—ä¸­\n3. Mä¼šä»Pçš„æœ¬åœ°é˜Ÿåˆ—ä¸­å–å‡ºä¸€ä¸ªGoroutineæ‰§è¡Œï¼Œè‹¥æœ¬åœ°é˜Ÿåˆ—ä¸ºç©ºï¼Œé‚£å°±ä»åˆ«çš„MPç»„åˆæˆ–å…¨å±€é˜Ÿåˆ—ä¸­â€œå·â€ä¸€ä¸ªGoroutineæ‰§è¡Œ\n4. Må¾ªç¯è°ƒåº¦ä¸åŒçš„G\n5. å½“Måœ¨æ‰§è¡ŒGæ—¶å‘ç”Ÿäº†é˜»å¡ï¼Œruntimeä¼šæŠŠè¿™ä¸ªMå’ŒPè§£é™¤å…³è”ï¼Œç„¶ååˆ›å»º/å”¤é†’ä¸€ä¸ªçº¿ç¨‹ï¼Œæ¥ç€è®©è¿™ä¸ªçº¿ç¨‹å–æœåŠ¡è§£é™¤å…³è”çš„P\n6. å½“Mè°ƒåº¦ç»“æŸåï¼ŒGä¼šå°è¯•è·å–ä¸€ä¸ªç©ºé—²çš„Pï¼Œå¹¶è¿›å…¥è¯¥Pçš„æœ¬åœ°é˜Ÿåˆ—ä¸­ï¼ŒMå’ŒPé‡æ–°å…³è”ã€‚å¦‚æœè·å–ä¸åˆ°ï¼Œé‚£ä¹ˆGä¼šè¢«æ”¾å…¥å…¨å±€é˜Ÿåˆ—ï¼ŒMåˆ™æ˜¯åŠ å…¥ç©ºé—²çº¿ç¨‹ä¸­ï¼Œè¿›å…¥ä¼‘çœ çŠ¶æ€\n\n## Goå¯åŠ¨å‘¨æœŸçš„M0å’ŒG0\n\n**M0**ï¼šè¿›ç¨‹å¯åŠ¨æ—¶åˆ›å»ºçš„ç¬¬ä¸€ä¸ªçº¿ç¨‹ï¼Œç§°ä¸ºM0ã€‚M0å®ä¾‹ä¼šåœ¨å…¨å±€å˜é‡runtime.m0ä¸­ï¼Œä¸éœ€è¦åœ¨heapä¸­åˆ†é…ä¸­é—´ã€‚M0è´Ÿè´£æ‰§è¡Œä¸€äº›åˆå§‹åŒ–æ“ä½œï¼Œæ¥ç€ä¾¿å’Œæ™®é€šçº¿ç¨‹æ— å¼‚\n**G0**ï¼šæ¯ä¸€ä¸ªçº¿ç¨‹åœ¨è¢«åˆ›å»ºä¹‹åï¼Œä¼šç«‹å³åˆ›å»ºä¸€ä¸ªGoroutineï¼Œç§°ä¸ºG0ï¼Œå³æ¯ä¸€ä¸ªçº¿ç¨‹éƒ½æœ‰ä¸€ä¸ªå±äºè‡ªå·±çš„G0ã€‚G0ä¸æŒ‡å‘æŸä¸ªå…·ä½“çš„å‡½æ•°ï¼Œè€Œæ˜¯ä¸“é—¨è´Ÿè´£è°ƒåº¦æœ¬åœ°é˜Ÿåˆ—ä¸­çš„Gã€‚åœ¨è°ƒåº¦æˆ–ç³»ç»Ÿè°ƒåº¦æ—¶ï¼Œä¼šä½¿ç”¨G0çš„æ ˆç©ºé—´ï¼Œå…¨å±€å˜é‡G0å°±æ˜¯M0æ‰€åˆ›å»ºçš„G0\n\n## GMPå¯è§†åŒ–è°ƒè¯•\n\n```go\n\t// åˆ›å»ºtrace.outæ–‡ä»¶\n\tf, err := os.Create(\"trace.out\")\n\tif err != nil {}\n\t// å¯åŠ¨trace\n\terr = trace.Start(f)\n\tif err != nil {}\n\t// do something\n\t// è¿™é‡Œæ˜¯ä¸šåŠ¡ä»£ç \n\n\t// åœæ­¢trace\n\ttrace.Stop()\n```\nè¿è¡Œç¨‹åºåï¼Œä¼šç”Ÿæˆä¸€ä¸ªåä¸ºtrace.outçš„æ–‡ä»¶ï¼Œå¯ä»¥ä½¿ç”¨`go tool trace $filename`å‘½ä»¤å¯¹è¿™ä¸ªæ–‡ä»¶è¿›è¡Œå¯è§†åŒ–åˆ†æ\n![image.png](https://raw.githubusercontent.com/lyydsheep/pic/main/202412221942758.png)\n\nå·¦æ è‡ªä¸Šè€Œä¸‹ä¾æ¬¡æ˜¯ï¼šGåç¨‹ä¿¡æ¯ã€å †æ ˆä¿¡æ¯ã€Mçº¿ç¨‹ä¿¡æ¯ã€Pè°ƒåº¦å™¨ä¿¡æ¯\n\n## GMPè°ƒåº¦åœºæ™¯å…¨è¿‡ç¨‹åˆ†æ\n\n### G1åˆ›å»ºGâ€™\n\nPæ‹¥æœ‰G1ï¼ŒG1åœ¨è¿è¡Œè¿‡ç¨‹ä¸­è°ƒç”¨`go fun()`åˆ›å»ºäº†Gâ€˜ã€‚è€ƒè™‘åˆ°å±€éƒ¨æ€§ï¼Œä¼˜å…ˆå°†G2æ”¾å…¥åˆ°è¯¥Pçš„æœ¬åœ°é˜Ÿåˆ—ä¸­\n<img src=\"https://raw.githubusercontent.com/lyydsheep/pic/main/202412221958378.png\" style=\"zoom:70%\">\n\n### G1æ‰§è¡Œå®Œæ¯•\n\nG1è¿è¡Œå®Œæ¯•åï¼ŒG0åˆ‡æ¢åˆ°Mä¸Šè¿è¡Œï¼ŒG0æ‰§è¡Œè°ƒåº¦å·¥ä½œï¼ˆscheduleå‡½æ•°)ï¼šä»Pçš„æœ¬åœ°é˜Ÿåˆ—ä¸­å–å‡ºG2ï¼ŒMä¸Šè¿è¡Œçš„Goroutineä»G0åˆ‡æ¢è‡³G2ï¼Œå¹¶å¼€å§‹è¿è¡ŒG2ï¼ˆexecuteå‡½æ•°ï¼‰ã€‚å®ç°çº¿ç¨‹çš„å¤ç”¨\n![image.png](https://raw.githubusercontent.com/lyydsheep/pic/main/202412222006838.png)\n\n### æœ¬åœ°é˜Ÿåˆ—å·²æ»¡ï¼Œå†åˆ›å»ºG\n\nå¦‚æœå½“å‰è¿è¡Œçš„Gåˆ›å»ºäº†ä¸€ä¸ªGï¼Œæ°å·§Pçš„æœ¬åœ°é˜Ÿåˆ—æ— æ³•å†å®¹çº³æ–°åˆ›å»ºçš„Gæ—¶ï¼Œéœ€è¦å°†æœ¬åœ°é˜Ÿåˆ—ä¸­**å‰åŠéƒ¨åˆ†çš„Gæ‰“ä¹±é¡ºåº**ï¼Œè¿åŒæ–°åˆ›å»ºçš„Gä¸€èµ·æ”¾å…¥å…¨å±€é˜Ÿåˆ—ä¸­\n![image.png](https://raw.githubusercontent.com/lyydsheep/pic/main/202412222017907.png)\n\n### å”¤é†’æ­£åœ¨ä¼‘çœ çš„M\n\nåœ¨ä¸€ä¸ªGåˆ›å»ºä¸€ä¸ªæ–°çš„Gæ—¶ï¼Œä¼šå°è¯•å”¤é†’ç­‰å¾…é˜Ÿåˆ—ä¸­çš„Mã€‚å‡è®¾å”¤é†’äº†M2ï¼ŒM2ä¼šå¯»æ‰¾ä¸€ä¸ªç©ºé—²çš„Pè¿›è¡Œç»‘å®šï¼Œå¹¶è¿è¡ŒG0ï¼Œæ‰§è¡Œåç¨‹çš„è°ƒåº¦ã€‚å¦‚æœPçš„æœ¬åœ°é˜Ÿåˆ—ä¸ºç©ºï¼Œé‚£ä¹ˆM2äºŸéœ€å¯»æ‰¾ä¸€ä¸ªGæ¥æ‰§è¡Œï¼Œæ­¤æ—¶M2å°±æ˜¯**è‡ªæ—‹çº¿ç¨‹**\n![image.png](https://raw.githubusercontent.com/lyydsheep/pic/main/202412222026925.png)\n\n### è¢«å”¤é†’çš„M2ä»å…¨å±€é˜Ÿåˆ—ä¸­æ‰¹é‡å–G\n\nè‡ªæ—‹çº¿ç¨‹M2ä¼šå°è¯•ä»å…¨å±€é˜Ÿåˆ—ä¸­è·å–Gæ‰§è¡Œï¼Œè·å–çš„Gçš„æ•°é‡ç”±`min(len(GQ)/2 + 1, len(GQ)/2)`å†³å®šï¼Œå…¶ä¸­`len(GQ)`è¡¨ç¤ºå…¨å±€é˜Ÿåˆ—ä¸­å…ƒç´ ä¸ªæ•°ã€‚M2æ‰¹é‡è·å–Gçš„è¿‡ç¨‹å«åšâ€**ä»å…¨å±€é˜Ÿåˆ—åˆ°æœ¬åœ°é˜Ÿåˆ—çš„è´Ÿè½½å‡è¡¡**â€œã€‚(æ„Ÿè§‰å°±æ˜¯ä¸ºäº†é¿å…æ‹‰å–å¤ªå¤šçš„Gï¼Œä¸€æ˜¯å¯¼è‡´æœ¬çº¿ç¨‹æ¶ˆåŒ–ä¸äº†ï¼ŒäºŒæ˜¯é¥¿æ­»åˆ«çš„çº¿ç¨‹ï¼‰\n![image.png](https://raw.githubusercontent.com/lyydsheep/pic/main/202412222048979.png)\n\n### å·å–Mçš„G\n\nå¦‚æœå…¨å±€é˜Ÿåˆ—å·²ç»æ²¡æœ‰Gäº†ï¼Œè‡ªæ—‹çº¿ç¨‹M2å°±ä¼šå°è¯•ä»åˆ«çš„çº¿ç¨‹ï¼ˆM1ï¼‰ä¸­å·å–ä¸€æ‰¹Gï¼Œæ”¾å…¥æœ¬åœ°é˜Ÿåˆ—ä¸­å‡†å¤‡è°ƒåº¦ã€‚å…·ä½“åœ°ï¼ŒM2ä¼šå·å–ï¼ŒM1æœ¬åœ°é˜Ÿåˆ—ä¸­**ååŠéƒ¨åˆ†**çš„Gä½œä¸ºæœ¬çº¿ç¨‹å³å°†æ‰§è¡Œè°ƒåº¦çš„Gï¼Œä¸‹å›¾ä¸­P1çš„æœ¬åœ°é˜Ÿåˆ—ååŠéƒ¨åˆ†åªæœ‰G8ï¼Œå› æ­¤G8è¢«M2å·å–æ‰§è¡Œ\n![image.png](https://raw.githubusercontent.com/lyydsheep/pic/main/202412222131818.png)\n\n### è‡ªæ—‹çº¿ç¨‹çš„é™åˆ¶\n\næœ€å¤šæœ‰**GOMAXPROCS**ä¸ªè‡ªæ—‹çº¿ç¨‹ï¼Œå³ä½¿æœ‰å†å¤šçš„çº¿ç¨‹ï¼Œä¹Ÿä¼šå› ä¸ºæ²¡æœ‰ç©ºé—²çš„Pè¿›è¡Œè°ƒåº¦è¿›å…¥ä¼‘çœ çŠ¶æ€\n\n### Gå‘ç”Ÿè°ƒç”¨é˜»å¡\n\nå½“G8å‘ç”Ÿäº†è°ƒç”¨é˜»å¡ï¼ŒP2ä¼šç«‹å³å’ŒM2è§£ç»‘ã€‚æ¥ä¸‹æ¥P2ä¼šåˆ¤æ–­æ˜¯å¦æœ‰çº¿ç¨‹å¤„äºä¼‘çœ çŠ¶æ€ï¼Œå¦‚æœæœ‰ï¼Œå°±å”¤é†’ä¸€ä¸ªçº¿ç¨‹å¹¶ä¸ä¹‹ç»‘å®šï¼Œå¦åˆ™P2ä¼šåŠ å…¥ç©ºé—²Påˆ—è¡¨ä¸­ï¼Œç­‰å¾…Mæ¥è·å–\n![image.png](https://raw.githubusercontent.com/lyydsheep/pic/main/202412240928105.png)\n\nGå‘ç”Ÿç³»ç»Ÿè°ƒç”¨/éé˜»å¡\n\nå½“G8ä»é˜»å¡çŠ¶æ€ä¸­æ¢å¤åï¼ŒM2æƒ³è¦è¿è¡ŒG8å¿…é¡»è¦æœ‰Pçš„æ”¯æŒã€‚é‚£ä¹ˆM2ä¼šå°è¯•é‡æ–°è·å–P2ï¼Œå¦‚æœå‘ç°P2å·²ç»è¢«ç»‘å®šï¼Œå°±å†å°è¯•ä»ç©ºé—²Pé˜Ÿåˆ—ä¸­è·å–ä¸€ä¸ªPã€‚å¦‚æœè·å–På¤±è´¥ï¼ŒG8å°±ä¼šè¢«æ”¾å…¥å…¨å±€é˜Ÿåˆ—ï¼ŒM2è¿›å…¥ä¼‘çœ çº¿ç¨‹é˜Ÿåˆ—\n![image.png](https://raw.githubusercontent.com/lyydsheep/pic/main/202412240936232.png)\n","slug":"Go/GMPåŸç†","published":1,"date":"2024-12-27T11:03:15.342Z","updated":"2024-12-27T11:03:15.342Z","title":"","comments":1,"layout":"post","photos":[],"_id":"cm6c7md6m001ua5t299in93du","content":"<p><a href=\"https://www.bilibili.com/video/BV19r4y1w7Nx/?spm_id_from=333.1387.homepage.video_card.click\">Golangæ·±å…¥ç†è§£GPMæ¨¡å‹</a>å­¦ä¹ ç¬”è®°</p>\n<p>åç¨‹è°ƒåº¦å™¨çš„æ ¸å¿ƒä½œç”¨å°±æ˜¯å°†åç¨‹å…³è”åˆ°å†…æ ¸çº¿ç¨‹ï¼Œå†…æ ¸çº¿ç¨‹æ— éœ€åˆ‡æ¢å°±èƒ½æ‰§è¡Œç”¨æˆ·æ€ä¸­çš„ä¸åŒåŠŸèƒ½ï¼Œæé«˜äº†å¹¶å‘åº¦</p>\n<h2 id=\"GMPæ¨¡å‹\"><a href=\"#GMPæ¨¡å‹\" class=\"headerlink\" title=\"GMPæ¨¡å‹\"></a>GMPæ¨¡å‹</h2><p>GMPæ¨¡å‹è®¾è®¡å¸ƒå±€å¦‚ä¸‹å›¾æ‰€ç¤ºï¼š</p>\n<img src=\"https://raw.githubusercontent.com/lyydsheep/pic/main/202412212114507.png\" style=\"zoom:80%\">\n\n<ul>\n<li><strong>G</strong>ï¼šGoroutineï¼ŒGoåç¨‹</li>\n<li><strong>P</strong>ï¼šProcessorï¼Œé€»è¾‘å¤„ç†å™¨</li>\n<li><strong>M</strong>ï¼šMachineï¼Œç³»ç»Ÿçº§çº¿ç¨‹</li>\n<li><strong>å…¨å±€é˜Ÿåˆ—</strong>ï¼šå­˜æ”¾å¾…è°ƒåº¦çš„Goroutine</li>\n<li><strong>æœ¬åœ°é˜Ÿåˆ—</strong>ï¼šå­˜æ”¾æŸä¸€ä¸ªProcessorå³å°†è°ƒåº¦çš„Goroutine<ul>\n<li>ä¸€ä¸ªæœ¬åœ°é˜Ÿåˆ—ä¸­æœ€å¤šå®¹çº³256ä¸ªGoroutine</li>\n<li>å½“åˆ›å»ºä¸€ä¸ªGoroutineæ—¶ï¼Œä¼šä¼˜å…ˆå°†Goroutineæ”¾åœ¨æœ¬åœ°é˜Ÿåˆ—ä¸­ã€‚å¦‚æœæ²¡æœ‰æœ¬åœ°é˜Ÿåˆ—å­˜åœ¨ç©ºé—²ç©ºé—´ï¼Œé‚£ä¹ˆæ–°åˆ›å»ºçš„Goroutineå°±ä¼šè¢«æ”¾å…¥å…¨å±€é˜Ÿåˆ—</li>\n</ul>\n</li>\n<li><strong>GOMAXPROCS</strong>ï¼šé…ç½®é€»è¾‘å¤„ç†å™¨ä¸ªæ•°çš„å‚æ•°ï¼Œå†³å®šäº†Goroutineçš„<strong>å¹¶è¡Œ</strong>èƒ½åŠ›<ul>\n<li>å¯é€šè¿‡ç¯å¢ƒå˜é‡<code>$GOMAXPROCS</code>è®¾ç½®</li>\n<li>æˆ–è€…åœ¨ç¨‹åºä¸­é€šè¿‡<code>runtime.GOMAXPROCS()</code>æ¥è®¾ç½®</li>\n</ul>\n</li>\n</ul>\n<h2 id=\"è°ƒåº¦å™¨çš„è®¾è®¡ç­–ç•¥\"><a href=\"#è°ƒåº¦å™¨çš„è®¾è®¡ç­–ç•¥\" class=\"headerlink\" title=\"è°ƒåº¦å™¨çš„è®¾è®¡ç­–ç•¥\"></a>è°ƒåº¦å™¨çš„è®¾è®¡ç­–ç•¥</h2><ul>\n<li><strong>å¤ç”¨çº¿ç¨‹</strong>ï¼šé¿å…é¢‘ç¹åˆ›å»ºã€é”€æ¯çº¿ç¨‹å¸¦æ¥å·¨å¤§çš„å¼€é”€<ul>\n<li>work stealingï¼šå½“æœ¬çº¿ç¨‹æ— å¯è°ƒåº¦çš„Goroutineæ—¶ï¼Œå°±ä¼šâ€œå·å–â€å…¶ä»–çº¿ç¨‹å¾…æ‰§è¡Œçš„Goroutineæ¥æ‰§è¡Œ</li>\n<li>hand offï¼šå½“æœ¬çº¿ç¨‹è¿è¡Œçš„Goroutineå‘ç”Ÿäº†é˜»å¡ï¼Œå°±ä¼šåˆ›å»º&#x2F;å”¤é†’ä¸€ä¸ªæ–°çš„çº¿ç¨‹ï¼Œæ–°çº¿ç¨‹æ¥ç®¡è¿™ä¸ªé˜»å¡Gçš„P</li>\n</ul>\n</li>\n<li><strong>åˆ©ç”¨å¹¶è¡Œ</strong>ï¼šé€šè¿‡<code>GOMAXPROCS</code>å‚æ•°è°ƒèŠ‚å¯åŒæ—¶å·¥ä½œçš„Processorï¼Œå³æœ€å¤šæœ‰<code>GOMAXPROCS</code>ä¸ªåç¨‹å¹¶è¡Œå·¥ä½œ</li>\n<li><strong>æŠ¢å </strong>ï¼šcoroutineæ˜¯åä½œå¼çš„ï¼Œåªèƒ½ç”±coroutineä¸»åŠ¨è®©å‡ºCPUèµ„æºã€‚è€ŒGoè°ƒåº¦å™¨ä¸ºäº†è°ƒåº¦å…¬å¹³ï¼Œè§„å®šæ¯ä¸ªGoroutineæœ€å¤šå ç”¨10msCPUæ—¶é—´ï¼Œè¶…è¿‡è¿™ä¸ªæ—¶é—´å°±ä¼šè¢«å¼ºåˆ¶ä¸‹çº¿</li>\n<li><strong>å…¨å±€é˜Ÿåˆ—</strong>ï¼šå½“çº¿ç¨‹æ— æ³•ä»åˆ«çš„çº¿ç¨‹ä¸­â€œå·å–â€å¯è°ƒåº¦çš„Goroutineæ—¶ï¼Œå°±ä¼šä»å…¨å±€é˜Ÿåˆ—ä¸­è·å–ä¸€ä¸ªGoroutineè¿›è¡Œæ‰§è¡Œ</li>\n</ul>\n<h2 id=\"GoæŒ‡ä»¤çš„è°ƒåº¦æµç¨‹\"><a href=\"#GoæŒ‡ä»¤çš„è°ƒåº¦æµç¨‹\" class=\"headerlink\" title=\"GoæŒ‡ä»¤çš„è°ƒåº¦æµç¨‹\"></a>GoæŒ‡ä»¤çš„è°ƒåº¦æµç¨‹</h2><p><img src=\"https://raw.githubusercontent.com/lyydsheep/pic/main/202412221837093.png\" alt=\"image.png\"></p>\n<p>go func()å‘½ä»¤çš„æ‰§è¡Œæµç¨‹ï¼š</p>\n<ol>\n<li>åˆ›å»ºä¸€ä¸ªGoroutine</li>\n<li>å°è¯•å°†Goroutineæ”¾å…¥æœ¬çº¿ç¨‹ç»‘å®šçš„Pçš„æœ¬åœ°é˜Ÿåˆ—ä¸­ï¼Œå¦‚æœæœ¬åœ°é˜Ÿåˆ—å·²æ»¡ï¼Œé‚£ä¹ˆå°±æŠŠGoroutineæ”¾å…¥å…¨å±€é˜Ÿåˆ—ä¸­</li>\n<li>Mä¼šä»Pçš„æœ¬åœ°é˜Ÿåˆ—ä¸­å–å‡ºä¸€ä¸ªGoroutineæ‰§è¡Œï¼Œè‹¥æœ¬åœ°é˜Ÿåˆ—ä¸ºç©ºï¼Œé‚£å°±ä»åˆ«çš„MPç»„åˆæˆ–å…¨å±€é˜Ÿåˆ—ä¸­â€œå·â€ä¸€ä¸ªGoroutineæ‰§è¡Œ</li>\n<li>Må¾ªç¯è°ƒåº¦ä¸åŒçš„G</li>\n<li>å½“Måœ¨æ‰§è¡ŒGæ—¶å‘ç”Ÿäº†é˜»å¡ï¼Œruntimeä¼šæŠŠè¿™ä¸ªMå’ŒPè§£é™¤å…³è”ï¼Œç„¶ååˆ›å»º&#x2F;å”¤é†’ä¸€ä¸ªçº¿ç¨‹ï¼Œæ¥ç€è®©è¿™ä¸ªçº¿ç¨‹å–æœåŠ¡è§£é™¤å…³è”çš„P</li>\n<li>å½“Mè°ƒåº¦ç»“æŸåï¼ŒGä¼šå°è¯•è·å–ä¸€ä¸ªç©ºé—²çš„Pï¼Œå¹¶è¿›å…¥è¯¥Pçš„æœ¬åœ°é˜Ÿåˆ—ä¸­ï¼ŒMå’ŒPé‡æ–°å…³è”ã€‚å¦‚æœè·å–ä¸åˆ°ï¼Œé‚£ä¹ˆGä¼šè¢«æ”¾å…¥å…¨å±€é˜Ÿåˆ—ï¼ŒMåˆ™æ˜¯åŠ å…¥ç©ºé—²çº¿ç¨‹ä¸­ï¼Œè¿›å…¥ä¼‘çœ çŠ¶æ€</li>\n</ol>\n<h2 id=\"Goå¯åŠ¨å‘¨æœŸçš„M0å’ŒG0\"><a href=\"#Goå¯åŠ¨å‘¨æœŸçš„M0å’ŒG0\" class=\"headerlink\" title=\"Goå¯åŠ¨å‘¨æœŸçš„M0å’ŒG0\"></a>Goå¯åŠ¨å‘¨æœŸçš„M0å’ŒG0</h2><p><strong>M0</strong>ï¼šè¿›ç¨‹å¯åŠ¨æ—¶åˆ›å»ºçš„ç¬¬ä¸€ä¸ªçº¿ç¨‹ï¼Œç§°ä¸ºM0ã€‚M0å®ä¾‹ä¼šåœ¨å…¨å±€å˜é‡runtime.m0ä¸­ï¼Œä¸éœ€è¦åœ¨heapä¸­åˆ†é…ä¸­é—´ã€‚M0è´Ÿè´£æ‰§è¡Œä¸€äº›åˆå§‹åŒ–æ“ä½œï¼Œæ¥ç€ä¾¿å’Œæ™®é€šçº¿ç¨‹æ— å¼‚<br><strong>G0</strong>ï¼šæ¯ä¸€ä¸ªçº¿ç¨‹åœ¨è¢«åˆ›å»ºä¹‹åï¼Œä¼šç«‹å³åˆ›å»ºä¸€ä¸ªGoroutineï¼Œç§°ä¸ºG0ï¼Œå³æ¯ä¸€ä¸ªçº¿ç¨‹éƒ½æœ‰ä¸€ä¸ªå±äºè‡ªå·±çš„G0ã€‚G0ä¸æŒ‡å‘æŸä¸ªå…·ä½“çš„å‡½æ•°ï¼Œè€Œæ˜¯ä¸“é—¨è´Ÿè´£è°ƒåº¦æœ¬åœ°é˜Ÿåˆ—ä¸­çš„Gã€‚åœ¨è°ƒåº¦æˆ–ç³»ç»Ÿè°ƒåº¦æ—¶ï¼Œä¼šä½¿ç”¨G0çš„æ ˆç©ºé—´ï¼Œå…¨å±€å˜é‡G0å°±æ˜¯M0æ‰€åˆ›å»ºçš„G0</p>\n<h2 id=\"GMPå¯è§†åŒ–è°ƒè¯•\"><a href=\"#GMPå¯è§†åŒ–è°ƒè¯•\" class=\"headerlink\" title=\"GMPå¯è§†åŒ–è°ƒè¯•\"></a>GMPå¯è§†åŒ–è°ƒè¯•</h2><figure class=\"highlight go\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\">// åˆ›å»ºtrace.outæ–‡ä»¶</span></span><br><span class=\"line\">f, err := os.Create(<span class=\"string\">&quot;trace.out&quot;</span>)</span><br><span class=\"line\"><span class=\"keyword\">if</span> err != <span class=\"literal\">nil</span> &#123;&#125;</span><br><span class=\"line\"><span class=\"comment\">// å¯åŠ¨trace</span></span><br><span class=\"line\">err = trace.Start(f)</span><br><span class=\"line\"><span class=\"keyword\">if</span> err != <span class=\"literal\">nil</span> &#123;&#125;</span><br><span class=\"line\"><span class=\"comment\">// do something</span></span><br><span class=\"line\"><span class=\"comment\">// è¿™é‡Œæ˜¯ä¸šåŠ¡ä»£ç </span></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\">// åœæ­¢trace</span></span><br><span class=\"line\">trace.Stop()</span><br></pre></td></tr></table></figure>\n<p>è¿è¡Œç¨‹åºåï¼Œä¼šç”Ÿæˆä¸€ä¸ªåä¸ºtrace.outçš„æ–‡ä»¶ï¼Œå¯ä»¥ä½¿ç”¨<code>go tool trace $filename</code>å‘½ä»¤å¯¹è¿™ä¸ªæ–‡ä»¶è¿›è¡Œå¯è§†åŒ–åˆ†æ<br><img src=\"https://raw.githubusercontent.com/lyydsheep/pic/main/202412221942758.png\" alt=\"image.png\"></p>\n<p>å·¦æ è‡ªä¸Šè€Œä¸‹ä¾æ¬¡æ˜¯ï¼šGåç¨‹ä¿¡æ¯ã€å †æ ˆä¿¡æ¯ã€Mçº¿ç¨‹ä¿¡æ¯ã€Pè°ƒåº¦å™¨ä¿¡æ¯</p>\n<h2 id=\"GMPè°ƒåº¦åœºæ™¯å…¨è¿‡ç¨‹åˆ†æ\"><a href=\"#GMPè°ƒåº¦åœºæ™¯å…¨è¿‡ç¨‹åˆ†æ\" class=\"headerlink\" title=\"GMPè°ƒåº¦åœºæ™¯å…¨è¿‡ç¨‹åˆ†æ\"></a>GMPè°ƒåº¦åœºæ™¯å…¨è¿‡ç¨‹åˆ†æ</h2><h3 id=\"G1åˆ›å»ºGâ€™\"><a href=\"#G1åˆ›å»ºGâ€™\" class=\"headerlink\" title=\"G1åˆ›å»ºGâ€™\"></a>G1åˆ›å»ºGâ€™</h3><p>Pæ‹¥æœ‰G1ï¼ŒG1åœ¨è¿è¡Œè¿‡ç¨‹ä¸­è°ƒç”¨<code>go fun()</code>åˆ›å»ºäº†Gâ€˜ã€‚è€ƒè™‘åˆ°å±€éƒ¨æ€§ï¼Œä¼˜å…ˆå°†G2æ”¾å…¥åˆ°è¯¥Pçš„æœ¬åœ°é˜Ÿåˆ—ä¸­<br><img src=\"https://raw.githubusercontent.com/lyydsheep/pic/main/202412221958378.png\" style=\"zoom:70%\"></p>\n<h3 id=\"G1æ‰§è¡Œå®Œæ¯•\"><a href=\"#G1æ‰§è¡Œå®Œæ¯•\" class=\"headerlink\" title=\"G1æ‰§è¡Œå®Œæ¯•\"></a>G1æ‰§è¡Œå®Œæ¯•</h3><p>G1è¿è¡Œå®Œæ¯•åï¼ŒG0åˆ‡æ¢åˆ°Mä¸Šè¿è¡Œï¼ŒG0æ‰§è¡Œè°ƒåº¦å·¥ä½œï¼ˆscheduleå‡½æ•°)ï¼šä»Pçš„æœ¬åœ°é˜Ÿåˆ—ä¸­å–å‡ºG2ï¼ŒMä¸Šè¿è¡Œçš„Goroutineä»G0åˆ‡æ¢è‡³G2ï¼Œå¹¶å¼€å§‹è¿è¡ŒG2ï¼ˆexecuteå‡½æ•°ï¼‰ã€‚å®ç°çº¿ç¨‹çš„å¤ç”¨<br><img src=\"https://raw.githubusercontent.com/lyydsheep/pic/main/202412222006838.png\" alt=\"image.png\"></p>\n<h3 id=\"æœ¬åœ°é˜Ÿåˆ—å·²æ»¡ï¼Œå†åˆ›å»ºG\"><a href=\"#æœ¬åœ°é˜Ÿåˆ—å·²æ»¡ï¼Œå†åˆ›å»ºG\" class=\"headerlink\" title=\"æœ¬åœ°é˜Ÿåˆ—å·²æ»¡ï¼Œå†åˆ›å»ºG\"></a>æœ¬åœ°é˜Ÿåˆ—å·²æ»¡ï¼Œå†åˆ›å»ºG</h3><p>å¦‚æœå½“å‰è¿è¡Œçš„Gåˆ›å»ºäº†ä¸€ä¸ªGï¼Œæ°å·§Pçš„æœ¬åœ°é˜Ÿåˆ—æ— æ³•å†å®¹çº³æ–°åˆ›å»ºçš„Gæ—¶ï¼Œéœ€è¦å°†æœ¬åœ°é˜Ÿåˆ—ä¸­<strong>å‰åŠéƒ¨åˆ†çš„Gæ‰“ä¹±é¡ºåº</strong>ï¼Œè¿åŒæ–°åˆ›å»ºçš„Gä¸€èµ·æ”¾å…¥å…¨å±€é˜Ÿåˆ—ä¸­<br><img src=\"https://raw.githubusercontent.com/lyydsheep/pic/main/202412222017907.png\" alt=\"image.png\"></p>\n<h3 id=\"å”¤é†’æ­£åœ¨ä¼‘çœ çš„M\"><a href=\"#å”¤é†’æ­£åœ¨ä¼‘çœ çš„M\" class=\"headerlink\" title=\"å”¤é†’æ­£åœ¨ä¼‘çœ çš„M\"></a>å”¤é†’æ­£åœ¨ä¼‘çœ çš„M</h3><p>åœ¨ä¸€ä¸ªGåˆ›å»ºä¸€ä¸ªæ–°çš„Gæ—¶ï¼Œä¼šå°è¯•å”¤é†’ç­‰å¾…é˜Ÿåˆ—ä¸­çš„Mã€‚å‡è®¾å”¤é†’äº†M2ï¼ŒM2ä¼šå¯»æ‰¾ä¸€ä¸ªç©ºé—²çš„Pè¿›è¡Œç»‘å®šï¼Œå¹¶è¿è¡ŒG0ï¼Œæ‰§è¡Œåç¨‹çš„è°ƒåº¦ã€‚å¦‚æœPçš„æœ¬åœ°é˜Ÿåˆ—ä¸ºç©ºï¼Œé‚£ä¹ˆM2äºŸéœ€å¯»æ‰¾ä¸€ä¸ªGæ¥æ‰§è¡Œï¼Œæ­¤æ—¶M2å°±æ˜¯<strong>è‡ªæ—‹çº¿ç¨‹</strong><br><img src=\"https://raw.githubusercontent.com/lyydsheep/pic/main/202412222026925.png\" alt=\"image.png\"></p>\n<h3 id=\"è¢«å”¤é†’çš„M2ä»å…¨å±€é˜Ÿåˆ—ä¸­æ‰¹é‡å–G\"><a href=\"#è¢«å”¤é†’çš„M2ä»å…¨å±€é˜Ÿåˆ—ä¸­æ‰¹é‡å–G\" class=\"headerlink\" title=\"è¢«å”¤é†’çš„M2ä»å…¨å±€é˜Ÿåˆ—ä¸­æ‰¹é‡å–G\"></a>è¢«å”¤é†’çš„M2ä»å…¨å±€é˜Ÿåˆ—ä¸­æ‰¹é‡å–G</h3><p>è‡ªæ—‹çº¿ç¨‹M2ä¼šå°è¯•ä»å…¨å±€é˜Ÿåˆ—ä¸­è·å–Gæ‰§è¡Œï¼Œè·å–çš„Gçš„æ•°é‡ç”±<code>min(len(GQ)/2 + 1, len(GQ)/2)</code>å†³å®šï¼Œå…¶ä¸­<code>len(GQ)</code>è¡¨ç¤ºå…¨å±€é˜Ÿåˆ—ä¸­å…ƒç´ ä¸ªæ•°ã€‚M2æ‰¹é‡è·å–Gçš„è¿‡ç¨‹å«åšâ€<strong>ä»å…¨å±€é˜Ÿåˆ—åˆ°æœ¬åœ°é˜Ÿåˆ—çš„è´Ÿè½½å‡è¡¡</strong>â€œã€‚(æ„Ÿè§‰å°±æ˜¯ä¸ºäº†é¿å…æ‹‰å–å¤ªå¤šçš„Gï¼Œä¸€æ˜¯å¯¼è‡´æœ¬çº¿ç¨‹æ¶ˆåŒ–ä¸äº†ï¼ŒäºŒæ˜¯é¥¿æ­»åˆ«çš„çº¿ç¨‹ï¼‰<br><img src=\"https://raw.githubusercontent.com/lyydsheep/pic/main/202412222048979.png\" alt=\"image.png\"></p>\n<h3 id=\"å·å–Mçš„G\"><a href=\"#å·å–Mçš„G\" class=\"headerlink\" title=\"å·å–Mçš„G\"></a>å·å–Mçš„G</h3><p>å¦‚æœå…¨å±€é˜Ÿåˆ—å·²ç»æ²¡æœ‰Gäº†ï¼Œè‡ªæ—‹çº¿ç¨‹M2å°±ä¼šå°è¯•ä»åˆ«çš„çº¿ç¨‹ï¼ˆM1ï¼‰ä¸­å·å–ä¸€æ‰¹Gï¼Œæ”¾å…¥æœ¬åœ°é˜Ÿåˆ—ä¸­å‡†å¤‡è°ƒåº¦ã€‚å…·ä½“åœ°ï¼ŒM2ä¼šå·å–ï¼ŒM1æœ¬åœ°é˜Ÿåˆ—ä¸­<strong>ååŠéƒ¨åˆ†</strong>çš„Gä½œä¸ºæœ¬çº¿ç¨‹å³å°†æ‰§è¡Œè°ƒåº¦çš„Gï¼Œä¸‹å›¾ä¸­P1çš„æœ¬åœ°é˜Ÿåˆ—ååŠéƒ¨åˆ†åªæœ‰G8ï¼Œå› æ­¤G8è¢«M2å·å–æ‰§è¡Œ<br><img src=\"https://raw.githubusercontent.com/lyydsheep/pic/main/202412222131818.png\" alt=\"image.png\"></p>\n<h3 id=\"è‡ªæ—‹çº¿ç¨‹çš„é™åˆ¶\"><a href=\"#è‡ªæ—‹çº¿ç¨‹çš„é™åˆ¶\" class=\"headerlink\" title=\"è‡ªæ—‹çº¿ç¨‹çš„é™åˆ¶\"></a>è‡ªæ—‹çº¿ç¨‹çš„é™åˆ¶</h3><p>æœ€å¤šæœ‰<strong>GOMAXPROCS</strong>ä¸ªè‡ªæ—‹çº¿ç¨‹ï¼Œå³ä½¿æœ‰å†å¤šçš„çº¿ç¨‹ï¼Œä¹Ÿä¼šå› ä¸ºæ²¡æœ‰ç©ºé—²çš„Pè¿›è¡Œè°ƒåº¦è¿›å…¥ä¼‘çœ çŠ¶æ€</p>\n<h3 id=\"Gå‘ç”Ÿè°ƒç”¨é˜»å¡\"><a href=\"#Gå‘ç”Ÿè°ƒç”¨é˜»å¡\" class=\"headerlink\" title=\"Gå‘ç”Ÿè°ƒç”¨é˜»å¡\"></a>Gå‘ç”Ÿè°ƒç”¨é˜»å¡</h3><p>å½“G8å‘ç”Ÿäº†è°ƒç”¨é˜»å¡ï¼ŒP2ä¼šç«‹å³å’ŒM2è§£ç»‘ã€‚æ¥ä¸‹æ¥P2ä¼šåˆ¤æ–­æ˜¯å¦æœ‰çº¿ç¨‹å¤„äºä¼‘çœ çŠ¶æ€ï¼Œå¦‚æœæœ‰ï¼Œå°±å”¤é†’ä¸€ä¸ªçº¿ç¨‹å¹¶ä¸ä¹‹ç»‘å®šï¼Œå¦åˆ™P2ä¼šåŠ å…¥ç©ºé—²Påˆ—è¡¨ä¸­ï¼Œç­‰å¾…Mæ¥è·å–<br><img src=\"https://raw.githubusercontent.com/lyydsheep/pic/main/202412240928105.png\" alt=\"image.png\"></p>\n<p>Gå‘ç”Ÿç³»ç»Ÿè°ƒç”¨&#x2F;éé˜»å¡</p>\n<p>å½“G8ä»é˜»å¡çŠ¶æ€ä¸­æ¢å¤åï¼ŒM2æƒ³è¦è¿è¡ŒG8å¿…é¡»è¦æœ‰Pçš„æ”¯æŒã€‚é‚£ä¹ˆM2ä¼šå°è¯•é‡æ–°è·å–P2ï¼Œå¦‚æœå‘ç°P2å·²ç»è¢«ç»‘å®šï¼Œå°±å†å°è¯•ä»ç©ºé—²Pé˜Ÿåˆ—ä¸­è·å–ä¸€ä¸ªPã€‚å¦‚æœè·å–På¤±è´¥ï¼ŒG8å°±ä¼šè¢«æ”¾å…¥å…¨å±€é˜Ÿåˆ—ï¼ŒM2è¿›å…¥ä¼‘çœ çº¿ç¨‹é˜Ÿåˆ—<br><img src=\"https://raw.githubusercontent.com/lyydsheep/pic/main/202412240936232.png\" alt=\"image.png\"></p>\n","excerpt":"","more":"<p><a href=\"https://www.bilibili.com/video/BV19r4y1w7Nx/?spm_id_from=333.1387.homepage.video_card.click\">Golangæ·±å…¥ç†è§£GPMæ¨¡å‹</a>å­¦ä¹ ç¬”è®°</p>\n<p>åç¨‹è°ƒåº¦å™¨çš„æ ¸å¿ƒä½œç”¨å°±æ˜¯å°†åç¨‹å…³è”åˆ°å†…æ ¸çº¿ç¨‹ï¼Œå†…æ ¸çº¿ç¨‹æ— éœ€åˆ‡æ¢å°±èƒ½æ‰§è¡Œç”¨æˆ·æ€ä¸­çš„ä¸åŒåŠŸèƒ½ï¼Œæé«˜äº†å¹¶å‘åº¦</p>\n<h2 id=\"GMPæ¨¡å‹\"><a href=\"#GMPæ¨¡å‹\" class=\"headerlink\" title=\"GMPæ¨¡å‹\"></a>GMPæ¨¡å‹</h2><p>GMPæ¨¡å‹è®¾è®¡å¸ƒå±€å¦‚ä¸‹å›¾æ‰€ç¤ºï¼š</p>\n<img src=\"https://raw.githubusercontent.com/lyydsheep/pic/main/202412212114507.png\" style=\"zoom:80%\">\n\n<ul>\n<li><strong>G</strong>ï¼šGoroutineï¼ŒGoåç¨‹</li>\n<li><strong>P</strong>ï¼šProcessorï¼Œé€»è¾‘å¤„ç†å™¨</li>\n<li><strong>M</strong>ï¼šMachineï¼Œç³»ç»Ÿçº§çº¿ç¨‹</li>\n<li><strong>å…¨å±€é˜Ÿåˆ—</strong>ï¼šå­˜æ”¾å¾…è°ƒåº¦çš„Goroutine</li>\n<li><strong>æœ¬åœ°é˜Ÿåˆ—</strong>ï¼šå­˜æ”¾æŸä¸€ä¸ªProcessorå³å°†è°ƒåº¦çš„Goroutine<ul>\n<li>ä¸€ä¸ªæœ¬åœ°é˜Ÿåˆ—ä¸­æœ€å¤šå®¹çº³256ä¸ªGoroutine</li>\n<li>å½“åˆ›å»ºä¸€ä¸ªGoroutineæ—¶ï¼Œä¼šä¼˜å…ˆå°†Goroutineæ”¾åœ¨æœ¬åœ°é˜Ÿåˆ—ä¸­ã€‚å¦‚æœæ²¡æœ‰æœ¬åœ°é˜Ÿåˆ—å­˜åœ¨ç©ºé—²ç©ºé—´ï¼Œé‚£ä¹ˆæ–°åˆ›å»ºçš„Goroutineå°±ä¼šè¢«æ”¾å…¥å…¨å±€é˜Ÿåˆ—</li>\n</ul>\n</li>\n<li><strong>GOMAXPROCS</strong>ï¼šé…ç½®é€»è¾‘å¤„ç†å™¨ä¸ªæ•°çš„å‚æ•°ï¼Œå†³å®šäº†Goroutineçš„<strong>å¹¶è¡Œ</strong>èƒ½åŠ›<ul>\n<li>å¯é€šè¿‡ç¯å¢ƒå˜é‡<code>$GOMAXPROCS</code>è®¾ç½®</li>\n<li>æˆ–è€…åœ¨ç¨‹åºä¸­é€šè¿‡<code>runtime.GOMAXPROCS()</code>æ¥è®¾ç½®</li>\n</ul>\n</li>\n</ul>\n<h2 id=\"è°ƒåº¦å™¨çš„è®¾è®¡ç­–ç•¥\"><a href=\"#è°ƒåº¦å™¨çš„è®¾è®¡ç­–ç•¥\" class=\"headerlink\" title=\"è°ƒåº¦å™¨çš„è®¾è®¡ç­–ç•¥\"></a>è°ƒåº¦å™¨çš„è®¾è®¡ç­–ç•¥</h2><ul>\n<li><strong>å¤ç”¨çº¿ç¨‹</strong>ï¼šé¿å…é¢‘ç¹åˆ›å»ºã€é”€æ¯çº¿ç¨‹å¸¦æ¥å·¨å¤§çš„å¼€é”€<ul>\n<li>work stealingï¼šå½“æœ¬çº¿ç¨‹æ— å¯è°ƒåº¦çš„Goroutineæ—¶ï¼Œå°±ä¼šâ€œå·å–â€å…¶ä»–çº¿ç¨‹å¾…æ‰§è¡Œçš„Goroutineæ¥æ‰§è¡Œ</li>\n<li>hand offï¼šå½“æœ¬çº¿ç¨‹è¿è¡Œçš„Goroutineå‘ç”Ÿäº†é˜»å¡ï¼Œå°±ä¼šåˆ›å»º&#x2F;å”¤é†’ä¸€ä¸ªæ–°çš„çº¿ç¨‹ï¼Œæ–°çº¿ç¨‹æ¥ç®¡è¿™ä¸ªé˜»å¡Gçš„P</li>\n</ul>\n</li>\n<li><strong>åˆ©ç”¨å¹¶è¡Œ</strong>ï¼šé€šè¿‡<code>GOMAXPROCS</code>å‚æ•°è°ƒèŠ‚å¯åŒæ—¶å·¥ä½œçš„Processorï¼Œå³æœ€å¤šæœ‰<code>GOMAXPROCS</code>ä¸ªåç¨‹å¹¶è¡Œå·¥ä½œ</li>\n<li><strong>æŠ¢å </strong>ï¼šcoroutineæ˜¯åä½œå¼çš„ï¼Œåªèƒ½ç”±coroutineä¸»åŠ¨è®©å‡ºCPUèµ„æºã€‚è€ŒGoè°ƒåº¦å™¨ä¸ºäº†è°ƒåº¦å…¬å¹³ï¼Œè§„å®šæ¯ä¸ªGoroutineæœ€å¤šå ç”¨10msCPUæ—¶é—´ï¼Œè¶…è¿‡è¿™ä¸ªæ—¶é—´å°±ä¼šè¢«å¼ºåˆ¶ä¸‹çº¿</li>\n<li><strong>å…¨å±€é˜Ÿåˆ—</strong>ï¼šå½“çº¿ç¨‹æ— æ³•ä»åˆ«çš„çº¿ç¨‹ä¸­â€œå·å–â€å¯è°ƒåº¦çš„Goroutineæ—¶ï¼Œå°±ä¼šä»å…¨å±€é˜Ÿåˆ—ä¸­è·å–ä¸€ä¸ªGoroutineè¿›è¡Œæ‰§è¡Œ</li>\n</ul>\n<h2 id=\"GoæŒ‡ä»¤çš„è°ƒåº¦æµç¨‹\"><a href=\"#GoæŒ‡ä»¤çš„è°ƒåº¦æµç¨‹\" class=\"headerlink\" title=\"GoæŒ‡ä»¤çš„è°ƒåº¦æµç¨‹\"></a>GoæŒ‡ä»¤çš„è°ƒåº¦æµç¨‹</h2><p><img src=\"https://raw.githubusercontent.com/lyydsheep/pic/main/202412221837093.png\" alt=\"image.png\"></p>\n<p>go func()å‘½ä»¤çš„æ‰§è¡Œæµç¨‹ï¼š</p>\n<ol>\n<li>åˆ›å»ºä¸€ä¸ªGoroutine</li>\n<li>å°è¯•å°†Goroutineæ”¾å…¥æœ¬çº¿ç¨‹ç»‘å®šçš„Pçš„æœ¬åœ°é˜Ÿåˆ—ä¸­ï¼Œå¦‚æœæœ¬åœ°é˜Ÿåˆ—å·²æ»¡ï¼Œé‚£ä¹ˆå°±æŠŠGoroutineæ”¾å…¥å…¨å±€é˜Ÿåˆ—ä¸­</li>\n<li>Mä¼šä»Pçš„æœ¬åœ°é˜Ÿåˆ—ä¸­å–å‡ºä¸€ä¸ªGoroutineæ‰§è¡Œï¼Œè‹¥æœ¬åœ°é˜Ÿåˆ—ä¸ºç©ºï¼Œé‚£å°±ä»åˆ«çš„MPç»„åˆæˆ–å…¨å±€é˜Ÿåˆ—ä¸­â€œå·â€ä¸€ä¸ªGoroutineæ‰§è¡Œ</li>\n<li>Må¾ªç¯è°ƒåº¦ä¸åŒçš„G</li>\n<li>å½“Måœ¨æ‰§è¡ŒGæ—¶å‘ç”Ÿäº†é˜»å¡ï¼Œruntimeä¼šæŠŠè¿™ä¸ªMå’ŒPè§£é™¤å…³è”ï¼Œç„¶ååˆ›å»º&#x2F;å”¤é†’ä¸€ä¸ªçº¿ç¨‹ï¼Œæ¥ç€è®©è¿™ä¸ªçº¿ç¨‹å–æœåŠ¡è§£é™¤å…³è”çš„P</li>\n<li>å½“Mè°ƒåº¦ç»“æŸåï¼ŒGä¼šå°è¯•è·å–ä¸€ä¸ªç©ºé—²çš„Pï¼Œå¹¶è¿›å…¥è¯¥Pçš„æœ¬åœ°é˜Ÿåˆ—ä¸­ï¼ŒMå’ŒPé‡æ–°å…³è”ã€‚å¦‚æœè·å–ä¸åˆ°ï¼Œé‚£ä¹ˆGä¼šè¢«æ”¾å…¥å…¨å±€é˜Ÿåˆ—ï¼ŒMåˆ™æ˜¯åŠ å…¥ç©ºé—²çº¿ç¨‹ä¸­ï¼Œè¿›å…¥ä¼‘çœ çŠ¶æ€</li>\n</ol>\n<h2 id=\"Goå¯åŠ¨å‘¨æœŸçš„M0å’ŒG0\"><a href=\"#Goå¯åŠ¨å‘¨æœŸçš„M0å’ŒG0\" class=\"headerlink\" title=\"Goå¯åŠ¨å‘¨æœŸçš„M0å’ŒG0\"></a>Goå¯åŠ¨å‘¨æœŸçš„M0å’ŒG0</h2><p><strong>M0</strong>ï¼šè¿›ç¨‹å¯åŠ¨æ—¶åˆ›å»ºçš„ç¬¬ä¸€ä¸ªçº¿ç¨‹ï¼Œç§°ä¸ºM0ã€‚M0å®ä¾‹ä¼šåœ¨å…¨å±€å˜é‡runtime.m0ä¸­ï¼Œä¸éœ€è¦åœ¨heapä¸­åˆ†é…ä¸­é—´ã€‚M0è´Ÿè´£æ‰§è¡Œä¸€äº›åˆå§‹åŒ–æ“ä½œï¼Œæ¥ç€ä¾¿å’Œæ™®é€šçº¿ç¨‹æ— å¼‚<br><strong>G0</strong>ï¼šæ¯ä¸€ä¸ªçº¿ç¨‹åœ¨è¢«åˆ›å»ºä¹‹åï¼Œä¼šç«‹å³åˆ›å»ºä¸€ä¸ªGoroutineï¼Œç§°ä¸ºG0ï¼Œå³æ¯ä¸€ä¸ªçº¿ç¨‹éƒ½æœ‰ä¸€ä¸ªå±äºè‡ªå·±çš„G0ã€‚G0ä¸æŒ‡å‘æŸä¸ªå…·ä½“çš„å‡½æ•°ï¼Œè€Œæ˜¯ä¸“é—¨è´Ÿè´£è°ƒåº¦æœ¬åœ°é˜Ÿåˆ—ä¸­çš„Gã€‚åœ¨è°ƒåº¦æˆ–ç³»ç»Ÿè°ƒåº¦æ—¶ï¼Œä¼šä½¿ç”¨G0çš„æ ˆç©ºé—´ï¼Œå…¨å±€å˜é‡G0å°±æ˜¯M0æ‰€åˆ›å»ºçš„G0</p>\n<h2 id=\"GMPå¯è§†åŒ–è°ƒè¯•\"><a href=\"#GMPå¯è§†åŒ–è°ƒè¯•\" class=\"headerlink\" title=\"GMPå¯è§†åŒ–è°ƒè¯•\"></a>GMPå¯è§†åŒ–è°ƒè¯•</h2><figure class=\"highlight go\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\">// åˆ›å»ºtrace.outæ–‡ä»¶</span></span><br><span class=\"line\">f, err := os.Create(<span class=\"string\">&quot;trace.out&quot;</span>)</span><br><span class=\"line\"><span class=\"keyword\">if</span> err != <span class=\"literal\">nil</span> &#123;&#125;</span><br><span class=\"line\"><span class=\"comment\">// å¯åŠ¨trace</span></span><br><span class=\"line\">err = trace.Start(f)</span><br><span class=\"line\"><span class=\"keyword\">if</span> err != <span class=\"literal\">nil</span> &#123;&#125;</span><br><span class=\"line\"><span class=\"comment\">// do something</span></span><br><span class=\"line\"><span class=\"comment\">// è¿™é‡Œæ˜¯ä¸šåŠ¡ä»£ç </span></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\">// åœæ­¢trace</span></span><br><span class=\"line\">trace.Stop()</span><br></pre></td></tr></table></figure>\n<p>è¿è¡Œç¨‹åºåï¼Œä¼šç”Ÿæˆä¸€ä¸ªåä¸ºtrace.outçš„æ–‡ä»¶ï¼Œå¯ä»¥ä½¿ç”¨<code>go tool trace $filename</code>å‘½ä»¤å¯¹è¿™ä¸ªæ–‡ä»¶è¿›è¡Œå¯è§†åŒ–åˆ†æ<br><img src=\"https://raw.githubusercontent.com/lyydsheep/pic/main/202412221942758.png\" alt=\"image.png\"></p>\n<p>å·¦æ è‡ªä¸Šè€Œä¸‹ä¾æ¬¡æ˜¯ï¼šGåç¨‹ä¿¡æ¯ã€å †æ ˆä¿¡æ¯ã€Mçº¿ç¨‹ä¿¡æ¯ã€Pè°ƒåº¦å™¨ä¿¡æ¯</p>\n<h2 id=\"GMPè°ƒåº¦åœºæ™¯å…¨è¿‡ç¨‹åˆ†æ\"><a href=\"#GMPè°ƒåº¦åœºæ™¯å…¨è¿‡ç¨‹åˆ†æ\" class=\"headerlink\" title=\"GMPè°ƒåº¦åœºæ™¯å…¨è¿‡ç¨‹åˆ†æ\"></a>GMPè°ƒåº¦åœºæ™¯å…¨è¿‡ç¨‹åˆ†æ</h2><h3 id=\"G1åˆ›å»ºGâ€™\"><a href=\"#G1åˆ›å»ºGâ€™\" class=\"headerlink\" title=\"G1åˆ›å»ºGâ€™\"></a>G1åˆ›å»ºGâ€™</h3><p>Pæ‹¥æœ‰G1ï¼ŒG1åœ¨è¿è¡Œè¿‡ç¨‹ä¸­è°ƒç”¨<code>go fun()</code>åˆ›å»ºäº†Gâ€˜ã€‚è€ƒè™‘åˆ°å±€éƒ¨æ€§ï¼Œä¼˜å…ˆå°†G2æ”¾å…¥åˆ°è¯¥Pçš„æœ¬åœ°é˜Ÿåˆ—ä¸­<br><img src=\"https://raw.githubusercontent.com/lyydsheep/pic/main/202412221958378.png\" style=\"zoom:70%\"></p>\n<h3 id=\"G1æ‰§è¡Œå®Œæ¯•\"><a href=\"#G1æ‰§è¡Œå®Œæ¯•\" class=\"headerlink\" title=\"G1æ‰§è¡Œå®Œæ¯•\"></a>G1æ‰§è¡Œå®Œæ¯•</h3><p>G1è¿è¡Œå®Œæ¯•åï¼ŒG0åˆ‡æ¢åˆ°Mä¸Šè¿è¡Œï¼ŒG0æ‰§è¡Œè°ƒåº¦å·¥ä½œï¼ˆscheduleå‡½æ•°)ï¼šä»Pçš„æœ¬åœ°é˜Ÿåˆ—ä¸­å–å‡ºG2ï¼ŒMä¸Šè¿è¡Œçš„Goroutineä»G0åˆ‡æ¢è‡³G2ï¼Œå¹¶å¼€å§‹è¿è¡ŒG2ï¼ˆexecuteå‡½æ•°ï¼‰ã€‚å®ç°çº¿ç¨‹çš„å¤ç”¨<br><img src=\"https://raw.githubusercontent.com/lyydsheep/pic/main/202412222006838.png\" alt=\"image.png\"></p>\n<h3 id=\"æœ¬åœ°é˜Ÿåˆ—å·²æ»¡ï¼Œå†åˆ›å»ºG\"><a href=\"#æœ¬åœ°é˜Ÿåˆ—å·²æ»¡ï¼Œå†åˆ›å»ºG\" class=\"headerlink\" title=\"æœ¬åœ°é˜Ÿåˆ—å·²æ»¡ï¼Œå†åˆ›å»ºG\"></a>æœ¬åœ°é˜Ÿåˆ—å·²æ»¡ï¼Œå†åˆ›å»ºG</h3><p>å¦‚æœå½“å‰è¿è¡Œçš„Gåˆ›å»ºäº†ä¸€ä¸ªGï¼Œæ°å·§Pçš„æœ¬åœ°é˜Ÿåˆ—æ— æ³•å†å®¹çº³æ–°åˆ›å»ºçš„Gæ—¶ï¼Œéœ€è¦å°†æœ¬åœ°é˜Ÿåˆ—ä¸­<strong>å‰åŠéƒ¨åˆ†çš„Gæ‰“ä¹±é¡ºåº</strong>ï¼Œè¿åŒæ–°åˆ›å»ºçš„Gä¸€èµ·æ”¾å…¥å…¨å±€é˜Ÿåˆ—ä¸­<br><img src=\"https://raw.githubusercontent.com/lyydsheep/pic/main/202412222017907.png\" alt=\"image.png\"></p>\n<h3 id=\"å”¤é†’æ­£åœ¨ä¼‘çœ çš„M\"><a href=\"#å”¤é†’æ­£åœ¨ä¼‘çœ çš„M\" class=\"headerlink\" title=\"å”¤é†’æ­£åœ¨ä¼‘çœ çš„M\"></a>å”¤é†’æ­£åœ¨ä¼‘çœ çš„M</h3><p>åœ¨ä¸€ä¸ªGåˆ›å»ºä¸€ä¸ªæ–°çš„Gæ—¶ï¼Œä¼šå°è¯•å”¤é†’ç­‰å¾…é˜Ÿåˆ—ä¸­çš„Mã€‚å‡è®¾å”¤é†’äº†M2ï¼ŒM2ä¼šå¯»æ‰¾ä¸€ä¸ªç©ºé—²çš„Pè¿›è¡Œç»‘å®šï¼Œå¹¶è¿è¡ŒG0ï¼Œæ‰§è¡Œåç¨‹çš„è°ƒåº¦ã€‚å¦‚æœPçš„æœ¬åœ°é˜Ÿåˆ—ä¸ºç©ºï¼Œé‚£ä¹ˆM2äºŸéœ€å¯»æ‰¾ä¸€ä¸ªGæ¥æ‰§è¡Œï¼Œæ­¤æ—¶M2å°±æ˜¯<strong>è‡ªæ—‹çº¿ç¨‹</strong><br><img src=\"https://raw.githubusercontent.com/lyydsheep/pic/main/202412222026925.png\" alt=\"image.png\"></p>\n<h3 id=\"è¢«å”¤é†’çš„M2ä»å…¨å±€é˜Ÿåˆ—ä¸­æ‰¹é‡å–G\"><a href=\"#è¢«å”¤é†’çš„M2ä»å…¨å±€é˜Ÿåˆ—ä¸­æ‰¹é‡å–G\" class=\"headerlink\" title=\"è¢«å”¤é†’çš„M2ä»å…¨å±€é˜Ÿåˆ—ä¸­æ‰¹é‡å–G\"></a>è¢«å”¤é†’çš„M2ä»å…¨å±€é˜Ÿåˆ—ä¸­æ‰¹é‡å–G</h3><p>è‡ªæ—‹çº¿ç¨‹M2ä¼šå°è¯•ä»å…¨å±€é˜Ÿåˆ—ä¸­è·å–Gæ‰§è¡Œï¼Œè·å–çš„Gçš„æ•°é‡ç”±<code>min(len(GQ)/2 + 1, len(GQ)/2)</code>å†³å®šï¼Œå…¶ä¸­<code>len(GQ)</code>è¡¨ç¤ºå…¨å±€é˜Ÿåˆ—ä¸­å…ƒç´ ä¸ªæ•°ã€‚M2æ‰¹é‡è·å–Gçš„è¿‡ç¨‹å«åšâ€<strong>ä»å…¨å±€é˜Ÿåˆ—åˆ°æœ¬åœ°é˜Ÿåˆ—çš„è´Ÿè½½å‡è¡¡</strong>â€œã€‚(æ„Ÿè§‰å°±æ˜¯ä¸ºäº†é¿å…æ‹‰å–å¤ªå¤šçš„Gï¼Œä¸€æ˜¯å¯¼è‡´æœ¬çº¿ç¨‹æ¶ˆåŒ–ä¸äº†ï¼ŒäºŒæ˜¯é¥¿æ­»åˆ«çš„çº¿ç¨‹ï¼‰<br><img src=\"https://raw.githubusercontent.com/lyydsheep/pic/main/202412222048979.png\" alt=\"image.png\"></p>\n<h3 id=\"å·å–Mçš„G\"><a href=\"#å·å–Mçš„G\" class=\"headerlink\" title=\"å·å–Mçš„G\"></a>å·å–Mçš„G</h3><p>å¦‚æœå…¨å±€é˜Ÿåˆ—å·²ç»æ²¡æœ‰Gäº†ï¼Œè‡ªæ—‹çº¿ç¨‹M2å°±ä¼šå°è¯•ä»åˆ«çš„çº¿ç¨‹ï¼ˆM1ï¼‰ä¸­å·å–ä¸€æ‰¹Gï¼Œæ”¾å…¥æœ¬åœ°é˜Ÿåˆ—ä¸­å‡†å¤‡è°ƒåº¦ã€‚å…·ä½“åœ°ï¼ŒM2ä¼šå·å–ï¼ŒM1æœ¬åœ°é˜Ÿåˆ—ä¸­<strong>ååŠéƒ¨åˆ†</strong>çš„Gä½œä¸ºæœ¬çº¿ç¨‹å³å°†æ‰§è¡Œè°ƒåº¦çš„Gï¼Œä¸‹å›¾ä¸­P1çš„æœ¬åœ°é˜Ÿåˆ—ååŠéƒ¨åˆ†åªæœ‰G8ï¼Œå› æ­¤G8è¢«M2å·å–æ‰§è¡Œ<br><img src=\"https://raw.githubusercontent.com/lyydsheep/pic/main/202412222131818.png\" alt=\"image.png\"></p>\n<h3 id=\"è‡ªæ—‹çº¿ç¨‹çš„é™åˆ¶\"><a href=\"#è‡ªæ—‹çº¿ç¨‹çš„é™åˆ¶\" class=\"headerlink\" title=\"è‡ªæ—‹çº¿ç¨‹çš„é™åˆ¶\"></a>è‡ªæ—‹çº¿ç¨‹çš„é™åˆ¶</h3><p>æœ€å¤šæœ‰<strong>GOMAXPROCS</strong>ä¸ªè‡ªæ—‹çº¿ç¨‹ï¼Œå³ä½¿æœ‰å†å¤šçš„çº¿ç¨‹ï¼Œä¹Ÿä¼šå› ä¸ºæ²¡æœ‰ç©ºé—²çš„Pè¿›è¡Œè°ƒåº¦è¿›å…¥ä¼‘çœ çŠ¶æ€</p>\n<h3 id=\"Gå‘ç”Ÿè°ƒç”¨é˜»å¡\"><a href=\"#Gå‘ç”Ÿè°ƒç”¨é˜»å¡\" class=\"headerlink\" title=\"Gå‘ç”Ÿè°ƒç”¨é˜»å¡\"></a>Gå‘ç”Ÿè°ƒç”¨é˜»å¡</h3><p>å½“G8å‘ç”Ÿäº†è°ƒç”¨é˜»å¡ï¼ŒP2ä¼šç«‹å³å’ŒM2è§£ç»‘ã€‚æ¥ä¸‹æ¥P2ä¼šåˆ¤æ–­æ˜¯å¦æœ‰çº¿ç¨‹å¤„äºä¼‘çœ çŠ¶æ€ï¼Œå¦‚æœæœ‰ï¼Œå°±å”¤é†’ä¸€ä¸ªçº¿ç¨‹å¹¶ä¸ä¹‹ç»‘å®šï¼Œå¦åˆ™P2ä¼šåŠ å…¥ç©ºé—²Påˆ—è¡¨ä¸­ï¼Œç­‰å¾…Mæ¥è·å–<br><img src=\"https://raw.githubusercontent.com/lyydsheep/pic/main/202412240928105.png\" alt=\"image.png\"></p>\n<p>Gå‘ç”Ÿç³»ç»Ÿè°ƒç”¨&#x2F;éé˜»å¡</p>\n<p>å½“G8ä»é˜»å¡çŠ¶æ€ä¸­æ¢å¤åï¼ŒM2æƒ³è¦è¿è¡ŒG8å¿…é¡»è¦æœ‰Pçš„æ”¯æŒã€‚é‚£ä¹ˆM2ä¼šå°è¯•é‡æ–°è·å–P2ï¼Œå¦‚æœå‘ç°P2å·²ç»è¢«ç»‘å®šï¼Œå°±å†å°è¯•ä»ç©ºé—²Pé˜Ÿåˆ—ä¸­è·å–ä¸€ä¸ªPã€‚å¦‚æœè·å–På¤±è´¥ï¼ŒG8å°±ä¼šè¢«æ”¾å…¥å…¨å±€é˜Ÿåˆ—ï¼ŒM2è¿›å…¥ä¼‘çœ çº¿ç¨‹é˜Ÿåˆ—<br><img src=\"https://raw.githubusercontent.com/lyydsheep/pic/main/202412240936232.png\" alt=\"image.png\"></p>\n"},{"description":"è®°å½•Goæ•°æ®ç»“æ„ç›¸å…³çŸ¥è¯†","date":"2024-12-11T16:00:00.000Z","_content":"\n\n\n# Goæ•°æ®ç»“æ„\n\n## string\n\nGoè¯­è¨€ä¸­ï¼Œstringå¯ä»¥çœ‹ä½œæ˜¯æ‰€æœ‰**8bit å­—èŠ‚**çš„é›†åˆï¼Œä¸€ä¸ªå­—èŠ‚æ•°ç»„ã€‚\n\n- å­—ç¬¦ä¸²å¯ä»¥ä¸ºç©ºä¸²ï¼Œä½†ä¸èƒ½ä¸ºnil\n- å­—ç¬¦ä¸²çš„å­—é¢å€¼æ˜¯åªè¯»çš„ï¼Œä¸å¯ä»¥è¢«ä¿®æ”¹\n  - å­—ç¬¦ä¸²æ˜¯ä¸èƒ½è¢«ä¿®æ”¹çš„ï¼Œä½†æ˜¯å˜é‡å¯ä»¥é‡æ–°èµ‹å€¼\n\nåœ¨æºç ä¸­ä¹Ÿç»™å‡ºäº†stringçš„ç»“æ„ï¼šå…¶ä¸­`str`æ˜¯**æŒ‡å‘å­—ç¬¦ä¸²é¦–åœ°å€çš„æŒ‡é’ˆ**ã€`len`è¡¨ç¤º**å­—ç¬¦ä¸²çš„é•¿åº¦**\n\n```go\ntype stringStruct struct {\n    str unsafe.Pointer\n    len int\n}\n```\n\nğŸŒ°ï¼š\n\n<img src=\"https://raw.githubusercontent.com/lyydsheep/pic/main/202410051022321.png\" alt=\"image-20241005102225290\" style=\"zoom:67%;\" />\n\nå€¼å¾—æ³¨æ„çš„æ˜¯ï¼Œ**lenè¡¨ç¤ºå­—ç¬¦ä¸²é•¿åº¦æ˜¯ä»¥å­—èŠ‚æ•°è®¡é‡çš„**ï¼Œè€Œéå­—ç¬¦æ•°ã€‚\n\nä¸¾ä¸ªğŸŒ°ï¼šå­—ç¬¦ä¸²`hello`çš„å­—èŠ‚æ•°å’Œå­—ç¬¦æ•°æ˜¯5ï¼Œé•¿åº¦ä¹Ÿæ˜¯5ï¼›è€Œå­—ç¬¦ä¸²`helloå•Š`çš„å­—èŠ‚æ•°æ˜¯8ã€å­—ç¬¦æ•°æ˜¯6ï¼Œè€Œé•¿åº¦åŒå­—èŠ‚æ•°ä¸€æ ·æ˜¯8\n\næ‰€ä»¥å¯¹åŒ…å«éå•å­—èŠ‚ç¼–ç çš„å­—ç¬¦çš„å­—ç¬¦ä¸²è¿›è¡Œ`len()`æ“ä½œï¼Œå¯èƒ½ä¼šå¾—åˆ°æ„æƒ³ä¸åˆ°çš„ç»“æœ\n\n### stringå’Œ[]byteçš„äº’ç›¸è½¬æ¢\n\nstringå’Œ[]byteçš„è½¬åŒ–ï¼ˆä¸€èˆ¬ï¼‰ä¼šå‘ç”Ÿä¸€æ¬¡å†…å­˜æ‹·è´ï¼Œå¹¶ç”³è¯·ä¸€å—æ–°çš„åˆ‡ç‰‡å†…å­˜ç©ºé—´\n\n**[]byteè½¬ä¸ºstringçš„å¤§è‡´è¿‡ç¨‹ï¼š**\n\n- ç”³è¯·ä¸€å—æ–°çš„å†…å­˜ç©ºé—´ï¼Œå¹¶è®°å½•é¦–åœ°å€`addr`å’Œå­—èŠ‚é•¿åº¦`len`\n- æ„å»ºstringå¯¹è±¡ï¼ŒæŒ‡é’ˆåœ°å€ä¸º`addr`ï¼Œ`len`å­—æ®µèµ‹å€¼ä¸º`len`\n- å°†æºå­—èŠ‚åˆ‡ç‰‡ä¸­çš„æ•°æ®æ‹·è´åˆ°åˆšç”³è¯·çš„å†…å­˜ç©ºé—´ä¸­\n\n![image-20241005103541446](https://raw.githubusercontent.com/lyydsheep/pic/main/202410051035476.png)\n\nstringè½¬ä¸º[]byteçš„å¤§è‡´è¿‡ç¨‹ï¼š\n\n- ç”³è¯·ä¸€å—æ–°çš„å†…å­˜ç©ºé—´\n\n- å°†stringæŒ‡é’ˆæ‰€æŒ‡å‘çš„å†…å­˜åŒºåŸŸæ‹·è´`len`å­—èŠ‚åˆ°åˆšç”³è¯·çš„ç©ºé—´ä¸­\n\n  ![image-20241005103722955](https://raw.githubusercontent.com/lyydsheep/pic/main/202410051037987.png)\n\nâš ï¸ï¼šå½“**è½¬åŒ–ä¸ºçš„å­—ç¬¦ä¸²è¢«ç”¨äºä¸´æ—¶åœºæ™¯æ—¶**ï¼Œstringå’Œ[]byteä¹‹é—´çš„è½¬æ¢å¹¶**ä¸ä¼šå‘ç”Ÿæ‹·è´**\n\nä¾‹å¦‚ï¼š\n\n- å­—ç¬¦ä¸²æ¯”è¾ƒï¼šstring(ss) == \"hello\"\n- å­—ç¬¦ä¸²æ‹¼æ¥ï¼š\"hello\" + string(ss) + \"world\"\n- ç”¨äºæŸ¥æ‰¾ï¼šk, v := map[string(ss)]\n\nåœ¨ä¸Šè¿°åœºæ™¯ä¸­ï¼Œ[]byteè½¬æ¢çš„å­—ç¬¦ä¸²åªæœ‰ä¸´æ—¶ä½œç”¨ï¼Œåœ¨åç»­ç¨‹åºä¸­ä¸ä¼šå†æ¬¡ä½¿ç”¨ï¼Œæ‰€ä»¥å¹¶ä¸ä¼šæ‹·è´åˆ°å†…å­˜ï¼Œè€Œæ˜¯ç›´æ¥è¿”å›ä¸€ä¸ªstringï¼Œè¿™ä¸ªstringçš„æŒ‡é’ˆå°±æŒ‡å‘å­—èŠ‚åˆ‡ç‰‡çš„å†…å­˜åœ°å€\n\n## slice\n\nåœ¨Goè¯­è¨€ä¸­ï¼Œsliceæ˜¯åŸºäºæ•°ç»„å°è£…å‡ºæ¥çš„æŠ½è±¡æ•°æ®ç»“æ„ã€‚å› æ­¤åœ¨è§£æsliceä¹‹å‰ï¼Œéœ€è¦å…ˆè®¤è¯†è®¤è¯†golangä¸­çš„æ•°ç»„ã€‚\n\nGoè¯­è¨€ä¸­çš„æ•°ç»„æ˜¯ä¸€ç§å€¼ç±»å‹ï¼Œå’ŒCè¯­è¨€ä¸­çš„æŒ‡é’ˆç±»å‹ä¸åŒï¼Œæ‰€ä»¥åœ¨Goä¸­å¯¹æ•°ç»„è¿›è¡Œå¤åˆ¶ã€ä¼ å‚éƒ½æ˜¯è¿›è¡Œ**å€¼å¤åˆ¶**æ“ä½œï¼Œå°±å’Œ`int`ã€`float64`è¿™äº›åŸºæœ¬æ•°æ®ç±»å‹ç±»ä¼¼\n\næ•°ç»„ç±»å‹åœ¨golangä¸­ç”±**æ•°ç»„å¤§å°å’Œæ•°æ®ç±»å‹**å…±åŒå†³å®šï¼ŒéªŒè¯ä¾‹å­å¦‚ä¸‹ï¼š\n\n```go\n\tarr := [3]int{1, 2, 3}\n\tfmt.Printf(\"arr`s type is %T\", arr)\n\t//arr`s type is [3]int\n```\n\næ­£å› ä¸ºæ•°ç»„ç±»å‹åœ¨åˆå§‹æ—¶å°±è¢«ç¡®å®šï¼ˆå¤§å°å’Œæ•°æ®ç±»å‹ï¼‰ï¼Œæ‰€ä»¥åœ¨é¢å¯¹ä¸€äº›åŠ¨æ€å­˜å‚¨çš„åœºæ™¯æ—¶æ•°ç»„å°±æœ‰ç‚¹åŠ›ä¸ä»å¿ƒäº†ã€‚\n\n**slice**å°±æ˜¯ä¸ºäº†è§£å†³æ•°ç»„åœ¨é•¿åº¦ä¸Šä¸å¯å¢é•¿çš„é—®é¢˜ï¼ŒåŸºäºæ•°ç»„å®ç°äº†**å˜é•¿æ•°ç»„**çš„æœºåˆ¶\n\n### sliceåº•å±‚ç»“æ„\n\nsliceåº•å±‚ç»“æ„å¦‚ä¸‹ï¼š\n\n```go\ntype slice struct {\n    // åº•å±‚æ•°ç»„æŒ‡é’ˆ\n    array unsafe.Pointer\n    // sliceçš„é•¿åº¦\n    len int\n    // å®¹é‡\n    cap int\n}\n```\n\nsliceæ‰©å®¹ä¸¤æ­¥éª¤ï¼š\n\n1. è®¡ç®—æ‰€éœ€å®¹é‡\n   1. å¦‚æœ**æ–°åˆ‡ç‰‡çš„é•¿åº¦ï¼æ—§åˆ‡ç‰‡çš„å®¹é‡çš„ä¸¤å€**ï¼Œé‚£ä¹ˆæ–°åˆ‡ç‰‡çš„å®¹é‡ç­‰äºé•¿åº¦\n   2. å¦åˆ™\n      1. å¦‚æœ**æ—§åˆ‡ç‰‡çš„å®¹é‡ï¼œ256**ï¼Œé‚£ä¹ˆæ–°åˆ‡ç‰‡çš„å®¹é‡å°±æ˜¯åŸå®¹é‡çš„ä¸¤å€\n      2. å¦åˆ™æ–°åˆ‡ç‰‡çš„å®¹é‡å°±æ˜¯**1.25 * åŸåˆ‡ç‰‡å®¹é‡+3/4 * 256**\n2. å†…å­˜å¯¹é½ï¼Œç¡®å®šæœ€ç»ˆå®¹é‡\n   1. æŒ‰ç…§Goå†…å­˜ç®¡ç†çš„çº§åˆ«ç¡®å¯¹é½å†…å­˜ï¼Œæœ€ç»ˆå®¹é‡ä»¥æ­¤ä¸ºå‡†\n\n### sliceé—®é¢˜è§£å¯†\n\n- sliceé€šè¿‡å‡½æ•°ä¼ é€’çš„æ˜¯ä»€ä¹ˆï¼Ÿ\n\n  - ä¼ é€’çš„æ˜¯åº•å±‚sliceç»“æ„ä½“çš„æ‹·è´\n\n  - ```go\n    func PrintSliceStruct(s *[]int) {\n    \tss := (*reflect.SliceHeader)(unsafe.Pointer(s))\n    \tfmt.Printf(\"slice struct: %+v, slice is %v\\n\", ss, s)\n    }\n    \n    func test(s []int) {\n    \tfmt.Printf(\"slice address in main is %p\t\", &s)\n    \tPrintSliceStruct(&s)\n    }\n    \n    func main() {\n    \ts := make([]int, 5, 10)\n    \tfmt.Printf(\"slice address in main is %p\t\", &s)\n    \tPrintSliceStruct(&s)\n    \ttest(s)\n    \t/*\n    \tslice address in main is 0xc000008048\tslice struct: &{Data:824633788048 Len:5 Cap:10}, slice is &[0 0 0 0 0]\n    \tslice address in main is 0xc000008078\tslice struct: &{Data:824633788048 Len:5 Cap:10}, slice is &[0 0 0 0 0]\n    \t */\n    }\n    ```\n\n- åœ¨å‡½æ•°é‡Œé¢æ”¹å˜sliceï¼Œå¤–å±‚ä¼šå—åˆ°å½±å“å—ï¼Ÿ\n\n  - åªè¦ä¿®æ”¹çš„åº•å±‚æ•°ç»„æ˜¯åŒä¸€ä¸ªï¼Œé‚£ä¹ˆå°±ä¼šå—åˆ°å½±å“\n```\n    func test1(s []int) {\n    \ts[0] = 7\n    \tfmt.Printf(\"test1 value %v\\n\", s)\n    }\n    \n    func test2(s []int) {\n    \ts = append(s, 4)\n    \tfmt.Printf(\"test2 value %v\\n\", s)\n    }\n    \n    func main() {\n    \ts := []int{1, 2, 3}\n    \tfmt.Printf(\"initial value of s: %v\\n\", s)\n    \ttest1(s) // åº•å±‚æ•°ç»„ç›¸åŒï¼Œä¼šå—åˆ°å½±å“\n    \tfmt.Printf(\"after test1, value of s: %v\\n\", s)\n    \ttest2(s) // åº•å±‚æ•°ç»„å‘ç”Ÿå˜åŒ–ï¼Œä¸å—å½±å“\n    \tfmt.Printf(\"after test2, value of s: %v\\n\", s)\n    \t/*\n    \tinitial value of s: [1 2 3]\n    \ttest1 value [7 2 3]\n    \tafter test1, value of s: [7 2 3]\n    \ttest2 value [7 2 3 4]\n    \tafter test2, value of s: [7 2 3]\n    \t */\n    }\n```\n## sync.map\n\nè¿™é‡Œæ˜¯sync.map","source":"_posts/Go/Golangæ•°æ®ç»“æ„.md","raw":"---\ndescription: è®°å½•Goæ•°æ®ç»“æ„ç›¸å…³çŸ¥è¯†\ntags:\n  - Go\ndate: 2024-12-12\n---\n\n\n\n# Goæ•°æ®ç»“æ„\n\n## string\n\nGoè¯­è¨€ä¸­ï¼Œstringå¯ä»¥çœ‹ä½œæ˜¯æ‰€æœ‰**8bit å­—èŠ‚**çš„é›†åˆï¼Œä¸€ä¸ªå­—èŠ‚æ•°ç»„ã€‚\n\n- å­—ç¬¦ä¸²å¯ä»¥ä¸ºç©ºä¸²ï¼Œä½†ä¸èƒ½ä¸ºnil\n- å­—ç¬¦ä¸²çš„å­—é¢å€¼æ˜¯åªè¯»çš„ï¼Œä¸å¯ä»¥è¢«ä¿®æ”¹\n  - å­—ç¬¦ä¸²æ˜¯ä¸èƒ½è¢«ä¿®æ”¹çš„ï¼Œä½†æ˜¯å˜é‡å¯ä»¥é‡æ–°èµ‹å€¼\n\nåœ¨æºç ä¸­ä¹Ÿç»™å‡ºäº†stringçš„ç»“æ„ï¼šå…¶ä¸­`str`æ˜¯**æŒ‡å‘å­—ç¬¦ä¸²é¦–åœ°å€çš„æŒ‡é’ˆ**ã€`len`è¡¨ç¤º**å­—ç¬¦ä¸²çš„é•¿åº¦**\n\n```go\ntype stringStruct struct {\n    str unsafe.Pointer\n    len int\n}\n```\n\nğŸŒ°ï¼š\n\n<img src=\"https://raw.githubusercontent.com/lyydsheep/pic/main/202410051022321.png\" alt=\"image-20241005102225290\" style=\"zoom:67%;\" />\n\nå€¼å¾—æ³¨æ„çš„æ˜¯ï¼Œ**lenè¡¨ç¤ºå­—ç¬¦ä¸²é•¿åº¦æ˜¯ä»¥å­—èŠ‚æ•°è®¡é‡çš„**ï¼Œè€Œéå­—ç¬¦æ•°ã€‚\n\nä¸¾ä¸ªğŸŒ°ï¼šå­—ç¬¦ä¸²`hello`çš„å­—èŠ‚æ•°å’Œå­—ç¬¦æ•°æ˜¯5ï¼Œé•¿åº¦ä¹Ÿæ˜¯5ï¼›è€Œå­—ç¬¦ä¸²`helloå•Š`çš„å­—èŠ‚æ•°æ˜¯8ã€å­—ç¬¦æ•°æ˜¯6ï¼Œè€Œé•¿åº¦åŒå­—èŠ‚æ•°ä¸€æ ·æ˜¯8\n\næ‰€ä»¥å¯¹åŒ…å«éå•å­—èŠ‚ç¼–ç çš„å­—ç¬¦çš„å­—ç¬¦ä¸²è¿›è¡Œ`len()`æ“ä½œï¼Œå¯èƒ½ä¼šå¾—åˆ°æ„æƒ³ä¸åˆ°çš„ç»“æœ\n\n### stringå’Œ[]byteçš„äº’ç›¸è½¬æ¢\n\nstringå’Œ[]byteçš„è½¬åŒ–ï¼ˆä¸€èˆ¬ï¼‰ä¼šå‘ç”Ÿä¸€æ¬¡å†…å­˜æ‹·è´ï¼Œå¹¶ç”³è¯·ä¸€å—æ–°çš„åˆ‡ç‰‡å†…å­˜ç©ºé—´\n\n**[]byteè½¬ä¸ºstringçš„å¤§è‡´è¿‡ç¨‹ï¼š**\n\n- ç”³è¯·ä¸€å—æ–°çš„å†…å­˜ç©ºé—´ï¼Œå¹¶è®°å½•é¦–åœ°å€`addr`å’Œå­—èŠ‚é•¿åº¦`len`\n- æ„å»ºstringå¯¹è±¡ï¼ŒæŒ‡é’ˆåœ°å€ä¸º`addr`ï¼Œ`len`å­—æ®µèµ‹å€¼ä¸º`len`\n- å°†æºå­—èŠ‚åˆ‡ç‰‡ä¸­çš„æ•°æ®æ‹·è´åˆ°åˆšç”³è¯·çš„å†…å­˜ç©ºé—´ä¸­\n\n![image-20241005103541446](https://raw.githubusercontent.com/lyydsheep/pic/main/202410051035476.png)\n\nstringè½¬ä¸º[]byteçš„å¤§è‡´è¿‡ç¨‹ï¼š\n\n- ç”³è¯·ä¸€å—æ–°çš„å†…å­˜ç©ºé—´\n\n- å°†stringæŒ‡é’ˆæ‰€æŒ‡å‘çš„å†…å­˜åŒºåŸŸæ‹·è´`len`å­—èŠ‚åˆ°åˆšç”³è¯·çš„ç©ºé—´ä¸­\n\n  ![image-20241005103722955](https://raw.githubusercontent.com/lyydsheep/pic/main/202410051037987.png)\n\nâš ï¸ï¼šå½“**è½¬åŒ–ä¸ºçš„å­—ç¬¦ä¸²è¢«ç”¨äºä¸´æ—¶åœºæ™¯æ—¶**ï¼Œstringå’Œ[]byteä¹‹é—´çš„è½¬æ¢å¹¶**ä¸ä¼šå‘ç”Ÿæ‹·è´**\n\nä¾‹å¦‚ï¼š\n\n- å­—ç¬¦ä¸²æ¯”è¾ƒï¼šstring(ss) == \"hello\"\n- å­—ç¬¦ä¸²æ‹¼æ¥ï¼š\"hello\" + string(ss) + \"world\"\n- ç”¨äºæŸ¥æ‰¾ï¼šk, v := map[string(ss)]\n\nåœ¨ä¸Šè¿°åœºæ™¯ä¸­ï¼Œ[]byteè½¬æ¢çš„å­—ç¬¦ä¸²åªæœ‰ä¸´æ—¶ä½œç”¨ï¼Œåœ¨åç»­ç¨‹åºä¸­ä¸ä¼šå†æ¬¡ä½¿ç”¨ï¼Œæ‰€ä»¥å¹¶ä¸ä¼šæ‹·è´åˆ°å†…å­˜ï¼Œè€Œæ˜¯ç›´æ¥è¿”å›ä¸€ä¸ªstringï¼Œè¿™ä¸ªstringçš„æŒ‡é’ˆå°±æŒ‡å‘å­—èŠ‚åˆ‡ç‰‡çš„å†…å­˜åœ°å€\n\n## slice\n\nåœ¨Goè¯­è¨€ä¸­ï¼Œsliceæ˜¯åŸºäºæ•°ç»„å°è£…å‡ºæ¥çš„æŠ½è±¡æ•°æ®ç»“æ„ã€‚å› æ­¤åœ¨è§£æsliceä¹‹å‰ï¼Œéœ€è¦å…ˆè®¤è¯†è®¤è¯†golangä¸­çš„æ•°ç»„ã€‚\n\nGoè¯­è¨€ä¸­çš„æ•°ç»„æ˜¯ä¸€ç§å€¼ç±»å‹ï¼Œå’ŒCè¯­è¨€ä¸­çš„æŒ‡é’ˆç±»å‹ä¸åŒï¼Œæ‰€ä»¥åœ¨Goä¸­å¯¹æ•°ç»„è¿›è¡Œå¤åˆ¶ã€ä¼ å‚éƒ½æ˜¯è¿›è¡Œ**å€¼å¤åˆ¶**æ“ä½œï¼Œå°±å’Œ`int`ã€`float64`è¿™äº›åŸºæœ¬æ•°æ®ç±»å‹ç±»ä¼¼\n\næ•°ç»„ç±»å‹åœ¨golangä¸­ç”±**æ•°ç»„å¤§å°å’Œæ•°æ®ç±»å‹**å…±åŒå†³å®šï¼ŒéªŒè¯ä¾‹å­å¦‚ä¸‹ï¼š\n\n```go\n\tarr := [3]int{1, 2, 3}\n\tfmt.Printf(\"arr`s type is %T\", arr)\n\t//arr`s type is [3]int\n```\n\næ­£å› ä¸ºæ•°ç»„ç±»å‹åœ¨åˆå§‹æ—¶å°±è¢«ç¡®å®šï¼ˆå¤§å°å’Œæ•°æ®ç±»å‹ï¼‰ï¼Œæ‰€ä»¥åœ¨é¢å¯¹ä¸€äº›åŠ¨æ€å­˜å‚¨çš„åœºæ™¯æ—¶æ•°ç»„å°±æœ‰ç‚¹åŠ›ä¸ä»å¿ƒäº†ã€‚\n\n**slice**å°±æ˜¯ä¸ºäº†è§£å†³æ•°ç»„åœ¨é•¿åº¦ä¸Šä¸å¯å¢é•¿çš„é—®é¢˜ï¼ŒåŸºäºæ•°ç»„å®ç°äº†**å˜é•¿æ•°ç»„**çš„æœºåˆ¶\n\n### sliceåº•å±‚ç»“æ„\n\nsliceåº•å±‚ç»“æ„å¦‚ä¸‹ï¼š\n\n```go\ntype slice struct {\n    // åº•å±‚æ•°ç»„æŒ‡é’ˆ\n    array unsafe.Pointer\n    // sliceçš„é•¿åº¦\n    len int\n    // å®¹é‡\n    cap int\n}\n```\n\nsliceæ‰©å®¹ä¸¤æ­¥éª¤ï¼š\n\n1. è®¡ç®—æ‰€éœ€å®¹é‡\n   1. å¦‚æœ**æ–°åˆ‡ç‰‡çš„é•¿åº¦ï¼æ—§åˆ‡ç‰‡çš„å®¹é‡çš„ä¸¤å€**ï¼Œé‚£ä¹ˆæ–°åˆ‡ç‰‡çš„å®¹é‡ç­‰äºé•¿åº¦\n   2. å¦åˆ™\n      1. å¦‚æœ**æ—§åˆ‡ç‰‡çš„å®¹é‡ï¼œ256**ï¼Œé‚£ä¹ˆæ–°åˆ‡ç‰‡çš„å®¹é‡å°±æ˜¯åŸå®¹é‡çš„ä¸¤å€\n      2. å¦åˆ™æ–°åˆ‡ç‰‡çš„å®¹é‡å°±æ˜¯**1.25 * åŸåˆ‡ç‰‡å®¹é‡+3/4 * 256**\n2. å†…å­˜å¯¹é½ï¼Œç¡®å®šæœ€ç»ˆå®¹é‡\n   1. æŒ‰ç…§Goå†…å­˜ç®¡ç†çš„çº§åˆ«ç¡®å¯¹é½å†…å­˜ï¼Œæœ€ç»ˆå®¹é‡ä»¥æ­¤ä¸ºå‡†\n\n### sliceé—®é¢˜è§£å¯†\n\n- sliceé€šè¿‡å‡½æ•°ä¼ é€’çš„æ˜¯ä»€ä¹ˆï¼Ÿ\n\n  - ä¼ é€’çš„æ˜¯åº•å±‚sliceç»“æ„ä½“çš„æ‹·è´\n\n  - ```go\n    func PrintSliceStruct(s *[]int) {\n    \tss := (*reflect.SliceHeader)(unsafe.Pointer(s))\n    \tfmt.Printf(\"slice struct: %+v, slice is %v\\n\", ss, s)\n    }\n    \n    func test(s []int) {\n    \tfmt.Printf(\"slice address in main is %p\t\", &s)\n    \tPrintSliceStruct(&s)\n    }\n    \n    func main() {\n    \ts := make([]int, 5, 10)\n    \tfmt.Printf(\"slice address in main is %p\t\", &s)\n    \tPrintSliceStruct(&s)\n    \ttest(s)\n    \t/*\n    \tslice address in main is 0xc000008048\tslice struct: &{Data:824633788048 Len:5 Cap:10}, slice is &[0 0 0 0 0]\n    \tslice address in main is 0xc000008078\tslice struct: &{Data:824633788048 Len:5 Cap:10}, slice is &[0 0 0 0 0]\n    \t */\n    }\n    ```\n\n- åœ¨å‡½æ•°é‡Œé¢æ”¹å˜sliceï¼Œå¤–å±‚ä¼šå—åˆ°å½±å“å—ï¼Ÿ\n\n  - åªè¦ä¿®æ”¹çš„åº•å±‚æ•°ç»„æ˜¯åŒä¸€ä¸ªï¼Œé‚£ä¹ˆå°±ä¼šå—åˆ°å½±å“\n```\n    func test1(s []int) {\n    \ts[0] = 7\n    \tfmt.Printf(\"test1 value %v\\n\", s)\n    }\n    \n    func test2(s []int) {\n    \ts = append(s, 4)\n    \tfmt.Printf(\"test2 value %v\\n\", s)\n    }\n    \n    func main() {\n    \ts := []int{1, 2, 3}\n    \tfmt.Printf(\"initial value of s: %v\\n\", s)\n    \ttest1(s) // åº•å±‚æ•°ç»„ç›¸åŒï¼Œä¼šå—åˆ°å½±å“\n    \tfmt.Printf(\"after test1, value of s: %v\\n\", s)\n    \ttest2(s) // åº•å±‚æ•°ç»„å‘ç”Ÿå˜åŒ–ï¼Œä¸å—å½±å“\n    \tfmt.Printf(\"after test2, value of s: %v\\n\", s)\n    \t/*\n    \tinitial value of s: [1 2 3]\n    \ttest1 value [7 2 3]\n    \tafter test1, value of s: [7 2 3]\n    \ttest2 value [7 2 3 4]\n    \tafter test2, value of s: [7 2 3]\n    \t */\n    }\n```\n## sync.map\n\nè¿™é‡Œæ˜¯sync.map","slug":"Go/Golangæ•°æ®ç»“æ„","published":1,"updated":"2024-12-27T11:03:15.342Z","title":"","comments":1,"layout":"post","photos":[],"_id":"cm6c7md6m001wa5t217u41wql","content":"<h1 id=\"Goæ•°æ®ç»“æ„\"><a href=\"#Goæ•°æ®ç»“æ„\" class=\"headerlink\" title=\"Goæ•°æ®ç»“æ„\"></a>Goæ•°æ®ç»“æ„</h1><h2 id=\"string\"><a href=\"#string\" class=\"headerlink\" title=\"string\"></a>string</h2><p>Goè¯­è¨€ä¸­ï¼Œstringå¯ä»¥çœ‹ä½œæ˜¯æ‰€æœ‰<strong>8bit å­—èŠ‚</strong>çš„é›†åˆï¼Œä¸€ä¸ªå­—èŠ‚æ•°ç»„ã€‚</p>\n<ul>\n<li>å­—ç¬¦ä¸²å¯ä»¥ä¸ºç©ºä¸²ï¼Œä½†ä¸èƒ½ä¸ºnil</li>\n<li>å­—ç¬¦ä¸²çš„å­—é¢å€¼æ˜¯åªè¯»çš„ï¼Œä¸å¯ä»¥è¢«ä¿®æ”¹<ul>\n<li>å­—ç¬¦ä¸²æ˜¯ä¸èƒ½è¢«ä¿®æ”¹çš„ï¼Œä½†æ˜¯å˜é‡å¯ä»¥é‡æ–°èµ‹å€¼</li>\n</ul>\n</li>\n</ul>\n<p>åœ¨æºç ä¸­ä¹Ÿç»™å‡ºäº†stringçš„ç»“æ„ï¼šå…¶ä¸­<code>str</code>æ˜¯<strong>æŒ‡å‘å­—ç¬¦ä¸²é¦–åœ°å€çš„æŒ‡é’ˆ</strong>ã€<code>len</code>è¡¨ç¤º<strong>å­—ç¬¦ä¸²çš„é•¿åº¦</strong></p>\n<figure class=\"highlight go\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">type</span> stringStruct <span class=\"keyword\">struct</span> &#123;</span><br><span class=\"line\">    str unsafe.Pointer</span><br><span class=\"line\">    <span class=\"built_in\">len</span> <span class=\"type\">int</span></span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n\n<p>ğŸŒ°ï¼š</p>\n<img src=\"https://raw.githubusercontent.com/lyydsheep/pic/main/202410051022321.png\" alt=\"image-20241005102225290\" style=\"zoom:67%;\" />\n\n<p>å€¼å¾—æ³¨æ„çš„æ˜¯ï¼Œ<strong>lenè¡¨ç¤ºå­—ç¬¦ä¸²é•¿åº¦æ˜¯ä»¥å­—èŠ‚æ•°è®¡é‡çš„</strong>ï¼Œè€Œéå­—ç¬¦æ•°ã€‚</p>\n<p>ä¸¾ä¸ªğŸŒ°ï¼šå­—ç¬¦ä¸²<code>hello</code>çš„å­—èŠ‚æ•°å’Œå­—ç¬¦æ•°æ˜¯5ï¼Œé•¿åº¦ä¹Ÿæ˜¯5ï¼›è€Œå­—ç¬¦ä¸²<code>helloå•Š</code>çš„å­—èŠ‚æ•°æ˜¯8ã€å­—ç¬¦æ•°æ˜¯6ï¼Œè€Œé•¿åº¦åŒå­—èŠ‚æ•°ä¸€æ ·æ˜¯8</p>\n<p>æ‰€ä»¥å¯¹åŒ…å«éå•å­—èŠ‚ç¼–ç çš„å­—ç¬¦çš„å­—ç¬¦ä¸²è¿›è¡Œ<code>len()</code>æ“ä½œï¼Œå¯èƒ½ä¼šå¾—åˆ°æ„æƒ³ä¸åˆ°çš„ç»“æœ</p>\n<h3 id=\"stringå’Œ-byteçš„äº’ç›¸è½¬æ¢\"><a href=\"#stringå’Œ-byteçš„äº’ç›¸è½¬æ¢\" class=\"headerlink\" title=\"stringå’Œ[]byteçš„äº’ç›¸è½¬æ¢\"></a>stringå’Œ[]byteçš„äº’ç›¸è½¬æ¢</h3><p>stringå’Œ[]byteçš„è½¬åŒ–ï¼ˆä¸€èˆ¬ï¼‰ä¼šå‘ç”Ÿä¸€æ¬¡å†…å­˜æ‹·è´ï¼Œå¹¶ç”³è¯·ä¸€å—æ–°çš„åˆ‡ç‰‡å†…å­˜ç©ºé—´</p>\n<p><strong>[]byteè½¬ä¸ºstringçš„å¤§è‡´è¿‡ç¨‹ï¼š</strong></p>\n<ul>\n<li>ç”³è¯·ä¸€å—æ–°çš„å†…å­˜ç©ºé—´ï¼Œå¹¶è®°å½•é¦–åœ°å€<code>addr</code>å’Œå­—èŠ‚é•¿åº¦<code>len</code></li>\n<li>æ„å»ºstringå¯¹è±¡ï¼ŒæŒ‡é’ˆåœ°å€ä¸º<code>addr</code>ï¼Œ<code>len</code>å­—æ®µèµ‹å€¼ä¸º<code>len</code></li>\n<li>å°†æºå­—èŠ‚åˆ‡ç‰‡ä¸­çš„æ•°æ®æ‹·è´åˆ°åˆšç”³è¯·çš„å†…å­˜ç©ºé—´ä¸­</li>\n</ul>\n<p><img src=\"https://raw.githubusercontent.com/lyydsheep/pic/main/202410051035476.png\" alt=\"image-20241005103541446\"></p>\n<p>stringè½¬ä¸º[]byteçš„å¤§è‡´è¿‡ç¨‹ï¼š</p>\n<ul>\n<li><p>ç”³è¯·ä¸€å—æ–°çš„å†…å­˜ç©ºé—´</p>\n</li>\n<li><p>å°†stringæŒ‡é’ˆæ‰€æŒ‡å‘çš„å†…å­˜åŒºåŸŸæ‹·è´<code>len</code>å­—èŠ‚åˆ°åˆšç”³è¯·çš„ç©ºé—´ä¸­</p>\n<p><img src=\"https://raw.githubusercontent.com/lyydsheep/pic/main/202410051037987.png\" alt=\"image-20241005103722955\"></p>\n</li>\n</ul>\n<p>âš ï¸ï¼šå½“<strong>è½¬åŒ–ä¸ºçš„å­—ç¬¦ä¸²è¢«ç”¨äºä¸´æ—¶åœºæ™¯æ—¶</strong>ï¼Œstringå’Œ[]byteä¹‹é—´çš„è½¬æ¢å¹¶<strong>ä¸ä¼šå‘ç”Ÿæ‹·è´</strong></p>\n<p>ä¾‹å¦‚ï¼š</p>\n<ul>\n<li>å­—ç¬¦ä¸²æ¯”è¾ƒï¼šstring(ss) &#x3D;&#x3D; â€œhelloâ€</li>\n<li>å­—ç¬¦ä¸²æ‹¼æ¥ï¼šâ€helloâ€ + string(ss) + â€œworldâ€</li>\n<li>ç”¨äºæŸ¥æ‰¾ï¼šk, v :&#x3D; map[string(ss)]</li>\n</ul>\n<p>åœ¨ä¸Šè¿°åœºæ™¯ä¸­ï¼Œ[]byteè½¬æ¢çš„å­—ç¬¦ä¸²åªæœ‰ä¸´æ—¶ä½œç”¨ï¼Œåœ¨åç»­ç¨‹åºä¸­ä¸ä¼šå†æ¬¡ä½¿ç”¨ï¼Œæ‰€ä»¥å¹¶ä¸ä¼šæ‹·è´åˆ°å†…å­˜ï¼Œè€Œæ˜¯ç›´æ¥è¿”å›ä¸€ä¸ªstringï¼Œè¿™ä¸ªstringçš„æŒ‡é’ˆå°±æŒ‡å‘å­—èŠ‚åˆ‡ç‰‡çš„å†…å­˜åœ°å€</p>\n<h2 id=\"slice\"><a href=\"#slice\" class=\"headerlink\" title=\"slice\"></a>slice</h2><p>åœ¨Goè¯­è¨€ä¸­ï¼Œsliceæ˜¯åŸºäºæ•°ç»„å°è£…å‡ºæ¥çš„æŠ½è±¡æ•°æ®ç»“æ„ã€‚å› æ­¤åœ¨è§£æsliceä¹‹å‰ï¼Œéœ€è¦å…ˆè®¤è¯†è®¤è¯†golangä¸­çš„æ•°ç»„ã€‚</p>\n<p>Goè¯­è¨€ä¸­çš„æ•°ç»„æ˜¯ä¸€ç§å€¼ç±»å‹ï¼Œå’ŒCè¯­è¨€ä¸­çš„æŒ‡é’ˆç±»å‹ä¸åŒï¼Œæ‰€ä»¥åœ¨Goä¸­å¯¹æ•°ç»„è¿›è¡Œå¤åˆ¶ã€ä¼ å‚éƒ½æ˜¯è¿›è¡Œ<strong>å€¼å¤åˆ¶</strong>æ“ä½œï¼Œå°±å’Œ<code>int</code>ã€<code>float64</code>è¿™äº›åŸºæœ¬æ•°æ®ç±»å‹ç±»ä¼¼</p>\n<p>æ•°ç»„ç±»å‹åœ¨golangä¸­ç”±<strong>æ•°ç»„å¤§å°å’Œæ•°æ®ç±»å‹</strong>å…±åŒå†³å®šï¼ŒéªŒè¯ä¾‹å­å¦‚ä¸‹ï¼š</p>\n<figure class=\"highlight go\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">arr := [<span class=\"number\">3</span>]<span class=\"type\">int</span>&#123;<span class=\"number\">1</span>, <span class=\"number\">2</span>, <span class=\"number\">3</span>&#125;</span><br><span class=\"line\">fmt.Printf(<span class=\"string\">&quot;arr`s type is %T&quot;</span>, arr)</span><br><span class=\"line\"><span class=\"comment\">//arr`s type is [3]int</span></span><br></pre></td></tr></table></figure>\n\n<p>æ­£å› ä¸ºæ•°ç»„ç±»å‹åœ¨åˆå§‹æ—¶å°±è¢«ç¡®å®šï¼ˆå¤§å°å’Œæ•°æ®ç±»å‹ï¼‰ï¼Œæ‰€ä»¥åœ¨é¢å¯¹ä¸€äº›åŠ¨æ€å­˜å‚¨çš„åœºæ™¯æ—¶æ•°ç»„å°±æœ‰ç‚¹åŠ›ä¸ä»å¿ƒäº†ã€‚</p>\n<p><strong>slice</strong>å°±æ˜¯ä¸ºäº†è§£å†³æ•°ç»„åœ¨é•¿åº¦ä¸Šä¸å¯å¢é•¿çš„é—®é¢˜ï¼ŒåŸºäºæ•°ç»„å®ç°äº†<strong>å˜é•¿æ•°ç»„</strong>çš„æœºåˆ¶</p>\n<h3 id=\"sliceåº•å±‚ç»“æ„\"><a href=\"#sliceåº•å±‚ç»“æ„\" class=\"headerlink\" title=\"sliceåº•å±‚ç»“æ„\"></a>sliceåº•å±‚ç»“æ„</h3><p>sliceåº•å±‚ç»“æ„å¦‚ä¸‹ï¼š</p>\n<figure class=\"highlight go\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">type</span> slice <span class=\"keyword\">struct</span> &#123;</span><br><span class=\"line\">    <span class=\"comment\">// åº•å±‚æ•°ç»„æŒ‡é’ˆ</span></span><br><span class=\"line\">    array unsafe.Pointer</span><br><span class=\"line\">    <span class=\"comment\">// sliceçš„é•¿åº¦</span></span><br><span class=\"line\">    <span class=\"built_in\">len</span> <span class=\"type\">int</span></span><br><span class=\"line\">    <span class=\"comment\">// å®¹é‡</span></span><br><span class=\"line\">    <span class=\"built_in\">cap</span> <span class=\"type\">int</span></span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n\n<p>sliceæ‰©å®¹ä¸¤æ­¥éª¤ï¼š</p>\n<ol>\n<li>è®¡ç®—æ‰€éœ€å®¹é‡<ol>\n<li>å¦‚æœ<strong>æ–°åˆ‡ç‰‡çš„é•¿åº¦ï¼æ—§åˆ‡ç‰‡çš„å®¹é‡çš„ä¸¤å€</strong>ï¼Œé‚£ä¹ˆæ–°åˆ‡ç‰‡çš„å®¹é‡ç­‰äºé•¿åº¦</li>\n<li>å¦åˆ™<ol>\n<li>å¦‚æœ<strong>æ—§åˆ‡ç‰‡çš„å®¹é‡ï¼œ256</strong>ï¼Œé‚£ä¹ˆæ–°åˆ‡ç‰‡çš„å®¹é‡å°±æ˜¯åŸå®¹é‡çš„ä¸¤å€</li>\n<li>å¦åˆ™æ–°åˆ‡ç‰‡çš„å®¹é‡å°±æ˜¯<strong>1.25 * åŸåˆ‡ç‰‡å®¹é‡+3&#x2F;4 * 256</strong></li>\n</ol>\n</li>\n</ol>\n</li>\n<li>å†…å­˜å¯¹é½ï¼Œç¡®å®šæœ€ç»ˆå®¹é‡<ol>\n<li>æŒ‰ç…§Goå†…å­˜ç®¡ç†çš„çº§åˆ«ç¡®å¯¹é½å†…å­˜ï¼Œæœ€ç»ˆå®¹é‡ä»¥æ­¤ä¸ºå‡†</li>\n</ol>\n</li>\n</ol>\n<h3 id=\"sliceé—®é¢˜è§£å¯†\"><a href=\"#sliceé—®é¢˜è§£å¯†\" class=\"headerlink\" title=\"sliceé—®é¢˜è§£å¯†\"></a>sliceé—®é¢˜è§£å¯†</h3><ul>\n<li><p>sliceé€šè¿‡å‡½æ•°ä¼ é€’çš„æ˜¯ä»€ä¹ˆï¼Ÿ</p>\n<ul>\n<li><p>ä¼ é€’çš„æ˜¯åº•å±‚sliceç»“æ„ä½“çš„æ‹·è´</p>\n</li>\n<li><pre><code class=\"go\">func PrintSliceStruct(s *[]int) &#123;\n    ss := (*reflect.SliceHeader)(unsafe.Pointer(s))\n    fmt.Printf(&quot;slice struct: %+v, slice is %v\\n&quot;, ss, s)\n&#125;\n\nfunc test(s []int) &#123;\n    fmt.Printf(&quot;slice address in main is %p\t&quot;, &amp;s)\n    PrintSliceStruct(&amp;s)\n&#125;\n\nfunc main() &#123;\n    s := make([]int, 5, 10)\n    fmt.Printf(&quot;slice address in main is %p\t&quot;, &amp;s)\n    PrintSliceStruct(&amp;s)\n    test(s)\n    /*\n    slice address in main is 0xc000008048\tslice struct: &amp;&#123;Data:824633788048 Len:5 Cap:10&#125;, slice is &amp;[0 0 0 0 0]\n    slice address in main is 0xc000008078\tslice struct: &amp;&#123;Data:824633788048 Len:5 Cap:10&#125;, slice is &amp;[0 0 0 0 0]\n     */\n&#125;\n<figure class=\"highlight plaintext\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"></span><br><span class=\"line\">- åœ¨å‡½æ•°é‡Œé¢æ”¹å˜sliceï¼Œå¤–å±‚ä¼šå—åˆ°å½±å“å—ï¼Ÿ</span><br><span class=\"line\"></span><br><span class=\"line\">  - åªè¦ä¿®æ”¹çš„åº•å±‚æ•°ç»„æ˜¯åŒä¸€ä¸ªï¼Œé‚£ä¹ˆå°±ä¼šå—åˆ°å½±å“</span><br></pre></td></tr></table></figure>\nfunc test1(s []int) &#123;\n    s[0] = 7\n    fmt.Printf(&quot;test1 value %v\\n&quot;, s)\n&#125;\n\nfunc test2(s []int) &#123;\n    s = append(s, 4)\n    fmt.Printf(&quot;test2 value %v\\n&quot;, s)\n&#125;\n\nfunc main() &#123;\n    s := []int&#123;1, 2, 3&#125;\n    fmt.Printf(&quot;initial value of s: %v\\n&quot;, s)\n    test1(s) // åº•å±‚æ•°ç»„ç›¸åŒï¼Œä¼šå—åˆ°å½±å“\n    fmt.Printf(&quot;after test1, value of s: %v\\n&quot;, s)\n    test2(s) // åº•å±‚æ•°ç»„å‘ç”Ÿå˜åŒ–ï¼Œä¸å—å½±å“\n    fmt.Printf(&quot;after test2, value of s: %v\\n&quot;, s)\n    /*\n    initial value of s: [1 2 3]\n    test1 value [7 2 3]\n    after test1, value of s: [7 2 3]\n    test2 value [7 2 3 4]\n    after test2, value of s: [7 2 3]\n     */\n&#125;\n</code></pre>\n</li>\n</ul>\n</li>\n</ul>\n<pre><code>## sync.map\n\nè¿™é‡Œæ˜¯sync.map\n</code></pre>\n","excerpt":"","more":"<h1 id=\"Goæ•°æ®ç»“æ„\"><a href=\"#Goæ•°æ®ç»“æ„\" class=\"headerlink\" title=\"Goæ•°æ®ç»“æ„\"></a>Goæ•°æ®ç»“æ„</h1><h2 id=\"string\"><a href=\"#string\" class=\"headerlink\" title=\"string\"></a>string</h2><p>Goè¯­è¨€ä¸­ï¼Œstringå¯ä»¥çœ‹ä½œæ˜¯æ‰€æœ‰<strong>8bit å­—èŠ‚</strong>çš„é›†åˆï¼Œä¸€ä¸ªå­—èŠ‚æ•°ç»„ã€‚</p>\n<ul>\n<li>å­—ç¬¦ä¸²å¯ä»¥ä¸ºç©ºä¸²ï¼Œä½†ä¸èƒ½ä¸ºnil</li>\n<li>å­—ç¬¦ä¸²çš„å­—é¢å€¼æ˜¯åªè¯»çš„ï¼Œä¸å¯ä»¥è¢«ä¿®æ”¹<ul>\n<li>å­—ç¬¦ä¸²æ˜¯ä¸èƒ½è¢«ä¿®æ”¹çš„ï¼Œä½†æ˜¯å˜é‡å¯ä»¥é‡æ–°èµ‹å€¼</li>\n</ul>\n</li>\n</ul>\n<p>åœ¨æºç ä¸­ä¹Ÿç»™å‡ºäº†stringçš„ç»“æ„ï¼šå…¶ä¸­<code>str</code>æ˜¯<strong>æŒ‡å‘å­—ç¬¦ä¸²é¦–åœ°å€çš„æŒ‡é’ˆ</strong>ã€<code>len</code>è¡¨ç¤º<strong>å­—ç¬¦ä¸²çš„é•¿åº¦</strong></p>\n<figure class=\"highlight go\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">type</span> stringStruct <span class=\"keyword\">struct</span> &#123;</span><br><span class=\"line\">    str unsafe.Pointer</span><br><span class=\"line\">    <span class=\"built_in\">len</span> <span class=\"type\">int</span></span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n\n<p>ğŸŒ°ï¼š</p>\n<img src=\"https://raw.githubusercontent.com/lyydsheep/pic/main/202410051022321.png\" alt=\"image-20241005102225290\" style=\"zoom:67%;\" />\n\n<p>å€¼å¾—æ³¨æ„çš„æ˜¯ï¼Œ<strong>lenè¡¨ç¤ºå­—ç¬¦ä¸²é•¿åº¦æ˜¯ä»¥å­—èŠ‚æ•°è®¡é‡çš„</strong>ï¼Œè€Œéå­—ç¬¦æ•°ã€‚</p>\n<p>ä¸¾ä¸ªğŸŒ°ï¼šå­—ç¬¦ä¸²<code>hello</code>çš„å­—èŠ‚æ•°å’Œå­—ç¬¦æ•°æ˜¯5ï¼Œé•¿åº¦ä¹Ÿæ˜¯5ï¼›è€Œå­—ç¬¦ä¸²<code>helloå•Š</code>çš„å­—èŠ‚æ•°æ˜¯8ã€å­—ç¬¦æ•°æ˜¯6ï¼Œè€Œé•¿åº¦åŒå­—èŠ‚æ•°ä¸€æ ·æ˜¯8</p>\n<p>æ‰€ä»¥å¯¹åŒ…å«éå•å­—èŠ‚ç¼–ç çš„å­—ç¬¦çš„å­—ç¬¦ä¸²è¿›è¡Œ<code>len()</code>æ“ä½œï¼Œå¯èƒ½ä¼šå¾—åˆ°æ„æƒ³ä¸åˆ°çš„ç»“æœ</p>\n<h3 id=\"stringå’Œ-byteçš„äº’ç›¸è½¬æ¢\"><a href=\"#stringå’Œ-byteçš„äº’ç›¸è½¬æ¢\" class=\"headerlink\" title=\"stringå’Œ[]byteçš„äº’ç›¸è½¬æ¢\"></a>stringå’Œ[]byteçš„äº’ç›¸è½¬æ¢</h3><p>stringå’Œ[]byteçš„è½¬åŒ–ï¼ˆä¸€èˆ¬ï¼‰ä¼šå‘ç”Ÿä¸€æ¬¡å†…å­˜æ‹·è´ï¼Œå¹¶ç”³è¯·ä¸€å—æ–°çš„åˆ‡ç‰‡å†…å­˜ç©ºé—´</p>\n<p><strong>[]byteè½¬ä¸ºstringçš„å¤§è‡´è¿‡ç¨‹ï¼š</strong></p>\n<ul>\n<li>ç”³è¯·ä¸€å—æ–°çš„å†…å­˜ç©ºé—´ï¼Œå¹¶è®°å½•é¦–åœ°å€<code>addr</code>å’Œå­—èŠ‚é•¿åº¦<code>len</code></li>\n<li>æ„å»ºstringå¯¹è±¡ï¼ŒæŒ‡é’ˆåœ°å€ä¸º<code>addr</code>ï¼Œ<code>len</code>å­—æ®µèµ‹å€¼ä¸º<code>len</code></li>\n<li>å°†æºå­—èŠ‚åˆ‡ç‰‡ä¸­çš„æ•°æ®æ‹·è´åˆ°åˆšç”³è¯·çš„å†…å­˜ç©ºé—´ä¸­</li>\n</ul>\n<p><img src=\"https://raw.githubusercontent.com/lyydsheep/pic/main/202410051035476.png\" alt=\"image-20241005103541446\"></p>\n<p>stringè½¬ä¸º[]byteçš„å¤§è‡´è¿‡ç¨‹ï¼š</p>\n<ul>\n<li><p>ç”³è¯·ä¸€å—æ–°çš„å†…å­˜ç©ºé—´</p>\n</li>\n<li><p>å°†stringæŒ‡é’ˆæ‰€æŒ‡å‘çš„å†…å­˜åŒºåŸŸæ‹·è´<code>len</code>å­—èŠ‚åˆ°åˆšç”³è¯·çš„ç©ºé—´ä¸­</p>\n<p><img src=\"https://raw.githubusercontent.com/lyydsheep/pic/main/202410051037987.png\" alt=\"image-20241005103722955\"></p>\n</li>\n</ul>\n<p>âš ï¸ï¼šå½“<strong>è½¬åŒ–ä¸ºçš„å­—ç¬¦ä¸²è¢«ç”¨äºä¸´æ—¶åœºæ™¯æ—¶</strong>ï¼Œstringå’Œ[]byteä¹‹é—´çš„è½¬æ¢å¹¶<strong>ä¸ä¼šå‘ç”Ÿæ‹·è´</strong></p>\n<p>ä¾‹å¦‚ï¼š</p>\n<ul>\n<li>å­—ç¬¦ä¸²æ¯”è¾ƒï¼šstring(ss) &#x3D;&#x3D; â€œhelloâ€</li>\n<li>å­—ç¬¦ä¸²æ‹¼æ¥ï¼šâ€helloâ€ + string(ss) + â€œworldâ€</li>\n<li>ç”¨äºæŸ¥æ‰¾ï¼šk, v :&#x3D; map[string(ss)]</li>\n</ul>\n<p>åœ¨ä¸Šè¿°åœºæ™¯ä¸­ï¼Œ[]byteè½¬æ¢çš„å­—ç¬¦ä¸²åªæœ‰ä¸´æ—¶ä½œç”¨ï¼Œåœ¨åç»­ç¨‹åºä¸­ä¸ä¼šå†æ¬¡ä½¿ç”¨ï¼Œæ‰€ä»¥å¹¶ä¸ä¼šæ‹·è´åˆ°å†…å­˜ï¼Œè€Œæ˜¯ç›´æ¥è¿”å›ä¸€ä¸ªstringï¼Œè¿™ä¸ªstringçš„æŒ‡é’ˆå°±æŒ‡å‘å­—èŠ‚åˆ‡ç‰‡çš„å†…å­˜åœ°å€</p>\n<h2 id=\"slice\"><a href=\"#slice\" class=\"headerlink\" title=\"slice\"></a>slice</h2><p>åœ¨Goè¯­è¨€ä¸­ï¼Œsliceæ˜¯åŸºäºæ•°ç»„å°è£…å‡ºæ¥çš„æŠ½è±¡æ•°æ®ç»“æ„ã€‚å› æ­¤åœ¨è§£æsliceä¹‹å‰ï¼Œéœ€è¦å…ˆè®¤è¯†è®¤è¯†golangä¸­çš„æ•°ç»„ã€‚</p>\n<p>Goè¯­è¨€ä¸­çš„æ•°ç»„æ˜¯ä¸€ç§å€¼ç±»å‹ï¼Œå’ŒCè¯­è¨€ä¸­çš„æŒ‡é’ˆç±»å‹ä¸åŒï¼Œæ‰€ä»¥åœ¨Goä¸­å¯¹æ•°ç»„è¿›è¡Œå¤åˆ¶ã€ä¼ å‚éƒ½æ˜¯è¿›è¡Œ<strong>å€¼å¤åˆ¶</strong>æ“ä½œï¼Œå°±å’Œ<code>int</code>ã€<code>float64</code>è¿™äº›åŸºæœ¬æ•°æ®ç±»å‹ç±»ä¼¼</p>\n<p>æ•°ç»„ç±»å‹åœ¨golangä¸­ç”±<strong>æ•°ç»„å¤§å°å’Œæ•°æ®ç±»å‹</strong>å…±åŒå†³å®šï¼ŒéªŒè¯ä¾‹å­å¦‚ä¸‹ï¼š</p>\n<figure class=\"highlight go\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">arr := [<span class=\"number\">3</span>]<span class=\"type\">int</span>&#123;<span class=\"number\">1</span>, <span class=\"number\">2</span>, <span class=\"number\">3</span>&#125;</span><br><span class=\"line\">fmt.Printf(<span class=\"string\">&quot;arr`s type is %T&quot;</span>, arr)</span><br><span class=\"line\"><span class=\"comment\">//arr`s type is [3]int</span></span><br></pre></td></tr></table></figure>\n\n<p>æ­£å› ä¸ºæ•°ç»„ç±»å‹åœ¨åˆå§‹æ—¶å°±è¢«ç¡®å®šï¼ˆå¤§å°å’Œæ•°æ®ç±»å‹ï¼‰ï¼Œæ‰€ä»¥åœ¨é¢å¯¹ä¸€äº›åŠ¨æ€å­˜å‚¨çš„åœºæ™¯æ—¶æ•°ç»„å°±æœ‰ç‚¹åŠ›ä¸ä»å¿ƒäº†ã€‚</p>\n<p><strong>slice</strong>å°±æ˜¯ä¸ºäº†è§£å†³æ•°ç»„åœ¨é•¿åº¦ä¸Šä¸å¯å¢é•¿çš„é—®é¢˜ï¼ŒåŸºäºæ•°ç»„å®ç°äº†<strong>å˜é•¿æ•°ç»„</strong>çš„æœºåˆ¶</p>\n<h3 id=\"sliceåº•å±‚ç»“æ„\"><a href=\"#sliceåº•å±‚ç»“æ„\" class=\"headerlink\" title=\"sliceåº•å±‚ç»“æ„\"></a>sliceåº•å±‚ç»“æ„</h3><p>sliceåº•å±‚ç»“æ„å¦‚ä¸‹ï¼š</p>\n<figure class=\"highlight go\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">type</span> slice <span class=\"keyword\">struct</span> &#123;</span><br><span class=\"line\">    <span class=\"comment\">// åº•å±‚æ•°ç»„æŒ‡é’ˆ</span></span><br><span class=\"line\">    array unsafe.Pointer</span><br><span class=\"line\">    <span class=\"comment\">// sliceçš„é•¿åº¦</span></span><br><span class=\"line\">    <span class=\"built_in\">len</span> <span class=\"type\">int</span></span><br><span class=\"line\">    <span class=\"comment\">// å®¹é‡</span></span><br><span class=\"line\">    <span class=\"built_in\">cap</span> <span class=\"type\">int</span></span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n\n<p>sliceæ‰©å®¹ä¸¤æ­¥éª¤ï¼š</p>\n<ol>\n<li>è®¡ç®—æ‰€éœ€å®¹é‡<ol>\n<li>å¦‚æœ<strong>æ–°åˆ‡ç‰‡çš„é•¿åº¦ï¼æ—§åˆ‡ç‰‡çš„å®¹é‡çš„ä¸¤å€</strong>ï¼Œé‚£ä¹ˆæ–°åˆ‡ç‰‡çš„å®¹é‡ç­‰äºé•¿åº¦</li>\n<li>å¦åˆ™<ol>\n<li>å¦‚æœ<strong>æ—§åˆ‡ç‰‡çš„å®¹é‡ï¼œ256</strong>ï¼Œé‚£ä¹ˆæ–°åˆ‡ç‰‡çš„å®¹é‡å°±æ˜¯åŸå®¹é‡çš„ä¸¤å€</li>\n<li>å¦åˆ™æ–°åˆ‡ç‰‡çš„å®¹é‡å°±æ˜¯<strong>1.25 * åŸåˆ‡ç‰‡å®¹é‡+3&#x2F;4 * 256</strong></li>\n</ol>\n</li>\n</ol>\n</li>\n<li>å†…å­˜å¯¹é½ï¼Œç¡®å®šæœ€ç»ˆå®¹é‡<ol>\n<li>æŒ‰ç…§Goå†…å­˜ç®¡ç†çš„çº§åˆ«ç¡®å¯¹é½å†…å­˜ï¼Œæœ€ç»ˆå®¹é‡ä»¥æ­¤ä¸ºå‡†</li>\n</ol>\n</li>\n</ol>\n<h3 id=\"sliceé—®é¢˜è§£å¯†\"><a href=\"#sliceé—®é¢˜è§£å¯†\" class=\"headerlink\" title=\"sliceé—®é¢˜è§£å¯†\"></a>sliceé—®é¢˜è§£å¯†</h3><ul>\n<li><p>sliceé€šè¿‡å‡½æ•°ä¼ é€’çš„æ˜¯ä»€ä¹ˆï¼Ÿ</p>\n<ul>\n<li><p>ä¼ é€’çš„æ˜¯åº•å±‚sliceç»“æ„ä½“çš„æ‹·è´</p>\n</li>\n<li><pre><code class=\"go\">func PrintSliceStruct(s *[]int) &#123;\n    ss := (*reflect.SliceHeader)(unsafe.Pointer(s))\n    fmt.Printf(&quot;slice struct: %+v, slice is %v\\n&quot;, ss, s)\n&#125;\n\nfunc test(s []int) &#123;\n    fmt.Printf(&quot;slice address in main is %p\t&quot;, &amp;s)\n    PrintSliceStruct(&amp;s)\n&#125;\n\nfunc main() &#123;\n    s := make([]int, 5, 10)\n    fmt.Printf(&quot;slice address in main is %p\t&quot;, &amp;s)\n    PrintSliceStruct(&amp;s)\n    test(s)\n    /*\n    slice address in main is 0xc000008048\tslice struct: &amp;&#123;Data:824633788048 Len:5 Cap:10&#125;, slice is &amp;[0 0 0 0 0]\n    slice address in main is 0xc000008078\tslice struct: &amp;&#123;Data:824633788048 Len:5 Cap:10&#125;, slice is &amp;[0 0 0 0 0]\n     */\n&#125;\n<figure class=\"highlight plaintext\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"></span><br><span class=\"line\">- åœ¨å‡½æ•°é‡Œé¢æ”¹å˜sliceï¼Œå¤–å±‚ä¼šå—åˆ°å½±å“å—ï¼Ÿ</span><br><span class=\"line\"></span><br><span class=\"line\">  - åªè¦ä¿®æ”¹çš„åº•å±‚æ•°ç»„æ˜¯åŒä¸€ä¸ªï¼Œé‚£ä¹ˆå°±ä¼šå—åˆ°å½±å“</span><br></pre></td></tr></table></figure>\nfunc test1(s []int) &#123;\n    s[0] = 7\n    fmt.Printf(&quot;test1 value %v\\n&quot;, s)\n&#125;\n\nfunc test2(s []int) &#123;\n    s = append(s, 4)\n    fmt.Printf(&quot;test2 value %v\\n&quot;, s)\n&#125;\n\nfunc main() &#123;\n    s := []int&#123;1, 2, 3&#125;\n    fmt.Printf(&quot;initial value of s: %v\\n&quot;, s)\n    test1(s) // åº•å±‚æ•°ç»„ç›¸åŒï¼Œä¼šå—åˆ°å½±å“\n    fmt.Printf(&quot;after test1, value of s: %v\\n&quot;, s)\n    test2(s) // åº•å±‚æ•°ç»„å‘ç”Ÿå˜åŒ–ï¼Œä¸å—å½±å“\n    fmt.Printf(&quot;after test2, value of s: %v\\n&quot;, s)\n    /*\n    initial value of s: [1 2 3]\n    test1 value [7 2 3]\n    after test1, value of s: [7 2 3]\n    test2 value [7 2 3 4]\n    after test2, value of s: [7 2 3]\n     */\n&#125;\n</code></pre>\n</li>\n</ul>\n</li>\n</ul>\n<pre><code>## sync.map\n\nè¿™é‡Œæ˜¯sync.map\n</code></pre>\n"},{"description":"è®°å½•Goæ•´æ´å¼€å‘çš„ä¸€äº›æŠ€å·§","_content":"\n\n\n# Goå®æˆ˜ç¬”è®°\n\n## chapter1\n\n`gin.H`æœ¬è´¨æ˜¯ä¸€ä¸ª`map[string]interface{}`çš„ç±»å‹åˆ«åã€‚å®ƒä¸»è¦ç”¨äºçµæ´»æ–¹ä¾¿åœ°æ„é€ JSONæ ¼å¼æ•°æ®\n\n```go\nfunc main() {\n\tserver := gin.Default()\n\tserver.GET(\"/ping\", func(ctx *gin.Context) {\n\t\tctx.JSON(http.StatusOK, gin.H{\n\t\t\t\"message\": \"pong\",\n\t\t})\n\t})\n\tserver.Run(\":8080\")\n}\n```\n\n## chapter2ï¼šé…ç½®\n\n**æ–‡ä»¶ç»“æ„ï¼š**\n\n![image-20241113164141040](https://raw.githubusercontent.com/lyydsheep/pic/main/202411131641068.png)\n\n- ä¸‰ä¸ª`yaml`æ–‡ä»¶åˆ†åˆ«å¯¹åº”ä¸åŒçš„åœºæ™¯\n\n- configæ–‡ä»¶ä¸­å®šä¹‰è¯»å–é…ç½®æ‰€éœ€çš„ç»“æ„ä½“ç±»å‹\n\n```go\npackage config\n\nimport \"time\"\n\nvar (\n\tApp      appConfig\n\tDataBase dataBaseConfig\n)\n\ntype appConfig struct {\n\tEnv  string `yaml:\"env\"`\n\tName string `yaml:\"name\"`\n}\n\ntype dataBaseConfig struct {\n\tType        string        `yaml:\"type\"`\n\tDsn         string        `yaml:\"dsn\"`\n\tMaxOpen     int64         `yaml:\"max_open\"`\n\tMaxIdle     int64         `yaml:\"max_idle\"`\n\tMaxFileTime time.Duration `yaml:\"max_file_time\"`\n}\n```\n\n- bootstrapæ–‡ä»¶å®šä¹‰åˆå§‹åŒ–é…ç½®çš„æ–¹æ³•\n\n```go\n//go:embed *.yaml\nvar configs embed.FS\n\nfunc init() {\n\tfileName := os.Getenv(\"fileName\")\n\tfmt.Println(fileName)\n\tvp := viper.New()\n\tconfigFileStream, err := configs.ReadFile(\"application.\" + fileName + \".yaml\")\n\tif err != nil {\n\t\tpanic(err)\n\t}\n\tvp.SetConfigType(\"yaml\")\n\terr = vp.ReadConfig(bytes.NewReader(configFileStream))\n\tif err != nil {\n\t\tpanic(err)\n\t}\n\terr = vp.UnmarshalKey(\"app\", &App)\n\tif err != nil {\n\t\tpanic(err)\n\t}\n\terr = vp.UnmarshalKey(\"database\", &DataBase)\n\tif err != nil {\n\t\tpanic(err)\n\t}\n}\n```\n\n**å°†é…ç½®æ–‡ä»¶å’Œé¡¹ç›®ä¸€èµ·æ‰“åŒ…**\n\nä½¿ç”¨go:embedåŠŸèƒ½å¯ä»¥å°†é™æ€æ–‡ä»¶åµŒå…¥Goé¡¹ç›®ä¸­ï¼Œè¿™æ ·åœ¨è°ƒç”¨`go build .`å‘½ä»¤åé…ç½®æ–‡ä»¶å°±ä¼šå’Œé¡¹ç›®ä¸€å—æ‰“åŒ…ç¼–è¯‘æˆå¯æ‰§è¡Œæ–‡ä»¶äº†\n\nå€¼å¾—æ³¨æ„çš„æ˜¯ï¼Œåªæœ‰åœ¨ä¹¦å†™äº†go:embedçš„.goæ–‡ä»¶**åŒä¸€çº§ç›®å½•æˆ–å­ç›®å½•ä¸‹**çš„é™æ€æ–‡ä»¶æ‰ä¼šè¢«ä¸€èµ·åµŒå…¥æ‰“åŒ…\n\n## chapter3ï¼šè‡ªå®šä¹‰å’Œå½’æ¡£æ—¥å¿—\n\n**ä¸¤ä¸ªé‡è¦çš„åº“**ï¼š[zap](https://github.com/uber-go/zap)ã€[umberjack](https://github.com/natefinch/lumberjack)\n\n### æ—¥å¿—ç›¸å…³é…ç½®å‡†å¤‡\n\n**æ–‡ä»¶é…ç½®ï¼š**\n\n```yaml\napp:\n  env: \"dev\"\n  name: \"go-mall\"\n  log:\n    # æ—¥å¿—æ–‡ä»¶è·¯å¾„ï¼Œä»é¡¹ç›®è·¯å¾„å¼€å§‹å‡ºå‘\n    path: \"./tmp/go-mall.log\"\n    # æ–‡ä»¶æœ€å¤§ä½“ç§¯ï¼ˆMï¼‰å’Œæœ‰æ•ˆæœŸï¼ˆDayï¼‰\n    max_size: 1\n    max_age: 60\n```\n\n**ååºåˆ—åŒ–ç»“æ„ä½“ï¼š**\n\n```go\ntype appConfig struct {\n\t// ç”¨mapstructureæ ‡ç­¾å°±æœ‰æ•ˆ\n\tEnv  string `mapstructure:\"env\"`\n\tName string `mapstructure:\"name\"`\n\tLog  struct {\n\t\tFilePath    string `mapstructure:\"path\"`\n\t\tFileMaxSize int    `mapstructure:\"max_size\"`\n\t\tFileMaxAge  int    `mapstructure:\"max_age\"`\n\t}\n}\n```\n\n### åˆå§‹åŒ–æ—¥å¿—ç»„ä»¶\n\n**ç›®å½•ç»“æ„ï¼š**\n\n![image-20241117150445307](https://raw.githubusercontent.com/lyydsheep/pic/main/202411171504369.png)\n\n- env.goä¸­å®šä¹‰äº†ä¸åŒç¯å¢ƒçš„æšä¸¾å€¼\n  - ![image-20241117183814150](https://raw.githubusercontent.com/lyydsheep/pic/main/202411171838214.png)\n\n- zap.goä¸­å¯¹**å…¨å±€æ—¥å¿—å˜é‡**è¿›è¡Œåˆå§‹åŒ–ï¼šè¿™é‡Œä½¿ç”¨Goè‡ªå¸¦çš„initæ–¹æ³•è¿›è¡Œåˆå§‹åŒ–ï¼Œä¹Ÿå¯ä»¥è‡ªå·±å°è£…ä¸€ä¸ªInitå‡½æ•°ï¼Œåœ¨é¡¹ç›®ä¸­æ‰‹åŠ¨è°ƒç”¨å‡½æ•°å®Œæˆåˆå§‹åŒ–æ“ä½œ\n  - ä½¿ç”¨Goè‡ªå¸¦çš„initæ–¹æ³•çš„å¼Šç«¯åœ¨äºæœ‰çš„ä»£ç é€»è¾‘ä¾èµ–äºå„ä¸ªinitçš„æ‰§è¡Œé¡ºåºï¼Œè€Œè¿™ç§åˆå§‹åŒ–æ–¹æ³•éš¾ä»¥ç¡®ä¿åˆå§‹åŒ–é¡ºåº\n\n```go\n// zapåªä¼šå½“åšåŸºç¡€Loggerï¼Œæ‰€ä»¥åªæŠŠè¯¥å˜é‡å®šä¹‰æˆåŒ…å†…è®¿é—®çš„å…¨å±€å˜é‡\nvar Logger *zap.Logger\n\nfunc init() {\n\t// é…ç½®encoderä¿¡æ¯\n\tcfg := zap.NewProductionEncoderConfig()\n\tcfg.EncodeTime = zapcore.ISO8601TimeEncoder\n\tcfg.TimeKey = \"time\"\n\tcfg.MessageKey = \"msg\"\n\tencoder := zapcore.NewJSONEncoder(cfg)\n\tfileWriter := getFileLogWriter()\n\tvar cores []zapcore.Core\n\tswitch config.App.Env {\n\tcase enum.ModeTest, enum.ModeProd:\n\t\t// æµ‹è¯•ã€ç”Ÿäº§ç¯å¢ƒä»…å°†infoçº§åˆ«çº§ä»¥ä¸Šæ—¥å¿—å†™å…¥æ–‡ä»¶\n\t\tcores = append(cores, zapcore.NewCore(encoder, fileWriter, zapcore.InfoLevel))\n\tcase enum.ModeDev:\n\t\t// æœ¬åœ°ç¯å¢ƒå°†æ‰€æœ‰çš„æ—¥å¿—å†™å…¥æ–‡ä»¶å’Œæ§åˆ¶å°\n\t\tcores = append(cores, zapcore.NewCore(encoder, fileWriter, zapcore.DebugLevel),\n\t\t\tzapcore.NewCore(encoder, zapcore.WriteSyncer(os.Stdout), zapcore.DebugLevel))\n\tdefault:\n\t\tpanic(\"config.App.Env is invalid\")\n\t}\n\t// ç±»å‹å®šä¹‰å®ç°æ¥å£\n\tcore := zapcore.NewTee(cores...)\n\tLogger = zap.New(core)\n}\n\nfunc getFileLogWriter() zapcore.WriteSyncer {\n\treturn zapcore.AddSync(&lumberjack.Logger{\n\t\tFilename:  config.App.Log.FilePath,\n\t\tMaxAge:    config.App.Log.FileMaxAge,\n\t\tMaxSize:   config.App.Log.FileMaxSize,\n\t\tCompress:  false,\n\t\tLocalTime: true,\n\t})\n}\n```\n\n","source":"_posts/Go/Goç”µå•†å®æˆ˜ç¬”è®°.md","raw":"---\ndescription: è®°å½•Goæ•´æ´å¼€å‘çš„ä¸€äº›æŠ€å·§\ntags:\n- Go\n- é¡¹ç›®\n---\n\n\n\n# Goå®æˆ˜ç¬”è®°\n\n## chapter1\n\n`gin.H`æœ¬è´¨æ˜¯ä¸€ä¸ª`map[string]interface{}`çš„ç±»å‹åˆ«åã€‚å®ƒä¸»è¦ç”¨äºçµæ´»æ–¹ä¾¿åœ°æ„é€ JSONæ ¼å¼æ•°æ®\n\n```go\nfunc main() {\n\tserver := gin.Default()\n\tserver.GET(\"/ping\", func(ctx *gin.Context) {\n\t\tctx.JSON(http.StatusOK, gin.H{\n\t\t\t\"message\": \"pong\",\n\t\t})\n\t})\n\tserver.Run(\":8080\")\n}\n```\n\n## chapter2ï¼šé…ç½®\n\n**æ–‡ä»¶ç»“æ„ï¼š**\n\n![image-20241113164141040](https://raw.githubusercontent.com/lyydsheep/pic/main/202411131641068.png)\n\n- ä¸‰ä¸ª`yaml`æ–‡ä»¶åˆ†åˆ«å¯¹åº”ä¸åŒçš„åœºæ™¯\n\n- configæ–‡ä»¶ä¸­å®šä¹‰è¯»å–é…ç½®æ‰€éœ€çš„ç»“æ„ä½“ç±»å‹\n\n```go\npackage config\n\nimport \"time\"\n\nvar (\n\tApp      appConfig\n\tDataBase dataBaseConfig\n)\n\ntype appConfig struct {\n\tEnv  string `yaml:\"env\"`\n\tName string `yaml:\"name\"`\n}\n\ntype dataBaseConfig struct {\n\tType        string        `yaml:\"type\"`\n\tDsn         string        `yaml:\"dsn\"`\n\tMaxOpen     int64         `yaml:\"max_open\"`\n\tMaxIdle     int64         `yaml:\"max_idle\"`\n\tMaxFileTime time.Duration `yaml:\"max_file_time\"`\n}\n```\n\n- bootstrapæ–‡ä»¶å®šä¹‰åˆå§‹åŒ–é…ç½®çš„æ–¹æ³•\n\n```go\n//go:embed *.yaml\nvar configs embed.FS\n\nfunc init() {\n\tfileName := os.Getenv(\"fileName\")\n\tfmt.Println(fileName)\n\tvp := viper.New()\n\tconfigFileStream, err := configs.ReadFile(\"application.\" + fileName + \".yaml\")\n\tif err != nil {\n\t\tpanic(err)\n\t}\n\tvp.SetConfigType(\"yaml\")\n\terr = vp.ReadConfig(bytes.NewReader(configFileStream))\n\tif err != nil {\n\t\tpanic(err)\n\t}\n\terr = vp.UnmarshalKey(\"app\", &App)\n\tif err != nil {\n\t\tpanic(err)\n\t}\n\terr = vp.UnmarshalKey(\"database\", &DataBase)\n\tif err != nil {\n\t\tpanic(err)\n\t}\n}\n```\n\n**å°†é…ç½®æ–‡ä»¶å’Œé¡¹ç›®ä¸€èµ·æ‰“åŒ…**\n\nä½¿ç”¨go:embedåŠŸèƒ½å¯ä»¥å°†é™æ€æ–‡ä»¶åµŒå…¥Goé¡¹ç›®ä¸­ï¼Œè¿™æ ·åœ¨è°ƒç”¨`go build .`å‘½ä»¤åé…ç½®æ–‡ä»¶å°±ä¼šå’Œé¡¹ç›®ä¸€å—æ‰“åŒ…ç¼–è¯‘æˆå¯æ‰§è¡Œæ–‡ä»¶äº†\n\nå€¼å¾—æ³¨æ„çš„æ˜¯ï¼Œåªæœ‰åœ¨ä¹¦å†™äº†go:embedçš„.goæ–‡ä»¶**åŒä¸€çº§ç›®å½•æˆ–å­ç›®å½•ä¸‹**çš„é™æ€æ–‡ä»¶æ‰ä¼šè¢«ä¸€èµ·åµŒå…¥æ‰“åŒ…\n\n## chapter3ï¼šè‡ªå®šä¹‰å’Œå½’æ¡£æ—¥å¿—\n\n**ä¸¤ä¸ªé‡è¦çš„åº“**ï¼š[zap](https://github.com/uber-go/zap)ã€[umberjack](https://github.com/natefinch/lumberjack)\n\n### æ—¥å¿—ç›¸å…³é…ç½®å‡†å¤‡\n\n**æ–‡ä»¶é…ç½®ï¼š**\n\n```yaml\napp:\n  env: \"dev\"\n  name: \"go-mall\"\n  log:\n    # æ—¥å¿—æ–‡ä»¶è·¯å¾„ï¼Œä»é¡¹ç›®è·¯å¾„å¼€å§‹å‡ºå‘\n    path: \"./tmp/go-mall.log\"\n    # æ–‡ä»¶æœ€å¤§ä½“ç§¯ï¼ˆMï¼‰å’Œæœ‰æ•ˆæœŸï¼ˆDayï¼‰\n    max_size: 1\n    max_age: 60\n```\n\n**ååºåˆ—åŒ–ç»“æ„ä½“ï¼š**\n\n```go\ntype appConfig struct {\n\t// ç”¨mapstructureæ ‡ç­¾å°±æœ‰æ•ˆ\n\tEnv  string `mapstructure:\"env\"`\n\tName string `mapstructure:\"name\"`\n\tLog  struct {\n\t\tFilePath    string `mapstructure:\"path\"`\n\t\tFileMaxSize int    `mapstructure:\"max_size\"`\n\t\tFileMaxAge  int    `mapstructure:\"max_age\"`\n\t}\n}\n```\n\n### åˆå§‹åŒ–æ—¥å¿—ç»„ä»¶\n\n**ç›®å½•ç»“æ„ï¼š**\n\n![image-20241117150445307](https://raw.githubusercontent.com/lyydsheep/pic/main/202411171504369.png)\n\n- env.goä¸­å®šä¹‰äº†ä¸åŒç¯å¢ƒçš„æšä¸¾å€¼\n  - ![image-20241117183814150](https://raw.githubusercontent.com/lyydsheep/pic/main/202411171838214.png)\n\n- zap.goä¸­å¯¹**å…¨å±€æ—¥å¿—å˜é‡**è¿›è¡Œåˆå§‹åŒ–ï¼šè¿™é‡Œä½¿ç”¨Goè‡ªå¸¦çš„initæ–¹æ³•è¿›è¡Œåˆå§‹åŒ–ï¼Œä¹Ÿå¯ä»¥è‡ªå·±å°è£…ä¸€ä¸ªInitå‡½æ•°ï¼Œåœ¨é¡¹ç›®ä¸­æ‰‹åŠ¨è°ƒç”¨å‡½æ•°å®Œæˆåˆå§‹åŒ–æ“ä½œ\n  - ä½¿ç”¨Goè‡ªå¸¦çš„initæ–¹æ³•çš„å¼Šç«¯åœ¨äºæœ‰çš„ä»£ç é€»è¾‘ä¾èµ–äºå„ä¸ªinitçš„æ‰§è¡Œé¡ºåºï¼Œè€Œè¿™ç§åˆå§‹åŒ–æ–¹æ³•éš¾ä»¥ç¡®ä¿åˆå§‹åŒ–é¡ºåº\n\n```go\n// zapåªä¼šå½“åšåŸºç¡€Loggerï¼Œæ‰€ä»¥åªæŠŠè¯¥å˜é‡å®šä¹‰æˆåŒ…å†…è®¿é—®çš„å…¨å±€å˜é‡\nvar Logger *zap.Logger\n\nfunc init() {\n\t// é…ç½®encoderä¿¡æ¯\n\tcfg := zap.NewProductionEncoderConfig()\n\tcfg.EncodeTime = zapcore.ISO8601TimeEncoder\n\tcfg.TimeKey = \"time\"\n\tcfg.MessageKey = \"msg\"\n\tencoder := zapcore.NewJSONEncoder(cfg)\n\tfileWriter := getFileLogWriter()\n\tvar cores []zapcore.Core\n\tswitch config.App.Env {\n\tcase enum.ModeTest, enum.ModeProd:\n\t\t// æµ‹è¯•ã€ç”Ÿäº§ç¯å¢ƒä»…å°†infoçº§åˆ«çº§ä»¥ä¸Šæ—¥å¿—å†™å…¥æ–‡ä»¶\n\t\tcores = append(cores, zapcore.NewCore(encoder, fileWriter, zapcore.InfoLevel))\n\tcase enum.ModeDev:\n\t\t// æœ¬åœ°ç¯å¢ƒå°†æ‰€æœ‰çš„æ—¥å¿—å†™å…¥æ–‡ä»¶å’Œæ§åˆ¶å°\n\t\tcores = append(cores, zapcore.NewCore(encoder, fileWriter, zapcore.DebugLevel),\n\t\t\tzapcore.NewCore(encoder, zapcore.WriteSyncer(os.Stdout), zapcore.DebugLevel))\n\tdefault:\n\t\tpanic(\"config.App.Env is invalid\")\n\t}\n\t// ç±»å‹å®šä¹‰å®ç°æ¥å£\n\tcore := zapcore.NewTee(cores...)\n\tLogger = zap.New(core)\n}\n\nfunc getFileLogWriter() zapcore.WriteSyncer {\n\treturn zapcore.AddSync(&lumberjack.Logger{\n\t\tFilename:  config.App.Log.FilePath,\n\t\tMaxAge:    config.App.Log.FileMaxAge,\n\t\tMaxSize:   config.App.Log.FileMaxSize,\n\t\tCompress:  false,\n\t\tLocalTime: true,\n\t})\n}\n```\n\n","slug":"Go/Goç”µå•†å®æˆ˜ç¬”è®°","published":1,"date":"2024-12-27T11:03:15.342Z","updated":"2024-12-27T11:03:15.342Z","title":"","comments":1,"layout":"post","photos":[],"_id":"cm6c7md6m001za5t2ex0zfbv6","content":"<h1 id=\"Goå®æˆ˜ç¬”è®°\"><a href=\"#Goå®æˆ˜ç¬”è®°\" class=\"headerlink\" title=\"Goå®æˆ˜ç¬”è®°\"></a>Goå®æˆ˜ç¬”è®°</h1><h2 id=\"chapter1\"><a href=\"#chapter1\" class=\"headerlink\" title=\"chapter1\"></a>chapter1</h2><p><code>gin.H</code>æœ¬è´¨æ˜¯ä¸€ä¸ª<code>map[string]interface&#123;&#125;</code>çš„ç±»å‹åˆ«åã€‚å®ƒä¸»è¦ç”¨äºçµæ´»æ–¹ä¾¿åœ°æ„é€ JSONæ ¼å¼æ•°æ®</p>\n<figure class=\"highlight go\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"function\"><span class=\"keyword\">func</span> <span class=\"title\">main</span><span class=\"params\">()</span></span> &#123;</span><br><span class=\"line\">\tserver := gin.Default()</span><br><span class=\"line\">\tserver.GET(<span class=\"string\">&quot;/ping&quot;</span>, <span class=\"function\"><span class=\"keyword\">func</span><span class=\"params\">(ctx *gin.Context)</span></span> &#123;</span><br><span class=\"line\">\t\tctx.JSON(http.StatusOK, gin.H&#123;</span><br><span class=\"line\">\t\t\t<span class=\"string\">&quot;message&quot;</span>: <span class=\"string\">&quot;pong&quot;</span>,</span><br><span class=\"line\">\t\t&#125;)</span><br><span class=\"line\">\t&#125;)</span><br><span class=\"line\">\tserver.Run(<span class=\"string\">&quot;:8080&quot;</span>)</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n\n<h2 id=\"chapter2ï¼šé…ç½®\"><a href=\"#chapter2ï¼šé…ç½®\" class=\"headerlink\" title=\"chapter2ï¼šé…ç½®\"></a>chapter2ï¼šé…ç½®</h2><p><strong>æ–‡ä»¶ç»“æ„ï¼š</strong></p>\n<p><img src=\"https://raw.githubusercontent.com/lyydsheep/pic/main/202411131641068.png\" alt=\"image-20241113164141040\"></p>\n<ul>\n<li><p>ä¸‰ä¸ª<code>yaml</code>æ–‡ä»¶åˆ†åˆ«å¯¹åº”ä¸åŒçš„åœºæ™¯</p>\n</li>\n<li><p>configæ–‡ä»¶ä¸­å®šä¹‰è¯»å–é…ç½®æ‰€éœ€çš„ç»“æ„ä½“ç±»å‹</p>\n</li>\n</ul>\n<figure class=\"highlight go\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">package</span> config</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"keyword\">import</span> <span class=\"string\">&quot;time&quot;</span></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"keyword\">var</span> (</span><br><span class=\"line\">\tApp      appConfig</span><br><span class=\"line\">\tDataBase dataBaseConfig</span><br><span class=\"line\">)</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"keyword\">type</span> appConfig <span class=\"keyword\">struct</span> &#123;</span><br><span class=\"line\">\tEnv  <span class=\"type\">string</span> <span class=\"string\">`yaml:&quot;env&quot;`</span></span><br><span class=\"line\">\tName <span class=\"type\">string</span> <span class=\"string\">`yaml:&quot;name&quot;`</span></span><br><span class=\"line\">&#125;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"keyword\">type</span> dataBaseConfig <span class=\"keyword\">struct</span> &#123;</span><br><span class=\"line\">\tType        <span class=\"type\">string</span>        <span class=\"string\">`yaml:&quot;type&quot;`</span></span><br><span class=\"line\">\tDsn         <span class=\"type\">string</span>        <span class=\"string\">`yaml:&quot;dsn&quot;`</span></span><br><span class=\"line\">\tMaxOpen     <span class=\"type\">int64</span>         <span class=\"string\">`yaml:&quot;max_open&quot;`</span></span><br><span class=\"line\">\tMaxIdle     <span class=\"type\">int64</span>         <span class=\"string\">`yaml:&quot;max_idle&quot;`</span></span><br><span class=\"line\">\tMaxFileTime time.Duration <span class=\"string\">`yaml:&quot;max_file_time&quot;`</span></span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n\n<ul>\n<li>bootstrapæ–‡ä»¶å®šä¹‰åˆå§‹åŒ–é…ç½®çš„æ–¹æ³•</li>\n</ul>\n<figure class=\"highlight go\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\">//go:embed *.yaml</span></span><br><span class=\"line\"><span class=\"keyword\">var</span> configs embed.FS</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"function\"><span class=\"keyword\">func</span> <span class=\"title\">init</span><span class=\"params\">()</span></span> &#123;</span><br><span class=\"line\">\tfileName := os.Getenv(<span class=\"string\">&quot;fileName&quot;</span>)</span><br><span class=\"line\">\tfmt.Println(fileName)</span><br><span class=\"line\">\tvp := viper.New()</span><br><span class=\"line\">\tconfigFileStream, err := configs.ReadFile(<span class=\"string\">&quot;application.&quot;</span> + fileName + <span class=\"string\">&quot;.yaml&quot;</span>)</span><br><span class=\"line\">\t<span class=\"keyword\">if</span> err != <span class=\"literal\">nil</span> &#123;</span><br><span class=\"line\">\t\t<span class=\"built_in\">panic</span>(err)</span><br><span class=\"line\">\t&#125;</span><br><span class=\"line\">\tvp.SetConfigType(<span class=\"string\">&quot;yaml&quot;</span>)</span><br><span class=\"line\">\terr = vp.ReadConfig(bytes.NewReader(configFileStream))</span><br><span class=\"line\">\t<span class=\"keyword\">if</span> err != <span class=\"literal\">nil</span> &#123;</span><br><span class=\"line\">\t\t<span class=\"built_in\">panic</span>(err)</span><br><span class=\"line\">\t&#125;</span><br><span class=\"line\">\terr = vp.UnmarshalKey(<span class=\"string\">&quot;app&quot;</span>, &amp;App)</span><br><span class=\"line\">\t<span class=\"keyword\">if</span> err != <span class=\"literal\">nil</span> &#123;</span><br><span class=\"line\">\t\t<span class=\"built_in\">panic</span>(err)</span><br><span class=\"line\">\t&#125;</span><br><span class=\"line\">\terr = vp.UnmarshalKey(<span class=\"string\">&quot;database&quot;</span>, &amp;DataBase)</span><br><span class=\"line\">\t<span class=\"keyword\">if</span> err != <span class=\"literal\">nil</span> &#123;</span><br><span class=\"line\">\t\t<span class=\"built_in\">panic</span>(err)</span><br><span class=\"line\">\t&#125;</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n\n<p><strong>å°†é…ç½®æ–‡ä»¶å’Œé¡¹ç›®ä¸€èµ·æ‰“åŒ…</strong></p>\n<p>ä½¿ç”¨go:embedåŠŸèƒ½å¯ä»¥å°†é™æ€æ–‡ä»¶åµŒå…¥Goé¡¹ç›®ä¸­ï¼Œè¿™æ ·åœ¨è°ƒç”¨<code>go build .</code>å‘½ä»¤åé…ç½®æ–‡ä»¶å°±ä¼šå’Œé¡¹ç›®ä¸€å—æ‰“åŒ…ç¼–è¯‘æˆå¯æ‰§è¡Œæ–‡ä»¶äº†</p>\n<p>å€¼å¾—æ³¨æ„çš„æ˜¯ï¼Œåªæœ‰åœ¨ä¹¦å†™äº†go:embedçš„.goæ–‡ä»¶<strong>åŒä¸€çº§ç›®å½•æˆ–å­ç›®å½•ä¸‹</strong>çš„é™æ€æ–‡ä»¶æ‰ä¼šè¢«ä¸€èµ·åµŒå…¥æ‰“åŒ…</p>\n<h2 id=\"chapter3ï¼šè‡ªå®šä¹‰å’Œå½’æ¡£æ—¥å¿—\"><a href=\"#chapter3ï¼šè‡ªå®šä¹‰å’Œå½’æ¡£æ—¥å¿—\" class=\"headerlink\" title=\"chapter3ï¼šè‡ªå®šä¹‰å’Œå½’æ¡£æ—¥å¿—\"></a>chapter3ï¼šè‡ªå®šä¹‰å’Œå½’æ¡£æ—¥å¿—</h2><p><strong>ä¸¤ä¸ªé‡è¦çš„åº“</strong>ï¼š<a href=\"https://github.com/uber-go/zap\">zap</a>ã€<a href=\"https://github.com/natefinch/lumberjack\">umberjack</a></p>\n<h3 id=\"æ—¥å¿—ç›¸å…³é…ç½®å‡†å¤‡\"><a href=\"#æ—¥å¿—ç›¸å…³é…ç½®å‡†å¤‡\" class=\"headerlink\" title=\"æ—¥å¿—ç›¸å…³é…ç½®å‡†å¤‡\"></a>æ—¥å¿—ç›¸å…³é…ç½®å‡†å¤‡</h3><p><strong>æ–‡ä»¶é…ç½®ï¼š</strong></p>\n<figure class=\"highlight yaml\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"attr\">app:</span></span><br><span class=\"line\">  <span class=\"attr\">env:</span> <span class=\"string\">&quot;dev&quot;</span></span><br><span class=\"line\">  <span class=\"attr\">name:</span> <span class=\"string\">&quot;go-mall&quot;</span></span><br><span class=\"line\">  <span class=\"attr\">log:</span></span><br><span class=\"line\">    <span class=\"comment\"># æ—¥å¿—æ–‡ä»¶è·¯å¾„ï¼Œä»é¡¹ç›®è·¯å¾„å¼€å§‹å‡ºå‘</span></span><br><span class=\"line\">    <span class=\"attr\">path:</span> <span class=\"string\">&quot;./tmp/go-mall.log&quot;</span></span><br><span class=\"line\">    <span class=\"comment\"># æ–‡ä»¶æœ€å¤§ä½“ç§¯ï¼ˆMï¼‰å’Œæœ‰æ•ˆæœŸï¼ˆDayï¼‰</span></span><br><span class=\"line\">    <span class=\"attr\">max_size:</span> <span class=\"number\">1</span></span><br><span class=\"line\">    <span class=\"attr\">max_age:</span> <span class=\"number\">60</span></span><br></pre></td></tr></table></figure>\n\n<p><strong>ååºåˆ—åŒ–ç»“æ„ä½“ï¼š</strong></p>\n<figure class=\"highlight go\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">type</span> appConfig <span class=\"keyword\">struct</span> &#123;</span><br><span class=\"line\">\t<span class=\"comment\">// ç”¨mapstructureæ ‡ç­¾å°±æœ‰æ•ˆ</span></span><br><span class=\"line\">\tEnv  <span class=\"type\">string</span> <span class=\"string\">`mapstructure:&quot;env&quot;`</span></span><br><span class=\"line\">\tName <span class=\"type\">string</span> <span class=\"string\">`mapstructure:&quot;name&quot;`</span></span><br><span class=\"line\">\tLog  <span class=\"keyword\">struct</span> &#123;</span><br><span class=\"line\">\t\tFilePath    <span class=\"type\">string</span> <span class=\"string\">`mapstructure:&quot;path&quot;`</span></span><br><span class=\"line\">\t\tFileMaxSize <span class=\"type\">int</span>    <span class=\"string\">`mapstructure:&quot;max_size&quot;`</span></span><br><span class=\"line\">\t\tFileMaxAge  <span class=\"type\">int</span>    <span class=\"string\">`mapstructure:&quot;max_age&quot;`</span></span><br><span class=\"line\">\t&#125;</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n\n<h3 id=\"åˆå§‹åŒ–æ—¥å¿—ç»„ä»¶\"><a href=\"#åˆå§‹åŒ–æ—¥å¿—ç»„ä»¶\" class=\"headerlink\" title=\"åˆå§‹åŒ–æ—¥å¿—ç»„ä»¶\"></a>åˆå§‹åŒ–æ—¥å¿—ç»„ä»¶</h3><p><strong>ç›®å½•ç»“æ„ï¼š</strong></p>\n<p><img src=\"https://raw.githubusercontent.com/lyydsheep/pic/main/202411171504369.png\" alt=\"image-20241117150445307\"></p>\n<ul>\n<li><p>env.goä¸­å®šä¹‰äº†ä¸åŒç¯å¢ƒçš„æšä¸¾å€¼</p>\n<ul>\n<li><img src=\"https://raw.githubusercontent.com/lyydsheep/pic/main/202411171838214.png\" alt=\"image-20241117183814150\"></li>\n</ul>\n</li>\n<li><p>zap.goä¸­å¯¹<strong>å…¨å±€æ—¥å¿—å˜é‡</strong>è¿›è¡Œåˆå§‹åŒ–ï¼šè¿™é‡Œä½¿ç”¨Goè‡ªå¸¦çš„initæ–¹æ³•è¿›è¡Œåˆå§‹åŒ–ï¼Œä¹Ÿå¯ä»¥è‡ªå·±å°è£…ä¸€ä¸ªInitå‡½æ•°ï¼Œåœ¨é¡¹ç›®ä¸­æ‰‹åŠ¨è°ƒç”¨å‡½æ•°å®Œæˆåˆå§‹åŒ–æ“ä½œ</p>\n<ul>\n<li>ä½¿ç”¨Goè‡ªå¸¦çš„initæ–¹æ³•çš„å¼Šç«¯åœ¨äºæœ‰çš„ä»£ç é€»è¾‘ä¾èµ–äºå„ä¸ªinitçš„æ‰§è¡Œé¡ºåºï¼Œè€Œè¿™ç§åˆå§‹åŒ–æ–¹æ³•éš¾ä»¥ç¡®ä¿åˆå§‹åŒ–é¡ºåº</li>\n</ul>\n</li>\n</ul>\n<figure class=\"highlight go\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br><span class=\"line\">31</span><br><span class=\"line\">32</span><br><span class=\"line\">33</span><br><span class=\"line\">34</span><br><span class=\"line\">35</span><br><span class=\"line\">36</span><br><span class=\"line\">37</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\">// zapåªä¼šå½“åšåŸºç¡€Loggerï¼Œæ‰€ä»¥åªæŠŠè¯¥å˜é‡å®šä¹‰æˆåŒ…å†…è®¿é—®çš„å…¨å±€å˜é‡</span></span><br><span class=\"line\"><span class=\"keyword\">var</span> Logger *zap.Logger</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"function\"><span class=\"keyword\">func</span> <span class=\"title\">init</span><span class=\"params\">()</span></span> &#123;</span><br><span class=\"line\">\t<span class=\"comment\">// é…ç½®encoderä¿¡æ¯</span></span><br><span class=\"line\">\tcfg := zap.NewProductionEncoderConfig()</span><br><span class=\"line\">\tcfg.EncodeTime = zapcore.ISO8601TimeEncoder</span><br><span class=\"line\">\tcfg.TimeKey = <span class=\"string\">&quot;time&quot;</span></span><br><span class=\"line\">\tcfg.MessageKey = <span class=\"string\">&quot;msg&quot;</span></span><br><span class=\"line\">\tencoder := zapcore.NewJSONEncoder(cfg)</span><br><span class=\"line\">\tfileWriter := getFileLogWriter()</span><br><span class=\"line\">\t<span class=\"keyword\">var</span> cores []zapcore.Core</span><br><span class=\"line\">\t<span class=\"keyword\">switch</span> config.App.Env &#123;</span><br><span class=\"line\">\t<span class=\"keyword\">case</span> enum.ModeTest, enum.ModeProd:</span><br><span class=\"line\">\t\t<span class=\"comment\">// æµ‹è¯•ã€ç”Ÿäº§ç¯å¢ƒä»…å°†infoçº§åˆ«çº§ä»¥ä¸Šæ—¥å¿—å†™å…¥æ–‡ä»¶</span></span><br><span class=\"line\">\t\tcores = <span class=\"built_in\">append</span>(cores, zapcore.NewCore(encoder, fileWriter, zapcore.InfoLevel))</span><br><span class=\"line\">\t<span class=\"keyword\">case</span> enum.ModeDev:</span><br><span class=\"line\">\t\t<span class=\"comment\">// æœ¬åœ°ç¯å¢ƒå°†æ‰€æœ‰çš„æ—¥å¿—å†™å…¥æ–‡ä»¶å’Œæ§åˆ¶å°</span></span><br><span class=\"line\">\t\tcores = <span class=\"built_in\">append</span>(cores, zapcore.NewCore(encoder, fileWriter, zapcore.DebugLevel),</span><br><span class=\"line\">\t\t\tzapcore.NewCore(encoder, zapcore.WriteSyncer(os.Stdout), zapcore.DebugLevel))</span><br><span class=\"line\">\t<span class=\"keyword\">default</span>:</span><br><span class=\"line\">\t\t<span class=\"built_in\">panic</span>(<span class=\"string\">&quot;config.App.Env is invalid&quot;</span>)</span><br><span class=\"line\">\t&#125;</span><br><span class=\"line\">\t<span class=\"comment\">// ç±»å‹å®šä¹‰å®ç°æ¥å£</span></span><br><span class=\"line\">\tcore := zapcore.NewTee(cores...)</span><br><span class=\"line\">\tLogger = zap.New(core)</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"function\"><span class=\"keyword\">func</span> <span class=\"title\">getFileLogWriter</span><span class=\"params\">()</span></span> zapcore.WriteSyncer &#123;</span><br><span class=\"line\">\t<span class=\"keyword\">return</span> zapcore.AddSync(&amp;lumberjack.Logger&#123;</span><br><span class=\"line\">\t\tFilename:  config.App.Log.FilePath,</span><br><span class=\"line\">\t\tMaxAge:    config.App.Log.FileMaxAge,</span><br><span class=\"line\">\t\tMaxSize:   config.App.Log.FileMaxSize,</span><br><span class=\"line\">\t\tCompress:  <span class=\"literal\">false</span>,</span><br><span class=\"line\">\t\tLocalTime: <span class=\"literal\">true</span>,</span><br><span class=\"line\">\t&#125;)</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n\n","excerpt":"","more":"<h1 id=\"Goå®æˆ˜ç¬”è®°\"><a href=\"#Goå®æˆ˜ç¬”è®°\" class=\"headerlink\" title=\"Goå®æˆ˜ç¬”è®°\"></a>Goå®æˆ˜ç¬”è®°</h1><h2 id=\"chapter1\"><a href=\"#chapter1\" class=\"headerlink\" title=\"chapter1\"></a>chapter1</h2><p><code>gin.H</code>æœ¬è´¨æ˜¯ä¸€ä¸ª<code>map[string]interface&#123;&#125;</code>çš„ç±»å‹åˆ«åã€‚å®ƒä¸»è¦ç”¨äºçµæ´»æ–¹ä¾¿åœ°æ„é€ JSONæ ¼å¼æ•°æ®</p>\n<figure class=\"highlight go\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"function\"><span class=\"keyword\">func</span> <span class=\"title\">main</span><span class=\"params\">()</span></span> &#123;</span><br><span class=\"line\">\tserver := gin.Default()</span><br><span class=\"line\">\tserver.GET(<span class=\"string\">&quot;/ping&quot;</span>, <span class=\"function\"><span class=\"keyword\">func</span><span class=\"params\">(ctx *gin.Context)</span></span> &#123;</span><br><span class=\"line\">\t\tctx.JSON(http.StatusOK, gin.H&#123;</span><br><span class=\"line\">\t\t\t<span class=\"string\">&quot;message&quot;</span>: <span class=\"string\">&quot;pong&quot;</span>,</span><br><span class=\"line\">\t\t&#125;)</span><br><span class=\"line\">\t&#125;)</span><br><span class=\"line\">\tserver.Run(<span class=\"string\">&quot;:8080&quot;</span>)</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n\n<h2 id=\"chapter2ï¼šé…ç½®\"><a href=\"#chapter2ï¼šé…ç½®\" class=\"headerlink\" title=\"chapter2ï¼šé…ç½®\"></a>chapter2ï¼šé…ç½®</h2><p><strong>æ–‡ä»¶ç»“æ„ï¼š</strong></p>\n<p><img src=\"https://raw.githubusercontent.com/lyydsheep/pic/main/202411131641068.png\" alt=\"image-20241113164141040\"></p>\n<ul>\n<li><p>ä¸‰ä¸ª<code>yaml</code>æ–‡ä»¶åˆ†åˆ«å¯¹åº”ä¸åŒçš„åœºæ™¯</p>\n</li>\n<li><p>configæ–‡ä»¶ä¸­å®šä¹‰è¯»å–é…ç½®æ‰€éœ€çš„ç»“æ„ä½“ç±»å‹</p>\n</li>\n</ul>\n<figure class=\"highlight go\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">package</span> config</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"keyword\">import</span> <span class=\"string\">&quot;time&quot;</span></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"keyword\">var</span> (</span><br><span class=\"line\">\tApp      appConfig</span><br><span class=\"line\">\tDataBase dataBaseConfig</span><br><span class=\"line\">)</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"keyword\">type</span> appConfig <span class=\"keyword\">struct</span> &#123;</span><br><span class=\"line\">\tEnv  <span class=\"type\">string</span> <span class=\"string\">`yaml:&quot;env&quot;`</span></span><br><span class=\"line\">\tName <span class=\"type\">string</span> <span class=\"string\">`yaml:&quot;name&quot;`</span></span><br><span class=\"line\">&#125;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"keyword\">type</span> dataBaseConfig <span class=\"keyword\">struct</span> &#123;</span><br><span class=\"line\">\tType        <span class=\"type\">string</span>        <span class=\"string\">`yaml:&quot;type&quot;`</span></span><br><span class=\"line\">\tDsn         <span class=\"type\">string</span>        <span class=\"string\">`yaml:&quot;dsn&quot;`</span></span><br><span class=\"line\">\tMaxOpen     <span class=\"type\">int64</span>         <span class=\"string\">`yaml:&quot;max_open&quot;`</span></span><br><span class=\"line\">\tMaxIdle     <span class=\"type\">int64</span>         <span class=\"string\">`yaml:&quot;max_idle&quot;`</span></span><br><span class=\"line\">\tMaxFileTime time.Duration <span class=\"string\">`yaml:&quot;max_file_time&quot;`</span></span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n\n<ul>\n<li>bootstrapæ–‡ä»¶å®šä¹‰åˆå§‹åŒ–é…ç½®çš„æ–¹æ³•</li>\n</ul>\n<figure class=\"highlight go\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\">//go:embed *.yaml</span></span><br><span class=\"line\"><span class=\"keyword\">var</span> configs embed.FS</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"function\"><span class=\"keyword\">func</span> <span class=\"title\">init</span><span class=\"params\">()</span></span> &#123;</span><br><span class=\"line\">\tfileName := os.Getenv(<span class=\"string\">&quot;fileName&quot;</span>)</span><br><span class=\"line\">\tfmt.Println(fileName)</span><br><span class=\"line\">\tvp := viper.New()</span><br><span class=\"line\">\tconfigFileStream, err := configs.ReadFile(<span class=\"string\">&quot;application.&quot;</span> + fileName + <span class=\"string\">&quot;.yaml&quot;</span>)</span><br><span class=\"line\">\t<span class=\"keyword\">if</span> err != <span class=\"literal\">nil</span> &#123;</span><br><span class=\"line\">\t\t<span class=\"built_in\">panic</span>(err)</span><br><span class=\"line\">\t&#125;</span><br><span class=\"line\">\tvp.SetConfigType(<span class=\"string\">&quot;yaml&quot;</span>)</span><br><span class=\"line\">\terr = vp.ReadConfig(bytes.NewReader(configFileStream))</span><br><span class=\"line\">\t<span class=\"keyword\">if</span> err != <span class=\"literal\">nil</span> &#123;</span><br><span class=\"line\">\t\t<span class=\"built_in\">panic</span>(err)</span><br><span class=\"line\">\t&#125;</span><br><span class=\"line\">\terr = vp.UnmarshalKey(<span class=\"string\">&quot;app&quot;</span>, &amp;App)</span><br><span class=\"line\">\t<span class=\"keyword\">if</span> err != <span class=\"literal\">nil</span> &#123;</span><br><span class=\"line\">\t\t<span class=\"built_in\">panic</span>(err)</span><br><span class=\"line\">\t&#125;</span><br><span class=\"line\">\terr = vp.UnmarshalKey(<span class=\"string\">&quot;database&quot;</span>, &amp;DataBase)</span><br><span class=\"line\">\t<span class=\"keyword\">if</span> err != <span class=\"literal\">nil</span> &#123;</span><br><span class=\"line\">\t\t<span class=\"built_in\">panic</span>(err)</span><br><span class=\"line\">\t&#125;</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n\n<p><strong>å°†é…ç½®æ–‡ä»¶å’Œé¡¹ç›®ä¸€èµ·æ‰“åŒ…</strong></p>\n<p>ä½¿ç”¨go:embedåŠŸèƒ½å¯ä»¥å°†é™æ€æ–‡ä»¶åµŒå…¥Goé¡¹ç›®ä¸­ï¼Œè¿™æ ·åœ¨è°ƒç”¨<code>go build .</code>å‘½ä»¤åé…ç½®æ–‡ä»¶å°±ä¼šå’Œé¡¹ç›®ä¸€å—æ‰“åŒ…ç¼–è¯‘æˆå¯æ‰§è¡Œæ–‡ä»¶äº†</p>\n<p>å€¼å¾—æ³¨æ„çš„æ˜¯ï¼Œåªæœ‰åœ¨ä¹¦å†™äº†go:embedçš„.goæ–‡ä»¶<strong>åŒä¸€çº§ç›®å½•æˆ–å­ç›®å½•ä¸‹</strong>çš„é™æ€æ–‡ä»¶æ‰ä¼šè¢«ä¸€èµ·åµŒå…¥æ‰“åŒ…</p>\n<h2 id=\"chapter3ï¼šè‡ªå®šä¹‰å’Œå½’æ¡£æ—¥å¿—\"><a href=\"#chapter3ï¼šè‡ªå®šä¹‰å’Œå½’æ¡£æ—¥å¿—\" class=\"headerlink\" title=\"chapter3ï¼šè‡ªå®šä¹‰å’Œå½’æ¡£æ—¥å¿—\"></a>chapter3ï¼šè‡ªå®šä¹‰å’Œå½’æ¡£æ—¥å¿—</h2><p><strong>ä¸¤ä¸ªé‡è¦çš„åº“</strong>ï¼š<a href=\"https://github.com/uber-go/zap\">zap</a>ã€<a href=\"https://github.com/natefinch/lumberjack\">umberjack</a></p>\n<h3 id=\"æ—¥å¿—ç›¸å…³é…ç½®å‡†å¤‡\"><a href=\"#æ—¥å¿—ç›¸å…³é…ç½®å‡†å¤‡\" class=\"headerlink\" title=\"æ—¥å¿—ç›¸å…³é…ç½®å‡†å¤‡\"></a>æ—¥å¿—ç›¸å…³é…ç½®å‡†å¤‡</h3><p><strong>æ–‡ä»¶é…ç½®ï¼š</strong></p>\n<figure class=\"highlight yaml\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"attr\">app:</span></span><br><span class=\"line\">  <span class=\"attr\">env:</span> <span class=\"string\">&quot;dev&quot;</span></span><br><span class=\"line\">  <span class=\"attr\">name:</span> <span class=\"string\">&quot;go-mall&quot;</span></span><br><span class=\"line\">  <span class=\"attr\">log:</span></span><br><span class=\"line\">    <span class=\"comment\"># æ—¥å¿—æ–‡ä»¶è·¯å¾„ï¼Œä»é¡¹ç›®è·¯å¾„å¼€å§‹å‡ºå‘</span></span><br><span class=\"line\">    <span class=\"attr\">path:</span> <span class=\"string\">&quot;./tmp/go-mall.log&quot;</span></span><br><span class=\"line\">    <span class=\"comment\"># æ–‡ä»¶æœ€å¤§ä½“ç§¯ï¼ˆMï¼‰å’Œæœ‰æ•ˆæœŸï¼ˆDayï¼‰</span></span><br><span class=\"line\">    <span class=\"attr\">max_size:</span> <span class=\"number\">1</span></span><br><span class=\"line\">    <span class=\"attr\">max_age:</span> <span class=\"number\">60</span></span><br></pre></td></tr></table></figure>\n\n<p><strong>ååºåˆ—åŒ–ç»“æ„ä½“ï¼š</strong></p>\n<figure class=\"highlight go\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">type</span> appConfig <span class=\"keyword\">struct</span> &#123;</span><br><span class=\"line\">\t<span class=\"comment\">// ç”¨mapstructureæ ‡ç­¾å°±æœ‰æ•ˆ</span></span><br><span class=\"line\">\tEnv  <span class=\"type\">string</span> <span class=\"string\">`mapstructure:&quot;env&quot;`</span></span><br><span class=\"line\">\tName <span class=\"type\">string</span> <span class=\"string\">`mapstructure:&quot;name&quot;`</span></span><br><span class=\"line\">\tLog  <span class=\"keyword\">struct</span> &#123;</span><br><span class=\"line\">\t\tFilePath    <span class=\"type\">string</span> <span class=\"string\">`mapstructure:&quot;path&quot;`</span></span><br><span class=\"line\">\t\tFileMaxSize <span class=\"type\">int</span>    <span class=\"string\">`mapstructure:&quot;max_size&quot;`</span></span><br><span class=\"line\">\t\tFileMaxAge  <span class=\"type\">int</span>    <span class=\"string\">`mapstructure:&quot;max_age&quot;`</span></span><br><span class=\"line\">\t&#125;</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n\n<h3 id=\"åˆå§‹åŒ–æ—¥å¿—ç»„ä»¶\"><a href=\"#åˆå§‹åŒ–æ—¥å¿—ç»„ä»¶\" class=\"headerlink\" title=\"åˆå§‹åŒ–æ—¥å¿—ç»„ä»¶\"></a>åˆå§‹åŒ–æ—¥å¿—ç»„ä»¶</h3><p><strong>ç›®å½•ç»“æ„ï¼š</strong></p>\n<p><img src=\"https://raw.githubusercontent.com/lyydsheep/pic/main/202411171504369.png\" alt=\"image-20241117150445307\"></p>\n<ul>\n<li><p>env.goä¸­å®šä¹‰äº†ä¸åŒç¯å¢ƒçš„æšä¸¾å€¼</p>\n<ul>\n<li><img src=\"https://raw.githubusercontent.com/lyydsheep/pic/main/202411171838214.png\" alt=\"image-20241117183814150\"></li>\n</ul>\n</li>\n<li><p>zap.goä¸­å¯¹<strong>å…¨å±€æ—¥å¿—å˜é‡</strong>è¿›è¡Œåˆå§‹åŒ–ï¼šè¿™é‡Œä½¿ç”¨Goè‡ªå¸¦çš„initæ–¹æ³•è¿›è¡Œåˆå§‹åŒ–ï¼Œä¹Ÿå¯ä»¥è‡ªå·±å°è£…ä¸€ä¸ªInitå‡½æ•°ï¼Œåœ¨é¡¹ç›®ä¸­æ‰‹åŠ¨è°ƒç”¨å‡½æ•°å®Œæˆåˆå§‹åŒ–æ“ä½œ</p>\n<ul>\n<li>ä½¿ç”¨Goè‡ªå¸¦çš„initæ–¹æ³•çš„å¼Šç«¯åœ¨äºæœ‰çš„ä»£ç é€»è¾‘ä¾èµ–äºå„ä¸ªinitçš„æ‰§è¡Œé¡ºåºï¼Œè€Œè¿™ç§åˆå§‹åŒ–æ–¹æ³•éš¾ä»¥ç¡®ä¿åˆå§‹åŒ–é¡ºåº</li>\n</ul>\n</li>\n</ul>\n<figure class=\"highlight go\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br><span class=\"line\">31</span><br><span class=\"line\">32</span><br><span class=\"line\">33</span><br><span class=\"line\">34</span><br><span class=\"line\">35</span><br><span class=\"line\">36</span><br><span class=\"line\">37</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\">// zapåªä¼šå½“åšåŸºç¡€Loggerï¼Œæ‰€ä»¥åªæŠŠè¯¥å˜é‡å®šä¹‰æˆåŒ…å†…è®¿é—®çš„å…¨å±€å˜é‡</span></span><br><span class=\"line\"><span class=\"keyword\">var</span> Logger *zap.Logger</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"function\"><span class=\"keyword\">func</span> <span class=\"title\">init</span><span class=\"params\">()</span></span> &#123;</span><br><span class=\"line\">\t<span class=\"comment\">// é…ç½®encoderä¿¡æ¯</span></span><br><span class=\"line\">\tcfg := zap.NewProductionEncoderConfig()</span><br><span class=\"line\">\tcfg.EncodeTime = zapcore.ISO8601TimeEncoder</span><br><span class=\"line\">\tcfg.TimeKey = <span class=\"string\">&quot;time&quot;</span></span><br><span class=\"line\">\tcfg.MessageKey = <span class=\"string\">&quot;msg&quot;</span></span><br><span class=\"line\">\tencoder := zapcore.NewJSONEncoder(cfg)</span><br><span class=\"line\">\tfileWriter := getFileLogWriter()</span><br><span class=\"line\">\t<span class=\"keyword\">var</span> cores []zapcore.Core</span><br><span class=\"line\">\t<span class=\"keyword\">switch</span> config.App.Env &#123;</span><br><span class=\"line\">\t<span class=\"keyword\">case</span> enum.ModeTest, enum.ModeProd:</span><br><span class=\"line\">\t\t<span class=\"comment\">// æµ‹è¯•ã€ç”Ÿäº§ç¯å¢ƒä»…å°†infoçº§åˆ«çº§ä»¥ä¸Šæ—¥å¿—å†™å…¥æ–‡ä»¶</span></span><br><span class=\"line\">\t\tcores = <span class=\"built_in\">append</span>(cores, zapcore.NewCore(encoder, fileWriter, zapcore.InfoLevel))</span><br><span class=\"line\">\t<span class=\"keyword\">case</span> enum.ModeDev:</span><br><span class=\"line\">\t\t<span class=\"comment\">// æœ¬åœ°ç¯å¢ƒå°†æ‰€æœ‰çš„æ—¥å¿—å†™å…¥æ–‡ä»¶å’Œæ§åˆ¶å°</span></span><br><span class=\"line\">\t\tcores = <span class=\"built_in\">append</span>(cores, zapcore.NewCore(encoder, fileWriter, zapcore.DebugLevel),</span><br><span class=\"line\">\t\t\tzapcore.NewCore(encoder, zapcore.WriteSyncer(os.Stdout), zapcore.DebugLevel))</span><br><span class=\"line\">\t<span class=\"keyword\">default</span>:</span><br><span class=\"line\">\t\t<span class=\"built_in\">panic</span>(<span class=\"string\">&quot;config.App.Env is invalid&quot;</span>)</span><br><span class=\"line\">\t&#125;</span><br><span class=\"line\">\t<span class=\"comment\">// ç±»å‹å®šä¹‰å®ç°æ¥å£</span></span><br><span class=\"line\">\tcore := zapcore.NewTee(cores...)</span><br><span class=\"line\">\tLogger = zap.New(core)</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"function\"><span class=\"keyword\">func</span> <span class=\"title\">getFileLogWriter</span><span class=\"params\">()</span></span> zapcore.WriteSyncer &#123;</span><br><span class=\"line\">\t<span class=\"keyword\">return</span> zapcore.AddSync(&amp;lumberjack.Logger&#123;</span><br><span class=\"line\">\t\tFilename:  config.App.Log.FilePath,</span><br><span class=\"line\">\t\tMaxAge:    config.App.Log.FileMaxAge,</span><br><span class=\"line\">\t\tMaxSize:   config.App.Log.FileMaxSize,</span><br><span class=\"line\">\t\tCompress:  <span class=\"literal\">false</span>,</span><br><span class=\"line\">\t\tLocalTime: <span class=\"literal\">true</span>,</span><br><span class=\"line\">\t&#125;)</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n\n"},{"title":"Golangä¹‹æ¥å…¥æ—¥å¿—æ¨¡å—","publish":true,"description":"è®°å½•Goé¡¹ç›®ä¸­æ¥å…¥æ—¥å¿—æ¨¡å—","date":"2024-08-20T10:29:00.000Z","_content":"\n# æ¥å…¥æ—¥å¿—æ¨¡å—\n\n## æ—¥å¿—é€šç”¨ç†è®º\n\n### çº§åˆ«\n\n**DEBUG**ï¼šè®°å½•ä¸€äº›è¾…åŠ©æ’æŸ¥é—®é¢˜çš„ä¿¡æ¯ã€‚ä¸€èˆ¬ä¸ä¼šåœ¨çº¿ä¸Šä½¿ç”¨\n\n**INFO**ï¼šä¸­æ€§åœ°æè¿°å‘é€äº†ä»€ä¹ˆã€‚çº¿ä¸Šä¸€èˆ¬éƒ½æ˜¯ç”¨è¿™ä¸ªçº§åˆ«\n\n**WARN**ï¼šç³»ç»Ÿå‘ç”Ÿäº†ä¸€äº›ä¸å¥½ä½†æ˜¯èƒ½å¤Ÿå®¹å¿çš„äº‹æƒ…ã€‚è‡³å°‘ä¼šæ‰“å°è¿™ä¸ªçº§åˆ«çš„æ—¥å¿—\n\n**ERROR**ï¼šç³»ç»Ÿå‘ç”Ÿäº†ä¸€äº›éœ€è¦ä¿æŒå…³æ³¨çš„äº‹æƒ…\n\n### ä»€ä¹ˆæ—¶å€™æ‰“æ—¥å¿—ï¼Ÿæ‰“ä»€ä¹ˆçº§åˆ«ï¼Ÿ\n\nä¸¤ä¸ªåŸåˆ™\n\n- **å¦‚æœæ€€ç–‘æŸä¸ªåœ°æ–¹è¦ä¸è¦æ‰“æ—¥å¿—ï¼Œé‚£å°±æ‰“ä¸Š**\n- **å®æ»¥å‹¿ç¼ºï¼Œå®æ„¿å¤šæ‰“ä¸€äº›æ—¥å¿—ï¼Œä¹Ÿä¸è¦å·æ‡’**\n\n\n\nå‰äººçš„ç»éªŒ\n\n- **ç»Ÿä¸€åˆ©ç”¨AOPæœºåˆ¶ï¼Œè®°å½•ä»»ä½•ä¸ç¬¬ä¸‰æ–¹æ‰“äº¤é“çš„è¯·æ±‚ä¸å“åº”**ï¼ŒåŒ…æ‹¬æ•°æ®åº“ã€ç¼“å­˜ã€RPCè°ƒç”¨ï¼Œä½¿ç”¨**DEBUG**çº§åˆ«è®°å½•æ—¥å¿—\n- **ç»Ÿä¸€åˆ©ç”¨AOPæœºåˆ¶ï¼Œè®°å½•ç³»ç»Ÿæ¥æ”¶çš„è¯·æ±‚ä¸æ”¾å›çš„å“åº”**ï¼Œä½¿ç”¨**DEBUG**çº§åˆ«\n- åœ¨å¼€å‘é˜¶æ®µï¼Œä½¿ç”¨**DEBUG**çº§åˆ«è®°å½•ä¸­é—´**æµç¨‹ä¸­çš„å…³é”®ç»“æœ**\n- æ€€ç–‘ç³»ç»Ÿå¯èƒ½æœ‰é—®é¢˜ï¼Œä½†æ˜¯é—®é¢˜åˆä¸å¤§ï¼Œè®°å½•WARN\n- ä»»ä½•ä¸å¯èƒ½å‡ºç°é—®é¢˜ï¼Œæˆ–è€…è¡¨è¾¾**æœ‰äººæ”»å‡»ç³»ç»Ÿ**çš„åœ°æ–¹ï¼Œè®°å½•**ERROR**\n\n## æ¥å…¥æ—¥å¿—æ¨¡å—\n\nåœ¨Goé‡Œé¢ï¼Œå¯ä»¥ä½¿ç”¨zapä½œä¸ºæ—¥å¿—æ¡†æ¶\n\n[uber-go/zap: Blazing fast, structured, leveled logging in Go. (github.com)](https://github.com/uber-go/zap)\n\n**åˆå§‹åŒ–æ–¹æ³•ï¼š**\n\n- ç›´æ¥è®¾ç½®ä¸€ä¸ªå…¨å±€çš„loggerå³å¯\n\n```go\n\tlogger, err := zap.NewDevelopment()\n\tif err != nil {\n\t\tpanic(err)\n\t}\n\tzap.ReplaceGlobals(logger)\n```\n\nzapä¸­å«æœ‰ä¸€ä¸ªå…¨å±€çš„`globalL`å˜é‡ï¼Œä½†æ˜¯è¿™ä¸ªå…¨å±€å˜é‡ä»€ä¹ˆåŠŸèƒ½éƒ½æœ¨æœ‰å®ç°ï¼Œä¹Ÿå°±æ˜¯è¯´ï¼Œå®ƒè¿æ‰“å°æ—¥å¿—çš„åŠŸèƒ½éƒ½æ²¡æœ‰\n\n![å±å¹•æˆªå›¾ 2024-09-02 193645](https://raw.githubusercontent.com/lyydsheep/pic/main/202409021939910.png)\n\nå› æ­¤éœ€è¦ä½¿ç”¨`NewDevelopment()`æ–¹æ³•åˆ›å»ºä¸€ä¸ªå¯ä»¥ä½¿ç”¨çš„`logger`å¹¶æ›¿æ¢æ‰å…¨å±€å˜é‡çš„åˆå§‹å€¼\n\n![å±å¹•æˆªå›¾ 2024-09-02 193655](https://raw.githubusercontent.com/lyydsheep/pic/main/202409021939433.png)\n\n### æ‰“å°æ—¥å¿—çš„åŸºæœ¬æ“ä½œâ€”â€”Error\n\nå½“å‡ºç°åƒæ˜¯ç³»ç»Ÿé”™è¯¯æ—¶ï¼Œå°±èƒ½æ‰“å°Errorçº§åˆ«çš„æ—¥å¿—\n\n```go\n\tif err != nil {\n\t\tctx.JSON(http.StatusOK, Result{Code: 5, Msg: \"ç³»ç»Ÿé”™è¯¯\"})\n\t\tzap.L().Error(\"vcxnq[nzvx ç”¨æˆ·æ‰‹æœºå·ç ç™»å½•å¤±è´¥\", zap.Error(err))\n\t\treturn\n\t}\n```\n\næ‰“å°æ—¥å¿—ä¸ä»…èƒ½ä¼ å…¥msgä¿¡æ¯ï¼Œè¿˜èƒ½å¤Ÿä¼ å…¥ä¸€äº›`error`ã€`int`ä¹‹ç±»çš„å­—æ®µï¼Œæœ€ç»ˆæ‰“å°ç»“æœå½¢å¦‚ä¸‹å›¾ï¼š\n\n![å±å¹•æˆªå›¾ 2024-09-02 194610](https://raw.githubusercontent.com/lyydsheep/pic/main/202409021953667.png)\n\næ³¨æ„å‡ ä¸ªç»†èŠ‚ï¼š\n\n- æ•æ„Ÿæ•°æ®ï¼ˆä¾‹å¦‚æ‰‹æœºå·ç ï¼‰ä¸èƒ½æ‰“å…¥æ—¥å¿—ï¼Œå‹‰å¼ºèƒ½å¤Ÿæ¥å—ä½¿ç”¨debugçº§åˆ«æ‰“å°æ•æ„Ÿæ•°æ®ç”¨äºæœ¬åœ°å¼€å‘\n- msgè¦æœ‰è¶³å¤Ÿå®šä½bugå‡ºå¤„çš„ä¿¡æ¯ï¼Œä¾‹å¦‚åœ¨æ—¥å¿—ä¸­ç”¨ä¸€æ®µä¹±ç å”¯ä¸€æ ‡è¯†æ—¥å¿—ï¼Œè¿™æ ·åªéœ€è¦å…¨å±€æ£€ç´¢è¿™æ®µä¹±ç å°±èƒ½æ‰¾åˆ°å‡ºé”™çš„ä½ç½®\n- ç»å¯¹ä¸èƒ½æŠŠerrorè¿”å›ç»™å‰ç«¯ï¼Œæš´éœ²ç»™ç”¨æˆ·\n\n### æ‰“å°æ—¥å¿—çš„åŸºæœ¬æ“ä½œâ€”â€”Warn\n\n![image-20240902200117065](https://raw.githubusercontent.com/lyydsheep/pic/main/202409022001108.png)\n\nåœ¨æ­¤å¤„æ‰“å°äº†ä¸€ä¸ªWarnæ—¥å¿—ï¼Œå› ä¸ºçŸ­ä¿¡å‘é€é¢‘ç¹æ˜¯**å¶å°”**ä¼šå‘ç”Ÿçš„ï¼Œ**èƒ½å¤Ÿæ¥å—**ã€‚ä½†è¦æ˜¯**é¢‘ç¹å‡ºç°Warn**ï¼Œå°±å¾ˆæœ‰å¯èƒ½æ˜¯æœ‰äººåœ¨æ”»å‡»ç³»ç»Ÿï¼Œé‚£å°±è¦**å‘Šè­¦å¼•èµ·æ³¨æ„äº†**\n\n###   æ‰“å°æ—¥å¿—çš„åŸºæœ¬æ“ä½œâ€”â€”Info\n\nInfoæ—¥å¿—ç”¨äºè®°å½•ä¸€äº›**ä¸­æ€§ä¿¡æ¯**ï¼Œä¾‹å¦‚\n\n![image-20240902203836373](https://raw.githubusercontent.com/lyydsheep/pic/main/202409022038436.png)\n\n### æ‰“å°æ—¥å¿—çš„åŸºæœ¬æ“ä½œâ€”â€”Debug\n\nDebugæ—¥å¿—å¯ä»¥ç”¨äºè®°å½•å’Œç¬¬ä¸‰æ–¹äº¤äº’çš„åŠ¨ä½œ\n\n```go\nfunc (s *Service) Send(ctx context.Context, tpl string, args []sms.NameData, numbers ...string) error {\n\tzap.L().Debug(\"avnasio å³å°†å‘é€çŸ­ä¿¡\", zap.String(\"tpl\", tpl), zap.Any(\"args\", args))\n\terr := s.svc.Send(ctx, tpl, args, numbers...)\n\tif err != nil {\n\t\tzap.L().Debug(\"å‘é€çŸ­ä¿¡å‡ºç°å¼‚å¸¸\", zap.Error(err))\n\t\treturn err\n\t}\n\treturn err\n}\n```\n\nå¯ä»¥è€ƒè™‘ä½¿ç”¨è£…é¥°å™¨æ¨¡å¼æ‰©å±•`Write()`æ–¹æ³•çš„åŠŸèƒ½\n\nä¾‹å¦‚ï¼Œè‡ªåŠ¨å°†keyä¸ºphoneçš„å­—æ®µè¿›è¡Œæ•°æ®è„±æ•\n\n```go\ntype MyCore struct {\n\tzapcore.Core\n}\n\nfunc (c *MyCore) Write(e zapcore.Entry, fs []zapcore.Field) error {\n\t// è£…é¥°å™¨æ¨¡å¼ï¼Œè¿›è¡Œæ•°æ®è„±æ•\n\tfor _, f := range fs {\n\t\tif f.Key == \"phone\" {\n\t\t\tnumber := f.String\n\t\t\tf.String = number[:3] + \"****\" + number[7:]\n\t\t}\n\t}\n\treturn c.Core.Write(e, fs)\n}\n```\n\n\n\nè£…é¥°å™¨æ¨¡å¼å®ç°ä¸€ä¸ªcoreï¼Œèƒ½å¤Ÿè‡ªåŠ¨å°†keyä¸ºphoneçš„å­—æ®µå¯¹åº”çš„å€¼è¿›è¡Œè„±æ•\n\n### ä¸ä½¿ç”¨åŒ…å˜é‡â€”â€”ä¿æŒä¾èµ–æ³¨å…¥é£æ ¼\n\næœ‰çš„æ—¶å€™ä¸åŒçš„ä¸šåŠ¡ä¸æ„¿æ„å…±äº«åŒä¸€ä¸ªå…¨å±€çš„loggerï¼Œè¿™ä¸ªæ—¶å€™å°±éœ€è¦åœ¨ä¸åŒåœ°æ–¹åˆ›å»ºå±äºä»–ä»¬è‡ªå·±çš„logger\n\nä¸€ä¸ªå¾ˆç›´æ¥çš„æ–¹æ³•å°±æ˜¯åœ¨serviceå±‚æ·»åŠ loggerå­—æ®µï¼Œä¸ºä¸åŒä¸šåŠ¡å¼•å…¥å„è‡ªçš„loggerï¼Œå¹¶ä¸”ä¿æŒç€ä¾èµ–æ³¨å…¥çš„é£æ ¼\n\n![å±å¹•æˆªå›¾ 2024-09-03 214039](https://raw.githubusercontent.com/lyydsheep/pic/main/202409032144169.png)\n\n![](https://raw.githubusercontent.com/lyydsheep/pic/main/202409032144084.png)\n\nè¿˜æœ‰ä¸€ç§æ›´ç®€å•çš„ä¾èµ–æ³¨å…¥æ–¹æ³•ï¼š**æ³¨å…¥äº†ï¼Œä½†æ˜¯æ²¡æœ‰å®Œå…¨æ³¨å…¥**\n\nè¿™ç§åšæ³•çš„å¥½å¤„å°±æ˜¯ï¼Œä¸ºå°†æ¥æ‰©å±•ç•™ä¸‹äº†å¯æ“ä½œçš„ç©ºé—´\n\n```go\nfunc NewUserService(repo repository.UserRepository) UserService {\n\treturn &BasicUserService{\n\t\trepo:   repo,\n        // é¢„ç•™äº†å˜åŠ¨çš„ç©ºé—´\n        logger: zap.L(),\n\t}\n}\n```\n\n### æŠ½è±¡æ—¥å¿—API\n\nåšåˆ°è¿™é‡Œä¸éš¾å‘ç°ï¼Œä¸ç®¡æ˜¯é…ç½®æ¨¡å—ä¹Ÿå¥½ï¼Œæ—¥å¿—æ¨¡å—ä¹Ÿå¥½ï¼Œæˆ‘ä»¬çš„ä»£ç éƒ½å¼ºè€¦åˆviperæ¡†æ¶å’Œzapæ¡†æ¶ã€‚è¿™å°±ä¼šæœ‰æ½œåœ¨çš„é£é™©ï¼šä¸‡ä¸€è¿viperå’Œzapæ¡†æ¶éƒ½æƒ³æ¢æ‰å‘¢ï¼Ÿ\n\nå› æ­¤ï¼Œæˆ‘ä»¬éœ€è¦å®šä¹‰è‡ªå·±loggeræ¥å£ï¼Œå¼±åŒ–å¯¹zapæ¡†æ¶çš„ä¾èµ–\n\nå…·ä½“æœ‰ä¸‰ç§é£æ ¼\n\n- ```go\n  type Logger interface {\n  \tDebug(msg string, args...any)\n  \tInfo(msg string, args...any)\n  \tWarn(msg string, args...any)\n  \tError(msg string, args...any)\n  }\n  \n  func Example() {\n  \tvar l Logger\n  \t// åœ¨msgä¸­ç•™æœ‰å ä½ç¬¦\n  \tl.Info(\"ç”¨æˆ·æœªæ³¨å†Œï¼Œç”¨æˆ·ä¿¡æ¯ä¸º %v\", \"ababab\")\n  }\n  ```\n\n- ```go\n  type LoggerV1 interface {\n  \tDebug(msg string, args ...Field)\n  \tInfo(msg string, args ...Field)\n  \tWarn(msg string, args ...Field)\n  \tError(msg string, args ...Field)\n  }\n  \n  type Field struct {\n  \tKey string\n  \tVal any\n  }\n  \n  func ExampleV1() {\n  \tvar l LoggerV1\n  \t// è¾“å‡ºçš„valæœ‰å¯¹åº”çš„keyï¼Œå’Œzapé‡‡ç”¨ç›¸åŒçš„æ¨¡å¼\n  \tl.Info(\"è¿™ä¸ªmsg\", Field{Key: \"è¿™ä¸ªæ˜¯key\", Val: \"è¿™ä¸ªæ˜¯Val\"})\n  }\n  \n  ```\n\n- ```go\n  // LoggerV2 è¦æ±‚argsçš„ä¸ªæ•°æ˜¯å¶æ•°ï¼Œä»¥key-valå½¢å¼äº¤æ›¿å‡ºç°\n  type LoggerV2 interface {\n  \tDebug(msg string, args ...any)\n  \tInfo(msg string, args ...any)\n  \tWarn(msg string, args ...any)\n  \tError(msg string, args ...any)\n  }\n  \n  func ExampleV2() {\n  \tvar l LoggerV2\n  \tl.Info(\"è¿™æ˜¯msg\", \"key\", \"val\")\n  }\n  ```\n\n- ç¬¬ä¸€ç§é£æ ¼**å…¼å®¹æ€§æœ€å¥½**\n- ç¬¬äºŒç§é£æ ¼è®¤åŒ**å‚æ•°å°±åº”è¯¥æœ‰ä¸ªåå­—**\n- ç¬¬ä¸‰ç§é£æ ¼**å¦‚æœæœ‰å®Œå–„çš„ä»£ç è¯„å®¡æµç¨‹çš„è¯å¯ä»¥è€ƒè™‘è€ƒè™‘**ï¼Œä¸ç„¶ä¸æ¨è\n\n### é€‚é…å™¨æ¨¡å¼\n\næ—¢ç„¶å·²ç»æŠ½è±¡å‡ºäº†æ—¥å¿—æ¥å£ï¼Œé‚£ä¹ˆå…·ä½“è¯¥å¦‚ä½•å®ç°å‘¢ï¼Ÿ\n\nç­”æ¡ˆå°±æ˜¯é‡‡ç”¨**é€‚é…å™¨æ¨¡å¼**\n\næ‰€è°“é€‚é…å™¨æ¨¡å¼ï¼Œå°±æ˜¯**å°†ä¸€ä¸ªç±»å‹é€‚é…åˆ°å¦ä¸€ä¸ªæ¥å£ä¸Š**ã€‚ä¾‹å¦‚ï¼Œå°†Aé€‚é…åˆ°Bï¼Œè¿™é‡Œçš„Aå¯ä»¥æ˜¯æ¥å£ï¼Œä¹Ÿå¯ä»¥æ˜¯ä¸€ä¸ªå…·ä½“çš„ç±»å‹\n\n**å…¸å‹çš„ä½¿ç”¨åœºæ™¯**\n\n- æœ‰ä¸¤ä¸ªç”¨é€”ç±»ä¼¼ï¼Œä½†æ˜¯ç»†èŠ‚ä¸Šç•¥æœ‰ä¸åŒçš„æ¥å£ï¼Œå°†ä¸€ä¸ªæ¥å£é€‚é…åˆ°å¦ä¸€ä¸ªæ¥å£ä¸Š\n- ç”±äºç‰ˆæœ¬è¿­ä»£ï¼Œå‡ºç°äº†ä¸¤ä¸ªæ¥å£ï¼Œéœ€è¦å°†ä¸€ä¸ªæ¥å£é€‚é…åˆ°å¦ä¸€ä¸ªæ¥å£ä¸Š\n\n**ä¸è£…é¥°å™¨æ¨¡å¼çš„åŒºåˆ«**\n\n- è£…é¥°å™¨æ¨¡å¼ç”¨äº**æ‰©å±•åŠŸèƒ½**ï¼Œè‡ªå§‹è‡³ç»ˆ**éƒ½æ˜¯ä¸€ä¸ªæ¥å£**\n- é€‚é…å™¨æ¨¡å¼**å¿…ç„¶æ˜¯ä¸¤ä¸ªä¸åŒçš„æ¥å£**\n\n### åˆ©ç”¨Ginçš„middlewareæ‰“å°æ—¥å¿—\n\nåœ¨handleræ–‡ä»¶ä¸­ï¼Œæœ‰å¾ˆå¤šä¸ªæ–¹æ³•ï¼Œå¦‚æœä¸€ä¸€ä¸ºè¿™äº›æ–¹æ³•æ‰“å°æ—¥å¿—éœ€è¦èŠ±è´¹å¾ˆå¤šæ—¶é—´å’Œç²¾åŠ›\n\nå¯æ˜¯å‘ç°ï¼Œhandlerä¸­çš„æ–¹æ³•éƒ½æ˜¯ä¸è¯·æ±‚å’Œå“åº”æœ‰å…³çš„ï¼Œé‚£ä¹ˆå°±å¯ä»¥é‡‡ç”¨`AOP`æœºåˆ¶ï¼Œåˆ©ç”¨ginçš„middlewareæ¥ç»Ÿä¸€æ‰“æ—¥å¿—\n\n#### ä½¿ç”¨builderæ¨¡å¼æ„å»ºä¸­é—´ä»¶\n\n```go\n// å‡ ä¸ªæ³¨æ„ç‚¹ï¼š\n// å°å¿ƒæ—¥å¿—å†…å®¹è¿‡å¤šï¼šURLå¯èƒ½å¾ˆé•¿ï¼Œè¯·æ±‚ä½“ã€å“åº”ä½“éƒ½å¯èƒ½ç‰¹åˆ«ç‰¹åˆ«å¤§ï¼Œéœ€è¦è€ƒè™‘æ˜¯å¦è¦è¿›è¡Œæˆªå–\n// ç”¨æˆ·å¯èƒ½æ¢ç”¨ä¸åŒçš„æ—¥å¿—æ¡†æ¶ï¼Œæ‰€ä»¥è¦æœ‰è¶³å¤Ÿçš„çµæ´»æ€§\n// è€ƒè™‘ç»“åˆviperå®ç°åŠ¨æ€å¼€å…³ï¼Œä½†æ˜¯è¦å°å¿ƒå¹¶å‘å®‰å…¨\nfunc (b *Builder) Build() gin.HandlerFunc {\n\treturn func(ctx *gin.Context) {\n\t\tstart := time.Now()\n\t\tal := AccessLog{}\n\t\tal.Method = ctx.Request.Method\n\t\tif b.allowURL && ctx.Request.URL != nil {\n\t\t\turl := ctx.Request.URL.String()\n\t\t\tif len(url) > 1024 {\n\t\t\t\turl = url[:1024]\n\t\t\t}\n\t\t\tal.URL = url\n\t\t}\n\t\tif b.allowReqBody && ctx.Request.Body != nil {\n\t\t\t// è¿™é‡Œå¿½ç•¥é”™è¯¯ï¼Œæ¯•ç«Ÿæˆ‘åªæ˜¯æ‰“å°ä¸ªæ—¥å¿—ï¼Œæœ‰é”™è¯¯ä¹Ÿæ— æ‰€è°“äº†\n\t\t\tdata, _ := ctx.GetRawData()\n\t\t\t// Request.Bodyæ˜¯ä¸€ä¸ªæµå¯¹è±¡ï¼Œè¯»å®Œä¹‹åRequesté‡Œé¢å°±æœ¨æœ‰äº†\n\t\t\t// æ‰€ä»¥è¿˜å¾—æŠŠæ•°æ®æ”¾å›Request.Bodyï¼Œä¸ç„¶åç»­æ­¥éª¤å°±è¯»ä¸åˆ°è¿™ä¸ªæ•°æ®äº†\n\t\t\tctx.Request.Body = io.NopCloser(bytes.NewBuffer(data))\n\t\t\tbody := string(data)\n\t\t\tif len(body) > 1024 {\n\t\t\t\tal.ReqBody = body\n\t\t\t}\n\t\t}\n\t\t// defer æ‰“æ—¥å¿—ï¼Œå³ä½¿æœ‰panicä¹Ÿä¸ä¼šå½±å“æ—¥å¿—çš„è¾“å‡º\n\t\tdefer func() {\n\t\t\tal.Duration = time.Since(start).String()\n\t\t\t// å…·ä½“æ€ä¹ˆæ‰“å°æ—¥å¿—ï¼Œç”±ç”¨æˆ·å†³å®š\n\t\t\tb.logFunc(ctx, al)\n\t\t}()\n\t\t// æ‰§è¡Œåˆ°ä¸šåŠ¡ä»£ç ï¼ˆä¸æ˜¯å¾ˆæ‡‚ï¼‰\n\t\tctx.Next()\n\t}\n}\n\ntype AccessLog struct {\n\t// è¯·æ±‚æ–¹æ³•\n\tMethod string\n\t// url\n\tURL string\n\t// è¯·æ±‚ä½“\n\tReqBody string\n\t// å¤„ç†æ—¶é—´\n\tDuration string\n\t// å“åº”ä½“\n\tRespBody string\n}\n```\n\n**ä¸€ä¸ªæœ‰æ„æ€çš„ç‚¹ï¼šä¸ºä»€ä¹ˆè¦è®©ç”¨æˆ·ä¼ è¿›æ¥ä¸€ä¸ªæ‰“æ—¥å¿—çš„æ–¹æ³•å‘¢ï¼Ÿ**\n\nå¦‚æœä¸ä¼ é€’æ–¹æ³•ï¼Œé‚£ä¹ˆåœ¨å®ç°ä¸­ä¸ç®¡æˆ‘ä»¬æ˜¯ç”¨`Info()`ã€`Debug()`è¿˜æ˜¯`Error()`éƒ½æ˜¯å†™æ­»åœ¨ä»£ç ä¸­çš„ï¼Œä¸èƒ½çµæ´»åœ°åº”å¯¹ä¸åŒçš„åœºæ™¯ï¼Œä¾‹å¦‚å¼€å‘ç¯å¢ƒè¦ç”¨`Debug()`ï¼Œå¯èƒ½çº¿ä¸Šç¯å¢ƒæˆ‘å°±è¦ç”¨`Info()`äº†\n\né‚£ä¹ˆä¸å¦‚å°±è®©ç”¨æˆ·ä¼ è¿›æ¥ä¸€ä¸ªæ–¹æ³•ï¼Œåªä¸ºç”¨æˆ·æä¾›ä¸€ä¸ªæ¥å£ï¼Œå±è”½åº•å±‚çš„å®ç°ï¼Œç”¨æˆ·åªéœ€è¦è€ƒè™‘åœ¨ä¸åŒç¯å¢ƒé€‰æ‹©ä½¿ç”¨ä¸åŒçš„æ–¹æ³•å°±è¡Œäº†\n\n#### æ‰“å°å“åº”\n\næ­£å¸¸æ¥è¯´ï¼Œæ‰“å°å“åº”å°±åº”è¯¥å’Œä¸Šæ–‡ä¸­æ‰“å°è¯·æ±‚ä¸€æ ·ç®€å•ï¼šç›´æ¥ä»`context`é‡Œé¢æ‹¿è¯·æ±‚å°±è¡Œ\n\nä¸å¹¸çš„æ˜¯ï¼Œ`ctx`å¹¶æ²¡æœ‰æš´éœ²å‡º`Response`ï¼Œä¹Ÿå°±æ˜¯ä¸èƒ½ç›´æ¥è¯»å“åº”\n\nä½†æ˜¯ï¼Œ`ctx`æš´éœ²å‡ºäº†`ResponseWriter`ï¼Œè¿™ä¸ªæ¥å£æ˜¯ç”¨æ¥å†™å“åº”çš„ã€‚é‚£ä¹ˆæˆ‘ä»¬å¯ä»¥â€œ**å·æ¢æ¢æŸ±**â€ï¼Œå°†è¿™ä¸ªæ¥å£æ¢æˆæˆ‘ä»¬è‡ªå·±çš„å®ç°ï¼š**åœ¨å†™å“åº”ä¹‹å‰å°†æ•°æ®ä¿ç•™ä¸‹æ¥ï¼Œè¿™æ ·å°±æœ‰äº†å“åº”çš„å…·ä½“æ•°æ®**\n\nåœ¨è¿™é‡Œæˆ‘ä»¬åªéœ€è¦é‡å†™`WriteHeader`ã€`Write`ã€`WriteString`è¿™ä¸‰ä¸ªæ–¹æ³•ï¼Œæ‰€ä»¥è£…é¥°å™¨æ¨¡å¼åœ¨å®ç°çš„æ—¶å€™å¯ä»¥é‡‡ç”¨ç»„åˆçš„æ–¹å¼\n\n- ç»„åˆ ---> è£…é¥°éƒ¨åˆ†æ–¹æ³•\n- éç»„åˆ ---> è£…é¥°å…¨éƒ¨æ–¹æ³•\n\n```go\nif b.allowRespBody {\n\t// å·æ¢æ¢æŸ±\n\tctx.Writer = &responseWriter{\n\t\tal: &al,\n\t\tResponseWriter: ctx.Writer,\n\t}\n}\n\ntype responseWriter struct {\n\t// è¿™é‡Œç”¨æŒ‡é’ˆï¼Œä¸ºäº†èƒ½ç•™ä½â€œå·â€è¿‡æ¥çš„æ•°æ®\n\tal *AccessLog\n\tgin.ResponseWriter\n}\n\nfunc (r *responseWriter) WriteString(data string) (int, error) {\n\tr.al.RespBody = data\n\treturn r.ResponseWriter.WriteString(data)\n}\n\nfunc (r *responseWriter) Write(data []byte) (int, error) {\n\tr.al.RespBody = string(data)\n\treturn r.ResponseWriter.Write(data)\n}\n\nfunc (r *responseWriter) WriteHeader(statusCode int) {\n\tr.al.Status = statusCode\n\tr.ResponseWriter.WriteHeader(statusCode)\n}\n```\n\n### GORMæ‰“å°æ—¥å¿—\n\nç›´æ¥ä¸Šä»£ç ï¼š\n\n```go\n// è¡ç”Ÿç±»å‹ï¼Œæœ‰ç‚¹åƒé€‚é…å™¨æ¨¡å¼\ntype gormLoggerFunc func(msg string, fields ...zap.Field)\n\n// Printf å®ç°å•æ¥å£\nfunc (g gormLoggerFunc) Printf(msg string, fields ...interface{}) {\n\tg(msg, zap.Any(\"args\", fields))\n}\n\n\n\nfunc InitDB(l *zap.Logger) *gorm.DB {\n\ttype Config struct {\n\t\tDSN string `yaml:\"dsn\"`\n\t}\n\tvar config Config\n\tconfig.DSN = \"abab\"\n\terr := viper.UnmarshalKey(\"db\", &config)\n\tif err != nil {\n\t\tpanic(err)\n\t}\n\tdb, err := gorm.Open(mysql.Open(config.DSN), &gorm.Config{\n\t\t// å¼ºåˆ¶ç±»å‹è½¬æ¢\n\t\tLogger: logger.New(gormLoggerFunc(l.Debug), logger.Config{\n\t\t\t// æ…¢æŸ¥è¯¢é˜ˆå€¼ï¼Œåªæœ‰è¯­å¥æ‰§è¡Œæ—¶é—´è¶…è¿‡è¿™ä¸ªé˜ˆå€¼æ‰ä¼šæ‰“å°æ—¥å¿—\n            // ä¸€èˆ¬ä¸º50ms 100msï¼Œä¸€æ¬¡ç£ç›˜ioæ“ä½œå¤§æ¦‚æ˜¯10ms\n\t\t\tSlowThreshold:             time.Millisecond * 10,\n\t\t\tLogLevel:                  logger.Info,\n\t\t\tIgnoreRecordNotFoundError: true,\n\t\t\tParameterizedQueries:      true,\n\t\t}),\n\t})\n\tif err != nil {\n\t\tpanic(err)\n\t}\n\terr = dao.InitTable(db)\n\tif err != nil {\n\t\tpanic(err)\n\t}\n\treturn db\n}\n\n```\n\ngormå·²ç»ä¸ºæˆ‘ä»¬æä¾›äº†æœ‰å…³æ—¥å¿—çš„é…ç½®ï¼Œæ‰€ä»¥æˆ‘ä»¬å¯ä»¥ç›´æ¥ä½¿ç”¨é…ç½®å®ç°æ‰“æ—¥å¿—åŠŸèƒ½\n\nè¿™é‡Œæœ‰ä¸ªå°é—®é¢˜ï¼Œ`logger.New()`æ–¹æ³•çš„ç¬¬ä¸€ä¸ªå‚æ•°è¦æ±‚ä¼ å…¥`Writer`æ¥å£çš„å®ç°ï¼Œè¿™ä¸ªå®ç°å°†ä¼šç”¨æ¥è¾“å‡ºæ—¥å¿—\n\n![image-20240907163634983](https://raw.githubusercontent.com/lyydsheep/pic/main/202409071637525.png)\n\né‚£ä¹ˆç°åœ¨å°±æ˜¯éœ€è¦å°†æˆ‘ä»¬è‡ªå·±å®ç°çš„æ—¥å¿—æ¥å£é€‚é…åˆ°gormçš„`Writer`æ¥å£ä¸Š\n\nå¥½å·§ä¸å·§ï¼Œ`Writer`æ¥å£åªæœ‰ä¸€ä¸ªæ–¹æ³•ï¼Œé‚£ä¹ˆå°±å¯ä»¥ç”¨ä¸Š**è¡ç”Ÿå‡½æ•°+å‡½æ•°å®ç°å•æ¥å£**æŠ€å·§ï¼Œå¿«é€Ÿå°†æˆ‘ä»¬çš„æ—¥å¿—æ¥å£é€‚é…åˆ°æ­¤å¤„\n\nè¿™å°±æ˜¯ä¸ºä»€ä¹ˆæˆ‘ä»¬çš„è¡ç”Ÿå‡½æ•°çš„åŸç±»å‹æ˜¯`func(msg string, fields...zap.Field)`ï¼Œè¿™æ­£æ˜¯`l.Debug()`æ–¹æ³•çš„å‡½æ•°ç±»å‹å•Š\n\næœ€åä¼ å…¥`Writer`æ¥å£çš„æ—¶å€™ï¼Œåˆ©ç”¨è¡ç”Ÿç±»å‹å°†`l.Debug()`å¼ºåˆ¶ç±»å‹è½¬æ¢ï¼Œä½¿å…¶é—´æ¥åœ°å®ç°äº†`Writer`æ¥å£çš„åŒæ—¶ï¼ŒæœªåŠ¨æˆ‘ä»¬è‡ªå·±çš„æ¥å£åˆ†æ¯«\n\n\n\n\n\n","source":"_posts/Go/æ¥å…¥æ—¥å¿—æ¨¡å—.md","raw":"---\ntitle: Golangä¹‹æ¥å…¥æ—¥å¿—æ¨¡å—\npublish: true\ndescription: è®°å½•Goé¡¹ç›®ä¸­æ¥å…¥æ—¥å¿—æ¨¡å—\ndate: 2024-08-20 18:29:00\ntag: \n- Go\n- å­¦ä¹ \n---\n\n# æ¥å…¥æ—¥å¿—æ¨¡å—\n\n## æ—¥å¿—é€šç”¨ç†è®º\n\n### çº§åˆ«\n\n**DEBUG**ï¼šè®°å½•ä¸€äº›è¾…åŠ©æ’æŸ¥é—®é¢˜çš„ä¿¡æ¯ã€‚ä¸€èˆ¬ä¸ä¼šåœ¨çº¿ä¸Šä½¿ç”¨\n\n**INFO**ï¼šä¸­æ€§åœ°æè¿°å‘é€äº†ä»€ä¹ˆã€‚çº¿ä¸Šä¸€èˆ¬éƒ½æ˜¯ç”¨è¿™ä¸ªçº§åˆ«\n\n**WARN**ï¼šç³»ç»Ÿå‘ç”Ÿäº†ä¸€äº›ä¸å¥½ä½†æ˜¯èƒ½å¤Ÿå®¹å¿çš„äº‹æƒ…ã€‚è‡³å°‘ä¼šæ‰“å°è¿™ä¸ªçº§åˆ«çš„æ—¥å¿—\n\n**ERROR**ï¼šç³»ç»Ÿå‘ç”Ÿäº†ä¸€äº›éœ€è¦ä¿æŒå…³æ³¨çš„äº‹æƒ…\n\n### ä»€ä¹ˆæ—¶å€™æ‰“æ—¥å¿—ï¼Ÿæ‰“ä»€ä¹ˆçº§åˆ«ï¼Ÿ\n\nä¸¤ä¸ªåŸåˆ™\n\n- **å¦‚æœæ€€ç–‘æŸä¸ªåœ°æ–¹è¦ä¸è¦æ‰“æ—¥å¿—ï¼Œé‚£å°±æ‰“ä¸Š**\n- **å®æ»¥å‹¿ç¼ºï¼Œå®æ„¿å¤šæ‰“ä¸€äº›æ—¥å¿—ï¼Œä¹Ÿä¸è¦å·æ‡’**\n\n\n\nå‰äººçš„ç»éªŒ\n\n- **ç»Ÿä¸€åˆ©ç”¨AOPæœºåˆ¶ï¼Œè®°å½•ä»»ä½•ä¸ç¬¬ä¸‰æ–¹æ‰“äº¤é“çš„è¯·æ±‚ä¸å“åº”**ï¼ŒåŒ…æ‹¬æ•°æ®åº“ã€ç¼“å­˜ã€RPCè°ƒç”¨ï¼Œä½¿ç”¨**DEBUG**çº§åˆ«è®°å½•æ—¥å¿—\n- **ç»Ÿä¸€åˆ©ç”¨AOPæœºåˆ¶ï¼Œè®°å½•ç³»ç»Ÿæ¥æ”¶çš„è¯·æ±‚ä¸æ”¾å›çš„å“åº”**ï¼Œä½¿ç”¨**DEBUG**çº§åˆ«\n- åœ¨å¼€å‘é˜¶æ®µï¼Œä½¿ç”¨**DEBUG**çº§åˆ«è®°å½•ä¸­é—´**æµç¨‹ä¸­çš„å…³é”®ç»“æœ**\n- æ€€ç–‘ç³»ç»Ÿå¯èƒ½æœ‰é—®é¢˜ï¼Œä½†æ˜¯é—®é¢˜åˆä¸å¤§ï¼Œè®°å½•WARN\n- ä»»ä½•ä¸å¯èƒ½å‡ºç°é—®é¢˜ï¼Œæˆ–è€…è¡¨è¾¾**æœ‰äººæ”»å‡»ç³»ç»Ÿ**çš„åœ°æ–¹ï¼Œè®°å½•**ERROR**\n\n## æ¥å…¥æ—¥å¿—æ¨¡å—\n\nåœ¨Goé‡Œé¢ï¼Œå¯ä»¥ä½¿ç”¨zapä½œä¸ºæ—¥å¿—æ¡†æ¶\n\n[uber-go/zap: Blazing fast, structured, leveled logging in Go. (github.com)](https://github.com/uber-go/zap)\n\n**åˆå§‹åŒ–æ–¹æ³•ï¼š**\n\n- ç›´æ¥è®¾ç½®ä¸€ä¸ªå…¨å±€çš„loggerå³å¯\n\n```go\n\tlogger, err := zap.NewDevelopment()\n\tif err != nil {\n\t\tpanic(err)\n\t}\n\tzap.ReplaceGlobals(logger)\n```\n\nzapä¸­å«æœ‰ä¸€ä¸ªå…¨å±€çš„`globalL`å˜é‡ï¼Œä½†æ˜¯è¿™ä¸ªå…¨å±€å˜é‡ä»€ä¹ˆåŠŸèƒ½éƒ½æœ¨æœ‰å®ç°ï¼Œä¹Ÿå°±æ˜¯è¯´ï¼Œå®ƒè¿æ‰“å°æ—¥å¿—çš„åŠŸèƒ½éƒ½æ²¡æœ‰\n\n![å±å¹•æˆªå›¾ 2024-09-02 193645](https://raw.githubusercontent.com/lyydsheep/pic/main/202409021939910.png)\n\nå› æ­¤éœ€è¦ä½¿ç”¨`NewDevelopment()`æ–¹æ³•åˆ›å»ºä¸€ä¸ªå¯ä»¥ä½¿ç”¨çš„`logger`å¹¶æ›¿æ¢æ‰å…¨å±€å˜é‡çš„åˆå§‹å€¼\n\n![å±å¹•æˆªå›¾ 2024-09-02 193655](https://raw.githubusercontent.com/lyydsheep/pic/main/202409021939433.png)\n\n### æ‰“å°æ—¥å¿—çš„åŸºæœ¬æ“ä½œâ€”â€”Error\n\nå½“å‡ºç°åƒæ˜¯ç³»ç»Ÿé”™è¯¯æ—¶ï¼Œå°±èƒ½æ‰“å°Errorçº§åˆ«çš„æ—¥å¿—\n\n```go\n\tif err != nil {\n\t\tctx.JSON(http.StatusOK, Result{Code: 5, Msg: \"ç³»ç»Ÿé”™è¯¯\"})\n\t\tzap.L().Error(\"vcxnq[nzvx ç”¨æˆ·æ‰‹æœºå·ç ç™»å½•å¤±è´¥\", zap.Error(err))\n\t\treturn\n\t}\n```\n\næ‰“å°æ—¥å¿—ä¸ä»…èƒ½ä¼ å…¥msgä¿¡æ¯ï¼Œè¿˜èƒ½å¤Ÿä¼ å…¥ä¸€äº›`error`ã€`int`ä¹‹ç±»çš„å­—æ®µï¼Œæœ€ç»ˆæ‰“å°ç»“æœå½¢å¦‚ä¸‹å›¾ï¼š\n\n![å±å¹•æˆªå›¾ 2024-09-02 194610](https://raw.githubusercontent.com/lyydsheep/pic/main/202409021953667.png)\n\næ³¨æ„å‡ ä¸ªç»†èŠ‚ï¼š\n\n- æ•æ„Ÿæ•°æ®ï¼ˆä¾‹å¦‚æ‰‹æœºå·ç ï¼‰ä¸èƒ½æ‰“å…¥æ—¥å¿—ï¼Œå‹‰å¼ºèƒ½å¤Ÿæ¥å—ä½¿ç”¨debugçº§åˆ«æ‰“å°æ•æ„Ÿæ•°æ®ç”¨äºæœ¬åœ°å¼€å‘\n- msgè¦æœ‰è¶³å¤Ÿå®šä½bugå‡ºå¤„çš„ä¿¡æ¯ï¼Œä¾‹å¦‚åœ¨æ—¥å¿—ä¸­ç”¨ä¸€æ®µä¹±ç å”¯ä¸€æ ‡è¯†æ—¥å¿—ï¼Œè¿™æ ·åªéœ€è¦å…¨å±€æ£€ç´¢è¿™æ®µä¹±ç å°±èƒ½æ‰¾åˆ°å‡ºé”™çš„ä½ç½®\n- ç»å¯¹ä¸èƒ½æŠŠerrorè¿”å›ç»™å‰ç«¯ï¼Œæš´éœ²ç»™ç”¨æˆ·\n\n### æ‰“å°æ—¥å¿—çš„åŸºæœ¬æ“ä½œâ€”â€”Warn\n\n![image-20240902200117065](https://raw.githubusercontent.com/lyydsheep/pic/main/202409022001108.png)\n\nåœ¨æ­¤å¤„æ‰“å°äº†ä¸€ä¸ªWarnæ—¥å¿—ï¼Œå› ä¸ºçŸ­ä¿¡å‘é€é¢‘ç¹æ˜¯**å¶å°”**ä¼šå‘ç”Ÿçš„ï¼Œ**èƒ½å¤Ÿæ¥å—**ã€‚ä½†è¦æ˜¯**é¢‘ç¹å‡ºç°Warn**ï¼Œå°±å¾ˆæœ‰å¯èƒ½æ˜¯æœ‰äººåœ¨æ”»å‡»ç³»ç»Ÿï¼Œé‚£å°±è¦**å‘Šè­¦å¼•èµ·æ³¨æ„äº†**\n\n###   æ‰“å°æ—¥å¿—çš„åŸºæœ¬æ“ä½œâ€”â€”Info\n\nInfoæ—¥å¿—ç”¨äºè®°å½•ä¸€äº›**ä¸­æ€§ä¿¡æ¯**ï¼Œä¾‹å¦‚\n\n![image-20240902203836373](https://raw.githubusercontent.com/lyydsheep/pic/main/202409022038436.png)\n\n### æ‰“å°æ—¥å¿—çš„åŸºæœ¬æ“ä½œâ€”â€”Debug\n\nDebugæ—¥å¿—å¯ä»¥ç”¨äºè®°å½•å’Œç¬¬ä¸‰æ–¹äº¤äº’çš„åŠ¨ä½œ\n\n```go\nfunc (s *Service) Send(ctx context.Context, tpl string, args []sms.NameData, numbers ...string) error {\n\tzap.L().Debug(\"avnasio å³å°†å‘é€çŸ­ä¿¡\", zap.String(\"tpl\", tpl), zap.Any(\"args\", args))\n\terr := s.svc.Send(ctx, tpl, args, numbers...)\n\tif err != nil {\n\t\tzap.L().Debug(\"å‘é€çŸ­ä¿¡å‡ºç°å¼‚å¸¸\", zap.Error(err))\n\t\treturn err\n\t}\n\treturn err\n}\n```\n\nå¯ä»¥è€ƒè™‘ä½¿ç”¨è£…é¥°å™¨æ¨¡å¼æ‰©å±•`Write()`æ–¹æ³•çš„åŠŸèƒ½\n\nä¾‹å¦‚ï¼Œè‡ªåŠ¨å°†keyä¸ºphoneçš„å­—æ®µè¿›è¡Œæ•°æ®è„±æ•\n\n```go\ntype MyCore struct {\n\tzapcore.Core\n}\n\nfunc (c *MyCore) Write(e zapcore.Entry, fs []zapcore.Field) error {\n\t// è£…é¥°å™¨æ¨¡å¼ï¼Œè¿›è¡Œæ•°æ®è„±æ•\n\tfor _, f := range fs {\n\t\tif f.Key == \"phone\" {\n\t\t\tnumber := f.String\n\t\t\tf.String = number[:3] + \"****\" + number[7:]\n\t\t}\n\t}\n\treturn c.Core.Write(e, fs)\n}\n```\n\n\n\nè£…é¥°å™¨æ¨¡å¼å®ç°ä¸€ä¸ªcoreï¼Œèƒ½å¤Ÿè‡ªåŠ¨å°†keyä¸ºphoneçš„å­—æ®µå¯¹åº”çš„å€¼è¿›è¡Œè„±æ•\n\n### ä¸ä½¿ç”¨åŒ…å˜é‡â€”â€”ä¿æŒä¾èµ–æ³¨å…¥é£æ ¼\n\næœ‰çš„æ—¶å€™ä¸åŒçš„ä¸šåŠ¡ä¸æ„¿æ„å…±äº«åŒä¸€ä¸ªå…¨å±€çš„loggerï¼Œè¿™ä¸ªæ—¶å€™å°±éœ€è¦åœ¨ä¸åŒåœ°æ–¹åˆ›å»ºå±äºä»–ä»¬è‡ªå·±çš„logger\n\nä¸€ä¸ªå¾ˆç›´æ¥çš„æ–¹æ³•å°±æ˜¯åœ¨serviceå±‚æ·»åŠ loggerå­—æ®µï¼Œä¸ºä¸åŒä¸šåŠ¡å¼•å…¥å„è‡ªçš„loggerï¼Œå¹¶ä¸”ä¿æŒç€ä¾èµ–æ³¨å…¥çš„é£æ ¼\n\n![å±å¹•æˆªå›¾ 2024-09-03 214039](https://raw.githubusercontent.com/lyydsheep/pic/main/202409032144169.png)\n\n![](https://raw.githubusercontent.com/lyydsheep/pic/main/202409032144084.png)\n\nè¿˜æœ‰ä¸€ç§æ›´ç®€å•çš„ä¾èµ–æ³¨å…¥æ–¹æ³•ï¼š**æ³¨å…¥äº†ï¼Œä½†æ˜¯æ²¡æœ‰å®Œå…¨æ³¨å…¥**\n\nè¿™ç§åšæ³•çš„å¥½å¤„å°±æ˜¯ï¼Œä¸ºå°†æ¥æ‰©å±•ç•™ä¸‹äº†å¯æ“ä½œçš„ç©ºé—´\n\n```go\nfunc NewUserService(repo repository.UserRepository) UserService {\n\treturn &BasicUserService{\n\t\trepo:   repo,\n        // é¢„ç•™äº†å˜åŠ¨çš„ç©ºé—´\n        logger: zap.L(),\n\t}\n}\n```\n\n### æŠ½è±¡æ—¥å¿—API\n\nåšåˆ°è¿™é‡Œä¸éš¾å‘ç°ï¼Œä¸ç®¡æ˜¯é…ç½®æ¨¡å—ä¹Ÿå¥½ï¼Œæ—¥å¿—æ¨¡å—ä¹Ÿå¥½ï¼Œæˆ‘ä»¬çš„ä»£ç éƒ½å¼ºè€¦åˆviperæ¡†æ¶å’Œzapæ¡†æ¶ã€‚è¿™å°±ä¼šæœ‰æ½œåœ¨çš„é£é™©ï¼šä¸‡ä¸€è¿viperå’Œzapæ¡†æ¶éƒ½æƒ³æ¢æ‰å‘¢ï¼Ÿ\n\nå› æ­¤ï¼Œæˆ‘ä»¬éœ€è¦å®šä¹‰è‡ªå·±loggeræ¥å£ï¼Œå¼±åŒ–å¯¹zapæ¡†æ¶çš„ä¾èµ–\n\nå…·ä½“æœ‰ä¸‰ç§é£æ ¼\n\n- ```go\n  type Logger interface {\n  \tDebug(msg string, args...any)\n  \tInfo(msg string, args...any)\n  \tWarn(msg string, args...any)\n  \tError(msg string, args...any)\n  }\n  \n  func Example() {\n  \tvar l Logger\n  \t// åœ¨msgä¸­ç•™æœ‰å ä½ç¬¦\n  \tl.Info(\"ç”¨æˆ·æœªæ³¨å†Œï¼Œç”¨æˆ·ä¿¡æ¯ä¸º %v\", \"ababab\")\n  }\n  ```\n\n- ```go\n  type LoggerV1 interface {\n  \tDebug(msg string, args ...Field)\n  \tInfo(msg string, args ...Field)\n  \tWarn(msg string, args ...Field)\n  \tError(msg string, args ...Field)\n  }\n  \n  type Field struct {\n  \tKey string\n  \tVal any\n  }\n  \n  func ExampleV1() {\n  \tvar l LoggerV1\n  \t// è¾“å‡ºçš„valæœ‰å¯¹åº”çš„keyï¼Œå’Œzapé‡‡ç”¨ç›¸åŒçš„æ¨¡å¼\n  \tl.Info(\"è¿™ä¸ªmsg\", Field{Key: \"è¿™ä¸ªæ˜¯key\", Val: \"è¿™ä¸ªæ˜¯Val\"})\n  }\n  \n  ```\n\n- ```go\n  // LoggerV2 è¦æ±‚argsçš„ä¸ªæ•°æ˜¯å¶æ•°ï¼Œä»¥key-valå½¢å¼äº¤æ›¿å‡ºç°\n  type LoggerV2 interface {\n  \tDebug(msg string, args ...any)\n  \tInfo(msg string, args ...any)\n  \tWarn(msg string, args ...any)\n  \tError(msg string, args ...any)\n  }\n  \n  func ExampleV2() {\n  \tvar l LoggerV2\n  \tl.Info(\"è¿™æ˜¯msg\", \"key\", \"val\")\n  }\n  ```\n\n- ç¬¬ä¸€ç§é£æ ¼**å…¼å®¹æ€§æœ€å¥½**\n- ç¬¬äºŒç§é£æ ¼è®¤åŒ**å‚æ•°å°±åº”è¯¥æœ‰ä¸ªåå­—**\n- ç¬¬ä¸‰ç§é£æ ¼**å¦‚æœæœ‰å®Œå–„çš„ä»£ç è¯„å®¡æµç¨‹çš„è¯å¯ä»¥è€ƒè™‘è€ƒè™‘**ï¼Œä¸ç„¶ä¸æ¨è\n\n### é€‚é…å™¨æ¨¡å¼\n\næ—¢ç„¶å·²ç»æŠ½è±¡å‡ºäº†æ—¥å¿—æ¥å£ï¼Œé‚£ä¹ˆå…·ä½“è¯¥å¦‚ä½•å®ç°å‘¢ï¼Ÿ\n\nç­”æ¡ˆå°±æ˜¯é‡‡ç”¨**é€‚é…å™¨æ¨¡å¼**\n\næ‰€è°“é€‚é…å™¨æ¨¡å¼ï¼Œå°±æ˜¯**å°†ä¸€ä¸ªç±»å‹é€‚é…åˆ°å¦ä¸€ä¸ªæ¥å£ä¸Š**ã€‚ä¾‹å¦‚ï¼Œå°†Aé€‚é…åˆ°Bï¼Œè¿™é‡Œçš„Aå¯ä»¥æ˜¯æ¥å£ï¼Œä¹Ÿå¯ä»¥æ˜¯ä¸€ä¸ªå…·ä½“çš„ç±»å‹\n\n**å…¸å‹çš„ä½¿ç”¨åœºæ™¯**\n\n- æœ‰ä¸¤ä¸ªç”¨é€”ç±»ä¼¼ï¼Œä½†æ˜¯ç»†èŠ‚ä¸Šç•¥æœ‰ä¸åŒçš„æ¥å£ï¼Œå°†ä¸€ä¸ªæ¥å£é€‚é…åˆ°å¦ä¸€ä¸ªæ¥å£ä¸Š\n- ç”±äºç‰ˆæœ¬è¿­ä»£ï¼Œå‡ºç°äº†ä¸¤ä¸ªæ¥å£ï¼Œéœ€è¦å°†ä¸€ä¸ªæ¥å£é€‚é…åˆ°å¦ä¸€ä¸ªæ¥å£ä¸Š\n\n**ä¸è£…é¥°å™¨æ¨¡å¼çš„åŒºåˆ«**\n\n- è£…é¥°å™¨æ¨¡å¼ç”¨äº**æ‰©å±•åŠŸèƒ½**ï¼Œè‡ªå§‹è‡³ç»ˆ**éƒ½æ˜¯ä¸€ä¸ªæ¥å£**\n- é€‚é…å™¨æ¨¡å¼**å¿…ç„¶æ˜¯ä¸¤ä¸ªä¸åŒçš„æ¥å£**\n\n### åˆ©ç”¨Ginçš„middlewareæ‰“å°æ—¥å¿—\n\nåœ¨handleræ–‡ä»¶ä¸­ï¼Œæœ‰å¾ˆå¤šä¸ªæ–¹æ³•ï¼Œå¦‚æœä¸€ä¸€ä¸ºè¿™äº›æ–¹æ³•æ‰“å°æ—¥å¿—éœ€è¦èŠ±è´¹å¾ˆå¤šæ—¶é—´å’Œç²¾åŠ›\n\nå¯æ˜¯å‘ç°ï¼Œhandlerä¸­çš„æ–¹æ³•éƒ½æ˜¯ä¸è¯·æ±‚å’Œå“åº”æœ‰å…³çš„ï¼Œé‚£ä¹ˆå°±å¯ä»¥é‡‡ç”¨`AOP`æœºåˆ¶ï¼Œåˆ©ç”¨ginçš„middlewareæ¥ç»Ÿä¸€æ‰“æ—¥å¿—\n\n#### ä½¿ç”¨builderæ¨¡å¼æ„å»ºä¸­é—´ä»¶\n\n```go\n// å‡ ä¸ªæ³¨æ„ç‚¹ï¼š\n// å°å¿ƒæ—¥å¿—å†…å®¹è¿‡å¤šï¼šURLå¯èƒ½å¾ˆé•¿ï¼Œè¯·æ±‚ä½“ã€å“åº”ä½“éƒ½å¯èƒ½ç‰¹åˆ«ç‰¹åˆ«å¤§ï¼Œéœ€è¦è€ƒè™‘æ˜¯å¦è¦è¿›è¡Œæˆªå–\n// ç”¨æˆ·å¯èƒ½æ¢ç”¨ä¸åŒçš„æ—¥å¿—æ¡†æ¶ï¼Œæ‰€ä»¥è¦æœ‰è¶³å¤Ÿçš„çµæ´»æ€§\n// è€ƒè™‘ç»“åˆviperå®ç°åŠ¨æ€å¼€å…³ï¼Œä½†æ˜¯è¦å°å¿ƒå¹¶å‘å®‰å…¨\nfunc (b *Builder) Build() gin.HandlerFunc {\n\treturn func(ctx *gin.Context) {\n\t\tstart := time.Now()\n\t\tal := AccessLog{}\n\t\tal.Method = ctx.Request.Method\n\t\tif b.allowURL && ctx.Request.URL != nil {\n\t\t\turl := ctx.Request.URL.String()\n\t\t\tif len(url) > 1024 {\n\t\t\t\turl = url[:1024]\n\t\t\t}\n\t\t\tal.URL = url\n\t\t}\n\t\tif b.allowReqBody && ctx.Request.Body != nil {\n\t\t\t// è¿™é‡Œå¿½ç•¥é”™è¯¯ï¼Œæ¯•ç«Ÿæˆ‘åªæ˜¯æ‰“å°ä¸ªæ—¥å¿—ï¼Œæœ‰é”™è¯¯ä¹Ÿæ— æ‰€è°“äº†\n\t\t\tdata, _ := ctx.GetRawData()\n\t\t\t// Request.Bodyæ˜¯ä¸€ä¸ªæµå¯¹è±¡ï¼Œè¯»å®Œä¹‹åRequesté‡Œé¢å°±æœ¨æœ‰äº†\n\t\t\t// æ‰€ä»¥è¿˜å¾—æŠŠæ•°æ®æ”¾å›Request.Bodyï¼Œä¸ç„¶åç»­æ­¥éª¤å°±è¯»ä¸åˆ°è¿™ä¸ªæ•°æ®äº†\n\t\t\tctx.Request.Body = io.NopCloser(bytes.NewBuffer(data))\n\t\t\tbody := string(data)\n\t\t\tif len(body) > 1024 {\n\t\t\t\tal.ReqBody = body\n\t\t\t}\n\t\t}\n\t\t// defer æ‰“æ—¥å¿—ï¼Œå³ä½¿æœ‰panicä¹Ÿä¸ä¼šå½±å“æ—¥å¿—çš„è¾“å‡º\n\t\tdefer func() {\n\t\t\tal.Duration = time.Since(start).String()\n\t\t\t// å…·ä½“æ€ä¹ˆæ‰“å°æ—¥å¿—ï¼Œç”±ç”¨æˆ·å†³å®š\n\t\t\tb.logFunc(ctx, al)\n\t\t}()\n\t\t// æ‰§è¡Œåˆ°ä¸šåŠ¡ä»£ç ï¼ˆä¸æ˜¯å¾ˆæ‡‚ï¼‰\n\t\tctx.Next()\n\t}\n}\n\ntype AccessLog struct {\n\t// è¯·æ±‚æ–¹æ³•\n\tMethod string\n\t// url\n\tURL string\n\t// è¯·æ±‚ä½“\n\tReqBody string\n\t// å¤„ç†æ—¶é—´\n\tDuration string\n\t// å“åº”ä½“\n\tRespBody string\n}\n```\n\n**ä¸€ä¸ªæœ‰æ„æ€çš„ç‚¹ï¼šä¸ºä»€ä¹ˆè¦è®©ç”¨æˆ·ä¼ è¿›æ¥ä¸€ä¸ªæ‰“æ—¥å¿—çš„æ–¹æ³•å‘¢ï¼Ÿ**\n\nå¦‚æœä¸ä¼ é€’æ–¹æ³•ï¼Œé‚£ä¹ˆåœ¨å®ç°ä¸­ä¸ç®¡æˆ‘ä»¬æ˜¯ç”¨`Info()`ã€`Debug()`è¿˜æ˜¯`Error()`éƒ½æ˜¯å†™æ­»åœ¨ä»£ç ä¸­çš„ï¼Œä¸èƒ½çµæ´»åœ°åº”å¯¹ä¸åŒçš„åœºæ™¯ï¼Œä¾‹å¦‚å¼€å‘ç¯å¢ƒè¦ç”¨`Debug()`ï¼Œå¯èƒ½çº¿ä¸Šç¯å¢ƒæˆ‘å°±è¦ç”¨`Info()`äº†\n\né‚£ä¹ˆä¸å¦‚å°±è®©ç”¨æˆ·ä¼ è¿›æ¥ä¸€ä¸ªæ–¹æ³•ï¼Œåªä¸ºç”¨æˆ·æä¾›ä¸€ä¸ªæ¥å£ï¼Œå±è”½åº•å±‚çš„å®ç°ï¼Œç”¨æˆ·åªéœ€è¦è€ƒè™‘åœ¨ä¸åŒç¯å¢ƒé€‰æ‹©ä½¿ç”¨ä¸åŒçš„æ–¹æ³•å°±è¡Œäº†\n\n#### æ‰“å°å“åº”\n\næ­£å¸¸æ¥è¯´ï¼Œæ‰“å°å“åº”å°±åº”è¯¥å’Œä¸Šæ–‡ä¸­æ‰“å°è¯·æ±‚ä¸€æ ·ç®€å•ï¼šç›´æ¥ä»`context`é‡Œé¢æ‹¿è¯·æ±‚å°±è¡Œ\n\nä¸å¹¸çš„æ˜¯ï¼Œ`ctx`å¹¶æ²¡æœ‰æš´éœ²å‡º`Response`ï¼Œä¹Ÿå°±æ˜¯ä¸èƒ½ç›´æ¥è¯»å“åº”\n\nä½†æ˜¯ï¼Œ`ctx`æš´éœ²å‡ºäº†`ResponseWriter`ï¼Œè¿™ä¸ªæ¥å£æ˜¯ç”¨æ¥å†™å“åº”çš„ã€‚é‚£ä¹ˆæˆ‘ä»¬å¯ä»¥â€œ**å·æ¢æ¢æŸ±**â€ï¼Œå°†è¿™ä¸ªæ¥å£æ¢æˆæˆ‘ä»¬è‡ªå·±çš„å®ç°ï¼š**åœ¨å†™å“åº”ä¹‹å‰å°†æ•°æ®ä¿ç•™ä¸‹æ¥ï¼Œè¿™æ ·å°±æœ‰äº†å“åº”çš„å…·ä½“æ•°æ®**\n\nåœ¨è¿™é‡Œæˆ‘ä»¬åªéœ€è¦é‡å†™`WriteHeader`ã€`Write`ã€`WriteString`è¿™ä¸‰ä¸ªæ–¹æ³•ï¼Œæ‰€ä»¥è£…é¥°å™¨æ¨¡å¼åœ¨å®ç°çš„æ—¶å€™å¯ä»¥é‡‡ç”¨ç»„åˆçš„æ–¹å¼\n\n- ç»„åˆ ---> è£…é¥°éƒ¨åˆ†æ–¹æ³•\n- éç»„åˆ ---> è£…é¥°å…¨éƒ¨æ–¹æ³•\n\n```go\nif b.allowRespBody {\n\t// å·æ¢æ¢æŸ±\n\tctx.Writer = &responseWriter{\n\t\tal: &al,\n\t\tResponseWriter: ctx.Writer,\n\t}\n}\n\ntype responseWriter struct {\n\t// è¿™é‡Œç”¨æŒ‡é’ˆï¼Œä¸ºäº†èƒ½ç•™ä½â€œå·â€è¿‡æ¥çš„æ•°æ®\n\tal *AccessLog\n\tgin.ResponseWriter\n}\n\nfunc (r *responseWriter) WriteString(data string) (int, error) {\n\tr.al.RespBody = data\n\treturn r.ResponseWriter.WriteString(data)\n}\n\nfunc (r *responseWriter) Write(data []byte) (int, error) {\n\tr.al.RespBody = string(data)\n\treturn r.ResponseWriter.Write(data)\n}\n\nfunc (r *responseWriter) WriteHeader(statusCode int) {\n\tr.al.Status = statusCode\n\tr.ResponseWriter.WriteHeader(statusCode)\n}\n```\n\n### GORMæ‰“å°æ—¥å¿—\n\nç›´æ¥ä¸Šä»£ç ï¼š\n\n```go\n// è¡ç”Ÿç±»å‹ï¼Œæœ‰ç‚¹åƒé€‚é…å™¨æ¨¡å¼\ntype gormLoggerFunc func(msg string, fields ...zap.Field)\n\n// Printf å®ç°å•æ¥å£\nfunc (g gormLoggerFunc) Printf(msg string, fields ...interface{}) {\n\tg(msg, zap.Any(\"args\", fields))\n}\n\n\n\nfunc InitDB(l *zap.Logger) *gorm.DB {\n\ttype Config struct {\n\t\tDSN string `yaml:\"dsn\"`\n\t}\n\tvar config Config\n\tconfig.DSN = \"abab\"\n\terr := viper.UnmarshalKey(\"db\", &config)\n\tif err != nil {\n\t\tpanic(err)\n\t}\n\tdb, err := gorm.Open(mysql.Open(config.DSN), &gorm.Config{\n\t\t// å¼ºåˆ¶ç±»å‹è½¬æ¢\n\t\tLogger: logger.New(gormLoggerFunc(l.Debug), logger.Config{\n\t\t\t// æ…¢æŸ¥è¯¢é˜ˆå€¼ï¼Œåªæœ‰è¯­å¥æ‰§è¡Œæ—¶é—´è¶…è¿‡è¿™ä¸ªé˜ˆå€¼æ‰ä¼šæ‰“å°æ—¥å¿—\n            // ä¸€èˆ¬ä¸º50ms 100msï¼Œä¸€æ¬¡ç£ç›˜ioæ“ä½œå¤§æ¦‚æ˜¯10ms\n\t\t\tSlowThreshold:             time.Millisecond * 10,\n\t\t\tLogLevel:                  logger.Info,\n\t\t\tIgnoreRecordNotFoundError: true,\n\t\t\tParameterizedQueries:      true,\n\t\t}),\n\t})\n\tif err != nil {\n\t\tpanic(err)\n\t}\n\terr = dao.InitTable(db)\n\tif err != nil {\n\t\tpanic(err)\n\t}\n\treturn db\n}\n\n```\n\ngormå·²ç»ä¸ºæˆ‘ä»¬æä¾›äº†æœ‰å…³æ—¥å¿—çš„é…ç½®ï¼Œæ‰€ä»¥æˆ‘ä»¬å¯ä»¥ç›´æ¥ä½¿ç”¨é…ç½®å®ç°æ‰“æ—¥å¿—åŠŸèƒ½\n\nè¿™é‡Œæœ‰ä¸ªå°é—®é¢˜ï¼Œ`logger.New()`æ–¹æ³•çš„ç¬¬ä¸€ä¸ªå‚æ•°è¦æ±‚ä¼ å…¥`Writer`æ¥å£çš„å®ç°ï¼Œè¿™ä¸ªå®ç°å°†ä¼šç”¨æ¥è¾“å‡ºæ—¥å¿—\n\n![image-20240907163634983](https://raw.githubusercontent.com/lyydsheep/pic/main/202409071637525.png)\n\né‚£ä¹ˆç°åœ¨å°±æ˜¯éœ€è¦å°†æˆ‘ä»¬è‡ªå·±å®ç°çš„æ—¥å¿—æ¥å£é€‚é…åˆ°gormçš„`Writer`æ¥å£ä¸Š\n\nå¥½å·§ä¸å·§ï¼Œ`Writer`æ¥å£åªæœ‰ä¸€ä¸ªæ–¹æ³•ï¼Œé‚£ä¹ˆå°±å¯ä»¥ç”¨ä¸Š**è¡ç”Ÿå‡½æ•°+å‡½æ•°å®ç°å•æ¥å£**æŠ€å·§ï¼Œå¿«é€Ÿå°†æˆ‘ä»¬çš„æ—¥å¿—æ¥å£é€‚é…åˆ°æ­¤å¤„\n\nè¿™å°±æ˜¯ä¸ºä»€ä¹ˆæˆ‘ä»¬çš„è¡ç”Ÿå‡½æ•°çš„åŸç±»å‹æ˜¯`func(msg string, fields...zap.Field)`ï¼Œè¿™æ­£æ˜¯`l.Debug()`æ–¹æ³•çš„å‡½æ•°ç±»å‹å•Š\n\næœ€åä¼ å…¥`Writer`æ¥å£çš„æ—¶å€™ï¼Œåˆ©ç”¨è¡ç”Ÿç±»å‹å°†`l.Debug()`å¼ºåˆ¶ç±»å‹è½¬æ¢ï¼Œä½¿å…¶é—´æ¥åœ°å®ç°äº†`Writer`æ¥å£çš„åŒæ—¶ï¼ŒæœªåŠ¨æˆ‘ä»¬è‡ªå·±çš„æ¥å£åˆ†æ¯«\n\n\n\n\n\n","slug":"Go/æ¥å…¥æ—¥å¿—æ¨¡å—","published":1,"updated":"2024-12-27T11:03:15.345Z","comments":1,"layout":"post","photos":[],"_id":"cm6c7md6m0021a5t2fa347a3p","content":"<h1 id=\"æ¥å…¥æ—¥å¿—æ¨¡å—\"><a href=\"#æ¥å…¥æ—¥å¿—æ¨¡å—\" class=\"headerlink\" title=\"æ¥å…¥æ—¥å¿—æ¨¡å—\"></a>æ¥å…¥æ—¥å¿—æ¨¡å—</h1><h2 id=\"æ—¥å¿—é€šç”¨ç†è®º\"><a href=\"#æ—¥å¿—é€šç”¨ç†è®º\" class=\"headerlink\" title=\"æ—¥å¿—é€šç”¨ç†è®º\"></a>æ—¥å¿—é€šç”¨ç†è®º</h2><h3 id=\"çº§åˆ«\"><a href=\"#çº§åˆ«\" class=\"headerlink\" title=\"çº§åˆ«\"></a>çº§åˆ«</h3><p><strong>DEBUG</strong>ï¼šè®°å½•ä¸€äº›è¾…åŠ©æ’æŸ¥é—®é¢˜çš„ä¿¡æ¯ã€‚ä¸€èˆ¬ä¸ä¼šåœ¨çº¿ä¸Šä½¿ç”¨</p>\n<p><strong>INFO</strong>ï¼šä¸­æ€§åœ°æè¿°å‘é€äº†ä»€ä¹ˆã€‚çº¿ä¸Šä¸€èˆ¬éƒ½æ˜¯ç”¨è¿™ä¸ªçº§åˆ«</p>\n<p><strong>WARN</strong>ï¼šç³»ç»Ÿå‘ç”Ÿäº†ä¸€äº›ä¸å¥½ä½†æ˜¯èƒ½å¤Ÿå®¹å¿çš„äº‹æƒ…ã€‚è‡³å°‘ä¼šæ‰“å°è¿™ä¸ªçº§åˆ«çš„æ—¥å¿—</p>\n<p><strong>ERROR</strong>ï¼šç³»ç»Ÿå‘ç”Ÿäº†ä¸€äº›éœ€è¦ä¿æŒå…³æ³¨çš„äº‹æƒ…</p>\n<h3 id=\"ä»€ä¹ˆæ—¶å€™æ‰“æ—¥å¿—ï¼Ÿæ‰“ä»€ä¹ˆçº§åˆ«ï¼Ÿ\"><a href=\"#ä»€ä¹ˆæ—¶å€™æ‰“æ—¥å¿—ï¼Ÿæ‰“ä»€ä¹ˆçº§åˆ«ï¼Ÿ\" class=\"headerlink\" title=\"ä»€ä¹ˆæ—¶å€™æ‰“æ—¥å¿—ï¼Ÿæ‰“ä»€ä¹ˆçº§åˆ«ï¼Ÿ\"></a>ä»€ä¹ˆæ—¶å€™æ‰“æ—¥å¿—ï¼Ÿæ‰“ä»€ä¹ˆçº§åˆ«ï¼Ÿ</h3><p>ä¸¤ä¸ªåŸåˆ™</p>\n<ul>\n<li><strong>å¦‚æœæ€€ç–‘æŸä¸ªåœ°æ–¹è¦ä¸è¦æ‰“æ—¥å¿—ï¼Œé‚£å°±æ‰“ä¸Š</strong></li>\n<li><strong>å®æ»¥å‹¿ç¼ºï¼Œå®æ„¿å¤šæ‰“ä¸€äº›æ—¥å¿—ï¼Œä¹Ÿä¸è¦å·æ‡’</strong></li>\n</ul>\n<p>å‰äººçš„ç»éªŒ</p>\n<ul>\n<li><strong>ç»Ÿä¸€åˆ©ç”¨AOPæœºåˆ¶ï¼Œè®°å½•ä»»ä½•ä¸ç¬¬ä¸‰æ–¹æ‰“äº¤é“çš„è¯·æ±‚ä¸å“åº”</strong>ï¼ŒåŒ…æ‹¬æ•°æ®åº“ã€ç¼“å­˜ã€RPCè°ƒç”¨ï¼Œä½¿ç”¨<strong>DEBUG</strong>çº§åˆ«è®°å½•æ—¥å¿—</li>\n<li><strong>ç»Ÿä¸€åˆ©ç”¨AOPæœºåˆ¶ï¼Œè®°å½•ç³»ç»Ÿæ¥æ”¶çš„è¯·æ±‚ä¸æ”¾å›çš„å“åº”</strong>ï¼Œä½¿ç”¨<strong>DEBUG</strong>çº§åˆ«</li>\n<li>åœ¨å¼€å‘é˜¶æ®µï¼Œä½¿ç”¨<strong>DEBUG</strong>çº§åˆ«è®°å½•ä¸­é—´<strong>æµç¨‹ä¸­çš„å…³é”®ç»“æœ</strong></li>\n<li>æ€€ç–‘ç³»ç»Ÿå¯èƒ½æœ‰é—®é¢˜ï¼Œä½†æ˜¯é—®é¢˜åˆä¸å¤§ï¼Œè®°å½•WARN</li>\n<li>ä»»ä½•ä¸å¯èƒ½å‡ºç°é—®é¢˜ï¼Œæˆ–è€…è¡¨è¾¾<strong>æœ‰äººæ”»å‡»ç³»ç»Ÿ</strong>çš„åœ°æ–¹ï¼Œè®°å½•<strong>ERROR</strong></li>\n</ul>\n<h2 id=\"æ¥å…¥æ—¥å¿—æ¨¡å—-1\"><a href=\"#æ¥å…¥æ—¥å¿—æ¨¡å—-1\" class=\"headerlink\" title=\"æ¥å…¥æ—¥å¿—æ¨¡å—\"></a>æ¥å…¥æ—¥å¿—æ¨¡å—</h2><p>åœ¨Goé‡Œé¢ï¼Œå¯ä»¥ä½¿ç”¨zapä½œä¸ºæ—¥å¿—æ¡†æ¶</p>\n<p><a href=\"https://github.com/uber-go/zap\">uber-go&#x2F;zap: Blazing fast, structured, leveled logging in Go. (github.com)</a></p>\n<p><strong>åˆå§‹åŒ–æ–¹æ³•ï¼š</strong></p>\n<ul>\n<li>ç›´æ¥è®¾ç½®ä¸€ä¸ªå…¨å±€çš„loggerå³å¯</li>\n</ul>\n<figure class=\"highlight go\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">logger, err := zap.NewDevelopment()</span><br><span class=\"line\"><span class=\"keyword\">if</span> err != <span class=\"literal\">nil</span> &#123;</span><br><span class=\"line\">\t<span class=\"built_in\">panic</span>(err)</span><br><span class=\"line\">&#125;</span><br><span class=\"line\">zap.ReplaceGlobals(logger)</span><br></pre></td></tr></table></figure>\n\n<p>zapä¸­å«æœ‰ä¸€ä¸ªå…¨å±€çš„<code>globalL</code>å˜é‡ï¼Œä½†æ˜¯è¿™ä¸ªå…¨å±€å˜é‡ä»€ä¹ˆåŠŸèƒ½éƒ½æœ¨æœ‰å®ç°ï¼Œä¹Ÿå°±æ˜¯è¯´ï¼Œå®ƒè¿æ‰“å°æ—¥å¿—çš„åŠŸèƒ½éƒ½æ²¡æœ‰</p>\n<p><img src=\"https://raw.githubusercontent.com/lyydsheep/pic/main/202409021939910.png\" alt=\"å±å¹•æˆªå›¾ 2024-09-02 193645\"></p>\n<p>å› æ­¤éœ€è¦ä½¿ç”¨<code>NewDevelopment()</code>æ–¹æ³•åˆ›å»ºä¸€ä¸ªå¯ä»¥ä½¿ç”¨çš„<code>logger</code>å¹¶æ›¿æ¢æ‰å…¨å±€å˜é‡çš„åˆå§‹å€¼</p>\n<p><img src=\"https://raw.githubusercontent.com/lyydsheep/pic/main/202409021939433.png\" alt=\"å±å¹•æˆªå›¾ 2024-09-02 193655\"></p>\n<h3 id=\"æ‰“å°æ—¥å¿—çš„åŸºæœ¬æ“ä½œâ€”â€”Error\"><a href=\"#æ‰“å°æ—¥å¿—çš„åŸºæœ¬æ“ä½œâ€”â€”Error\" class=\"headerlink\" title=\"æ‰“å°æ—¥å¿—çš„åŸºæœ¬æ“ä½œâ€”â€”Error\"></a>æ‰“å°æ—¥å¿—çš„åŸºæœ¬æ“ä½œâ€”â€”Error</h3><p>å½“å‡ºç°åƒæ˜¯ç³»ç»Ÿé”™è¯¯æ—¶ï¼Œå°±èƒ½æ‰“å°Errorçº§åˆ«çš„æ—¥å¿—</p>\n<figure class=\"highlight go\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">if</span> err != <span class=\"literal\">nil</span> &#123;</span><br><span class=\"line\">\tctx.JSON(http.StatusOK, Result&#123;Code: <span class=\"number\">5</span>, Msg: <span class=\"string\">&quot;ç³»ç»Ÿé”™è¯¯&quot;</span>&#125;)</span><br><span class=\"line\">\tzap.L().Error(<span class=\"string\">&quot;vcxnq[nzvx ç”¨æˆ·æ‰‹æœºå·ç ç™»å½•å¤±è´¥&quot;</span>, zap.Error(err))</span><br><span class=\"line\">\t<span class=\"keyword\">return</span></span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n\n<p>æ‰“å°æ—¥å¿—ä¸ä»…èƒ½ä¼ å…¥msgä¿¡æ¯ï¼Œè¿˜èƒ½å¤Ÿä¼ å…¥ä¸€äº›<code>error</code>ã€<code>int</code>ä¹‹ç±»çš„å­—æ®µï¼Œæœ€ç»ˆæ‰“å°ç»“æœå½¢å¦‚ä¸‹å›¾ï¼š</p>\n<p><img src=\"https://raw.githubusercontent.com/lyydsheep/pic/main/202409021953667.png\" alt=\"å±å¹•æˆªå›¾ 2024-09-02 194610\"></p>\n<p>æ³¨æ„å‡ ä¸ªç»†èŠ‚ï¼š</p>\n<ul>\n<li>æ•æ„Ÿæ•°æ®ï¼ˆä¾‹å¦‚æ‰‹æœºå·ç ï¼‰ä¸èƒ½æ‰“å…¥æ—¥å¿—ï¼Œå‹‰å¼ºèƒ½å¤Ÿæ¥å—ä½¿ç”¨debugçº§åˆ«æ‰“å°æ•æ„Ÿæ•°æ®ç”¨äºæœ¬åœ°å¼€å‘</li>\n<li>msgè¦æœ‰è¶³å¤Ÿå®šä½bugå‡ºå¤„çš„ä¿¡æ¯ï¼Œä¾‹å¦‚åœ¨æ—¥å¿—ä¸­ç”¨ä¸€æ®µä¹±ç å”¯ä¸€æ ‡è¯†æ—¥å¿—ï¼Œè¿™æ ·åªéœ€è¦å…¨å±€æ£€ç´¢è¿™æ®µä¹±ç å°±èƒ½æ‰¾åˆ°å‡ºé”™çš„ä½ç½®</li>\n<li>ç»å¯¹ä¸èƒ½æŠŠerrorè¿”å›ç»™å‰ç«¯ï¼Œæš´éœ²ç»™ç”¨æˆ·</li>\n</ul>\n<h3 id=\"æ‰“å°æ—¥å¿—çš„åŸºæœ¬æ“ä½œâ€”â€”Warn\"><a href=\"#æ‰“å°æ—¥å¿—çš„åŸºæœ¬æ“ä½œâ€”â€”Warn\" class=\"headerlink\" title=\"æ‰“å°æ—¥å¿—çš„åŸºæœ¬æ“ä½œâ€”â€”Warn\"></a>æ‰“å°æ—¥å¿—çš„åŸºæœ¬æ“ä½œâ€”â€”Warn</h3><p><img src=\"https://raw.githubusercontent.com/lyydsheep/pic/main/202409022001108.png\" alt=\"image-20240902200117065\"></p>\n<p>åœ¨æ­¤å¤„æ‰“å°äº†ä¸€ä¸ªWarnæ—¥å¿—ï¼Œå› ä¸ºçŸ­ä¿¡å‘é€é¢‘ç¹æ˜¯<strong>å¶å°”</strong>ä¼šå‘ç”Ÿçš„ï¼Œ<strong>èƒ½å¤Ÿæ¥å—</strong>ã€‚ä½†è¦æ˜¯<strong>é¢‘ç¹å‡ºç°Warn</strong>ï¼Œå°±å¾ˆæœ‰å¯èƒ½æ˜¯æœ‰äººåœ¨æ”»å‡»ç³»ç»Ÿï¼Œé‚£å°±è¦<strong>å‘Šè­¦å¼•èµ·æ³¨æ„äº†</strong></p>\n<h3 id=\"æ‰“å°æ—¥å¿—çš„åŸºæœ¬æ“ä½œâ€”â€”Info\"><a href=\"#æ‰“å°æ—¥å¿—çš„åŸºæœ¬æ“ä½œâ€”â€”Info\" class=\"headerlink\" title=\"æ‰“å°æ—¥å¿—çš„åŸºæœ¬æ“ä½œâ€”â€”Info\"></a>æ‰“å°æ—¥å¿—çš„åŸºæœ¬æ“ä½œâ€”â€”Info</h3><p>Infoæ—¥å¿—ç”¨äºè®°å½•ä¸€äº›<strong>ä¸­æ€§ä¿¡æ¯</strong>ï¼Œä¾‹å¦‚</p>\n<p><img src=\"https://raw.githubusercontent.com/lyydsheep/pic/main/202409022038436.png\" alt=\"image-20240902203836373\"></p>\n<h3 id=\"æ‰“å°æ—¥å¿—çš„åŸºæœ¬æ“ä½œâ€”â€”Debug\"><a href=\"#æ‰“å°æ—¥å¿—çš„åŸºæœ¬æ“ä½œâ€”â€”Debug\" class=\"headerlink\" title=\"æ‰“å°æ—¥å¿—çš„åŸºæœ¬æ“ä½œâ€”â€”Debug\"></a>æ‰“å°æ—¥å¿—çš„åŸºæœ¬æ“ä½œâ€”â€”Debug</h3><p>Debugæ—¥å¿—å¯ä»¥ç”¨äºè®°å½•å’Œç¬¬ä¸‰æ–¹äº¤äº’çš„åŠ¨ä½œ</p>\n<figure class=\"highlight go\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"function\"><span class=\"keyword\">func</span> <span class=\"params\">(s *Service)</span></span> Send(ctx context.Context, tpl <span class=\"type\">string</span>, args []sms.NameData, numbers ...<span class=\"type\">string</span>) <span class=\"type\">error</span> &#123;</span><br><span class=\"line\">\tzap.L().Debug(<span class=\"string\">&quot;avnasio å³å°†å‘é€çŸ­ä¿¡&quot;</span>, zap.String(<span class=\"string\">&quot;tpl&quot;</span>, tpl), zap.Any(<span class=\"string\">&quot;args&quot;</span>, args))</span><br><span class=\"line\">\terr := s.svc.Send(ctx, tpl, args, numbers...)</span><br><span class=\"line\">\t<span class=\"keyword\">if</span> err != <span class=\"literal\">nil</span> &#123;</span><br><span class=\"line\">\t\tzap.L().Debug(<span class=\"string\">&quot;å‘é€çŸ­ä¿¡å‡ºç°å¼‚å¸¸&quot;</span>, zap.Error(err))</span><br><span class=\"line\">\t\t<span class=\"keyword\">return</span> err</span><br><span class=\"line\">\t&#125;</span><br><span class=\"line\">\t<span class=\"keyword\">return</span> err</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n\n<p>å¯ä»¥è€ƒè™‘ä½¿ç”¨è£…é¥°å™¨æ¨¡å¼æ‰©å±•<code>Write()</code>æ–¹æ³•çš„åŠŸèƒ½</p>\n<p>ä¾‹å¦‚ï¼Œè‡ªåŠ¨å°†keyä¸ºphoneçš„å­—æ®µè¿›è¡Œæ•°æ®è„±æ•</p>\n<figure class=\"highlight go\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">type</span> MyCore <span class=\"keyword\">struct</span> &#123;</span><br><span class=\"line\">\tzapcore.Core</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"function\"><span class=\"keyword\">func</span> <span class=\"params\">(c *MyCore)</span></span> Write(e zapcore.Entry, fs []zapcore.Field) <span class=\"type\">error</span> &#123;</span><br><span class=\"line\">\t<span class=\"comment\">// è£…é¥°å™¨æ¨¡å¼ï¼Œè¿›è¡Œæ•°æ®è„±æ•</span></span><br><span class=\"line\">\t<span class=\"keyword\">for</span> _, f := <span class=\"keyword\">range</span> fs &#123;</span><br><span class=\"line\">\t\t<span class=\"keyword\">if</span> f.Key == <span class=\"string\">&quot;phone&quot;</span> &#123;</span><br><span class=\"line\">\t\t\tnumber := f.String</span><br><span class=\"line\">\t\t\tf.String = number[:<span class=\"number\">3</span>] + <span class=\"string\">&quot;****&quot;</span> + number[<span class=\"number\">7</span>:]</span><br><span class=\"line\">\t\t&#125;</span><br><span class=\"line\">\t&#125;</span><br><span class=\"line\">\t<span class=\"keyword\">return</span> c.Core.Write(e, fs)</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n\n\n\n<p>è£…é¥°å™¨æ¨¡å¼å®ç°ä¸€ä¸ªcoreï¼Œèƒ½å¤Ÿè‡ªåŠ¨å°†keyä¸ºphoneçš„å­—æ®µå¯¹åº”çš„å€¼è¿›è¡Œè„±æ•</p>\n<h3 id=\"ä¸ä½¿ç”¨åŒ…å˜é‡â€”â€”ä¿æŒä¾èµ–æ³¨å…¥é£æ ¼\"><a href=\"#ä¸ä½¿ç”¨åŒ…å˜é‡â€”â€”ä¿æŒä¾èµ–æ³¨å…¥é£æ ¼\" class=\"headerlink\" title=\"ä¸ä½¿ç”¨åŒ…å˜é‡â€”â€”ä¿æŒä¾èµ–æ³¨å…¥é£æ ¼\"></a>ä¸ä½¿ç”¨åŒ…å˜é‡â€”â€”ä¿æŒä¾èµ–æ³¨å…¥é£æ ¼</h3><p>æœ‰çš„æ—¶å€™ä¸åŒçš„ä¸šåŠ¡ä¸æ„¿æ„å…±äº«åŒä¸€ä¸ªå…¨å±€çš„loggerï¼Œè¿™ä¸ªæ—¶å€™å°±éœ€è¦åœ¨ä¸åŒåœ°æ–¹åˆ›å»ºå±äºä»–ä»¬è‡ªå·±çš„logger</p>\n<p>ä¸€ä¸ªå¾ˆç›´æ¥çš„æ–¹æ³•å°±æ˜¯åœ¨serviceå±‚æ·»åŠ loggerå­—æ®µï¼Œä¸ºä¸åŒä¸šåŠ¡å¼•å…¥å„è‡ªçš„loggerï¼Œå¹¶ä¸”ä¿æŒç€ä¾èµ–æ³¨å…¥çš„é£æ ¼</p>\n<p><img src=\"https://raw.githubusercontent.com/lyydsheep/pic/main/202409032144169.png\" alt=\"å±å¹•æˆªå›¾ 2024-09-03 214039\"></p>\n<p><img src=\"https://raw.githubusercontent.com/lyydsheep/pic/main/202409032144084.png\"></p>\n<p>è¿˜æœ‰ä¸€ç§æ›´ç®€å•çš„ä¾èµ–æ³¨å…¥æ–¹æ³•ï¼š<strong>æ³¨å…¥äº†ï¼Œä½†æ˜¯æ²¡æœ‰å®Œå…¨æ³¨å…¥</strong></p>\n<p>è¿™ç§åšæ³•çš„å¥½å¤„å°±æ˜¯ï¼Œä¸ºå°†æ¥æ‰©å±•ç•™ä¸‹äº†å¯æ“ä½œçš„ç©ºé—´</p>\n<figure class=\"highlight go\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"function\"><span class=\"keyword\">func</span> <span class=\"title\">NewUserService</span><span class=\"params\">(repo repository.UserRepository)</span></span> UserService &#123;</span><br><span class=\"line\">\t<span class=\"keyword\">return</span> &amp;BasicUserService&#123;</span><br><span class=\"line\">\t\trepo:   repo,</span><br><span class=\"line\">        <span class=\"comment\">// é¢„ç•™äº†å˜åŠ¨çš„ç©ºé—´</span></span><br><span class=\"line\">        logger: zap.L(),</span><br><span class=\"line\">\t&#125;</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n\n<h3 id=\"æŠ½è±¡æ—¥å¿—API\"><a href=\"#æŠ½è±¡æ—¥å¿—API\" class=\"headerlink\" title=\"æŠ½è±¡æ—¥å¿—API\"></a>æŠ½è±¡æ—¥å¿—API</h3><p>åšåˆ°è¿™é‡Œä¸éš¾å‘ç°ï¼Œä¸ç®¡æ˜¯é…ç½®æ¨¡å—ä¹Ÿå¥½ï¼Œæ—¥å¿—æ¨¡å—ä¹Ÿå¥½ï¼Œæˆ‘ä»¬çš„ä»£ç éƒ½å¼ºè€¦åˆviperæ¡†æ¶å’Œzapæ¡†æ¶ã€‚è¿™å°±ä¼šæœ‰æ½œåœ¨çš„é£é™©ï¼šä¸‡ä¸€è¿viperå’Œzapæ¡†æ¶éƒ½æƒ³æ¢æ‰å‘¢ï¼Ÿ</p>\n<p>å› æ­¤ï¼Œæˆ‘ä»¬éœ€è¦å®šä¹‰è‡ªå·±loggeræ¥å£ï¼Œå¼±åŒ–å¯¹zapæ¡†æ¶çš„ä¾èµ–</p>\n<p>å…·ä½“æœ‰ä¸‰ç§é£æ ¼</p>\n<ul>\n<li><pre><code class=\"go\">type Logger interface &#123;\n    Debug(msg string, args...any)\n    Info(msg string, args...any)\n    Warn(msg string, args...any)\n    Error(msg string, args...any)\n&#125;\n\nfunc Example() &#123;\n    var l Logger\n    // åœ¨msgä¸­ç•™æœ‰å ä½ç¬¦\n    l.Info(&quot;ç”¨æˆ·æœªæ³¨å†Œï¼Œç”¨æˆ·ä¿¡æ¯ä¸º %v&quot;, &quot;ababab&quot;)\n&#125;\n<figure class=\"highlight plaintext\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"></span><br><span class=\"line\">- ```go</span><br><span class=\"line\">  type LoggerV1 interface &#123;</span><br><span class=\"line\">  \tDebug(msg string, args ...Field)</span><br><span class=\"line\">  \tInfo(msg string, args ...Field)</span><br><span class=\"line\">  \tWarn(msg string, args ...Field)</span><br><span class=\"line\">  \tError(msg string, args ...Field)</span><br><span class=\"line\">  &#125;</span><br><span class=\"line\">  </span><br><span class=\"line\">  type Field struct &#123;</span><br><span class=\"line\">  \tKey string</span><br><span class=\"line\">  \tVal any</span><br><span class=\"line\">  &#125;</span><br><span class=\"line\">  </span><br><span class=\"line\">  func ExampleV1() &#123;</span><br><span class=\"line\">  \tvar l LoggerV1</span><br><span class=\"line\">  \t// è¾“å‡ºçš„valæœ‰å¯¹åº”çš„keyï¼Œå’Œzapé‡‡ç”¨ç›¸åŒçš„æ¨¡å¼</span><br><span class=\"line\">  \tl.Info(&quot;è¿™ä¸ªmsg&quot;, Field&#123;Key: &quot;è¿™ä¸ªæ˜¯key&quot;, Val: &quot;è¿™ä¸ªæ˜¯Val&quot;&#125;)</span><br><span class=\"line\">  &#125;</span><br><span class=\"line\">  </span><br></pre></td></tr></table></figure>\n</code></pre>\n</li>\n<li><pre><code class=\"go\">// LoggerV2 è¦æ±‚argsçš„ä¸ªæ•°æ˜¯å¶æ•°ï¼Œä»¥key-valå½¢å¼äº¤æ›¿å‡ºç°\ntype LoggerV2 interface &#123;\n    Debug(msg string, args ...any)\n    Info(msg string, args ...any)\n    Warn(msg string, args ...any)\n    Error(msg string, args ...any)\n&#125;\n\nfunc ExampleV2() &#123;\n    var l LoggerV2\n    l.Info(&quot;è¿™æ˜¯msg&quot;, &quot;key&quot;, &quot;val&quot;)\n&#125;\n<figure class=\"highlight plaintext\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br><span class=\"line\">31</span><br><span class=\"line\">32</span><br><span class=\"line\">33</span><br><span class=\"line\">34</span><br><span class=\"line\">35</span><br><span class=\"line\">36</span><br><span class=\"line\">37</span><br><span class=\"line\">38</span><br><span class=\"line\">39</span><br><span class=\"line\">40</span><br><span class=\"line\">41</span><br><span class=\"line\">42</span><br><span class=\"line\">43</span><br><span class=\"line\">44</span><br><span class=\"line\">45</span><br><span class=\"line\">46</span><br><span class=\"line\">47</span><br><span class=\"line\">48</span><br><span class=\"line\">49</span><br><span class=\"line\">50</span><br><span class=\"line\">51</span><br><span class=\"line\">52</span><br><span class=\"line\">53</span><br><span class=\"line\">54</span><br><span class=\"line\">55</span><br><span class=\"line\">56</span><br><span class=\"line\">57</span><br><span class=\"line\">58</span><br><span class=\"line\">59</span><br><span class=\"line\">60</span><br><span class=\"line\">61</span><br><span class=\"line\">62</span><br><span class=\"line\">63</span><br><span class=\"line\">64</span><br><span class=\"line\">65</span><br><span class=\"line\">66</span><br><span class=\"line\">67</span><br><span class=\"line\">68</span><br><span class=\"line\">69</span><br><span class=\"line\">70</span><br><span class=\"line\">71</span><br><span class=\"line\">72</span><br><span class=\"line\">73</span><br><span class=\"line\">74</span><br><span class=\"line\">75</span><br><span class=\"line\">76</span><br><span class=\"line\">77</span><br><span class=\"line\">78</span><br><span class=\"line\">79</span><br><span class=\"line\">80</span><br><span class=\"line\">81</span><br><span class=\"line\">82</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"></span><br><span class=\"line\">- ç¬¬ä¸€ç§é£æ ¼**å…¼å®¹æ€§æœ€å¥½**</span><br><span class=\"line\">- ç¬¬äºŒç§é£æ ¼è®¤åŒ**å‚æ•°å°±åº”è¯¥æœ‰ä¸ªåå­—**</span><br><span class=\"line\">- ç¬¬ä¸‰ç§é£æ ¼**å¦‚æœæœ‰å®Œå–„çš„ä»£ç è¯„å®¡æµç¨‹çš„è¯å¯ä»¥è€ƒè™‘è€ƒè™‘**ï¼Œä¸ç„¶ä¸æ¨è</span><br><span class=\"line\"></span><br><span class=\"line\">### é€‚é…å™¨æ¨¡å¼</span><br><span class=\"line\"></span><br><span class=\"line\">æ—¢ç„¶å·²ç»æŠ½è±¡å‡ºäº†æ—¥å¿—æ¥å£ï¼Œé‚£ä¹ˆå…·ä½“è¯¥å¦‚ä½•å®ç°å‘¢ï¼Ÿ</span><br><span class=\"line\"></span><br><span class=\"line\">ç­”æ¡ˆå°±æ˜¯é‡‡ç”¨**é€‚é…å™¨æ¨¡å¼**</span><br><span class=\"line\"></span><br><span class=\"line\">æ‰€è°“é€‚é…å™¨æ¨¡å¼ï¼Œå°±æ˜¯**å°†ä¸€ä¸ªç±»å‹é€‚é…åˆ°å¦ä¸€ä¸ªæ¥å£ä¸Š**ã€‚ä¾‹å¦‚ï¼Œå°†Aé€‚é…åˆ°Bï¼Œè¿™é‡Œçš„Aå¯ä»¥æ˜¯æ¥å£ï¼Œä¹Ÿå¯ä»¥æ˜¯ä¸€ä¸ªå…·ä½“çš„ç±»å‹</span><br><span class=\"line\"></span><br><span class=\"line\">**å…¸å‹çš„ä½¿ç”¨åœºæ™¯**</span><br><span class=\"line\"></span><br><span class=\"line\">- æœ‰ä¸¤ä¸ªç”¨é€”ç±»ä¼¼ï¼Œä½†æ˜¯ç»†èŠ‚ä¸Šç•¥æœ‰ä¸åŒçš„æ¥å£ï¼Œå°†ä¸€ä¸ªæ¥å£é€‚é…åˆ°å¦ä¸€ä¸ªæ¥å£ä¸Š</span><br><span class=\"line\">- ç”±äºç‰ˆæœ¬è¿­ä»£ï¼Œå‡ºç°äº†ä¸¤ä¸ªæ¥å£ï¼Œéœ€è¦å°†ä¸€ä¸ªæ¥å£é€‚é…åˆ°å¦ä¸€ä¸ªæ¥å£ä¸Š</span><br><span class=\"line\"></span><br><span class=\"line\">**ä¸è£…é¥°å™¨æ¨¡å¼çš„åŒºåˆ«**</span><br><span class=\"line\"></span><br><span class=\"line\">- è£…é¥°å™¨æ¨¡å¼ç”¨äº**æ‰©å±•åŠŸèƒ½**ï¼Œè‡ªå§‹è‡³ç»ˆ**éƒ½æ˜¯ä¸€ä¸ªæ¥å£**</span><br><span class=\"line\">- é€‚é…å™¨æ¨¡å¼**å¿…ç„¶æ˜¯ä¸¤ä¸ªä¸åŒçš„æ¥å£**</span><br><span class=\"line\"></span><br><span class=\"line\">### åˆ©ç”¨Ginçš„middlewareæ‰“å°æ—¥å¿—</span><br><span class=\"line\"></span><br><span class=\"line\">åœ¨handleræ–‡ä»¶ä¸­ï¼Œæœ‰å¾ˆå¤šä¸ªæ–¹æ³•ï¼Œå¦‚æœä¸€ä¸€ä¸ºè¿™äº›æ–¹æ³•æ‰“å°æ—¥å¿—éœ€è¦èŠ±è´¹å¾ˆå¤šæ—¶é—´å’Œç²¾åŠ›</span><br><span class=\"line\"></span><br><span class=\"line\">å¯æ˜¯å‘ç°ï¼Œhandlerä¸­çš„æ–¹æ³•éƒ½æ˜¯ä¸è¯·æ±‚å’Œå“åº”æœ‰å…³çš„ï¼Œé‚£ä¹ˆå°±å¯ä»¥é‡‡ç”¨`AOP`æœºåˆ¶ï¼Œåˆ©ç”¨ginçš„middlewareæ¥ç»Ÿä¸€æ‰“æ—¥å¿—</span><br><span class=\"line\"></span><br><span class=\"line\">#### ä½¿ç”¨builderæ¨¡å¼æ„å»ºä¸­é—´ä»¶</span><br><span class=\"line\"></span><br><span class=\"line\">```go</span><br><span class=\"line\">// å‡ ä¸ªæ³¨æ„ç‚¹ï¼š</span><br><span class=\"line\">// å°å¿ƒæ—¥å¿—å†…å®¹è¿‡å¤šï¼šURLå¯èƒ½å¾ˆé•¿ï¼Œè¯·æ±‚ä½“ã€å“åº”ä½“éƒ½å¯èƒ½ç‰¹åˆ«ç‰¹åˆ«å¤§ï¼Œéœ€è¦è€ƒè™‘æ˜¯å¦è¦è¿›è¡Œæˆªå–</span><br><span class=\"line\">// ç”¨æˆ·å¯èƒ½æ¢ç”¨ä¸åŒçš„æ—¥å¿—æ¡†æ¶ï¼Œæ‰€ä»¥è¦æœ‰è¶³å¤Ÿçš„çµæ´»æ€§</span><br><span class=\"line\">// è€ƒè™‘ç»“åˆviperå®ç°åŠ¨æ€å¼€å…³ï¼Œä½†æ˜¯è¦å°å¿ƒå¹¶å‘å®‰å…¨</span><br><span class=\"line\">func (b *Builder) Build() gin.HandlerFunc &#123;</span><br><span class=\"line\">\treturn func(ctx *gin.Context) &#123;</span><br><span class=\"line\">\t\tstart := time.Now()</span><br><span class=\"line\">\t\tal := AccessLog&#123;&#125;</span><br><span class=\"line\">\t\tal.Method = ctx.Request.Method</span><br><span class=\"line\">\t\tif b.allowURL &amp;&amp; ctx.Request.URL != nil &#123;</span><br><span class=\"line\">\t\t\turl := ctx.Request.URL.String()</span><br><span class=\"line\">\t\t\tif len(url) &gt; 1024 &#123;</span><br><span class=\"line\">\t\t\t\turl = url[:1024]</span><br><span class=\"line\">\t\t\t&#125;</span><br><span class=\"line\">\t\t\tal.URL = url</span><br><span class=\"line\">\t\t&#125;</span><br><span class=\"line\">\t\tif b.allowReqBody &amp;&amp; ctx.Request.Body != nil &#123;</span><br><span class=\"line\">\t\t\t// è¿™é‡Œå¿½ç•¥é”™è¯¯ï¼Œæ¯•ç«Ÿæˆ‘åªæ˜¯æ‰“å°ä¸ªæ—¥å¿—ï¼Œæœ‰é”™è¯¯ä¹Ÿæ— æ‰€è°“äº†</span><br><span class=\"line\">\t\t\tdata, _ := ctx.GetRawData()</span><br><span class=\"line\">\t\t\t// Request.Bodyæ˜¯ä¸€ä¸ªæµå¯¹è±¡ï¼Œè¯»å®Œä¹‹åRequesté‡Œé¢å°±æœ¨æœ‰äº†</span><br><span class=\"line\">\t\t\t// æ‰€ä»¥è¿˜å¾—æŠŠæ•°æ®æ”¾å›Request.Bodyï¼Œä¸ç„¶åç»­æ­¥éª¤å°±è¯»ä¸åˆ°è¿™ä¸ªæ•°æ®äº†</span><br><span class=\"line\">\t\t\tctx.Request.Body = io.NopCloser(bytes.NewBuffer(data))</span><br><span class=\"line\">\t\t\tbody := string(data)</span><br><span class=\"line\">\t\t\tif len(body) &gt; 1024 &#123;</span><br><span class=\"line\">\t\t\t\tal.ReqBody = body</span><br><span class=\"line\">\t\t\t&#125;</span><br><span class=\"line\">\t\t&#125;</span><br><span class=\"line\">\t\t// defer æ‰“æ—¥å¿—ï¼Œå³ä½¿æœ‰panicä¹Ÿä¸ä¼šå½±å“æ—¥å¿—çš„è¾“å‡º</span><br><span class=\"line\">\t\tdefer func() &#123;</span><br><span class=\"line\">\t\t\tal.Duration = time.Since(start).String()</span><br><span class=\"line\">\t\t\t// å…·ä½“æ€ä¹ˆæ‰“å°æ—¥å¿—ï¼Œç”±ç”¨æˆ·å†³å®š</span><br><span class=\"line\">\t\t\tb.logFunc(ctx, al)</span><br><span class=\"line\">\t\t&#125;()</span><br><span class=\"line\">\t\t// æ‰§è¡Œåˆ°ä¸šåŠ¡ä»£ç ï¼ˆä¸æ˜¯å¾ˆæ‡‚ï¼‰</span><br><span class=\"line\">\t\tctx.Next()</span><br><span class=\"line\">\t&#125;</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"></span><br><span class=\"line\">type AccessLog struct &#123;</span><br><span class=\"line\">\t// è¯·æ±‚æ–¹æ³•</span><br><span class=\"line\">\tMethod string</span><br><span class=\"line\">\t// url</span><br><span class=\"line\">\tURL string</span><br><span class=\"line\">\t// è¯·æ±‚ä½“</span><br><span class=\"line\">\tReqBody string</span><br><span class=\"line\">\t// å¤„ç†æ—¶é—´</span><br><span class=\"line\">\tDuration string</span><br><span class=\"line\">\t// å“åº”ä½“</span><br><span class=\"line\">\tRespBody string</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n</code></pre>\n</li>\n</ul>\n<p><strong>ä¸€ä¸ªæœ‰æ„æ€çš„ç‚¹ï¼šä¸ºä»€ä¹ˆè¦è®©ç”¨æˆ·ä¼ è¿›æ¥ä¸€ä¸ªæ‰“æ—¥å¿—çš„æ–¹æ³•å‘¢ï¼Ÿ</strong></p>\n<p>å¦‚æœä¸ä¼ é€’æ–¹æ³•ï¼Œé‚£ä¹ˆåœ¨å®ç°ä¸­ä¸ç®¡æˆ‘ä»¬æ˜¯ç”¨<code>Info()</code>ã€<code>Debug()</code>è¿˜æ˜¯<code>Error()</code>éƒ½æ˜¯å†™æ­»åœ¨ä»£ç ä¸­çš„ï¼Œä¸èƒ½çµæ´»åœ°åº”å¯¹ä¸åŒçš„åœºæ™¯ï¼Œä¾‹å¦‚å¼€å‘ç¯å¢ƒè¦ç”¨<code>Debug()</code>ï¼Œå¯èƒ½çº¿ä¸Šç¯å¢ƒæˆ‘å°±è¦ç”¨<code>Info()</code>äº†</p>\n<p>é‚£ä¹ˆä¸å¦‚å°±è®©ç”¨æˆ·ä¼ è¿›æ¥ä¸€ä¸ªæ–¹æ³•ï¼Œåªä¸ºç”¨æˆ·æä¾›ä¸€ä¸ªæ¥å£ï¼Œå±è”½åº•å±‚çš„å®ç°ï¼Œç”¨æˆ·åªéœ€è¦è€ƒè™‘åœ¨ä¸åŒç¯å¢ƒé€‰æ‹©ä½¿ç”¨ä¸åŒçš„æ–¹æ³•å°±è¡Œäº†</p>\n<h4 id=\"æ‰“å°å“åº”\"><a href=\"#æ‰“å°å“åº”\" class=\"headerlink\" title=\"æ‰“å°å“åº”\"></a>æ‰“å°å“åº”</h4><p>æ­£å¸¸æ¥è¯´ï¼Œæ‰“å°å“åº”å°±åº”è¯¥å’Œä¸Šæ–‡ä¸­æ‰“å°è¯·æ±‚ä¸€æ ·ç®€å•ï¼šç›´æ¥ä»<code>context</code>é‡Œé¢æ‹¿è¯·æ±‚å°±è¡Œ</p>\n<p>ä¸å¹¸çš„æ˜¯ï¼Œ<code>ctx</code>å¹¶æ²¡æœ‰æš´éœ²å‡º<code>Response</code>ï¼Œä¹Ÿå°±æ˜¯ä¸èƒ½ç›´æ¥è¯»å“åº”</p>\n<p>ä½†æ˜¯ï¼Œ<code>ctx</code>æš´éœ²å‡ºäº†<code>ResponseWriter</code>ï¼Œè¿™ä¸ªæ¥å£æ˜¯ç”¨æ¥å†™å“åº”çš„ã€‚é‚£ä¹ˆæˆ‘ä»¬å¯ä»¥â€œ<strong>å·æ¢æ¢æŸ±</strong>â€ï¼Œå°†è¿™ä¸ªæ¥å£æ¢æˆæˆ‘ä»¬è‡ªå·±çš„å®ç°ï¼š<strong>åœ¨å†™å“åº”ä¹‹å‰å°†æ•°æ®ä¿ç•™ä¸‹æ¥ï¼Œè¿™æ ·å°±æœ‰äº†å“åº”çš„å…·ä½“æ•°æ®</strong></p>\n<p>åœ¨è¿™é‡Œæˆ‘ä»¬åªéœ€è¦é‡å†™<code>WriteHeader</code>ã€<code>Write</code>ã€<code>WriteString</code>è¿™ä¸‰ä¸ªæ–¹æ³•ï¼Œæ‰€ä»¥è£…é¥°å™¨æ¨¡å¼åœ¨å®ç°çš„æ—¶å€™å¯ä»¥é‡‡ç”¨ç»„åˆçš„æ–¹å¼</p>\n<ul>\n<li>ç»„åˆ â€”&gt; è£…é¥°éƒ¨åˆ†æ–¹æ³•</li>\n<li>éç»„åˆ â€”&gt; è£…é¥°å…¨éƒ¨æ–¹æ³•</li>\n</ul>\n<figure class=\"highlight go\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">if</span> b.allowRespBody &#123;</span><br><span class=\"line\">\t<span class=\"comment\">// å·æ¢æ¢æŸ±</span></span><br><span class=\"line\">\tctx.Writer = &amp;responseWriter&#123;</span><br><span class=\"line\">\t\tal: &amp;al,</span><br><span class=\"line\">\t\tResponseWriter: ctx.Writer,</span><br><span class=\"line\">\t&#125;</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"keyword\">type</span> responseWriter <span class=\"keyword\">struct</span> &#123;</span><br><span class=\"line\">\t<span class=\"comment\">// è¿™é‡Œç”¨æŒ‡é’ˆï¼Œä¸ºäº†èƒ½ç•™ä½â€œå·â€è¿‡æ¥çš„æ•°æ®</span></span><br><span class=\"line\">\tal *AccessLog</span><br><span class=\"line\">\tgin.ResponseWriter</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"function\"><span class=\"keyword\">func</span> <span class=\"params\">(r *responseWriter)</span></span> WriteString(data <span class=\"type\">string</span>) (<span class=\"type\">int</span>, <span class=\"type\">error</span>) &#123;</span><br><span class=\"line\">\tr.al.RespBody = data</span><br><span class=\"line\">\t<span class=\"keyword\">return</span> r.ResponseWriter.WriteString(data)</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"function\"><span class=\"keyword\">func</span> <span class=\"params\">(r *responseWriter)</span></span> Write(data []<span class=\"type\">byte</span>) (<span class=\"type\">int</span>, <span class=\"type\">error</span>) &#123;</span><br><span class=\"line\">\tr.al.RespBody = <span class=\"type\">string</span>(data)</span><br><span class=\"line\">\t<span class=\"keyword\">return</span> r.ResponseWriter.Write(data)</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"function\"><span class=\"keyword\">func</span> <span class=\"params\">(r *responseWriter)</span></span> WriteHeader(statusCode <span class=\"type\">int</span>) &#123;</span><br><span class=\"line\">\tr.al.Status = statusCode</span><br><span class=\"line\">\tr.ResponseWriter.WriteHeader(statusCode)</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n\n<h3 id=\"GORMæ‰“å°æ—¥å¿—\"><a href=\"#GORMæ‰“å°æ—¥å¿—\" class=\"headerlink\" title=\"GORMæ‰“å°æ—¥å¿—\"></a>GORMæ‰“å°æ—¥å¿—</h3><p>ç›´æ¥ä¸Šä»£ç ï¼š</p>\n<figure class=\"highlight go\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br><span class=\"line\">31</span><br><span class=\"line\">32</span><br><span class=\"line\">33</span><br><span class=\"line\">34</span><br><span class=\"line\">35</span><br><span class=\"line\">36</span><br><span class=\"line\">37</span><br><span class=\"line\">38</span><br><span class=\"line\">39</span><br><span class=\"line\">40</span><br><span class=\"line\">41</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\">// è¡ç”Ÿç±»å‹ï¼Œæœ‰ç‚¹åƒé€‚é…å™¨æ¨¡å¼</span></span><br><span class=\"line\"><span class=\"keyword\">type</span> gormLoggerFunc <span class=\"function\"><span class=\"keyword\">func</span><span class=\"params\">(msg <span class=\"type\">string</span>, fields ...zap.Field)</span></span></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\">// Printf å®ç°å•æ¥å£</span></span><br><span class=\"line\"><span class=\"function\"><span class=\"keyword\">func</span> <span class=\"params\">(g gormLoggerFunc)</span></span> Printf(msg <span class=\"type\">string</span>, fields ...<span class=\"keyword\">interface</span>&#123;&#125;) &#123;</span><br><span class=\"line\">\tg(msg, zap.Any(<span class=\"string\">&quot;args&quot;</span>, fields))</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"></span><br><span class=\"line\"></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"function\"><span class=\"keyword\">func</span> <span class=\"title\">InitDB</span><span class=\"params\">(l *zap.Logger)</span></span> *gorm.DB &#123;</span><br><span class=\"line\">\t<span class=\"keyword\">type</span> Config <span class=\"keyword\">struct</span> &#123;</span><br><span class=\"line\">\t\tDSN <span class=\"type\">string</span> <span class=\"string\">`yaml:&quot;dsn&quot;`</span></span><br><span class=\"line\">\t&#125;</span><br><span class=\"line\">\t<span class=\"keyword\">var</span> config Config</span><br><span class=\"line\">\tconfig.DSN = <span class=\"string\">&quot;abab&quot;</span></span><br><span class=\"line\">\terr := viper.UnmarshalKey(<span class=\"string\">&quot;db&quot;</span>, &amp;config)</span><br><span class=\"line\">\t<span class=\"keyword\">if</span> err != <span class=\"literal\">nil</span> &#123;</span><br><span class=\"line\">\t\t<span class=\"built_in\">panic</span>(err)</span><br><span class=\"line\">\t&#125;</span><br><span class=\"line\">\tdb, err := gorm.Open(mysql.Open(config.DSN), &amp;gorm.Config&#123;</span><br><span class=\"line\">\t\t<span class=\"comment\">// å¼ºåˆ¶ç±»å‹è½¬æ¢</span></span><br><span class=\"line\">\t\tLogger: logger.New(gormLoggerFunc(l.Debug), logger.Config&#123;</span><br><span class=\"line\">\t\t\t<span class=\"comment\">// æ…¢æŸ¥è¯¢é˜ˆå€¼ï¼Œåªæœ‰è¯­å¥æ‰§è¡Œæ—¶é—´è¶…è¿‡è¿™ä¸ªé˜ˆå€¼æ‰ä¼šæ‰“å°æ—¥å¿—</span></span><br><span class=\"line\">            <span class=\"comment\">// ä¸€èˆ¬ä¸º50ms 100msï¼Œä¸€æ¬¡ç£ç›˜ioæ“ä½œå¤§æ¦‚æ˜¯10ms</span></span><br><span class=\"line\">\t\t\tSlowThreshold:             time.Millisecond * <span class=\"number\">10</span>,</span><br><span class=\"line\">\t\t\tLogLevel:                  logger.Info,</span><br><span class=\"line\">\t\t\tIgnoreRecordNotFoundError: <span class=\"literal\">true</span>,</span><br><span class=\"line\">\t\t\tParameterizedQueries:      <span class=\"literal\">true</span>,</span><br><span class=\"line\">\t\t&#125;),</span><br><span class=\"line\">\t&#125;)</span><br><span class=\"line\">\t<span class=\"keyword\">if</span> err != <span class=\"literal\">nil</span> &#123;</span><br><span class=\"line\">\t\t<span class=\"built_in\">panic</span>(err)</span><br><span class=\"line\">\t&#125;</span><br><span class=\"line\">\terr = dao.InitTable(db)</span><br><span class=\"line\">\t<span class=\"keyword\">if</span> err != <span class=\"literal\">nil</span> &#123;</span><br><span class=\"line\">\t\t<span class=\"built_in\">panic</span>(err)</span><br><span class=\"line\">\t&#125;</span><br><span class=\"line\">\t<span class=\"keyword\">return</span> db</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"></span><br></pre></td></tr></table></figure>\n\n<p>gormå·²ç»ä¸ºæˆ‘ä»¬æä¾›äº†æœ‰å…³æ—¥å¿—çš„é…ç½®ï¼Œæ‰€ä»¥æˆ‘ä»¬å¯ä»¥ç›´æ¥ä½¿ç”¨é…ç½®å®ç°æ‰“æ—¥å¿—åŠŸèƒ½</p>\n<p>è¿™é‡Œæœ‰ä¸ªå°é—®é¢˜ï¼Œ<code>logger.New()</code>æ–¹æ³•çš„ç¬¬ä¸€ä¸ªå‚æ•°è¦æ±‚ä¼ å…¥<code>Writer</code>æ¥å£çš„å®ç°ï¼Œè¿™ä¸ªå®ç°å°†ä¼šç”¨æ¥è¾“å‡ºæ—¥å¿—</p>\n<p><img src=\"https://raw.githubusercontent.com/lyydsheep/pic/main/202409071637525.png\" alt=\"image-20240907163634983\"></p>\n<p>é‚£ä¹ˆç°åœ¨å°±æ˜¯éœ€è¦å°†æˆ‘ä»¬è‡ªå·±å®ç°çš„æ—¥å¿—æ¥å£é€‚é…åˆ°gormçš„<code>Writer</code>æ¥å£ä¸Š</p>\n<p>å¥½å·§ä¸å·§ï¼Œ<code>Writer</code>æ¥å£åªæœ‰ä¸€ä¸ªæ–¹æ³•ï¼Œé‚£ä¹ˆå°±å¯ä»¥ç”¨ä¸Š<strong>è¡ç”Ÿå‡½æ•°+å‡½æ•°å®ç°å•æ¥å£</strong>æŠ€å·§ï¼Œå¿«é€Ÿå°†æˆ‘ä»¬çš„æ—¥å¿—æ¥å£é€‚é…åˆ°æ­¤å¤„</p>\n<p>è¿™å°±æ˜¯ä¸ºä»€ä¹ˆæˆ‘ä»¬çš„è¡ç”Ÿå‡½æ•°çš„åŸç±»å‹æ˜¯<code>func(msg string, fields...zap.Field)</code>ï¼Œè¿™æ­£æ˜¯<code>l.Debug()</code>æ–¹æ³•çš„å‡½æ•°ç±»å‹å•Š</p>\n<p>æœ€åä¼ å…¥<code>Writer</code>æ¥å£çš„æ—¶å€™ï¼Œåˆ©ç”¨è¡ç”Ÿç±»å‹å°†<code>l.Debug()</code>å¼ºåˆ¶ç±»å‹è½¬æ¢ï¼Œä½¿å…¶é—´æ¥åœ°å®ç°äº†<code>Writer</code>æ¥å£çš„åŒæ—¶ï¼ŒæœªåŠ¨æˆ‘ä»¬è‡ªå·±çš„æ¥å£åˆ†æ¯«</p>\n","excerpt":"","more":"<h1 id=\"æ¥å…¥æ—¥å¿—æ¨¡å—\"><a href=\"#æ¥å…¥æ—¥å¿—æ¨¡å—\" class=\"headerlink\" title=\"æ¥å…¥æ—¥å¿—æ¨¡å—\"></a>æ¥å…¥æ—¥å¿—æ¨¡å—</h1><h2 id=\"æ—¥å¿—é€šç”¨ç†è®º\"><a href=\"#æ—¥å¿—é€šç”¨ç†è®º\" class=\"headerlink\" title=\"æ—¥å¿—é€šç”¨ç†è®º\"></a>æ—¥å¿—é€šç”¨ç†è®º</h2><h3 id=\"çº§åˆ«\"><a href=\"#çº§åˆ«\" class=\"headerlink\" title=\"çº§åˆ«\"></a>çº§åˆ«</h3><p><strong>DEBUG</strong>ï¼šè®°å½•ä¸€äº›è¾…åŠ©æ’æŸ¥é—®é¢˜çš„ä¿¡æ¯ã€‚ä¸€èˆ¬ä¸ä¼šåœ¨çº¿ä¸Šä½¿ç”¨</p>\n<p><strong>INFO</strong>ï¼šä¸­æ€§åœ°æè¿°å‘é€äº†ä»€ä¹ˆã€‚çº¿ä¸Šä¸€èˆ¬éƒ½æ˜¯ç”¨è¿™ä¸ªçº§åˆ«</p>\n<p><strong>WARN</strong>ï¼šç³»ç»Ÿå‘ç”Ÿäº†ä¸€äº›ä¸å¥½ä½†æ˜¯èƒ½å¤Ÿå®¹å¿çš„äº‹æƒ…ã€‚è‡³å°‘ä¼šæ‰“å°è¿™ä¸ªçº§åˆ«çš„æ—¥å¿—</p>\n<p><strong>ERROR</strong>ï¼šç³»ç»Ÿå‘ç”Ÿäº†ä¸€äº›éœ€è¦ä¿æŒå…³æ³¨çš„äº‹æƒ…</p>\n<h3 id=\"ä»€ä¹ˆæ—¶å€™æ‰“æ—¥å¿—ï¼Ÿæ‰“ä»€ä¹ˆçº§åˆ«ï¼Ÿ\"><a href=\"#ä»€ä¹ˆæ—¶å€™æ‰“æ—¥å¿—ï¼Ÿæ‰“ä»€ä¹ˆçº§åˆ«ï¼Ÿ\" class=\"headerlink\" title=\"ä»€ä¹ˆæ—¶å€™æ‰“æ—¥å¿—ï¼Ÿæ‰“ä»€ä¹ˆçº§åˆ«ï¼Ÿ\"></a>ä»€ä¹ˆæ—¶å€™æ‰“æ—¥å¿—ï¼Ÿæ‰“ä»€ä¹ˆçº§åˆ«ï¼Ÿ</h3><p>ä¸¤ä¸ªåŸåˆ™</p>\n<ul>\n<li><strong>å¦‚æœæ€€ç–‘æŸä¸ªåœ°æ–¹è¦ä¸è¦æ‰“æ—¥å¿—ï¼Œé‚£å°±æ‰“ä¸Š</strong></li>\n<li><strong>å®æ»¥å‹¿ç¼ºï¼Œå®æ„¿å¤šæ‰“ä¸€äº›æ—¥å¿—ï¼Œä¹Ÿä¸è¦å·æ‡’</strong></li>\n</ul>\n<p>å‰äººçš„ç»éªŒ</p>\n<ul>\n<li><strong>ç»Ÿä¸€åˆ©ç”¨AOPæœºåˆ¶ï¼Œè®°å½•ä»»ä½•ä¸ç¬¬ä¸‰æ–¹æ‰“äº¤é“çš„è¯·æ±‚ä¸å“åº”</strong>ï¼ŒåŒ…æ‹¬æ•°æ®åº“ã€ç¼“å­˜ã€RPCè°ƒç”¨ï¼Œä½¿ç”¨<strong>DEBUG</strong>çº§åˆ«è®°å½•æ—¥å¿—</li>\n<li><strong>ç»Ÿä¸€åˆ©ç”¨AOPæœºåˆ¶ï¼Œè®°å½•ç³»ç»Ÿæ¥æ”¶çš„è¯·æ±‚ä¸æ”¾å›çš„å“åº”</strong>ï¼Œä½¿ç”¨<strong>DEBUG</strong>çº§åˆ«</li>\n<li>åœ¨å¼€å‘é˜¶æ®µï¼Œä½¿ç”¨<strong>DEBUG</strong>çº§åˆ«è®°å½•ä¸­é—´<strong>æµç¨‹ä¸­çš„å…³é”®ç»“æœ</strong></li>\n<li>æ€€ç–‘ç³»ç»Ÿå¯èƒ½æœ‰é—®é¢˜ï¼Œä½†æ˜¯é—®é¢˜åˆä¸å¤§ï¼Œè®°å½•WARN</li>\n<li>ä»»ä½•ä¸å¯èƒ½å‡ºç°é—®é¢˜ï¼Œæˆ–è€…è¡¨è¾¾<strong>æœ‰äººæ”»å‡»ç³»ç»Ÿ</strong>çš„åœ°æ–¹ï¼Œè®°å½•<strong>ERROR</strong></li>\n</ul>\n<h2 id=\"æ¥å…¥æ—¥å¿—æ¨¡å—-1\"><a href=\"#æ¥å…¥æ—¥å¿—æ¨¡å—-1\" class=\"headerlink\" title=\"æ¥å…¥æ—¥å¿—æ¨¡å—\"></a>æ¥å…¥æ—¥å¿—æ¨¡å—</h2><p>åœ¨Goé‡Œé¢ï¼Œå¯ä»¥ä½¿ç”¨zapä½œä¸ºæ—¥å¿—æ¡†æ¶</p>\n<p><a href=\"https://github.com/uber-go/zap\">uber-go&#x2F;zap: Blazing fast, structured, leveled logging in Go. (github.com)</a></p>\n<p><strong>åˆå§‹åŒ–æ–¹æ³•ï¼š</strong></p>\n<ul>\n<li>ç›´æ¥è®¾ç½®ä¸€ä¸ªå…¨å±€çš„loggerå³å¯</li>\n</ul>\n<figure class=\"highlight go\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">logger, err := zap.NewDevelopment()</span><br><span class=\"line\"><span class=\"keyword\">if</span> err != <span class=\"literal\">nil</span> &#123;</span><br><span class=\"line\">\t<span class=\"built_in\">panic</span>(err)</span><br><span class=\"line\">&#125;</span><br><span class=\"line\">zap.ReplaceGlobals(logger)</span><br></pre></td></tr></table></figure>\n\n<p>zapä¸­å«æœ‰ä¸€ä¸ªå…¨å±€çš„<code>globalL</code>å˜é‡ï¼Œä½†æ˜¯è¿™ä¸ªå…¨å±€å˜é‡ä»€ä¹ˆåŠŸèƒ½éƒ½æœ¨æœ‰å®ç°ï¼Œä¹Ÿå°±æ˜¯è¯´ï¼Œå®ƒè¿æ‰“å°æ—¥å¿—çš„åŠŸèƒ½éƒ½æ²¡æœ‰</p>\n<p><img src=\"https://raw.githubusercontent.com/lyydsheep/pic/main/202409021939910.png\" alt=\"å±å¹•æˆªå›¾ 2024-09-02 193645\"></p>\n<p>å› æ­¤éœ€è¦ä½¿ç”¨<code>NewDevelopment()</code>æ–¹æ³•åˆ›å»ºä¸€ä¸ªå¯ä»¥ä½¿ç”¨çš„<code>logger</code>å¹¶æ›¿æ¢æ‰å…¨å±€å˜é‡çš„åˆå§‹å€¼</p>\n<p><img src=\"https://raw.githubusercontent.com/lyydsheep/pic/main/202409021939433.png\" alt=\"å±å¹•æˆªå›¾ 2024-09-02 193655\"></p>\n<h3 id=\"æ‰“å°æ—¥å¿—çš„åŸºæœ¬æ“ä½œâ€”â€”Error\"><a href=\"#æ‰“å°æ—¥å¿—çš„åŸºæœ¬æ“ä½œâ€”â€”Error\" class=\"headerlink\" title=\"æ‰“å°æ—¥å¿—çš„åŸºæœ¬æ“ä½œâ€”â€”Error\"></a>æ‰“å°æ—¥å¿—çš„åŸºæœ¬æ“ä½œâ€”â€”Error</h3><p>å½“å‡ºç°åƒæ˜¯ç³»ç»Ÿé”™è¯¯æ—¶ï¼Œå°±èƒ½æ‰“å°Errorçº§åˆ«çš„æ—¥å¿—</p>\n<figure class=\"highlight go\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">if</span> err != <span class=\"literal\">nil</span> &#123;</span><br><span class=\"line\">\tctx.JSON(http.StatusOK, Result&#123;Code: <span class=\"number\">5</span>, Msg: <span class=\"string\">&quot;ç³»ç»Ÿé”™è¯¯&quot;</span>&#125;)</span><br><span class=\"line\">\tzap.L().Error(<span class=\"string\">&quot;vcxnq[nzvx ç”¨æˆ·æ‰‹æœºå·ç ç™»å½•å¤±è´¥&quot;</span>, zap.Error(err))</span><br><span class=\"line\">\t<span class=\"keyword\">return</span></span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n\n<p>æ‰“å°æ—¥å¿—ä¸ä»…èƒ½ä¼ å…¥msgä¿¡æ¯ï¼Œè¿˜èƒ½å¤Ÿä¼ å…¥ä¸€äº›<code>error</code>ã€<code>int</code>ä¹‹ç±»çš„å­—æ®µï¼Œæœ€ç»ˆæ‰“å°ç»“æœå½¢å¦‚ä¸‹å›¾ï¼š</p>\n<p><img src=\"https://raw.githubusercontent.com/lyydsheep/pic/main/202409021953667.png\" alt=\"å±å¹•æˆªå›¾ 2024-09-02 194610\"></p>\n<p>æ³¨æ„å‡ ä¸ªç»†èŠ‚ï¼š</p>\n<ul>\n<li>æ•æ„Ÿæ•°æ®ï¼ˆä¾‹å¦‚æ‰‹æœºå·ç ï¼‰ä¸èƒ½æ‰“å…¥æ—¥å¿—ï¼Œå‹‰å¼ºèƒ½å¤Ÿæ¥å—ä½¿ç”¨debugçº§åˆ«æ‰“å°æ•æ„Ÿæ•°æ®ç”¨äºæœ¬åœ°å¼€å‘</li>\n<li>msgè¦æœ‰è¶³å¤Ÿå®šä½bugå‡ºå¤„çš„ä¿¡æ¯ï¼Œä¾‹å¦‚åœ¨æ—¥å¿—ä¸­ç”¨ä¸€æ®µä¹±ç å”¯ä¸€æ ‡è¯†æ—¥å¿—ï¼Œè¿™æ ·åªéœ€è¦å…¨å±€æ£€ç´¢è¿™æ®µä¹±ç å°±èƒ½æ‰¾åˆ°å‡ºé”™çš„ä½ç½®</li>\n<li>ç»å¯¹ä¸èƒ½æŠŠerrorè¿”å›ç»™å‰ç«¯ï¼Œæš´éœ²ç»™ç”¨æˆ·</li>\n</ul>\n<h3 id=\"æ‰“å°æ—¥å¿—çš„åŸºæœ¬æ“ä½œâ€”â€”Warn\"><a href=\"#æ‰“å°æ—¥å¿—çš„åŸºæœ¬æ“ä½œâ€”â€”Warn\" class=\"headerlink\" title=\"æ‰“å°æ—¥å¿—çš„åŸºæœ¬æ“ä½œâ€”â€”Warn\"></a>æ‰“å°æ—¥å¿—çš„åŸºæœ¬æ“ä½œâ€”â€”Warn</h3><p><img src=\"https://raw.githubusercontent.com/lyydsheep/pic/main/202409022001108.png\" alt=\"image-20240902200117065\"></p>\n<p>åœ¨æ­¤å¤„æ‰“å°äº†ä¸€ä¸ªWarnæ—¥å¿—ï¼Œå› ä¸ºçŸ­ä¿¡å‘é€é¢‘ç¹æ˜¯<strong>å¶å°”</strong>ä¼šå‘ç”Ÿçš„ï¼Œ<strong>èƒ½å¤Ÿæ¥å—</strong>ã€‚ä½†è¦æ˜¯<strong>é¢‘ç¹å‡ºç°Warn</strong>ï¼Œå°±å¾ˆæœ‰å¯èƒ½æ˜¯æœ‰äººåœ¨æ”»å‡»ç³»ç»Ÿï¼Œé‚£å°±è¦<strong>å‘Šè­¦å¼•èµ·æ³¨æ„äº†</strong></p>\n<h3 id=\"æ‰“å°æ—¥å¿—çš„åŸºæœ¬æ“ä½œâ€”â€”Info\"><a href=\"#æ‰“å°æ—¥å¿—çš„åŸºæœ¬æ“ä½œâ€”â€”Info\" class=\"headerlink\" title=\"æ‰“å°æ—¥å¿—çš„åŸºæœ¬æ“ä½œâ€”â€”Info\"></a>æ‰“å°æ—¥å¿—çš„åŸºæœ¬æ“ä½œâ€”â€”Info</h3><p>Infoæ—¥å¿—ç”¨äºè®°å½•ä¸€äº›<strong>ä¸­æ€§ä¿¡æ¯</strong>ï¼Œä¾‹å¦‚</p>\n<p><img src=\"https://raw.githubusercontent.com/lyydsheep/pic/main/202409022038436.png\" alt=\"image-20240902203836373\"></p>\n<h3 id=\"æ‰“å°æ—¥å¿—çš„åŸºæœ¬æ“ä½œâ€”â€”Debug\"><a href=\"#æ‰“å°æ—¥å¿—çš„åŸºæœ¬æ“ä½œâ€”â€”Debug\" class=\"headerlink\" title=\"æ‰“å°æ—¥å¿—çš„åŸºæœ¬æ“ä½œâ€”â€”Debug\"></a>æ‰“å°æ—¥å¿—çš„åŸºæœ¬æ“ä½œâ€”â€”Debug</h3><p>Debugæ—¥å¿—å¯ä»¥ç”¨äºè®°å½•å’Œç¬¬ä¸‰æ–¹äº¤äº’çš„åŠ¨ä½œ</p>\n<figure class=\"highlight go\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"function\"><span class=\"keyword\">func</span> <span class=\"params\">(s *Service)</span></span> Send(ctx context.Context, tpl <span class=\"type\">string</span>, args []sms.NameData, numbers ...<span class=\"type\">string</span>) <span class=\"type\">error</span> &#123;</span><br><span class=\"line\">\tzap.L().Debug(<span class=\"string\">&quot;avnasio å³å°†å‘é€çŸ­ä¿¡&quot;</span>, zap.String(<span class=\"string\">&quot;tpl&quot;</span>, tpl), zap.Any(<span class=\"string\">&quot;args&quot;</span>, args))</span><br><span class=\"line\">\terr := s.svc.Send(ctx, tpl, args, numbers...)</span><br><span class=\"line\">\t<span class=\"keyword\">if</span> err != <span class=\"literal\">nil</span> &#123;</span><br><span class=\"line\">\t\tzap.L().Debug(<span class=\"string\">&quot;å‘é€çŸ­ä¿¡å‡ºç°å¼‚å¸¸&quot;</span>, zap.Error(err))</span><br><span class=\"line\">\t\t<span class=\"keyword\">return</span> err</span><br><span class=\"line\">\t&#125;</span><br><span class=\"line\">\t<span class=\"keyword\">return</span> err</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n\n<p>å¯ä»¥è€ƒè™‘ä½¿ç”¨è£…é¥°å™¨æ¨¡å¼æ‰©å±•<code>Write()</code>æ–¹æ³•çš„åŠŸèƒ½</p>\n<p>ä¾‹å¦‚ï¼Œè‡ªåŠ¨å°†keyä¸ºphoneçš„å­—æ®µè¿›è¡Œæ•°æ®è„±æ•</p>\n<figure class=\"highlight go\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">type</span> MyCore <span class=\"keyword\">struct</span> &#123;</span><br><span class=\"line\">\tzapcore.Core</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"function\"><span class=\"keyword\">func</span> <span class=\"params\">(c *MyCore)</span></span> Write(e zapcore.Entry, fs []zapcore.Field) <span class=\"type\">error</span> &#123;</span><br><span class=\"line\">\t<span class=\"comment\">// è£…é¥°å™¨æ¨¡å¼ï¼Œè¿›è¡Œæ•°æ®è„±æ•</span></span><br><span class=\"line\">\t<span class=\"keyword\">for</span> _, f := <span class=\"keyword\">range</span> fs &#123;</span><br><span class=\"line\">\t\t<span class=\"keyword\">if</span> f.Key == <span class=\"string\">&quot;phone&quot;</span> &#123;</span><br><span class=\"line\">\t\t\tnumber := f.String</span><br><span class=\"line\">\t\t\tf.String = number[:<span class=\"number\">3</span>] + <span class=\"string\">&quot;****&quot;</span> + number[<span class=\"number\">7</span>:]</span><br><span class=\"line\">\t\t&#125;</span><br><span class=\"line\">\t&#125;</span><br><span class=\"line\">\t<span class=\"keyword\">return</span> c.Core.Write(e, fs)</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n\n\n\n<p>è£…é¥°å™¨æ¨¡å¼å®ç°ä¸€ä¸ªcoreï¼Œèƒ½å¤Ÿè‡ªåŠ¨å°†keyä¸ºphoneçš„å­—æ®µå¯¹åº”çš„å€¼è¿›è¡Œè„±æ•</p>\n<h3 id=\"ä¸ä½¿ç”¨åŒ…å˜é‡â€”â€”ä¿æŒä¾èµ–æ³¨å…¥é£æ ¼\"><a href=\"#ä¸ä½¿ç”¨åŒ…å˜é‡â€”â€”ä¿æŒä¾èµ–æ³¨å…¥é£æ ¼\" class=\"headerlink\" title=\"ä¸ä½¿ç”¨åŒ…å˜é‡â€”â€”ä¿æŒä¾èµ–æ³¨å…¥é£æ ¼\"></a>ä¸ä½¿ç”¨åŒ…å˜é‡â€”â€”ä¿æŒä¾èµ–æ³¨å…¥é£æ ¼</h3><p>æœ‰çš„æ—¶å€™ä¸åŒçš„ä¸šåŠ¡ä¸æ„¿æ„å…±äº«åŒä¸€ä¸ªå…¨å±€çš„loggerï¼Œè¿™ä¸ªæ—¶å€™å°±éœ€è¦åœ¨ä¸åŒåœ°æ–¹åˆ›å»ºå±äºä»–ä»¬è‡ªå·±çš„logger</p>\n<p>ä¸€ä¸ªå¾ˆç›´æ¥çš„æ–¹æ³•å°±æ˜¯åœ¨serviceå±‚æ·»åŠ loggerå­—æ®µï¼Œä¸ºä¸åŒä¸šåŠ¡å¼•å…¥å„è‡ªçš„loggerï¼Œå¹¶ä¸”ä¿æŒç€ä¾èµ–æ³¨å…¥çš„é£æ ¼</p>\n<p><img src=\"https://raw.githubusercontent.com/lyydsheep/pic/main/202409032144169.png\" alt=\"å±å¹•æˆªå›¾ 2024-09-03 214039\"></p>\n<p><img src=\"https://raw.githubusercontent.com/lyydsheep/pic/main/202409032144084.png\"></p>\n<p>è¿˜æœ‰ä¸€ç§æ›´ç®€å•çš„ä¾èµ–æ³¨å…¥æ–¹æ³•ï¼š<strong>æ³¨å…¥äº†ï¼Œä½†æ˜¯æ²¡æœ‰å®Œå…¨æ³¨å…¥</strong></p>\n<p>è¿™ç§åšæ³•çš„å¥½å¤„å°±æ˜¯ï¼Œä¸ºå°†æ¥æ‰©å±•ç•™ä¸‹äº†å¯æ“ä½œçš„ç©ºé—´</p>\n<figure class=\"highlight go\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"function\"><span class=\"keyword\">func</span> <span class=\"title\">NewUserService</span><span class=\"params\">(repo repository.UserRepository)</span></span> UserService &#123;</span><br><span class=\"line\">\t<span class=\"keyword\">return</span> &amp;BasicUserService&#123;</span><br><span class=\"line\">\t\trepo:   repo,</span><br><span class=\"line\">        <span class=\"comment\">// é¢„ç•™äº†å˜åŠ¨çš„ç©ºé—´</span></span><br><span class=\"line\">        logger: zap.L(),</span><br><span class=\"line\">\t&#125;</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n\n<h3 id=\"æŠ½è±¡æ—¥å¿—API\"><a href=\"#æŠ½è±¡æ—¥å¿—API\" class=\"headerlink\" title=\"æŠ½è±¡æ—¥å¿—API\"></a>æŠ½è±¡æ—¥å¿—API</h3><p>åšåˆ°è¿™é‡Œä¸éš¾å‘ç°ï¼Œä¸ç®¡æ˜¯é…ç½®æ¨¡å—ä¹Ÿå¥½ï¼Œæ—¥å¿—æ¨¡å—ä¹Ÿå¥½ï¼Œæˆ‘ä»¬çš„ä»£ç éƒ½å¼ºè€¦åˆviperæ¡†æ¶å’Œzapæ¡†æ¶ã€‚è¿™å°±ä¼šæœ‰æ½œåœ¨çš„é£é™©ï¼šä¸‡ä¸€è¿viperå’Œzapæ¡†æ¶éƒ½æƒ³æ¢æ‰å‘¢ï¼Ÿ</p>\n<p>å› æ­¤ï¼Œæˆ‘ä»¬éœ€è¦å®šä¹‰è‡ªå·±loggeræ¥å£ï¼Œå¼±åŒ–å¯¹zapæ¡†æ¶çš„ä¾èµ–</p>\n<p>å…·ä½“æœ‰ä¸‰ç§é£æ ¼</p>\n<ul>\n<li><pre><code class=\"go\">type Logger interface &#123;\n    Debug(msg string, args...any)\n    Info(msg string, args...any)\n    Warn(msg string, args...any)\n    Error(msg string, args...any)\n&#125;\n\nfunc Example() &#123;\n    var l Logger\n    // åœ¨msgä¸­ç•™æœ‰å ä½ç¬¦\n    l.Info(&quot;ç”¨æˆ·æœªæ³¨å†Œï¼Œç”¨æˆ·ä¿¡æ¯ä¸º %v&quot;, &quot;ababab&quot;)\n&#125;\n<figure class=\"highlight plaintext\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"></span><br><span class=\"line\">- ```go</span><br><span class=\"line\">  type LoggerV1 interface &#123;</span><br><span class=\"line\">  \tDebug(msg string, args ...Field)</span><br><span class=\"line\">  \tInfo(msg string, args ...Field)</span><br><span class=\"line\">  \tWarn(msg string, args ...Field)</span><br><span class=\"line\">  \tError(msg string, args ...Field)</span><br><span class=\"line\">  &#125;</span><br><span class=\"line\">  </span><br><span class=\"line\">  type Field struct &#123;</span><br><span class=\"line\">  \tKey string</span><br><span class=\"line\">  \tVal any</span><br><span class=\"line\">  &#125;</span><br><span class=\"line\">  </span><br><span class=\"line\">  func ExampleV1() &#123;</span><br><span class=\"line\">  \tvar l LoggerV1</span><br><span class=\"line\">  \t// è¾“å‡ºçš„valæœ‰å¯¹åº”çš„keyï¼Œå’Œzapé‡‡ç”¨ç›¸åŒçš„æ¨¡å¼</span><br><span class=\"line\">  \tl.Info(&quot;è¿™ä¸ªmsg&quot;, Field&#123;Key: &quot;è¿™ä¸ªæ˜¯key&quot;, Val: &quot;è¿™ä¸ªæ˜¯Val&quot;&#125;)</span><br><span class=\"line\">  &#125;</span><br><span class=\"line\">  </span><br></pre></td></tr></table></figure>\n</code></pre>\n</li>\n<li><pre><code class=\"go\">// LoggerV2 è¦æ±‚argsçš„ä¸ªæ•°æ˜¯å¶æ•°ï¼Œä»¥key-valå½¢å¼äº¤æ›¿å‡ºç°\ntype LoggerV2 interface &#123;\n    Debug(msg string, args ...any)\n    Info(msg string, args ...any)\n    Warn(msg string, args ...any)\n    Error(msg string, args ...any)\n&#125;\n\nfunc ExampleV2() &#123;\n    var l LoggerV2\n    l.Info(&quot;è¿™æ˜¯msg&quot;, &quot;key&quot;, &quot;val&quot;)\n&#125;\n<figure class=\"highlight plaintext\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br><span class=\"line\">31</span><br><span class=\"line\">32</span><br><span class=\"line\">33</span><br><span class=\"line\">34</span><br><span class=\"line\">35</span><br><span class=\"line\">36</span><br><span class=\"line\">37</span><br><span class=\"line\">38</span><br><span class=\"line\">39</span><br><span class=\"line\">40</span><br><span class=\"line\">41</span><br><span class=\"line\">42</span><br><span class=\"line\">43</span><br><span class=\"line\">44</span><br><span class=\"line\">45</span><br><span class=\"line\">46</span><br><span class=\"line\">47</span><br><span class=\"line\">48</span><br><span class=\"line\">49</span><br><span class=\"line\">50</span><br><span class=\"line\">51</span><br><span class=\"line\">52</span><br><span class=\"line\">53</span><br><span class=\"line\">54</span><br><span class=\"line\">55</span><br><span class=\"line\">56</span><br><span class=\"line\">57</span><br><span class=\"line\">58</span><br><span class=\"line\">59</span><br><span class=\"line\">60</span><br><span class=\"line\">61</span><br><span class=\"line\">62</span><br><span class=\"line\">63</span><br><span class=\"line\">64</span><br><span class=\"line\">65</span><br><span class=\"line\">66</span><br><span class=\"line\">67</span><br><span class=\"line\">68</span><br><span class=\"line\">69</span><br><span class=\"line\">70</span><br><span class=\"line\">71</span><br><span class=\"line\">72</span><br><span class=\"line\">73</span><br><span class=\"line\">74</span><br><span class=\"line\">75</span><br><span class=\"line\">76</span><br><span class=\"line\">77</span><br><span class=\"line\">78</span><br><span class=\"line\">79</span><br><span class=\"line\">80</span><br><span class=\"line\">81</span><br><span class=\"line\">82</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"></span><br><span class=\"line\">- ç¬¬ä¸€ç§é£æ ¼**å…¼å®¹æ€§æœ€å¥½**</span><br><span class=\"line\">- ç¬¬äºŒç§é£æ ¼è®¤åŒ**å‚æ•°å°±åº”è¯¥æœ‰ä¸ªåå­—**</span><br><span class=\"line\">- ç¬¬ä¸‰ç§é£æ ¼**å¦‚æœæœ‰å®Œå–„çš„ä»£ç è¯„å®¡æµç¨‹çš„è¯å¯ä»¥è€ƒè™‘è€ƒè™‘**ï¼Œä¸ç„¶ä¸æ¨è</span><br><span class=\"line\"></span><br><span class=\"line\">### é€‚é…å™¨æ¨¡å¼</span><br><span class=\"line\"></span><br><span class=\"line\">æ—¢ç„¶å·²ç»æŠ½è±¡å‡ºäº†æ—¥å¿—æ¥å£ï¼Œé‚£ä¹ˆå…·ä½“è¯¥å¦‚ä½•å®ç°å‘¢ï¼Ÿ</span><br><span class=\"line\"></span><br><span class=\"line\">ç­”æ¡ˆå°±æ˜¯é‡‡ç”¨**é€‚é…å™¨æ¨¡å¼**</span><br><span class=\"line\"></span><br><span class=\"line\">æ‰€è°“é€‚é…å™¨æ¨¡å¼ï¼Œå°±æ˜¯**å°†ä¸€ä¸ªç±»å‹é€‚é…åˆ°å¦ä¸€ä¸ªæ¥å£ä¸Š**ã€‚ä¾‹å¦‚ï¼Œå°†Aé€‚é…åˆ°Bï¼Œè¿™é‡Œçš„Aå¯ä»¥æ˜¯æ¥å£ï¼Œä¹Ÿå¯ä»¥æ˜¯ä¸€ä¸ªå…·ä½“çš„ç±»å‹</span><br><span class=\"line\"></span><br><span class=\"line\">**å…¸å‹çš„ä½¿ç”¨åœºæ™¯**</span><br><span class=\"line\"></span><br><span class=\"line\">- æœ‰ä¸¤ä¸ªç”¨é€”ç±»ä¼¼ï¼Œä½†æ˜¯ç»†èŠ‚ä¸Šç•¥æœ‰ä¸åŒçš„æ¥å£ï¼Œå°†ä¸€ä¸ªæ¥å£é€‚é…åˆ°å¦ä¸€ä¸ªæ¥å£ä¸Š</span><br><span class=\"line\">- ç”±äºç‰ˆæœ¬è¿­ä»£ï¼Œå‡ºç°äº†ä¸¤ä¸ªæ¥å£ï¼Œéœ€è¦å°†ä¸€ä¸ªæ¥å£é€‚é…åˆ°å¦ä¸€ä¸ªæ¥å£ä¸Š</span><br><span class=\"line\"></span><br><span class=\"line\">**ä¸è£…é¥°å™¨æ¨¡å¼çš„åŒºåˆ«**</span><br><span class=\"line\"></span><br><span class=\"line\">- è£…é¥°å™¨æ¨¡å¼ç”¨äº**æ‰©å±•åŠŸèƒ½**ï¼Œè‡ªå§‹è‡³ç»ˆ**éƒ½æ˜¯ä¸€ä¸ªæ¥å£**</span><br><span class=\"line\">- é€‚é…å™¨æ¨¡å¼**å¿…ç„¶æ˜¯ä¸¤ä¸ªä¸åŒçš„æ¥å£**</span><br><span class=\"line\"></span><br><span class=\"line\">### åˆ©ç”¨Ginçš„middlewareæ‰“å°æ—¥å¿—</span><br><span class=\"line\"></span><br><span class=\"line\">åœ¨handleræ–‡ä»¶ä¸­ï¼Œæœ‰å¾ˆå¤šä¸ªæ–¹æ³•ï¼Œå¦‚æœä¸€ä¸€ä¸ºè¿™äº›æ–¹æ³•æ‰“å°æ—¥å¿—éœ€è¦èŠ±è´¹å¾ˆå¤šæ—¶é—´å’Œç²¾åŠ›</span><br><span class=\"line\"></span><br><span class=\"line\">å¯æ˜¯å‘ç°ï¼Œhandlerä¸­çš„æ–¹æ³•éƒ½æ˜¯ä¸è¯·æ±‚å’Œå“åº”æœ‰å…³çš„ï¼Œé‚£ä¹ˆå°±å¯ä»¥é‡‡ç”¨`AOP`æœºåˆ¶ï¼Œåˆ©ç”¨ginçš„middlewareæ¥ç»Ÿä¸€æ‰“æ—¥å¿—</span><br><span class=\"line\"></span><br><span class=\"line\">#### ä½¿ç”¨builderæ¨¡å¼æ„å»ºä¸­é—´ä»¶</span><br><span class=\"line\"></span><br><span class=\"line\">```go</span><br><span class=\"line\">// å‡ ä¸ªæ³¨æ„ç‚¹ï¼š</span><br><span class=\"line\">// å°å¿ƒæ—¥å¿—å†…å®¹è¿‡å¤šï¼šURLå¯èƒ½å¾ˆé•¿ï¼Œè¯·æ±‚ä½“ã€å“åº”ä½“éƒ½å¯èƒ½ç‰¹åˆ«ç‰¹åˆ«å¤§ï¼Œéœ€è¦è€ƒè™‘æ˜¯å¦è¦è¿›è¡Œæˆªå–</span><br><span class=\"line\">// ç”¨æˆ·å¯èƒ½æ¢ç”¨ä¸åŒçš„æ—¥å¿—æ¡†æ¶ï¼Œæ‰€ä»¥è¦æœ‰è¶³å¤Ÿçš„çµæ´»æ€§</span><br><span class=\"line\">// è€ƒè™‘ç»“åˆviperå®ç°åŠ¨æ€å¼€å…³ï¼Œä½†æ˜¯è¦å°å¿ƒå¹¶å‘å®‰å…¨</span><br><span class=\"line\">func (b *Builder) Build() gin.HandlerFunc &#123;</span><br><span class=\"line\">\treturn func(ctx *gin.Context) &#123;</span><br><span class=\"line\">\t\tstart := time.Now()</span><br><span class=\"line\">\t\tal := AccessLog&#123;&#125;</span><br><span class=\"line\">\t\tal.Method = ctx.Request.Method</span><br><span class=\"line\">\t\tif b.allowURL &amp;&amp; ctx.Request.URL != nil &#123;</span><br><span class=\"line\">\t\t\turl := ctx.Request.URL.String()</span><br><span class=\"line\">\t\t\tif len(url) &gt; 1024 &#123;</span><br><span class=\"line\">\t\t\t\turl = url[:1024]</span><br><span class=\"line\">\t\t\t&#125;</span><br><span class=\"line\">\t\t\tal.URL = url</span><br><span class=\"line\">\t\t&#125;</span><br><span class=\"line\">\t\tif b.allowReqBody &amp;&amp; ctx.Request.Body != nil &#123;</span><br><span class=\"line\">\t\t\t// è¿™é‡Œå¿½ç•¥é”™è¯¯ï¼Œæ¯•ç«Ÿæˆ‘åªæ˜¯æ‰“å°ä¸ªæ—¥å¿—ï¼Œæœ‰é”™è¯¯ä¹Ÿæ— æ‰€è°“äº†</span><br><span class=\"line\">\t\t\tdata, _ := ctx.GetRawData()</span><br><span class=\"line\">\t\t\t// Request.Bodyæ˜¯ä¸€ä¸ªæµå¯¹è±¡ï¼Œè¯»å®Œä¹‹åRequesté‡Œé¢å°±æœ¨æœ‰äº†</span><br><span class=\"line\">\t\t\t// æ‰€ä»¥è¿˜å¾—æŠŠæ•°æ®æ”¾å›Request.Bodyï¼Œä¸ç„¶åç»­æ­¥éª¤å°±è¯»ä¸åˆ°è¿™ä¸ªæ•°æ®äº†</span><br><span class=\"line\">\t\t\tctx.Request.Body = io.NopCloser(bytes.NewBuffer(data))</span><br><span class=\"line\">\t\t\tbody := string(data)</span><br><span class=\"line\">\t\t\tif len(body) &gt; 1024 &#123;</span><br><span class=\"line\">\t\t\t\tal.ReqBody = body</span><br><span class=\"line\">\t\t\t&#125;</span><br><span class=\"line\">\t\t&#125;</span><br><span class=\"line\">\t\t// defer æ‰“æ—¥å¿—ï¼Œå³ä½¿æœ‰panicä¹Ÿä¸ä¼šå½±å“æ—¥å¿—çš„è¾“å‡º</span><br><span class=\"line\">\t\tdefer func() &#123;</span><br><span class=\"line\">\t\t\tal.Duration = time.Since(start).String()</span><br><span class=\"line\">\t\t\t// å…·ä½“æ€ä¹ˆæ‰“å°æ—¥å¿—ï¼Œç”±ç”¨æˆ·å†³å®š</span><br><span class=\"line\">\t\t\tb.logFunc(ctx, al)</span><br><span class=\"line\">\t\t&#125;()</span><br><span class=\"line\">\t\t// æ‰§è¡Œåˆ°ä¸šåŠ¡ä»£ç ï¼ˆä¸æ˜¯å¾ˆæ‡‚ï¼‰</span><br><span class=\"line\">\t\tctx.Next()</span><br><span class=\"line\">\t&#125;</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"></span><br><span class=\"line\">type AccessLog struct &#123;</span><br><span class=\"line\">\t// è¯·æ±‚æ–¹æ³•</span><br><span class=\"line\">\tMethod string</span><br><span class=\"line\">\t// url</span><br><span class=\"line\">\tURL string</span><br><span class=\"line\">\t// è¯·æ±‚ä½“</span><br><span class=\"line\">\tReqBody string</span><br><span class=\"line\">\t// å¤„ç†æ—¶é—´</span><br><span class=\"line\">\tDuration string</span><br><span class=\"line\">\t// å“åº”ä½“</span><br><span class=\"line\">\tRespBody string</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n</code></pre>\n</li>\n</ul>\n<p><strong>ä¸€ä¸ªæœ‰æ„æ€çš„ç‚¹ï¼šä¸ºä»€ä¹ˆè¦è®©ç”¨æˆ·ä¼ è¿›æ¥ä¸€ä¸ªæ‰“æ—¥å¿—çš„æ–¹æ³•å‘¢ï¼Ÿ</strong></p>\n<p>å¦‚æœä¸ä¼ é€’æ–¹æ³•ï¼Œé‚£ä¹ˆåœ¨å®ç°ä¸­ä¸ç®¡æˆ‘ä»¬æ˜¯ç”¨<code>Info()</code>ã€<code>Debug()</code>è¿˜æ˜¯<code>Error()</code>éƒ½æ˜¯å†™æ­»åœ¨ä»£ç ä¸­çš„ï¼Œä¸èƒ½çµæ´»åœ°åº”å¯¹ä¸åŒçš„åœºæ™¯ï¼Œä¾‹å¦‚å¼€å‘ç¯å¢ƒè¦ç”¨<code>Debug()</code>ï¼Œå¯èƒ½çº¿ä¸Šç¯å¢ƒæˆ‘å°±è¦ç”¨<code>Info()</code>äº†</p>\n<p>é‚£ä¹ˆä¸å¦‚å°±è®©ç”¨æˆ·ä¼ è¿›æ¥ä¸€ä¸ªæ–¹æ³•ï¼Œåªä¸ºç”¨æˆ·æä¾›ä¸€ä¸ªæ¥å£ï¼Œå±è”½åº•å±‚çš„å®ç°ï¼Œç”¨æˆ·åªéœ€è¦è€ƒè™‘åœ¨ä¸åŒç¯å¢ƒé€‰æ‹©ä½¿ç”¨ä¸åŒçš„æ–¹æ³•å°±è¡Œäº†</p>\n<h4 id=\"æ‰“å°å“åº”\"><a href=\"#æ‰“å°å“åº”\" class=\"headerlink\" title=\"æ‰“å°å“åº”\"></a>æ‰“å°å“åº”</h4><p>æ­£å¸¸æ¥è¯´ï¼Œæ‰“å°å“åº”å°±åº”è¯¥å’Œä¸Šæ–‡ä¸­æ‰“å°è¯·æ±‚ä¸€æ ·ç®€å•ï¼šç›´æ¥ä»<code>context</code>é‡Œé¢æ‹¿è¯·æ±‚å°±è¡Œ</p>\n<p>ä¸å¹¸çš„æ˜¯ï¼Œ<code>ctx</code>å¹¶æ²¡æœ‰æš´éœ²å‡º<code>Response</code>ï¼Œä¹Ÿå°±æ˜¯ä¸èƒ½ç›´æ¥è¯»å“åº”</p>\n<p>ä½†æ˜¯ï¼Œ<code>ctx</code>æš´éœ²å‡ºäº†<code>ResponseWriter</code>ï¼Œè¿™ä¸ªæ¥å£æ˜¯ç”¨æ¥å†™å“åº”çš„ã€‚é‚£ä¹ˆæˆ‘ä»¬å¯ä»¥â€œ<strong>å·æ¢æ¢æŸ±</strong>â€ï¼Œå°†è¿™ä¸ªæ¥å£æ¢æˆæˆ‘ä»¬è‡ªå·±çš„å®ç°ï¼š<strong>åœ¨å†™å“åº”ä¹‹å‰å°†æ•°æ®ä¿ç•™ä¸‹æ¥ï¼Œè¿™æ ·å°±æœ‰äº†å“åº”çš„å…·ä½“æ•°æ®</strong></p>\n<p>åœ¨è¿™é‡Œæˆ‘ä»¬åªéœ€è¦é‡å†™<code>WriteHeader</code>ã€<code>Write</code>ã€<code>WriteString</code>è¿™ä¸‰ä¸ªæ–¹æ³•ï¼Œæ‰€ä»¥è£…é¥°å™¨æ¨¡å¼åœ¨å®ç°çš„æ—¶å€™å¯ä»¥é‡‡ç”¨ç»„åˆçš„æ–¹å¼</p>\n<ul>\n<li>ç»„åˆ â€”&gt; è£…é¥°éƒ¨åˆ†æ–¹æ³•</li>\n<li>éç»„åˆ â€”&gt; è£…é¥°å…¨éƒ¨æ–¹æ³•</li>\n</ul>\n<figure class=\"highlight go\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">if</span> b.allowRespBody &#123;</span><br><span class=\"line\">\t<span class=\"comment\">// å·æ¢æ¢æŸ±</span></span><br><span class=\"line\">\tctx.Writer = &amp;responseWriter&#123;</span><br><span class=\"line\">\t\tal: &amp;al,</span><br><span class=\"line\">\t\tResponseWriter: ctx.Writer,</span><br><span class=\"line\">\t&#125;</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"keyword\">type</span> responseWriter <span class=\"keyword\">struct</span> &#123;</span><br><span class=\"line\">\t<span class=\"comment\">// è¿™é‡Œç”¨æŒ‡é’ˆï¼Œä¸ºäº†èƒ½ç•™ä½â€œå·â€è¿‡æ¥çš„æ•°æ®</span></span><br><span class=\"line\">\tal *AccessLog</span><br><span class=\"line\">\tgin.ResponseWriter</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"function\"><span class=\"keyword\">func</span> <span class=\"params\">(r *responseWriter)</span></span> WriteString(data <span class=\"type\">string</span>) (<span class=\"type\">int</span>, <span class=\"type\">error</span>) &#123;</span><br><span class=\"line\">\tr.al.RespBody = data</span><br><span class=\"line\">\t<span class=\"keyword\">return</span> r.ResponseWriter.WriteString(data)</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"function\"><span class=\"keyword\">func</span> <span class=\"params\">(r *responseWriter)</span></span> Write(data []<span class=\"type\">byte</span>) (<span class=\"type\">int</span>, <span class=\"type\">error</span>) &#123;</span><br><span class=\"line\">\tr.al.RespBody = <span class=\"type\">string</span>(data)</span><br><span class=\"line\">\t<span class=\"keyword\">return</span> r.ResponseWriter.Write(data)</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"function\"><span class=\"keyword\">func</span> <span class=\"params\">(r *responseWriter)</span></span> WriteHeader(statusCode <span class=\"type\">int</span>) &#123;</span><br><span class=\"line\">\tr.al.Status = statusCode</span><br><span class=\"line\">\tr.ResponseWriter.WriteHeader(statusCode)</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n\n<h3 id=\"GORMæ‰“å°æ—¥å¿—\"><a href=\"#GORMæ‰“å°æ—¥å¿—\" class=\"headerlink\" title=\"GORMæ‰“å°æ—¥å¿—\"></a>GORMæ‰“å°æ—¥å¿—</h3><p>ç›´æ¥ä¸Šä»£ç ï¼š</p>\n<figure class=\"highlight go\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br><span class=\"line\">31</span><br><span class=\"line\">32</span><br><span class=\"line\">33</span><br><span class=\"line\">34</span><br><span class=\"line\">35</span><br><span class=\"line\">36</span><br><span class=\"line\">37</span><br><span class=\"line\">38</span><br><span class=\"line\">39</span><br><span class=\"line\">40</span><br><span class=\"line\">41</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\">// è¡ç”Ÿç±»å‹ï¼Œæœ‰ç‚¹åƒé€‚é…å™¨æ¨¡å¼</span></span><br><span class=\"line\"><span class=\"keyword\">type</span> gormLoggerFunc <span class=\"function\"><span class=\"keyword\">func</span><span class=\"params\">(msg <span class=\"type\">string</span>, fields ...zap.Field)</span></span></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\">// Printf å®ç°å•æ¥å£</span></span><br><span class=\"line\"><span class=\"function\"><span class=\"keyword\">func</span> <span class=\"params\">(g gormLoggerFunc)</span></span> Printf(msg <span class=\"type\">string</span>, fields ...<span class=\"keyword\">interface</span>&#123;&#125;) &#123;</span><br><span class=\"line\">\tg(msg, zap.Any(<span class=\"string\">&quot;args&quot;</span>, fields))</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"></span><br><span class=\"line\"></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"function\"><span class=\"keyword\">func</span> <span class=\"title\">InitDB</span><span class=\"params\">(l *zap.Logger)</span></span> *gorm.DB &#123;</span><br><span class=\"line\">\t<span class=\"keyword\">type</span> Config <span class=\"keyword\">struct</span> &#123;</span><br><span class=\"line\">\t\tDSN <span class=\"type\">string</span> <span class=\"string\">`yaml:&quot;dsn&quot;`</span></span><br><span class=\"line\">\t&#125;</span><br><span class=\"line\">\t<span class=\"keyword\">var</span> config Config</span><br><span class=\"line\">\tconfig.DSN = <span class=\"string\">&quot;abab&quot;</span></span><br><span class=\"line\">\terr := viper.UnmarshalKey(<span class=\"string\">&quot;db&quot;</span>, &amp;config)</span><br><span class=\"line\">\t<span class=\"keyword\">if</span> err != <span class=\"literal\">nil</span> &#123;</span><br><span class=\"line\">\t\t<span class=\"built_in\">panic</span>(err)</span><br><span class=\"line\">\t&#125;</span><br><span class=\"line\">\tdb, err := gorm.Open(mysql.Open(config.DSN), &amp;gorm.Config&#123;</span><br><span class=\"line\">\t\t<span class=\"comment\">// å¼ºåˆ¶ç±»å‹è½¬æ¢</span></span><br><span class=\"line\">\t\tLogger: logger.New(gormLoggerFunc(l.Debug), logger.Config&#123;</span><br><span class=\"line\">\t\t\t<span class=\"comment\">// æ…¢æŸ¥è¯¢é˜ˆå€¼ï¼Œåªæœ‰è¯­å¥æ‰§è¡Œæ—¶é—´è¶…è¿‡è¿™ä¸ªé˜ˆå€¼æ‰ä¼šæ‰“å°æ—¥å¿—</span></span><br><span class=\"line\">            <span class=\"comment\">// ä¸€èˆ¬ä¸º50ms 100msï¼Œä¸€æ¬¡ç£ç›˜ioæ“ä½œå¤§æ¦‚æ˜¯10ms</span></span><br><span class=\"line\">\t\t\tSlowThreshold:             time.Millisecond * <span class=\"number\">10</span>,</span><br><span class=\"line\">\t\t\tLogLevel:                  logger.Info,</span><br><span class=\"line\">\t\t\tIgnoreRecordNotFoundError: <span class=\"literal\">true</span>,</span><br><span class=\"line\">\t\t\tParameterizedQueries:      <span class=\"literal\">true</span>,</span><br><span class=\"line\">\t\t&#125;),</span><br><span class=\"line\">\t&#125;)</span><br><span class=\"line\">\t<span class=\"keyword\">if</span> err != <span class=\"literal\">nil</span> &#123;</span><br><span class=\"line\">\t\t<span class=\"built_in\">panic</span>(err)</span><br><span class=\"line\">\t&#125;</span><br><span class=\"line\">\terr = dao.InitTable(db)</span><br><span class=\"line\">\t<span class=\"keyword\">if</span> err != <span class=\"literal\">nil</span> &#123;</span><br><span class=\"line\">\t\t<span class=\"built_in\">panic</span>(err)</span><br><span class=\"line\">\t&#125;</span><br><span class=\"line\">\t<span class=\"keyword\">return</span> db</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"></span><br></pre></td></tr></table></figure>\n\n<p>gormå·²ç»ä¸ºæˆ‘ä»¬æä¾›äº†æœ‰å…³æ—¥å¿—çš„é…ç½®ï¼Œæ‰€ä»¥æˆ‘ä»¬å¯ä»¥ç›´æ¥ä½¿ç”¨é…ç½®å®ç°æ‰“æ—¥å¿—åŠŸèƒ½</p>\n<p>è¿™é‡Œæœ‰ä¸ªå°é—®é¢˜ï¼Œ<code>logger.New()</code>æ–¹æ³•çš„ç¬¬ä¸€ä¸ªå‚æ•°è¦æ±‚ä¼ å…¥<code>Writer</code>æ¥å£çš„å®ç°ï¼Œè¿™ä¸ªå®ç°å°†ä¼šç”¨æ¥è¾“å‡ºæ—¥å¿—</p>\n<p><img src=\"https://raw.githubusercontent.com/lyydsheep/pic/main/202409071637525.png\" alt=\"image-20240907163634983\"></p>\n<p>é‚£ä¹ˆç°åœ¨å°±æ˜¯éœ€è¦å°†æˆ‘ä»¬è‡ªå·±å®ç°çš„æ—¥å¿—æ¥å£é€‚é…åˆ°gormçš„<code>Writer</code>æ¥å£ä¸Š</p>\n<p>å¥½å·§ä¸å·§ï¼Œ<code>Writer</code>æ¥å£åªæœ‰ä¸€ä¸ªæ–¹æ³•ï¼Œé‚£ä¹ˆå°±å¯ä»¥ç”¨ä¸Š<strong>è¡ç”Ÿå‡½æ•°+å‡½æ•°å®ç°å•æ¥å£</strong>æŠ€å·§ï¼Œå¿«é€Ÿå°†æˆ‘ä»¬çš„æ—¥å¿—æ¥å£é€‚é…åˆ°æ­¤å¤„</p>\n<p>è¿™å°±æ˜¯ä¸ºä»€ä¹ˆæˆ‘ä»¬çš„è¡ç”Ÿå‡½æ•°çš„åŸç±»å‹æ˜¯<code>func(msg string, fields...zap.Field)</code>ï¼Œè¿™æ­£æ˜¯<code>l.Debug()</code>æ–¹æ³•çš„å‡½æ•°ç±»å‹å•Š</p>\n<p>æœ€åä¼ å…¥<code>Writer</code>æ¥å£çš„æ—¶å€™ï¼Œåˆ©ç”¨è¡ç”Ÿç±»å‹å°†<code>l.Debug()</code>å¼ºåˆ¶ç±»å‹è½¬æ¢ï¼Œä½¿å…¶é—´æ¥åœ°å®ç°äº†<code>Writer</code>æ¥å£çš„åŒæ—¶ï¼ŒæœªåŠ¨æˆ‘ä»¬è‡ªå·±çš„æ¥å£åˆ†æ¯«</p>\n"},{"_content":"# æ¦œå•æ¨¡å‹ä¸åˆ†å¸ƒå¼ä»»åŠ¡è°ƒåº¦\n\nå®ç°æ¦œå•åŠŸèƒ½ä¸»è¦æœ‰ä¸‰ä¸ªè¦ç‚¹ï¼š\n\n1. å¦‚ä½•è®¡ç®—çƒ­ç‚¹\n2. å¦‚ä½•ä¿è¯æ€§èƒ½\n3. å¦‚ä½•ä¿è¯é«˜å¯ç”¨\n\nä¸€ä¸ªæ¦œå•æ¨¡å‹éœ€è¦æ»¡è¶³è¾ƒå¼ºçš„å®æ—¶æ€§è®¡ç®—ï¼Œå…è®¸åœ¨ä¸€å®šæ—¶é—´æ­¥é•¿å†…çš„æ•°æ®è¯¯å·®ã€‚ä¸ç‰ˆçš„å®ç°æ€è·¯å°±æ˜¯**å®šæ—¶æŸ¥è¯¢ + æŸ¥è¯¢æ•°æ®åº“ + æ’åºé€‰å‡ºå‰Nä¸ªè®°å½•**\n\nä½¿ç”¨`time.ticker`å¯ä»¥ç®€ä¾¿åœ°å®ç°å®šæ—¶æŸ¥è¯¢å­åŠŸèƒ½\n\nä½†æ˜¯å…¨å±€æ‰«ææ•°æ®åº“å’Œæ–‡ä»¶æ’åºæ˜¯æ¯”è¾ƒè€—æ—¶çš„æ­¥éª¤ï¼Œç‰¹åˆ«æ˜¯å½“æ•°æ®åº“ä¸­å…·æœ‰æµ·é‡æ•°æ®çš„æ—¶å€™ï¼ŒæŸ¥è¯¢æ•°æ®åº“çš„å‹åŠ›ä¼šç‰¹åˆ«å¤§ã€‚\n\n![image-20241203144830478](https://raw.githubusercontent.com/lyydsheep/pic/main/202412031448530.png)\n\nä¸€ä¸ªè§£å†³æ€è·¯æ˜¯**å¼‚æ­¥åˆ†æ‰¹æŸ¥è¯¢**ï¼Œå°†å¤§æ‰¹é‡çš„æ•°æ®åˆ†è€Œæ²»ä¹‹\n\n## è®¡ç®—çƒ­ç‚¹\n\nè®¡ç®—çƒ­ç‚¹ä¸æ˜¯æˆ‘ä»¬é‡ç‚¹è€ƒè™‘çš„ä¸œè¥¿ï¼Œä¸€èˆ¬éƒ½æ˜¯äº§å“ç»ç†æä¾›è®¡ç®—ç®—æ³•ï¼Œå¼€å‘äººå‘˜é€‚å½“æå‡ºå»ºè®®å³å¯ï¼Œä¸å¿…è¿‡äºçº ç»“äºæ­¤ã€‚è®¡ç®—çƒ­ç‚¹ç®—æ³•ä¸€èˆ¬ä¼šåŒ…å«**ç”¨æˆ·è¡Œä¸ºã€æ—¶é—´ã€æƒé‡å› å­**ç­‰éƒ¨åˆ†ï¼Œä¾‹å¦‚Hacknewsç®—æ³•ã€Redditç®—æ³•\n\n## å®šæ—¶ä»»åŠ¡\n\n\n\n\n\næ€§èƒ½å’Œå¯ç”¨æ€§\tç¼ºä¸€ä¸å¯\n\né’ˆå¯¹Zsetçš„ä¼˜åŒ–æ‰‹æ®µ\n\ntime.Timer\n\ntime.Ticker\n\ngo.work  go work init\n\n//go:generate mockgen\n\nå¼•å…¥ä¸€ä¸ªjobæ¨¡å—\n\né€‚é…å™¨æ¨¡å¼æˆ–è€…builderæ¨¡å¼ \t----> \té€‚é…corn.Jobæ¥å£\n\n<img src=\"https://raw.githubusercontent.com/lyydsheep/pic/main/202412011101200.png\" alt=\"image-20241201110137143\"  />\n\næŸ¥è¯¢æ¥å£\t---->\tä¸€ä¸ªé«˜å¹¶å‘ä¸”é«˜å¯ç”¨çš„æ¥å£\n\næè‡´æ€§èƒ½ ---> å¿…é¡»è¦ç”¨æœ¬åœ°ç¼“å­˜\n\n\n\n\n\n\n\nåˆ†å¸ƒå¼å®šæ—¶ä»»åŠ¡ï¼šRedisåˆ†å¸ƒå¼é”\n\n\n\nå¿ƒè·³æœºåˆ¶\n","source":"_posts/Go/æ¦œå•æ¨¡å‹ä¸åˆ†å¸ƒå¼ä»»åŠ¡è°ƒåº¦.md","raw":"# æ¦œå•æ¨¡å‹ä¸åˆ†å¸ƒå¼ä»»åŠ¡è°ƒåº¦\n\nå®ç°æ¦œå•åŠŸèƒ½ä¸»è¦æœ‰ä¸‰ä¸ªè¦ç‚¹ï¼š\n\n1. å¦‚ä½•è®¡ç®—çƒ­ç‚¹\n2. å¦‚ä½•ä¿è¯æ€§èƒ½\n3. å¦‚ä½•ä¿è¯é«˜å¯ç”¨\n\nä¸€ä¸ªæ¦œå•æ¨¡å‹éœ€è¦æ»¡è¶³è¾ƒå¼ºçš„å®æ—¶æ€§è®¡ç®—ï¼Œå…è®¸åœ¨ä¸€å®šæ—¶é—´æ­¥é•¿å†…çš„æ•°æ®è¯¯å·®ã€‚ä¸ç‰ˆçš„å®ç°æ€è·¯å°±æ˜¯**å®šæ—¶æŸ¥è¯¢ + æŸ¥è¯¢æ•°æ®åº“ + æ’åºé€‰å‡ºå‰Nä¸ªè®°å½•**\n\nä½¿ç”¨`time.ticker`å¯ä»¥ç®€ä¾¿åœ°å®ç°å®šæ—¶æŸ¥è¯¢å­åŠŸèƒ½\n\nä½†æ˜¯å…¨å±€æ‰«ææ•°æ®åº“å’Œæ–‡ä»¶æ’åºæ˜¯æ¯”è¾ƒè€—æ—¶çš„æ­¥éª¤ï¼Œç‰¹åˆ«æ˜¯å½“æ•°æ®åº“ä¸­å…·æœ‰æµ·é‡æ•°æ®çš„æ—¶å€™ï¼ŒæŸ¥è¯¢æ•°æ®åº“çš„å‹åŠ›ä¼šç‰¹åˆ«å¤§ã€‚\n\n![image-20241203144830478](https://raw.githubusercontent.com/lyydsheep/pic/main/202412031448530.png)\n\nä¸€ä¸ªè§£å†³æ€è·¯æ˜¯**å¼‚æ­¥åˆ†æ‰¹æŸ¥è¯¢**ï¼Œå°†å¤§æ‰¹é‡çš„æ•°æ®åˆ†è€Œæ²»ä¹‹\n\n## è®¡ç®—çƒ­ç‚¹\n\nè®¡ç®—çƒ­ç‚¹ä¸æ˜¯æˆ‘ä»¬é‡ç‚¹è€ƒè™‘çš„ä¸œè¥¿ï¼Œä¸€èˆ¬éƒ½æ˜¯äº§å“ç»ç†æä¾›è®¡ç®—ç®—æ³•ï¼Œå¼€å‘äººå‘˜é€‚å½“æå‡ºå»ºè®®å³å¯ï¼Œä¸å¿…è¿‡äºçº ç»“äºæ­¤ã€‚è®¡ç®—çƒ­ç‚¹ç®—æ³•ä¸€èˆ¬ä¼šåŒ…å«**ç”¨æˆ·è¡Œä¸ºã€æ—¶é—´ã€æƒé‡å› å­**ç­‰éƒ¨åˆ†ï¼Œä¾‹å¦‚Hacknewsç®—æ³•ã€Redditç®—æ³•\n\n## å®šæ—¶ä»»åŠ¡\n\n\n\n\n\næ€§èƒ½å’Œå¯ç”¨æ€§\tç¼ºä¸€ä¸å¯\n\né’ˆå¯¹Zsetçš„ä¼˜åŒ–æ‰‹æ®µ\n\ntime.Timer\n\ntime.Ticker\n\ngo.work  go work init\n\n//go:generate mockgen\n\nå¼•å…¥ä¸€ä¸ªjobæ¨¡å—\n\né€‚é…å™¨æ¨¡å¼æˆ–è€…builderæ¨¡å¼ \t----> \té€‚é…corn.Jobæ¥å£\n\n<img src=\"https://raw.githubusercontent.com/lyydsheep/pic/main/202412011101200.png\" alt=\"image-20241201110137143\"  />\n\næŸ¥è¯¢æ¥å£\t---->\tä¸€ä¸ªé«˜å¹¶å‘ä¸”é«˜å¯ç”¨çš„æ¥å£\n\næè‡´æ€§èƒ½ ---> å¿…é¡»è¦ç”¨æœ¬åœ°ç¼“å­˜\n\n\n\n\n\n\n\nåˆ†å¸ƒå¼å®šæ—¶ä»»åŠ¡ï¼šRedisåˆ†å¸ƒå¼é”\n\n\n\nå¿ƒè·³æœºåˆ¶\n","slug":"Go/æ¦œå•æ¨¡å‹ä¸åˆ†å¸ƒå¼ä»»åŠ¡è°ƒåº¦","published":1,"date":"2024-12-27T11:03:15.345Z","updated":"2024-12-27T11:03:15.345Z","title":"","comments":1,"layout":"post","photos":[],"_id":"cm6c7md6m0023a5t24q264wfe","content":"<h1 id=\"æ¦œå•æ¨¡å‹ä¸åˆ†å¸ƒå¼ä»»åŠ¡è°ƒåº¦\"><a href=\"#æ¦œå•æ¨¡å‹ä¸åˆ†å¸ƒå¼ä»»åŠ¡è°ƒåº¦\" class=\"headerlink\" title=\"æ¦œå•æ¨¡å‹ä¸åˆ†å¸ƒå¼ä»»åŠ¡è°ƒåº¦\"></a>æ¦œå•æ¨¡å‹ä¸åˆ†å¸ƒå¼ä»»åŠ¡è°ƒåº¦</h1><p>å®ç°æ¦œå•åŠŸèƒ½ä¸»è¦æœ‰ä¸‰ä¸ªè¦ç‚¹ï¼š</p>\n<ol>\n<li>å¦‚ä½•è®¡ç®—çƒ­ç‚¹</li>\n<li>å¦‚ä½•ä¿è¯æ€§èƒ½</li>\n<li>å¦‚ä½•ä¿è¯é«˜å¯ç”¨</li>\n</ol>\n<p>ä¸€ä¸ªæ¦œå•æ¨¡å‹éœ€è¦æ»¡è¶³è¾ƒå¼ºçš„å®æ—¶æ€§è®¡ç®—ï¼Œå…è®¸åœ¨ä¸€å®šæ—¶é—´æ­¥é•¿å†…çš„æ•°æ®è¯¯å·®ã€‚ä¸ç‰ˆçš„å®ç°æ€è·¯å°±æ˜¯<strong>å®šæ—¶æŸ¥è¯¢ + æŸ¥è¯¢æ•°æ®åº“ + æ’åºé€‰å‡ºå‰Nä¸ªè®°å½•</strong></p>\n<p>ä½¿ç”¨<code>time.ticker</code>å¯ä»¥ç®€ä¾¿åœ°å®ç°å®šæ—¶æŸ¥è¯¢å­åŠŸèƒ½</p>\n<p>ä½†æ˜¯å…¨å±€æ‰«ææ•°æ®åº“å’Œæ–‡ä»¶æ’åºæ˜¯æ¯”è¾ƒè€—æ—¶çš„æ­¥éª¤ï¼Œç‰¹åˆ«æ˜¯å½“æ•°æ®åº“ä¸­å…·æœ‰æµ·é‡æ•°æ®çš„æ—¶å€™ï¼ŒæŸ¥è¯¢æ•°æ®åº“çš„å‹åŠ›ä¼šç‰¹åˆ«å¤§ã€‚</p>\n<p><img src=\"https://raw.githubusercontent.com/lyydsheep/pic/main/202412031448530.png\" alt=\"image-20241203144830478\"></p>\n<p>ä¸€ä¸ªè§£å†³æ€è·¯æ˜¯<strong>å¼‚æ­¥åˆ†æ‰¹æŸ¥è¯¢</strong>ï¼Œå°†å¤§æ‰¹é‡çš„æ•°æ®åˆ†è€Œæ²»ä¹‹</p>\n<h2 id=\"è®¡ç®—çƒ­ç‚¹\"><a href=\"#è®¡ç®—çƒ­ç‚¹\" class=\"headerlink\" title=\"è®¡ç®—çƒ­ç‚¹\"></a>è®¡ç®—çƒ­ç‚¹</h2><p>è®¡ç®—çƒ­ç‚¹ä¸æ˜¯æˆ‘ä»¬é‡ç‚¹è€ƒè™‘çš„ä¸œè¥¿ï¼Œä¸€èˆ¬éƒ½æ˜¯äº§å“ç»ç†æä¾›è®¡ç®—ç®—æ³•ï¼Œå¼€å‘äººå‘˜é€‚å½“æå‡ºå»ºè®®å³å¯ï¼Œä¸å¿…è¿‡äºçº ç»“äºæ­¤ã€‚è®¡ç®—çƒ­ç‚¹ç®—æ³•ä¸€èˆ¬ä¼šåŒ…å«<strong>ç”¨æˆ·è¡Œä¸ºã€æ—¶é—´ã€æƒé‡å› å­</strong>ç­‰éƒ¨åˆ†ï¼Œä¾‹å¦‚Hacknewsç®—æ³•ã€Redditç®—æ³•</p>\n<h2 id=\"å®šæ—¶ä»»åŠ¡\"><a href=\"#å®šæ—¶ä»»åŠ¡\" class=\"headerlink\" title=\"å®šæ—¶ä»»åŠ¡\"></a>å®šæ—¶ä»»åŠ¡</h2><p>æ€§èƒ½å’Œå¯ç”¨æ€§\tç¼ºä¸€ä¸å¯</p>\n<p>é’ˆå¯¹Zsetçš„ä¼˜åŒ–æ‰‹æ®µ</p>\n<p>time.Timer</p>\n<p>time.Ticker</p>\n<p>go.work  go work init</p>\n<p>&#x2F;&#x2F;go:generate mockgen</p>\n<p>å¼•å…¥ä¸€ä¸ªjobæ¨¡å—</p>\n<p>é€‚é…å™¨æ¨¡å¼æˆ–è€…builderæ¨¡å¼ \tâ€”-&gt; \té€‚é…corn.Jobæ¥å£</p>\n<img src=\"https://raw.githubusercontent.com/lyydsheep/pic/main/202412011101200.png\" alt=\"image-20241201110137143\"  />\n\n<p>æŸ¥è¯¢æ¥å£\tâ€”-&gt;\tä¸€ä¸ªé«˜å¹¶å‘ä¸”é«˜å¯ç”¨çš„æ¥å£</p>\n<p>æè‡´æ€§èƒ½ â€”&gt; å¿…é¡»è¦ç”¨æœ¬åœ°ç¼“å­˜</p>\n<p>åˆ†å¸ƒå¼å®šæ—¶ä»»åŠ¡ï¼šRedisåˆ†å¸ƒå¼é”</p>\n<p>å¿ƒè·³æœºåˆ¶</p>\n","excerpt":"","more":"<h1 id=\"æ¦œå•æ¨¡å‹ä¸åˆ†å¸ƒå¼ä»»åŠ¡è°ƒåº¦\"><a href=\"#æ¦œå•æ¨¡å‹ä¸åˆ†å¸ƒå¼ä»»åŠ¡è°ƒåº¦\" class=\"headerlink\" title=\"æ¦œå•æ¨¡å‹ä¸åˆ†å¸ƒå¼ä»»åŠ¡è°ƒåº¦\"></a>æ¦œå•æ¨¡å‹ä¸åˆ†å¸ƒå¼ä»»åŠ¡è°ƒåº¦</h1><p>å®ç°æ¦œå•åŠŸèƒ½ä¸»è¦æœ‰ä¸‰ä¸ªè¦ç‚¹ï¼š</p>\n<ol>\n<li>å¦‚ä½•è®¡ç®—çƒ­ç‚¹</li>\n<li>å¦‚ä½•ä¿è¯æ€§èƒ½</li>\n<li>å¦‚ä½•ä¿è¯é«˜å¯ç”¨</li>\n</ol>\n<p>ä¸€ä¸ªæ¦œå•æ¨¡å‹éœ€è¦æ»¡è¶³è¾ƒå¼ºçš„å®æ—¶æ€§è®¡ç®—ï¼Œå…è®¸åœ¨ä¸€å®šæ—¶é—´æ­¥é•¿å†…çš„æ•°æ®è¯¯å·®ã€‚ä¸ç‰ˆçš„å®ç°æ€è·¯å°±æ˜¯<strong>å®šæ—¶æŸ¥è¯¢ + æŸ¥è¯¢æ•°æ®åº“ + æ’åºé€‰å‡ºå‰Nä¸ªè®°å½•</strong></p>\n<p>ä½¿ç”¨<code>time.ticker</code>å¯ä»¥ç®€ä¾¿åœ°å®ç°å®šæ—¶æŸ¥è¯¢å­åŠŸèƒ½</p>\n<p>ä½†æ˜¯å…¨å±€æ‰«ææ•°æ®åº“å’Œæ–‡ä»¶æ’åºæ˜¯æ¯”è¾ƒè€—æ—¶çš„æ­¥éª¤ï¼Œç‰¹åˆ«æ˜¯å½“æ•°æ®åº“ä¸­å…·æœ‰æµ·é‡æ•°æ®çš„æ—¶å€™ï¼ŒæŸ¥è¯¢æ•°æ®åº“çš„å‹åŠ›ä¼šç‰¹åˆ«å¤§ã€‚</p>\n<p><img src=\"https://raw.githubusercontent.com/lyydsheep/pic/main/202412031448530.png\" alt=\"image-20241203144830478\"></p>\n<p>ä¸€ä¸ªè§£å†³æ€è·¯æ˜¯<strong>å¼‚æ­¥åˆ†æ‰¹æŸ¥è¯¢</strong>ï¼Œå°†å¤§æ‰¹é‡çš„æ•°æ®åˆ†è€Œæ²»ä¹‹</p>\n<h2 id=\"è®¡ç®—çƒ­ç‚¹\"><a href=\"#è®¡ç®—çƒ­ç‚¹\" class=\"headerlink\" title=\"è®¡ç®—çƒ­ç‚¹\"></a>è®¡ç®—çƒ­ç‚¹</h2><p>è®¡ç®—çƒ­ç‚¹ä¸æ˜¯æˆ‘ä»¬é‡ç‚¹è€ƒè™‘çš„ä¸œè¥¿ï¼Œä¸€èˆ¬éƒ½æ˜¯äº§å“ç»ç†æä¾›è®¡ç®—ç®—æ³•ï¼Œå¼€å‘äººå‘˜é€‚å½“æå‡ºå»ºè®®å³å¯ï¼Œä¸å¿…è¿‡äºçº ç»“äºæ­¤ã€‚è®¡ç®—çƒ­ç‚¹ç®—æ³•ä¸€èˆ¬ä¼šåŒ…å«<strong>ç”¨æˆ·è¡Œä¸ºã€æ—¶é—´ã€æƒé‡å› å­</strong>ç­‰éƒ¨åˆ†ï¼Œä¾‹å¦‚Hacknewsç®—æ³•ã€Redditç®—æ³•</p>\n<h2 id=\"å®šæ—¶ä»»åŠ¡\"><a href=\"#å®šæ—¶ä»»åŠ¡\" class=\"headerlink\" title=\"å®šæ—¶ä»»åŠ¡\"></a>å®šæ—¶ä»»åŠ¡</h2><p>æ€§èƒ½å’Œå¯ç”¨æ€§\tç¼ºä¸€ä¸å¯</p>\n<p>é’ˆå¯¹Zsetçš„ä¼˜åŒ–æ‰‹æ®µ</p>\n<p>time.Timer</p>\n<p>time.Ticker</p>\n<p>go.work  go work init</p>\n<p>&#x2F;&#x2F;go:generate mockgen</p>\n<p>å¼•å…¥ä¸€ä¸ªjobæ¨¡å—</p>\n<p>é€‚é…å™¨æ¨¡å¼æˆ–è€…builderæ¨¡å¼ \tâ€”-&gt; \té€‚é…corn.Jobæ¥å£</p>\n<img src=\"https://raw.githubusercontent.com/lyydsheep/pic/main/202412011101200.png\" alt=\"image-20241201110137143\"  />\n\n<p>æŸ¥è¯¢æ¥å£\tâ€”-&gt;\tä¸€ä¸ªé«˜å¹¶å‘ä¸”é«˜å¯ç”¨çš„æ¥å£</p>\n<p>æè‡´æ€§èƒ½ â€”&gt; å¿…é¡»è¦ç”¨æœ¬åœ°ç¼“å­˜</p>\n<p>åˆ†å¸ƒå¼å®šæ—¶ä»»åŠ¡ï¼šRedisåˆ†å¸ƒå¼é”</p>\n<p>å¿ƒè·³æœºåˆ¶</p>\n"},{"title":"Golangä¹‹æ¥å…¥é…ç½®æ¨¡å—","publish":true,"description":"è®°å½•Goé¡¹ç›®ä¸­æ¥å…¥é…ç½®æ¨¡å—","date":"2024-08-15T10:29:00.000Z","_content":"\n# æ¥å…¥é…ç½®æ¨¡å—\n\n## ä¸šåŠ¡é…ç½®çš„é€šç”¨ç†è®ºï¼šæ¥æº\n\né…ç½®çš„æ¥æºæœ‰è¿™ä¹ˆå‡ ç±»\n\n- **å¯åŠ¨å‚æ•°**ï¼šæŸä¸€æ¬¡è¿è¡Œçš„å‚æ•°ï¼Œå¯ä»¥åœ¨è¿™é‡Œæä¾›ï¼Œå…¸å‹çš„å°±æ˜¯å‘½ä»¤è¡Œå·¥å…·\n- **ç¯å¢ƒå˜é‡**ï¼šå…·ä½“å®ä¾‹æœ‰å…³çš„å‚æ•°å¯ä»¥æ”¾åœ¨ç¯å¢ƒå˜é‡ä¸­\n- **æœ¬åœ°é…ç½®æ–‡ä»¶**ï¼šå½“ä¸‹ç¯å¢ƒæ‰€éœ€è¦çš„é€šç”¨é…ç½®\n- **è¿œç¨‹é…ç½®ä¸­å¿ƒ**ï¼šä¸æœ¬åœ°é…ç½®æ–‡ä»¶äº’ç›¸è¡¥å……ï¼Œé™¤äº†æ»¡è¶³å¯åŠ¨æœåŠ¡çš„æœ€å°é…ç½®ï¼Œå‰©ä¸‹çš„é…ç½®éƒ½å¯ä»¥æ”¾åœ¨è¿œç¨‹é…ç½®ä¸­å¿ƒ\n\n**ä¼˜å…ˆä½¿ç”¨é…ç½®æ–‡ä»¶ï¼Œå¤§è§„æ¨¡æœåŠ¡å™¨é›†ç¾¤å¯ä»¥è€ƒè™‘ä½¿ç”¨è¿œç¨‹é…ç½®ä¸­å¿ƒ**\n\n## ä¸šåŠ¡é…ç½®çš„é€šç”¨ç†è®ºï¼šä¼˜å…ˆçº§\n\næœ‰çš„æ—¶å€™ï¼ŒåŒä¸€ä¸ªé…ç½®é¡¹æœ‰å¤šä¸ªæ¥æºï¼Œè¿™ä¸ªæ—¶å€™å°±éœ€è¦æ ¹æ®ä¼˜å…ˆçº§æ•²å®šä¸€ä¸ªå”¯ä¸€çš„æ¥æº\n\n![img](https://raw.githubusercontent.com/lyydsheep/pic/main/202408311457945.png)\n\nå¯ä»¥æœ‰ä¸‹åˆ—è¿™ç•ªæ’åˆ—\n\n- å‘½ä»¤è¡Œï¼šæ¯•ç«Ÿæ˜¯è‡ªå·±å†™çš„\n- ç¯å¢ƒå˜é‡ï¼šæœ¬æœºç”µè„‘ä¸Šçš„ç¯å¢ƒå˜é‡ä¹Ÿæ˜¯è‡ªå·±é…ç½®çš„\n- é…ç½®æ–‡ä»¶ï¼šå¯èƒ½æ˜¯åŒäº‹å†™çš„ï¼Œç”¨GitåŒæ­¥è¿‡æ¥äº†\n- è¿œç¨‹é…ç½®ä¸­å¿ƒ\n\n## ä¸šåŠ¡é…ç½®çš„é€šç”¨ç†è®ºï¼šä¸¤æ¬¡åŠ è½½\n\nåœ¨ä½¿ç”¨**è¿œç¨‹é…ç½®ä¸­å¿ƒ**æ—¶ï¼Œä¸€èˆ¬éœ€è¦æœ‰ä¸¤æ¬¡åŠ è½½çš„è¿‡ç¨‹\n\n- **ç¬¬ä¸€æ¬¡åŠ è½½æœ€åŸºæœ¬çš„é…ç½®**ï¼ŒåŒ…æ‹¬\n  - è¿œç¨‹é…ç½®ä¸­å¿ƒçš„è¿æ¥ä¿¡æ¯\n  - æ—¥å¿—ç›¸å…³é…ç½®\n- **ç¬¬äºŒæ¬¡åŠ è½½åˆ™æ˜¯å®Œå…¨åŠ è½½**\n  - è¯»å–ç³»ç»Ÿæ‰€éœ€è¦çš„æ‰€æœ‰ä¾èµ–\n  - è¦†ç›–ç¬¬ä¸€æ¬¡åŠ è½½çš„é…ç½®\n\nç®€å•åœ°ï¼Œ**ç¬¬ä¸€æ¬¡åŠ è½½å°±æ˜¯åŠ è½½æœ€åŸºæœ¬åŠŸèƒ½**ï¼Œ**ç¬¬äºŒæ¬¡åŠ è½½å°±æ˜¯å®Œå…¨åŠ è½½å¹¶å¯¹ç¬¬ä¸€æ¬¡åŠ è½½é…ç½®è¿›è¡Œè¦†ç›–**\n\n## viper\n\n### åˆå§‹åŒ–viper\n\nhttps://github.com/spf13/viper\n\né¦–å…ˆå‡†å¤‡å¥½é…ç½®æœ¬åœ°æ–‡ä»¶\n\n![img](https://raw.githubusercontent.com/lyydsheep/pic/main/202408311457339.png)\n\næ¥ç€ä½¿ç”¨viper**è¯»å–æœ¬åœ°çš„é…ç½®æ–‡ä»¶**ï¼Œå…·ä½“æœ‰ä¸¤ç§åˆå§‹åŒ–viperçš„æ–¹æ³•\n\n- ç›´æ¥æŒ‡å®šç›®æ ‡é…ç½®æ–‡ä»¶çš„è·¯å¾„\n\n  - `viper.SetConfigFile()`ï¼šåŠ è½½é…ç½®æ–‡ä»¶\n\n  - `viper.ReadInConfig()`ï¼šè¯»å–é…ç½®æ–‡ä»¶å†…å®¹\n\n  - ```Go\n    // è®¾å®šviperå°†è¦è¯»å–çš„æ–‡ä»¶\n    // viperä»å½“å‰å·¥ä½œç›®å½•ä¸‹è¿›è¡Œå®šä½\n    viper.SetConfigFile(\"config/dev.yaml\")\n    err := viper.ReadInConfig()\n    if err != nil {\n        panic(err)\n    }\n    ```\n\n- åˆ†åˆ«æŒ‡å®šç›®æ ‡é…ç½®æ–‡ä»¶çš„ç±»å‹ã€åç§°ã€å­ç›®å½•\n\n  - `viper.SetConfigType()`ã€`viper.SetConfigName()`ã€`viper.AddConfigPath()`ï¼šåŠ è½½é…ç½®æ–‡ä»¶\n\n  - `viper.ReadInConfig()`ï¼šè¯»å–é…ç½®æ–‡ä»¶å†…å®¹\n  \n  - ```Go\n    // è®¾å®šviperå°†è¦è¯»å–çš„æ–‡ä»¶\n    // viperä»å½“å‰å·¥ä½œç›®å½•ä¸‹è¿›è¡Œå®šä½\n    viper.SetConfigType(\"yaml\")\n    viper.SetConfigName(\"dev\")\n    viper.AddConfigPath(\"config\")\n    err := viper.ReadInConfig()\n    if err != nil {\n        panic(err)\n    }\n    ```\n\nå€¼å¾—æ³¨æ„çš„æ˜¯ï¼Œä¸ç®¡æ˜¯å‘viperä¸­ç›´æ¥ä¼ å…¥è·¯å¾„è¿˜æ˜¯å­ç›®å½•ï¼Œéƒ½æ˜¯ä»**å½“å‰Goçš„å·¥ä½œç›®å½•å¼€å§‹å®šä½çš„**\n\nå¯ä»¥åœ¨Goland IDEä¸­æŸ¥çœ‹working directory\n\n<img src=\"https://raw.githubusercontent.com/lyydsheep/pic/main/202408311457921.png\" width = 600px>\n\n### è¯»å–viperé…ç½®\n\nä»viperä¸­è¯»å–æŸä¸€é…ç½®é¡¹æœ‰ä¸¤ç§å¸¸ç”¨çš„æ–¹æ³•\n\n- ç›´æ¥è¯»å–æŸä¸€ä¸ªé…ç½®\n- å®šä¹‰ä¸€ä¸ªç»“æ„ä½“ï¼Œç”¨äºæ¥æ”¶æ‰€æœ‰çš„é…ç½®é¡¹\n\nç¬¬äºŒç§æ–¹æ³•æ¯”è¾ƒæ¨èä½¿ç”¨ï¼Œæˆ‘ä»¬å¯ä»¥åœ¨IOCä¸­ï¼Œä¹Ÿå°±æ˜¯éœ€è¦ä½¿ç”¨é…ç½®é¡¹çš„åˆå§‹åŒ–çš„åœ°æ–¹ï¼Œå®šä¹‰ä¸€ä¸ªå†…éƒ¨ç»“æ„ä½“ç”¨äºæ¥æ”¶æ‰€æœ‰çš„é…ç½®é¡¹\n\næœ‰ä¸¤ä¸ªæ³¨æ„ç‚¹ï¼š\n\n1. **å†…éƒ¨ç»“æ„ä½“å­—æ®µè¦æ±‚åŒ…å¤–èƒ½å¤Ÿè®¿é—®ï¼ˆå³é¦–å­—æ¯å¤§å†™ï¼‰**\n2. **æŒ‡æ˜å°†è¦è¯»å–çš„æ•°æ®æ ¼å¼ä»¥åŠå­—æ®µåç§°**\n\n```go\n\ttype Config struct {\n\t\t// æŒ‡æ˜è¯»å–æ•°æ®æ ¼å¼ä»¥åŠå­—æ®µåç§°\n\t\t// ç»“æ„ä½“å†…çš„å­—æ®µè¦ä¿è¯åŒ…å¤–èƒ½è®¿é—®ï¼Œå¦åˆ™æ— æ³•æˆåŠŸåˆå§‹åŒ–\n\t\tDSN string `yaml:\"dsn\"`\n\t}\n\tvar config Config\n\t// æŒ‡å®šè¦è¯»å–çš„key\n\terr := viper.UnmarshalKey(\"db\", &config)\n\tif err != nil {\n\t\tpanic(err)\n\t}\n```\n\n### è®¾ç½®viperé»˜è®¤å€¼\n\næœ‰çš„æ—¶å€™é…ç½®æ–‡ä»¶ä¸­ç¼ºå°‘ä¸€äº›å¿…è¦çš„é…ç½®é¡¹ä¿¡æ¯ï¼Œè¿™ä¸ªæ—¶å€™å°±éœ€è¦ä½¿ç”¨ä¸Šviperçš„é…ç½®é»˜è®¤å€¼ã€‚ä¾‹å¦‚ï¼Œå¦‚æœæˆ‘å¿˜è®°äº†å†™DBçš„é…ç½®ï¼Œé‚£ä¹ˆå°±åº”è¯¥é»˜è®¤ä½¿ç”¨`localhost:3306`\n\nåœ¨viperä¸­æœ‰ä¸¤ç§å®ç°é»˜è®¤å€¼çš„æ–¹æ¡ˆï¼š\n\n- ä½¿ç”¨viperçš„`SetDefault()`æ–¹æ³•\n- åˆ©ç”¨ç»“æ„ä½“ï¼Œåœ¨`UnmarshalKey()`ä¹‹å‰è®¾ç½®å¥½é»˜è®¤å€¼\n  - æ¨èè¿™ç§ï¼Œå› ä¸ºå¯ä»¥æŠŠé»˜è®¤å€¼æ”¾åœ¨åˆå§‹åŒ–çš„åœ°æ–¹\n\n### viperåŠ¨æ€è¯»å–é…ç½®\n\nä¸€èˆ¬è€Œè¨€ï¼Œä¸€ä¸ªé¡¹ç›®å¯èƒ½å¤„åœ¨å¤šä¸ªç¯å¢ƒä¸­ï¼Œä¾‹å¦‚ï¼šå¼€å‘ç¯å¢ƒã€æµ‹è¯•ç¯å¢ƒã€çº¿ä¸Šç¯å¢ƒï¼Œåœ¨ä¸åŒç¯å¢ƒä¸­å¿…ç„¶éœ€è¦ä½¿ç”¨åˆ°ä¸åŒçš„é…ç½®ä¿¡æ¯ï¼Œé‚£ä¹ˆè¿™å°±ä¼šè¦æ±‚æˆ‘ä»¬èƒ½å¤ŸåŠ¨æ€åœ°è¯»å–é…ç½®\n\n<img src=https://raw.githubusercontent.com/lyydsheep/pic/main/202409011938249.png width=500px>\n\næˆ‘ä»¬å¯ä»¥åœ¨å¯åŠ¨é¡¹ç›®æ—¶ä¼ å…¥ä¸€ä¸ªconfigå‚æ•°ï¼Œè¿™ä¸ªconfigå‚æ•°å°±æ˜¯æ­¤æ¬¡å°†è¯»å–çš„é…ç½®æ–‡ä»¶è·¯å¾„\n\n```go\n\t// åˆå§‹åŒ–é…ç½®æ–‡ä»¶è·¯å¾„æŒ‡é’ˆï¼Œå¹¶è®¾å®šé»˜è®¤å€¼\n\tcfile := pflag.String(\"config\", \"config/hello.yaml\", \"é…ç½®æ–‡ä»¶è·¯å¾„\")\n\t// æ¥æ”¶configå‚æ•°\n\tpflag.Parse()\n\tviper.SetConfigFile(*cfile)\n\terr := viper.ReadInConfig()\n```\n\n\n\nå¯ä»¥åœ¨Goland IDEä¸­è®¾ç½®configå‚æ•°\n\n<img src = https://raw.githubusercontent.com/lyydsheep/pic/main/202409011948441.png width=600px>\n\n### viperè¯»å–è¿œç¨‹é…ç½®ä¸­å¿ƒ\n\n#### å®‰è£…etcdå’Œetcdctl\n\nä½¿ç”¨docker composeå®‰è£…etcd\n\n![](https://raw.githubusercontent.com/lyydsheep/pic/main/202409012055638.png)\n\n**etcdctlæ²¡æœ‰å®‰è£…æˆåŠŸï¼Œä¸æ˜æ‰€ä»¥**\n\npathç”¨äºåŒºåˆ«å…¶ä»–ä½¿ç”¨etcdçš„åº”ç”¨\n\n![image-20240901152107902](https://raw.githubusercontent.com/lyydsheep/pic/main/202409011521927.png)","source":"_posts/Go/æ¥å…¥é…ç½®æ¨¡å—.md","raw":"---\ntitle: Golangä¹‹æ¥å…¥é…ç½®æ¨¡å—\npublish: true\ndescription: è®°å½•Goé¡¹ç›®ä¸­æ¥å…¥é…ç½®æ¨¡å—\ndate: 2024-08-15 18:29:00\ntag: \n- Go\n- å­¦ä¹ \n---\n\n# æ¥å…¥é…ç½®æ¨¡å—\n\n## ä¸šåŠ¡é…ç½®çš„é€šç”¨ç†è®ºï¼šæ¥æº\n\né…ç½®çš„æ¥æºæœ‰è¿™ä¹ˆå‡ ç±»\n\n- **å¯åŠ¨å‚æ•°**ï¼šæŸä¸€æ¬¡è¿è¡Œçš„å‚æ•°ï¼Œå¯ä»¥åœ¨è¿™é‡Œæä¾›ï¼Œå…¸å‹çš„å°±æ˜¯å‘½ä»¤è¡Œå·¥å…·\n- **ç¯å¢ƒå˜é‡**ï¼šå…·ä½“å®ä¾‹æœ‰å…³çš„å‚æ•°å¯ä»¥æ”¾åœ¨ç¯å¢ƒå˜é‡ä¸­\n- **æœ¬åœ°é…ç½®æ–‡ä»¶**ï¼šå½“ä¸‹ç¯å¢ƒæ‰€éœ€è¦çš„é€šç”¨é…ç½®\n- **è¿œç¨‹é…ç½®ä¸­å¿ƒ**ï¼šä¸æœ¬åœ°é…ç½®æ–‡ä»¶äº’ç›¸è¡¥å……ï¼Œé™¤äº†æ»¡è¶³å¯åŠ¨æœåŠ¡çš„æœ€å°é…ç½®ï¼Œå‰©ä¸‹çš„é…ç½®éƒ½å¯ä»¥æ”¾åœ¨è¿œç¨‹é…ç½®ä¸­å¿ƒ\n\n**ä¼˜å…ˆä½¿ç”¨é…ç½®æ–‡ä»¶ï¼Œå¤§è§„æ¨¡æœåŠ¡å™¨é›†ç¾¤å¯ä»¥è€ƒè™‘ä½¿ç”¨è¿œç¨‹é…ç½®ä¸­å¿ƒ**\n\n## ä¸šåŠ¡é…ç½®çš„é€šç”¨ç†è®ºï¼šä¼˜å…ˆçº§\n\næœ‰çš„æ—¶å€™ï¼ŒåŒä¸€ä¸ªé…ç½®é¡¹æœ‰å¤šä¸ªæ¥æºï¼Œè¿™ä¸ªæ—¶å€™å°±éœ€è¦æ ¹æ®ä¼˜å…ˆçº§æ•²å®šä¸€ä¸ªå”¯ä¸€çš„æ¥æº\n\n![img](https://raw.githubusercontent.com/lyydsheep/pic/main/202408311457945.png)\n\nå¯ä»¥æœ‰ä¸‹åˆ—è¿™ç•ªæ’åˆ—\n\n- å‘½ä»¤è¡Œï¼šæ¯•ç«Ÿæ˜¯è‡ªå·±å†™çš„\n- ç¯å¢ƒå˜é‡ï¼šæœ¬æœºç”µè„‘ä¸Šçš„ç¯å¢ƒå˜é‡ä¹Ÿæ˜¯è‡ªå·±é…ç½®çš„\n- é…ç½®æ–‡ä»¶ï¼šå¯èƒ½æ˜¯åŒäº‹å†™çš„ï¼Œç”¨GitåŒæ­¥è¿‡æ¥äº†\n- è¿œç¨‹é…ç½®ä¸­å¿ƒ\n\n## ä¸šåŠ¡é…ç½®çš„é€šç”¨ç†è®ºï¼šä¸¤æ¬¡åŠ è½½\n\nåœ¨ä½¿ç”¨**è¿œç¨‹é…ç½®ä¸­å¿ƒ**æ—¶ï¼Œä¸€èˆ¬éœ€è¦æœ‰ä¸¤æ¬¡åŠ è½½çš„è¿‡ç¨‹\n\n- **ç¬¬ä¸€æ¬¡åŠ è½½æœ€åŸºæœ¬çš„é…ç½®**ï¼ŒåŒ…æ‹¬\n  - è¿œç¨‹é…ç½®ä¸­å¿ƒçš„è¿æ¥ä¿¡æ¯\n  - æ—¥å¿—ç›¸å…³é…ç½®\n- **ç¬¬äºŒæ¬¡åŠ è½½åˆ™æ˜¯å®Œå…¨åŠ è½½**\n  - è¯»å–ç³»ç»Ÿæ‰€éœ€è¦çš„æ‰€æœ‰ä¾èµ–\n  - è¦†ç›–ç¬¬ä¸€æ¬¡åŠ è½½çš„é…ç½®\n\nç®€å•åœ°ï¼Œ**ç¬¬ä¸€æ¬¡åŠ è½½å°±æ˜¯åŠ è½½æœ€åŸºæœ¬åŠŸèƒ½**ï¼Œ**ç¬¬äºŒæ¬¡åŠ è½½å°±æ˜¯å®Œå…¨åŠ è½½å¹¶å¯¹ç¬¬ä¸€æ¬¡åŠ è½½é…ç½®è¿›è¡Œè¦†ç›–**\n\n## viper\n\n### åˆå§‹åŒ–viper\n\nhttps://github.com/spf13/viper\n\né¦–å…ˆå‡†å¤‡å¥½é…ç½®æœ¬åœ°æ–‡ä»¶\n\n![img](https://raw.githubusercontent.com/lyydsheep/pic/main/202408311457339.png)\n\næ¥ç€ä½¿ç”¨viper**è¯»å–æœ¬åœ°çš„é…ç½®æ–‡ä»¶**ï¼Œå…·ä½“æœ‰ä¸¤ç§åˆå§‹åŒ–viperçš„æ–¹æ³•\n\n- ç›´æ¥æŒ‡å®šç›®æ ‡é…ç½®æ–‡ä»¶çš„è·¯å¾„\n\n  - `viper.SetConfigFile()`ï¼šåŠ è½½é…ç½®æ–‡ä»¶\n\n  - `viper.ReadInConfig()`ï¼šè¯»å–é…ç½®æ–‡ä»¶å†…å®¹\n\n  - ```Go\n    // è®¾å®šviperå°†è¦è¯»å–çš„æ–‡ä»¶\n    // viperä»å½“å‰å·¥ä½œç›®å½•ä¸‹è¿›è¡Œå®šä½\n    viper.SetConfigFile(\"config/dev.yaml\")\n    err := viper.ReadInConfig()\n    if err != nil {\n        panic(err)\n    }\n    ```\n\n- åˆ†åˆ«æŒ‡å®šç›®æ ‡é…ç½®æ–‡ä»¶çš„ç±»å‹ã€åç§°ã€å­ç›®å½•\n\n  - `viper.SetConfigType()`ã€`viper.SetConfigName()`ã€`viper.AddConfigPath()`ï¼šåŠ è½½é…ç½®æ–‡ä»¶\n\n  - `viper.ReadInConfig()`ï¼šè¯»å–é…ç½®æ–‡ä»¶å†…å®¹\n  \n  - ```Go\n    // è®¾å®šviperå°†è¦è¯»å–çš„æ–‡ä»¶\n    // viperä»å½“å‰å·¥ä½œç›®å½•ä¸‹è¿›è¡Œå®šä½\n    viper.SetConfigType(\"yaml\")\n    viper.SetConfigName(\"dev\")\n    viper.AddConfigPath(\"config\")\n    err := viper.ReadInConfig()\n    if err != nil {\n        panic(err)\n    }\n    ```\n\nå€¼å¾—æ³¨æ„çš„æ˜¯ï¼Œä¸ç®¡æ˜¯å‘viperä¸­ç›´æ¥ä¼ å…¥è·¯å¾„è¿˜æ˜¯å­ç›®å½•ï¼Œéƒ½æ˜¯ä»**å½“å‰Goçš„å·¥ä½œç›®å½•å¼€å§‹å®šä½çš„**\n\nå¯ä»¥åœ¨Goland IDEä¸­æŸ¥çœ‹working directory\n\n<img src=\"https://raw.githubusercontent.com/lyydsheep/pic/main/202408311457921.png\" width = 600px>\n\n### è¯»å–viperé…ç½®\n\nä»viperä¸­è¯»å–æŸä¸€é…ç½®é¡¹æœ‰ä¸¤ç§å¸¸ç”¨çš„æ–¹æ³•\n\n- ç›´æ¥è¯»å–æŸä¸€ä¸ªé…ç½®\n- å®šä¹‰ä¸€ä¸ªç»“æ„ä½“ï¼Œç”¨äºæ¥æ”¶æ‰€æœ‰çš„é…ç½®é¡¹\n\nç¬¬äºŒç§æ–¹æ³•æ¯”è¾ƒæ¨èä½¿ç”¨ï¼Œæˆ‘ä»¬å¯ä»¥åœ¨IOCä¸­ï¼Œä¹Ÿå°±æ˜¯éœ€è¦ä½¿ç”¨é…ç½®é¡¹çš„åˆå§‹åŒ–çš„åœ°æ–¹ï¼Œå®šä¹‰ä¸€ä¸ªå†…éƒ¨ç»“æ„ä½“ç”¨äºæ¥æ”¶æ‰€æœ‰çš„é…ç½®é¡¹\n\næœ‰ä¸¤ä¸ªæ³¨æ„ç‚¹ï¼š\n\n1. **å†…éƒ¨ç»“æ„ä½“å­—æ®µè¦æ±‚åŒ…å¤–èƒ½å¤Ÿè®¿é—®ï¼ˆå³é¦–å­—æ¯å¤§å†™ï¼‰**\n2. **æŒ‡æ˜å°†è¦è¯»å–çš„æ•°æ®æ ¼å¼ä»¥åŠå­—æ®µåç§°**\n\n```go\n\ttype Config struct {\n\t\t// æŒ‡æ˜è¯»å–æ•°æ®æ ¼å¼ä»¥åŠå­—æ®µåç§°\n\t\t// ç»“æ„ä½“å†…çš„å­—æ®µè¦ä¿è¯åŒ…å¤–èƒ½è®¿é—®ï¼Œå¦åˆ™æ— æ³•æˆåŠŸåˆå§‹åŒ–\n\t\tDSN string `yaml:\"dsn\"`\n\t}\n\tvar config Config\n\t// æŒ‡å®šè¦è¯»å–çš„key\n\terr := viper.UnmarshalKey(\"db\", &config)\n\tif err != nil {\n\t\tpanic(err)\n\t}\n```\n\n### è®¾ç½®viperé»˜è®¤å€¼\n\næœ‰çš„æ—¶å€™é…ç½®æ–‡ä»¶ä¸­ç¼ºå°‘ä¸€äº›å¿…è¦çš„é…ç½®é¡¹ä¿¡æ¯ï¼Œè¿™ä¸ªæ—¶å€™å°±éœ€è¦ä½¿ç”¨ä¸Šviperçš„é…ç½®é»˜è®¤å€¼ã€‚ä¾‹å¦‚ï¼Œå¦‚æœæˆ‘å¿˜è®°äº†å†™DBçš„é…ç½®ï¼Œé‚£ä¹ˆå°±åº”è¯¥é»˜è®¤ä½¿ç”¨`localhost:3306`\n\nåœ¨viperä¸­æœ‰ä¸¤ç§å®ç°é»˜è®¤å€¼çš„æ–¹æ¡ˆï¼š\n\n- ä½¿ç”¨viperçš„`SetDefault()`æ–¹æ³•\n- åˆ©ç”¨ç»“æ„ä½“ï¼Œåœ¨`UnmarshalKey()`ä¹‹å‰è®¾ç½®å¥½é»˜è®¤å€¼\n  - æ¨èè¿™ç§ï¼Œå› ä¸ºå¯ä»¥æŠŠé»˜è®¤å€¼æ”¾åœ¨åˆå§‹åŒ–çš„åœ°æ–¹\n\n### viperåŠ¨æ€è¯»å–é…ç½®\n\nä¸€èˆ¬è€Œè¨€ï¼Œä¸€ä¸ªé¡¹ç›®å¯èƒ½å¤„åœ¨å¤šä¸ªç¯å¢ƒä¸­ï¼Œä¾‹å¦‚ï¼šå¼€å‘ç¯å¢ƒã€æµ‹è¯•ç¯å¢ƒã€çº¿ä¸Šç¯å¢ƒï¼Œåœ¨ä¸åŒç¯å¢ƒä¸­å¿…ç„¶éœ€è¦ä½¿ç”¨åˆ°ä¸åŒçš„é…ç½®ä¿¡æ¯ï¼Œé‚£ä¹ˆè¿™å°±ä¼šè¦æ±‚æˆ‘ä»¬èƒ½å¤ŸåŠ¨æ€åœ°è¯»å–é…ç½®\n\n<img src=https://raw.githubusercontent.com/lyydsheep/pic/main/202409011938249.png width=500px>\n\næˆ‘ä»¬å¯ä»¥åœ¨å¯åŠ¨é¡¹ç›®æ—¶ä¼ å…¥ä¸€ä¸ªconfigå‚æ•°ï¼Œè¿™ä¸ªconfigå‚æ•°å°±æ˜¯æ­¤æ¬¡å°†è¯»å–çš„é…ç½®æ–‡ä»¶è·¯å¾„\n\n```go\n\t// åˆå§‹åŒ–é…ç½®æ–‡ä»¶è·¯å¾„æŒ‡é’ˆï¼Œå¹¶è®¾å®šé»˜è®¤å€¼\n\tcfile := pflag.String(\"config\", \"config/hello.yaml\", \"é…ç½®æ–‡ä»¶è·¯å¾„\")\n\t// æ¥æ”¶configå‚æ•°\n\tpflag.Parse()\n\tviper.SetConfigFile(*cfile)\n\terr := viper.ReadInConfig()\n```\n\n\n\nå¯ä»¥åœ¨Goland IDEä¸­è®¾ç½®configå‚æ•°\n\n<img src = https://raw.githubusercontent.com/lyydsheep/pic/main/202409011948441.png width=600px>\n\n### viperè¯»å–è¿œç¨‹é…ç½®ä¸­å¿ƒ\n\n#### å®‰è£…etcdå’Œetcdctl\n\nä½¿ç”¨docker composeå®‰è£…etcd\n\n![](https://raw.githubusercontent.com/lyydsheep/pic/main/202409012055638.png)\n\n**etcdctlæ²¡æœ‰å®‰è£…æˆåŠŸï¼Œä¸æ˜æ‰€ä»¥**\n\npathç”¨äºåŒºåˆ«å…¶ä»–ä½¿ç”¨etcdçš„åº”ç”¨\n\n![image-20240901152107902](https://raw.githubusercontent.com/lyydsheep/pic/main/202409011521927.png)","slug":"Go/æ¥å…¥é…ç½®æ¨¡å—","published":1,"updated":"2024-12-27T11:03:15.345Z","comments":1,"layout":"post","photos":[],"_id":"cm6c7md6m0025a5t2bpi200c0","content":"<h1 id=\"æ¥å…¥é…ç½®æ¨¡å—\"><a href=\"#æ¥å…¥é…ç½®æ¨¡å—\" class=\"headerlink\" title=\"æ¥å…¥é…ç½®æ¨¡å—\"></a>æ¥å…¥é…ç½®æ¨¡å—</h1><h2 id=\"ä¸šåŠ¡é…ç½®çš„é€šç”¨ç†è®ºï¼šæ¥æº\"><a href=\"#ä¸šåŠ¡é…ç½®çš„é€šç”¨ç†è®ºï¼šæ¥æº\" class=\"headerlink\" title=\"ä¸šåŠ¡é…ç½®çš„é€šç”¨ç†è®ºï¼šæ¥æº\"></a>ä¸šåŠ¡é…ç½®çš„é€šç”¨ç†è®ºï¼šæ¥æº</h2><p>é…ç½®çš„æ¥æºæœ‰è¿™ä¹ˆå‡ ç±»</p>\n<ul>\n<li><strong>å¯åŠ¨å‚æ•°</strong>ï¼šæŸä¸€æ¬¡è¿è¡Œçš„å‚æ•°ï¼Œå¯ä»¥åœ¨è¿™é‡Œæä¾›ï¼Œå…¸å‹çš„å°±æ˜¯å‘½ä»¤è¡Œå·¥å…·</li>\n<li><strong>ç¯å¢ƒå˜é‡</strong>ï¼šå…·ä½“å®ä¾‹æœ‰å…³çš„å‚æ•°å¯ä»¥æ”¾åœ¨ç¯å¢ƒå˜é‡ä¸­</li>\n<li><strong>æœ¬åœ°é…ç½®æ–‡ä»¶</strong>ï¼šå½“ä¸‹ç¯å¢ƒæ‰€éœ€è¦çš„é€šç”¨é…ç½®</li>\n<li><strong>è¿œç¨‹é…ç½®ä¸­å¿ƒ</strong>ï¼šä¸æœ¬åœ°é…ç½®æ–‡ä»¶äº’ç›¸è¡¥å……ï¼Œé™¤äº†æ»¡è¶³å¯åŠ¨æœåŠ¡çš„æœ€å°é…ç½®ï¼Œå‰©ä¸‹çš„é…ç½®éƒ½å¯ä»¥æ”¾åœ¨è¿œç¨‹é…ç½®ä¸­å¿ƒ</li>\n</ul>\n<p><strong>ä¼˜å…ˆä½¿ç”¨é…ç½®æ–‡ä»¶ï¼Œå¤§è§„æ¨¡æœåŠ¡å™¨é›†ç¾¤å¯ä»¥è€ƒè™‘ä½¿ç”¨è¿œç¨‹é…ç½®ä¸­å¿ƒ</strong></p>\n<h2 id=\"ä¸šåŠ¡é…ç½®çš„é€šç”¨ç†è®ºï¼šä¼˜å…ˆçº§\"><a href=\"#ä¸šåŠ¡é…ç½®çš„é€šç”¨ç†è®ºï¼šä¼˜å…ˆçº§\" class=\"headerlink\" title=\"ä¸šåŠ¡é…ç½®çš„é€šç”¨ç†è®ºï¼šä¼˜å…ˆçº§\"></a>ä¸šåŠ¡é…ç½®çš„é€šç”¨ç†è®ºï¼šä¼˜å…ˆçº§</h2><p>æœ‰çš„æ—¶å€™ï¼ŒåŒä¸€ä¸ªé…ç½®é¡¹æœ‰å¤šä¸ªæ¥æºï¼Œè¿™ä¸ªæ—¶å€™å°±éœ€è¦æ ¹æ®ä¼˜å…ˆçº§æ•²å®šä¸€ä¸ªå”¯ä¸€çš„æ¥æº</p>\n<p><img src=\"https://raw.githubusercontent.com/lyydsheep/pic/main/202408311457945.png\" alt=\"img\"></p>\n<p>å¯ä»¥æœ‰ä¸‹åˆ—è¿™ç•ªæ’åˆ—</p>\n<ul>\n<li>å‘½ä»¤è¡Œï¼šæ¯•ç«Ÿæ˜¯è‡ªå·±å†™çš„</li>\n<li>ç¯å¢ƒå˜é‡ï¼šæœ¬æœºç”µè„‘ä¸Šçš„ç¯å¢ƒå˜é‡ä¹Ÿæ˜¯è‡ªå·±é…ç½®çš„</li>\n<li>é…ç½®æ–‡ä»¶ï¼šå¯èƒ½æ˜¯åŒäº‹å†™çš„ï¼Œç”¨GitåŒæ­¥è¿‡æ¥äº†</li>\n<li>è¿œç¨‹é…ç½®ä¸­å¿ƒ</li>\n</ul>\n<h2 id=\"ä¸šåŠ¡é…ç½®çš„é€šç”¨ç†è®ºï¼šä¸¤æ¬¡åŠ è½½\"><a href=\"#ä¸šåŠ¡é…ç½®çš„é€šç”¨ç†è®ºï¼šä¸¤æ¬¡åŠ è½½\" class=\"headerlink\" title=\"ä¸šåŠ¡é…ç½®çš„é€šç”¨ç†è®ºï¼šä¸¤æ¬¡åŠ è½½\"></a>ä¸šåŠ¡é…ç½®çš„é€šç”¨ç†è®ºï¼šä¸¤æ¬¡åŠ è½½</h2><p>åœ¨ä½¿ç”¨<strong>è¿œç¨‹é…ç½®ä¸­å¿ƒ</strong>æ—¶ï¼Œä¸€èˆ¬éœ€è¦æœ‰ä¸¤æ¬¡åŠ è½½çš„è¿‡ç¨‹</p>\n<ul>\n<li><strong>ç¬¬ä¸€æ¬¡åŠ è½½æœ€åŸºæœ¬çš„é…ç½®</strong>ï¼ŒåŒ…æ‹¬<ul>\n<li>è¿œç¨‹é…ç½®ä¸­å¿ƒçš„è¿æ¥ä¿¡æ¯</li>\n<li>æ—¥å¿—ç›¸å…³é…ç½®</li>\n</ul>\n</li>\n<li><strong>ç¬¬äºŒæ¬¡åŠ è½½åˆ™æ˜¯å®Œå…¨åŠ è½½</strong><ul>\n<li>è¯»å–ç³»ç»Ÿæ‰€éœ€è¦çš„æ‰€æœ‰ä¾èµ–</li>\n<li>è¦†ç›–ç¬¬ä¸€æ¬¡åŠ è½½çš„é…ç½®</li>\n</ul>\n</li>\n</ul>\n<p>ç®€å•åœ°ï¼Œ<strong>ç¬¬ä¸€æ¬¡åŠ è½½å°±æ˜¯åŠ è½½æœ€åŸºæœ¬åŠŸèƒ½</strong>ï¼Œ<strong>ç¬¬äºŒæ¬¡åŠ è½½å°±æ˜¯å®Œå…¨åŠ è½½å¹¶å¯¹ç¬¬ä¸€æ¬¡åŠ è½½é…ç½®è¿›è¡Œè¦†ç›–</strong></p>\n<h2 id=\"viper\"><a href=\"#viper\" class=\"headerlink\" title=\"viper\"></a>viper</h2><h3 id=\"åˆå§‹åŒ–viper\"><a href=\"#åˆå§‹åŒ–viper\" class=\"headerlink\" title=\"åˆå§‹åŒ–viper\"></a>åˆå§‹åŒ–viper</h3><p><a href=\"https://github.com/spf13/viper\">https://github.com/spf13/viper</a></p>\n<p>é¦–å…ˆå‡†å¤‡å¥½é…ç½®æœ¬åœ°æ–‡ä»¶</p>\n<p><img src=\"https://raw.githubusercontent.com/lyydsheep/pic/main/202408311457339.png\" alt=\"img\"></p>\n<p>æ¥ç€ä½¿ç”¨viper<strong>è¯»å–æœ¬åœ°çš„é…ç½®æ–‡ä»¶</strong>ï¼Œå…·ä½“æœ‰ä¸¤ç§åˆå§‹åŒ–viperçš„æ–¹æ³•</p>\n<ul>\n<li><p>ç›´æ¥æŒ‡å®šç›®æ ‡é…ç½®æ–‡ä»¶çš„è·¯å¾„</p>\n<ul>\n<li><p><code>viper.SetConfigFile()</code>ï¼šåŠ è½½é…ç½®æ–‡ä»¶</p>\n</li>\n<li><p><code>viper.ReadInConfig()</code>ï¼šè¯»å–é…ç½®æ–‡ä»¶å†…å®¹</p>\n</li>\n<li><pre><code class=\"Go\">// è®¾å®šviperå°†è¦è¯»å–çš„æ–‡ä»¶\n// viperä»å½“å‰å·¥ä½œç›®å½•ä¸‹è¿›è¡Œå®šä½\nviper.SetConfigFile(&quot;config/dev.yaml&quot;)\nerr := viper.ReadInConfig()\nif err != nil &#123;\n    panic(err)\n&#125;\n<figure class=\"highlight plaintext\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"></span><br><span class=\"line\">- åˆ†åˆ«æŒ‡å®šç›®æ ‡é…ç½®æ–‡ä»¶çš„ç±»å‹ã€åç§°ã€å­ç›®å½•</span><br><span class=\"line\"></span><br><span class=\"line\">  - `viper.SetConfigType()`ã€`viper.SetConfigName()`ã€`viper.AddConfigPath()`ï¼šåŠ è½½é…ç½®æ–‡ä»¶</span><br><span class=\"line\"></span><br><span class=\"line\">  - `viper.ReadInConfig()`ï¼šè¯»å–é…ç½®æ–‡ä»¶å†…å®¹</span><br><span class=\"line\">  </span><br><span class=\"line\">  - ```Go</span><br><span class=\"line\">    // è®¾å®šviperå°†è¦è¯»å–çš„æ–‡ä»¶</span><br><span class=\"line\">    // viperä»å½“å‰å·¥ä½œç›®å½•ä¸‹è¿›è¡Œå®šä½</span><br><span class=\"line\">    viper.SetConfigType(&quot;yaml&quot;)</span><br><span class=\"line\">    viper.SetConfigName(&quot;dev&quot;)</span><br><span class=\"line\">    viper.AddConfigPath(&quot;config&quot;)</span><br><span class=\"line\">    err := viper.ReadInConfig()</span><br><span class=\"line\">    if err != nil &#123;</span><br><span class=\"line\">        panic(err)</span><br><span class=\"line\">    &#125;</span><br></pre></td></tr></table></figure>\n</code></pre>\n</li>\n</ul>\n</li>\n</ul>\n<p>å€¼å¾—æ³¨æ„çš„æ˜¯ï¼Œä¸ç®¡æ˜¯å‘viperä¸­ç›´æ¥ä¼ å…¥è·¯å¾„è¿˜æ˜¯å­ç›®å½•ï¼Œéƒ½æ˜¯ä»<strong>å½“å‰Goçš„å·¥ä½œç›®å½•å¼€å§‹å®šä½çš„</strong></p>\n<p>å¯ä»¥åœ¨Goland IDEä¸­æŸ¥çœ‹working directory</p>\n<img src=\"https://raw.githubusercontent.com/lyydsheep/pic/main/202408311457921.png\" width = 600px>\n\n<h3 id=\"è¯»å–viperé…ç½®\"><a href=\"#è¯»å–viperé…ç½®\" class=\"headerlink\" title=\"è¯»å–viperé…ç½®\"></a>è¯»å–viperé…ç½®</h3><p>ä»viperä¸­è¯»å–æŸä¸€é…ç½®é¡¹æœ‰ä¸¤ç§å¸¸ç”¨çš„æ–¹æ³•</p>\n<ul>\n<li>ç›´æ¥è¯»å–æŸä¸€ä¸ªé…ç½®</li>\n<li>å®šä¹‰ä¸€ä¸ªç»“æ„ä½“ï¼Œç”¨äºæ¥æ”¶æ‰€æœ‰çš„é…ç½®é¡¹</li>\n</ul>\n<p>ç¬¬äºŒç§æ–¹æ³•æ¯”è¾ƒæ¨èä½¿ç”¨ï¼Œæˆ‘ä»¬å¯ä»¥åœ¨IOCä¸­ï¼Œä¹Ÿå°±æ˜¯éœ€è¦ä½¿ç”¨é…ç½®é¡¹çš„åˆå§‹åŒ–çš„åœ°æ–¹ï¼Œå®šä¹‰ä¸€ä¸ªå†…éƒ¨ç»“æ„ä½“ç”¨äºæ¥æ”¶æ‰€æœ‰çš„é…ç½®é¡¹</p>\n<p>æœ‰ä¸¤ä¸ªæ³¨æ„ç‚¹ï¼š</p>\n<ol>\n<li><strong>å†…éƒ¨ç»“æ„ä½“å­—æ®µè¦æ±‚åŒ…å¤–èƒ½å¤Ÿè®¿é—®ï¼ˆå³é¦–å­—æ¯å¤§å†™ï¼‰</strong></li>\n<li><strong>æŒ‡æ˜å°†è¦è¯»å–çš„æ•°æ®æ ¼å¼ä»¥åŠå­—æ®µåç§°</strong></li>\n</ol>\n<figure class=\"highlight go\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">type</span> Config <span class=\"keyword\">struct</span> &#123;</span><br><span class=\"line\">\t<span class=\"comment\">// æŒ‡æ˜è¯»å–æ•°æ®æ ¼å¼ä»¥åŠå­—æ®µåç§°</span></span><br><span class=\"line\">\t<span class=\"comment\">// ç»“æ„ä½“å†…çš„å­—æ®µè¦ä¿è¯åŒ…å¤–èƒ½è®¿é—®ï¼Œå¦åˆ™æ— æ³•æˆåŠŸåˆå§‹åŒ–</span></span><br><span class=\"line\">\tDSN <span class=\"type\">string</span> <span class=\"string\">`yaml:&quot;dsn&quot;`</span></span><br><span class=\"line\">&#125;</span><br><span class=\"line\"><span class=\"keyword\">var</span> config Config</span><br><span class=\"line\"><span class=\"comment\">// æŒ‡å®šè¦è¯»å–çš„key</span></span><br><span class=\"line\">err := viper.UnmarshalKey(<span class=\"string\">&quot;db&quot;</span>, &amp;config)</span><br><span class=\"line\"><span class=\"keyword\">if</span> err != <span class=\"literal\">nil</span> &#123;</span><br><span class=\"line\">\t<span class=\"built_in\">panic</span>(err)</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n\n<h3 id=\"è®¾ç½®viperé»˜è®¤å€¼\"><a href=\"#è®¾ç½®viperé»˜è®¤å€¼\" class=\"headerlink\" title=\"è®¾ç½®viperé»˜è®¤å€¼\"></a>è®¾ç½®viperé»˜è®¤å€¼</h3><p>æœ‰çš„æ—¶å€™é…ç½®æ–‡ä»¶ä¸­ç¼ºå°‘ä¸€äº›å¿…è¦çš„é…ç½®é¡¹ä¿¡æ¯ï¼Œè¿™ä¸ªæ—¶å€™å°±éœ€è¦ä½¿ç”¨ä¸Šviperçš„é…ç½®é»˜è®¤å€¼ã€‚ä¾‹å¦‚ï¼Œå¦‚æœæˆ‘å¿˜è®°äº†å†™DBçš„é…ç½®ï¼Œé‚£ä¹ˆå°±åº”è¯¥é»˜è®¤ä½¿ç”¨<code>localhost:3306</code></p>\n<p>åœ¨viperä¸­æœ‰ä¸¤ç§å®ç°é»˜è®¤å€¼çš„æ–¹æ¡ˆï¼š</p>\n<ul>\n<li>ä½¿ç”¨viperçš„<code>SetDefault()</code>æ–¹æ³•</li>\n<li>åˆ©ç”¨ç»“æ„ä½“ï¼Œåœ¨<code>UnmarshalKey()</code>ä¹‹å‰è®¾ç½®å¥½é»˜è®¤å€¼<ul>\n<li>æ¨èè¿™ç§ï¼Œå› ä¸ºå¯ä»¥æŠŠé»˜è®¤å€¼æ”¾åœ¨åˆå§‹åŒ–çš„åœ°æ–¹</li>\n</ul>\n</li>\n</ul>\n<h3 id=\"viperåŠ¨æ€è¯»å–é…ç½®\"><a href=\"#viperåŠ¨æ€è¯»å–é…ç½®\" class=\"headerlink\" title=\"viperåŠ¨æ€è¯»å–é…ç½®\"></a>viperåŠ¨æ€è¯»å–é…ç½®</h3><p>ä¸€èˆ¬è€Œè¨€ï¼Œä¸€ä¸ªé¡¹ç›®å¯èƒ½å¤„åœ¨å¤šä¸ªç¯å¢ƒä¸­ï¼Œä¾‹å¦‚ï¼šå¼€å‘ç¯å¢ƒã€æµ‹è¯•ç¯å¢ƒã€çº¿ä¸Šç¯å¢ƒï¼Œåœ¨ä¸åŒç¯å¢ƒä¸­å¿…ç„¶éœ€è¦ä½¿ç”¨åˆ°ä¸åŒçš„é…ç½®ä¿¡æ¯ï¼Œé‚£ä¹ˆè¿™å°±ä¼šè¦æ±‚æˆ‘ä»¬èƒ½å¤ŸåŠ¨æ€åœ°è¯»å–é…ç½®</p>\n<img src=https://raw.githubusercontent.com/lyydsheep/pic/main/202409011938249.png width=500px>\n\n<p>æˆ‘ä»¬å¯ä»¥åœ¨å¯åŠ¨é¡¹ç›®æ—¶ä¼ å…¥ä¸€ä¸ªconfigå‚æ•°ï¼Œè¿™ä¸ªconfigå‚æ•°å°±æ˜¯æ­¤æ¬¡å°†è¯»å–çš„é…ç½®æ–‡ä»¶è·¯å¾„</p>\n<figure class=\"highlight go\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\">// åˆå§‹åŒ–é…ç½®æ–‡ä»¶è·¯å¾„æŒ‡é’ˆï¼Œå¹¶è®¾å®šé»˜è®¤å€¼</span></span><br><span class=\"line\">cfile := pflag.String(<span class=\"string\">&quot;config&quot;</span>, <span class=\"string\">&quot;config/hello.yaml&quot;</span>, <span class=\"string\">&quot;é…ç½®æ–‡ä»¶è·¯å¾„&quot;</span>)</span><br><span class=\"line\"><span class=\"comment\">// æ¥æ”¶configå‚æ•°</span></span><br><span class=\"line\">pflag.Parse()</span><br><span class=\"line\">viper.SetConfigFile(*cfile)</span><br><span class=\"line\">err := viper.ReadInConfig()</span><br></pre></td></tr></table></figure>\n\n\n\n<p>å¯ä»¥åœ¨Goland IDEä¸­è®¾ç½®configå‚æ•°</p>\n<img src = https://raw.githubusercontent.com/lyydsheep/pic/main/202409011948441.png width=600px>\n\n<h3 id=\"viperè¯»å–è¿œç¨‹é…ç½®ä¸­å¿ƒ\"><a href=\"#viperè¯»å–è¿œç¨‹é…ç½®ä¸­å¿ƒ\" class=\"headerlink\" title=\"viperè¯»å–è¿œç¨‹é…ç½®ä¸­å¿ƒ\"></a>viperè¯»å–è¿œç¨‹é…ç½®ä¸­å¿ƒ</h3><h4 id=\"å®‰è£…etcdå’Œetcdctl\"><a href=\"#å®‰è£…etcdå’Œetcdctl\" class=\"headerlink\" title=\"å®‰è£…etcdå’Œetcdctl\"></a>å®‰è£…etcdå’Œetcdctl</h4><p>ä½¿ç”¨docker composeå®‰è£…etcd</p>\n<p><img src=\"https://raw.githubusercontent.com/lyydsheep/pic/main/202409012055638.png\"></p>\n<p><strong>etcdctlæ²¡æœ‰å®‰è£…æˆåŠŸï¼Œä¸æ˜æ‰€ä»¥</strong></p>\n<p>pathç”¨äºåŒºåˆ«å…¶ä»–ä½¿ç”¨etcdçš„åº”ç”¨</p>\n<p><img src=\"https://raw.githubusercontent.com/lyydsheep/pic/main/202409011521927.png\" alt=\"image-20240901152107902\"></p>\n","excerpt":"","more":"<h1 id=\"æ¥å…¥é…ç½®æ¨¡å—\"><a href=\"#æ¥å…¥é…ç½®æ¨¡å—\" class=\"headerlink\" title=\"æ¥å…¥é…ç½®æ¨¡å—\"></a>æ¥å…¥é…ç½®æ¨¡å—</h1><h2 id=\"ä¸šåŠ¡é…ç½®çš„é€šç”¨ç†è®ºï¼šæ¥æº\"><a href=\"#ä¸šåŠ¡é…ç½®çš„é€šç”¨ç†è®ºï¼šæ¥æº\" class=\"headerlink\" title=\"ä¸šåŠ¡é…ç½®çš„é€šç”¨ç†è®ºï¼šæ¥æº\"></a>ä¸šåŠ¡é…ç½®çš„é€šç”¨ç†è®ºï¼šæ¥æº</h2><p>é…ç½®çš„æ¥æºæœ‰è¿™ä¹ˆå‡ ç±»</p>\n<ul>\n<li><strong>å¯åŠ¨å‚æ•°</strong>ï¼šæŸä¸€æ¬¡è¿è¡Œçš„å‚æ•°ï¼Œå¯ä»¥åœ¨è¿™é‡Œæä¾›ï¼Œå…¸å‹çš„å°±æ˜¯å‘½ä»¤è¡Œå·¥å…·</li>\n<li><strong>ç¯å¢ƒå˜é‡</strong>ï¼šå…·ä½“å®ä¾‹æœ‰å…³çš„å‚æ•°å¯ä»¥æ”¾åœ¨ç¯å¢ƒå˜é‡ä¸­</li>\n<li><strong>æœ¬åœ°é…ç½®æ–‡ä»¶</strong>ï¼šå½“ä¸‹ç¯å¢ƒæ‰€éœ€è¦çš„é€šç”¨é…ç½®</li>\n<li><strong>è¿œç¨‹é…ç½®ä¸­å¿ƒ</strong>ï¼šä¸æœ¬åœ°é…ç½®æ–‡ä»¶äº’ç›¸è¡¥å……ï¼Œé™¤äº†æ»¡è¶³å¯åŠ¨æœåŠ¡çš„æœ€å°é…ç½®ï¼Œå‰©ä¸‹çš„é…ç½®éƒ½å¯ä»¥æ”¾åœ¨è¿œç¨‹é…ç½®ä¸­å¿ƒ</li>\n</ul>\n<p><strong>ä¼˜å…ˆä½¿ç”¨é…ç½®æ–‡ä»¶ï¼Œå¤§è§„æ¨¡æœåŠ¡å™¨é›†ç¾¤å¯ä»¥è€ƒè™‘ä½¿ç”¨è¿œç¨‹é…ç½®ä¸­å¿ƒ</strong></p>\n<h2 id=\"ä¸šåŠ¡é…ç½®çš„é€šç”¨ç†è®ºï¼šä¼˜å…ˆçº§\"><a href=\"#ä¸šåŠ¡é…ç½®çš„é€šç”¨ç†è®ºï¼šä¼˜å…ˆçº§\" class=\"headerlink\" title=\"ä¸šåŠ¡é…ç½®çš„é€šç”¨ç†è®ºï¼šä¼˜å…ˆçº§\"></a>ä¸šåŠ¡é…ç½®çš„é€šç”¨ç†è®ºï¼šä¼˜å…ˆçº§</h2><p>æœ‰çš„æ—¶å€™ï¼ŒåŒä¸€ä¸ªé…ç½®é¡¹æœ‰å¤šä¸ªæ¥æºï¼Œè¿™ä¸ªæ—¶å€™å°±éœ€è¦æ ¹æ®ä¼˜å…ˆçº§æ•²å®šä¸€ä¸ªå”¯ä¸€çš„æ¥æº</p>\n<p><img src=\"https://raw.githubusercontent.com/lyydsheep/pic/main/202408311457945.png\" alt=\"img\"></p>\n<p>å¯ä»¥æœ‰ä¸‹åˆ—è¿™ç•ªæ’åˆ—</p>\n<ul>\n<li>å‘½ä»¤è¡Œï¼šæ¯•ç«Ÿæ˜¯è‡ªå·±å†™çš„</li>\n<li>ç¯å¢ƒå˜é‡ï¼šæœ¬æœºç”µè„‘ä¸Šçš„ç¯å¢ƒå˜é‡ä¹Ÿæ˜¯è‡ªå·±é…ç½®çš„</li>\n<li>é…ç½®æ–‡ä»¶ï¼šå¯èƒ½æ˜¯åŒäº‹å†™çš„ï¼Œç”¨GitåŒæ­¥è¿‡æ¥äº†</li>\n<li>è¿œç¨‹é…ç½®ä¸­å¿ƒ</li>\n</ul>\n<h2 id=\"ä¸šåŠ¡é…ç½®çš„é€šç”¨ç†è®ºï¼šä¸¤æ¬¡åŠ è½½\"><a href=\"#ä¸šåŠ¡é…ç½®çš„é€šç”¨ç†è®ºï¼šä¸¤æ¬¡åŠ è½½\" class=\"headerlink\" title=\"ä¸šåŠ¡é…ç½®çš„é€šç”¨ç†è®ºï¼šä¸¤æ¬¡åŠ è½½\"></a>ä¸šåŠ¡é…ç½®çš„é€šç”¨ç†è®ºï¼šä¸¤æ¬¡åŠ è½½</h2><p>åœ¨ä½¿ç”¨<strong>è¿œç¨‹é…ç½®ä¸­å¿ƒ</strong>æ—¶ï¼Œä¸€èˆ¬éœ€è¦æœ‰ä¸¤æ¬¡åŠ è½½çš„è¿‡ç¨‹</p>\n<ul>\n<li><strong>ç¬¬ä¸€æ¬¡åŠ è½½æœ€åŸºæœ¬çš„é…ç½®</strong>ï¼ŒåŒ…æ‹¬<ul>\n<li>è¿œç¨‹é…ç½®ä¸­å¿ƒçš„è¿æ¥ä¿¡æ¯</li>\n<li>æ—¥å¿—ç›¸å…³é…ç½®</li>\n</ul>\n</li>\n<li><strong>ç¬¬äºŒæ¬¡åŠ è½½åˆ™æ˜¯å®Œå…¨åŠ è½½</strong><ul>\n<li>è¯»å–ç³»ç»Ÿæ‰€éœ€è¦çš„æ‰€æœ‰ä¾èµ–</li>\n<li>è¦†ç›–ç¬¬ä¸€æ¬¡åŠ è½½çš„é…ç½®</li>\n</ul>\n</li>\n</ul>\n<p>ç®€å•åœ°ï¼Œ<strong>ç¬¬ä¸€æ¬¡åŠ è½½å°±æ˜¯åŠ è½½æœ€åŸºæœ¬åŠŸèƒ½</strong>ï¼Œ<strong>ç¬¬äºŒæ¬¡åŠ è½½å°±æ˜¯å®Œå…¨åŠ è½½å¹¶å¯¹ç¬¬ä¸€æ¬¡åŠ è½½é…ç½®è¿›è¡Œè¦†ç›–</strong></p>\n<h2 id=\"viper\"><a href=\"#viper\" class=\"headerlink\" title=\"viper\"></a>viper</h2><h3 id=\"åˆå§‹åŒ–viper\"><a href=\"#åˆå§‹åŒ–viper\" class=\"headerlink\" title=\"åˆå§‹åŒ–viper\"></a>åˆå§‹åŒ–viper</h3><p><a href=\"https://github.com/spf13/viper\">https://github.com/spf13/viper</a></p>\n<p>é¦–å…ˆå‡†å¤‡å¥½é…ç½®æœ¬åœ°æ–‡ä»¶</p>\n<p><img src=\"https://raw.githubusercontent.com/lyydsheep/pic/main/202408311457339.png\" alt=\"img\"></p>\n<p>æ¥ç€ä½¿ç”¨viper<strong>è¯»å–æœ¬åœ°çš„é…ç½®æ–‡ä»¶</strong>ï¼Œå…·ä½“æœ‰ä¸¤ç§åˆå§‹åŒ–viperçš„æ–¹æ³•</p>\n<ul>\n<li><p>ç›´æ¥æŒ‡å®šç›®æ ‡é…ç½®æ–‡ä»¶çš„è·¯å¾„</p>\n<ul>\n<li><p><code>viper.SetConfigFile()</code>ï¼šåŠ è½½é…ç½®æ–‡ä»¶</p>\n</li>\n<li><p><code>viper.ReadInConfig()</code>ï¼šè¯»å–é…ç½®æ–‡ä»¶å†…å®¹</p>\n</li>\n<li><pre><code class=\"Go\">// è®¾å®šviperå°†è¦è¯»å–çš„æ–‡ä»¶\n// viperä»å½“å‰å·¥ä½œç›®å½•ä¸‹è¿›è¡Œå®šä½\nviper.SetConfigFile(&quot;config/dev.yaml&quot;)\nerr := viper.ReadInConfig()\nif err != nil &#123;\n    panic(err)\n&#125;\n<figure class=\"highlight plaintext\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"></span><br><span class=\"line\">- åˆ†åˆ«æŒ‡å®šç›®æ ‡é…ç½®æ–‡ä»¶çš„ç±»å‹ã€åç§°ã€å­ç›®å½•</span><br><span class=\"line\"></span><br><span class=\"line\">  - `viper.SetConfigType()`ã€`viper.SetConfigName()`ã€`viper.AddConfigPath()`ï¼šåŠ è½½é…ç½®æ–‡ä»¶</span><br><span class=\"line\"></span><br><span class=\"line\">  - `viper.ReadInConfig()`ï¼šè¯»å–é…ç½®æ–‡ä»¶å†…å®¹</span><br><span class=\"line\">  </span><br><span class=\"line\">  - ```Go</span><br><span class=\"line\">    // è®¾å®šviperå°†è¦è¯»å–çš„æ–‡ä»¶</span><br><span class=\"line\">    // viperä»å½“å‰å·¥ä½œç›®å½•ä¸‹è¿›è¡Œå®šä½</span><br><span class=\"line\">    viper.SetConfigType(&quot;yaml&quot;)</span><br><span class=\"line\">    viper.SetConfigName(&quot;dev&quot;)</span><br><span class=\"line\">    viper.AddConfigPath(&quot;config&quot;)</span><br><span class=\"line\">    err := viper.ReadInConfig()</span><br><span class=\"line\">    if err != nil &#123;</span><br><span class=\"line\">        panic(err)</span><br><span class=\"line\">    &#125;</span><br></pre></td></tr></table></figure>\n</code></pre>\n</li>\n</ul>\n</li>\n</ul>\n<p>å€¼å¾—æ³¨æ„çš„æ˜¯ï¼Œä¸ç®¡æ˜¯å‘viperä¸­ç›´æ¥ä¼ å…¥è·¯å¾„è¿˜æ˜¯å­ç›®å½•ï¼Œéƒ½æ˜¯ä»<strong>å½“å‰Goçš„å·¥ä½œç›®å½•å¼€å§‹å®šä½çš„</strong></p>\n<p>å¯ä»¥åœ¨Goland IDEä¸­æŸ¥çœ‹working directory</p>\n<img src=\"https://raw.githubusercontent.com/lyydsheep/pic/main/202408311457921.png\" width = 600px>\n\n<h3 id=\"è¯»å–viperé…ç½®\"><a href=\"#è¯»å–viperé…ç½®\" class=\"headerlink\" title=\"è¯»å–viperé…ç½®\"></a>è¯»å–viperé…ç½®</h3><p>ä»viperä¸­è¯»å–æŸä¸€é…ç½®é¡¹æœ‰ä¸¤ç§å¸¸ç”¨çš„æ–¹æ³•</p>\n<ul>\n<li>ç›´æ¥è¯»å–æŸä¸€ä¸ªé…ç½®</li>\n<li>å®šä¹‰ä¸€ä¸ªç»“æ„ä½“ï¼Œç”¨äºæ¥æ”¶æ‰€æœ‰çš„é…ç½®é¡¹</li>\n</ul>\n<p>ç¬¬äºŒç§æ–¹æ³•æ¯”è¾ƒæ¨èä½¿ç”¨ï¼Œæˆ‘ä»¬å¯ä»¥åœ¨IOCä¸­ï¼Œä¹Ÿå°±æ˜¯éœ€è¦ä½¿ç”¨é…ç½®é¡¹çš„åˆå§‹åŒ–çš„åœ°æ–¹ï¼Œå®šä¹‰ä¸€ä¸ªå†…éƒ¨ç»“æ„ä½“ç”¨äºæ¥æ”¶æ‰€æœ‰çš„é…ç½®é¡¹</p>\n<p>æœ‰ä¸¤ä¸ªæ³¨æ„ç‚¹ï¼š</p>\n<ol>\n<li><strong>å†…éƒ¨ç»“æ„ä½“å­—æ®µè¦æ±‚åŒ…å¤–èƒ½å¤Ÿè®¿é—®ï¼ˆå³é¦–å­—æ¯å¤§å†™ï¼‰</strong></li>\n<li><strong>æŒ‡æ˜å°†è¦è¯»å–çš„æ•°æ®æ ¼å¼ä»¥åŠå­—æ®µåç§°</strong></li>\n</ol>\n<figure class=\"highlight go\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">type</span> Config <span class=\"keyword\">struct</span> &#123;</span><br><span class=\"line\">\t<span class=\"comment\">// æŒ‡æ˜è¯»å–æ•°æ®æ ¼å¼ä»¥åŠå­—æ®µåç§°</span></span><br><span class=\"line\">\t<span class=\"comment\">// ç»“æ„ä½“å†…çš„å­—æ®µè¦ä¿è¯åŒ…å¤–èƒ½è®¿é—®ï¼Œå¦åˆ™æ— æ³•æˆåŠŸåˆå§‹åŒ–</span></span><br><span class=\"line\">\tDSN <span class=\"type\">string</span> <span class=\"string\">`yaml:&quot;dsn&quot;`</span></span><br><span class=\"line\">&#125;</span><br><span class=\"line\"><span class=\"keyword\">var</span> config Config</span><br><span class=\"line\"><span class=\"comment\">// æŒ‡å®šè¦è¯»å–çš„key</span></span><br><span class=\"line\">err := viper.UnmarshalKey(<span class=\"string\">&quot;db&quot;</span>, &amp;config)</span><br><span class=\"line\"><span class=\"keyword\">if</span> err != <span class=\"literal\">nil</span> &#123;</span><br><span class=\"line\">\t<span class=\"built_in\">panic</span>(err)</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n\n<h3 id=\"è®¾ç½®viperé»˜è®¤å€¼\"><a href=\"#è®¾ç½®viperé»˜è®¤å€¼\" class=\"headerlink\" title=\"è®¾ç½®viperé»˜è®¤å€¼\"></a>è®¾ç½®viperé»˜è®¤å€¼</h3><p>æœ‰çš„æ—¶å€™é…ç½®æ–‡ä»¶ä¸­ç¼ºå°‘ä¸€äº›å¿…è¦çš„é…ç½®é¡¹ä¿¡æ¯ï¼Œè¿™ä¸ªæ—¶å€™å°±éœ€è¦ä½¿ç”¨ä¸Šviperçš„é…ç½®é»˜è®¤å€¼ã€‚ä¾‹å¦‚ï¼Œå¦‚æœæˆ‘å¿˜è®°äº†å†™DBçš„é…ç½®ï¼Œé‚£ä¹ˆå°±åº”è¯¥é»˜è®¤ä½¿ç”¨<code>localhost:3306</code></p>\n<p>åœ¨viperä¸­æœ‰ä¸¤ç§å®ç°é»˜è®¤å€¼çš„æ–¹æ¡ˆï¼š</p>\n<ul>\n<li>ä½¿ç”¨viperçš„<code>SetDefault()</code>æ–¹æ³•</li>\n<li>åˆ©ç”¨ç»“æ„ä½“ï¼Œåœ¨<code>UnmarshalKey()</code>ä¹‹å‰è®¾ç½®å¥½é»˜è®¤å€¼<ul>\n<li>æ¨èè¿™ç§ï¼Œå› ä¸ºå¯ä»¥æŠŠé»˜è®¤å€¼æ”¾åœ¨åˆå§‹åŒ–çš„åœ°æ–¹</li>\n</ul>\n</li>\n</ul>\n<h3 id=\"viperåŠ¨æ€è¯»å–é…ç½®\"><a href=\"#viperåŠ¨æ€è¯»å–é…ç½®\" class=\"headerlink\" title=\"viperåŠ¨æ€è¯»å–é…ç½®\"></a>viperåŠ¨æ€è¯»å–é…ç½®</h3><p>ä¸€èˆ¬è€Œè¨€ï¼Œä¸€ä¸ªé¡¹ç›®å¯èƒ½å¤„åœ¨å¤šä¸ªç¯å¢ƒä¸­ï¼Œä¾‹å¦‚ï¼šå¼€å‘ç¯å¢ƒã€æµ‹è¯•ç¯å¢ƒã€çº¿ä¸Šç¯å¢ƒï¼Œåœ¨ä¸åŒç¯å¢ƒä¸­å¿…ç„¶éœ€è¦ä½¿ç”¨åˆ°ä¸åŒçš„é…ç½®ä¿¡æ¯ï¼Œé‚£ä¹ˆè¿™å°±ä¼šè¦æ±‚æˆ‘ä»¬èƒ½å¤ŸåŠ¨æ€åœ°è¯»å–é…ç½®</p>\n<img src=https://raw.githubusercontent.com/lyydsheep/pic/main/202409011938249.png width=500px>\n\n<p>æˆ‘ä»¬å¯ä»¥åœ¨å¯åŠ¨é¡¹ç›®æ—¶ä¼ å…¥ä¸€ä¸ªconfigå‚æ•°ï¼Œè¿™ä¸ªconfigå‚æ•°å°±æ˜¯æ­¤æ¬¡å°†è¯»å–çš„é…ç½®æ–‡ä»¶è·¯å¾„</p>\n<figure class=\"highlight go\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\">// åˆå§‹åŒ–é…ç½®æ–‡ä»¶è·¯å¾„æŒ‡é’ˆï¼Œå¹¶è®¾å®šé»˜è®¤å€¼</span></span><br><span class=\"line\">cfile := pflag.String(<span class=\"string\">&quot;config&quot;</span>, <span class=\"string\">&quot;config/hello.yaml&quot;</span>, <span class=\"string\">&quot;é…ç½®æ–‡ä»¶è·¯å¾„&quot;</span>)</span><br><span class=\"line\"><span class=\"comment\">// æ¥æ”¶configå‚æ•°</span></span><br><span class=\"line\">pflag.Parse()</span><br><span class=\"line\">viper.SetConfigFile(*cfile)</span><br><span class=\"line\">err := viper.ReadInConfig()</span><br></pre></td></tr></table></figure>\n\n\n\n<p>å¯ä»¥åœ¨Goland IDEä¸­è®¾ç½®configå‚æ•°</p>\n<img src = https://raw.githubusercontent.com/lyydsheep/pic/main/202409011948441.png width=600px>\n\n<h3 id=\"viperè¯»å–è¿œç¨‹é…ç½®ä¸­å¿ƒ\"><a href=\"#viperè¯»å–è¿œç¨‹é…ç½®ä¸­å¿ƒ\" class=\"headerlink\" title=\"viperè¯»å–è¿œç¨‹é…ç½®ä¸­å¿ƒ\"></a>viperè¯»å–è¿œç¨‹é…ç½®ä¸­å¿ƒ</h3><h4 id=\"å®‰è£…etcdå’Œetcdctl\"><a href=\"#å®‰è£…etcdå’Œetcdctl\" class=\"headerlink\" title=\"å®‰è£…etcdå’Œetcdctl\"></a>å®‰è£…etcdå’Œetcdctl</h4><p>ä½¿ç”¨docker composeå®‰è£…etcd</p>\n<p><img src=\"https://raw.githubusercontent.com/lyydsheep/pic/main/202409012055638.png\"></p>\n<p><strong>etcdctlæ²¡æœ‰å®‰è£…æˆåŠŸï¼Œä¸æ˜æ‰€ä»¥</strong></p>\n<p>pathç”¨äºåŒºåˆ«å…¶ä»–ä½¿ç”¨etcdçš„åº”ç”¨</p>\n<p><img src=\"https://raw.githubusercontent.com/lyydsheep/pic/main/202409011521927.png\" alt=\"image-20240901152107902\"></p>\n"},{"_content":"\n\n\n# é˜…è¯»ã€ç‚¹èµã€æ”¶è—\n\n## éœ€æ±‚åˆ†æ\n\n- é˜…è¯»æ•°é‡åœ¨ç‚¹å‡»æ–‡ç« ä¹‹åå°±ä¼š+1ï¼Œåœ¨é€€å‡ºæ–‡ç« åä¹Ÿä¸ä¼š-1\n- ç‚¹èµå’Œæ”¶è—æ•°æ—¢å¯ä»¥+1ï¼Œä¹Ÿå¯ä»¥-1\n- æœ‰æ—¶æ”¶è—çš„å†…å®¹ä¼šæ”¾åœ¨æ”¶è—å¤¹ï¼Œå–æ¶ˆæ”¶è—åˆ™è¦ç§»é™¤æ”¶è—å¤¹\n\nå¦ä¸€æ–¹é¢ï¼Œå¯¹äºä¸€ä¸ªå¹³å°ï¼Œä¸è®ºæ˜¯æ–‡ç« ã€è§†é¢‘è¿˜æ˜¯è¯„è®ºï¼Œè¿™äº›å¯¹è±¡éƒ½ä¼šæœ‰é˜…è¯»ã€ç‚¹èµã€æ”¶è—ç­‰å±æ€§å­—æ®µã€‚è¿™ä¹Ÿå°±æ„å‘³ç€ï¼Œæˆ‘ä»¬æä¾›çš„æ¥å£ä¸èƒ½åªé™åˆ¶åº”ç”¨äºæ–‡ç« ï¼Œè€Œæ˜¯ä¸€ä¸ª**é¢å‘ä»»ä½•èµ„æºéƒ½èƒ½ä½¿ç”¨çš„é˜…è¯»ã€ç‚¹èµã€æ”¶è—åŠŸèƒ½æ¥å£**\n\næ›´è¿›ä¸€æ­¥åœ°ï¼Œéœ€è¦åˆ†æé˜…è¯»ã€ç‚¹èµã€æ”¶è—è¿™ä¸‰è€…ä¹‹é—´çš„ç•Œé™ã€‚å®é™…å¯ä»¥è€ƒè™‘ä¸€ä¸‹ä¸‰ä¸ªæ–¹é¢ï¼š\n\n- åœºæ™¯\n- æ€§èƒ½\n- ç ”å‘\n\n## é˜…è¯»æ•°åŠŸèƒ½è®¾è®¡ä¸å®ç°\n\nè®¾è®¡ä¸€ä¸ª`InteractService`æ¥å£ï¼Œè¯¥æ¥å£æä¾›ä¸€ä¸ª`IncReadCnt`æ–¹æ³•ï¼Œæ¯å½“è°ƒç”¨é˜…è¯»æ¥å£æ—¶ï¼Œå°±æ˜¯è¯¥æ–¹æ³•å°†å¯¹è±¡çš„é˜…è¯»æ•°å­—æ®µ+1ã€‚\n\nè€ƒè™‘æç«¯æƒ…å†µï¼Œå¦‚æœæ˜¯ç¬¬ä¸€æ¬¡å¯¹æŸä¸ªå¯¹è±¡è°ƒç”¨`IncReadCnt`æ–¹æ³•ï¼Œé‚£ä¹ˆæ­¤æ—¶æ•°æ®åº“ä¸­æ˜¯æ²¡æœ‰è¯¥è®°å½•çš„ï¼Œéœ€è¦è¿›è¡Œinsertæ“ä½œï¼Œè€Œç¬¬äºŒæ¬¡ã€ç¬¬ä¸‰æ¬¡è°ƒç”¨æ—¶åˆ™æ˜¯è¿›è¡Œupdateæ“ä½œã€‚ç”±æ­¤å¯è§ï¼Œ`IncReadCnt`æ–¹æ³•åº”è¯¥å®ç°**upsert**æ“ä½œï¼šæœ‰è®°å½•åˆ™æ›´æ–°`read_cnt`å­—æ®µï¼Œæ²¡æœ‰è®°å½•åˆ™æ’å…¥ä¸€æ¡è®°å½•\n\n**å¤ä¹ ä¸€ä¸‹GORMå®ç°upsertæ“ä½œ**ï¼š\n\n```go\ndao.db.WithContext(ctx).Clauses(clause.OnConflict{\n    DoUpdates: clause.Assignments(map[string]any{\n        // ç›´æ¥ä½¿ç”¨ `read_cnt` = `read_cnt` + 1\n        // ä¿æŒå¹¶å‘å®‰å…¨\n        \"read_cnt\": gorm.Expr(\"read_cnt + 1\"),\n        \"utime\": time.Now().UnixMilli(),\n    }).Create(&Interactive{\n        // ç•¥\n        ...\n    })\n})\n```\n\nåœ¨éœ€æ±‚åˆ†æé˜¶æ®µï¼Œæˆ‘ä»¬å¾—å‡ºç»“è®ºï¼šåº”è¯¥æä¾›ä¸€ä¸ªé¢å‘ä»»ä½•èµ„æºçš„é˜…è¯»ã€ç‚¹èµã€æ”¶è—åŠŸèƒ½æ¥å£ã€‚æ—¢ç„¶å¦‚æ­¤ï¼Œå°±å¾—æœ‰åŒºåˆ†ä¸åŒèµ„æºçš„å­—æ®µã€‚ä¸€ç§å¾ˆå¸¸è§çš„æ–¹æ³•å°±æ˜¯é‡‡ç”¨**biz + bizId**æ¥å”¯ä¸€æ ‡è¯†æŸä¸ªç‰¹å®šä¸šåŠ¡ä¸‹çš„ä¸€ä¸ªå¯¹è±¡\n\nç±»ä¼¼çš„è®¾è®¡æœ‰ï¼š\n\n- **biz + bizId**\n- **resource type + resourceId**\n- **request type + requestId**\n\n### ç¼“å­˜è®¾è®¡\n\nåœ¨ä»»ä½•ä¸€ä¸ªå¹³å°ï¼Œé˜…è¯»é‡ã€ç‚¹èµã€æ”¶è—éƒ½æ˜¯é«˜é¢‘è®¿é—®æ•°æ®ã€‚å› æ­¤éœ€è¦**åšå¥½ç¼“å­˜ï¼Œé˜²æ­¢è¶…é«˜çš„QPSå‹å®æ•°æ®åº“**\n\nè¿™é‡Œé€‰æ‹©ä½¿ç”¨Redisçš„Hashesç»“æ„ï¼Œä¸€ä¸ªkeyä¸­åŒæ—¶ä¿å­˜`read_cnt`,`like_cnt`,`collect_cnt`å­—æ®µ\n\n> ä¸ºä»€ä¹ˆä¸æ˜¯ä¸‰ä¸ªï¼ˆå¹¿ä¹‰ä¸Šï¼‰Redisåˆ†åˆ«ä¿å­˜ä¸‰ä¸ªå­—æ®µçš„å±æ€§å€¼ï¼ŸğŸ¤”\n>\n> ä¸€ä¸ªåŸå› æ˜¯ï¼šé˜…è¯»ã€ç‚¹èµã€æ”¶è—è¿™ä¸‰ä¸ªå­—æ®µç»å¸¸ä¸€åŒå‡ºç°ï¼Œå¦‚æœç”¨ä¸€ä¸ªkeyä¿å­˜ï¼Œé‚£ä¹ˆåªéœ€è¦è¿›è¡Œä¸€æ¬¡RedisæŸ¥è¯¢å°±èƒ½æ‹¿åˆ°ä¸‰ä¸ªå­—æ®µå€¼\n>\n> å¦ä¸€ä¸ªåŸå› æ˜¯ï¼šå¦‚æœä½¿ç”¨ä¸‰ä¸ªRedisä¿å­˜ï¼Œé‚£ä¹ˆä¸ºäº†ç¡®ä¿è¯»å–ä¸‰ä¸ªRedisæ“ä½œçš„åŸå­æ€§ï¼Œå°±å¿…é¡»ä½¿ç”¨luaç¼–å†™å¤æ‚è„šæœ¬ï¼ˆè€Œä¸”æ€§èƒ½å¯èƒ½ä¼šæœ‰ä¸€å®šæŸå¤±ğŸ§ï¼‰\n\næšä¸¾ä½¿ç”¨ç¼“å­˜å¯èƒ½å‘ç”Ÿçš„åœºæ™¯ï¼š\n\n- æ²¡æœ‰Key\n- æœ‰Keyä¸”æœ‰ç›¸åº”çš„å­—æ®µ\n- æœ‰Keyä½†æ²¡æœ‰ç›¸åº”çš„å­—æ®µ\n\nå¹¸è¿åœ°æ˜¯ï¼ŒRedisæä¾›äº†ä¸€ä¸ª**HCINRBY** apiï¼ˆè¯¦è§ä¸‹å›¾ï¼‰ï¼Œå¯ä»¥æœ‰æ•ˆè§£å†³åä¸¤ç§æƒ…å†µ\n\n<img src=\"https://raw.githubusercontent.com/lyydsheep/pic/main/202410091421095.png\" alt=\"image-20241009142111996\" style=\"zoom: 67%;\" />\n\nå¯¹äºæƒ…å†µä¸€ï¼šæˆ‘ä»¬å°±éœ€è¦äº‹å…ˆåˆ¤æ–­ä¸€ä¸‹Rediä¸­çš„keyæ˜¯å¦å­˜åœ¨ï¼Œå¦‚æœå­˜åœ¨å°±æŠŠå¯¹åº”çš„å­—æ®µ+1ã€‚**è¿™æ˜¯ä¸€ä¸ªå…¸å‹çš„check-do somethingåœºæ™¯ï¼Œå¯ä»¥è€ƒè™‘ä½¿ç”¨luaè„šæœ¬ç¡®ä¿æ²¡æœ‰å¹¶å‘é—®é¢˜**\n\n### æ³¨æ„äº‹é¡¹\n\nâš ï¸ï¼šå­˜å‚¨å¯¹è±¡ä¸­çš„stringç±»å‹é»˜è®¤å¯¹åº”ç€MySQLä¸­çš„BLOB/TEXTç±»å‹ï¼Œéœ€è¦ç”¨`tag`æ˜ç¡®æŒ‡å®š`varchar`ç±»å‹\n\n![image-20241011192816540](https://raw.githubusercontent.com/lyydsheep/pic/main/202410111928510.png)\n\n**å…ˆæ›´æ–°æ•°æ®åº“ï¼Œå†æ›´æ–°ç¼“å­˜**\n\n![image-20241012151321298](https://raw.githubusercontent.com/lyydsheep/pic/main/202410121513334.png)\n\n## ç‚¹èµåŠŸèƒ½è®¾è®¡ä¸å®ç°\n\n### éœ€æ±‚åˆ†æ\n\nç‚¹èµäº‹å®ä¸Šåˆ†æˆä¸¤ä¸ªéƒ¨åˆ†ï¼š\n\n- ä¿ç•™æŸä¸ªç”¨æˆ·æ˜¯å¦ç‚¹èµè¿‡ï¼Œå¹¶ä¸”ç”¨æˆ·å¯ä»¥å–æ¶ˆç‚¹èµ\n- ç»Ÿè®¡ç‚¹èµæ•°é‡\n\nç»Ÿè®¡ç‚¹èµæ•°é‡å’Œç»Ÿè®¡é˜…è¯»æ•°é‡çš„æ€è·¯æ˜¯ä¸€æ ·çš„ï¼Œ**ä¸è¿‡éœ€è¦é¢å¤–è®°å½•ç”¨æˆ·æ˜¯å¦å¯¹æŸä¸ªèµ„æºå·²ç»ç‚¹è¿‡èµ**\n\n<img src=\"https://raw.githubusercontent.com/lyydsheep/pic/main/202410130733005.png\" alt=\"image-20241012142803292\" style=\"zoom:50%;\" />\n\n### åŠŸèƒ½å®ç°\n\nä¸ºäº†ç®€åŒ–å‰ç«¯ä»£ç ï¼Œå¯ä»¥å°†ç‚¹èµå’Œå–æ¶ˆç‚¹èµè½¬å‘è‡³åŒä¸€ä¸ªæ¥å£ä¸Šï¼Œé€šè¿‡ä¸€ä¸ª`like`å­—æ®µè¿›è¡ŒåŒºåˆ†\n\n- `true`ï¼Œé‚£ä¹ˆæ˜¯ç‚¹èµ\n- `false`ï¼Œé‚£ä¹ˆæ˜¯å–æ¶ˆç‚¹èµ\n\nå¹¶åœ¨Handlerä¸­æ ¹æ®`like`å€¼ï¼Œè°ƒç”¨ä¸åŒçš„æ–¹æ³•\n\n#### è½¯åˆ é™¤\n\næ¶‰åŠåˆ°ç”¨æˆ·å¯ä»¥æ’¤é”€æŸä¸ªè¡Œä¸ºçš„åœºæ™¯ï¼ˆä¾‹å¦‚æœ¬å¤„å°±æ˜¯å–æ¶ˆç‚¹èµï¼‰ï¼Œé€šå¸¸æœ‰ä¸¤ç§æ“ä½œæ•°æ®çš„æ–¹å¼\n\n- **ç¡¬åˆ é™¤**ï¼šç›´æ¥å°†æ•°æ®åº“ä¸­çš„è®°å½•åˆ é™¤\n- **è½¯åˆ é™¤**ï¼šå°†è®°å½•ä¸­çš„`status`å­—æ®µè®¾ç½®æˆ`2`\n  - é€šå¸¸ä¸ºäº†é¿å…**é›¶å€¼é—®é¢˜**ï¼Œäººä¸ºè§„å®š`status = 1`æ ‡è¯†è®°å½•å­˜åœ¨ï¼Œ`status = 2`æ ‡è¯†è®°å½•è¢«åˆ é™¤\n\n<img src=\"https://raw.githubusercontent.com/lyydsheep/pic/main/202410121436840.png\" alt=\"image-20241012143649799\" style=\"zoom:67%;\" />\n\nç›¸è¾ƒäºè½¯åˆ é™¤ï¼Œç¡¬åˆ é™¤ä¼šäº§ç”Ÿå¾ˆå¤š**ç©ºæ´**ï¼Œå½±å“MySQLæ€§èƒ½ã€‚æ¢å¥è¯è¯´ï¼Œ**è½¯åˆ é™¤çš„æ€§èƒ½æ›´å¥½**\n\nåŒæ ·åœ°ï¼Œåœ¨DAOå±‚é¢ï¼Œå¯¹äºç‚¹èµæ“ä½œï¼Œä¸èƒ½ç¡®å®šæ˜¯ç¬¬ä¸€æ¬¡ç‚¹èµè¿˜ä¼šå†æ¬¡ç‚¹èµã€‚å› æ­¤éœ€è¦é‡‡ç”¨**upsert**æ“ä½œ\n\n![image-20241011201326778](https://raw.githubusercontent.com/lyydsheep/pic/main/202410112013864.png)\n\n## æ”¶è—åŠŸèƒ½è®¾è®¡ä¸å®ç°\n\nè¿™é‡Œéœ€è¦å¼•å…¥æ”¶è—å¤¹çš„æ¦‚å¿µ\n\næ€»ä½“ä¸Šå°±æ˜¯ä¸¤å¼ è¡¨ï¼š\n\n- **æ”¶è—å¤¹æœ¬ä½“**ï¼šä¹Ÿå°±æ˜¯æ”¶è—å¤¹æœ¬èº«ï¼Œä»¥åŠå…¶å½’å±çš„ç”¨æˆ·\n- **æ”¶è—å¤¹å’Œèµ„æºçš„å…³è”å…³ç³»**\n\n![image-20241013101806634](https://raw.githubusercontent.com/lyydsheep/pic/main/202410131018715.png)\n\næ”¶è—å¤¹ä¸­ä¼šæœ‰å¤šä¸ªé¡¹ç›®ï¼Œå› æ­¤æ”¶è—å¤¹å’Œæ”¶è—å¤¹ä¸­çš„å†…å®¹æ˜¯1ï¼šNçš„å…³ç³»\n\nå…·ä½“å®ç°å’Œé˜…è¯»æ•°ã€ç‚¹èµæ•°ç±»ä¼¼ï¼Œéƒ½æ˜¯è¦**upsertè¯­ä¹‰ï¼Œä»¥åŠ`collect_cnt = collect_cnt + 1`** \n\n### æŸ¥è¯¢æ¥å£\n\nå‚è€ƒç«å“ï¼š\n\n<img src=\"https://raw.githubusercontent.com/lyydsheep/pic/main/202410131110917.png\" alt=\"image-20241013111021697\" style=\"zoom:50%;\" />\n\nåœ¨å‰ç«¯åšå±•ç¤ºä¸€ç‰‡æ–‡ç« ã€è§†é¢‘ç­‰èµ„æºæ—¶ï¼Œéœ€è¦å°†**èµ„æºæœ¬ä½“ã€é˜…è¯»æ•°ã€ç‚¹èµæ•°ã€æ”¶è—æ•°ç­‰**ä¸€åŒæ˜¾ç¤º\n\nå› ä¸ºåœ¨å®ç°é˜…è¯»ã€ç‚¹èµã€æ”¶è—æ—¶ï¼Œå°†è¿™äº›å­—æ®µè§†ä¸ºäº†**ä¸€ä¸ªç‹¬ç«‹çš„é¢†åŸŸ**ï¼Œæ‰€ä»¥éœ€è¦æä¾›ä¸¤ä¸ªæ¥å£åˆ†åˆ«å¯¹æ•°æ®å’Œèµ„æºè¿›è¡ŒæŸ¥è¯¢ï¼Œå¹¶**åœ¨Webå±‚é¢è¿›è¡Œèšåˆ**ã€‚å¦ä¸€ç§å¯è¡Œçš„æ–¹æ¡ˆå°±æ˜¯å°†æ•°æ®ä½œä¸ºæ–‡ç« çš„å­å¯¹è±¡ï¼Œé‚£ä¹ˆå°±å¯ä»¥åœ¨Serviceå±‚è¿›è¡Œèšåˆ\n\nè€ƒè™‘åˆ°éœ€è¦è¿›è¡ŒæŸ¥è¯¢å¤šä¸ªè¡¨çš„æ“ä½œï¼Œä¸ºäº†æé«˜æ€§èƒ½ï¼Œå¯ä»¥ä½¿ç”¨**errgroupæ¥å¹¶å‘æŸ¥è¯¢æ•°æ®å’Œèµ„æºæœ¬ä½“**\n\nå…·ä½“Webå±‚é¢å®ç°å¦‚ä¸‹ï¼š\n\n```go\n```\n\n\n\n```go\nfunc (h *ArticleHandler) PubDetail(ctx *gin.Context, c jwt.UserClaims, req ArticleReq) (ginx.Result, error) {\n\tuid := c.UserId\n\tvar eg errgroup.Group\n\tvar art domain.Article\n\teg.Go(func() error {\n\t\tvar err error\n\t\tart, err = h.svc.PubDetail(ctx, req.BizId)\n\t\tif err != nil {\n\t\t\th.l.Error(\"è·å–æ–‡ç« å¤±è´¥\", zap.Error(err))\n\t\t}\n\t\treturn err\n\t})\n\tvar intr domain.Interact\n\teg.Go(func() error {\n\t\tvar err error\n\t\tintr, err = h.interactSvc.Get(ctx, req.Biz, req.BizId, uid)\n\t\tif err != nil {\n\t\t\th.l.Error(\"è·å–æ–‡ç« æ•°æ®å¤±è´¥\", zap.Error(err))\n\t\t}\n\t\treturn err\n\t})\n\terr := eg.Wait()\n\tif err != nil {\n\t\treturn ginx.Result{}, err\n\t}\n\tgo func() {\n\t\tvar err error\n\t\terr = h.interactSvc.IncReadCnt(ctx, req.Biz, req.BizId)\n\t\tif err != nil {\n\t\t\th.l.Error(\"å¢åŠ é˜…è¯»æ•°å¤±è´¥\", zap.Error(err))\n\t\t}\n\t}()\n\treturn ginx.Result{\n\t\tData: ArticleVO{\n\t\t\tId:         art.Id,\n\t\t\tTitle:      art.Title,\n\t\t\tContent:    art.Content,\n\t\t\tAuthorName: art.Author.Name,\n\t\t\tReadCnt:    intr.ReadCnt,\n\t\t\tLikeCnt:    intr.LikeCnt,\n\t\t\tCollectCnt: intr.CollectCnt,\n\t\t\tLiked:      intr.Liked,\n\t\t\tCollected:  intr.Collected,\n\t\t\tCtime:      time.UnixMilli(art.Ctime).Format(time.DateTime),\n\t\t\tUtime:      time.UnixMilli(art.Utime).Format(time.DateTime),\n\t\t},\n\t}, nil\n}\n\n```\n\n\n\nâš ï¸ï¼š\n\n- **æ–¹æ³•ä¸ç›´æ¥ä¿®æ”¹å‚æ•°ï¼Œè€Œæ˜¯é€šè¿‡è¿”å›å€¼é—´æ¥ä¿®æ”¹å‚æ•°**\n\n- è¿”å›å€¼çš„ç±»å‹é€‰æ‹©ï¼š\n\n  - å¦‚æœæŒ‡é’ˆå®ç°äº†æ¥å£ï¼Œé‚£å°±è¿”å›æŒ‡é’ˆ\n\n  - å¦‚æœè¿”å›å€¼å¾ˆå¤§ï¼Œé¿å…ä¼ é€’å¼•å‘å¤åˆ¶ï¼Œé‚£å°±è¿”å›æŒ‡é’ˆ\n\n- ç®€æ˜“åŸåˆ™ï¼š\n\n  - æ¥æ”¶å™¨æ°¸è¿œç”¨æŒ‡é’ˆ\n  - è¾“å…¥è¾“å‡ºéƒ½ç”¨ç»“æ„ä½“\n\n- ä¸æ˜¯æ‰€æœ‰ç»“æ„ä½“éƒ½æ˜¯å¯æ¯”è¾ƒçš„\n\n## åŠŸèƒ½å®ç°å°ç»“\n\n- **å¤§é‡ä½¿ç”¨äº‹ç‰©**ï¼Œä¿è¯åœ¨æ“ä½œä¸¤å¼ è¡¨æ—¶ä¿æŒACIDç‰¹æ€§\n- **å¤§é‡ä½¿ç”¨Upsertè¯­ä¹‰**ï¼Œå› ä¸ºå¾ˆå¤šæƒ…å†µä¸‹æˆ‘ä»¬ä¸çŸ¥é“è¡¨ä¸­æ˜¯å¦æœ‰å¯¹åº”çš„æ•°æ®\n- **å¤§é‡ä½¿ç”¨luaè„šæœ¬æ¥ä¿è¯ç¼“å­˜ä¸­çš„æ•°æ®æ˜¯æ­£ç¡®çš„**ï¼Œä½†æ˜¯æ— æ³•å½»åº•è§£å†³ç¼“å­˜ä¸€è‡´æ€§é—®é¢˜\n- **åœ¨æŸ¥è¯¢æ¥å£è¿™ä¸ªå‘¢ï¼Œåªç¼“å­˜æ€»æ•°æ•°æ®**ï¼Œå¹¶ä¸ä¼šç¼“å­˜ä¸ªäººæ˜¯å¦ç‚¹èµã€æ˜¯å¦æ”¶è—çš„æ•°æ®\n- **ç¼“å­˜ä¸€è‡´æ€§è™½ç„¶å¾ˆé‡è¦ï¼Œä½†ä¸æ˜¯æ‰€æœ‰çš„åœºæ™¯éƒ½å¿…é¡»ç»´æŠ¤**ã€‚å¦ä¸€æ–¹é¢ï¼Œéœ€è¦å½»åº•è§£å†³ç¼“å­˜ä¸€è‡´æ€§é—®é¢˜çš„åœºæ™¯ï¼Œå°±ä¸åº”è¯¥ä½¿ç”¨ç¼“å­˜\n\n","source":"_posts/Go/é˜…è¯»ã€ç‚¹èµã€æ”¶è—åŠŸèƒ½.md","raw":"---\ntag:\n- Go\n- å­¦ä¹ \n---\n\n\n\n# é˜…è¯»ã€ç‚¹èµã€æ”¶è—\n\n## éœ€æ±‚åˆ†æ\n\n- é˜…è¯»æ•°é‡åœ¨ç‚¹å‡»æ–‡ç« ä¹‹åå°±ä¼š+1ï¼Œåœ¨é€€å‡ºæ–‡ç« åä¹Ÿä¸ä¼š-1\n- ç‚¹èµå’Œæ”¶è—æ•°æ—¢å¯ä»¥+1ï¼Œä¹Ÿå¯ä»¥-1\n- æœ‰æ—¶æ”¶è—çš„å†…å®¹ä¼šæ”¾åœ¨æ”¶è—å¤¹ï¼Œå–æ¶ˆæ”¶è—åˆ™è¦ç§»é™¤æ”¶è—å¤¹\n\nå¦ä¸€æ–¹é¢ï¼Œå¯¹äºä¸€ä¸ªå¹³å°ï¼Œä¸è®ºæ˜¯æ–‡ç« ã€è§†é¢‘è¿˜æ˜¯è¯„è®ºï¼Œè¿™äº›å¯¹è±¡éƒ½ä¼šæœ‰é˜…è¯»ã€ç‚¹èµã€æ”¶è—ç­‰å±æ€§å­—æ®µã€‚è¿™ä¹Ÿå°±æ„å‘³ç€ï¼Œæˆ‘ä»¬æä¾›çš„æ¥å£ä¸èƒ½åªé™åˆ¶åº”ç”¨äºæ–‡ç« ï¼Œè€Œæ˜¯ä¸€ä¸ª**é¢å‘ä»»ä½•èµ„æºéƒ½èƒ½ä½¿ç”¨çš„é˜…è¯»ã€ç‚¹èµã€æ”¶è—åŠŸèƒ½æ¥å£**\n\næ›´è¿›ä¸€æ­¥åœ°ï¼Œéœ€è¦åˆ†æé˜…è¯»ã€ç‚¹èµã€æ”¶è—è¿™ä¸‰è€…ä¹‹é—´çš„ç•Œé™ã€‚å®é™…å¯ä»¥è€ƒè™‘ä¸€ä¸‹ä¸‰ä¸ªæ–¹é¢ï¼š\n\n- åœºæ™¯\n- æ€§èƒ½\n- ç ”å‘\n\n## é˜…è¯»æ•°åŠŸèƒ½è®¾è®¡ä¸å®ç°\n\nè®¾è®¡ä¸€ä¸ª`InteractService`æ¥å£ï¼Œè¯¥æ¥å£æä¾›ä¸€ä¸ª`IncReadCnt`æ–¹æ³•ï¼Œæ¯å½“è°ƒç”¨é˜…è¯»æ¥å£æ—¶ï¼Œå°±æ˜¯è¯¥æ–¹æ³•å°†å¯¹è±¡çš„é˜…è¯»æ•°å­—æ®µ+1ã€‚\n\nè€ƒè™‘æç«¯æƒ…å†µï¼Œå¦‚æœæ˜¯ç¬¬ä¸€æ¬¡å¯¹æŸä¸ªå¯¹è±¡è°ƒç”¨`IncReadCnt`æ–¹æ³•ï¼Œé‚£ä¹ˆæ­¤æ—¶æ•°æ®åº“ä¸­æ˜¯æ²¡æœ‰è¯¥è®°å½•çš„ï¼Œéœ€è¦è¿›è¡Œinsertæ“ä½œï¼Œè€Œç¬¬äºŒæ¬¡ã€ç¬¬ä¸‰æ¬¡è°ƒç”¨æ—¶åˆ™æ˜¯è¿›è¡Œupdateæ“ä½œã€‚ç”±æ­¤å¯è§ï¼Œ`IncReadCnt`æ–¹æ³•åº”è¯¥å®ç°**upsert**æ“ä½œï¼šæœ‰è®°å½•åˆ™æ›´æ–°`read_cnt`å­—æ®µï¼Œæ²¡æœ‰è®°å½•åˆ™æ’å…¥ä¸€æ¡è®°å½•\n\n**å¤ä¹ ä¸€ä¸‹GORMå®ç°upsertæ“ä½œ**ï¼š\n\n```go\ndao.db.WithContext(ctx).Clauses(clause.OnConflict{\n    DoUpdates: clause.Assignments(map[string]any{\n        // ç›´æ¥ä½¿ç”¨ `read_cnt` = `read_cnt` + 1\n        // ä¿æŒå¹¶å‘å®‰å…¨\n        \"read_cnt\": gorm.Expr(\"read_cnt + 1\"),\n        \"utime\": time.Now().UnixMilli(),\n    }).Create(&Interactive{\n        // ç•¥\n        ...\n    })\n})\n```\n\nåœ¨éœ€æ±‚åˆ†æé˜¶æ®µï¼Œæˆ‘ä»¬å¾—å‡ºç»“è®ºï¼šåº”è¯¥æä¾›ä¸€ä¸ªé¢å‘ä»»ä½•èµ„æºçš„é˜…è¯»ã€ç‚¹èµã€æ”¶è—åŠŸèƒ½æ¥å£ã€‚æ—¢ç„¶å¦‚æ­¤ï¼Œå°±å¾—æœ‰åŒºåˆ†ä¸åŒèµ„æºçš„å­—æ®µã€‚ä¸€ç§å¾ˆå¸¸è§çš„æ–¹æ³•å°±æ˜¯é‡‡ç”¨**biz + bizId**æ¥å”¯ä¸€æ ‡è¯†æŸä¸ªç‰¹å®šä¸šåŠ¡ä¸‹çš„ä¸€ä¸ªå¯¹è±¡\n\nç±»ä¼¼çš„è®¾è®¡æœ‰ï¼š\n\n- **biz + bizId**\n- **resource type + resourceId**\n- **request type + requestId**\n\n### ç¼“å­˜è®¾è®¡\n\nåœ¨ä»»ä½•ä¸€ä¸ªå¹³å°ï¼Œé˜…è¯»é‡ã€ç‚¹èµã€æ”¶è—éƒ½æ˜¯é«˜é¢‘è®¿é—®æ•°æ®ã€‚å› æ­¤éœ€è¦**åšå¥½ç¼“å­˜ï¼Œé˜²æ­¢è¶…é«˜çš„QPSå‹å®æ•°æ®åº“**\n\nè¿™é‡Œé€‰æ‹©ä½¿ç”¨Redisçš„Hashesç»“æ„ï¼Œä¸€ä¸ªkeyä¸­åŒæ—¶ä¿å­˜`read_cnt`,`like_cnt`,`collect_cnt`å­—æ®µ\n\n> ä¸ºä»€ä¹ˆä¸æ˜¯ä¸‰ä¸ªï¼ˆå¹¿ä¹‰ä¸Šï¼‰Redisåˆ†åˆ«ä¿å­˜ä¸‰ä¸ªå­—æ®µçš„å±æ€§å€¼ï¼ŸğŸ¤”\n>\n> ä¸€ä¸ªåŸå› æ˜¯ï¼šé˜…è¯»ã€ç‚¹èµã€æ”¶è—è¿™ä¸‰ä¸ªå­—æ®µç»å¸¸ä¸€åŒå‡ºç°ï¼Œå¦‚æœç”¨ä¸€ä¸ªkeyä¿å­˜ï¼Œé‚£ä¹ˆåªéœ€è¦è¿›è¡Œä¸€æ¬¡RedisæŸ¥è¯¢å°±èƒ½æ‹¿åˆ°ä¸‰ä¸ªå­—æ®µå€¼\n>\n> å¦ä¸€ä¸ªåŸå› æ˜¯ï¼šå¦‚æœä½¿ç”¨ä¸‰ä¸ªRedisä¿å­˜ï¼Œé‚£ä¹ˆä¸ºäº†ç¡®ä¿è¯»å–ä¸‰ä¸ªRedisæ“ä½œçš„åŸå­æ€§ï¼Œå°±å¿…é¡»ä½¿ç”¨luaç¼–å†™å¤æ‚è„šæœ¬ï¼ˆè€Œä¸”æ€§èƒ½å¯èƒ½ä¼šæœ‰ä¸€å®šæŸå¤±ğŸ§ï¼‰\n\næšä¸¾ä½¿ç”¨ç¼“å­˜å¯èƒ½å‘ç”Ÿçš„åœºæ™¯ï¼š\n\n- æ²¡æœ‰Key\n- æœ‰Keyä¸”æœ‰ç›¸åº”çš„å­—æ®µ\n- æœ‰Keyä½†æ²¡æœ‰ç›¸åº”çš„å­—æ®µ\n\nå¹¸è¿åœ°æ˜¯ï¼ŒRedisæä¾›äº†ä¸€ä¸ª**HCINRBY** apiï¼ˆè¯¦è§ä¸‹å›¾ï¼‰ï¼Œå¯ä»¥æœ‰æ•ˆè§£å†³åä¸¤ç§æƒ…å†µ\n\n<img src=\"https://raw.githubusercontent.com/lyydsheep/pic/main/202410091421095.png\" alt=\"image-20241009142111996\" style=\"zoom: 67%;\" />\n\nå¯¹äºæƒ…å†µä¸€ï¼šæˆ‘ä»¬å°±éœ€è¦äº‹å…ˆåˆ¤æ–­ä¸€ä¸‹Rediä¸­çš„keyæ˜¯å¦å­˜åœ¨ï¼Œå¦‚æœå­˜åœ¨å°±æŠŠå¯¹åº”çš„å­—æ®µ+1ã€‚**è¿™æ˜¯ä¸€ä¸ªå…¸å‹çš„check-do somethingåœºæ™¯ï¼Œå¯ä»¥è€ƒè™‘ä½¿ç”¨luaè„šæœ¬ç¡®ä¿æ²¡æœ‰å¹¶å‘é—®é¢˜**\n\n### æ³¨æ„äº‹é¡¹\n\nâš ï¸ï¼šå­˜å‚¨å¯¹è±¡ä¸­çš„stringç±»å‹é»˜è®¤å¯¹åº”ç€MySQLä¸­çš„BLOB/TEXTç±»å‹ï¼Œéœ€è¦ç”¨`tag`æ˜ç¡®æŒ‡å®š`varchar`ç±»å‹\n\n![image-20241011192816540](https://raw.githubusercontent.com/lyydsheep/pic/main/202410111928510.png)\n\n**å…ˆæ›´æ–°æ•°æ®åº“ï¼Œå†æ›´æ–°ç¼“å­˜**\n\n![image-20241012151321298](https://raw.githubusercontent.com/lyydsheep/pic/main/202410121513334.png)\n\n## ç‚¹èµåŠŸèƒ½è®¾è®¡ä¸å®ç°\n\n### éœ€æ±‚åˆ†æ\n\nç‚¹èµäº‹å®ä¸Šåˆ†æˆä¸¤ä¸ªéƒ¨åˆ†ï¼š\n\n- ä¿ç•™æŸä¸ªç”¨æˆ·æ˜¯å¦ç‚¹èµè¿‡ï¼Œå¹¶ä¸”ç”¨æˆ·å¯ä»¥å–æ¶ˆç‚¹èµ\n- ç»Ÿè®¡ç‚¹èµæ•°é‡\n\nç»Ÿè®¡ç‚¹èµæ•°é‡å’Œç»Ÿè®¡é˜…è¯»æ•°é‡çš„æ€è·¯æ˜¯ä¸€æ ·çš„ï¼Œ**ä¸è¿‡éœ€è¦é¢å¤–è®°å½•ç”¨æˆ·æ˜¯å¦å¯¹æŸä¸ªèµ„æºå·²ç»ç‚¹è¿‡èµ**\n\n<img src=\"https://raw.githubusercontent.com/lyydsheep/pic/main/202410130733005.png\" alt=\"image-20241012142803292\" style=\"zoom:50%;\" />\n\n### åŠŸèƒ½å®ç°\n\nä¸ºäº†ç®€åŒ–å‰ç«¯ä»£ç ï¼Œå¯ä»¥å°†ç‚¹èµå’Œå–æ¶ˆç‚¹èµè½¬å‘è‡³åŒä¸€ä¸ªæ¥å£ä¸Šï¼Œé€šè¿‡ä¸€ä¸ª`like`å­—æ®µè¿›è¡ŒåŒºåˆ†\n\n- `true`ï¼Œé‚£ä¹ˆæ˜¯ç‚¹èµ\n- `false`ï¼Œé‚£ä¹ˆæ˜¯å–æ¶ˆç‚¹èµ\n\nå¹¶åœ¨Handlerä¸­æ ¹æ®`like`å€¼ï¼Œè°ƒç”¨ä¸åŒçš„æ–¹æ³•\n\n#### è½¯åˆ é™¤\n\næ¶‰åŠåˆ°ç”¨æˆ·å¯ä»¥æ’¤é”€æŸä¸ªè¡Œä¸ºçš„åœºæ™¯ï¼ˆä¾‹å¦‚æœ¬å¤„å°±æ˜¯å–æ¶ˆç‚¹èµï¼‰ï¼Œé€šå¸¸æœ‰ä¸¤ç§æ“ä½œæ•°æ®çš„æ–¹å¼\n\n- **ç¡¬åˆ é™¤**ï¼šç›´æ¥å°†æ•°æ®åº“ä¸­çš„è®°å½•åˆ é™¤\n- **è½¯åˆ é™¤**ï¼šå°†è®°å½•ä¸­çš„`status`å­—æ®µè®¾ç½®æˆ`2`\n  - é€šå¸¸ä¸ºäº†é¿å…**é›¶å€¼é—®é¢˜**ï¼Œäººä¸ºè§„å®š`status = 1`æ ‡è¯†è®°å½•å­˜åœ¨ï¼Œ`status = 2`æ ‡è¯†è®°å½•è¢«åˆ é™¤\n\n<img src=\"https://raw.githubusercontent.com/lyydsheep/pic/main/202410121436840.png\" alt=\"image-20241012143649799\" style=\"zoom:67%;\" />\n\nç›¸è¾ƒäºè½¯åˆ é™¤ï¼Œç¡¬åˆ é™¤ä¼šäº§ç”Ÿå¾ˆå¤š**ç©ºæ´**ï¼Œå½±å“MySQLæ€§èƒ½ã€‚æ¢å¥è¯è¯´ï¼Œ**è½¯åˆ é™¤çš„æ€§èƒ½æ›´å¥½**\n\nåŒæ ·åœ°ï¼Œåœ¨DAOå±‚é¢ï¼Œå¯¹äºç‚¹èµæ“ä½œï¼Œä¸èƒ½ç¡®å®šæ˜¯ç¬¬ä¸€æ¬¡ç‚¹èµè¿˜ä¼šå†æ¬¡ç‚¹èµã€‚å› æ­¤éœ€è¦é‡‡ç”¨**upsert**æ“ä½œ\n\n![image-20241011201326778](https://raw.githubusercontent.com/lyydsheep/pic/main/202410112013864.png)\n\n## æ”¶è—åŠŸèƒ½è®¾è®¡ä¸å®ç°\n\nè¿™é‡Œéœ€è¦å¼•å…¥æ”¶è—å¤¹çš„æ¦‚å¿µ\n\næ€»ä½“ä¸Šå°±æ˜¯ä¸¤å¼ è¡¨ï¼š\n\n- **æ”¶è—å¤¹æœ¬ä½“**ï¼šä¹Ÿå°±æ˜¯æ”¶è—å¤¹æœ¬èº«ï¼Œä»¥åŠå…¶å½’å±çš„ç”¨æˆ·\n- **æ”¶è—å¤¹å’Œèµ„æºçš„å…³è”å…³ç³»**\n\n![image-20241013101806634](https://raw.githubusercontent.com/lyydsheep/pic/main/202410131018715.png)\n\næ”¶è—å¤¹ä¸­ä¼šæœ‰å¤šä¸ªé¡¹ç›®ï¼Œå› æ­¤æ”¶è—å¤¹å’Œæ”¶è—å¤¹ä¸­çš„å†…å®¹æ˜¯1ï¼šNçš„å…³ç³»\n\nå…·ä½“å®ç°å’Œé˜…è¯»æ•°ã€ç‚¹èµæ•°ç±»ä¼¼ï¼Œéƒ½æ˜¯è¦**upsertè¯­ä¹‰ï¼Œä»¥åŠ`collect_cnt = collect_cnt + 1`** \n\n### æŸ¥è¯¢æ¥å£\n\nå‚è€ƒç«å“ï¼š\n\n<img src=\"https://raw.githubusercontent.com/lyydsheep/pic/main/202410131110917.png\" alt=\"image-20241013111021697\" style=\"zoom:50%;\" />\n\nåœ¨å‰ç«¯åšå±•ç¤ºä¸€ç‰‡æ–‡ç« ã€è§†é¢‘ç­‰èµ„æºæ—¶ï¼Œéœ€è¦å°†**èµ„æºæœ¬ä½“ã€é˜…è¯»æ•°ã€ç‚¹èµæ•°ã€æ”¶è—æ•°ç­‰**ä¸€åŒæ˜¾ç¤º\n\nå› ä¸ºåœ¨å®ç°é˜…è¯»ã€ç‚¹èµã€æ”¶è—æ—¶ï¼Œå°†è¿™äº›å­—æ®µè§†ä¸ºäº†**ä¸€ä¸ªç‹¬ç«‹çš„é¢†åŸŸ**ï¼Œæ‰€ä»¥éœ€è¦æä¾›ä¸¤ä¸ªæ¥å£åˆ†åˆ«å¯¹æ•°æ®å’Œèµ„æºè¿›è¡ŒæŸ¥è¯¢ï¼Œå¹¶**åœ¨Webå±‚é¢è¿›è¡Œèšåˆ**ã€‚å¦ä¸€ç§å¯è¡Œçš„æ–¹æ¡ˆå°±æ˜¯å°†æ•°æ®ä½œä¸ºæ–‡ç« çš„å­å¯¹è±¡ï¼Œé‚£ä¹ˆå°±å¯ä»¥åœ¨Serviceå±‚è¿›è¡Œèšåˆ\n\nè€ƒè™‘åˆ°éœ€è¦è¿›è¡ŒæŸ¥è¯¢å¤šä¸ªè¡¨çš„æ“ä½œï¼Œä¸ºäº†æé«˜æ€§èƒ½ï¼Œå¯ä»¥ä½¿ç”¨**errgroupæ¥å¹¶å‘æŸ¥è¯¢æ•°æ®å’Œèµ„æºæœ¬ä½“**\n\nå…·ä½“Webå±‚é¢å®ç°å¦‚ä¸‹ï¼š\n\n```go\n```\n\n\n\n```go\nfunc (h *ArticleHandler) PubDetail(ctx *gin.Context, c jwt.UserClaims, req ArticleReq) (ginx.Result, error) {\n\tuid := c.UserId\n\tvar eg errgroup.Group\n\tvar art domain.Article\n\teg.Go(func() error {\n\t\tvar err error\n\t\tart, err = h.svc.PubDetail(ctx, req.BizId)\n\t\tif err != nil {\n\t\t\th.l.Error(\"è·å–æ–‡ç« å¤±è´¥\", zap.Error(err))\n\t\t}\n\t\treturn err\n\t})\n\tvar intr domain.Interact\n\teg.Go(func() error {\n\t\tvar err error\n\t\tintr, err = h.interactSvc.Get(ctx, req.Biz, req.BizId, uid)\n\t\tif err != nil {\n\t\t\th.l.Error(\"è·å–æ–‡ç« æ•°æ®å¤±è´¥\", zap.Error(err))\n\t\t}\n\t\treturn err\n\t})\n\terr := eg.Wait()\n\tif err != nil {\n\t\treturn ginx.Result{}, err\n\t}\n\tgo func() {\n\t\tvar err error\n\t\terr = h.interactSvc.IncReadCnt(ctx, req.Biz, req.BizId)\n\t\tif err != nil {\n\t\t\th.l.Error(\"å¢åŠ é˜…è¯»æ•°å¤±è´¥\", zap.Error(err))\n\t\t}\n\t}()\n\treturn ginx.Result{\n\t\tData: ArticleVO{\n\t\t\tId:         art.Id,\n\t\t\tTitle:      art.Title,\n\t\t\tContent:    art.Content,\n\t\t\tAuthorName: art.Author.Name,\n\t\t\tReadCnt:    intr.ReadCnt,\n\t\t\tLikeCnt:    intr.LikeCnt,\n\t\t\tCollectCnt: intr.CollectCnt,\n\t\t\tLiked:      intr.Liked,\n\t\t\tCollected:  intr.Collected,\n\t\t\tCtime:      time.UnixMilli(art.Ctime).Format(time.DateTime),\n\t\t\tUtime:      time.UnixMilli(art.Utime).Format(time.DateTime),\n\t\t},\n\t}, nil\n}\n\n```\n\n\n\nâš ï¸ï¼š\n\n- **æ–¹æ³•ä¸ç›´æ¥ä¿®æ”¹å‚æ•°ï¼Œè€Œæ˜¯é€šè¿‡è¿”å›å€¼é—´æ¥ä¿®æ”¹å‚æ•°**\n\n- è¿”å›å€¼çš„ç±»å‹é€‰æ‹©ï¼š\n\n  - å¦‚æœæŒ‡é’ˆå®ç°äº†æ¥å£ï¼Œé‚£å°±è¿”å›æŒ‡é’ˆ\n\n  - å¦‚æœè¿”å›å€¼å¾ˆå¤§ï¼Œé¿å…ä¼ é€’å¼•å‘å¤åˆ¶ï¼Œé‚£å°±è¿”å›æŒ‡é’ˆ\n\n- ç®€æ˜“åŸåˆ™ï¼š\n\n  - æ¥æ”¶å™¨æ°¸è¿œç”¨æŒ‡é’ˆ\n  - è¾“å…¥è¾“å‡ºéƒ½ç”¨ç»“æ„ä½“\n\n- ä¸æ˜¯æ‰€æœ‰ç»“æ„ä½“éƒ½æ˜¯å¯æ¯”è¾ƒçš„\n\n## åŠŸèƒ½å®ç°å°ç»“\n\n- **å¤§é‡ä½¿ç”¨äº‹ç‰©**ï¼Œä¿è¯åœ¨æ“ä½œä¸¤å¼ è¡¨æ—¶ä¿æŒACIDç‰¹æ€§\n- **å¤§é‡ä½¿ç”¨Upsertè¯­ä¹‰**ï¼Œå› ä¸ºå¾ˆå¤šæƒ…å†µä¸‹æˆ‘ä»¬ä¸çŸ¥é“è¡¨ä¸­æ˜¯å¦æœ‰å¯¹åº”çš„æ•°æ®\n- **å¤§é‡ä½¿ç”¨luaè„šæœ¬æ¥ä¿è¯ç¼“å­˜ä¸­çš„æ•°æ®æ˜¯æ­£ç¡®çš„**ï¼Œä½†æ˜¯æ— æ³•å½»åº•è§£å†³ç¼“å­˜ä¸€è‡´æ€§é—®é¢˜\n- **åœ¨æŸ¥è¯¢æ¥å£è¿™ä¸ªå‘¢ï¼Œåªç¼“å­˜æ€»æ•°æ•°æ®**ï¼Œå¹¶ä¸ä¼šç¼“å­˜ä¸ªäººæ˜¯å¦ç‚¹èµã€æ˜¯å¦æ”¶è—çš„æ•°æ®\n- **ç¼“å­˜ä¸€è‡´æ€§è™½ç„¶å¾ˆé‡è¦ï¼Œä½†ä¸æ˜¯æ‰€æœ‰çš„åœºæ™¯éƒ½å¿…é¡»ç»´æŠ¤**ã€‚å¦ä¸€æ–¹é¢ï¼Œéœ€è¦å½»åº•è§£å†³ç¼“å­˜ä¸€è‡´æ€§é—®é¢˜çš„åœºæ™¯ï¼Œå°±ä¸åº”è¯¥ä½¿ç”¨ç¼“å­˜\n\n","slug":"Go/é˜…è¯»ã€ç‚¹èµã€æ”¶è—åŠŸèƒ½","published":1,"date":"2024-12-27T11:03:15.345Z","updated":"2024-12-27T11:03:15.345Z","title":"","comments":1,"layout":"post","photos":[],"_id":"cm6c7md6n0027a5t2ak4rf36m","content":"<h1 id=\"é˜…è¯»ã€ç‚¹èµã€æ”¶è—\"><a href=\"#é˜…è¯»ã€ç‚¹èµã€æ”¶è—\" class=\"headerlink\" title=\"é˜…è¯»ã€ç‚¹èµã€æ”¶è—\"></a>é˜…è¯»ã€ç‚¹èµã€æ”¶è—</h1><h2 id=\"éœ€æ±‚åˆ†æ\"><a href=\"#éœ€æ±‚åˆ†æ\" class=\"headerlink\" title=\"éœ€æ±‚åˆ†æ\"></a>éœ€æ±‚åˆ†æ</h2><ul>\n<li>é˜…è¯»æ•°é‡åœ¨ç‚¹å‡»æ–‡ç« ä¹‹åå°±ä¼š+1ï¼Œåœ¨é€€å‡ºæ–‡ç« åä¹Ÿä¸ä¼š-1</li>\n<li>ç‚¹èµå’Œæ”¶è—æ•°æ—¢å¯ä»¥+1ï¼Œä¹Ÿå¯ä»¥-1</li>\n<li>æœ‰æ—¶æ”¶è—çš„å†…å®¹ä¼šæ”¾åœ¨æ”¶è—å¤¹ï¼Œå–æ¶ˆæ”¶è—åˆ™è¦ç§»é™¤æ”¶è—å¤¹</li>\n</ul>\n<p>å¦ä¸€æ–¹é¢ï¼Œå¯¹äºä¸€ä¸ªå¹³å°ï¼Œä¸è®ºæ˜¯æ–‡ç« ã€è§†é¢‘è¿˜æ˜¯è¯„è®ºï¼Œè¿™äº›å¯¹è±¡éƒ½ä¼šæœ‰é˜…è¯»ã€ç‚¹èµã€æ”¶è—ç­‰å±æ€§å­—æ®µã€‚è¿™ä¹Ÿå°±æ„å‘³ç€ï¼Œæˆ‘ä»¬æä¾›çš„æ¥å£ä¸èƒ½åªé™åˆ¶åº”ç”¨äºæ–‡ç« ï¼Œè€Œæ˜¯ä¸€ä¸ª<strong>é¢å‘ä»»ä½•èµ„æºéƒ½èƒ½ä½¿ç”¨çš„é˜…è¯»ã€ç‚¹èµã€æ”¶è—åŠŸèƒ½æ¥å£</strong></p>\n<p>æ›´è¿›ä¸€æ­¥åœ°ï¼Œéœ€è¦åˆ†æé˜…è¯»ã€ç‚¹èµã€æ”¶è—è¿™ä¸‰è€…ä¹‹é—´çš„ç•Œé™ã€‚å®é™…å¯ä»¥è€ƒè™‘ä¸€ä¸‹ä¸‰ä¸ªæ–¹é¢ï¼š</p>\n<ul>\n<li>åœºæ™¯</li>\n<li>æ€§èƒ½</li>\n<li>ç ”å‘</li>\n</ul>\n<h2 id=\"é˜…è¯»æ•°åŠŸèƒ½è®¾è®¡ä¸å®ç°\"><a href=\"#é˜…è¯»æ•°åŠŸèƒ½è®¾è®¡ä¸å®ç°\" class=\"headerlink\" title=\"é˜…è¯»æ•°åŠŸèƒ½è®¾è®¡ä¸å®ç°\"></a>é˜…è¯»æ•°åŠŸèƒ½è®¾è®¡ä¸å®ç°</h2><p>è®¾è®¡ä¸€ä¸ª<code>InteractService</code>æ¥å£ï¼Œè¯¥æ¥å£æä¾›ä¸€ä¸ª<code>IncReadCnt</code>æ–¹æ³•ï¼Œæ¯å½“è°ƒç”¨é˜…è¯»æ¥å£æ—¶ï¼Œå°±æ˜¯è¯¥æ–¹æ³•å°†å¯¹è±¡çš„é˜…è¯»æ•°å­—æ®µ+1ã€‚</p>\n<p>è€ƒè™‘æç«¯æƒ…å†µï¼Œå¦‚æœæ˜¯ç¬¬ä¸€æ¬¡å¯¹æŸä¸ªå¯¹è±¡è°ƒç”¨<code>IncReadCnt</code>æ–¹æ³•ï¼Œé‚£ä¹ˆæ­¤æ—¶æ•°æ®åº“ä¸­æ˜¯æ²¡æœ‰è¯¥è®°å½•çš„ï¼Œéœ€è¦è¿›è¡Œinsertæ“ä½œï¼Œè€Œç¬¬äºŒæ¬¡ã€ç¬¬ä¸‰æ¬¡è°ƒç”¨æ—¶åˆ™æ˜¯è¿›è¡Œupdateæ“ä½œã€‚ç”±æ­¤å¯è§ï¼Œ<code>IncReadCnt</code>æ–¹æ³•åº”è¯¥å®ç°<strong>upsert</strong>æ“ä½œï¼šæœ‰è®°å½•åˆ™æ›´æ–°<code>read_cnt</code>å­—æ®µï¼Œæ²¡æœ‰è®°å½•åˆ™æ’å…¥ä¸€æ¡è®°å½•</p>\n<p><strong>å¤ä¹ ä¸€ä¸‹GORMå®ç°upsertæ“ä½œ</strong>ï¼š</p>\n<figure class=\"highlight go\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">dao.db.WithContext(ctx).Clauses(clause.OnConflict&#123;</span><br><span class=\"line\">    DoUpdates: clause.Assignments(<span class=\"keyword\">map</span>[<span class=\"type\">string</span>]any&#123;</span><br><span class=\"line\">        <span class=\"comment\">// ç›´æ¥ä½¿ç”¨ `read_cnt` = `read_cnt` + 1</span></span><br><span class=\"line\">        <span class=\"comment\">// ä¿æŒå¹¶å‘å®‰å…¨</span></span><br><span class=\"line\">        <span class=\"string\">&quot;read_cnt&quot;</span>: gorm.Expr(<span class=\"string\">&quot;read_cnt + 1&quot;</span>),</span><br><span class=\"line\">        <span class=\"string\">&quot;utime&quot;</span>: time.Now().UnixMilli(),</span><br><span class=\"line\">    &#125;).Create(&amp;Interactive&#123;</span><br><span class=\"line\">        <span class=\"comment\">// ç•¥</span></span><br><span class=\"line\">        ...</span><br><span class=\"line\">    &#125;)</span><br><span class=\"line\">&#125;)</span><br></pre></td></tr></table></figure>\n\n<p>åœ¨éœ€æ±‚åˆ†æé˜¶æ®µï¼Œæˆ‘ä»¬å¾—å‡ºç»“è®ºï¼šåº”è¯¥æä¾›ä¸€ä¸ªé¢å‘ä»»ä½•èµ„æºçš„é˜…è¯»ã€ç‚¹èµã€æ”¶è—åŠŸèƒ½æ¥å£ã€‚æ—¢ç„¶å¦‚æ­¤ï¼Œå°±å¾—æœ‰åŒºåˆ†ä¸åŒèµ„æºçš„å­—æ®µã€‚ä¸€ç§å¾ˆå¸¸è§çš„æ–¹æ³•å°±æ˜¯é‡‡ç”¨<strong>biz + bizId</strong>æ¥å”¯ä¸€æ ‡è¯†æŸä¸ªç‰¹å®šä¸šåŠ¡ä¸‹çš„ä¸€ä¸ªå¯¹è±¡</p>\n<p>ç±»ä¼¼çš„è®¾è®¡æœ‰ï¼š</p>\n<ul>\n<li><strong>biz + bizId</strong></li>\n<li><strong>resource type + resourceId</strong></li>\n<li><strong>request type + requestId</strong></li>\n</ul>\n<h3 id=\"ç¼“å­˜è®¾è®¡\"><a href=\"#ç¼“å­˜è®¾è®¡\" class=\"headerlink\" title=\"ç¼“å­˜è®¾è®¡\"></a>ç¼“å­˜è®¾è®¡</h3><p>åœ¨ä»»ä½•ä¸€ä¸ªå¹³å°ï¼Œé˜…è¯»é‡ã€ç‚¹èµã€æ”¶è—éƒ½æ˜¯é«˜é¢‘è®¿é—®æ•°æ®ã€‚å› æ­¤éœ€è¦<strong>åšå¥½ç¼“å­˜ï¼Œé˜²æ­¢è¶…é«˜çš„QPSå‹å®æ•°æ®åº“</strong></p>\n<p>è¿™é‡Œé€‰æ‹©ä½¿ç”¨Redisçš„Hashesç»“æ„ï¼Œä¸€ä¸ªkeyä¸­åŒæ—¶ä¿å­˜<code>read_cnt</code>,<code>like_cnt</code>,<code>collect_cnt</code>å­—æ®µ</p>\n<blockquote>\n<p>ä¸ºä»€ä¹ˆä¸æ˜¯ä¸‰ä¸ªï¼ˆå¹¿ä¹‰ä¸Šï¼‰Redisåˆ†åˆ«ä¿å­˜ä¸‰ä¸ªå­—æ®µçš„å±æ€§å€¼ï¼ŸğŸ¤”</p>\n<p>ä¸€ä¸ªåŸå› æ˜¯ï¼šé˜…è¯»ã€ç‚¹èµã€æ”¶è—è¿™ä¸‰ä¸ªå­—æ®µç»å¸¸ä¸€åŒå‡ºç°ï¼Œå¦‚æœç”¨ä¸€ä¸ªkeyä¿å­˜ï¼Œé‚£ä¹ˆåªéœ€è¦è¿›è¡Œä¸€æ¬¡RedisæŸ¥è¯¢å°±èƒ½æ‹¿åˆ°ä¸‰ä¸ªå­—æ®µå€¼</p>\n<p>å¦ä¸€ä¸ªåŸå› æ˜¯ï¼šå¦‚æœä½¿ç”¨ä¸‰ä¸ªRedisä¿å­˜ï¼Œé‚£ä¹ˆä¸ºäº†ç¡®ä¿è¯»å–ä¸‰ä¸ªRedisæ“ä½œçš„åŸå­æ€§ï¼Œå°±å¿…é¡»ä½¿ç”¨luaç¼–å†™å¤æ‚è„šæœ¬ï¼ˆè€Œä¸”æ€§èƒ½å¯èƒ½ä¼šæœ‰ä¸€å®šæŸå¤±ğŸ§ï¼‰</p>\n</blockquote>\n<p>æšä¸¾ä½¿ç”¨ç¼“å­˜å¯èƒ½å‘ç”Ÿçš„åœºæ™¯ï¼š</p>\n<ul>\n<li>æ²¡æœ‰Key</li>\n<li>æœ‰Keyä¸”æœ‰ç›¸åº”çš„å­—æ®µ</li>\n<li>æœ‰Keyä½†æ²¡æœ‰ç›¸åº”çš„å­—æ®µ</li>\n</ul>\n<p>å¹¸è¿åœ°æ˜¯ï¼ŒRedisæä¾›äº†ä¸€ä¸ª<strong>HCINRBY</strong> apiï¼ˆè¯¦è§ä¸‹å›¾ï¼‰ï¼Œå¯ä»¥æœ‰æ•ˆè§£å†³åä¸¤ç§æƒ…å†µ</p>\n<img src=\"https://raw.githubusercontent.com/lyydsheep/pic/main/202410091421095.png\" alt=\"image-20241009142111996\" style=\"zoom: 67%;\" />\n\n<p>å¯¹äºæƒ…å†µä¸€ï¼šæˆ‘ä»¬å°±éœ€è¦äº‹å…ˆåˆ¤æ–­ä¸€ä¸‹Rediä¸­çš„keyæ˜¯å¦å­˜åœ¨ï¼Œå¦‚æœå­˜åœ¨å°±æŠŠå¯¹åº”çš„å­—æ®µ+1ã€‚<strong>è¿™æ˜¯ä¸€ä¸ªå…¸å‹çš„check-do somethingåœºæ™¯ï¼Œå¯ä»¥è€ƒè™‘ä½¿ç”¨luaè„šæœ¬ç¡®ä¿æ²¡æœ‰å¹¶å‘é—®é¢˜</strong></p>\n<h3 id=\"æ³¨æ„äº‹é¡¹\"><a href=\"#æ³¨æ„äº‹é¡¹\" class=\"headerlink\" title=\"æ³¨æ„äº‹é¡¹\"></a>æ³¨æ„äº‹é¡¹</h3><p>âš ï¸ï¼šå­˜å‚¨å¯¹è±¡ä¸­çš„stringç±»å‹é»˜è®¤å¯¹åº”ç€MySQLä¸­çš„BLOB&#x2F;TEXTç±»å‹ï¼Œéœ€è¦ç”¨<code>tag</code>æ˜ç¡®æŒ‡å®š<code>varchar</code>ç±»å‹</p>\n<p><img src=\"https://raw.githubusercontent.com/lyydsheep/pic/main/202410111928510.png\" alt=\"image-20241011192816540\"></p>\n<p><strong>å…ˆæ›´æ–°æ•°æ®åº“ï¼Œå†æ›´æ–°ç¼“å­˜</strong></p>\n<p><img src=\"https://raw.githubusercontent.com/lyydsheep/pic/main/202410121513334.png\" alt=\"image-20241012151321298\"></p>\n<h2 id=\"ç‚¹èµåŠŸèƒ½è®¾è®¡ä¸å®ç°\"><a href=\"#ç‚¹èµåŠŸèƒ½è®¾è®¡ä¸å®ç°\" class=\"headerlink\" title=\"ç‚¹èµåŠŸèƒ½è®¾è®¡ä¸å®ç°\"></a>ç‚¹èµåŠŸèƒ½è®¾è®¡ä¸å®ç°</h2><h3 id=\"éœ€æ±‚åˆ†æ-1\"><a href=\"#éœ€æ±‚åˆ†æ-1\" class=\"headerlink\" title=\"éœ€æ±‚åˆ†æ\"></a>éœ€æ±‚åˆ†æ</h3><p>ç‚¹èµäº‹å®ä¸Šåˆ†æˆä¸¤ä¸ªéƒ¨åˆ†ï¼š</p>\n<ul>\n<li>ä¿ç•™æŸä¸ªç”¨æˆ·æ˜¯å¦ç‚¹èµè¿‡ï¼Œå¹¶ä¸”ç”¨æˆ·å¯ä»¥å–æ¶ˆç‚¹èµ</li>\n<li>ç»Ÿè®¡ç‚¹èµæ•°é‡</li>\n</ul>\n<p>ç»Ÿè®¡ç‚¹èµæ•°é‡å’Œç»Ÿè®¡é˜…è¯»æ•°é‡çš„æ€è·¯æ˜¯ä¸€æ ·çš„ï¼Œ<strong>ä¸è¿‡éœ€è¦é¢å¤–è®°å½•ç”¨æˆ·æ˜¯å¦å¯¹æŸä¸ªèµ„æºå·²ç»ç‚¹è¿‡èµ</strong></p>\n<img src=\"https://raw.githubusercontent.com/lyydsheep/pic/main/202410130733005.png\" alt=\"image-20241012142803292\" style=\"zoom:50%;\" />\n\n<h3 id=\"åŠŸèƒ½å®ç°\"><a href=\"#åŠŸèƒ½å®ç°\" class=\"headerlink\" title=\"åŠŸèƒ½å®ç°\"></a>åŠŸèƒ½å®ç°</h3><p>ä¸ºäº†ç®€åŒ–å‰ç«¯ä»£ç ï¼Œå¯ä»¥å°†ç‚¹èµå’Œå–æ¶ˆç‚¹èµè½¬å‘è‡³åŒä¸€ä¸ªæ¥å£ä¸Šï¼Œé€šè¿‡ä¸€ä¸ª<code>like</code>å­—æ®µè¿›è¡ŒåŒºåˆ†</p>\n<ul>\n<li><code>true</code>ï¼Œé‚£ä¹ˆæ˜¯ç‚¹èµ</li>\n<li><code>false</code>ï¼Œé‚£ä¹ˆæ˜¯å–æ¶ˆç‚¹èµ</li>\n</ul>\n<p>å¹¶åœ¨Handlerä¸­æ ¹æ®<code>like</code>å€¼ï¼Œè°ƒç”¨ä¸åŒçš„æ–¹æ³•</p>\n<h4 id=\"è½¯åˆ é™¤\"><a href=\"#è½¯åˆ é™¤\" class=\"headerlink\" title=\"è½¯åˆ é™¤\"></a>è½¯åˆ é™¤</h4><p>æ¶‰åŠåˆ°ç”¨æˆ·å¯ä»¥æ’¤é”€æŸä¸ªè¡Œä¸ºçš„åœºæ™¯ï¼ˆä¾‹å¦‚æœ¬å¤„å°±æ˜¯å–æ¶ˆç‚¹èµï¼‰ï¼Œé€šå¸¸æœ‰ä¸¤ç§æ“ä½œæ•°æ®çš„æ–¹å¼</p>\n<ul>\n<li><strong>ç¡¬åˆ é™¤</strong>ï¼šç›´æ¥å°†æ•°æ®åº“ä¸­çš„è®°å½•åˆ é™¤</li>\n<li><strong>è½¯åˆ é™¤</strong>ï¼šå°†è®°å½•ä¸­çš„<code>status</code>å­—æ®µè®¾ç½®æˆ<code>2</code><ul>\n<li>é€šå¸¸ä¸ºäº†é¿å…<strong>é›¶å€¼é—®é¢˜</strong>ï¼Œäººä¸ºè§„å®š<code>status = 1</code>æ ‡è¯†è®°å½•å­˜åœ¨ï¼Œ<code>status = 2</code>æ ‡è¯†è®°å½•è¢«åˆ é™¤</li>\n</ul>\n</li>\n</ul>\n<img src=\"https://raw.githubusercontent.com/lyydsheep/pic/main/202410121436840.png\" alt=\"image-20241012143649799\" style=\"zoom:67%;\" />\n\n<p>ç›¸è¾ƒäºè½¯åˆ é™¤ï¼Œç¡¬åˆ é™¤ä¼šäº§ç”Ÿå¾ˆå¤š<strong>ç©ºæ´</strong>ï¼Œå½±å“MySQLæ€§èƒ½ã€‚æ¢å¥è¯è¯´ï¼Œ<strong>è½¯åˆ é™¤çš„æ€§èƒ½æ›´å¥½</strong></p>\n<p>åŒæ ·åœ°ï¼Œåœ¨DAOå±‚é¢ï¼Œå¯¹äºç‚¹èµæ“ä½œï¼Œä¸èƒ½ç¡®å®šæ˜¯ç¬¬ä¸€æ¬¡ç‚¹èµè¿˜ä¼šå†æ¬¡ç‚¹èµã€‚å› æ­¤éœ€è¦é‡‡ç”¨<strong>upsert</strong>æ“ä½œ</p>\n<p><img src=\"https://raw.githubusercontent.com/lyydsheep/pic/main/202410112013864.png\" alt=\"image-20241011201326778\"></p>\n<h2 id=\"æ”¶è—åŠŸèƒ½è®¾è®¡ä¸å®ç°\"><a href=\"#æ”¶è—åŠŸèƒ½è®¾è®¡ä¸å®ç°\" class=\"headerlink\" title=\"æ”¶è—åŠŸèƒ½è®¾è®¡ä¸å®ç°\"></a>æ”¶è—åŠŸèƒ½è®¾è®¡ä¸å®ç°</h2><p>è¿™é‡Œéœ€è¦å¼•å…¥æ”¶è—å¤¹çš„æ¦‚å¿µ</p>\n<p>æ€»ä½“ä¸Šå°±æ˜¯ä¸¤å¼ è¡¨ï¼š</p>\n<ul>\n<li><strong>æ”¶è—å¤¹æœ¬ä½“</strong>ï¼šä¹Ÿå°±æ˜¯æ”¶è—å¤¹æœ¬èº«ï¼Œä»¥åŠå…¶å½’å±çš„ç”¨æˆ·</li>\n<li><strong>æ”¶è—å¤¹å’Œèµ„æºçš„å…³è”å…³ç³»</strong></li>\n</ul>\n<p><img src=\"https://raw.githubusercontent.com/lyydsheep/pic/main/202410131018715.png\" alt=\"image-20241013101806634\"></p>\n<p>æ”¶è—å¤¹ä¸­ä¼šæœ‰å¤šä¸ªé¡¹ç›®ï¼Œå› æ­¤æ”¶è—å¤¹å’Œæ”¶è—å¤¹ä¸­çš„å†…å®¹æ˜¯1ï¼šNçš„å…³ç³»</p>\n<p>å…·ä½“å®ç°å’Œé˜…è¯»æ•°ã€ç‚¹èµæ•°ç±»ä¼¼ï¼Œéƒ½æ˜¯è¦<strong>upsertè¯­ä¹‰ï¼Œä»¥åŠ<code>collect_cnt = collect_cnt + 1</code></strong> </p>\n<h3 id=\"æŸ¥è¯¢æ¥å£\"><a href=\"#æŸ¥è¯¢æ¥å£\" class=\"headerlink\" title=\"æŸ¥è¯¢æ¥å£\"></a>æŸ¥è¯¢æ¥å£</h3><p>å‚è€ƒç«å“ï¼š</p>\n<img src=\"https://raw.githubusercontent.com/lyydsheep/pic/main/202410131110917.png\" alt=\"image-20241013111021697\" style=\"zoom:50%;\" />\n\n<p>åœ¨å‰ç«¯åšå±•ç¤ºä¸€ç‰‡æ–‡ç« ã€è§†é¢‘ç­‰èµ„æºæ—¶ï¼Œéœ€è¦å°†<strong>èµ„æºæœ¬ä½“ã€é˜…è¯»æ•°ã€ç‚¹èµæ•°ã€æ”¶è—æ•°ç­‰</strong>ä¸€åŒæ˜¾ç¤º</p>\n<p>å› ä¸ºåœ¨å®ç°é˜…è¯»ã€ç‚¹èµã€æ”¶è—æ—¶ï¼Œå°†è¿™äº›å­—æ®µè§†ä¸ºäº†<strong>ä¸€ä¸ªç‹¬ç«‹çš„é¢†åŸŸ</strong>ï¼Œæ‰€ä»¥éœ€è¦æä¾›ä¸¤ä¸ªæ¥å£åˆ†åˆ«å¯¹æ•°æ®å’Œèµ„æºè¿›è¡ŒæŸ¥è¯¢ï¼Œå¹¶<strong>åœ¨Webå±‚é¢è¿›è¡Œèšåˆ</strong>ã€‚å¦ä¸€ç§å¯è¡Œçš„æ–¹æ¡ˆå°±æ˜¯å°†æ•°æ®ä½œä¸ºæ–‡ç« çš„å­å¯¹è±¡ï¼Œé‚£ä¹ˆå°±å¯ä»¥åœ¨Serviceå±‚è¿›è¡Œèšåˆ</p>\n<p>è€ƒè™‘åˆ°éœ€è¦è¿›è¡ŒæŸ¥è¯¢å¤šä¸ªè¡¨çš„æ“ä½œï¼Œä¸ºäº†æé«˜æ€§èƒ½ï¼Œå¯ä»¥ä½¿ç”¨<strong>errgroupæ¥å¹¶å‘æŸ¥è¯¢æ•°æ®å’Œèµ„æºæœ¬ä½“</strong></p>\n<p>å…·ä½“Webå±‚é¢å®ç°å¦‚ä¸‹ï¼š</p>\n<figure class=\"highlight go\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br><span class=\"line\">31</span><br><span class=\"line\">32</span><br><span class=\"line\">33</span><br><span class=\"line\">34</span><br><span class=\"line\">35</span><br><span class=\"line\">36</span><br><span class=\"line\">37</span><br><span class=\"line\">38</span><br><span class=\"line\">39</span><br><span class=\"line\">40</span><br><span class=\"line\">41</span><br><span class=\"line\">42</span><br><span class=\"line\">43</span><br><span class=\"line\">44</span><br><span class=\"line\">45</span><br><span class=\"line\">46</span><br><span class=\"line\">47</span><br><span class=\"line\">48</span><br><span class=\"line\">49</span><br><span class=\"line\">50</span><br><span class=\"line\">51</span><br><span class=\"line\">52</span><br><span class=\"line\">53</span><br><span class=\"line\">54</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"string\">``</span><span class=\"string\">`</span></span><br><span class=\"line\"><span class=\"string\"></span></span><br><span class=\"line\"><span class=\"string\"></span></span><br><span class=\"line\"><span class=\"string\"></span></span><br><span class=\"line\"><span class=\"string\">`</span><span class=\"string\">``</span><span class=\"keyword\">go</span></span><br><span class=\"line\"><span class=\"function\"><span class=\"keyword\">func</span> <span class=\"params\">(h *ArticleHandler)</span></span> PubDetail(ctx *gin.Context, c jwt.UserClaims, req ArticleReq) (ginx.Result, <span class=\"type\">error</span>) &#123;</span><br><span class=\"line\">\tuid := c.UserId</span><br><span class=\"line\">\t<span class=\"keyword\">var</span> eg errgroup.Group</span><br><span class=\"line\">\t<span class=\"keyword\">var</span> art domain.Article</span><br><span class=\"line\">\teg.Go(<span class=\"function\"><span class=\"keyword\">func</span><span class=\"params\">()</span></span> <span class=\"type\">error</span> &#123;</span><br><span class=\"line\">\t\t<span class=\"keyword\">var</span> err <span class=\"type\">error</span></span><br><span class=\"line\">\t\tart, err = h.svc.PubDetail(ctx, req.BizId)</span><br><span class=\"line\">\t\t<span class=\"keyword\">if</span> err != <span class=\"literal\">nil</span> &#123;</span><br><span class=\"line\">\t\t\th.l.Error(<span class=\"string\">&quot;è·å–æ–‡ç« å¤±è´¥&quot;</span>, zap.Error(err))</span><br><span class=\"line\">\t\t&#125;</span><br><span class=\"line\">\t\t<span class=\"keyword\">return</span> err</span><br><span class=\"line\">\t&#125;)</span><br><span class=\"line\">\t<span class=\"keyword\">var</span> intr domain.Interact</span><br><span class=\"line\">\teg.Go(<span class=\"function\"><span class=\"keyword\">func</span><span class=\"params\">()</span></span> <span class=\"type\">error</span> &#123;</span><br><span class=\"line\">\t\t<span class=\"keyword\">var</span> err <span class=\"type\">error</span></span><br><span class=\"line\">\t\tintr, err = h.interactSvc.Get(ctx, req.Biz, req.BizId, uid)</span><br><span class=\"line\">\t\t<span class=\"keyword\">if</span> err != <span class=\"literal\">nil</span> &#123;</span><br><span class=\"line\">\t\t\th.l.Error(<span class=\"string\">&quot;è·å–æ–‡ç« æ•°æ®å¤±è´¥&quot;</span>, zap.Error(err))</span><br><span class=\"line\">\t\t&#125;</span><br><span class=\"line\">\t\t<span class=\"keyword\">return</span> err</span><br><span class=\"line\">\t&#125;)</span><br><span class=\"line\">\terr := eg.Wait()</span><br><span class=\"line\">\t<span class=\"keyword\">if</span> err != <span class=\"literal\">nil</span> &#123;</span><br><span class=\"line\">\t\t<span class=\"keyword\">return</span> ginx.Result&#123;&#125;, err</span><br><span class=\"line\">\t&#125;</span><br><span class=\"line\">\t<span class=\"keyword\">go</span> <span class=\"function\"><span class=\"keyword\">func</span><span class=\"params\">()</span></span> &#123;</span><br><span class=\"line\">\t\t<span class=\"keyword\">var</span> err <span class=\"type\">error</span></span><br><span class=\"line\">\t\terr = h.interactSvc.IncReadCnt(ctx, req.Biz, req.BizId)</span><br><span class=\"line\">\t\t<span class=\"keyword\">if</span> err != <span class=\"literal\">nil</span> &#123;</span><br><span class=\"line\">\t\t\th.l.Error(<span class=\"string\">&quot;å¢åŠ é˜…è¯»æ•°å¤±è´¥&quot;</span>, zap.Error(err))</span><br><span class=\"line\">\t\t&#125;</span><br><span class=\"line\">\t&#125;()</span><br><span class=\"line\">\t<span class=\"keyword\">return</span> ginx.Result&#123;</span><br><span class=\"line\">\t\tData: ArticleVO&#123;</span><br><span class=\"line\">\t\t\tId:         art.Id,</span><br><span class=\"line\">\t\t\tTitle:      art.Title,</span><br><span class=\"line\">\t\t\tContent:    art.Content,</span><br><span class=\"line\">\t\t\tAuthorName: art.Author.Name,</span><br><span class=\"line\">\t\t\tReadCnt:    intr.ReadCnt,</span><br><span class=\"line\">\t\t\tLikeCnt:    intr.LikeCnt,</span><br><span class=\"line\">\t\t\tCollectCnt: intr.CollectCnt,</span><br><span class=\"line\">\t\t\tLiked:      intr.Liked,</span><br><span class=\"line\">\t\t\tCollected:  intr.Collected,</span><br><span class=\"line\">\t\t\tCtime:      time.UnixMilli(art.Ctime).Format(time.DateTime),</span><br><span class=\"line\">\t\t\tUtime:      time.UnixMilli(art.Utime).Format(time.DateTime),</span><br><span class=\"line\">\t\t&#125;,</span><br><span class=\"line\">\t&#125;, <span class=\"literal\">nil</span></span><br><span class=\"line\">&#125;</span><br><span class=\"line\"></span><br></pre></td></tr></table></figure>\n\n\n\n<p>âš ï¸ï¼š</p>\n<ul>\n<li><p><strong>æ–¹æ³•ä¸ç›´æ¥ä¿®æ”¹å‚æ•°ï¼Œè€Œæ˜¯é€šè¿‡è¿”å›å€¼é—´æ¥ä¿®æ”¹å‚æ•°</strong></p>\n</li>\n<li><p>è¿”å›å€¼çš„ç±»å‹é€‰æ‹©ï¼š</p>\n<ul>\n<li><p>å¦‚æœæŒ‡é’ˆå®ç°äº†æ¥å£ï¼Œé‚£å°±è¿”å›æŒ‡é’ˆ</p>\n</li>\n<li><p>å¦‚æœè¿”å›å€¼å¾ˆå¤§ï¼Œé¿å…ä¼ é€’å¼•å‘å¤åˆ¶ï¼Œé‚£å°±è¿”å›æŒ‡é’ˆ</p>\n</li>\n</ul>\n</li>\n<li><p>ç®€æ˜“åŸåˆ™ï¼š</p>\n<ul>\n<li>æ¥æ”¶å™¨æ°¸è¿œç”¨æŒ‡é’ˆ</li>\n<li>è¾“å…¥è¾“å‡ºéƒ½ç”¨ç»“æ„ä½“</li>\n</ul>\n</li>\n<li><p>ä¸æ˜¯æ‰€æœ‰ç»“æ„ä½“éƒ½æ˜¯å¯æ¯”è¾ƒçš„</p>\n</li>\n</ul>\n<h2 id=\"åŠŸèƒ½å®ç°å°ç»“\"><a href=\"#åŠŸèƒ½å®ç°å°ç»“\" class=\"headerlink\" title=\"åŠŸèƒ½å®ç°å°ç»“\"></a>åŠŸèƒ½å®ç°å°ç»“</h2><ul>\n<li><strong>å¤§é‡ä½¿ç”¨äº‹ç‰©</strong>ï¼Œä¿è¯åœ¨æ“ä½œä¸¤å¼ è¡¨æ—¶ä¿æŒACIDç‰¹æ€§</li>\n<li><strong>å¤§é‡ä½¿ç”¨Upsertè¯­ä¹‰</strong>ï¼Œå› ä¸ºå¾ˆå¤šæƒ…å†µä¸‹æˆ‘ä»¬ä¸çŸ¥é“è¡¨ä¸­æ˜¯å¦æœ‰å¯¹åº”çš„æ•°æ®</li>\n<li><strong>å¤§é‡ä½¿ç”¨luaè„šæœ¬æ¥ä¿è¯ç¼“å­˜ä¸­çš„æ•°æ®æ˜¯æ­£ç¡®çš„</strong>ï¼Œä½†æ˜¯æ— æ³•å½»åº•è§£å†³ç¼“å­˜ä¸€è‡´æ€§é—®é¢˜</li>\n<li><strong>åœ¨æŸ¥è¯¢æ¥å£è¿™ä¸ªå‘¢ï¼Œåªç¼“å­˜æ€»æ•°æ•°æ®</strong>ï¼Œå¹¶ä¸ä¼šç¼“å­˜ä¸ªäººæ˜¯å¦ç‚¹èµã€æ˜¯å¦æ”¶è—çš„æ•°æ®</li>\n<li><strong>ç¼“å­˜ä¸€è‡´æ€§è™½ç„¶å¾ˆé‡è¦ï¼Œä½†ä¸æ˜¯æ‰€æœ‰çš„åœºæ™¯éƒ½å¿…é¡»ç»´æŠ¤</strong>ã€‚å¦ä¸€æ–¹é¢ï¼Œéœ€è¦å½»åº•è§£å†³ç¼“å­˜ä¸€è‡´æ€§é—®é¢˜çš„åœºæ™¯ï¼Œå°±ä¸åº”è¯¥ä½¿ç”¨ç¼“å­˜</li>\n</ul>\n","excerpt":"","more":"<h1 id=\"é˜…è¯»ã€ç‚¹èµã€æ”¶è—\"><a href=\"#é˜…è¯»ã€ç‚¹èµã€æ”¶è—\" class=\"headerlink\" title=\"é˜…è¯»ã€ç‚¹èµã€æ”¶è—\"></a>é˜…è¯»ã€ç‚¹èµã€æ”¶è—</h1><h2 id=\"éœ€æ±‚åˆ†æ\"><a href=\"#éœ€æ±‚åˆ†æ\" class=\"headerlink\" title=\"éœ€æ±‚åˆ†æ\"></a>éœ€æ±‚åˆ†æ</h2><ul>\n<li>é˜…è¯»æ•°é‡åœ¨ç‚¹å‡»æ–‡ç« ä¹‹åå°±ä¼š+1ï¼Œåœ¨é€€å‡ºæ–‡ç« åä¹Ÿä¸ä¼š-1</li>\n<li>ç‚¹èµå’Œæ”¶è—æ•°æ—¢å¯ä»¥+1ï¼Œä¹Ÿå¯ä»¥-1</li>\n<li>æœ‰æ—¶æ”¶è—çš„å†…å®¹ä¼šæ”¾åœ¨æ”¶è—å¤¹ï¼Œå–æ¶ˆæ”¶è—åˆ™è¦ç§»é™¤æ”¶è—å¤¹</li>\n</ul>\n<p>å¦ä¸€æ–¹é¢ï¼Œå¯¹äºä¸€ä¸ªå¹³å°ï¼Œä¸è®ºæ˜¯æ–‡ç« ã€è§†é¢‘è¿˜æ˜¯è¯„è®ºï¼Œè¿™äº›å¯¹è±¡éƒ½ä¼šæœ‰é˜…è¯»ã€ç‚¹èµã€æ”¶è—ç­‰å±æ€§å­—æ®µã€‚è¿™ä¹Ÿå°±æ„å‘³ç€ï¼Œæˆ‘ä»¬æä¾›çš„æ¥å£ä¸èƒ½åªé™åˆ¶åº”ç”¨äºæ–‡ç« ï¼Œè€Œæ˜¯ä¸€ä¸ª<strong>é¢å‘ä»»ä½•èµ„æºéƒ½èƒ½ä½¿ç”¨çš„é˜…è¯»ã€ç‚¹èµã€æ”¶è—åŠŸèƒ½æ¥å£</strong></p>\n<p>æ›´è¿›ä¸€æ­¥åœ°ï¼Œéœ€è¦åˆ†æé˜…è¯»ã€ç‚¹èµã€æ”¶è—è¿™ä¸‰è€…ä¹‹é—´çš„ç•Œé™ã€‚å®é™…å¯ä»¥è€ƒè™‘ä¸€ä¸‹ä¸‰ä¸ªæ–¹é¢ï¼š</p>\n<ul>\n<li>åœºæ™¯</li>\n<li>æ€§èƒ½</li>\n<li>ç ”å‘</li>\n</ul>\n<h2 id=\"é˜…è¯»æ•°åŠŸèƒ½è®¾è®¡ä¸å®ç°\"><a href=\"#é˜…è¯»æ•°åŠŸèƒ½è®¾è®¡ä¸å®ç°\" class=\"headerlink\" title=\"é˜…è¯»æ•°åŠŸèƒ½è®¾è®¡ä¸å®ç°\"></a>é˜…è¯»æ•°åŠŸèƒ½è®¾è®¡ä¸å®ç°</h2><p>è®¾è®¡ä¸€ä¸ª<code>InteractService</code>æ¥å£ï¼Œè¯¥æ¥å£æä¾›ä¸€ä¸ª<code>IncReadCnt</code>æ–¹æ³•ï¼Œæ¯å½“è°ƒç”¨é˜…è¯»æ¥å£æ—¶ï¼Œå°±æ˜¯è¯¥æ–¹æ³•å°†å¯¹è±¡çš„é˜…è¯»æ•°å­—æ®µ+1ã€‚</p>\n<p>è€ƒè™‘æç«¯æƒ…å†µï¼Œå¦‚æœæ˜¯ç¬¬ä¸€æ¬¡å¯¹æŸä¸ªå¯¹è±¡è°ƒç”¨<code>IncReadCnt</code>æ–¹æ³•ï¼Œé‚£ä¹ˆæ­¤æ—¶æ•°æ®åº“ä¸­æ˜¯æ²¡æœ‰è¯¥è®°å½•çš„ï¼Œéœ€è¦è¿›è¡Œinsertæ“ä½œï¼Œè€Œç¬¬äºŒæ¬¡ã€ç¬¬ä¸‰æ¬¡è°ƒç”¨æ—¶åˆ™æ˜¯è¿›è¡Œupdateæ“ä½œã€‚ç”±æ­¤å¯è§ï¼Œ<code>IncReadCnt</code>æ–¹æ³•åº”è¯¥å®ç°<strong>upsert</strong>æ“ä½œï¼šæœ‰è®°å½•åˆ™æ›´æ–°<code>read_cnt</code>å­—æ®µï¼Œæ²¡æœ‰è®°å½•åˆ™æ’å…¥ä¸€æ¡è®°å½•</p>\n<p><strong>å¤ä¹ ä¸€ä¸‹GORMå®ç°upsertæ“ä½œ</strong>ï¼š</p>\n<figure class=\"highlight go\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">dao.db.WithContext(ctx).Clauses(clause.OnConflict&#123;</span><br><span class=\"line\">    DoUpdates: clause.Assignments(<span class=\"keyword\">map</span>[<span class=\"type\">string</span>]any&#123;</span><br><span class=\"line\">        <span class=\"comment\">// ç›´æ¥ä½¿ç”¨ `read_cnt` = `read_cnt` + 1</span></span><br><span class=\"line\">        <span class=\"comment\">// ä¿æŒå¹¶å‘å®‰å…¨</span></span><br><span class=\"line\">        <span class=\"string\">&quot;read_cnt&quot;</span>: gorm.Expr(<span class=\"string\">&quot;read_cnt + 1&quot;</span>),</span><br><span class=\"line\">        <span class=\"string\">&quot;utime&quot;</span>: time.Now().UnixMilli(),</span><br><span class=\"line\">    &#125;).Create(&amp;Interactive&#123;</span><br><span class=\"line\">        <span class=\"comment\">// ç•¥</span></span><br><span class=\"line\">        ...</span><br><span class=\"line\">    &#125;)</span><br><span class=\"line\">&#125;)</span><br></pre></td></tr></table></figure>\n\n<p>åœ¨éœ€æ±‚åˆ†æé˜¶æ®µï¼Œæˆ‘ä»¬å¾—å‡ºç»“è®ºï¼šåº”è¯¥æä¾›ä¸€ä¸ªé¢å‘ä»»ä½•èµ„æºçš„é˜…è¯»ã€ç‚¹èµã€æ”¶è—åŠŸèƒ½æ¥å£ã€‚æ—¢ç„¶å¦‚æ­¤ï¼Œå°±å¾—æœ‰åŒºåˆ†ä¸åŒèµ„æºçš„å­—æ®µã€‚ä¸€ç§å¾ˆå¸¸è§çš„æ–¹æ³•å°±æ˜¯é‡‡ç”¨<strong>biz + bizId</strong>æ¥å”¯ä¸€æ ‡è¯†æŸä¸ªç‰¹å®šä¸šåŠ¡ä¸‹çš„ä¸€ä¸ªå¯¹è±¡</p>\n<p>ç±»ä¼¼çš„è®¾è®¡æœ‰ï¼š</p>\n<ul>\n<li><strong>biz + bizId</strong></li>\n<li><strong>resource type + resourceId</strong></li>\n<li><strong>request type + requestId</strong></li>\n</ul>\n<h3 id=\"ç¼“å­˜è®¾è®¡\"><a href=\"#ç¼“å­˜è®¾è®¡\" class=\"headerlink\" title=\"ç¼“å­˜è®¾è®¡\"></a>ç¼“å­˜è®¾è®¡</h3><p>åœ¨ä»»ä½•ä¸€ä¸ªå¹³å°ï¼Œé˜…è¯»é‡ã€ç‚¹èµã€æ”¶è—éƒ½æ˜¯é«˜é¢‘è®¿é—®æ•°æ®ã€‚å› æ­¤éœ€è¦<strong>åšå¥½ç¼“å­˜ï¼Œé˜²æ­¢è¶…é«˜çš„QPSå‹å®æ•°æ®åº“</strong></p>\n<p>è¿™é‡Œé€‰æ‹©ä½¿ç”¨Redisçš„Hashesç»“æ„ï¼Œä¸€ä¸ªkeyä¸­åŒæ—¶ä¿å­˜<code>read_cnt</code>,<code>like_cnt</code>,<code>collect_cnt</code>å­—æ®µ</p>\n<blockquote>\n<p>ä¸ºä»€ä¹ˆä¸æ˜¯ä¸‰ä¸ªï¼ˆå¹¿ä¹‰ä¸Šï¼‰Redisåˆ†åˆ«ä¿å­˜ä¸‰ä¸ªå­—æ®µçš„å±æ€§å€¼ï¼ŸğŸ¤”</p>\n<p>ä¸€ä¸ªåŸå› æ˜¯ï¼šé˜…è¯»ã€ç‚¹èµã€æ”¶è—è¿™ä¸‰ä¸ªå­—æ®µç»å¸¸ä¸€åŒå‡ºç°ï¼Œå¦‚æœç”¨ä¸€ä¸ªkeyä¿å­˜ï¼Œé‚£ä¹ˆåªéœ€è¦è¿›è¡Œä¸€æ¬¡RedisæŸ¥è¯¢å°±èƒ½æ‹¿åˆ°ä¸‰ä¸ªå­—æ®µå€¼</p>\n<p>å¦ä¸€ä¸ªåŸå› æ˜¯ï¼šå¦‚æœä½¿ç”¨ä¸‰ä¸ªRedisä¿å­˜ï¼Œé‚£ä¹ˆä¸ºäº†ç¡®ä¿è¯»å–ä¸‰ä¸ªRedisæ“ä½œçš„åŸå­æ€§ï¼Œå°±å¿…é¡»ä½¿ç”¨luaç¼–å†™å¤æ‚è„šæœ¬ï¼ˆè€Œä¸”æ€§èƒ½å¯èƒ½ä¼šæœ‰ä¸€å®šæŸå¤±ğŸ§ï¼‰</p>\n</blockquote>\n<p>æšä¸¾ä½¿ç”¨ç¼“å­˜å¯èƒ½å‘ç”Ÿçš„åœºæ™¯ï¼š</p>\n<ul>\n<li>æ²¡æœ‰Key</li>\n<li>æœ‰Keyä¸”æœ‰ç›¸åº”çš„å­—æ®µ</li>\n<li>æœ‰Keyä½†æ²¡æœ‰ç›¸åº”çš„å­—æ®µ</li>\n</ul>\n<p>å¹¸è¿åœ°æ˜¯ï¼ŒRedisæä¾›äº†ä¸€ä¸ª<strong>HCINRBY</strong> apiï¼ˆè¯¦è§ä¸‹å›¾ï¼‰ï¼Œå¯ä»¥æœ‰æ•ˆè§£å†³åä¸¤ç§æƒ…å†µ</p>\n<img src=\"https://raw.githubusercontent.com/lyydsheep/pic/main/202410091421095.png\" alt=\"image-20241009142111996\" style=\"zoom: 67%;\" />\n\n<p>å¯¹äºæƒ…å†µä¸€ï¼šæˆ‘ä»¬å°±éœ€è¦äº‹å…ˆåˆ¤æ–­ä¸€ä¸‹Rediä¸­çš„keyæ˜¯å¦å­˜åœ¨ï¼Œå¦‚æœå­˜åœ¨å°±æŠŠå¯¹åº”çš„å­—æ®µ+1ã€‚<strong>è¿™æ˜¯ä¸€ä¸ªå…¸å‹çš„check-do somethingåœºæ™¯ï¼Œå¯ä»¥è€ƒè™‘ä½¿ç”¨luaè„šæœ¬ç¡®ä¿æ²¡æœ‰å¹¶å‘é—®é¢˜</strong></p>\n<h3 id=\"æ³¨æ„äº‹é¡¹\"><a href=\"#æ³¨æ„äº‹é¡¹\" class=\"headerlink\" title=\"æ³¨æ„äº‹é¡¹\"></a>æ³¨æ„äº‹é¡¹</h3><p>âš ï¸ï¼šå­˜å‚¨å¯¹è±¡ä¸­çš„stringç±»å‹é»˜è®¤å¯¹åº”ç€MySQLä¸­çš„BLOB&#x2F;TEXTç±»å‹ï¼Œéœ€è¦ç”¨<code>tag</code>æ˜ç¡®æŒ‡å®š<code>varchar</code>ç±»å‹</p>\n<p><img src=\"https://raw.githubusercontent.com/lyydsheep/pic/main/202410111928510.png\" alt=\"image-20241011192816540\"></p>\n<p><strong>å…ˆæ›´æ–°æ•°æ®åº“ï¼Œå†æ›´æ–°ç¼“å­˜</strong></p>\n<p><img src=\"https://raw.githubusercontent.com/lyydsheep/pic/main/202410121513334.png\" alt=\"image-20241012151321298\"></p>\n<h2 id=\"ç‚¹èµåŠŸèƒ½è®¾è®¡ä¸å®ç°\"><a href=\"#ç‚¹èµåŠŸèƒ½è®¾è®¡ä¸å®ç°\" class=\"headerlink\" title=\"ç‚¹èµåŠŸèƒ½è®¾è®¡ä¸å®ç°\"></a>ç‚¹èµåŠŸèƒ½è®¾è®¡ä¸å®ç°</h2><h3 id=\"éœ€æ±‚åˆ†æ-1\"><a href=\"#éœ€æ±‚åˆ†æ-1\" class=\"headerlink\" title=\"éœ€æ±‚åˆ†æ\"></a>éœ€æ±‚åˆ†æ</h3><p>ç‚¹èµäº‹å®ä¸Šåˆ†æˆä¸¤ä¸ªéƒ¨åˆ†ï¼š</p>\n<ul>\n<li>ä¿ç•™æŸä¸ªç”¨æˆ·æ˜¯å¦ç‚¹èµè¿‡ï¼Œå¹¶ä¸”ç”¨æˆ·å¯ä»¥å–æ¶ˆç‚¹èµ</li>\n<li>ç»Ÿè®¡ç‚¹èµæ•°é‡</li>\n</ul>\n<p>ç»Ÿè®¡ç‚¹èµæ•°é‡å’Œç»Ÿè®¡é˜…è¯»æ•°é‡çš„æ€è·¯æ˜¯ä¸€æ ·çš„ï¼Œ<strong>ä¸è¿‡éœ€è¦é¢å¤–è®°å½•ç”¨æˆ·æ˜¯å¦å¯¹æŸä¸ªèµ„æºå·²ç»ç‚¹è¿‡èµ</strong></p>\n<img src=\"https://raw.githubusercontent.com/lyydsheep/pic/main/202410130733005.png\" alt=\"image-20241012142803292\" style=\"zoom:50%;\" />\n\n<h3 id=\"åŠŸèƒ½å®ç°\"><a href=\"#åŠŸèƒ½å®ç°\" class=\"headerlink\" title=\"åŠŸèƒ½å®ç°\"></a>åŠŸèƒ½å®ç°</h3><p>ä¸ºäº†ç®€åŒ–å‰ç«¯ä»£ç ï¼Œå¯ä»¥å°†ç‚¹èµå’Œå–æ¶ˆç‚¹èµè½¬å‘è‡³åŒä¸€ä¸ªæ¥å£ä¸Šï¼Œé€šè¿‡ä¸€ä¸ª<code>like</code>å­—æ®µè¿›è¡ŒåŒºåˆ†</p>\n<ul>\n<li><code>true</code>ï¼Œé‚£ä¹ˆæ˜¯ç‚¹èµ</li>\n<li><code>false</code>ï¼Œé‚£ä¹ˆæ˜¯å–æ¶ˆç‚¹èµ</li>\n</ul>\n<p>å¹¶åœ¨Handlerä¸­æ ¹æ®<code>like</code>å€¼ï¼Œè°ƒç”¨ä¸åŒçš„æ–¹æ³•</p>\n<h4 id=\"è½¯åˆ é™¤\"><a href=\"#è½¯åˆ é™¤\" class=\"headerlink\" title=\"è½¯åˆ é™¤\"></a>è½¯åˆ é™¤</h4><p>æ¶‰åŠåˆ°ç”¨æˆ·å¯ä»¥æ’¤é”€æŸä¸ªè¡Œä¸ºçš„åœºæ™¯ï¼ˆä¾‹å¦‚æœ¬å¤„å°±æ˜¯å–æ¶ˆç‚¹èµï¼‰ï¼Œé€šå¸¸æœ‰ä¸¤ç§æ“ä½œæ•°æ®çš„æ–¹å¼</p>\n<ul>\n<li><strong>ç¡¬åˆ é™¤</strong>ï¼šç›´æ¥å°†æ•°æ®åº“ä¸­çš„è®°å½•åˆ é™¤</li>\n<li><strong>è½¯åˆ é™¤</strong>ï¼šå°†è®°å½•ä¸­çš„<code>status</code>å­—æ®µè®¾ç½®æˆ<code>2</code><ul>\n<li>é€šå¸¸ä¸ºäº†é¿å…<strong>é›¶å€¼é—®é¢˜</strong>ï¼Œäººä¸ºè§„å®š<code>status = 1</code>æ ‡è¯†è®°å½•å­˜åœ¨ï¼Œ<code>status = 2</code>æ ‡è¯†è®°å½•è¢«åˆ é™¤</li>\n</ul>\n</li>\n</ul>\n<img src=\"https://raw.githubusercontent.com/lyydsheep/pic/main/202410121436840.png\" alt=\"image-20241012143649799\" style=\"zoom:67%;\" />\n\n<p>ç›¸è¾ƒäºè½¯åˆ é™¤ï¼Œç¡¬åˆ é™¤ä¼šäº§ç”Ÿå¾ˆå¤š<strong>ç©ºæ´</strong>ï¼Œå½±å“MySQLæ€§èƒ½ã€‚æ¢å¥è¯è¯´ï¼Œ<strong>è½¯åˆ é™¤çš„æ€§èƒ½æ›´å¥½</strong></p>\n<p>åŒæ ·åœ°ï¼Œåœ¨DAOå±‚é¢ï¼Œå¯¹äºç‚¹èµæ“ä½œï¼Œä¸èƒ½ç¡®å®šæ˜¯ç¬¬ä¸€æ¬¡ç‚¹èµè¿˜ä¼šå†æ¬¡ç‚¹èµã€‚å› æ­¤éœ€è¦é‡‡ç”¨<strong>upsert</strong>æ“ä½œ</p>\n<p><img src=\"https://raw.githubusercontent.com/lyydsheep/pic/main/202410112013864.png\" alt=\"image-20241011201326778\"></p>\n<h2 id=\"æ”¶è—åŠŸèƒ½è®¾è®¡ä¸å®ç°\"><a href=\"#æ”¶è—åŠŸèƒ½è®¾è®¡ä¸å®ç°\" class=\"headerlink\" title=\"æ”¶è—åŠŸèƒ½è®¾è®¡ä¸å®ç°\"></a>æ”¶è—åŠŸèƒ½è®¾è®¡ä¸å®ç°</h2><p>è¿™é‡Œéœ€è¦å¼•å…¥æ”¶è—å¤¹çš„æ¦‚å¿µ</p>\n<p>æ€»ä½“ä¸Šå°±æ˜¯ä¸¤å¼ è¡¨ï¼š</p>\n<ul>\n<li><strong>æ”¶è—å¤¹æœ¬ä½“</strong>ï¼šä¹Ÿå°±æ˜¯æ”¶è—å¤¹æœ¬èº«ï¼Œä»¥åŠå…¶å½’å±çš„ç”¨æˆ·</li>\n<li><strong>æ”¶è—å¤¹å’Œèµ„æºçš„å…³è”å…³ç³»</strong></li>\n</ul>\n<p><img src=\"https://raw.githubusercontent.com/lyydsheep/pic/main/202410131018715.png\" alt=\"image-20241013101806634\"></p>\n<p>æ”¶è—å¤¹ä¸­ä¼šæœ‰å¤šä¸ªé¡¹ç›®ï¼Œå› æ­¤æ”¶è—å¤¹å’Œæ”¶è—å¤¹ä¸­çš„å†…å®¹æ˜¯1ï¼šNçš„å…³ç³»</p>\n<p>å…·ä½“å®ç°å’Œé˜…è¯»æ•°ã€ç‚¹èµæ•°ç±»ä¼¼ï¼Œéƒ½æ˜¯è¦<strong>upsertè¯­ä¹‰ï¼Œä»¥åŠ<code>collect_cnt = collect_cnt + 1</code></strong> </p>\n<h3 id=\"æŸ¥è¯¢æ¥å£\"><a href=\"#æŸ¥è¯¢æ¥å£\" class=\"headerlink\" title=\"æŸ¥è¯¢æ¥å£\"></a>æŸ¥è¯¢æ¥å£</h3><p>å‚è€ƒç«å“ï¼š</p>\n<img src=\"https://raw.githubusercontent.com/lyydsheep/pic/main/202410131110917.png\" alt=\"image-20241013111021697\" style=\"zoom:50%;\" />\n\n<p>åœ¨å‰ç«¯åšå±•ç¤ºä¸€ç‰‡æ–‡ç« ã€è§†é¢‘ç­‰èµ„æºæ—¶ï¼Œéœ€è¦å°†<strong>èµ„æºæœ¬ä½“ã€é˜…è¯»æ•°ã€ç‚¹èµæ•°ã€æ”¶è—æ•°ç­‰</strong>ä¸€åŒæ˜¾ç¤º</p>\n<p>å› ä¸ºåœ¨å®ç°é˜…è¯»ã€ç‚¹èµã€æ”¶è—æ—¶ï¼Œå°†è¿™äº›å­—æ®µè§†ä¸ºäº†<strong>ä¸€ä¸ªç‹¬ç«‹çš„é¢†åŸŸ</strong>ï¼Œæ‰€ä»¥éœ€è¦æä¾›ä¸¤ä¸ªæ¥å£åˆ†åˆ«å¯¹æ•°æ®å’Œèµ„æºè¿›è¡ŒæŸ¥è¯¢ï¼Œå¹¶<strong>åœ¨Webå±‚é¢è¿›è¡Œèšåˆ</strong>ã€‚å¦ä¸€ç§å¯è¡Œçš„æ–¹æ¡ˆå°±æ˜¯å°†æ•°æ®ä½œä¸ºæ–‡ç« çš„å­å¯¹è±¡ï¼Œé‚£ä¹ˆå°±å¯ä»¥åœ¨Serviceå±‚è¿›è¡Œèšåˆ</p>\n<p>è€ƒè™‘åˆ°éœ€è¦è¿›è¡ŒæŸ¥è¯¢å¤šä¸ªè¡¨çš„æ“ä½œï¼Œä¸ºäº†æé«˜æ€§èƒ½ï¼Œå¯ä»¥ä½¿ç”¨<strong>errgroupæ¥å¹¶å‘æŸ¥è¯¢æ•°æ®å’Œèµ„æºæœ¬ä½“</strong></p>\n<p>å…·ä½“Webå±‚é¢å®ç°å¦‚ä¸‹ï¼š</p>\n<figure class=\"highlight go\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br><span class=\"line\">31</span><br><span class=\"line\">32</span><br><span class=\"line\">33</span><br><span class=\"line\">34</span><br><span class=\"line\">35</span><br><span class=\"line\">36</span><br><span class=\"line\">37</span><br><span class=\"line\">38</span><br><span class=\"line\">39</span><br><span class=\"line\">40</span><br><span class=\"line\">41</span><br><span class=\"line\">42</span><br><span class=\"line\">43</span><br><span class=\"line\">44</span><br><span class=\"line\">45</span><br><span class=\"line\">46</span><br><span class=\"line\">47</span><br><span class=\"line\">48</span><br><span class=\"line\">49</span><br><span class=\"line\">50</span><br><span class=\"line\">51</span><br><span class=\"line\">52</span><br><span class=\"line\">53</span><br><span class=\"line\">54</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"string\">``</span><span class=\"string\">`</span></span><br><span class=\"line\"><span class=\"string\"></span></span><br><span class=\"line\"><span class=\"string\"></span></span><br><span class=\"line\"><span class=\"string\"></span></span><br><span class=\"line\"><span class=\"string\">`</span><span class=\"string\">``</span><span class=\"keyword\">go</span></span><br><span class=\"line\"><span class=\"function\"><span class=\"keyword\">func</span> <span class=\"params\">(h *ArticleHandler)</span></span> PubDetail(ctx *gin.Context, c jwt.UserClaims, req ArticleReq) (ginx.Result, <span class=\"type\">error</span>) &#123;</span><br><span class=\"line\">\tuid := c.UserId</span><br><span class=\"line\">\t<span class=\"keyword\">var</span> eg errgroup.Group</span><br><span class=\"line\">\t<span class=\"keyword\">var</span> art domain.Article</span><br><span class=\"line\">\teg.Go(<span class=\"function\"><span class=\"keyword\">func</span><span class=\"params\">()</span></span> <span class=\"type\">error</span> &#123;</span><br><span class=\"line\">\t\t<span class=\"keyword\">var</span> err <span class=\"type\">error</span></span><br><span class=\"line\">\t\tart, err = h.svc.PubDetail(ctx, req.BizId)</span><br><span class=\"line\">\t\t<span class=\"keyword\">if</span> err != <span class=\"literal\">nil</span> &#123;</span><br><span class=\"line\">\t\t\th.l.Error(<span class=\"string\">&quot;è·å–æ–‡ç« å¤±è´¥&quot;</span>, zap.Error(err))</span><br><span class=\"line\">\t\t&#125;</span><br><span class=\"line\">\t\t<span class=\"keyword\">return</span> err</span><br><span class=\"line\">\t&#125;)</span><br><span class=\"line\">\t<span class=\"keyword\">var</span> intr domain.Interact</span><br><span class=\"line\">\teg.Go(<span class=\"function\"><span class=\"keyword\">func</span><span class=\"params\">()</span></span> <span class=\"type\">error</span> &#123;</span><br><span class=\"line\">\t\t<span class=\"keyword\">var</span> err <span class=\"type\">error</span></span><br><span class=\"line\">\t\tintr, err = h.interactSvc.Get(ctx, req.Biz, req.BizId, uid)</span><br><span class=\"line\">\t\t<span class=\"keyword\">if</span> err != <span class=\"literal\">nil</span> &#123;</span><br><span class=\"line\">\t\t\th.l.Error(<span class=\"string\">&quot;è·å–æ–‡ç« æ•°æ®å¤±è´¥&quot;</span>, zap.Error(err))</span><br><span class=\"line\">\t\t&#125;</span><br><span class=\"line\">\t\t<span class=\"keyword\">return</span> err</span><br><span class=\"line\">\t&#125;)</span><br><span class=\"line\">\terr := eg.Wait()</span><br><span class=\"line\">\t<span class=\"keyword\">if</span> err != <span class=\"literal\">nil</span> &#123;</span><br><span class=\"line\">\t\t<span class=\"keyword\">return</span> ginx.Result&#123;&#125;, err</span><br><span class=\"line\">\t&#125;</span><br><span class=\"line\">\t<span class=\"keyword\">go</span> <span class=\"function\"><span class=\"keyword\">func</span><span class=\"params\">()</span></span> &#123;</span><br><span class=\"line\">\t\t<span class=\"keyword\">var</span> err <span class=\"type\">error</span></span><br><span class=\"line\">\t\terr = h.interactSvc.IncReadCnt(ctx, req.Biz, req.BizId)</span><br><span class=\"line\">\t\t<span class=\"keyword\">if</span> err != <span class=\"literal\">nil</span> &#123;</span><br><span class=\"line\">\t\t\th.l.Error(<span class=\"string\">&quot;å¢åŠ é˜…è¯»æ•°å¤±è´¥&quot;</span>, zap.Error(err))</span><br><span class=\"line\">\t\t&#125;</span><br><span class=\"line\">\t&#125;()</span><br><span class=\"line\">\t<span class=\"keyword\">return</span> ginx.Result&#123;</span><br><span class=\"line\">\t\tData: ArticleVO&#123;</span><br><span class=\"line\">\t\t\tId:         art.Id,</span><br><span class=\"line\">\t\t\tTitle:      art.Title,</span><br><span class=\"line\">\t\t\tContent:    art.Content,</span><br><span class=\"line\">\t\t\tAuthorName: art.Author.Name,</span><br><span class=\"line\">\t\t\tReadCnt:    intr.ReadCnt,</span><br><span class=\"line\">\t\t\tLikeCnt:    intr.LikeCnt,</span><br><span class=\"line\">\t\t\tCollectCnt: intr.CollectCnt,</span><br><span class=\"line\">\t\t\tLiked:      intr.Liked,</span><br><span class=\"line\">\t\t\tCollected:  intr.Collected,</span><br><span class=\"line\">\t\t\tCtime:      time.UnixMilli(art.Ctime).Format(time.DateTime),</span><br><span class=\"line\">\t\t\tUtime:      time.UnixMilli(art.Utime).Format(time.DateTime),</span><br><span class=\"line\">\t\t&#125;,</span><br><span class=\"line\">\t&#125;, <span class=\"literal\">nil</span></span><br><span class=\"line\">&#125;</span><br><span class=\"line\"></span><br></pre></td></tr></table></figure>\n\n\n\n<p>âš ï¸ï¼š</p>\n<ul>\n<li><p><strong>æ–¹æ³•ä¸ç›´æ¥ä¿®æ”¹å‚æ•°ï¼Œè€Œæ˜¯é€šè¿‡è¿”å›å€¼é—´æ¥ä¿®æ”¹å‚æ•°</strong></p>\n</li>\n<li><p>è¿”å›å€¼çš„ç±»å‹é€‰æ‹©ï¼š</p>\n<ul>\n<li><p>å¦‚æœæŒ‡é’ˆå®ç°äº†æ¥å£ï¼Œé‚£å°±è¿”å›æŒ‡é’ˆ</p>\n</li>\n<li><p>å¦‚æœè¿”å›å€¼å¾ˆå¤§ï¼Œé¿å…ä¼ é€’å¼•å‘å¤åˆ¶ï¼Œé‚£å°±è¿”å›æŒ‡é’ˆ</p>\n</li>\n</ul>\n</li>\n<li><p>ç®€æ˜“åŸåˆ™ï¼š</p>\n<ul>\n<li>æ¥æ”¶å™¨æ°¸è¿œç”¨æŒ‡é’ˆ</li>\n<li>è¾“å…¥è¾“å‡ºéƒ½ç”¨ç»“æ„ä½“</li>\n</ul>\n</li>\n<li><p>ä¸æ˜¯æ‰€æœ‰ç»“æ„ä½“éƒ½æ˜¯å¯æ¯”è¾ƒçš„</p>\n</li>\n</ul>\n<h2 id=\"åŠŸèƒ½å®ç°å°ç»“\"><a href=\"#åŠŸèƒ½å®ç°å°ç»“\" class=\"headerlink\" title=\"åŠŸèƒ½å®ç°å°ç»“\"></a>åŠŸèƒ½å®ç°å°ç»“</h2><ul>\n<li><strong>å¤§é‡ä½¿ç”¨äº‹ç‰©</strong>ï¼Œä¿è¯åœ¨æ“ä½œä¸¤å¼ è¡¨æ—¶ä¿æŒACIDç‰¹æ€§</li>\n<li><strong>å¤§é‡ä½¿ç”¨Upsertè¯­ä¹‰</strong>ï¼Œå› ä¸ºå¾ˆå¤šæƒ…å†µä¸‹æˆ‘ä»¬ä¸çŸ¥é“è¡¨ä¸­æ˜¯å¦æœ‰å¯¹åº”çš„æ•°æ®</li>\n<li><strong>å¤§é‡ä½¿ç”¨luaè„šæœ¬æ¥ä¿è¯ç¼“å­˜ä¸­çš„æ•°æ®æ˜¯æ­£ç¡®çš„</strong>ï¼Œä½†æ˜¯æ— æ³•å½»åº•è§£å†³ç¼“å­˜ä¸€è‡´æ€§é—®é¢˜</li>\n<li><strong>åœ¨æŸ¥è¯¢æ¥å£è¿™ä¸ªå‘¢ï¼Œåªç¼“å­˜æ€»æ•°æ•°æ®</strong>ï¼Œå¹¶ä¸ä¼šç¼“å­˜ä¸ªäººæ˜¯å¦ç‚¹èµã€æ˜¯å¦æ”¶è—çš„æ•°æ®</li>\n<li><strong>ç¼“å­˜ä¸€è‡´æ€§è™½ç„¶å¾ˆé‡è¦ï¼Œä½†ä¸æ˜¯æ‰€æœ‰çš„åœºæ™¯éƒ½å¿…é¡»ç»´æŠ¤</strong>ã€‚å¦ä¸€æ–¹é¢ï¼Œéœ€è¦å½»åº•è§£å†³ç¼“å­˜ä¸€è‡´æ€§é—®é¢˜çš„åœºæ™¯ï¼Œå°±ä¸åº”è¯¥ä½¿ç”¨ç¼“å­˜</li>\n</ul>\n"},{"title":"MySQLäº‹åŠ¡å­¦ä¹ ","publish":true,"description":"è®°å½•ä¸€äº›æœ‰å…³MySQLäº‹åŠ¡çš„çŸ¥è¯†ç‚¹","date":"2024-09-22T16:00:00.000Z","sticky":2,"_content":"\n\n\n# MySQLäº‹åŠ¡å­¦ä¹ \n\n## äº‹åŠ¡ACID\n\naba\n\n## äº‹åŠ¡éš”ç¦»çº§åˆ«\n\n[å‚è€ƒæ–‡ç« ](https://xiaolincoding.com/mysql/transaction/mvcc.html)\n\n> äº‹åŠ¡å¹¶å‘ä¼š äº§ç”Ÿä»€ä¹ˆé—®é¢˜ï¼Ÿ\n>\n> äº‹åŠ¡éš”ç¦»çº§åˆ«æœ‰å“ªäº›ï¼Ÿæ€ä¹ˆå®ç°çš„ï¼Ÿ\n>\n> è¯»å·²æäº¤å’Œå¯é‡å¤åº¦æœ‰ä»€ä¹ˆåŒºåˆ«ï¼Ÿ\n>\n> MVCCæ˜¯ä»€ä¹ˆï¼Ÿè§£å†³äº†ä»€ä¹ˆé—®é¢˜ï¼Ÿå®ç°åŸç†æ˜¯ä»€ä¹ˆï¼Ÿ\n>\n> å¯é‡å¤è¯»éš”ç¦»çº§åˆ«å½»åº•è§£å†³å¹»è¯»äº†å—ï¼Ÿ\n\näº‹åŠ¡çš„å››ä¸ªç‰¹æ€§ï¼Œä»¥åŠInnoDBå¼•æ“çš„å®ç°æ–¹å¼ï¼š\n\n- åŸå­æ€§\n  - é€šè¿‡undo logï¼ˆå›æ»šæ—¥å¿—ï¼‰æ¥ä¿è¯\n- ä¸€è‡´æ€§\n  - é€šè¿‡**æŒä¹…æ€§+åŸå­æ€§+éš”ç¦»æ€§**æ¥ä¿è¯\n- æŒä¹…æ€§\n  - é€šè¿‡redo logï¼ˆé‡åšæ—¥å¿—ï¼‰æ¥ä¿è¯\n- éš”ç¦»æ€§\n  - é€šè¿‡MVCCï¼ˆå¤šç‰ˆæœ¬å¹¶å‘æ§åˆ¶ï¼‰æˆ–é”æœºåˆ¶æ¥ä¿è¯\n\n### å¹¶è¡Œçš„äº‹åŠ¡ä¼šæœ‰ä»€ä¹ˆé—®é¢˜ï¼Ÿ\n\nMySQLåœ¨åŒæ—¶å¤„ç†å¤šä¸ªäº‹åŠ¡æ—¶ï¼Œå¯èƒ½ä¼šå‡ºç°<font color=\"blue\">**è„è¯»ã€ä¸å¯é‡å¤è¯»ã€å¹»è¯»**</font>çš„é—®é¢˜\n\n#### è„è¯»\n\nä¸€ä¸ªäº‹åŠ¡è¯»å–åˆ°äº†å¦ä¸€ä¸ª**æœªæäº¤çš„äº‹åŠ¡æ‰€ä¿®æ”¹çš„æ•°æ®**ï¼Œå°±æ„å‘³ç€å‘ç”Ÿäº†è„è¯»\n\nğŸŒ°ï¼šäº‹åŠ¡Aè¯»å–å¹¶ä¿®æ”¹è´¦æˆ·ä½™é¢ä¸º`200w`ï¼Œä½†æ²¡æœ‰ç«‹åˆ»æäº¤äº‹åŠ¡ã€‚åœ¨è¿™ä¸€æœŸé—´ï¼Œäº‹åŠ¡Bè¯»å–åˆ°è´¦æˆ·ä½™é¢ä¸º`200w`ï¼Œä½†æ˜¯å‘¢ï¼Œç”±äºäº‹åŠ¡Aè¿˜æœªæ­£å¼æäº¤ï¼Œä»æœ‰å¯èƒ½å‘ç”Ÿå›æ»šæ“ä½œï¼Œå¦‚æœäº‹åŠ¡Aå‘ç”Ÿäº†å›æ»šï¼Œé‚£ä¹ˆäº‹åŠ¡Bè¯»åˆ°çš„æ•°æ®å°±æ˜¯ä¸€ä¸ªæ²¡ç”¨çš„ã€è¿‡æœŸçš„æ•°æ®ï¼Œè¿™ç§ç°è±¡å°±æ˜¯**è„è¯»**\n\n![image-20240921203626317](https://raw.githubusercontent.com/lyydsheep/pic/main/202409212036399.png)\n\n#### ä¸å¯é‡å¤è¯»\n\nåœ¨ä¸€ä¸ªäº‹åŠ¡å†…å¤šæ¬¡è¯»å–åŒä¸€ä¸ªæ•°æ®ï¼Œå¦‚æœå‰åä¸¤æ¬¡è¯»å–ç»“æœä¸åŒï¼Œå°±æ„å‘³ç€å‘ç”Ÿäº†**ä¸å¯é‡å¤è¯»**\n\nğŸŒ°ï¼šäº‹åŠ¡Aæœ‰ä¸¤æ¬¡è¯»å–ä½™é¢æ“ä½œï¼Œå¥½å·§ä¸å·§ğŸ¤ªåœ¨è¿™ä¸¤æ¬¡è¯»å–æ“ä½œä¹‹é—´ï¼Œäº‹åŠ¡Bå¿«é€Ÿçš„ä¿®æ”¹äº†ä½™é¢å¹¶è¿›è¡Œäº†æäº¤ã€‚ç»“æœå°±æ˜¯ï¼Œäº‹åŠ¡Aç¬¬ä¸€æ¬¡è¯»å–åˆ°çš„æ˜¯åŸå§‹æ•°æ®ï¼Œè€Œç¬¬äºŒæ¬¡è¯»å–åˆ°çš„å´æ˜¯äº‹åŠ¡Bä¿®æ”¹è¿‡åçš„æ•°æ®ï¼Œä¸¤æ¬¡æ•°æ®ä¸ä¸€è‡´ï¼è¿™ç§ç°è±¡å°±æ˜¯ä¸å¯é‡å¤è¯»\n\n![image-20240921205212723](https://raw.githubusercontent.com/lyydsheep/pic/main/202409212052763.png)\n\n#### å¹»è¯»\n\nåœ¨ä¸€ä¸ªäº‹åŠ¡å†…å¤šæ¬¡æŸ¥è¯¢ç¬¦åˆæ¡ä»¶çš„**è®°å½•æ•°é‡**ï¼Œå¦‚æœå‡ºç°å‰åæŸ¥è¯¢ç»“æœä¸åŒï¼Œè¿™å°±è¯´æ˜å‘ç”Ÿäº†**å¹»è¯»**\n\nåˆæ˜¯ğŸŒ°ï¼šäº‹åŠ¡AæŸ¥è¯¢å®Œä½™é¢å¤§äº`100w`çš„è®°å½•æ•°é‡ä¸º5æ¡åï¼Œäº‹åŠ¡Aæ‰“ç®—æ­‡ä¸€ä¼šğŸ˜´ã€‚åœ¨äº‹åŠ¡Aæ­‡æ¯çš„è¿‡ç¨‹ä¸­ï¼Œäº‹åŠ¡Bæ‚„æ‚„çš„æ’å…¥äº†ä¸€æ¡ä½™é¢å¤§äº`100w`çš„è®°å½•ï¼Œå¯¼è‡´ç°åœ¨å…±æœ‰6æ¡è®°å½•ç¬¦åˆæŸ¥è¯¢æ¡ä»¶ã€‚å½“äº‹åŠ¡Aé†’æ¥å†æ¬¡è¿›è¡ŒæŸ¥è¯¢æ—¶ï¼Œå°±ä¼šæƒŠè®¶åœ°å‘ç°å¤šäº†ä¸€æ¡è®°å½•ï¼Œ~~é‚£ä¹ˆå®ƒè‚¯å®šä¼šè®¤ä¸ºæ˜¯è‡ªå·±ç¡è§‰ç¡å‡ºå¹»è§‰äº†ğŸ¤ªï¼Œ~~è¿™ç§ç°è±¡å°±æ˜¯**å¹»è¯»**\n\n![image-20240921205706281](https://raw.githubusercontent.com/lyydsheep/pic/main/202409212057315.png)\n\n### æœ‰å“ªäº›äº‹åŠ¡çš„éš”ç¦»çº§åˆ«ï¼Ÿ\n\nç”±å‰æ–‡å¯çŸ¥ï¼Œå¤šä¸ªäº‹åŠ¡å¹¶è¡Œå¤„ç†æ—¶å¯ä»¥ä¼šå‡ºç°**è„è¯»ã€ä¸å¯é‡å¤è¯»ã€å¹»è¯»**ç°è±¡ï¼Œè¿™ä¸‰ç§ç°è±¡æŒ‰ä¸¥é‡æ€§æ’åºå¦‚ä¸‹ï¼š\n\n**`è„è¯» > ä¸å¯é‡å¤è¯» > å¹»è¯»`**\n\né’ˆå¯¹ä¸Šè¿°ä¸‰ç§ç°è±¡å‡ºç°ä¸å¦ï¼ŒSQLæ ‡å‡†æå‡ºäº†å››ç§äº‹åŠ¡éš”ç¦»çº§åˆ«ï¼Œäº‹åŠ¡éš”ç¦»çº§åˆ«è¶Šé«˜ï¼Œæ€§èƒ½è¶Šå·®ğŸ™ƒï¼ŒæŒ‰ç…§éš”ç¦»çº§åˆ«ä»ä½åˆ°é«˜ä¸€æ¬¡æ˜¯ï¼š\n\n- **è¯»æœªæäº¤**ï¼šæŒ‡ä¸€ä¸ªäº‹åŠ¡è¿˜æœªæäº¤ï¼Œå®ƒæ‰€åšçš„æ•°æ®å˜æ›´å°±èƒ½è¢«å…¶ä»–äº‹åŠ¡çœ‹åˆ°\n  - å¯èƒ½å‘ç”Ÿè„è¯»ã€ä¸å¯é‡å¤è¯»ã€å¹»è¯»\n- **è¯»æäº¤**ï¼šæŒ‡ä¸€ä¸ªäº‹åŠ¡åªæœ‰åœ¨æäº¤åï¼Œå®ƒæ‰€åšçš„æ•°æ®å˜æ›´æ‰èƒ½è¢«å…¶ä»–äº‹åŠ¡çœ‹åˆ°\n  - å¯èƒ½å‘ç”Ÿä¸å¯é‡å¤è¯»ã€å¹»è¯»\n- **å¯é‡å¤è¯»**ï¼šæŒ‡ä¸€ä¸ªäº‹åŠ¡æ‰§è¡Œè¿‡ç¨‹ä¸­æ‰€çœ‹åˆ°çš„æ•°æ®åœ¨äº‹åŠ¡å¼€å§‹æ—¶å°±è¢«ç¡®å®šï¼ˆç±»ä¼¼äºå¿«ç…§ğŸ“·ï¼‰ï¼Œæ˜¯InnoDBå¼•æ“çš„é»˜è®¤äº‹åŠ¡éš”ç¦»çº§åˆ«\n  - å¯èƒ½å‘ç”Ÿå¹»è¯»\n- **ä¸²è¡ŒåŒ–**ï¼šä¼šå¯¹è®°å½•åŠ ä¸Šè¯»å†™é”ï¼Œå½“å¤šä¸ªäº‹åŠ¡å‘ç”Ÿè¯»å†™å†²çªæ—¶ï¼Œåè®¿é—®æ•°æ®çš„äº‹åŠ¡å¿…é¡»ç­‰å¾…å‰ä¸€ä¸ªäº‹åŠ¡å®Œæˆæ‰èƒ½ç»§ç»­æ‰§è¡Œ\n  - æœ¨æœ‰é—®é¢˜ï¼Œä½†æ˜¯æ€§èƒ½å¾ˆå·®ğŸ¤ª\n\nâš ï¸ï¼š**MySQLçš„InnoDBå¼•æ“çš„é»˜è®¤äº‹åŠ¡éš”ç¦»çº§åˆ«æ˜¯ã€Œå¯é‡å¤è¯»ã€ï¼Œä½†å®ƒå¾ˆå¤§ç¨‹åº¦ä¸Šé¿å…äº†å¹»è¯»ç°è±¡**ï¼Œè§£å†³æ–¹æ¡ˆæœ‰ä¸¤ç§ï¼š\n\n- é’ˆå¯¹**å¿«ç…§è¯»**ï¼ˆæ™®é€šselectè¯­å¥ï¼‰ï¼Œé€šè¿‡**MVCCæ–¹å¼è§£å†³å¹»è¯»**ã€‚å› ä¸ºäº‹åŠ¡æ‰§è¡Œè¿‡ç¨‹ä¸­çš„æ•°æ®åœ¨äº‹åŠ¡å¼€å§‹æ—¶å°±å·²ç»ç¡®å®šäº†ï¼Œå³ä½¿åœ¨Aäº‹åŠ¡æ‰§è¡Œä¸­ç¨‹Bäº‹åŠ¡æ’å…¥äº†ä¸€æ¡æ•°æ®ï¼Œè¿™ä¹Ÿå¯¹Aäº‹åŠ¡æ˜¯ä¸å¯è§çš„ã€é€æ˜çš„ï¼Œæ‰€ä»¥å°±å¾ˆå¥½çš„é¿å…äº†å¹»è¯»ç°è±¡\n- é’ˆå¯¹**å½“å‰è¯»**ï¼ˆselect ... for updateè¯­å¥ï¼‰ï¼Œé€šè¿‡**next-key lockï¼ˆè®°å½•é”+é—´éš™é”ï¼‰æ–¹å¼è§£å†³äº†å¹»è¯»**ã€‚å› ä¸ºå½“Aäº‹åŠ¡æ‰§è¡Œ`select ... for update`è¯­å¥æ—¶ï¼Œä¼šåŠ ä¸Š`next-key lock`ï¼Œè‹¥äº‹åŠ¡Båœ¨é”çš„èŒƒå›´å†…æ’å…¥äº†ä¸€æ¡æ•°æ®ï¼Œé‚£ä¹ˆäº‹åŠ¡Bçš„æ’å…¥è¯­å¥ä¼šè¢«é˜»å¡ï¼Œæ— æ³•æ’å…¥æˆåŠŸï¼Œæ‰€ä»¥å°±å¾ˆå¥½åœ°è§£å†³äº†å¹»è¯»é—®é¢˜\n\n#### å››ç§éš”ç¦»çº§åˆ«çš„å®ç°æ–¹å¼\n\n- **è¯»æœªæäº¤**\n  - ç›´æ¥è¯»å°±å¥½äº†\n- **ä¸²è¡ŒåŒ–**\n  - åŠ è¯»å†™é”é¿å…å¹¶è¡Œè®¿é—®\n- **è¯»æäº¤**å’Œ**å¯é‡å¤è¯»**éƒ½æ˜¯é€šè¿‡**Read View**æ¥å®ç°çš„ï¼ŒåŒºåˆ«åœ¨äºåˆ›å»ºRead Viewçš„æ—¶æœº\n  - è¯»æäº¤åœ¨**æ¯ä¸€ä¸ªè¯­å¥æ‰§è¡Œä¹‹å‰**éƒ½ä¼šç”Ÿæˆä¸€ä¸ªRead View\n  - å¯é‡å¤è¯»åªåœ¨å¯åŠ¨äº‹åŠ¡æ—¶ç”Ÿæˆä¸€ä¸ªRead Viewï¼Œç„¶åæ•´ä¸ªäº‹åŠ¡æ‰§è¡Œè¿‡ç¨‹ä¸­éƒ½ç”¨è¿™ä¸€ä¸ªRead View\n\nğŸŒŸåŒºåˆ†ã€Œå¼€å¯äº‹åŠ¡ã€å’Œã€Œå¯åŠ¨äº‹åŠ¡ã€\n\nåœ¨MySQLä¸­æœ‰ä¸¤ç§æ–¹å¼**å¼€å¯äº‹åŠ¡**\n\n```sql\n# ç¬¬ä¸€ç§\nbegin/start transaction\n\n# ç¬¬äºŒç§\nstart transaction with consistent snapshot\n```\n\nä»¥ç¬¬ä¸€ç§æ–¹å¼å¼€å¯äº‹åŠ¡ä¸ä»£è¡¨å¯åŠ¨äº†ä¸€ä¸ªäº‹åŠ¡ï¼Œåªæœ‰æ‰§è¡Œäº†ç¬¬ä¸€æ¡selectè¯­å¥ï¼Œæ‰æ˜¯çœŸæ­£å¯åŠ¨äº‹åŠ¡\n\nç¬¬äºŒç§æ–¹å¼åœ¨å¼€å¯äº‹åŠ¡çš„åŒæ—¶ä¹Ÿå¯åŠ¨äº†äº‹åŠ¡ï¼ˆæ¯•ç«Ÿå‘½ä»¤ä¸­éƒ½å¸¦æœ‰`snapshot`ğŸ˜‚ï¼‰\n\n### Read Viewåœ¨MVCCæ˜¯å¦‚ä½•å·¥ä½œçš„ï¼Ÿ\n\n> ä¸¤ä¸ªå‰ç½®çŸ¥è¯†\n>\n> - Read Viewä¸­å››ä¸ªå­—æ®µä½œç”¨\n>\n> - èšç°‡ç´¢å¼•è®°å½•ä¸­ä¸¤ä¸ªè·Ÿäº‹åŠ¡æœ‰å…³çš„ä¸¤ä¸ªéšè—å­—æ®µ\n\nRead Viewå®è´¨æ˜¯ç”±**å››ä¸ªå­—æ®µ**æ„æˆçš„\n\n![image-20240923152532491](https://raw.githubusercontent.com/lyydsheep/pic/main/202409231525562.png)\n\n- **m_ids**ï¼šæŒ‡åœ¨åˆ›å»ºRead Viewæ—¶ï¼Œå½“å‰æ•°æ®åº“ä¸­ã€Œæ´»è·ƒäº‹åŠ¡ã€çš„äº‹åŠ¡idï¼Œå¯èƒ½æœ‰å¤šä¸ª\n  - **æ´»è·ƒäº‹åŠ¡**å³**å¯åŠ¨**äº†ä½†æ˜¯è¿˜æ²¡æœ‰æäº¤çš„äº‹åŠ¡\n- **min_trx_id**ï¼šæ´»è·ƒäº‹åŠ¡ä¸­æœ€å°çš„äº‹åŠ¡id\n- **max_trx_id**ï¼š**æ•°æ®åº“ä¸‹ä¸€ä¸ªå°†åˆ†é…ç»™äº‹åŠ¡çš„id**ï¼Œå³å…¨å±€äº‹åŠ¡idçš„æœ€å¤§å€¼+1\n- **creator_trx_id**ï¼šåˆ›å»ºå½“å‰Read Viewçš„äº‹åŠ¡id\n\näº†è§£å®ŒRead Viewä¸­çš„å››ä¸ªå­—æ®µåï¼Œå†çœ‹çœ‹èšç°‡ç´¢å¼•è®°å½•ä¸­çš„**ä¸¤ä¸ªéšè—å­—æ®µ**ï¼ŒğŸŒ°ï¼š\n\n![image-20240923153259596](https://raw.githubusercontent.com/lyydsheep/pic/main/202409231532645.png)\n\n- **trx_id**ï¼šå½“ä¸€ä¸ªäº‹åŠ¡å¯¹æŸæ¡èšç°‡ç´¢å¼•çš„æ•°æ®è¿›è¡Œæ”¹åŠ¨æ—¶ï¼Œå°±æŠŠè¯¥äº‹åŠ¡çš„idæ”¾å…¥trx_idå­—æ®µä¸­\n- **roll_pointer**ï¼šå½“å¯¹æŸæ¡èšç°‡ç´¢å¼•è®°å½•è¿›è¡Œä¿®æ”¹æ—¶ï¼Œéƒ½ä¼šæŠŠæ—§ç‰ˆæœ¬çš„æ•°æ®è®°å½•åœ¨**undoæ—¥å¿—**ä¸­ï¼Œroll_pointerå°±æŒ‡å‘æ¯ä¸€ä¸ªæ—§ç‰ˆæœ¬çš„æ•°æ®ï¼Œå› æ­¤å¯ä»¥é€šè¿‡roll_pointeréšè—åˆ—æ‰¾åˆ°å†å²è®°å½•\n\n#### MVCC\n\nåœ¨äº†è§£Read Viewå››ä¸ªå­—æ®µä»¥åŠèšç°‡ç´¢å¼•è®°å½•çš„ä¸¤ä¸ªéšè—åˆ—åï¼Œæ¥ä¸‹æ¥å°±å¯ä»¥å¼„æ¸…æ¥šMVCCæ˜¯å¦‚ä½•æ§åˆ¶æ•°æ®å¿«ç…§çš„\n\nå‡è®¾ç°åœ¨æœ‰ä¸€ä¸ªã€Œæ´»è·ƒäº‹åŠ¡ã€äº‹åŠ¡Aï¼Œé‚£ä¹ˆå¯ä»¥æ ¹æ®äº‹åŠ¡Açš„Read Viewåˆ›å»ºæ—¶åˆ»å°†å…¶ä»–äº‹åŠ¡åˆ’åˆ†ä¸ºå››ç±»ï¼š\n\n- äº‹åŠ¡idå°äº`min_trx_id`\n- äº‹åŠ¡idå¤§äºç­‰äº`max_trx_id`\n- äº‹åŠ¡idåœ¨`min_trx_id`å’Œ`max_trx_id`ä¹‹é—´ä¸”ä½äº`m_ids`ä¸­\n- äº‹åŠ¡idåœ¨`min_trx_id`å’Œ`max_trx_id`ä¹‹é—´ä¸”ä¸ä½äº`m_ids`ä¸­\n\n![image-20240923154216650](https://raw.githubusercontent.com/lyydsheep/pic/main/202409231542692.png)\n\n- å¦‚æœè®°å½•çš„éšè—åˆ—`trx_id`å€¼å°äº`min_trx_id`ï¼Œé‚£ä¹ˆè¿™ä¸ªç‰ˆæœ¬çš„è®°å½•æ˜¯åœ¨Read Viewåˆ›å»ºä¹‹å‰å®Œæˆçš„ï¼Œæ‰€ä»¥è¯¥ç‰ˆæœ¬è®°å½•æ˜¯å¯¹å½“å‰äº‹åŠ¡**å¯è§çš„**\n- å¦‚æœ`trx_id`å€¼å¤§äºç­‰äº`max_trx_id`ï¼Œè¯´æ˜è¿™ä¸ªç‰ˆæœ¬çš„è®°å½•æ˜¯åœ¨Read Viewåˆ›å»ºä¹‹åç”Ÿæˆçš„ï¼Œæ•…å¯¹äºå½“å‰äº‹åŠ¡æ˜¯**ä¸å¯è§çš„**\n- å¦‚æœ`trx_id`å€¼åœ¨`min_trx_id`å’Œ`max_trx_id`ä¹‹é—´ï¼Œåˆ™éœ€è¦è¿›ä¸€æ­¥åˆ¤æ–­è®°å½•çš„`trx_id`æ˜¯å¦åœ¨`m_ids`åˆ—è¡¨ä¸­ï¼ˆå³å¯¹äºçš„äº‹åŠ¡æ˜¯å¦æ˜¯æ´»è·ƒäº‹åŠ¡ï¼‰\n  - æ˜¯æ´»è·ƒäº‹åŠ¡ï¼Œé‚£ä¹ˆè¯¥è¯¥ç‰ˆæœ¬çš„è®°å½•å¯¹å½“å‰äº‹åŠ¡**ä¸å¯è§**\n  - ä¸æ˜¯æ´»è·ƒäº‹åŠ¡ï¼Œé‚£ä¹ˆè¯¥ç‰ˆæœ¬çš„è®°å½•æ˜¯**å¯è§çš„**\n  - ğŸŒ°ï¼šåˆ›å»ºäº†1ã€2ã€3ã€4è¿™å››ä¸ªäº‹åŠ¡ï¼Œå…¶ä¸­äº‹åŠ¡3ä»¥è¿…é›·ä¸åŠæ©è€³ä¹‹åŠ¿æäº¤äº†ï¼Œé‚£ä¹ˆéšåå¯åŠ¨çš„äº‹åŠ¡5æ˜¯å¯ä»¥çœ‹è§äº‹åŠ¡3æ‰€ä¿®æ”¹çš„è®°å½•ç‰ˆæœ¬çš„\n\n**è¿™ç§é€šè¿‡ã€Œç‰ˆæœ¬é“¾ã€æ¥æ§åˆ¶å¹¶å‘äº‹åŠ¡ä¸å†²çªåœ°è®¿é—®åŒä¸€æ¡è®°å½•çš„æ“ä½œå°±å«MVCCï¼ˆå¤šç‰ˆæœ¬å¹¶å‘æ§åˆ¶ï¼‰**\n\n","source":"_posts/MySQL/MySQLäº‹åŠ¡å­¦ä¹ .md","raw":"---\ntitle: MySQLäº‹åŠ¡å­¦ä¹ \npublish: true\ndescription: è®°å½•ä¸€äº›æœ‰å…³MySQLäº‹åŠ¡çš„çŸ¥è¯†ç‚¹\ndate: 2024-09-23 \ntag: MySQL\nsticky: 2\n---\n\n\n\n# MySQLäº‹åŠ¡å­¦ä¹ \n\n## äº‹åŠ¡ACID\n\naba\n\n## äº‹åŠ¡éš”ç¦»çº§åˆ«\n\n[å‚è€ƒæ–‡ç« ](https://xiaolincoding.com/mysql/transaction/mvcc.html)\n\n> äº‹åŠ¡å¹¶å‘ä¼š äº§ç”Ÿä»€ä¹ˆé—®é¢˜ï¼Ÿ\n>\n> äº‹åŠ¡éš”ç¦»çº§åˆ«æœ‰å“ªäº›ï¼Ÿæ€ä¹ˆå®ç°çš„ï¼Ÿ\n>\n> è¯»å·²æäº¤å’Œå¯é‡å¤åº¦æœ‰ä»€ä¹ˆåŒºåˆ«ï¼Ÿ\n>\n> MVCCæ˜¯ä»€ä¹ˆï¼Ÿè§£å†³äº†ä»€ä¹ˆé—®é¢˜ï¼Ÿå®ç°åŸç†æ˜¯ä»€ä¹ˆï¼Ÿ\n>\n> å¯é‡å¤è¯»éš”ç¦»çº§åˆ«å½»åº•è§£å†³å¹»è¯»äº†å—ï¼Ÿ\n\näº‹åŠ¡çš„å››ä¸ªç‰¹æ€§ï¼Œä»¥åŠInnoDBå¼•æ“çš„å®ç°æ–¹å¼ï¼š\n\n- åŸå­æ€§\n  - é€šè¿‡undo logï¼ˆå›æ»šæ—¥å¿—ï¼‰æ¥ä¿è¯\n- ä¸€è‡´æ€§\n  - é€šè¿‡**æŒä¹…æ€§+åŸå­æ€§+éš”ç¦»æ€§**æ¥ä¿è¯\n- æŒä¹…æ€§\n  - é€šè¿‡redo logï¼ˆé‡åšæ—¥å¿—ï¼‰æ¥ä¿è¯\n- éš”ç¦»æ€§\n  - é€šè¿‡MVCCï¼ˆå¤šç‰ˆæœ¬å¹¶å‘æ§åˆ¶ï¼‰æˆ–é”æœºåˆ¶æ¥ä¿è¯\n\n### å¹¶è¡Œçš„äº‹åŠ¡ä¼šæœ‰ä»€ä¹ˆé—®é¢˜ï¼Ÿ\n\nMySQLåœ¨åŒæ—¶å¤„ç†å¤šä¸ªäº‹åŠ¡æ—¶ï¼Œå¯èƒ½ä¼šå‡ºç°<font color=\"blue\">**è„è¯»ã€ä¸å¯é‡å¤è¯»ã€å¹»è¯»**</font>çš„é—®é¢˜\n\n#### è„è¯»\n\nä¸€ä¸ªäº‹åŠ¡è¯»å–åˆ°äº†å¦ä¸€ä¸ª**æœªæäº¤çš„äº‹åŠ¡æ‰€ä¿®æ”¹çš„æ•°æ®**ï¼Œå°±æ„å‘³ç€å‘ç”Ÿäº†è„è¯»\n\nğŸŒ°ï¼šäº‹åŠ¡Aè¯»å–å¹¶ä¿®æ”¹è´¦æˆ·ä½™é¢ä¸º`200w`ï¼Œä½†æ²¡æœ‰ç«‹åˆ»æäº¤äº‹åŠ¡ã€‚åœ¨è¿™ä¸€æœŸé—´ï¼Œäº‹åŠ¡Bè¯»å–åˆ°è´¦æˆ·ä½™é¢ä¸º`200w`ï¼Œä½†æ˜¯å‘¢ï¼Œç”±äºäº‹åŠ¡Aè¿˜æœªæ­£å¼æäº¤ï¼Œä»æœ‰å¯èƒ½å‘ç”Ÿå›æ»šæ“ä½œï¼Œå¦‚æœäº‹åŠ¡Aå‘ç”Ÿäº†å›æ»šï¼Œé‚£ä¹ˆäº‹åŠ¡Bè¯»åˆ°çš„æ•°æ®å°±æ˜¯ä¸€ä¸ªæ²¡ç”¨çš„ã€è¿‡æœŸçš„æ•°æ®ï¼Œè¿™ç§ç°è±¡å°±æ˜¯**è„è¯»**\n\n![image-20240921203626317](https://raw.githubusercontent.com/lyydsheep/pic/main/202409212036399.png)\n\n#### ä¸å¯é‡å¤è¯»\n\nåœ¨ä¸€ä¸ªäº‹åŠ¡å†…å¤šæ¬¡è¯»å–åŒä¸€ä¸ªæ•°æ®ï¼Œå¦‚æœå‰åä¸¤æ¬¡è¯»å–ç»“æœä¸åŒï¼Œå°±æ„å‘³ç€å‘ç”Ÿäº†**ä¸å¯é‡å¤è¯»**\n\nğŸŒ°ï¼šäº‹åŠ¡Aæœ‰ä¸¤æ¬¡è¯»å–ä½™é¢æ“ä½œï¼Œå¥½å·§ä¸å·§ğŸ¤ªåœ¨è¿™ä¸¤æ¬¡è¯»å–æ“ä½œä¹‹é—´ï¼Œäº‹åŠ¡Bå¿«é€Ÿçš„ä¿®æ”¹äº†ä½™é¢å¹¶è¿›è¡Œäº†æäº¤ã€‚ç»“æœå°±æ˜¯ï¼Œäº‹åŠ¡Aç¬¬ä¸€æ¬¡è¯»å–åˆ°çš„æ˜¯åŸå§‹æ•°æ®ï¼Œè€Œç¬¬äºŒæ¬¡è¯»å–åˆ°çš„å´æ˜¯äº‹åŠ¡Bä¿®æ”¹è¿‡åçš„æ•°æ®ï¼Œä¸¤æ¬¡æ•°æ®ä¸ä¸€è‡´ï¼è¿™ç§ç°è±¡å°±æ˜¯ä¸å¯é‡å¤è¯»\n\n![image-20240921205212723](https://raw.githubusercontent.com/lyydsheep/pic/main/202409212052763.png)\n\n#### å¹»è¯»\n\nåœ¨ä¸€ä¸ªäº‹åŠ¡å†…å¤šæ¬¡æŸ¥è¯¢ç¬¦åˆæ¡ä»¶çš„**è®°å½•æ•°é‡**ï¼Œå¦‚æœå‡ºç°å‰åæŸ¥è¯¢ç»“æœä¸åŒï¼Œè¿™å°±è¯´æ˜å‘ç”Ÿäº†**å¹»è¯»**\n\nåˆæ˜¯ğŸŒ°ï¼šäº‹åŠ¡AæŸ¥è¯¢å®Œä½™é¢å¤§äº`100w`çš„è®°å½•æ•°é‡ä¸º5æ¡åï¼Œäº‹åŠ¡Aæ‰“ç®—æ­‡ä¸€ä¼šğŸ˜´ã€‚åœ¨äº‹åŠ¡Aæ­‡æ¯çš„è¿‡ç¨‹ä¸­ï¼Œäº‹åŠ¡Bæ‚„æ‚„çš„æ’å…¥äº†ä¸€æ¡ä½™é¢å¤§äº`100w`çš„è®°å½•ï¼Œå¯¼è‡´ç°åœ¨å…±æœ‰6æ¡è®°å½•ç¬¦åˆæŸ¥è¯¢æ¡ä»¶ã€‚å½“äº‹åŠ¡Aé†’æ¥å†æ¬¡è¿›è¡ŒæŸ¥è¯¢æ—¶ï¼Œå°±ä¼šæƒŠè®¶åœ°å‘ç°å¤šäº†ä¸€æ¡è®°å½•ï¼Œ~~é‚£ä¹ˆå®ƒè‚¯å®šä¼šè®¤ä¸ºæ˜¯è‡ªå·±ç¡è§‰ç¡å‡ºå¹»è§‰äº†ğŸ¤ªï¼Œ~~è¿™ç§ç°è±¡å°±æ˜¯**å¹»è¯»**\n\n![image-20240921205706281](https://raw.githubusercontent.com/lyydsheep/pic/main/202409212057315.png)\n\n### æœ‰å“ªäº›äº‹åŠ¡çš„éš”ç¦»çº§åˆ«ï¼Ÿ\n\nç”±å‰æ–‡å¯çŸ¥ï¼Œå¤šä¸ªäº‹åŠ¡å¹¶è¡Œå¤„ç†æ—¶å¯ä»¥ä¼šå‡ºç°**è„è¯»ã€ä¸å¯é‡å¤è¯»ã€å¹»è¯»**ç°è±¡ï¼Œè¿™ä¸‰ç§ç°è±¡æŒ‰ä¸¥é‡æ€§æ’åºå¦‚ä¸‹ï¼š\n\n**`è„è¯» > ä¸å¯é‡å¤è¯» > å¹»è¯»`**\n\né’ˆå¯¹ä¸Šè¿°ä¸‰ç§ç°è±¡å‡ºç°ä¸å¦ï¼ŒSQLæ ‡å‡†æå‡ºäº†å››ç§äº‹åŠ¡éš”ç¦»çº§åˆ«ï¼Œäº‹åŠ¡éš”ç¦»çº§åˆ«è¶Šé«˜ï¼Œæ€§èƒ½è¶Šå·®ğŸ™ƒï¼ŒæŒ‰ç…§éš”ç¦»çº§åˆ«ä»ä½åˆ°é«˜ä¸€æ¬¡æ˜¯ï¼š\n\n- **è¯»æœªæäº¤**ï¼šæŒ‡ä¸€ä¸ªäº‹åŠ¡è¿˜æœªæäº¤ï¼Œå®ƒæ‰€åšçš„æ•°æ®å˜æ›´å°±èƒ½è¢«å…¶ä»–äº‹åŠ¡çœ‹åˆ°\n  - å¯èƒ½å‘ç”Ÿè„è¯»ã€ä¸å¯é‡å¤è¯»ã€å¹»è¯»\n- **è¯»æäº¤**ï¼šæŒ‡ä¸€ä¸ªäº‹åŠ¡åªæœ‰åœ¨æäº¤åï¼Œå®ƒæ‰€åšçš„æ•°æ®å˜æ›´æ‰èƒ½è¢«å…¶ä»–äº‹åŠ¡çœ‹åˆ°\n  - å¯èƒ½å‘ç”Ÿä¸å¯é‡å¤è¯»ã€å¹»è¯»\n- **å¯é‡å¤è¯»**ï¼šæŒ‡ä¸€ä¸ªäº‹åŠ¡æ‰§è¡Œè¿‡ç¨‹ä¸­æ‰€çœ‹åˆ°çš„æ•°æ®åœ¨äº‹åŠ¡å¼€å§‹æ—¶å°±è¢«ç¡®å®šï¼ˆç±»ä¼¼äºå¿«ç…§ğŸ“·ï¼‰ï¼Œæ˜¯InnoDBå¼•æ“çš„é»˜è®¤äº‹åŠ¡éš”ç¦»çº§åˆ«\n  - å¯èƒ½å‘ç”Ÿå¹»è¯»\n- **ä¸²è¡ŒåŒ–**ï¼šä¼šå¯¹è®°å½•åŠ ä¸Šè¯»å†™é”ï¼Œå½“å¤šä¸ªäº‹åŠ¡å‘ç”Ÿè¯»å†™å†²çªæ—¶ï¼Œåè®¿é—®æ•°æ®çš„äº‹åŠ¡å¿…é¡»ç­‰å¾…å‰ä¸€ä¸ªäº‹åŠ¡å®Œæˆæ‰èƒ½ç»§ç»­æ‰§è¡Œ\n  - æœ¨æœ‰é—®é¢˜ï¼Œä½†æ˜¯æ€§èƒ½å¾ˆå·®ğŸ¤ª\n\nâš ï¸ï¼š**MySQLçš„InnoDBå¼•æ“çš„é»˜è®¤äº‹åŠ¡éš”ç¦»çº§åˆ«æ˜¯ã€Œå¯é‡å¤è¯»ã€ï¼Œä½†å®ƒå¾ˆå¤§ç¨‹åº¦ä¸Šé¿å…äº†å¹»è¯»ç°è±¡**ï¼Œè§£å†³æ–¹æ¡ˆæœ‰ä¸¤ç§ï¼š\n\n- é’ˆå¯¹**å¿«ç…§è¯»**ï¼ˆæ™®é€šselectè¯­å¥ï¼‰ï¼Œé€šè¿‡**MVCCæ–¹å¼è§£å†³å¹»è¯»**ã€‚å› ä¸ºäº‹åŠ¡æ‰§è¡Œè¿‡ç¨‹ä¸­çš„æ•°æ®åœ¨äº‹åŠ¡å¼€å§‹æ—¶å°±å·²ç»ç¡®å®šäº†ï¼Œå³ä½¿åœ¨Aäº‹åŠ¡æ‰§è¡Œä¸­ç¨‹Bäº‹åŠ¡æ’å…¥äº†ä¸€æ¡æ•°æ®ï¼Œè¿™ä¹Ÿå¯¹Aäº‹åŠ¡æ˜¯ä¸å¯è§çš„ã€é€æ˜çš„ï¼Œæ‰€ä»¥å°±å¾ˆå¥½çš„é¿å…äº†å¹»è¯»ç°è±¡\n- é’ˆå¯¹**å½“å‰è¯»**ï¼ˆselect ... for updateè¯­å¥ï¼‰ï¼Œé€šè¿‡**next-key lockï¼ˆè®°å½•é”+é—´éš™é”ï¼‰æ–¹å¼è§£å†³äº†å¹»è¯»**ã€‚å› ä¸ºå½“Aäº‹åŠ¡æ‰§è¡Œ`select ... for update`è¯­å¥æ—¶ï¼Œä¼šåŠ ä¸Š`next-key lock`ï¼Œè‹¥äº‹åŠ¡Båœ¨é”çš„èŒƒå›´å†…æ’å…¥äº†ä¸€æ¡æ•°æ®ï¼Œé‚£ä¹ˆäº‹åŠ¡Bçš„æ’å…¥è¯­å¥ä¼šè¢«é˜»å¡ï¼Œæ— æ³•æ’å…¥æˆåŠŸï¼Œæ‰€ä»¥å°±å¾ˆå¥½åœ°è§£å†³äº†å¹»è¯»é—®é¢˜\n\n#### å››ç§éš”ç¦»çº§åˆ«çš„å®ç°æ–¹å¼\n\n- **è¯»æœªæäº¤**\n  - ç›´æ¥è¯»å°±å¥½äº†\n- **ä¸²è¡ŒåŒ–**\n  - åŠ è¯»å†™é”é¿å…å¹¶è¡Œè®¿é—®\n- **è¯»æäº¤**å’Œ**å¯é‡å¤è¯»**éƒ½æ˜¯é€šè¿‡**Read View**æ¥å®ç°çš„ï¼ŒåŒºåˆ«åœ¨äºåˆ›å»ºRead Viewçš„æ—¶æœº\n  - è¯»æäº¤åœ¨**æ¯ä¸€ä¸ªè¯­å¥æ‰§è¡Œä¹‹å‰**éƒ½ä¼šç”Ÿæˆä¸€ä¸ªRead View\n  - å¯é‡å¤è¯»åªåœ¨å¯åŠ¨äº‹åŠ¡æ—¶ç”Ÿæˆä¸€ä¸ªRead Viewï¼Œç„¶åæ•´ä¸ªäº‹åŠ¡æ‰§è¡Œè¿‡ç¨‹ä¸­éƒ½ç”¨è¿™ä¸€ä¸ªRead View\n\nğŸŒŸåŒºåˆ†ã€Œå¼€å¯äº‹åŠ¡ã€å’Œã€Œå¯åŠ¨äº‹åŠ¡ã€\n\nåœ¨MySQLä¸­æœ‰ä¸¤ç§æ–¹å¼**å¼€å¯äº‹åŠ¡**\n\n```sql\n# ç¬¬ä¸€ç§\nbegin/start transaction\n\n# ç¬¬äºŒç§\nstart transaction with consistent snapshot\n```\n\nä»¥ç¬¬ä¸€ç§æ–¹å¼å¼€å¯äº‹åŠ¡ä¸ä»£è¡¨å¯åŠ¨äº†ä¸€ä¸ªäº‹åŠ¡ï¼Œåªæœ‰æ‰§è¡Œäº†ç¬¬ä¸€æ¡selectè¯­å¥ï¼Œæ‰æ˜¯çœŸæ­£å¯åŠ¨äº‹åŠ¡\n\nç¬¬äºŒç§æ–¹å¼åœ¨å¼€å¯äº‹åŠ¡çš„åŒæ—¶ä¹Ÿå¯åŠ¨äº†äº‹åŠ¡ï¼ˆæ¯•ç«Ÿå‘½ä»¤ä¸­éƒ½å¸¦æœ‰`snapshot`ğŸ˜‚ï¼‰\n\n### Read Viewåœ¨MVCCæ˜¯å¦‚ä½•å·¥ä½œçš„ï¼Ÿ\n\n> ä¸¤ä¸ªå‰ç½®çŸ¥è¯†\n>\n> - Read Viewä¸­å››ä¸ªå­—æ®µä½œç”¨\n>\n> - èšç°‡ç´¢å¼•è®°å½•ä¸­ä¸¤ä¸ªè·Ÿäº‹åŠ¡æœ‰å…³çš„ä¸¤ä¸ªéšè—å­—æ®µ\n\nRead Viewå®è´¨æ˜¯ç”±**å››ä¸ªå­—æ®µ**æ„æˆçš„\n\n![image-20240923152532491](https://raw.githubusercontent.com/lyydsheep/pic/main/202409231525562.png)\n\n- **m_ids**ï¼šæŒ‡åœ¨åˆ›å»ºRead Viewæ—¶ï¼Œå½“å‰æ•°æ®åº“ä¸­ã€Œæ´»è·ƒäº‹åŠ¡ã€çš„äº‹åŠ¡idï¼Œå¯èƒ½æœ‰å¤šä¸ª\n  - **æ´»è·ƒäº‹åŠ¡**å³**å¯åŠ¨**äº†ä½†æ˜¯è¿˜æ²¡æœ‰æäº¤çš„äº‹åŠ¡\n- **min_trx_id**ï¼šæ´»è·ƒäº‹åŠ¡ä¸­æœ€å°çš„äº‹åŠ¡id\n- **max_trx_id**ï¼š**æ•°æ®åº“ä¸‹ä¸€ä¸ªå°†åˆ†é…ç»™äº‹åŠ¡çš„id**ï¼Œå³å…¨å±€äº‹åŠ¡idçš„æœ€å¤§å€¼+1\n- **creator_trx_id**ï¼šåˆ›å»ºå½“å‰Read Viewçš„äº‹åŠ¡id\n\näº†è§£å®ŒRead Viewä¸­çš„å››ä¸ªå­—æ®µåï¼Œå†çœ‹çœ‹èšç°‡ç´¢å¼•è®°å½•ä¸­çš„**ä¸¤ä¸ªéšè—å­—æ®µ**ï¼ŒğŸŒ°ï¼š\n\n![image-20240923153259596](https://raw.githubusercontent.com/lyydsheep/pic/main/202409231532645.png)\n\n- **trx_id**ï¼šå½“ä¸€ä¸ªäº‹åŠ¡å¯¹æŸæ¡èšç°‡ç´¢å¼•çš„æ•°æ®è¿›è¡Œæ”¹åŠ¨æ—¶ï¼Œå°±æŠŠè¯¥äº‹åŠ¡çš„idæ”¾å…¥trx_idå­—æ®µä¸­\n- **roll_pointer**ï¼šå½“å¯¹æŸæ¡èšç°‡ç´¢å¼•è®°å½•è¿›è¡Œä¿®æ”¹æ—¶ï¼Œéƒ½ä¼šæŠŠæ—§ç‰ˆæœ¬çš„æ•°æ®è®°å½•åœ¨**undoæ—¥å¿—**ä¸­ï¼Œroll_pointerå°±æŒ‡å‘æ¯ä¸€ä¸ªæ—§ç‰ˆæœ¬çš„æ•°æ®ï¼Œå› æ­¤å¯ä»¥é€šè¿‡roll_pointeréšè—åˆ—æ‰¾åˆ°å†å²è®°å½•\n\n#### MVCC\n\nåœ¨äº†è§£Read Viewå››ä¸ªå­—æ®µä»¥åŠèšç°‡ç´¢å¼•è®°å½•çš„ä¸¤ä¸ªéšè—åˆ—åï¼Œæ¥ä¸‹æ¥å°±å¯ä»¥å¼„æ¸…æ¥šMVCCæ˜¯å¦‚ä½•æ§åˆ¶æ•°æ®å¿«ç…§çš„\n\nå‡è®¾ç°åœ¨æœ‰ä¸€ä¸ªã€Œæ´»è·ƒäº‹åŠ¡ã€äº‹åŠ¡Aï¼Œé‚£ä¹ˆå¯ä»¥æ ¹æ®äº‹åŠ¡Açš„Read Viewåˆ›å»ºæ—¶åˆ»å°†å…¶ä»–äº‹åŠ¡åˆ’åˆ†ä¸ºå››ç±»ï¼š\n\n- äº‹åŠ¡idå°äº`min_trx_id`\n- äº‹åŠ¡idå¤§äºç­‰äº`max_trx_id`\n- äº‹åŠ¡idåœ¨`min_trx_id`å’Œ`max_trx_id`ä¹‹é—´ä¸”ä½äº`m_ids`ä¸­\n- äº‹åŠ¡idåœ¨`min_trx_id`å’Œ`max_trx_id`ä¹‹é—´ä¸”ä¸ä½äº`m_ids`ä¸­\n\n![image-20240923154216650](https://raw.githubusercontent.com/lyydsheep/pic/main/202409231542692.png)\n\n- å¦‚æœè®°å½•çš„éšè—åˆ—`trx_id`å€¼å°äº`min_trx_id`ï¼Œé‚£ä¹ˆè¿™ä¸ªç‰ˆæœ¬çš„è®°å½•æ˜¯åœ¨Read Viewåˆ›å»ºä¹‹å‰å®Œæˆçš„ï¼Œæ‰€ä»¥è¯¥ç‰ˆæœ¬è®°å½•æ˜¯å¯¹å½“å‰äº‹åŠ¡**å¯è§çš„**\n- å¦‚æœ`trx_id`å€¼å¤§äºç­‰äº`max_trx_id`ï¼Œè¯´æ˜è¿™ä¸ªç‰ˆæœ¬çš„è®°å½•æ˜¯åœ¨Read Viewåˆ›å»ºä¹‹åç”Ÿæˆçš„ï¼Œæ•…å¯¹äºå½“å‰äº‹åŠ¡æ˜¯**ä¸å¯è§çš„**\n- å¦‚æœ`trx_id`å€¼åœ¨`min_trx_id`å’Œ`max_trx_id`ä¹‹é—´ï¼Œåˆ™éœ€è¦è¿›ä¸€æ­¥åˆ¤æ–­è®°å½•çš„`trx_id`æ˜¯å¦åœ¨`m_ids`åˆ—è¡¨ä¸­ï¼ˆå³å¯¹äºçš„äº‹åŠ¡æ˜¯å¦æ˜¯æ´»è·ƒäº‹åŠ¡ï¼‰\n  - æ˜¯æ´»è·ƒäº‹åŠ¡ï¼Œé‚£ä¹ˆè¯¥è¯¥ç‰ˆæœ¬çš„è®°å½•å¯¹å½“å‰äº‹åŠ¡**ä¸å¯è§**\n  - ä¸æ˜¯æ´»è·ƒäº‹åŠ¡ï¼Œé‚£ä¹ˆè¯¥ç‰ˆæœ¬çš„è®°å½•æ˜¯**å¯è§çš„**\n  - ğŸŒ°ï¼šåˆ›å»ºäº†1ã€2ã€3ã€4è¿™å››ä¸ªäº‹åŠ¡ï¼Œå…¶ä¸­äº‹åŠ¡3ä»¥è¿…é›·ä¸åŠæ©è€³ä¹‹åŠ¿æäº¤äº†ï¼Œé‚£ä¹ˆéšåå¯åŠ¨çš„äº‹åŠ¡5æ˜¯å¯ä»¥çœ‹è§äº‹åŠ¡3æ‰€ä¿®æ”¹çš„è®°å½•ç‰ˆæœ¬çš„\n\n**è¿™ç§é€šè¿‡ã€Œç‰ˆæœ¬é“¾ã€æ¥æ§åˆ¶å¹¶å‘äº‹åŠ¡ä¸å†²çªåœ°è®¿é—®åŒä¸€æ¡è®°å½•çš„æ“ä½œå°±å«MVCCï¼ˆå¤šç‰ˆæœ¬å¹¶å‘æ§åˆ¶ï¼‰**\n\n","slug":"MySQL/MySQLäº‹åŠ¡å­¦ä¹ ","published":1,"updated":"2024-12-27T11:03:15.343Z","comments":1,"layout":"post","photos":[],"_id":"cm6c7md6n0029a5t23h4se78m","content":"<h1 id=\"MySQLäº‹åŠ¡å­¦ä¹ \"><a href=\"#MySQLäº‹åŠ¡å­¦ä¹ \" class=\"headerlink\" title=\"MySQLäº‹åŠ¡å­¦ä¹ \"></a>MySQLäº‹åŠ¡å­¦ä¹ </h1><h2 id=\"äº‹åŠ¡ACID\"><a href=\"#äº‹åŠ¡ACID\" class=\"headerlink\" title=\"äº‹åŠ¡ACID\"></a>äº‹åŠ¡ACID</h2><p>aba</p>\n<h2 id=\"äº‹åŠ¡éš”ç¦»çº§åˆ«\"><a href=\"#äº‹åŠ¡éš”ç¦»çº§åˆ«\" class=\"headerlink\" title=\"äº‹åŠ¡éš”ç¦»çº§åˆ«\"></a>äº‹åŠ¡éš”ç¦»çº§åˆ«</h2><p><a href=\"https://xiaolincoding.com/mysql/transaction/mvcc.html\">å‚è€ƒæ–‡ç« </a></p>\n<blockquote>\n<p>äº‹åŠ¡å¹¶å‘ä¼š äº§ç”Ÿä»€ä¹ˆé—®é¢˜ï¼Ÿ</p>\n<p>äº‹åŠ¡éš”ç¦»çº§åˆ«æœ‰å“ªäº›ï¼Ÿæ€ä¹ˆå®ç°çš„ï¼Ÿ</p>\n<p>è¯»å·²æäº¤å’Œå¯é‡å¤åº¦æœ‰ä»€ä¹ˆåŒºåˆ«ï¼Ÿ</p>\n<p>MVCCæ˜¯ä»€ä¹ˆï¼Ÿè§£å†³äº†ä»€ä¹ˆé—®é¢˜ï¼Ÿå®ç°åŸç†æ˜¯ä»€ä¹ˆï¼Ÿ</p>\n<p>å¯é‡å¤è¯»éš”ç¦»çº§åˆ«å½»åº•è§£å†³å¹»è¯»äº†å—ï¼Ÿ</p>\n</blockquote>\n<p>äº‹åŠ¡çš„å››ä¸ªç‰¹æ€§ï¼Œä»¥åŠInnoDBå¼•æ“çš„å®ç°æ–¹å¼ï¼š</p>\n<ul>\n<li>åŸå­æ€§<ul>\n<li>é€šè¿‡undo logï¼ˆå›æ»šæ—¥å¿—ï¼‰æ¥ä¿è¯</li>\n</ul>\n</li>\n<li>ä¸€è‡´æ€§<ul>\n<li>é€šè¿‡<strong>æŒä¹…æ€§+åŸå­æ€§+éš”ç¦»æ€§</strong>æ¥ä¿è¯</li>\n</ul>\n</li>\n<li>æŒä¹…æ€§<ul>\n<li>é€šè¿‡redo logï¼ˆé‡åšæ—¥å¿—ï¼‰æ¥ä¿è¯</li>\n</ul>\n</li>\n<li>éš”ç¦»æ€§<ul>\n<li>é€šè¿‡MVCCï¼ˆå¤šç‰ˆæœ¬å¹¶å‘æ§åˆ¶ï¼‰æˆ–é”æœºåˆ¶æ¥ä¿è¯</li>\n</ul>\n</li>\n</ul>\n<h3 id=\"å¹¶è¡Œçš„äº‹åŠ¡ä¼šæœ‰ä»€ä¹ˆé—®é¢˜ï¼Ÿ\"><a href=\"#å¹¶è¡Œçš„äº‹åŠ¡ä¼šæœ‰ä»€ä¹ˆé—®é¢˜ï¼Ÿ\" class=\"headerlink\" title=\"å¹¶è¡Œçš„äº‹åŠ¡ä¼šæœ‰ä»€ä¹ˆé—®é¢˜ï¼Ÿ\"></a>å¹¶è¡Œçš„äº‹åŠ¡ä¼šæœ‰ä»€ä¹ˆé—®é¢˜ï¼Ÿ</h3><p>MySQLåœ¨åŒæ—¶å¤„ç†å¤šä¸ªäº‹åŠ¡æ—¶ï¼Œå¯èƒ½ä¼šå‡ºç°<font color=\"blue\"><strong>è„è¯»ã€ä¸å¯é‡å¤è¯»ã€å¹»è¯»</strong></font>çš„é—®é¢˜</p>\n<h4 id=\"è„è¯»\"><a href=\"#è„è¯»\" class=\"headerlink\" title=\"è„è¯»\"></a>è„è¯»</h4><p>ä¸€ä¸ªäº‹åŠ¡è¯»å–åˆ°äº†å¦ä¸€ä¸ª<strong>æœªæäº¤çš„äº‹åŠ¡æ‰€ä¿®æ”¹çš„æ•°æ®</strong>ï¼Œå°±æ„å‘³ç€å‘ç”Ÿäº†è„è¯»</p>\n<p>ğŸŒ°ï¼šäº‹åŠ¡Aè¯»å–å¹¶ä¿®æ”¹è´¦æˆ·ä½™é¢ä¸º<code>200w</code>ï¼Œä½†æ²¡æœ‰ç«‹åˆ»æäº¤äº‹åŠ¡ã€‚åœ¨è¿™ä¸€æœŸé—´ï¼Œäº‹åŠ¡Bè¯»å–åˆ°è´¦æˆ·ä½™é¢ä¸º<code>200w</code>ï¼Œä½†æ˜¯å‘¢ï¼Œç”±äºäº‹åŠ¡Aè¿˜æœªæ­£å¼æäº¤ï¼Œä»æœ‰å¯èƒ½å‘ç”Ÿå›æ»šæ“ä½œï¼Œå¦‚æœäº‹åŠ¡Aå‘ç”Ÿäº†å›æ»šï¼Œé‚£ä¹ˆäº‹åŠ¡Bè¯»åˆ°çš„æ•°æ®å°±æ˜¯ä¸€ä¸ªæ²¡ç”¨çš„ã€è¿‡æœŸçš„æ•°æ®ï¼Œè¿™ç§ç°è±¡å°±æ˜¯<strong>è„è¯»</strong></p>\n<p><img src=\"https://raw.githubusercontent.com/lyydsheep/pic/main/202409212036399.png\" alt=\"image-20240921203626317\"></p>\n<h4 id=\"ä¸å¯é‡å¤è¯»\"><a href=\"#ä¸å¯é‡å¤è¯»\" class=\"headerlink\" title=\"ä¸å¯é‡å¤è¯»\"></a>ä¸å¯é‡å¤è¯»</h4><p>åœ¨ä¸€ä¸ªäº‹åŠ¡å†…å¤šæ¬¡è¯»å–åŒä¸€ä¸ªæ•°æ®ï¼Œå¦‚æœå‰åä¸¤æ¬¡è¯»å–ç»“æœä¸åŒï¼Œå°±æ„å‘³ç€å‘ç”Ÿäº†<strong>ä¸å¯é‡å¤è¯»</strong></p>\n<p>ğŸŒ°ï¼šäº‹åŠ¡Aæœ‰ä¸¤æ¬¡è¯»å–ä½™é¢æ“ä½œï¼Œå¥½å·§ä¸å·§ğŸ¤ªåœ¨è¿™ä¸¤æ¬¡è¯»å–æ“ä½œä¹‹é—´ï¼Œäº‹åŠ¡Bå¿«é€Ÿçš„ä¿®æ”¹äº†ä½™é¢å¹¶è¿›è¡Œäº†æäº¤ã€‚ç»“æœå°±æ˜¯ï¼Œäº‹åŠ¡Aç¬¬ä¸€æ¬¡è¯»å–åˆ°çš„æ˜¯åŸå§‹æ•°æ®ï¼Œè€Œç¬¬äºŒæ¬¡è¯»å–åˆ°çš„å´æ˜¯äº‹åŠ¡Bä¿®æ”¹è¿‡åçš„æ•°æ®ï¼Œä¸¤æ¬¡æ•°æ®ä¸ä¸€è‡´ï¼è¿™ç§ç°è±¡å°±æ˜¯ä¸å¯é‡å¤è¯»</p>\n<p><img src=\"https://raw.githubusercontent.com/lyydsheep/pic/main/202409212052763.png\" alt=\"image-20240921205212723\"></p>\n<h4 id=\"å¹»è¯»\"><a href=\"#å¹»è¯»\" class=\"headerlink\" title=\"å¹»è¯»\"></a>å¹»è¯»</h4><p>åœ¨ä¸€ä¸ªäº‹åŠ¡å†…å¤šæ¬¡æŸ¥è¯¢ç¬¦åˆæ¡ä»¶çš„<strong>è®°å½•æ•°é‡</strong>ï¼Œå¦‚æœå‡ºç°å‰åæŸ¥è¯¢ç»“æœä¸åŒï¼Œè¿™å°±è¯´æ˜å‘ç”Ÿäº†<strong>å¹»è¯»</strong></p>\n<p>åˆæ˜¯ğŸŒ°ï¼šäº‹åŠ¡AæŸ¥è¯¢å®Œä½™é¢å¤§äº<code>100w</code>çš„è®°å½•æ•°é‡ä¸º5æ¡åï¼Œäº‹åŠ¡Aæ‰“ç®—æ­‡ä¸€ä¼šğŸ˜´ã€‚åœ¨äº‹åŠ¡Aæ­‡æ¯çš„è¿‡ç¨‹ä¸­ï¼Œäº‹åŠ¡Bæ‚„æ‚„çš„æ’å…¥äº†ä¸€æ¡ä½™é¢å¤§äº<code>100w</code>çš„è®°å½•ï¼Œå¯¼è‡´ç°åœ¨å…±æœ‰6æ¡è®°å½•ç¬¦åˆæŸ¥è¯¢æ¡ä»¶ã€‚å½“äº‹åŠ¡Aé†’æ¥å†æ¬¡è¿›è¡ŒæŸ¥è¯¢æ—¶ï¼Œå°±ä¼šæƒŠè®¶åœ°å‘ç°å¤šäº†ä¸€æ¡è®°å½•ï¼Œ<del>é‚£ä¹ˆå®ƒè‚¯å®šä¼šè®¤ä¸ºæ˜¯è‡ªå·±ç¡è§‰ç¡å‡ºå¹»è§‰äº†ğŸ¤ªï¼Œ</del>è¿™ç§ç°è±¡å°±æ˜¯<strong>å¹»è¯»</strong></p>\n<p><img src=\"https://raw.githubusercontent.com/lyydsheep/pic/main/202409212057315.png\" alt=\"image-20240921205706281\"></p>\n<h3 id=\"æœ‰å“ªäº›äº‹åŠ¡çš„éš”ç¦»çº§åˆ«ï¼Ÿ\"><a href=\"#æœ‰å“ªäº›äº‹åŠ¡çš„éš”ç¦»çº§åˆ«ï¼Ÿ\" class=\"headerlink\" title=\"æœ‰å“ªäº›äº‹åŠ¡çš„éš”ç¦»çº§åˆ«ï¼Ÿ\"></a>æœ‰å“ªäº›äº‹åŠ¡çš„éš”ç¦»çº§åˆ«ï¼Ÿ</h3><p>ç”±å‰æ–‡å¯çŸ¥ï¼Œå¤šä¸ªäº‹åŠ¡å¹¶è¡Œå¤„ç†æ—¶å¯ä»¥ä¼šå‡ºç°<strong>è„è¯»ã€ä¸å¯é‡å¤è¯»ã€å¹»è¯»</strong>ç°è±¡ï¼Œè¿™ä¸‰ç§ç°è±¡æŒ‰ä¸¥é‡æ€§æ’åºå¦‚ä¸‹ï¼š</p>\n<p><strong><code>è„è¯» &gt; ä¸å¯é‡å¤è¯» &gt; å¹»è¯»</code></strong></p>\n<p>é’ˆå¯¹ä¸Šè¿°ä¸‰ç§ç°è±¡å‡ºç°ä¸å¦ï¼ŒSQLæ ‡å‡†æå‡ºäº†å››ç§äº‹åŠ¡éš”ç¦»çº§åˆ«ï¼Œäº‹åŠ¡éš”ç¦»çº§åˆ«è¶Šé«˜ï¼Œæ€§èƒ½è¶Šå·®ğŸ™ƒï¼ŒæŒ‰ç…§éš”ç¦»çº§åˆ«ä»ä½åˆ°é«˜ä¸€æ¬¡æ˜¯ï¼š</p>\n<ul>\n<li><strong>è¯»æœªæäº¤</strong>ï¼šæŒ‡ä¸€ä¸ªäº‹åŠ¡è¿˜æœªæäº¤ï¼Œå®ƒæ‰€åšçš„æ•°æ®å˜æ›´å°±èƒ½è¢«å…¶ä»–äº‹åŠ¡çœ‹åˆ°<ul>\n<li>å¯èƒ½å‘ç”Ÿè„è¯»ã€ä¸å¯é‡å¤è¯»ã€å¹»è¯»</li>\n</ul>\n</li>\n<li><strong>è¯»æäº¤</strong>ï¼šæŒ‡ä¸€ä¸ªäº‹åŠ¡åªæœ‰åœ¨æäº¤åï¼Œå®ƒæ‰€åšçš„æ•°æ®å˜æ›´æ‰èƒ½è¢«å…¶ä»–äº‹åŠ¡çœ‹åˆ°<ul>\n<li>å¯èƒ½å‘ç”Ÿä¸å¯é‡å¤è¯»ã€å¹»è¯»</li>\n</ul>\n</li>\n<li><strong>å¯é‡å¤è¯»</strong>ï¼šæŒ‡ä¸€ä¸ªäº‹åŠ¡æ‰§è¡Œè¿‡ç¨‹ä¸­æ‰€çœ‹åˆ°çš„æ•°æ®åœ¨äº‹åŠ¡å¼€å§‹æ—¶å°±è¢«ç¡®å®šï¼ˆç±»ä¼¼äºå¿«ç…§ğŸ“·ï¼‰ï¼Œæ˜¯InnoDBå¼•æ“çš„é»˜è®¤äº‹åŠ¡éš”ç¦»çº§åˆ«<ul>\n<li>å¯èƒ½å‘ç”Ÿå¹»è¯»</li>\n</ul>\n</li>\n<li><strong>ä¸²è¡ŒåŒ–</strong>ï¼šä¼šå¯¹è®°å½•åŠ ä¸Šè¯»å†™é”ï¼Œå½“å¤šä¸ªäº‹åŠ¡å‘ç”Ÿè¯»å†™å†²çªæ—¶ï¼Œåè®¿é—®æ•°æ®çš„äº‹åŠ¡å¿…é¡»ç­‰å¾…å‰ä¸€ä¸ªäº‹åŠ¡å®Œæˆæ‰èƒ½ç»§ç»­æ‰§è¡Œ<ul>\n<li>æœ¨æœ‰é—®é¢˜ï¼Œä½†æ˜¯æ€§èƒ½å¾ˆå·®ğŸ¤ª</li>\n</ul>\n</li>\n</ul>\n<p>âš ï¸ï¼š<strong>MySQLçš„InnoDBå¼•æ“çš„é»˜è®¤äº‹åŠ¡éš”ç¦»çº§åˆ«æ˜¯ã€Œå¯é‡å¤è¯»ã€ï¼Œä½†å®ƒå¾ˆå¤§ç¨‹åº¦ä¸Šé¿å…äº†å¹»è¯»ç°è±¡</strong>ï¼Œè§£å†³æ–¹æ¡ˆæœ‰ä¸¤ç§ï¼š</p>\n<ul>\n<li>é’ˆå¯¹<strong>å¿«ç…§è¯»</strong>ï¼ˆæ™®é€šselectè¯­å¥ï¼‰ï¼Œé€šè¿‡<strong>MVCCæ–¹å¼è§£å†³å¹»è¯»</strong>ã€‚å› ä¸ºäº‹åŠ¡æ‰§è¡Œè¿‡ç¨‹ä¸­çš„æ•°æ®åœ¨äº‹åŠ¡å¼€å§‹æ—¶å°±å·²ç»ç¡®å®šäº†ï¼Œå³ä½¿åœ¨Aäº‹åŠ¡æ‰§è¡Œä¸­ç¨‹Bäº‹åŠ¡æ’å…¥äº†ä¸€æ¡æ•°æ®ï¼Œè¿™ä¹Ÿå¯¹Aäº‹åŠ¡æ˜¯ä¸å¯è§çš„ã€é€æ˜çš„ï¼Œæ‰€ä»¥å°±å¾ˆå¥½çš„é¿å…äº†å¹»è¯»ç°è±¡</li>\n<li>é’ˆå¯¹<strong>å½“å‰è¯»</strong>ï¼ˆselect â€¦ for updateè¯­å¥ï¼‰ï¼Œé€šè¿‡<strong>next-key lockï¼ˆè®°å½•é”+é—´éš™é”ï¼‰æ–¹å¼è§£å†³äº†å¹»è¯»</strong>ã€‚å› ä¸ºå½“Aäº‹åŠ¡æ‰§è¡Œ<code>select ... for update</code>è¯­å¥æ—¶ï¼Œä¼šåŠ ä¸Š<code>next-key lock</code>ï¼Œè‹¥äº‹åŠ¡Båœ¨é”çš„èŒƒå›´å†…æ’å…¥äº†ä¸€æ¡æ•°æ®ï¼Œé‚£ä¹ˆäº‹åŠ¡Bçš„æ’å…¥è¯­å¥ä¼šè¢«é˜»å¡ï¼Œæ— æ³•æ’å…¥æˆåŠŸï¼Œæ‰€ä»¥å°±å¾ˆå¥½åœ°è§£å†³äº†å¹»è¯»é—®é¢˜</li>\n</ul>\n<h4 id=\"å››ç§éš”ç¦»çº§åˆ«çš„å®ç°æ–¹å¼\"><a href=\"#å››ç§éš”ç¦»çº§åˆ«çš„å®ç°æ–¹å¼\" class=\"headerlink\" title=\"å››ç§éš”ç¦»çº§åˆ«çš„å®ç°æ–¹å¼\"></a>å››ç§éš”ç¦»çº§åˆ«çš„å®ç°æ–¹å¼</h4><ul>\n<li><strong>è¯»æœªæäº¤</strong><ul>\n<li>ç›´æ¥è¯»å°±å¥½äº†</li>\n</ul>\n</li>\n<li><strong>ä¸²è¡ŒåŒ–</strong><ul>\n<li>åŠ è¯»å†™é”é¿å…å¹¶è¡Œè®¿é—®</li>\n</ul>\n</li>\n<li><strong>è¯»æäº¤</strong>å’Œ<strong>å¯é‡å¤è¯»</strong>éƒ½æ˜¯é€šè¿‡<strong>Read View</strong>æ¥å®ç°çš„ï¼ŒåŒºåˆ«åœ¨äºåˆ›å»ºRead Viewçš„æ—¶æœº<ul>\n<li>è¯»æäº¤åœ¨<strong>æ¯ä¸€ä¸ªè¯­å¥æ‰§è¡Œä¹‹å‰</strong>éƒ½ä¼šç”Ÿæˆä¸€ä¸ªRead View</li>\n<li>å¯é‡å¤è¯»åªåœ¨å¯åŠ¨äº‹åŠ¡æ—¶ç”Ÿæˆä¸€ä¸ªRead Viewï¼Œç„¶åæ•´ä¸ªäº‹åŠ¡æ‰§è¡Œè¿‡ç¨‹ä¸­éƒ½ç”¨è¿™ä¸€ä¸ªRead View</li>\n</ul>\n</li>\n</ul>\n<p>ğŸŒŸåŒºåˆ†ã€Œå¼€å¯äº‹åŠ¡ã€å’Œã€Œå¯åŠ¨äº‹åŠ¡ã€</p>\n<p>åœ¨MySQLä¸­æœ‰ä¸¤ç§æ–¹å¼<strong>å¼€å¯äº‹åŠ¡</strong></p>\n<figure class=\"highlight sql\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"># ç¬¬ä¸€ç§</span><br><span class=\"line\"><span class=\"keyword\">begin</span><span class=\"operator\">/</span><span class=\"keyword\">start</span> transaction</span><br><span class=\"line\"></span><br><span class=\"line\"># ç¬¬äºŒç§</span><br><span class=\"line\"><span class=\"keyword\">start</span> transaction <span class=\"keyword\">with</span> consistent snapshot</span><br></pre></td></tr></table></figure>\n\n<p>ä»¥ç¬¬ä¸€ç§æ–¹å¼å¼€å¯äº‹åŠ¡ä¸ä»£è¡¨å¯åŠ¨äº†ä¸€ä¸ªäº‹åŠ¡ï¼Œåªæœ‰æ‰§è¡Œäº†ç¬¬ä¸€æ¡selectè¯­å¥ï¼Œæ‰æ˜¯çœŸæ­£å¯åŠ¨äº‹åŠ¡</p>\n<p>ç¬¬äºŒç§æ–¹å¼åœ¨å¼€å¯äº‹åŠ¡çš„åŒæ—¶ä¹Ÿå¯åŠ¨äº†äº‹åŠ¡ï¼ˆæ¯•ç«Ÿå‘½ä»¤ä¸­éƒ½å¸¦æœ‰<code>snapshot</code>ğŸ˜‚ï¼‰</p>\n<h3 id=\"Read-Viewåœ¨MVCCæ˜¯å¦‚ä½•å·¥ä½œçš„ï¼Ÿ\"><a href=\"#Read-Viewåœ¨MVCCæ˜¯å¦‚ä½•å·¥ä½œçš„ï¼Ÿ\" class=\"headerlink\" title=\"Read Viewåœ¨MVCCæ˜¯å¦‚ä½•å·¥ä½œçš„ï¼Ÿ\"></a>Read Viewåœ¨MVCCæ˜¯å¦‚ä½•å·¥ä½œçš„ï¼Ÿ</h3><blockquote>\n<p>ä¸¤ä¸ªå‰ç½®çŸ¥è¯†</p>\n<ul>\n<li><p>Read Viewä¸­å››ä¸ªå­—æ®µä½œç”¨</p>\n</li>\n<li><p>èšç°‡ç´¢å¼•è®°å½•ä¸­ä¸¤ä¸ªè·Ÿäº‹åŠ¡æœ‰å…³çš„ä¸¤ä¸ªéšè—å­—æ®µ</p>\n</li>\n</ul>\n</blockquote>\n<p>Read Viewå®è´¨æ˜¯ç”±<strong>å››ä¸ªå­—æ®µ</strong>æ„æˆçš„</p>\n<p><img src=\"https://raw.githubusercontent.com/lyydsheep/pic/main/202409231525562.png\" alt=\"image-20240923152532491\"></p>\n<ul>\n<li><strong>m_ids</strong>ï¼šæŒ‡åœ¨åˆ›å»ºRead Viewæ—¶ï¼Œå½“å‰æ•°æ®åº“ä¸­ã€Œæ´»è·ƒäº‹åŠ¡ã€çš„äº‹åŠ¡idï¼Œå¯èƒ½æœ‰å¤šä¸ª<ul>\n<li><strong>æ´»è·ƒäº‹åŠ¡</strong>å³<strong>å¯åŠ¨</strong>äº†ä½†æ˜¯è¿˜æ²¡æœ‰æäº¤çš„äº‹åŠ¡</li>\n</ul>\n</li>\n<li><strong>min_trx_id</strong>ï¼šæ´»è·ƒäº‹åŠ¡ä¸­æœ€å°çš„äº‹åŠ¡id</li>\n<li><strong>max_trx_id</strong>ï¼š<strong>æ•°æ®åº“ä¸‹ä¸€ä¸ªå°†åˆ†é…ç»™äº‹åŠ¡çš„id</strong>ï¼Œå³å…¨å±€äº‹åŠ¡idçš„æœ€å¤§å€¼+1</li>\n<li><strong>creator_trx_id</strong>ï¼šåˆ›å»ºå½“å‰Read Viewçš„äº‹åŠ¡id</li>\n</ul>\n<p>äº†è§£å®ŒRead Viewä¸­çš„å››ä¸ªå­—æ®µåï¼Œå†çœ‹çœ‹èšç°‡ç´¢å¼•è®°å½•ä¸­çš„<strong>ä¸¤ä¸ªéšè—å­—æ®µ</strong>ï¼ŒğŸŒ°ï¼š</p>\n<p><img src=\"https://raw.githubusercontent.com/lyydsheep/pic/main/202409231532645.png\" alt=\"image-20240923153259596\"></p>\n<ul>\n<li><strong>trx_id</strong>ï¼šå½“ä¸€ä¸ªäº‹åŠ¡å¯¹æŸæ¡èšç°‡ç´¢å¼•çš„æ•°æ®è¿›è¡Œæ”¹åŠ¨æ—¶ï¼Œå°±æŠŠè¯¥äº‹åŠ¡çš„idæ”¾å…¥trx_idå­—æ®µä¸­</li>\n<li><strong>roll_pointer</strong>ï¼šå½“å¯¹æŸæ¡èšç°‡ç´¢å¼•è®°å½•è¿›è¡Œä¿®æ”¹æ—¶ï¼Œéƒ½ä¼šæŠŠæ—§ç‰ˆæœ¬çš„æ•°æ®è®°å½•åœ¨<strong>undoæ—¥å¿—</strong>ä¸­ï¼Œroll_pointerå°±æŒ‡å‘æ¯ä¸€ä¸ªæ—§ç‰ˆæœ¬çš„æ•°æ®ï¼Œå› æ­¤å¯ä»¥é€šè¿‡roll_pointeréšè—åˆ—æ‰¾åˆ°å†å²è®°å½•</li>\n</ul>\n<h4 id=\"MVCC\"><a href=\"#MVCC\" class=\"headerlink\" title=\"MVCC\"></a>MVCC</h4><p>åœ¨äº†è§£Read Viewå››ä¸ªå­—æ®µä»¥åŠèšç°‡ç´¢å¼•è®°å½•çš„ä¸¤ä¸ªéšè—åˆ—åï¼Œæ¥ä¸‹æ¥å°±å¯ä»¥å¼„æ¸…æ¥šMVCCæ˜¯å¦‚ä½•æ§åˆ¶æ•°æ®å¿«ç…§çš„</p>\n<p>å‡è®¾ç°åœ¨æœ‰ä¸€ä¸ªã€Œæ´»è·ƒäº‹åŠ¡ã€äº‹åŠ¡Aï¼Œé‚£ä¹ˆå¯ä»¥æ ¹æ®äº‹åŠ¡Açš„Read Viewåˆ›å»ºæ—¶åˆ»å°†å…¶ä»–äº‹åŠ¡åˆ’åˆ†ä¸ºå››ç±»ï¼š</p>\n<ul>\n<li>äº‹åŠ¡idå°äº<code>min_trx_id</code></li>\n<li>äº‹åŠ¡idå¤§äºç­‰äº<code>max_trx_id</code></li>\n<li>äº‹åŠ¡idåœ¨<code>min_trx_id</code>å’Œ<code>max_trx_id</code>ä¹‹é—´ä¸”ä½äº<code>m_ids</code>ä¸­</li>\n<li>äº‹åŠ¡idåœ¨<code>min_trx_id</code>å’Œ<code>max_trx_id</code>ä¹‹é—´ä¸”ä¸ä½äº<code>m_ids</code>ä¸­</li>\n</ul>\n<p><img src=\"https://raw.githubusercontent.com/lyydsheep/pic/main/202409231542692.png\" alt=\"image-20240923154216650\"></p>\n<ul>\n<li>å¦‚æœè®°å½•çš„éšè—åˆ—<code>trx_id</code>å€¼å°äº<code>min_trx_id</code>ï¼Œé‚£ä¹ˆè¿™ä¸ªç‰ˆæœ¬çš„è®°å½•æ˜¯åœ¨Read Viewåˆ›å»ºä¹‹å‰å®Œæˆçš„ï¼Œæ‰€ä»¥è¯¥ç‰ˆæœ¬è®°å½•æ˜¯å¯¹å½“å‰äº‹åŠ¡<strong>å¯è§çš„</strong></li>\n<li>å¦‚æœ<code>trx_id</code>å€¼å¤§äºç­‰äº<code>max_trx_id</code>ï¼Œè¯´æ˜è¿™ä¸ªç‰ˆæœ¬çš„è®°å½•æ˜¯åœ¨Read Viewåˆ›å»ºä¹‹åç”Ÿæˆçš„ï¼Œæ•…å¯¹äºå½“å‰äº‹åŠ¡æ˜¯<strong>ä¸å¯è§çš„</strong></li>\n<li>å¦‚æœ<code>trx_id</code>å€¼åœ¨<code>min_trx_id</code>å’Œ<code>max_trx_id</code>ä¹‹é—´ï¼Œåˆ™éœ€è¦è¿›ä¸€æ­¥åˆ¤æ–­è®°å½•çš„<code>trx_id</code>æ˜¯å¦åœ¨<code>m_ids</code>åˆ—è¡¨ä¸­ï¼ˆå³å¯¹äºçš„äº‹åŠ¡æ˜¯å¦æ˜¯æ´»è·ƒäº‹åŠ¡ï¼‰<ul>\n<li>æ˜¯æ´»è·ƒäº‹åŠ¡ï¼Œé‚£ä¹ˆè¯¥è¯¥ç‰ˆæœ¬çš„è®°å½•å¯¹å½“å‰äº‹åŠ¡<strong>ä¸å¯è§</strong></li>\n<li>ä¸æ˜¯æ´»è·ƒäº‹åŠ¡ï¼Œé‚£ä¹ˆè¯¥ç‰ˆæœ¬çš„è®°å½•æ˜¯<strong>å¯è§çš„</strong></li>\n<li>ğŸŒ°ï¼šåˆ›å»ºäº†1ã€2ã€3ã€4è¿™å››ä¸ªäº‹åŠ¡ï¼Œå…¶ä¸­äº‹åŠ¡3ä»¥è¿…é›·ä¸åŠæ©è€³ä¹‹åŠ¿æäº¤äº†ï¼Œé‚£ä¹ˆéšåå¯åŠ¨çš„äº‹åŠ¡5æ˜¯å¯ä»¥çœ‹è§äº‹åŠ¡3æ‰€ä¿®æ”¹çš„è®°å½•ç‰ˆæœ¬çš„</li>\n</ul>\n</li>\n</ul>\n<p><strong>è¿™ç§é€šè¿‡ã€Œç‰ˆæœ¬é“¾ã€æ¥æ§åˆ¶å¹¶å‘äº‹åŠ¡ä¸å†²çªåœ°è®¿é—®åŒä¸€æ¡è®°å½•çš„æ“ä½œå°±å«MVCCï¼ˆå¤šç‰ˆæœ¬å¹¶å‘æ§åˆ¶ï¼‰</strong></p>\n","excerpt":"","more":"<h1 id=\"MySQLäº‹åŠ¡å­¦ä¹ \"><a href=\"#MySQLäº‹åŠ¡å­¦ä¹ \" class=\"headerlink\" title=\"MySQLäº‹åŠ¡å­¦ä¹ \"></a>MySQLäº‹åŠ¡å­¦ä¹ </h1><h2 id=\"äº‹åŠ¡ACID\"><a href=\"#äº‹åŠ¡ACID\" class=\"headerlink\" title=\"äº‹åŠ¡ACID\"></a>äº‹åŠ¡ACID</h2><p>aba</p>\n<h2 id=\"äº‹åŠ¡éš”ç¦»çº§åˆ«\"><a href=\"#äº‹åŠ¡éš”ç¦»çº§åˆ«\" class=\"headerlink\" title=\"äº‹åŠ¡éš”ç¦»çº§åˆ«\"></a>äº‹åŠ¡éš”ç¦»çº§åˆ«</h2><p><a href=\"https://xiaolincoding.com/mysql/transaction/mvcc.html\">å‚è€ƒæ–‡ç« </a></p>\n<blockquote>\n<p>äº‹åŠ¡å¹¶å‘ä¼š äº§ç”Ÿä»€ä¹ˆé—®é¢˜ï¼Ÿ</p>\n<p>äº‹åŠ¡éš”ç¦»çº§åˆ«æœ‰å“ªäº›ï¼Ÿæ€ä¹ˆå®ç°çš„ï¼Ÿ</p>\n<p>è¯»å·²æäº¤å’Œå¯é‡å¤åº¦æœ‰ä»€ä¹ˆåŒºåˆ«ï¼Ÿ</p>\n<p>MVCCæ˜¯ä»€ä¹ˆï¼Ÿè§£å†³äº†ä»€ä¹ˆé—®é¢˜ï¼Ÿå®ç°åŸç†æ˜¯ä»€ä¹ˆï¼Ÿ</p>\n<p>å¯é‡å¤è¯»éš”ç¦»çº§åˆ«å½»åº•è§£å†³å¹»è¯»äº†å—ï¼Ÿ</p>\n</blockquote>\n<p>äº‹åŠ¡çš„å››ä¸ªç‰¹æ€§ï¼Œä»¥åŠInnoDBå¼•æ“çš„å®ç°æ–¹å¼ï¼š</p>\n<ul>\n<li>åŸå­æ€§<ul>\n<li>é€šè¿‡undo logï¼ˆå›æ»šæ—¥å¿—ï¼‰æ¥ä¿è¯</li>\n</ul>\n</li>\n<li>ä¸€è‡´æ€§<ul>\n<li>é€šè¿‡<strong>æŒä¹…æ€§+åŸå­æ€§+éš”ç¦»æ€§</strong>æ¥ä¿è¯</li>\n</ul>\n</li>\n<li>æŒä¹…æ€§<ul>\n<li>é€šè¿‡redo logï¼ˆé‡åšæ—¥å¿—ï¼‰æ¥ä¿è¯</li>\n</ul>\n</li>\n<li>éš”ç¦»æ€§<ul>\n<li>é€šè¿‡MVCCï¼ˆå¤šç‰ˆæœ¬å¹¶å‘æ§åˆ¶ï¼‰æˆ–é”æœºåˆ¶æ¥ä¿è¯</li>\n</ul>\n</li>\n</ul>\n<h3 id=\"å¹¶è¡Œçš„äº‹åŠ¡ä¼šæœ‰ä»€ä¹ˆé—®é¢˜ï¼Ÿ\"><a href=\"#å¹¶è¡Œçš„äº‹åŠ¡ä¼šæœ‰ä»€ä¹ˆé—®é¢˜ï¼Ÿ\" class=\"headerlink\" title=\"å¹¶è¡Œçš„äº‹åŠ¡ä¼šæœ‰ä»€ä¹ˆé—®é¢˜ï¼Ÿ\"></a>å¹¶è¡Œçš„äº‹åŠ¡ä¼šæœ‰ä»€ä¹ˆé—®é¢˜ï¼Ÿ</h3><p>MySQLåœ¨åŒæ—¶å¤„ç†å¤šä¸ªäº‹åŠ¡æ—¶ï¼Œå¯èƒ½ä¼šå‡ºç°<font color=\"blue\"><strong>è„è¯»ã€ä¸å¯é‡å¤è¯»ã€å¹»è¯»</strong></font>çš„é—®é¢˜</p>\n<h4 id=\"è„è¯»\"><a href=\"#è„è¯»\" class=\"headerlink\" title=\"è„è¯»\"></a>è„è¯»</h4><p>ä¸€ä¸ªäº‹åŠ¡è¯»å–åˆ°äº†å¦ä¸€ä¸ª<strong>æœªæäº¤çš„äº‹åŠ¡æ‰€ä¿®æ”¹çš„æ•°æ®</strong>ï¼Œå°±æ„å‘³ç€å‘ç”Ÿäº†è„è¯»</p>\n<p>ğŸŒ°ï¼šäº‹åŠ¡Aè¯»å–å¹¶ä¿®æ”¹è´¦æˆ·ä½™é¢ä¸º<code>200w</code>ï¼Œä½†æ²¡æœ‰ç«‹åˆ»æäº¤äº‹åŠ¡ã€‚åœ¨è¿™ä¸€æœŸé—´ï¼Œäº‹åŠ¡Bè¯»å–åˆ°è´¦æˆ·ä½™é¢ä¸º<code>200w</code>ï¼Œä½†æ˜¯å‘¢ï¼Œç”±äºäº‹åŠ¡Aè¿˜æœªæ­£å¼æäº¤ï¼Œä»æœ‰å¯èƒ½å‘ç”Ÿå›æ»šæ“ä½œï¼Œå¦‚æœäº‹åŠ¡Aå‘ç”Ÿäº†å›æ»šï¼Œé‚£ä¹ˆäº‹åŠ¡Bè¯»åˆ°çš„æ•°æ®å°±æ˜¯ä¸€ä¸ªæ²¡ç”¨çš„ã€è¿‡æœŸçš„æ•°æ®ï¼Œè¿™ç§ç°è±¡å°±æ˜¯<strong>è„è¯»</strong></p>\n<p><img src=\"https://raw.githubusercontent.com/lyydsheep/pic/main/202409212036399.png\" alt=\"image-20240921203626317\"></p>\n<h4 id=\"ä¸å¯é‡å¤è¯»\"><a href=\"#ä¸å¯é‡å¤è¯»\" class=\"headerlink\" title=\"ä¸å¯é‡å¤è¯»\"></a>ä¸å¯é‡å¤è¯»</h4><p>åœ¨ä¸€ä¸ªäº‹åŠ¡å†…å¤šæ¬¡è¯»å–åŒä¸€ä¸ªæ•°æ®ï¼Œå¦‚æœå‰åä¸¤æ¬¡è¯»å–ç»“æœä¸åŒï¼Œå°±æ„å‘³ç€å‘ç”Ÿäº†<strong>ä¸å¯é‡å¤è¯»</strong></p>\n<p>ğŸŒ°ï¼šäº‹åŠ¡Aæœ‰ä¸¤æ¬¡è¯»å–ä½™é¢æ“ä½œï¼Œå¥½å·§ä¸å·§ğŸ¤ªåœ¨è¿™ä¸¤æ¬¡è¯»å–æ“ä½œä¹‹é—´ï¼Œäº‹åŠ¡Bå¿«é€Ÿçš„ä¿®æ”¹äº†ä½™é¢å¹¶è¿›è¡Œäº†æäº¤ã€‚ç»“æœå°±æ˜¯ï¼Œäº‹åŠ¡Aç¬¬ä¸€æ¬¡è¯»å–åˆ°çš„æ˜¯åŸå§‹æ•°æ®ï¼Œè€Œç¬¬äºŒæ¬¡è¯»å–åˆ°çš„å´æ˜¯äº‹åŠ¡Bä¿®æ”¹è¿‡åçš„æ•°æ®ï¼Œä¸¤æ¬¡æ•°æ®ä¸ä¸€è‡´ï¼è¿™ç§ç°è±¡å°±æ˜¯ä¸å¯é‡å¤è¯»</p>\n<p><img src=\"https://raw.githubusercontent.com/lyydsheep/pic/main/202409212052763.png\" alt=\"image-20240921205212723\"></p>\n<h4 id=\"å¹»è¯»\"><a href=\"#å¹»è¯»\" class=\"headerlink\" title=\"å¹»è¯»\"></a>å¹»è¯»</h4><p>åœ¨ä¸€ä¸ªäº‹åŠ¡å†…å¤šæ¬¡æŸ¥è¯¢ç¬¦åˆæ¡ä»¶çš„<strong>è®°å½•æ•°é‡</strong>ï¼Œå¦‚æœå‡ºç°å‰åæŸ¥è¯¢ç»“æœä¸åŒï¼Œè¿™å°±è¯´æ˜å‘ç”Ÿäº†<strong>å¹»è¯»</strong></p>\n<p>åˆæ˜¯ğŸŒ°ï¼šäº‹åŠ¡AæŸ¥è¯¢å®Œä½™é¢å¤§äº<code>100w</code>çš„è®°å½•æ•°é‡ä¸º5æ¡åï¼Œäº‹åŠ¡Aæ‰“ç®—æ­‡ä¸€ä¼šğŸ˜´ã€‚åœ¨äº‹åŠ¡Aæ­‡æ¯çš„è¿‡ç¨‹ä¸­ï¼Œäº‹åŠ¡Bæ‚„æ‚„çš„æ’å…¥äº†ä¸€æ¡ä½™é¢å¤§äº<code>100w</code>çš„è®°å½•ï¼Œå¯¼è‡´ç°åœ¨å…±æœ‰6æ¡è®°å½•ç¬¦åˆæŸ¥è¯¢æ¡ä»¶ã€‚å½“äº‹åŠ¡Aé†’æ¥å†æ¬¡è¿›è¡ŒæŸ¥è¯¢æ—¶ï¼Œå°±ä¼šæƒŠè®¶åœ°å‘ç°å¤šäº†ä¸€æ¡è®°å½•ï¼Œ<del>é‚£ä¹ˆå®ƒè‚¯å®šä¼šè®¤ä¸ºæ˜¯è‡ªå·±ç¡è§‰ç¡å‡ºå¹»è§‰äº†ğŸ¤ªï¼Œ</del>è¿™ç§ç°è±¡å°±æ˜¯<strong>å¹»è¯»</strong></p>\n<p><img src=\"https://raw.githubusercontent.com/lyydsheep/pic/main/202409212057315.png\" alt=\"image-20240921205706281\"></p>\n<h3 id=\"æœ‰å“ªäº›äº‹åŠ¡çš„éš”ç¦»çº§åˆ«ï¼Ÿ\"><a href=\"#æœ‰å“ªäº›äº‹åŠ¡çš„éš”ç¦»çº§åˆ«ï¼Ÿ\" class=\"headerlink\" title=\"æœ‰å“ªäº›äº‹åŠ¡çš„éš”ç¦»çº§åˆ«ï¼Ÿ\"></a>æœ‰å“ªäº›äº‹åŠ¡çš„éš”ç¦»çº§åˆ«ï¼Ÿ</h3><p>ç”±å‰æ–‡å¯çŸ¥ï¼Œå¤šä¸ªäº‹åŠ¡å¹¶è¡Œå¤„ç†æ—¶å¯ä»¥ä¼šå‡ºç°<strong>è„è¯»ã€ä¸å¯é‡å¤è¯»ã€å¹»è¯»</strong>ç°è±¡ï¼Œè¿™ä¸‰ç§ç°è±¡æŒ‰ä¸¥é‡æ€§æ’åºå¦‚ä¸‹ï¼š</p>\n<p><strong><code>è„è¯» &gt; ä¸å¯é‡å¤è¯» &gt; å¹»è¯»</code></strong></p>\n<p>é’ˆå¯¹ä¸Šè¿°ä¸‰ç§ç°è±¡å‡ºç°ä¸å¦ï¼ŒSQLæ ‡å‡†æå‡ºäº†å››ç§äº‹åŠ¡éš”ç¦»çº§åˆ«ï¼Œäº‹åŠ¡éš”ç¦»çº§åˆ«è¶Šé«˜ï¼Œæ€§èƒ½è¶Šå·®ğŸ™ƒï¼ŒæŒ‰ç…§éš”ç¦»çº§åˆ«ä»ä½åˆ°é«˜ä¸€æ¬¡æ˜¯ï¼š</p>\n<ul>\n<li><strong>è¯»æœªæäº¤</strong>ï¼šæŒ‡ä¸€ä¸ªäº‹åŠ¡è¿˜æœªæäº¤ï¼Œå®ƒæ‰€åšçš„æ•°æ®å˜æ›´å°±èƒ½è¢«å…¶ä»–äº‹åŠ¡çœ‹åˆ°<ul>\n<li>å¯èƒ½å‘ç”Ÿè„è¯»ã€ä¸å¯é‡å¤è¯»ã€å¹»è¯»</li>\n</ul>\n</li>\n<li><strong>è¯»æäº¤</strong>ï¼šæŒ‡ä¸€ä¸ªäº‹åŠ¡åªæœ‰åœ¨æäº¤åï¼Œå®ƒæ‰€åšçš„æ•°æ®å˜æ›´æ‰èƒ½è¢«å…¶ä»–äº‹åŠ¡çœ‹åˆ°<ul>\n<li>å¯èƒ½å‘ç”Ÿä¸å¯é‡å¤è¯»ã€å¹»è¯»</li>\n</ul>\n</li>\n<li><strong>å¯é‡å¤è¯»</strong>ï¼šæŒ‡ä¸€ä¸ªäº‹åŠ¡æ‰§è¡Œè¿‡ç¨‹ä¸­æ‰€çœ‹åˆ°çš„æ•°æ®åœ¨äº‹åŠ¡å¼€å§‹æ—¶å°±è¢«ç¡®å®šï¼ˆç±»ä¼¼äºå¿«ç…§ğŸ“·ï¼‰ï¼Œæ˜¯InnoDBå¼•æ“çš„é»˜è®¤äº‹åŠ¡éš”ç¦»çº§åˆ«<ul>\n<li>å¯èƒ½å‘ç”Ÿå¹»è¯»</li>\n</ul>\n</li>\n<li><strong>ä¸²è¡ŒåŒ–</strong>ï¼šä¼šå¯¹è®°å½•åŠ ä¸Šè¯»å†™é”ï¼Œå½“å¤šä¸ªäº‹åŠ¡å‘ç”Ÿè¯»å†™å†²çªæ—¶ï¼Œåè®¿é—®æ•°æ®çš„äº‹åŠ¡å¿…é¡»ç­‰å¾…å‰ä¸€ä¸ªäº‹åŠ¡å®Œæˆæ‰èƒ½ç»§ç»­æ‰§è¡Œ<ul>\n<li>æœ¨æœ‰é—®é¢˜ï¼Œä½†æ˜¯æ€§èƒ½å¾ˆå·®ğŸ¤ª</li>\n</ul>\n</li>\n</ul>\n<p>âš ï¸ï¼š<strong>MySQLçš„InnoDBå¼•æ“çš„é»˜è®¤äº‹åŠ¡éš”ç¦»çº§åˆ«æ˜¯ã€Œå¯é‡å¤è¯»ã€ï¼Œä½†å®ƒå¾ˆå¤§ç¨‹åº¦ä¸Šé¿å…äº†å¹»è¯»ç°è±¡</strong>ï¼Œè§£å†³æ–¹æ¡ˆæœ‰ä¸¤ç§ï¼š</p>\n<ul>\n<li>é’ˆå¯¹<strong>å¿«ç…§è¯»</strong>ï¼ˆæ™®é€šselectè¯­å¥ï¼‰ï¼Œé€šè¿‡<strong>MVCCæ–¹å¼è§£å†³å¹»è¯»</strong>ã€‚å› ä¸ºäº‹åŠ¡æ‰§è¡Œè¿‡ç¨‹ä¸­çš„æ•°æ®åœ¨äº‹åŠ¡å¼€å§‹æ—¶å°±å·²ç»ç¡®å®šäº†ï¼Œå³ä½¿åœ¨Aäº‹åŠ¡æ‰§è¡Œä¸­ç¨‹Bäº‹åŠ¡æ’å…¥äº†ä¸€æ¡æ•°æ®ï¼Œè¿™ä¹Ÿå¯¹Aäº‹åŠ¡æ˜¯ä¸å¯è§çš„ã€é€æ˜çš„ï¼Œæ‰€ä»¥å°±å¾ˆå¥½çš„é¿å…äº†å¹»è¯»ç°è±¡</li>\n<li>é’ˆå¯¹<strong>å½“å‰è¯»</strong>ï¼ˆselect â€¦ for updateè¯­å¥ï¼‰ï¼Œé€šè¿‡<strong>next-key lockï¼ˆè®°å½•é”+é—´éš™é”ï¼‰æ–¹å¼è§£å†³äº†å¹»è¯»</strong>ã€‚å› ä¸ºå½“Aäº‹åŠ¡æ‰§è¡Œ<code>select ... for update</code>è¯­å¥æ—¶ï¼Œä¼šåŠ ä¸Š<code>next-key lock</code>ï¼Œè‹¥äº‹åŠ¡Båœ¨é”çš„èŒƒå›´å†…æ’å…¥äº†ä¸€æ¡æ•°æ®ï¼Œé‚£ä¹ˆäº‹åŠ¡Bçš„æ’å…¥è¯­å¥ä¼šè¢«é˜»å¡ï¼Œæ— æ³•æ’å…¥æˆåŠŸï¼Œæ‰€ä»¥å°±å¾ˆå¥½åœ°è§£å†³äº†å¹»è¯»é—®é¢˜</li>\n</ul>\n<h4 id=\"å››ç§éš”ç¦»çº§åˆ«çš„å®ç°æ–¹å¼\"><a href=\"#å››ç§éš”ç¦»çº§åˆ«çš„å®ç°æ–¹å¼\" class=\"headerlink\" title=\"å››ç§éš”ç¦»çº§åˆ«çš„å®ç°æ–¹å¼\"></a>å››ç§éš”ç¦»çº§åˆ«çš„å®ç°æ–¹å¼</h4><ul>\n<li><strong>è¯»æœªæäº¤</strong><ul>\n<li>ç›´æ¥è¯»å°±å¥½äº†</li>\n</ul>\n</li>\n<li><strong>ä¸²è¡ŒåŒ–</strong><ul>\n<li>åŠ è¯»å†™é”é¿å…å¹¶è¡Œè®¿é—®</li>\n</ul>\n</li>\n<li><strong>è¯»æäº¤</strong>å’Œ<strong>å¯é‡å¤è¯»</strong>éƒ½æ˜¯é€šè¿‡<strong>Read View</strong>æ¥å®ç°çš„ï¼ŒåŒºåˆ«åœ¨äºåˆ›å»ºRead Viewçš„æ—¶æœº<ul>\n<li>è¯»æäº¤åœ¨<strong>æ¯ä¸€ä¸ªè¯­å¥æ‰§è¡Œä¹‹å‰</strong>éƒ½ä¼šç”Ÿæˆä¸€ä¸ªRead View</li>\n<li>å¯é‡å¤è¯»åªåœ¨å¯åŠ¨äº‹åŠ¡æ—¶ç”Ÿæˆä¸€ä¸ªRead Viewï¼Œç„¶åæ•´ä¸ªäº‹åŠ¡æ‰§è¡Œè¿‡ç¨‹ä¸­éƒ½ç”¨è¿™ä¸€ä¸ªRead View</li>\n</ul>\n</li>\n</ul>\n<p>ğŸŒŸåŒºåˆ†ã€Œå¼€å¯äº‹åŠ¡ã€å’Œã€Œå¯åŠ¨äº‹åŠ¡ã€</p>\n<p>åœ¨MySQLä¸­æœ‰ä¸¤ç§æ–¹å¼<strong>å¼€å¯äº‹åŠ¡</strong></p>\n<figure class=\"highlight sql\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"># ç¬¬ä¸€ç§</span><br><span class=\"line\"><span class=\"keyword\">begin</span><span class=\"operator\">/</span><span class=\"keyword\">start</span> transaction</span><br><span class=\"line\"></span><br><span class=\"line\"># ç¬¬äºŒç§</span><br><span class=\"line\"><span class=\"keyword\">start</span> transaction <span class=\"keyword\">with</span> consistent snapshot</span><br></pre></td></tr></table></figure>\n\n<p>ä»¥ç¬¬ä¸€ç§æ–¹å¼å¼€å¯äº‹åŠ¡ä¸ä»£è¡¨å¯åŠ¨äº†ä¸€ä¸ªäº‹åŠ¡ï¼Œåªæœ‰æ‰§è¡Œäº†ç¬¬ä¸€æ¡selectè¯­å¥ï¼Œæ‰æ˜¯çœŸæ­£å¯åŠ¨äº‹åŠ¡</p>\n<p>ç¬¬äºŒç§æ–¹å¼åœ¨å¼€å¯äº‹åŠ¡çš„åŒæ—¶ä¹Ÿå¯åŠ¨äº†äº‹åŠ¡ï¼ˆæ¯•ç«Ÿå‘½ä»¤ä¸­éƒ½å¸¦æœ‰<code>snapshot</code>ğŸ˜‚ï¼‰</p>\n<h3 id=\"Read-Viewåœ¨MVCCæ˜¯å¦‚ä½•å·¥ä½œçš„ï¼Ÿ\"><a href=\"#Read-Viewåœ¨MVCCæ˜¯å¦‚ä½•å·¥ä½œçš„ï¼Ÿ\" class=\"headerlink\" title=\"Read Viewåœ¨MVCCæ˜¯å¦‚ä½•å·¥ä½œçš„ï¼Ÿ\"></a>Read Viewåœ¨MVCCæ˜¯å¦‚ä½•å·¥ä½œçš„ï¼Ÿ</h3><blockquote>\n<p>ä¸¤ä¸ªå‰ç½®çŸ¥è¯†</p>\n<ul>\n<li><p>Read Viewä¸­å››ä¸ªå­—æ®µä½œç”¨</p>\n</li>\n<li><p>èšç°‡ç´¢å¼•è®°å½•ä¸­ä¸¤ä¸ªè·Ÿäº‹åŠ¡æœ‰å…³çš„ä¸¤ä¸ªéšè—å­—æ®µ</p>\n</li>\n</ul>\n</blockquote>\n<p>Read Viewå®è´¨æ˜¯ç”±<strong>å››ä¸ªå­—æ®µ</strong>æ„æˆçš„</p>\n<p><img src=\"https://raw.githubusercontent.com/lyydsheep/pic/main/202409231525562.png\" alt=\"image-20240923152532491\"></p>\n<ul>\n<li><strong>m_ids</strong>ï¼šæŒ‡åœ¨åˆ›å»ºRead Viewæ—¶ï¼Œå½“å‰æ•°æ®åº“ä¸­ã€Œæ´»è·ƒäº‹åŠ¡ã€çš„äº‹åŠ¡idï¼Œå¯èƒ½æœ‰å¤šä¸ª<ul>\n<li><strong>æ´»è·ƒäº‹åŠ¡</strong>å³<strong>å¯åŠ¨</strong>äº†ä½†æ˜¯è¿˜æ²¡æœ‰æäº¤çš„äº‹åŠ¡</li>\n</ul>\n</li>\n<li><strong>min_trx_id</strong>ï¼šæ´»è·ƒäº‹åŠ¡ä¸­æœ€å°çš„äº‹åŠ¡id</li>\n<li><strong>max_trx_id</strong>ï¼š<strong>æ•°æ®åº“ä¸‹ä¸€ä¸ªå°†åˆ†é…ç»™äº‹åŠ¡çš„id</strong>ï¼Œå³å…¨å±€äº‹åŠ¡idçš„æœ€å¤§å€¼+1</li>\n<li><strong>creator_trx_id</strong>ï¼šåˆ›å»ºå½“å‰Read Viewçš„äº‹åŠ¡id</li>\n</ul>\n<p>äº†è§£å®ŒRead Viewä¸­çš„å››ä¸ªå­—æ®µåï¼Œå†çœ‹çœ‹èšç°‡ç´¢å¼•è®°å½•ä¸­çš„<strong>ä¸¤ä¸ªéšè—å­—æ®µ</strong>ï¼ŒğŸŒ°ï¼š</p>\n<p><img src=\"https://raw.githubusercontent.com/lyydsheep/pic/main/202409231532645.png\" alt=\"image-20240923153259596\"></p>\n<ul>\n<li><strong>trx_id</strong>ï¼šå½“ä¸€ä¸ªäº‹åŠ¡å¯¹æŸæ¡èšç°‡ç´¢å¼•çš„æ•°æ®è¿›è¡Œæ”¹åŠ¨æ—¶ï¼Œå°±æŠŠè¯¥äº‹åŠ¡çš„idæ”¾å…¥trx_idå­—æ®µä¸­</li>\n<li><strong>roll_pointer</strong>ï¼šå½“å¯¹æŸæ¡èšç°‡ç´¢å¼•è®°å½•è¿›è¡Œä¿®æ”¹æ—¶ï¼Œéƒ½ä¼šæŠŠæ—§ç‰ˆæœ¬çš„æ•°æ®è®°å½•åœ¨<strong>undoæ—¥å¿—</strong>ä¸­ï¼Œroll_pointerå°±æŒ‡å‘æ¯ä¸€ä¸ªæ—§ç‰ˆæœ¬çš„æ•°æ®ï¼Œå› æ­¤å¯ä»¥é€šè¿‡roll_pointeréšè—åˆ—æ‰¾åˆ°å†å²è®°å½•</li>\n</ul>\n<h4 id=\"MVCC\"><a href=\"#MVCC\" class=\"headerlink\" title=\"MVCC\"></a>MVCC</h4><p>åœ¨äº†è§£Read Viewå››ä¸ªå­—æ®µä»¥åŠèšç°‡ç´¢å¼•è®°å½•çš„ä¸¤ä¸ªéšè—åˆ—åï¼Œæ¥ä¸‹æ¥å°±å¯ä»¥å¼„æ¸…æ¥šMVCCæ˜¯å¦‚ä½•æ§åˆ¶æ•°æ®å¿«ç…§çš„</p>\n<p>å‡è®¾ç°åœ¨æœ‰ä¸€ä¸ªã€Œæ´»è·ƒäº‹åŠ¡ã€äº‹åŠ¡Aï¼Œé‚£ä¹ˆå¯ä»¥æ ¹æ®äº‹åŠ¡Açš„Read Viewåˆ›å»ºæ—¶åˆ»å°†å…¶ä»–äº‹åŠ¡åˆ’åˆ†ä¸ºå››ç±»ï¼š</p>\n<ul>\n<li>äº‹åŠ¡idå°äº<code>min_trx_id</code></li>\n<li>äº‹åŠ¡idå¤§äºç­‰äº<code>max_trx_id</code></li>\n<li>äº‹åŠ¡idåœ¨<code>min_trx_id</code>å’Œ<code>max_trx_id</code>ä¹‹é—´ä¸”ä½äº<code>m_ids</code>ä¸­</li>\n<li>äº‹åŠ¡idåœ¨<code>min_trx_id</code>å’Œ<code>max_trx_id</code>ä¹‹é—´ä¸”ä¸ä½äº<code>m_ids</code>ä¸­</li>\n</ul>\n<p><img src=\"https://raw.githubusercontent.com/lyydsheep/pic/main/202409231542692.png\" alt=\"image-20240923154216650\"></p>\n<ul>\n<li>å¦‚æœè®°å½•çš„éšè—åˆ—<code>trx_id</code>å€¼å°äº<code>min_trx_id</code>ï¼Œé‚£ä¹ˆè¿™ä¸ªç‰ˆæœ¬çš„è®°å½•æ˜¯åœ¨Read Viewåˆ›å»ºä¹‹å‰å®Œæˆçš„ï¼Œæ‰€ä»¥è¯¥ç‰ˆæœ¬è®°å½•æ˜¯å¯¹å½“å‰äº‹åŠ¡<strong>å¯è§çš„</strong></li>\n<li>å¦‚æœ<code>trx_id</code>å€¼å¤§äºç­‰äº<code>max_trx_id</code>ï¼Œè¯´æ˜è¿™ä¸ªç‰ˆæœ¬çš„è®°å½•æ˜¯åœ¨Read Viewåˆ›å»ºä¹‹åç”Ÿæˆçš„ï¼Œæ•…å¯¹äºå½“å‰äº‹åŠ¡æ˜¯<strong>ä¸å¯è§çš„</strong></li>\n<li>å¦‚æœ<code>trx_id</code>å€¼åœ¨<code>min_trx_id</code>å’Œ<code>max_trx_id</code>ä¹‹é—´ï¼Œåˆ™éœ€è¦è¿›ä¸€æ­¥åˆ¤æ–­è®°å½•çš„<code>trx_id</code>æ˜¯å¦åœ¨<code>m_ids</code>åˆ—è¡¨ä¸­ï¼ˆå³å¯¹äºçš„äº‹åŠ¡æ˜¯å¦æ˜¯æ´»è·ƒäº‹åŠ¡ï¼‰<ul>\n<li>æ˜¯æ´»è·ƒäº‹åŠ¡ï¼Œé‚£ä¹ˆè¯¥è¯¥ç‰ˆæœ¬çš„è®°å½•å¯¹å½“å‰äº‹åŠ¡<strong>ä¸å¯è§</strong></li>\n<li>ä¸æ˜¯æ´»è·ƒäº‹åŠ¡ï¼Œé‚£ä¹ˆè¯¥ç‰ˆæœ¬çš„è®°å½•æ˜¯<strong>å¯è§çš„</strong></li>\n<li>ğŸŒ°ï¼šåˆ›å»ºäº†1ã€2ã€3ã€4è¿™å››ä¸ªäº‹åŠ¡ï¼Œå…¶ä¸­äº‹åŠ¡3ä»¥è¿…é›·ä¸åŠæ©è€³ä¹‹åŠ¿æäº¤äº†ï¼Œé‚£ä¹ˆéšåå¯åŠ¨çš„äº‹åŠ¡5æ˜¯å¯ä»¥çœ‹è§äº‹åŠ¡3æ‰€ä¿®æ”¹çš„è®°å½•ç‰ˆæœ¬çš„</li>\n</ul>\n</li>\n</ul>\n<p><strong>è¿™ç§é€šè¿‡ã€Œç‰ˆæœ¬é“¾ã€æ¥æ§åˆ¶å¹¶å‘äº‹åŠ¡ä¸å†²çªåœ°è®¿é—®åŒä¸€æ¡è®°å½•çš„æ“ä½œå°±å«MVCCï¼ˆå¤šç‰ˆæœ¬å¹¶å‘æ§åˆ¶ï¼‰</strong></p>\n"},{"_content":"## 01\n- å»ºç«‹è¿æ¥çš„è¿‡ç¨‹æ˜¯æ¯”è¾ƒå¤æ‚çš„ï¼Œå› æ­¤å°½é‡ä½¿ç”¨é•¿è¿æ¥ï¼Œé¿å…è¿‡å¤šçš„çŸ­é“¾æ¥\n\t- ä½†æ˜¯é•¿è¿æ¥ç§¯ç´¯ä¸‹æ¥ä¼šå¯¼è‡´å†…å­˜å ç”¨å¤ªå¤§ï¼Œå¼ºè¡Œè¢«ç³»ç»Ÿæ€æ­»ï¼ˆOOMï¼‰\n\t- è§£å†³æ–¹æ³•ï¼š\n\t\t- å®šæœŸæ–­å¼€é•¿è¿æ¥\n\t\t- MySQL 5.7 åŠä¹‹åçš„ç‰ˆæœ¬ï¼Œé€šè¿‡æ‰§è¡Œmysql_reset_connectioné‡æ–°åˆå§‹åŒ–è¿æ¥èµ„æº\n\n## 03\n- å°½é‡ä¸è¦ä½¿ç”¨é•¿äº‹åŠ¡\n\t- é•¿äº‹åŠ¡æ„å‘³ç€ç³»ç»Ÿä¸­å­˜åœ¨å¾ˆè€çš„Read-Viewï¼Œåœ¨äº‹åŠ¡æäº¤å‰ï¼Œè¿™äº›Read-Viewéƒ½å¿…é¡»ä¿ç•™ï¼Œè¿™å°±ä¼šå¯¼è‡´å ç”¨å¤§é‡å­˜å‚¨ç©ºé—´\n\t- é™¤äº†å¯¹å›æ»šæ®µçš„å½±å“ï¼Œé•¿äº‹åŠ¡è¿˜å ç”¨é”èµ„æºï¼Œä¹Ÿå¯èƒ½ä¼šæ‹–å®æ•´ä¸ªæ•°æ®åº“\n- æ€»æ˜¯ä½¿ç”¨`set autocommit = 1`ï¼Œé€šè¿‡æ˜¾ç¤ºè¯­å¥çš„æ–¹å¼æ¥å¯åŠ¨äº‹åŠ¡\n- é¢‘ç¹ä½¿ç”¨äº‹åŠ¡çš„ä¸šåŠ¡ï¼Œå¯ä»¥ä½¿ç”¨`commit work and chain`\n\t- åœ¨`autocommit = 1`ï¼Œé€šè¿‡`begin`æ˜¾ç¤ºå¼€å¯äº‹åŠ¡çš„æƒ…å†µä¸‹ï¼Œ`commit`è¡¨ç¤ºæäº¤äº‹åŠ¡ï¼Œ`commit work and chain`è¡¨ç¤ºæäº¤äº‹åŠ¡å¹¶å¼€å¯ä¸‹ä¸€ä¸ªäº‹åŠ¡ï¼Œçœå»äº†`begin`è¯­å¥çš„å¼€é”€\n- ![Screenshot 2025-01-17 at 22.18.29.png](https://raw.githubusercontent.com/lyydsheep/pic/main/Screenshot%202025-01-17%20at%2022.18.29.png)\n\n\n## 04\n- å“ˆå¸Œè¡¨é€‚ç”¨äºç­‰å€¼æŸ¥è¯¢åœºæ™¯\n- æœ‰åºæ•°ç»„é€‚ç”¨äºé™æ€å­˜å‚¨å¼•æ“\n- å°½é‡ä½¿ç”¨ä¸»é”®æŸ¥è¯¢åŸåˆ™\n- è‡ªå¢ä¸»é”®\n\t- æ€§èƒ½\n\t- å­˜å‚¨ç©ºé—´\n\n## 05\n![Screenshot 2025-01-18 at 22.33.22.png](https://raw.githubusercontent.com/lyydsheep/pic/main/Screenshot%202025-01-18%20at%2022.33.22.png)\n\n## 06\n- å¦‚æœäº‹åŠ¡ä¸­éœ€è¦é”å¤šä¸ªè¡Œï¼ŒæŠŠæœ€å¯èƒ½é€ æˆé”å†²çªã€æœ€å½±å“å¹¶å‘åº¦çš„é”å°½é‡å¾€åæ”¾\n- æ­»é”æ£€æµ‹è¦è€—è´¹å¤§é‡çš„CPUèµ„æº\n\n## 08\n![image.png](https://raw.githubusercontent.com/lyydsheep/pic/main/20250122200502.png)\n\n## 09\n- å¯¹äºå†™å¤šè¯»å°‘çš„åœºæ™¯ï¼Œé¡µé¢åœ¨å†™å®Œåé©¬ä¸Šè®¿é—®çš„æ¦‚ç‡æ¯”è¾ƒå°ï¼Œæ­¤æ—¶change bufferçš„æ•ˆæœæœ€å¥½ã€‚ä¾‹å¦‚ï¼šè´¦å•ç±»ã€æ—¥å¿—ç±»ç³»ç»Ÿ\n","source":"_posts/MySQL/MySQLå®æˆ˜45è®².md","raw":"## 01\n- å»ºç«‹è¿æ¥çš„è¿‡ç¨‹æ˜¯æ¯”è¾ƒå¤æ‚çš„ï¼Œå› æ­¤å°½é‡ä½¿ç”¨é•¿è¿æ¥ï¼Œé¿å…è¿‡å¤šçš„çŸ­é“¾æ¥\n\t- ä½†æ˜¯é•¿è¿æ¥ç§¯ç´¯ä¸‹æ¥ä¼šå¯¼è‡´å†…å­˜å ç”¨å¤ªå¤§ï¼Œå¼ºè¡Œè¢«ç³»ç»Ÿæ€æ­»ï¼ˆOOMï¼‰\n\t- è§£å†³æ–¹æ³•ï¼š\n\t\t- å®šæœŸæ–­å¼€é•¿è¿æ¥\n\t\t- MySQL 5.7 åŠä¹‹åçš„ç‰ˆæœ¬ï¼Œé€šè¿‡æ‰§è¡Œmysql_reset_connectioné‡æ–°åˆå§‹åŒ–è¿æ¥èµ„æº\n\n## 03\n- å°½é‡ä¸è¦ä½¿ç”¨é•¿äº‹åŠ¡\n\t- é•¿äº‹åŠ¡æ„å‘³ç€ç³»ç»Ÿä¸­å­˜åœ¨å¾ˆè€çš„Read-Viewï¼Œåœ¨äº‹åŠ¡æäº¤å‰ï¼Œè¿™äº›Read-Viewéƒ½å¿…é¡»ä¿ç•™ï¼Œè¿™å°±ä¼šå¯¼è‡´å ç”¨å¤§é‡å­˜å‚¨ç©ºé—´\n\t- é™¤äº†å¯¹å›æ»šæ®µçš„å½±å“ï¼Œé•¿äº‹åŠ¡è¿˜å ç”¨é”èµ„æºï¼Œä¹Ÿå¯èƒ½ä¼šæ‹–å®æ•´ä¸ªæ•°æ®åº“\n- æ€»æ˜¯ä½¿ç”¨`set autocommit = 1`ï¼Œé€šè¿‡æ˜¾ç¤ºè¯­å¥çš„æ–¹å¼æ¥å¯åŠ¨äº‹åŠ¡\n- é¢‘ç¹ä½¿ç”¨äº‹åŠ¡çš„ä¸šåŠ¡ï¼Œå¯ä»¥ä½¿ç”¨`commit work and chain`\n\t- åœ¨`autocommit = 1`ï¼Œé€šè¿‡`begin`æ˜¾ç¤ºå¼€å¯äº‹åŠ¡çš„æƒ…å†µä¸‹ï¼Œ`commit`è¡¨ç¤ºæäº¤äº‹åŠ¡ï¼Œ`commit work and chain`è¡¨ç¤ºæäº¤äº‹åŠ¡å¹¶å¼€å¯ä¸‹ä¸€ä¸ªäº‹åŠ¡ï¼Œçœå»äº†`begin`è¯­å¥çš„å¼€é”€\n- ![Screenshot 2025-01-17 at 22.18.29.png](https://raw.githubusercontent.com/lyydsheep/pic/main/Screenshot%202025-01-17%20at%2022.18.29.png)\n\n\n## 04\n- å“ˆå¸Œè¡¨é€‚ç”¨äºç­‰å€¼æŸ¥è¯¢åœºæ™¯\n- æœ‰åºæ•°ç»„é€‚ç”¨äºé™æ€å­˜å‚¨å¼•æ“\n- å°½é‡ä½¿ç”¨ä¸»é”®æŸ¥è¯¢åŸåˆ™\n- è‡ªå¢ä¸»é”®\n\t- æ€§èƒ½\n\t- å­˜å‚¨ç©ºé—´\n\n## 05\n![Screenshot 2025-01-18 at 22.33.22.png](https://raw.githubusercontent.com/lyydsheep/pic/main/Screenshot%202025-01-18%20at%2022.33.22.png)\n\n## 06\n- å¦‚æœäº‹åŠ¡ä¸­éœ€è¦é”å¤šä¸ªè¡Œï¼ŒæŠŠæœ€å¯èƒ½é€ æˆé”å†²çªã€æœ€å½±å“å¹¶å‘åº¦çš„é”å°½é‡å¾€åæ”¾\n- æ­»é”æ£€æµ‹è¦è€—è´¹å¤§é‡çš„CPUèµ„æº\n\n## 08\n![image.png](https://raw.githubusercontent.com/lyydsheep/pic/main/20250122200502.png)\n\n## 09\n- å¯¹äºå†™å¤šè¯»å°‘çš„åœºæ™¯ï¼Œé¡µé¢åœ¨å†™å®Œåé©¬ä¸Šè®¿é—®çš„æ¦‚ç‡æ¯”è¾ƒå°ï¼Œæ­¤æ—¶change bufferçš„æ•ˆæœæœ€å¥½ã€‚ä¾‹å¦‚ï¼šè´¦å•ç±»ã€æ—¥å¿—ç±»ç³»ç»Ÿ\n","slug":"MySQL/MySQLå®æˆ˜45è®²","published":1,"date":"2025-01-13T14:16:31.434Z","updated":"2025-01-23T14:10:36.311Z","title":"","comments":1,"layout":"post","photos":[],"_id":"cm6c7md6n002ba5t219jh0luy","content":"<h2 id=\"01\"><a href=\"#01\" class=\"headerlink\" title=\"01\"></a>01</h2><ul>\n<li>å»ºç«‹è¿æ¥çš„è¿‡ç¨‹æ˜¯æ¯”è¾ƒå¤æ‚çš„ï¼Œå› æ­¤å°½é‡ä½¿ç”¨é•¿è¿æ¥ï¼Œé¿å…è¿‡å¤šçš„çŸ­é“¾æ¥<ul>\n<li>ä½†æ˜¯é•¿è¿æ¥ç§¯ç´¯ä¸‹æ¥ä¼šå¯¼è‡´å†…å­˜å ç”¨å¤ªå¤§ï¼Œå¼ºè¡Œè¢«ç³»ç»Ÿæ€æ­»ï¼ˆOOMï¼‰</li>\n<li>è§£å†³æ–¹æ³•ï¼š<ul>\n<li>å®šæœŸæ–­å¼€é•¿è¿æ¥</li>\n<li>MySQL 5.7 åŠä¹‹åçš„ç‰ˆæœ¬ï¼Œé€šè¿‡æ‰§è¡Œmysql_reset_connectioné‡æ–°åˆå§‹åŒ–è¿æ¥èµ„æº</li>\n</ul>\n</li>\n</ul>\n</li>\n</ul>\n<h2 id=\"03\"><a href=\"#03\" class=\"headerlink\" title=\"03\"></a>03</h2><ul>\n<li>å°½é‡ä¸è¦ä½¿ç”¨é•¿äº‹åŠ¡<ul>\n<li>é•¿äº‹åŠ¡æ„å‘³ç€ç³»ç»Ÿä¸­å­˜åœ¨å¾ˆè€çš„Read-Viewï¼Œåœ¨äº‹åŠ¡æäº¤å‰ï¼Œè¿™äº›Read-Viewéƒ½å¿…é¡»ä¿ç•™ï¼Œè¿™å°±ä¼šå¯¼è‡´å ç”¨å¤§é‡å­˜å‚¨ç©ºé—´</li>\n<li>é™¤äº†å¯¹å›æ»šæ®µçš„å½±å“ï¼Œé•¿äº‹åŠ¡è¿˜å ç”¨é”èµ„æºï¼Œä¹Ÿå¯èƒ½ä¼šæ‹–å®æ•´ä¸ªæ•°æ®åº“</li>\n</ul>\n</li>\n<li>æ€»æ˜¯ä½¿ç”¨<code>set autocommit = 1</code>ï¼Œé€šè¿‡æ˜¾ç¤ºè¯­å¥çš„æ–¹å¼æ¥å¯åŠ¨äº‹åŠ¡</li>\n<li>é¢‘ç¹ä½¿ç”¨äº‹åŠ¡çš„ä¸šåŠ¡ï¼Œå¯ä»¥ä½¿ç”¨<code>commit work and chain</code><ul>\n<li>åœ¨<code>autocommit = 1</code>ï¼Œé€šè¿‡<code>begin</code>æ˜¾ç¤ºå¼€å¯äº‹åŠ¡çš„æƒ…å†µä¸‹ï¼Œ<code>commit</code>è¡¨ç¤ºæäº¤äº‹åŠ¡ï¼Œ<code>commit work and chain</code>è¡¨ç¤ºæäº¤äº‹åŠ¡å¹¶å¼€å¯ä¸‹ä¸€ä¸ªäº‹åŠ¡ï¼Œçœå»äº†<code>begin</code>è¯­å¥çš„å¼€é”€</li>\n</ul>\n</li>\n<li><img src=\"https://raw.githubusercontent.com/lyydsheep/pic/main/Screenshot%202025-01-17%20at%2022.18.29.png\" alt=\"Screenshot 2025-01-17 at 22.18.29.png\"></li>\n</ul>\n<h2 id=\"04\"><a href=\"#04\" class=\"headerlink\" title=\"04\"></a>04</h2><ul>\n<li>å“ˆå¸Œè¡¨é€‚ç”¨äºç­‰å€¼æŸ¥è¯¢åœºæ™¯</li>\n<li>æœ‰åºæ•°ç»„é€‚ç”¨äºé™æ€å­˜å‚¨å¼•æ“</li>\n<li>å°½é‡ä½¿ç”¨ä¸»é”®æŸ¥è¯¢åŸåˆ™</li>\n<li>è‡ªå¢ä¸»é”®<ul>\n<li>æ€§èƒ½</li>\n<li>å­˜å‚¨ç©ºé—´</li>\n</ul>\n</li>\n</ul>\n<h2 id=\"05\"><a href=\"#05\" class=\"headerlink\" title=\"05\"></a>05</h2><p><img src=\"https://raw.githubusercontent.com/lyydsheep/pic/main/Screenshot%202025-01-18%20at%2022.33.22.png\" alt=\"Screenshot 2025-01-18 at 22.33.22.png\"></p>\n<h2 id=\"06\"><a href=\"#06\" class=\"headerlink\" title=\"06\"></a>06</h2><ul>\n<li>å¦‚æœäº‹åŠ¡ä¸­éœ€è¦é”å¤šä¸ªè¡Œï¼ŒæŠŠæœ€å¯èƒ½é€ æˆé”å†²çªã€æœ€å½±å“å¹¶å‘åº¦çš„é”å°½é‡å¾€åæ”¾</li>\n<li>æ­»é”æ£€æµ‹è¦è€—è´¹å¤§é‡çš„CPUèµ„æº</li>\n</ul>\n<h2 id=\"08\"><a href=\"#08\" class=\"headerlink\" title=\"08\"></a>08</h2><p><img src=\"https://raw.githubusercontent.com/lyydsheep/pic/main/20250122200502.png\" alt=\"image.png\"></p>\n<h2 id=\"09\"><a href=\"#09\" class=\"headerlink\" title=\"09\"></a>09</h2><ul>\n<li>å¯¹äºå†™å¤šè¯»å°‘çš„åœºæ™¯ï¼Œé¡µé¢åœ¨å†™å®Œåé©¬ä¸Šè®¿é—®çš„æ¦‚ç‡æ¯”è¾ƒå°ï¼Œæ­¤æ—¶change bufferçš„æ•ˆæœæœ€å¥½ã€‚ä¾‹å¦‚ï¼šè´¦å•ç±»ã€æ—¥å¿—ç±»ç³»ç»Ÿ</li>\n</ul>\n","excerpt":"","more":"<h2 id=\"01\"><a href=\"#01\" class=\"headerlink\" title=\"01\"></a>01</h2><ul>\n<li>å»ºç«‹è¿æ¥çš„è¿‡ç¨‹æ˜¯æ¯”è¾ƒå¤æ‚çš„ï¼Œå› æ­¤å°½é‡ä½¿ç”¨é•¿è¿æ¥ï¼Œé¿å…è¿‡å¤šçš„çŸ­é“¾æ¥<ul>\n<li>ä½†æ˜¯é•¿è¿æ¥ç§¯ç´¯ä¸‹æ¥ä¼šå¯¼è‡´å†…å­˜å ç”¨å¤ªå¤§ï¼Œå¼ºè¡Œè¢«ç³»ç»Ÿæ€æ­»ï¼ˆOOMï¼‰</li>\n<li>è§£å†³æ–¹æ³•ï¼š<ul>\n<li>å®šæœŸæ–­å¼€é•¿è¿æ¥</li>\n<li>MySQL 5.7 åŠä¹‹åçš„ç‰ˆæœ¬ï¼Œé€šè¿‡æ‰§è¡Œmysql_reset_connectioné‡æ–°åˆå§‹åŒ–è¿æ¥èµ„æº</li>\n</ul>\n</li>\n</ul>\n</li>\n</ul>\n<h2 id=\"03\"><a href=\"#03\" class=\"headerlink\" title=\"03\"></a>03</h2><ul>\n<li>å°½é‡ä¸è¦ä½¿ç”¨é•¿äº‹åŠ¡<ul>\n<li>é•¿äº‹åŠ¡æ„å‘³ç€ç³»ç»Ÿä¸­å­˜åœ¨å¾ˆè€çš„Read-Viewï¼Œåœ¨äº‹åŠ¡æäº¤å‰ï¼Œè¿™äº›Read-Viewéƒ½å¿…é¡»ä¿ç•™ï¼Œè¿™å°±ä¼šå¯¼è‡´å ç”¨å¤§é‡å­˜å‚¨ç©ºé—´</li>\n<li>é™¤äº†å¯¹å›æ»šæ®µçš„å½±å“ï¼Œé•¿äº‹åŠ¡è¿˜å ç”¨é”èµ„æºï¼Œä¹Ÿå¯èƒ½ä¼šæ‹–å®æ•´ä¸ªæ•°æ®åº“</li>\n</ul>\n</li>\n<li>æ€»æ˜¯ä½¿ç”¨<code>set autocommit = 1</code>ï¼Œé€šè¿‡æ˜¾ç¤ºè¯­å¥çš„æ–¹å¼æ¥å¯åŠ¨äº‹åŠ¡</li>\n<li>é¢‘ç¹ä½¿ç”¨äº‹åŠ¡çš„ä¸šåŠ¡ï¼Œå¯ä»¥ä½¿ç”¨<code>commit work and chain</code><ul>\n<li>åœ¨<code>autocommit = 1</code>ï¼Œé€šè¿‡<code>begin</code>æ˜¾ç¤ºå¼€å¯äº‹åŠ¡çš„æƒ…å†µä¸‹ï¼Œ<code>commit</code>è¡¨ç¤ºæäº¤äº‹åŠ¡ï¼Œ<code>commit work and chain</code>è¡¨ç¤ºæäº¤äº‹åŠ¡å¹¶å¼€å¯ä¸‹ä¸€ä¸ªäº‹åŠ¡ï¼Œçœå»äº†<code>begin</code>è¯­å¥çš„å¼€é”€</li>\n</ul>\n</li>\n<li><img src=\"https://raw.githubusercontent.com/lyydsheep/pic/main/Screenshot%202025-01-17%20at%2022.18.29.png\" alt=\"Screenshot 2025-01-17 at 22.18.29.png\"></li>\n</ul>\n<h2 id=\"04\"><a href=\"#04\" class=\"headerlink\" title=\"04\"></a>04</h2><ul>\n<li>å“ˆå¸Œè¡¨é€‚ç”¨äºç­‰å€¼æŸ¥è¯¢åœºæ™¯</li>\n<li>æœ‰åºæ•°ç»„é€‚ç”¨äºé™æ€å­˜å‚¨å¼•æ“</li>\n<li>å°½é‡ä½¿ç”¨ä¸»é”®æŸ¥è¯¢åŸåˆ™</li>\n<li>è‡ªå¢ä¸»é”®<ul>\n<li>æ€§èƒ½</li>\n<li>å­˜å‚¨ç©ºé—´</li>\n</ul>\n</li>\n</ul>\n<h2 id=\"05\"><a href=\"#05\" class=\"headerlink\" title=\"05\"></a>05</h2><p><img src=\"https://raw.githubusercontent.com/lyydsheep/pic/main/Screenshot%202025-01-18%20at%2022.33.22.png\" alt=\"Screenshot 2025-01-18 at 22.33.22.png\"></p>\n<h2 id=\"06\"><a href=\"#06\" class=\"headerlink\" title=\"06\"></a>06</h2><ul>\n<li>å¦‚æœäº‹åŠ¡ä¸­éœ€è¦é”å¤šä¸ªè¡Œï¼ŒæŠŠæœ€å¯èƒ½é€ æˆé”å†²çªã€æœ€å½±å“å¹¶å‘åº¦çš„é”å°½é‡å¾€åæ”¾</li>\n<li>æ­»é”æ£€æµ‹è¦è€—è´¹å¤§é‡çš„CPUèµ„æº</li>\n</ul>\n<h2 id=\"08\"><a href=\"#08\" class=\"headerlink\" title=\"08\"></a>08</h2><p><img src=\"https://raw.githubusercontent.com/lyydsheep/pic/main/20250122200502.png\" alt=\"image.png\"></p>\n<h2 id=\"09\"><a href=\"#09\" class=\"headerlink\" title=\"09\"></a>09</h2><ul>\n<li>å¯¹äºå†™å¤šè¯»å°‘çš„åœºæ™¯ï¼Œé¡µé¢åœ¨å†™å®Œåé©¬ä¸Šè®¿é—®çš„æ¦‚ç‡æ¯”è¾ƒå°ï¼Œæ­¤æ—¶change bufferçš„æ•ˆæœæœ€å¥½ã€‚ä¾‹å¦‚ï¼šè´¦å•ç±»ã€æ—¥å¿—ç±»ç³»ç»Ÿ</li>\n</ul>\n"},{"publish":false,"_content":"\n\n\n# æ—¥å¿—\n\nMySQLä¸­çš„ä¸‰ç§æ—¥å¿—ï¼š\n\n- **undo logï¼ˆå›æ»šæ—¥å¿—ï¼‰**ï¼šæ˜¯InnoDBå­˜å‚¨å¼•æ“å±‚ç”Ÿæˆçš„æ—¥å¿—ï¼Œå®ç°äº†äº‹åŠ¡ä¸­çš„**åŸå­æ€§**ï¼Œä¸»è¦ç”¨äº**äº‹åŠ¡å›æ»šå’ŒMVCC**\n- **redo logï¼ˆé‡åšæ—¥å¿—ï¼‰**ï¼šæ˜¯InnoDBå­˜å‚¨å¼•æ“å±‚ç”Ÿæˆçš„æ—¥å¿—ï¼Œå®ç°äº†äº‹åŠ¡çš„**æŒä¹…æ€§**ï¼Œä¸»è¦ç”¨äº**æ‰ç”µç­‰æ•…éšœçš„æ¢å¤**\n- **binlogï¼ˆå½’æ¡£æ—¥å¿—ï¼‰**ï¼šæ˜¯Serverå±‚ç”Ÿæˆçš„æ—¥å¿—ï¼Œä¸»è¦ç”¨äº**æ•°æ®å¤‡ä»½å’Œä¸»ä»å¤åˆ¶**\n","source":"_posts/MySQL/MySQLæ—¥å¿—å­¦ä¹ .md","raw":"---\npublish: false\n---\n\n\n\n# æ—¥å¿—\n\nMySQLä¸­çš„ä¸‰ç§æ—¥å¿—ï¼š\n\n- **undo logï¼ˆå›æ»šæ—¥å¿—ï¼‰**ï¼šæ˜¯InnoDBå­˜å‚¨å¼•æ“å±‚ç”Ÿæˆçš„æ—¥å¿—ï¼Œå®ç°äº†äº‹åŠ¡ä¸­çš„**åŸå­æ€§**ï¼Œä¸»è¦ç”¨äº**äº‹åŠ¡å›æ»šå’ŒMVCC**\n- **redo logï¼ˆé‡åšæ—¥å¿—ï¼‰**ï¼šæ˜¯InnoDBå­˜å‚¨å¼•æ“å±‚ç”Ÿæˆçš„æ—¥å¿—ï¼Œå®ç°äº†äº‹åŠ¡çš„**æŒä¹…æ€§**ï¼Œä¸»è¦ç”¨äº**æ‰ç”µç­‰æ•…éšœçš„æ¢å¤**\n- **binlogï¼ˆå½’æ¡£æ—¥å¿—ï¼‰**ï¼šæ˜¯Serverå±‚ç”Ÿæˆçš„æ—¥å¿—ï¼Œä¸»è¦ç”¨äº**æ•°æ®å¤‡ä»½å’Œä¸»ä»å¤åˆ¶**\n","slug":"MySQL/MySQLæ—¥å¿—å­¦ä¹ ","published":1,"date":"2024-12-27T11:03:15.343Z","updated":"2024-12-27T11:03:15.343Z","title":"","comments":1,"layout":"post","photos":[],"_id":"cm6c7md6n002ea5t253yi6w1z","content":"<h1 id=\"æ—¥å¿—\"><a href=\"#æ—¥å¿—\" class=\"headerlink\" title=\"æ—¥å¿—\"></a>æ—¥å¿—</h1><p>MySQLä¸­çš„ä¸‰ç§æ—¥å¿—ï¼š</p>\n<ul>\n<li><strong>undo logï¼ˆå›æ»šæ—¥å¿—ï¼‰</strong>ï¼šæ˜¯InnoDBå­˜å‚¨å¼•æ“å±‚ç”Ÿæˆçš„æ—¥å¿—ï¼Œå®ç°äº†äº‹åŠ¡ä¸­çš„<strong>åŸå­æ€§</strong>ï¼Œä¸»è¦ç”¨äº<strong>äº‹åŠ¡å›æ»šå’ŒMVCC</strong></li>\n<li><strong>redo logï¼ˆé‡åšæ—¥å¿—ï¼‰</strong>ï¼šæ˜¯InnoDBå­˜å‚¨å¼•æ“å±‚ç”Ÿæˆçš„æ—¥å¿—ï¼Œå®ç°äº†äº‹åŠ¡çš„<strong>æŒä¹…æ€§</strong>ï¼Œä¸»è¦ç”¨äº<strong>æ‰ç”µç­‰æ•…éšœçš„æ¢å¤</strong></li>\n<li><strong>binlogï¼ˆå½’æ¡£æ—¥å¿—ï¼‰</strong>ï¼šæ˜¯Serverå±‚ç”Ÿæˆçš„æ—¥å¿—ï¼Œä¸»è¦ç”¨äº<strong>æ•°æ®å¤‡ä»½å’Œä¸»ä»å¤åˆ¶</strong></li>\n</ul>\n","excerpt":"","more":"<h1 id=\"æ—¥å¿—\"><a href=\"#æ—¥å¿—\" class=\"headerlink\" title=\"æ—¥å¿—\"></a>æ—¥å¿—</h1><p>MySQLä¸­çš„ä¸‰ç§æ—¥å¿—ï¼š</p>\n<ul>\n<li><strong>undo logï¼ˆå›æ»šæ—¥å¿—ï¼‰</strong>ï¼šæ˜¯InnoDBå­˜å‚¨å¼•æ“å±‚ç”Ÿæˆçš„æ—¥å¿—ï¼Œå®ç°äº†äº‹åŠ¡ä¸­çš„<strong>åŸå­æ€§</strong>ï¼Œä¸»è¦ç”¨äº<strong>äº‹åŠ¡å›æ»šå’ŒMVCC</strong></li>\n<li><strong>redo logï¼ˆé‡åšæ—¥å¿—ï¼‰</strong>ï¼šæ˜¯InnoDBå­˜å‚¨å¼•æ“å±‚ç”Ÿæˆçš„æ—¥å¿—ï¼Œå®ç°äº†äº‹åŠ¡çš„<strong>æŒä¹…æ€§</strong>ï¼Œä¸»è¦ç”¨äº<strong>æ‰ç”µç­‰æ•…éšœçš„æ¢å¤</strong></li>\n<li><strong>binlogï¼ˆå½’æ¡£æ—¥å¿—ï¼‰</strong>ï¼šæ˜¯Serverå±‚ç”Ÿæˆçš„æ—¥å¿—ï¼Œä¸»è¦ç”¨äº<strong>æ•°æ®å¤‡ä»½å’Œä¸»ä»å¤åˆ¶</strong></li>\n</ul>\n"},{"publish":true,"sticky":2,"date":"2024-09-19T10:29:00.000Z","_content":"\n# MySQLç´¢å¼•å­¦ä¹ \n\n## ç´¢å¼•æ•°æ®ç»“æ„\n\n> ä»€ä¹ˆæ˜¯ç´¢å¼•ï¼Ÿä¸ºä»€ä¹ˆç´¢å¼•èƒ½åŠ å¿«æŸ¥è¯¢ï¼Ÿ\n>\n> ç´¢å¼•çš„æ•°æ®ç»“æ„æ˜¯ä»€ä¹ˆï¼Ÿ\n>\n> B+æ ‘å’ŒBæ ‘ã€çº¢é»‘æ ‘æœ‰ä»€ä¹ˆåŒºåˆ«ï¼Ÿä¸ºä»€ä¹ˆä½¿ç”¨B+æ ‘ï¼Ÿ\n\nç´¢å¼•æ˜¯ä¸€ç§æ’å¥½åºçš„å¿«é€ŸæŸ¥æ‰¾çš„æ•°æ®ç»“æ„ã€‚åœ¨ç´¢å¼•ä¸ŠæŸ¥æ‰¾æ•°æ®çš„è¿‡ç¨‹å¯ä»¥ç±»æ¯”åœ¨äºŒå‰æœç´¢æ ‘ä¸Šè¿›è¡Œæ•°æ®æŸ¥è¯¢ï¼Œå¯ä»¥æ ¹æ®æ•°æ®çš„å¤§å°å…³ç³»çœç•¥å¯¹ä¸€äº›æ•°æ®çš„æŸ¥è¯¢æ“ä½œï¼Œä»è€Œ**å‡å°‘ç£ç›˜I/Oçš„æ¬¡æ•°**ï¼ŒåŠ å¿«æŸ¥è¯¢æ•ˆç‡ã€‚\n\nç´¢å¼•çš„å…·ä½“å®ç°ç”±**åº•å±‚çš„å­˜å‚¨å¼•æ“å†³å®š**ï¼Œä¾‹å¦‚åœ¨InnoDBå­˜å‚¨å¼•æ“ä¸‹ï¼Œç´¢å¼•æ˜¯ç”±B+æ ‘å®ç°çš„ã€‚\n\nBæ ‘å’ŒB+æ ‘éƒ½æ˜¯é€šè¿‡å¤šå‰æ ‘çš„å½¢å¼ï¼Œå°†æ ‘çš„é«˜åº¦é™ä½ï¼Œä»¥æ­¤å‡å°‘ç£ç›˜I/Oçš„æ¬¡æ•°ã€‚ä½†è¾ƒäºBæ ‘ï¼ŒB+æ ‘æœ‰ä»¥ä¸‹ä¼˜ç‚¹ï¼š\n\n- B+çš„æ ‘**éå¶å­èŠ‚ç‚¹ä¸å­˜æ”¾æ•°æ®åªå­˜æ”¾ç´¢å¼•**ï¼Œè€ŒBæ ‘çš„å†…èŠ‚ç‚¹æ—¢å­˜æ•°æ®åˆå­˜ç´¢å¼•ã€‚å› æ­¤æ•°æ®é‡ç›¸åŒçš„æƒ…å†µä¸‹ï¼ŒB+æ ‘çš„å†…èŠ‚ç‚¹å¯ä»¥å­˜æ”¾æ›´å¤šçš„ç´¢å¼•ï¼Œè¿™ä½¿å¾—B+æ ‘å¯ä»¥æ¯”Bæ ‘æ›´â€œçŸ®èƒ–â€ï¼ŒæŸ¥è¯¢åº•å±‚èŠ‚ç‚¹æ—¶ç£ç›˜I/Oæ¬¡æ•°æ›´å°‘\n- B+æ ‘**æœ‰å¤§é‡çš„å†—ä½™èŠ‚ç‚¹**ï¼ˆæ‰€æœ‰éå¶å­èŠ‚ç‚¹éƒ½æ˜¯å†—ä½™èŠ‚ç‚¹ï¼‰ï¼Œè¿™äº›å†—ä½™èŠ‚ç‚¹ä½¿å¾—B+æ ‘åœ¨æ’å…¥ã€åˆ é™¤çš„æƒ…å†µä¸‹ï¼Œæ ‘å½¢å˜åŒ–ä¸å¤§ï¼Œæ•ˆç‡æ›´é«˜\n- B+æ ‘çš„å¶å­èŠ‚ç‚¹ä¹‹é—´é€šè¿‡**é“¾è¡¨ç›¸äº’è¿æ¥**ï¼Œæœ‰åˆ©äºèŒƒå›´æŸ¥è¯¢\n\n\n\n## ç´¢å¼•å­˜å‚¨\n\n> å †è¡¨å’Œç´¢å¼•ç»„ç»‡æœ‰ä»€ä¹ˆåŒºåˆ«ï¼Ÿåˆ†åˆ«åº”ç”¨åœºæ™¯æ˜¯ä»€ä¹ˆï¼Ÿ\n\nåœ¨**å †è¡¨**çš„ç»„ç»‡ä¸­ï¼Œ**æ•°æ®å’Œç´¢å¼•æ˜¯åˆ†å¼€å­˜å‚¨çš„**ï¼ŒB+æ ‘å¶å­èŠ‚ç‚¹å­˜æ”¾çš„æ˜¯**ç´¢å¼•+æ•°æ®çš„åœ°å€ï¼Œåœ°å€æŒ‡å‘å †è¡¨ä¸­çš„æ•°æ®**ã€‚ç´¢å¼•æ˜¯æ’åºåçš„æ•°æ®ï¼Œè€Œå †è¡¨ä¸­çš„æ•°æ®æ˜¯æ— åºçš„\n\n- å †è¡¨ä¸­çš„ç´¢å¼•**éƒ½æ˜¯äºŒçº§ç´¢å¼•**ï¼Œå³ä½¿æ˜¯ä¸»é”®ç´¢å¼•ä¹Ÿæ˜¯äºŒçº§ç´¢å¼•ï¼Œæ¯æ¬¡æŸ¥è¯¢éƒ½è¦å›è¡¨\n- ç”±äºç´¢å¼•çš„å¶å­èŠ‚ç‚¹å­˜æ”¾äº†æ•°æ®åœ¨å †è¡¨ä¸­çš„åœ°å€ï¼Œå½“å †è¡¨çš„æ•°æ®å‘ç”Ÿå˜åŒ–ä¸”ä½ç½®å‘ç”Ÿäº†æ”¹å˜ï¼Œé‚£ä¹ˆæ‰€æœ‰ç´¢å¼•ä¸­çš„åœ°å€éƒ½è¦è¿›è¡Œå˜æ›´\n- åªæ”¯æŒè¡¨é”ï¼Œå¹¶å‘æ€§èƒ½å·®\n\nåœ¨**ç´¢å¼•ç»„ç»‡è¡¨**ï¼ˆèšç°‡ç´¢å¼•ï¼ŒInnoDBå­˜å‚¨å¼•æ“å®ç°çš„æ•°æ®ç»„ç»‡æ–¹å¼ï¼‰ä¸­ï¼Œæ•°æ®å’Œç´¢å¼•æ˜¯ä¸€èµ·å­˜å‚¨åœ¨B+æ ‘ä¸­çš„ï¼ŒB+æ ‘å¶å­èŠ‚ç‚¹å­˜æ”¾çš„æ˜¯**ç´¢å¼•+è¡Œè®°å½•**ã€‚\n\nç´¢å¼•å°±æ˜¯æ•°æ®ï¼Œæ•°æ®å°±æ˜¯ç´¢å¼•\n\n- ç´¢å¼•å’Œæ•°æ®ä¿å­˜åœ¨åŒä¸€ä¸ªB+æ ‘ä¸­ï¼Œå› æ­¤ä»èšç°‡ç´¢å¼•ä¸­è·å–æ•°æ®æ¯”éèšç°‡ç´¢å¼•æ›´å¿«\n- åœ¨ç´¢å¼•ç»„ç»‡è¡¨ä¸­ï¼ŒäºŒçº§ç´¢å¼•å…·æœ‰å¤©ç„¶ä¼˜åŠ¿ï¼šè‹¥è®°å½•å‘ç”Ÿäº†æ”¹å˜ï¼Œå…¶ä»–ç´¢å¼•æ— é¡»è¿›è¡Œç»´æŠ¤ï¼Œé™¤éè®°å½•çš„ä¸»é”®å‘ç”Ÿäº†æ”¹å˜\n- æ”¯æŒè¡Œçº§é”ï¼Œå¹¶å‘æ€§èƒ½é«˜\n\n## è”åˆç´¢å¼•\n\naba\n\n## ç´¢å¼•å¤±æ•ˆ\n\n> æœ‰å“ªäº›ç´¢å¼•å¤±æ•ˆçš„åœºæ™¯ï¼Ÿä¸ºä»€ä¹ˆä¼šå¤±æ•ˆï¼Ÿ\n\n- å¯¹ç´¢å¼•ä½¿ç”¨å·¦æˆ–è€…å·¦å³æ¨¡ç³ŠåŒ¹é…\n\n  - B+æ ‘ç´¢å¼•æ˜¯æŒ‰ç…§**ç´¢å¼•å€¼**æœ‰åºæ’åˆ—å­˜å‚¨çš„ï¼Œåªèƒ½æ ¹æ®å‰ç¼€è¿›è¡ŒåŒ¹é…æ¯”è¾ƒ\n\n- å¯¹ç´¢å¼•ä½¿ç”¨å‡½æ•°\n\n  - ç´¢å¼•ä¿å­˜çš„æ˜¯ç´¢å¼•å­—æ®µçš„åŸå§‹å€¼ï¼Œè€Œä¸æ˜¯ç»è¿‡å‡½æ•°è®¡ç®—åçš„ç»“æœï¼Œè‡ªç„¶ä¸èƒ½è¿›è¡Œç´¢å¼•æ¯”è¾ƒ\n\n- å¯¹ç´¢å¼•è¿›è¡Œè¡¨è¾¾å¼è®¡ç®—\n\n  - ç´¢å¼•ä¿å­˜çš„æ˜¯ç´¢å¼•å­—æ®µçš„åŸå§‹å€¼ï¼Œè€Œä¸æ˜¯ç»è¿‡è¡¨è¾¾å¼è®¡ç®—åçš„ç»“æœï¼Œè‡ªç„¶ä¸èƒ½è¿›è¡Œç´¢å¼•æ¯”è¾ƒ\n\n- å¯¹ç´¢å¼•éšå¼ç±»å‹è½¬æ¢\n\n  - MySQLåœ¨é‡åˆ°å­—ç¬¦ä¸²å’Œæ•°å­—æ¯”è¾ƒæ—¶ï¼Œä¼šå…ˆå°†å­—ç¬¦ä¸²è½¬æ¢æˆæ•°å­—ï¼Œå†è¿›è¡Œæ•°å­—æ¯”å¤§å°\n\n  - å¦‚ä¸‹ä¸¤æ¡SQLè¯­å¥ï¼Œç¬¬ä¸€æ¡ç´¢å¼•å¤±æ•ˆï¼Œç¬¬äºŒæ¡ç´¢å¼•æ­£å¸¸å·¥ä½œ\n\n  - ```sql\n    # å…ˆå°†nameè½¬æ¢ä¸ºæ•´å‹æ•°å­—ï¼Œå†è¿›è¡Œæ¯”è¾ƒ\n    select * from users where name = 101010\n    # ç­‰ä»·äº select * from users where cast(name as signed int) = 101010\n    \n    \n    select * from users where id = '1'\n    # ç­‰ä»·äº select * from users where id = cast('1' as signed int)\n    ```\n\n- è”åˆç´¢å¼•éæœ€å·¦åŒ¹é…\n\n  - è”åˆç´¢å¼•æ˜¯å…ˆæŒ‰ç…§ç¬¬ä¸€ä¸ªç´¢å¼•é”®æ’åºï¼Œå†æŒ‰ç…§ç¬¬äºŒä¸ªç´¢å¼•é”®æ’åºï¼Œä»¥æ­¤ç±»æ¨\n\n- whereå­å¥ä¸­çš„or\n\n  - orå‰çš„æ¡ä»¶åˆ—æ˜¯ç´¢å¼•åˆ—ï¼Œè€Œoråçš„æ¡ä»¶åˆ—ä¸æ˜¯ç´¢å¼•åˆ—åˆ™ä¼šå¯¼è‡´ç´¢å¼•å¤±æ•ˆ\n\n## ç´¢å¼•é€‰æ‹©\n\n> MySQLæ•°æ®åº“ä¸­çš„ä¼˜åŒ–å™¨æ˜¯æ€ä¹ˆæ‰§è¡Œçš„ï¼Ÿæ ¹æ®ä»€ä¹ˆæ ‡å‡†é€‰æ‹©ç´¢å¼•çš„ï¼Ÿ\n\n![image-20240916132934153](https://raw.githubusercontent.com/lyydsheep/pic/main/202409161330104.png)\n\nMySQLæ•°æ®åº“ç”±Serverå±‚å’ŒEngineå±‚ç»„æˆï¼š\n\n- Serverå±‚æœ‰SQLåˆ†æå™¨ã€SQLä¼˜åŒ–å™¨ã€SQLæ‰§è¡Œå™¨ï¼Œç”¨äºè´Ÿè´£SQLè¯­å¥çš„å…·ä½“æ‰§è¡Œè¿‡ç¨‹\n- Engineå±‚ç”¨äºå­˜å‚¨å…·ä½“çš„æ•°æ®ï¼Œä¾‹å¦‚InnoDBå¼•æ“ï¼Œè¿˜æœ‰ç”¨äºåœ¨å†…å­˜ä¸­å­˜å‚¨ä¸´æ—¶ç»“æœé›†çš„TempTableå¼•æ“\n\nå…¶ä¸­SQLä¼˜åŒ–å™¨ç”¨äºåˆ†æSQLè¯­å¥åœ¨ä½¿ç”¨ä¸åŒç´¢å¼•æ—¶æ‰€éœ€è¦çš„æˆæœ¬ï¼Œå¹¶é€‰æ‹©æˆæœ¬æœ€å°çš„æ‰§è¡Œè®¡åˆ’ï¼ˆæˆ–å…¨å±€æ‰«æï¼‰ï¼Œä½œä¸ºSQLæœ€ä¼˜æ‰§è¡Œæ–¹æ¡ˆï¼Œè¿™ç§ä¼˜åŒ–å™¨ä¹Ÿå«åšCBOï¼ˆCost-based optimizerï¼‰ä¼˜åŒ–å™¨\n\nåœ¨MySQLä¸­ï¼Œä¸€æ¡SQLçš„è®¡ç®—æˆæœ¬æŒ‰å¦‚ä¸‹å…¬å¼è®¡ç®—ï¼š\n\n```sql\nCost = Server Cost + Engine Cost\n\t = CPU Cost + IO Cost\n```\n\nåŸºäºSQLä¼˜åŒ–å™¨çš„å·¥ä½œåŸç†ï¼Œæœ‰å¦‚ä¸‹å®é™…æ¡ˆä¾‹ç»éªŒï¼š\n\n- ä¸€èˆ¬åªå¯¹**é«˜é€‰æ‹©åº¦çš„å­—æ®µå’Œå­—æ®µç»„åˆ**å»ºç«‹ç´¢å¼•ï¼Œä½é€‰æ‹©åº¦çš„å­—æ®µå¦‚**æ€§åˆ«**ï¼Œä¸åˆ›å»ºç´¢å¼•\n\n- ä½é€‰æ‹©æ€§ï¼Œä½†æ˜¯å­˜åœ¨æ•°æ®å€¾æ–œï¼Œä¾‹å¦‚ä¼˜åŒ–å™¨è®¤ä¸ºPçŠ¶æ€æœ‰1/3ï¼Œå®é™…ä¸ŠPçŠ¶æ€åªæœ‰1/100ï¼Œå¯ä»¥è€ƒè™‘åˆ›å»ºç´¢å¼•\n\n  - é€šè¿‡åˆ›å»ºç›´æ–¹å›¾ï¼Œè®©ä¼˜åŒ–å™¨çŸ¥é“å®é™…çš„æ•°æ®åˆ†å¸ƒ\n\n  - ```sql\n    ANALYZE TABLE orders \n    \n    UPDATE HISTOGRAM ON o_orderstatus;\n    ```\n\n## ç´¢å¼•åº”ç”¨\n\n> å»ºç«‹ç´¢å¼•æœ‰ä»€ä¹ˆä¼˜ç‚¹å’Œç¼ºç‚¹ï¼Ÿ\n>\n> å¦‚ä½•æ­£ç¡®å»ºç«‹ç´¢å¼•ï¼Ÿ\n>\n> å“ªäº›åœºæ™¯ä¸‹é€‚åˆå»ºç«‹ç´¢å¼•ï¼Ÿ\n>\n> å“ªäº›åœºæ™¯ä¸‹ä¸é€‚åˆå»ºç«‹ç´¢å¼•ï¼Ÿ\n\nå¯ä»¥å‚è€ƒ[åŸæ–‡](https://juejin.cn/post/7149074488649318431)\n\n### ä¸€ã€MySQLä¸­å„ç´¢å¼•åˆ†æ\n\n#### 1.1 ä¸ºä»€ä¹ˆé€‰è‡ªå¢Idä½œä¸ºä¸»é”®ï¼Ÿ\n\nåœ¨MySQLè¡¨ä¸­ï¼Œä¸€èˆ¬éƒ½æ˜¯ç”¨**è‡ªå¢Id**ä½œä¸ºä¸»é”®ï¼Œè¿™ç¡®ä¿äº†æ•°æ®çš„å”¯ä¸€æ€§ï¼Œä½†ä¸ºä»€ä¹ˆåˆéœ€è¦**è‡ªå¢**æ€§è´¨ï¼Ÿ\n\nåœ¨InnoDBå­˜å‚¨å¼•æ“ä¸­ï¼Œä¸»é”®ç´¢å¼•ä»¥èšç°‡çš„å½¢å¼**æœ‰åº**å­˜å‚¨ï¼Œå³ç´¢å¼•å³æ•°æ®ã€æ•°æ®å³ç´¢å¼•æŒ‰ç…§ä¸»é”®å¤§å°ä¾æ¬¡æ’åˆ—å­˜å‚¨åœ¨ç£ç›˜ä¸Šã€‚å¦‚æœä½¿ç”¨æ— åºçš„uuidä½œä¸ºä¸»é”®ï¼Œè™½ç„¶uuidä¹Ÿèƒ½ä¿è¯æ•°æ®çš„å”¯ä¸€æ€§ï¼Œä½†æ˜¯å¾ˆæœ‰å¯èƒ½ä¼šç ´ååŸæœ¬çš„æ ‘ç»“æ„\n\nä¸¾ä¸ªä¾‹å­ï¼š\n\nç°è‰²èŠ‚ç‚¹ä½œä¸ºä¸€æ¡æ–°æ•°æ®ï¼Œå¦‚æœæŒ‰ç…§**uuidå¤§å°æ’åˆ—**ï¼Œå®ƒåº”è¯¥æ’å…¥åœ¨ç¬¬äºŒä¸ªä½ç½®ï¼Œé‚£ä¹ˆåç»­èŠ‚ç‚¹éƒ½è¦æŒªåŠ¨ï¼Œæ—¶é—´å¤æ‚åº¦ï¼ˆä¸å°äºï¼‰$$O(n)$$ï¼Œè¿™å°±å¯¼è‡´æ’å…¥æ•°æ®ååˆ†å ç”¨CPUèµ„æºã€‚\n\n![image-20240917114122420](https://raw.githubusercontent.com/lyydsheep/pic/main/202409171141423.png)\n\nä½†ä½¿ç”¨**è‡ªå¢Id**å°±ä¸ä¼šæœ‰è¿™ä¸ªé—®é¢˜ï¼Œæ–°æ¥çš„æ•°æ®ç›´æ¥æ”¾åˆ°æœ€åï¼Œå› æ­¤æ•°æ®è¡¨çš„ä¸»é”®å€¼æœ€å¥½é€‰ç”¨å¸¦æœ‰é¡ºåºæ€§çš„å€¼ã€‚\n\n#### 1.2 è”åˆç´¢å¼•çš„æœ€å·¦åŒ¹é…åŸåˆ™\n\n> æœ€å·¦åŒ¹é…åŸåˆ™å°±æ˜¯æŒ‡åœ¨è”åˆç´¢å¼•ä¸­ï¼Œå¦‚æœä½ çš„ SQL è¯­å¥ä¸­ç”¨åˆ°äº†è”åˆç´¢å¼•ä¸­çš„æœ€å·¦è¾¹çš„ç´¢å¼•ï¼Œé‚£ä¹ˆè¿™æ¡ SQL è¯­å¥å°±å¯ä»¥åˆ©ç”¨è¿™ä¸ªè”åˆç´¢å¼•å»è¿›è¡ŒåŒ¹é…ã€‚\n\nä¸º`id, name, age`è¿™ä¸‰ä¸ªå­—æ®µå»ºç«‹è”åˆç´¢å¼•ï¼Œæ­¤æ—¶ä¸€ä¸ªSQLè¯­å¥å¦‚ä¸‹ï¼š\n\n```sql\nSELECT * FROM users WHERE name = 'lyydsheep' AND age = 1;\n```\n\nè¿™æ¡SQLè¯­å¥æ˜¯ç”¨ä¸ä¸Šè”åˆç´¢å¼•çš„ï¼Œå› ä¸ºæŸ¥è¯¢æ¡ä»¶ä¸­æ²¡æœ‰å‡ºç°**ä»æœ€å·¦ç«¯å¼€å§‹çš„è¿ç»­å­—æ®µ**ã€‚è€Œä¸‹åˆ—è¿™æ¡SQLè¯­å¥å°±èƒ½ä½¿ç”¨ä¸Šè”åˆç´¢å¼•\n\n```sql\nSELECT * FROM users WHERE id = 1 AND name = 'lyydsheep';\n```\n\næ ¹æœ¬åŸå› å°±æ˜¯`id`å­—æ®µæ˜¯**å…¨å±€æœ‰åº**ï¼Œè€Œ`name`ã€`age`å­—æ®µæ˜¯**å±€éƒ¨æœ‰åº**çš„\n\n#### 1.3 å”¯ä¸€ç´¢å¼•çš„å¿«æ…¢é—®é¢˜\n\nå”¯ä¸€ç´¢å¼•ç›¸æ¯”äºæ™®é€šç´¢å¼•çš„ä¼˜åŠ¿å°±åœ¨äºå”¯ä¸€ç´¢å¼•é™å®šäº†å­—æ®µå€¼å¿…é¡»æ˜¯å”¯ä¸€çš„ï¼Œå½“æ‰¾åˆ°ä¸€æ¡æ•°æ®åæ—§ç«‹é©¬åœæ­¢æ£€ç´¢ã€‚è€Œæ™®é€šç´¢å¼•ä»éœ€è¦èµ°å®Œæ•´ä¸ªç´¢å¼•æ ‘ï¼Œå› ä¸ºå¯èƒ½å­˜åœ¨å¤šä¸ªç›¸åŒçš„å­—æ®µå€¼çš„æ•°æ®ã€‚\n\nå”¯ä¸€ç´¢å¼•åœ¨æŸ¥è¯¢æ—¶æ¯”æ™®é€šç´¢å¼•å¿«ä¸Šä¸€æˆªï¼Œä½†æ’å…¥æ•°æ®æ—¶å°±ä¸åŒäº†ï¼Œå› ä¸ºè¦ç¡®ä¿æ•°æ®å”¯ä¸€æ€§ï¼Œæ’å…¥æ•°æ®å‰è¦æ£€å¯Ÿä¸€éè¡¨ä¸­æ˜¯å¦å­˜åœ¨ç›¸åŒçš„æ•°æ®ã€‚æ™®é€šç´¢å¼•å°±æ²¡æœ‰è¿™é¡¾è™‘äº†ï¼Œå› æ­¤æ™®é€šç´¢å¼•æ’å…¥æ•°æ®ä¼šæ›´å¿«ä¸€äº›ã€‚\n\n### äºŒã€å»ºç«‹ç´¢å¼•çš„åŸåˆ™\n\n#### 2.1 åº”è¯¥éµå®ˆçš„åŸåˆ™\n\n- â‘ ç»å¸¸**é¢‘ç¹ç”¨ä½œæŸ¥è¯¢æ¡ä»¶çš„å­—æ®µ**åº”é…Œæƒ…è€ƒè™‘ä¸ºå…¶åˆ›å»ºç´¢å¼•ã€‚\n\n- â‘¡è¡¨çš„**ä¸»å¤–é”®æˆ–è¿è¡¨å­—æ®µ**ï¼Œå¿…é¡»å»ºç«‹ç´¢å¼•ï¼Œå› ä¸ºèƒ½å¾ˆå¤§ç¨‹åº¦æå‡è¿è¡¨æŸ¥è¯¢çš„æ€§èƒ½ã€‚\n\n- â‘¢å»ºç«‹ç´¢å¼•çš„å­—æ®µï¼Œä¸€èˆ¬å€¼çš„**åŒºåˆ†æ€§è¦è¶³å¤Ÿé«˜**ï¼Œè¿™æ ·æ‰èƒ½æé«˜ç´¢å¼•çš„æ£€ç´¢æ•ˆç‡ã€‚\n\n- â‘£å»ºç«‹ç´¢å¼•çš„å­—æ®µï¼Œå€¼ä¸åº”è¯¥è¿‡é•¿ï¼Œå¦‚æœ**è¾ƒé•¿çš„å­—æ®µè¦å»ºç«‹ç´¢å¼•ï¼Œå¯ä»¥é€‰æ‹©å‰ç¼€ç´¢å¼•**ã€‚\n\n- â‘¤å»ºç«‹**è”åˆç´¢å¼•**ï¼Œåº”å½“éµå¾ª**æœ€å·¦å‰ç¼€åŸåˆ™**ï¼Œå°†å¤šä¸ªå­—æ®µä¹‹é—´æŒ‰ä¼˜å…ˆçº§é¡ºåºç»„åˆã€‚\n\n- â‘¥ç»å¸¸æ ¹æ®**èŒƒå›´å–å€¼ã€æ’åºã€åˆ†ç»„çš„å­—æ®µåº”å»ºç«‹ç´¢å¼•**ï¼Œå› ä¸ºç´¢å¼•æœ‰åºï¼Œèƒ½åŠ å¿«æ’åºæ—¶é—´ã€‚\n\n- â‘¦å¯¹äº**å”¯ä¸€ç´¢å¼•**ï¼Œå¦‚æœç¡®è®¤ä¸ä¼šåˆ©ç”¨è¯¥å­—æ®µæ’åºï¼Œé‚£å¯ä»¥å°†**ç»“æ„æ”¹ä¸º`Hash`ç»“æ„**ã€‚\n\n- â‘§å°½é‡ä½¿ç”¨**è”åˆç´¢å¼•ä»£æ›¿å•å€¼ç´¢å¼•**ï¼Œè”åˆç´¢å¼•æ¯”å¤šä¸ªå•å€¼ç´¢å¼•æŸ¥è¯¢æ•ˆç‡è¦é«˜ã€‚\n\n#### 2.2 é¢å¤–çš„æ³¨æ„ç‚¹\n\n- â¶**å€¼ç»å¸¸ä¼šå¢åˆ æ”¹çš„å­—æ®µ**ï¼Œä¸åˆé€‚å»ºç«‹ç´¢å¼•ï¼Œå› ä¸ºæ¯æ¬¡æ”¹å˜åéœ€ç»´æŠ¤ç´¢å¼•ç»“æ„ã€‚\n\n- â·ä¸€ä¸ª**å­—æ®µå­˜åœ¨å¤§é‡çš„é‡å¤å€¼**æ—¶ï¼Œä¸é€‚åˆå»ºç«‹ç´¢å¼•ï¼Œæ¯”å¦‚ä¹‹å‰ä¸¾ä¾‹çš„æ€§åˆ«å­—æ®µã€‚\n\n- â¸ç´¢å¼•**ä¸èƒ½å‚ä¸è®¡ç®—**ï¼Œå› æ­¤ç»å¸¸**å¸¦å‡½æ•°æŸ¥è¯¢**çš„å­—æ®µï¼Œå¹¶ä¸é€‚åˆå»ºç«‹ç´¢å¼•ã€‚\n\n- â¹ä¸€å¼ è¡¨ä¸­çš„ç´¢å¼•**æ•°é‡å¹¶ä¸æ˜¯è¶Šå¤šè¶Šå¥½**ï¼Œä¸€èˆ¬æ§åˆ¶åœ¨`3`ï¼Œæœ€å¤šä¸èƒ½è¶…è¿‡`5`ã€‚\n\n- âºå»ºç«‹è”åˆç´¢å¼•æ—¶ï¼Œä¸€å®šè¦è€ƒè™‘ä¼˜å…ˆçº§ï¼ŒæŸ¥è¯¢é¢‘ç‡æœ€é«˜çš„å­—æ®µåº”å½“æ”¾é¦–ä½ã€‚\n\n- â»**å½“è¡¨çš„æ•°æ®è¾ƒå°‘ï¼Œä¸åº”å½“å»ºç«‹ç´¢å¼•**ï¼Œå› ä¸ºæ•°æ®é‡ä¸å¤§æ—¶ï¼Œç»´æŠ¤ç´¢å¼•åè€Œå¼€é”€æ›´å¤§ã€‚\n\n- â¼ç´¢å¼•çš„**å­—æ®µå€¼æ— åºæ—¶**ï¼Œä¸æ¨èå»ºç«‹ç´¢å¼•ï¼Œå› ä¸ºä¼šé€ æˆé¡µåˆ†è£‚ï¼Œå°¤å…¶æ˜¯ä¸»é”®ç´¢å¼•ã€‚\n\n## ç´¢å¼•å¸¸è§è€ƒé¢˜\n\nå‚è€ƒ[åŸæ–‡](https://xiaolincoding.com/mysql/index/index_interview.html)\n\n### ç´¢å¼•çš„åˆ†ç±»\n\nä»å››ä¸ªè§’åº¦å¯¹ç´¢å¼•è¿›è¡Œåˆ†ç±»ï¼š\n\n- ä»¥**æ•°æ®ç»“æ„**åˆ†ç±»ï¼š<font color=\"blue\">B+æ ‘ç´¢å¼•ã€Hashç´¢å¼•ã€Full-textç´¢å¼•</font>\n- ä»¥**ç‰©ç†å­˜å‚¨**åˆ†ç±»ï¼š<font color=\"blue\">èšç°‡ç´¢å¼•ã€äºŒçº§ç´¢å¼•</font>\n- ä»¥**å­—æ®µç‰¹æ€§**åˆ†ç±»ï¼š<font color=\"blue\">ä¸»é”®ç´¢å¼•ã€å”¯ä¸€ç´¢å¼•ã€æ™®é€šç´¢å¼•ã€å‰ç¼€ç´¢å¼•</font>\n- ä»¥å­—æ®µä¸ªæ•°åˆ†ç±»ï¼š<font color=\"blue\">å•åˆ—ç´¢å¼•ã€è”åˆç´¢å¼•</font>\n\n#### æŒ‰æ•°æ®ç»“æ„åˆ†ç±»\n\nä¸åŒçš„å­˜å‚¨å¼•æ“æ‰€æ”¯æŒçš„ç´¢å¼•ç±»å‹ä¸åŒï¼Œå…·ä½“å¦‚ä¸‹å›¾\n\n![image-20240918142021754](https://raw.githubusercontent.com/lyydsheep/pic/main/202409181420334.png)\n\n#### æŒ‰ç‰©ç†å­˜å‚¨åˆ†ç±»\n\n- èšç°‡ç´¢å¼•çš„B+æ ‘å¶å­èŠ‚ç‚¹å­˜æ”¾çš„æ˜¯å®é™…æ•°æ®ï¼ŒåŒ…å«äº†æ•°æ®è¡Œæ‰€æœ‰å­—æ®µçš„æ•°æ®\n- äºŒçº§ç´¢å¼•çš„B+æ ‘å¶å­èŠ‚ç‚¹å­˜æ”¾çš„æ˜¯ä¸»é”®å€¼ï¼Œå¹¶éå®é™…æ•°æ®ã€‚å› æ­¤ï¼Œå¦‚æœæ‰€æŸ¥è¯¢æ•°æ®ä¸äºŒçº§ç´¢å¼•å¶å­èŠ‚ç‚¹ä¸­ï¼Œé‚£ä¹ˆéœ€è¦å†è¿›è¡Œä¸€æ¬¡**å›è¡¨**æ“ä½œï¼›åä¹‹åˆ™æ˜¯**ç´¢å¼•è¦†ç›–**\n\n#### æŒ‰å­—æ®µç‰¹æ€§åˆ†ç±»\n\n**ä¸»é”®ç´¢å¼•**\n\nå»ºç«‹åœ¨ä¸»é”®ä¹‹ä¸Šçš„ç´¢å¼•ï¼Œä¸€èˆ¬åœ¨å»ºè¡¨æ—¶åˆ›å»ºï¼Œä¸€å¼ è¡¨æœ€å¤šåªèƒ½æœ‰ä¸€ä¸ªä¸»é”®ç´¢å¼•ï¼Œå¹¶ä¸”ä¸»é”®å­—æ®µä¸å…è®¸æœ‰`NULL`å€¼\n\nå¦‚æœæ²¡æœ‰æŒ‡æ˜ä¸»é”®ï¼Œåˆ™ç³»ç»Ÿä¼šæŒ‰ç…§ä¸€ä¸‹è§„åˆ™æŒ‘é€‰å¹¶åˆ›å»ºä¸»é”®ç´¢å¼•\n\n- é€‰æ‹©ç¬¬ä¸€ä¸ªä¸åŒ…å«`NULL`å€¼çš„**å”¯ä¸€åˆ—**ä½œä¸ºä¸»é”®åˆ—\n- ä¸‹ä¸‹ç­–ï¼ŒInnoDBè‡ªåŠ¨ç”Ÿæˆä¸€ä¸ªè‡ªå¢çš„éšè—idåˆ—ä½œä¸ºèšç°‡ç´¢å¼•çš„ç´¢å¼•é”®\n\nå»ºè¡¨æ—¶ï¼Œåˆ›å»ºä¸»é”®ç´¢å¼•çš„æ–¹å¼å¦‚ä¸‹ï¼š\n\n```sql\nCREATE TABLE table_name (\n    ...\n    PRIMARY KEY (column_name) USING BTREE\n)\n```\n\n**å”¯ä¸€ç´¢å¼•**\n\nå»ºç«‹åœ¨UNIQUEå­—æ®µä¸Šçš„ç´¢å¼•ï¼Œä¸€å¼ è¡¨å¯ä»¥æœ‰å¤šä¸ªå”¯ä¸€ç´¢å¼•ï¼Œä½†æ˜¯ç´¢å¼•é”®å€¼å¿…é¡»å”¯ä¸€ï¼Œå…è®¸æœ‰`NULL`å€¼\n\nå»ºè¡¨æ—¶ï¼Œåˆ›å»ºå”¯ä¸€ç´¢å¼•çš„æ–¹å¼å¦‚ä¸‹ï¼š\n\n```sql\nCREATE TABLE table_name(\n    ...\n    UNIQUE KEY(column1, column2...)\n)\n```\n\nå»ºè¡¨åï¼Œåˆ›å»ºå”¯ä¸€ç´¢å¼•çš„æ–¹å¼å¦‚ä¸‹ï¼š\n\n```sql\nCREATE UNIQUE INDEX idx_name ON table_name(column1, column2...)\n```\n\n**å‰ç¼€ç´¢å¼•**\n\nä»¥å­—ç¬¦ç±»å‹å­—æ®µçš„å‰ç¼€ä¸ºé”®å€¼å»ºç«‹ç´¢å¼•ï¼Œä¸»è¦ç›®çš„æ˜¯ä¸ºäº†å‡å°‘å­˜å‚¨ç©ºé—´ï¼Œä¼˜åŒ–æŸ¥è¯¢æ•ˆç‡ï¼Œå¯ä»¥ç”¨åœ¨å­—ç¬¦ç±»å‹ä¸º`char`ã€`varchat`ã€`binary`ã€`varbinary`çš„åˆ—ä¸Š\n\nå»ºè¡¨æ—¶ï¼Œåˆ›å»ºå‰ç¼€ç´¢å¼•çš„æ–¹å¼å¦‚ä¸‹ï¼š\n\n```sql\nCREATE TABLE table_name(\n    ...\n    INDEX(column1(length))\n)\n```\n\nå»ºè¡¨åï¼Œåˆ›å»ºå‰ç¼€ç´¢å¼•çš„æ–¹å¼å¦‚ä¸‹ :\n\n```sql\nCREATE INDEX idx_name ON table_name (column1(length))\n```\n\n#### æŒ‰å­—æ®µä¸ªæ•°åˆ†ç±»\n\nä¸»è¦ä»‹ç»è”åˆç´¢å¼•çš„å‡ ä¸ªç‰¹ç‚¹\n\n- èŒƒå›´æŸ¥è¯¢\n  - è”åˆç´¢å¼•çš„æœ€å·¦åŒ¹é…ï¼Œåœ¨é‡åˆ°èŒƒå›´æŸ¥è¯¢ï¼ˆ>ã€<ï¼‰æ—¶ï¼Œå°±ä¼šåœæ­¢åŒ¹é…ã€‚ä¹Ÿå°±æ˜¯è¯´ï¼ŒèŒƒå›´æŸ¥è¯¢çš„å­—æ®µä¼šç”¨åˆ°è”åˆç´¢å¼•ï¼Œä½†ä¹‹åçš„å­—æ®µä¸ä¼šä½¿ç”¨è”åˆç´¢å¼•\n  - å€¼å¾—æ³¨æ„çš„æ˜¯ï¼Œå¯¹äº`>=`ã€`<=`ã€`between xxx and`ã€`like`è¿™ç±»å«æœ‰ç›¸ç­‰æ„ä¹‰çš„èŒƒå›´æŸ¥è¯¢ï¼Œä¸ä¼šç«‹åˆ»åœæ­¢åŒ¹é…ï¼Œå³å†èŒƒå›´æŸ¥è¯¢ä¹‹åçš„å­—æ®µä»ä¼šç”¨ä¸Šè”åˆç´¢å¼•ï¼Œä½†åªé’ˆå¯¹éƒ¨åˆ†æ•°æ®\n- ç´¢å¼•ä¸‹æ¨\n  - MySQL 5.6 å¼•å…¥ç´¢å¼•ä¸‹æ¨ä¼˜åŒ–ï¼Œå¯ä»¥åœ¨è”åˆç´¢å¼•éå†è¿‡ç¨‹ä¸­ï¼Œåˆ©ç”¨è”åˆç´¢å¼•ä¸­æœªç”¨ä¸Šçš„æŸ¥è¯¢æ¡ä»¶å¯¹æ•°æ®è¿›è¡Œè¿‡æ»¤ï¼Œå‡å°‘å›è¡¨æ¬¡æ•°\n- ç´¢å¼•åŒºåˆ†åº¦\n  - åœ¨å»ºç«‹è”åˆç´¢å¼•æ—¶ï¼Œè¦å°½å¯èƒ½ æŠŠåŒºåˆ†åº¦å¤§çš„å­—æ®µæ”¾åœ¨å‰é¢ï¼Œè¿™æ ·è”åˆç´¢å¼•è¢«SQLç”¨åˆ°çš„æ¦‚ç‡æ›´å¤§\n- ç”¨äºæ’åº\n  - å‡å°‘`Using filesort`çš„æ¬¡æ•°\n\n### ä¼˜åŒ–ç´¢å¼•çš„æ–¹æ³•\n\n- å‰ç¼€ç´¢å¼•ä¼˜åŒ–\n  - ä½¿ç”¨å‰ç¼€ç´¢å¼•å¯ä»¥å‡å°ç´¢å¼•å­—æ®µçš„å¤§å°ï¼Œå¢åŠ ä¸€ä¸ªç´¢å¼•é¡µä¸­å­˜å‚¨çš„æ•°æ®é‡ï¼Œæœ‰æ•ˆæé«˜ç´¢å¼•æŸ¥è¯¢çš„æ•ˆç‡\n- è¦†ç›–ç´¢å¼•ä¼˜åŒ–\n  - å°†æ‰€è¦æŸ¥è¯¢çš„å­—æ®µå»ºç«‹æˆè”åˆç´¢å¼•ï¼Œåœ¨SQLæŸ¥è¯¢è¿‡ç¨‹ä¸­å°±èƒ½åœ¨äºŒçº§ç´¢å¼•B+æ ‘çš„å¶å­èŠ‚ç‚¹ä¸Šæ‰¾åˆ°æ‰€éœ€è¦çš„å…¨éƒ¨æ•°æ®ï¼Œè€Œä¸éœ€è¦å†é€šè¿‡èšç°‡ç´¢å¼•æŸ¥è¯¢è·å¾—ï¼Œå‡å°‘å›è¡¨çš„æ“ä½œ\n- ä¸»é”®ç´¢å¼•æœ€å¥½æ˜¯è‡ªå¢çš„\n  - æ’å…¥ä¸€æ¡æ•°æ®éƒ½æ˜¯è¿½åŠ æ“ä½œï¼Œä¸éœ€è¦ç§»åŠ¨æ•°æ®ï¼Œé¿å…äº†é¡µåˆ†è£‚å¸¦æ¥çš„æ€§èƒ½æ¶ˆè€—å’Œå¤§é‡çš„å†…å­˜ç¢ç‰‡\n  - ç´¢å¼•å­—æ®µä¸å®œè¿‡é•¿ï¼Œå‡å°‘äºŒçº§ç´¢å¼•çš„å­˜å‚¨ç©ºé—´\n- ç´¢å¼•æœ€å¥½è®¾ç½®ä¸º`NOT NULL`\n  - ç´¢å¼•åˆ—å­˜åœ¨`NULL`å€¼ä¼šåŠ é‡ç´¢å¼•é€‰æ‹©çš„è´Ÿæ‹…\n  - å‡å°‘ç‰©ç†å­˜å‚¨ç©ºé—´ï¼Œå¦‚æœè¡¨ä¸­å­˜åœ¨å…è®¸ä¸º`NULL`çš„å­—æ®µï¼Œé‚£ä¹ˆè¡Œæ ¼å¼ä¸­è‡³å°‘ä¼šå ç”¨1å­—èŠ‚ç©ºé—´å­˜å‚¨`NULL`å€¼åˆ—è¡¨\n- é˜²æ­¢ç´¢å¼•å¤±æ•ˆ\n","source":"_posts/MySQL/MySQLç´¢å¼•å­¦ä¹ .md","raw":"---\npublish: true\ntag: MySQL\nsticky: 2\ndate: 2024-09-19 18:29:00\n---\n\n# MySQLç´¢å¼•å­¦ä¹ \n\n## ç´¢å¼•æ•°æ®ç»“æ„\n\n> ä»€ä¹ˆæ˜¯ç´¢å¼•ï¼Ÿä¸ºä»€ä¹ˆç´¢å¼•èƒ½åŠ å¿«æŸ¥è¯¢ï¼Ÿ\n>\n> ç´¢å¼•çš„æ•°æ®ç»“æ„æ˜¯ä»€ä¹ˆï¼Ÿ\n>\n> B+æ ‘å’ŒBæ ‘ã€çº¢é»‘æ ‘æœ‰ä»€ä¹ˆåŒºåˆ«ï¼Ÿä¸ºä»€ä¹ˆä½¿ç”¨B+æ ‘ï¼Ÿ\n\nç´¢å¼•æ˜¯ä¸€ç§æ’å¥½åºçš„å¿«é€ŸæŸ¥æ‰¾çš„æ•°æ®ç»“æ„ã€‚åœ¨ç´¢å¼•ä¸ŠæŸ¥æ‰¾æ•°æ®çš„è¿‡ç¨‹å¯ä»¥ç±»æ¯”åœ¨äºŒå‰æœç´¢æ ‘ä¸Šè¿›è¡Œæ•°æ®æŸ¥è¯¢ï¼Œå¯ä»¥æ ¹æ®æ•°æ®çš„å¤§å°å…³ç³»çœç•¥å¯¹ä¸€äº›æ•°æ®çš„æŸ¥è¯¢æ“ä½œï¼Œä»è€Œ**å‡å°‘ç£ç›˜I/Oçš„æ¬¡æ•°**ï¼ŒåŠ å¿«æŸ¥è¯¢æ•ˆç‡ã€‚\n\nç´¢å¼•çš„å…·ä½“å®ç°ç”±**åº•å±‚çš„å­˜å‚¨å¼•æ“å†³å®š**ï¼Œä¾‹å¦‚åœ¨InnoDBå­˜å‚¨å¼•æ“ä¸‹ï¼Œç´¢å¼•æ˜¯ç”±B+æ ‘å®ç°çš„ã€‚\n\nBæ ‘å’ŒB+æ ‘éƒ½æ˜¯é€šè¿‡å¤šå‰æ ‘çš„å½¢å¼ï¼Œå°†æ ‘çš„é«˜åº¦é™ä½ï¼Œä»¥æ­¤å‡å°‘ç£ç›˜I/Oçš„æ¬¡æ•°ã€‚ä½†è¾ƒäºBæ ‘ï¼ŒB+æ ‘æœ‰ä»¥ä¸‹ä¼˜ç‚¹ï¼š\n\n- B+çš„æ ‘**éå¶å­èŠ‚ç‚¹ä¸å­˜æ”¾æ•°æ®åªå­˜æ”¾ç´¢å¼•**ï¼Œè€ŒBæ ‘çš„å†…èŠ‚ç‚¹æ—¢å­˜æ•°æ®åˆå­˜ç´¢å¼•ã€‚å› æ­¤æ•°æ®é‡ç›¸åŒçš„æƒ…å†µä¸‹ï¼ŒB+æ ‘çš„å†…èŠ‚ç‚¹å¯ä»¥å­˜æ”¾æ›´å¤šçš„ç´¢å¼•ï¼Œè¿™ä½¿å¾—B+æ ‘å¯ä»¥æ¯”Bæ ‘æ›´â€œçŸ®èƒ–â€ï¼ŒæŸ¥è¯¢åº•å±‚èŠ‚ç‚¹æ—¶ç£ç›˜I/Oæ¬¡æ•°æ›´å°‘\n- B+æ ‘**æœ‰å¤§é‡çš„å†—ä½™èŠ‚ç‚¹**ï¼ˆæ‰€æœ‰éå¶å­èŠ‚ç‚¹éƒ½æ˜¯å†—ä½™èŠ‚ç‚¹ï¼‰ï¼Œè¿™äº›å†—ä½™èŠ‚ç‚¹ä½¿å¾—B+æ ‘åœ¨æ’å…¥ã€åˆ é™¤çš„æƒ…å†µä¸‹ï¼Œæ ‘å½¢å˜åŒ–ä¸å¤§ï¼Œæ•ˆç‡æ›´é«˜\n- B+æ ‘çš„å¶å­èŠ‚ç‚¹ä¹‹é—´é€šè¿‡**é“¾è¡¨ç›¸äº’è¿æ¥**ï¼Œæœ‰åˆ©äºèŒƒå›´æŸ¥è¯¢\n\n\n\n## ç´¢å¼•å­˜å‚¨\n\n> å †è¡¨å’Œç´¢å¼•ç»„ç»‡æœ‰ä»€ä¹ˆåŒºåˆ«ï¼Ÿåˆ†åˆ«åº”ç”¨åœºæ™¯æ˜¯ä»€ä¹ˆï¼Ÿ\n\nåœ¨**å †è¡¨**çš„ç»„ç»‡ä¸­ï¼Œ**æ•°æ®å’Œç´¢å¼•æ˜¯åˆ†å¼€å­˜å‚¨çš„**ï¼ŒB+æ ‘å¶å­èŠ‚ç‚¹å­˜æ”¾çš„æ˜¯**ç´¢å¼•+æ•°æ®çš„åœ°å€ï¼Œåœ°å€æŒ‡å‘å †è¡¨ä¸­çš„æ•°æ®**ã€‚ç´¢å¼•æ˜¯æ’åºåçš„æ•°æ®ï¼Œè€Œå †è¡¨ä¸­çš„æ•°æ®æ˜¯æ— åºçš„\n\n- å †è¡¨ä¸­çš„ç´¢å¼•**éƒ½æ˜¯äºŒçº§ç´¢å¼•**ï¼Œå³ä½¿æ˜¯ä¸»é”®ç´¢å¼•ä¹Ÿæ˜¯äºŒçº§ç´¢å¼•ï¼Œæ¯æ¬¡æŸ¥è¯¢éƒ½è¦å›è¡¨\n- ç”±äºç´¢å¼•çš„å¶å­èŠ‚ç‚¹å­˜æ”¾äº†æ•°æ®åœ¨å †è¡¨ä¸­çš„åœ°å€ï¼Œå½“å †è¡¨çš„æ•°æ®å‘ç”Ÿå˜åŒ–ä¸”ä½ç½®å‘ç”Ÿäº†æ”¹å˜ï¼Œé‚£ä¹ˆæ‰€æœ‰ç´¢å¼•ä¸­çš„åœ°å€éƒ½è¦è¿›è¡Œå˜æ›´\n- åªæ”¯æŒè¡¨é”ï¼Œå¹¶å‘æ€§èƒ½å·®\n\nåœ¨**ç´¢å¼•ç»„ç»‡è¡¨**ï¼ˆèšç°‡ç´¢å¼•ï¼ŒInnoDBå­˜å‚¨å¼•æ“å®ç°çš„æ•°æ®ç»„ç»‡æ–¹å¼ï¼‰ä¸­ï¼Œæ•°æ®å’Œç´¢å¼•æ˜¯ä¸€èµ·å­˜å‚¨åœ¨B+æ ‘ä¸­çš„ï¼ŒB+æ ‘å¶å­èŠ‚ç‚¹å­˜æ”¾çš„æ˜¯**ç´¢å¼•+è¡Œè®°å½•**ã€‚\n\nç´¢å¼•å°±æ˜¯æ•°æ®ï¼Œæ•°æ®å°±æ˜¯ç´¢å¼•\n\n- ç´¢å¼•å’Œæ•°æ®ä¿å­˜åœ¨åŒä¸€ä¸ªB+æ ‘ä¸­ï¼Œå› æ­¤ä»èšç°‡ç´¢å¼•ä¸­è·å–æ•°æ®æ¯”éèšç°‡ç´¢å¼•æ›´å¿«\n- åœ¨ç´¢å¼•ç»„ç»‡è¡¨ä¸­ï¼ŒäºŒçº§ç´¢å¼•å…·æœ‰å¤©ç„¶ä¼˜åŠ¿ï¼šè‹¥è®°å½•å‘ç”Ÿäº†æ”¹å˜ï¼Œå…¶ä»–ç´¢å¼•æ— é¡»è¿›è¡Œç»´æŠ¤ï¼Œé™¤éè®°å½•çš„ä¸»é”®å‘ç”Ÿäº†æ”¹å˜\n- æ”¯æŒè¡Œçº§é”ï¼Œå¹¶å‘æ€§èƒ½é«˜\n\n## è”åˆç´¢å¼•\n\naba\n\n## ç´¢å¼•å¤±æ•ˆ\n\n> æœ‰å“ªäº›ç´¢å¼•å¤±æ•ˆçš„åœºæ™¯ï¼Ÿä¸ºä»€ä¹ˆä¼šå¤±æ•ˆï¼Ÿ\n\n- å¯¹ç´¢å¼•ä½¿ç”¨å·¦æˆ–è€…å·¦å³æ¨¡ç³ŠåŒ¹é…\n\n  - B+æ ‘ç´¢å¼•æ˜¯æŒ‰ç…§**ç´¢å¼•å€¼**æœ‰åºæ’åˆ—å­˜å‚¨çš„ï¼Œåªèƒ½æ ¹æ®å‰ç¼€è¿›è¡ŒåŒ¹é…æ¯”è¾ƒ\n\n- å¯¹ç´¢å¼•ä½¿ç”¨å‡½æ•°\n\n  - ç´¢å¼•ä¿å­˜çš„æ˜¯ç´¢å¼•å­—æ®µçš„åŸå§‹å€¼ï¼Œè€Œä¸æ˜¯ç»è¿‡å‡½æ•°è®¡ç®—åçš„ç»“æœï¼Œè‡ªç„¶ä¸èƒ½è¿›è¡Œç´¢å¼•æ¯”è¾ƒ\n\n- å¯¹ç´¢å¼•è¿›è¡Œè¡¨è¾¾å¼è®¡ç®—\n\n  - ç´¢å¼•ä¿å­˜çš„æ˜¯ç´¢å¼•å­—æ®µçš„åŸå§‹å€¼ï¼Œè€Œä¸æ˜¯ç»è¿‡è¡¨è¾¾å¼è®¡ç®—åçš„ç»“æœï¼Œè‡ªç„¶ä¸èƒ½è¿›è¡Œç´¢å¼•æ¯”è¾ƒ\n\n- å¯¹ç´¢å¼•éšå¼ç±»å‹è½¬æ¢\n\n  - MySQLåœ¨é‡åˆ°å­—ç¬¦ä¸²å’Œæ•°å­—æ¯”è¾ƒæ—¶ï¼Œä¼šå…ˆå°†å­—ç¬¦ä¸²è½¬æ¢æˆæ•°å­—ï¼Œå†è¿›è¡Œæ•°å­—æ¯”å¤§å°\n\n  - å¦‚ä¸‹ä¸¤æ¡SQLè¯­å¥ï¼Œç¬¬ä¸€æ¡ç´¢å¼•å¤±æ•ˆï¼Œç¬¬äºŒæ¡ç´¢å¼•æ­£å¸¸å·¥ä½œ\n\n  - ```sql\n    # å…ˆå°†nameè½¬æ¢ä¸ºæ•´å‹æ•°å­—ï¼Œå†è¿›è¡Œæ¯”è¾ƒ\n    select * from users where name = 101010\n    # ç­‰ä»·äº select * from users where cast(name as signed int) = 101010\n    \n    \n    select * from users where id = '1'\n    # ç­‰ä»·äº select * from users where id = cast('1' as signed int)\n    ```\n\n- è”åˆç´¢å¼•éæœ€å·¦åŒ¹é…\n\n  - è”åˆç´¢å¼•æ˜¯å…ˆæŒ‰ç…§ç¬¬ä¸€ä¸ªç´¢å¼•é”®æ’åºï¼Œå†æŒ‰ç…§ç¬¬äºŒä¸ªç´¢å¼•é”®æ’åºï¼Œä»¥æ­¤ç±»æ¨\n\n- whereå­å¥ä¸­çš„or\n\n  - orå‰çš„æ¡ä»¶åˆ—æ˜¯ç´¢å¼•åˆ—ï¼Œè€Œoråçš„æ¡ä»¶åˆ—ä¸æ˜¯ç´¢å¼•åˆ—åˆ™ä¼šå¯¼è‡´ç´¢å¼•å¤±æ•ˆ\n\n## ç´¢å¼•é€‰æ‹©\n\n> MySQLæ•°æ®åº“ä¸­çš„ä¼˜åŒ–å™¨æ˜¯æ€ä¹ˆæ‰§è¡Œçš„ï¼Ÿæ ¹æ®ä»€ä¹ˆæ ‡å‡†é€‰æ‹©ç´¢å¼•çš„ï¼Ÿ\n\n![image-20240916132934153](https://raw.githubusercontent.com/lyydsheep/pic/main/202409161330104.png)\n\nMySQLæ•°æ®åº“ç”±Serverå±‚å’ŒEngineå±‚ç»„æˆï¼š\n\n- Serverå±‚æœ‰SQLåˆ†æå™¨ã€SQLä¼˜åŒ–å™¨ã€SQLæ‰§è¡Œå™¨ï¼Œç”¨äºè´Ÿè´£SQLè¯­å¥çš„å…·ä½“æ‰§è¡Œè¿‡ç¨‹\n- Engineå±‚ç”¨äºå­˜å‚¨å…·ä½“çš„æ•°æ®ï¼Œä¾‹å¦‚InnoDBå¼•æ“ï¼Œè¿˜æœ‰ç”¨äºåœ¨å†…å­˜ä¸­å­˜å‚¨ä¸´æ—¶ç»“æœé›†çš„TempTableå¼•æ“\n\nå…¶ä¸­SQLä¼˜åŒ–å™¨ç”¨äºåˆ†æSQLè¯­å¥åœ¨ä½¿ç”¨ä¸åŒç´¢å¼•æ—¶æ‰€éœ€è¦çš„æˆæœ¬ï¼Œå¹¶é€‰æ‹©æˆæœ¬æœ€å°çš„æ‰§è¡Œè®¡åˆ’ï¼ˆæˆ–å…¨å±€æ‰«æï¼‰ï¼Œä½œä¸ºSQLæœ€ä¼˜æ‰§è¡Œæ–¹æ¡ˆï¼Œè¿™ç§ä¼˜åŒ–å™¨ä¹Ÿå«åšCBOï¼ˆCost-based optimizerï¼‰ä¼˜åŒ–å™¨\n\nåœ¨MySQLä¸­ï¼Œä¸€æ¡SQLçš„è®¡ç®—æˆæœ¬æŒ‰å¦‚ä¸‹å…¬å¼è®¡ç®—ï¼š\n\n```sql\nCost = Server Cost + Engine Cost\n\t = CPU Cost + IO Cost\n```\n\nåŸºäºSQLä¼˜åŒ–å™¨çš„å·¥ä½œåŸç†ï¼Œæœ‰å¦‚ä¸‹å®é™…æ¡ˆä¾‹ç»éªŒï¼š\n\n- ä¸€èˆ¬åªå¯¹**é«˜é€‰æ‹©åº¦çš„å­—æ®µå’Œå­—æ®µç»„åˆ**å»ºç«‹ç´¢å¼•ï¼Œä½é€‰æ‹©åº¦çš„å­—æ®µå¦‚**æ€§åˆ«**ï¼Œä¸åˆ›å»ºç´¢å¼•\n\n- ä½é€‰æ‹©æ€§ï¼Œä½†æ˜¯å­˜åœ¨æ•°æ®å€¾æ–œï¼Œä¾‹å¦‚ä¼˜åŒ–å™¨è®¤ä¸ºPçŠ¶æ€æœ‰1/3ï¼Œå®é™…ä¸ŠPçŠ¶æ€åªæœ‰1/100ï¼Œå¯ä»¥è€ƒè™‘åˆ›å»ºç´¢å¼•\n\n  - é€šè¿‡åˆ›å»ºç›´æ–¹å›¾ï¼Œè®©ä¼˜åŒ–å™¨çŸ¥é“å®é™…çš„æ•°æ®åˆ†å¸ƒ\n\n  - ```sql\n    ANALYZE TABLE orders \n    \n    UPDATE HISTOGRAM ON o_orderstatus;\n    ```\n\n## ç´¢å¼•åº”ç”¨\n\n> å»ºç«‹ç´¢å¼•æœ‰ä»€ä¹ˆä¼˜ç‚¹å’Œç¼ºç‚¹ï¼Ÿ\n>\n> å¦‚ä½•æ­£ç¡®å»ºç«‹ç´¢å¼•ï¼Ÿ\n>\n> å“ªäº›åœºæ™¯ä¸‹é€‚åˆå»ºç«‹ç´¢å¼•ï¼Ÿ\n>\n> å“ªäº›åœºæ™¯ä¸‹ä¸é€‚åˆå»ºç«‹ç´¢å¼•ï¼Ÿ\n\nå¯ä»¥å‚è€ƒ[åŸæ–‡](https://juejin.cn/post/7149074488649318431)\n\n### ä¸€ã€MySQLä¸­å„ç´¢å¼•åˆ†æ\n\n#### 1.1 ä¸ºä»€ä¹ˆé€‰è‡ªå¢Idä½œä¸ºä¸»é”®ï¼Ÿ\n\nåœ¨MySQLè¡¨ä¸­ï¼Œä¸€èˆ¬éƒ½æ˜¯ç”¨**è‡ªå¢Id**ä½œä¸ºä¸»é”®ï¼Œè¿™ç¡®ä¿äº†æ•°æ®çš„å”¯ä¸€æ€§ï¼Œä½†ä¸ºä»€ä¹ˆåˆéœ€è¦**è‡ªå¢**æ€§è´¨ï¼Ÿ\n\nåœ¨InnoDBå­˜å‚¨å¼•æ“ä¸­ï¼Œä¸»é”®ç´¢å¼•ä»¥èšç°‡çš„å½¢å¼**æœ‰åº**å­˜å‚¨ï¼Œå³ç´¢å¼•å³æ•°æ®ã€æ•°æ®å³ç´¢å¼•æŒ‰ç…§ä¸»é”®å¤§å°ä¾æ¬¡æ’åˆ—å­˜å‚¨åœ¨ç£ç›˜ä¸Šã€‚å¦‚æœä½¿ç”¨æ— åºçš„uuidä½œä¸ºä¸»é”®ï¼Œè™½ç„¶uuidä¹Ÿèƒ½ä¿è¯æ•°æ®çš„å”¯ä¸€æ€§ï¼Œä½†æ˜¯å¾ˆæœ‰å¯èƒ½ä¼šç ´ååŸæœ¬çš„æ ‘ç»“æ„\n\nä¸¾ä¸ªä¾‹å­ï¼š\n\nç°è‰²èŠ‚ç‚¹ä½œä¸ºä¸€æ¡æ–°æ•°æ®ï¼Œå¦‚æœæŒ‰ç…§**uuidå¤§å°æ’åˆ—**ï¼Œå®ƒåº”è¯¥æ’å…¥åœ¨ç¬¬äºŒä¸ªä½ç½®ï¼Œé‚£ä¹ˆåç»­èŠ‚ç‚¹éƒ½è¦æŒªåŠ¨ï¼Œæ—¶é—´å¤æ‚åº¦ï¼ˆä¸å°äºï¼‰$$O(n)$$ï¼Œè¿™å°±å¯¼è‡´æ’å…¥æ•°æ®ååˆ†å ç”¨CPUèµ„æºã€‚\n\n![image-20240917114122420](https://raw.githubusercontent.com/lyydsheep/pic/main/202409171141423.png)\n\nä½†ä½¿ç”¨**è‡ªå¢Id**å°±ä¸ä¼šæœ‰è¿™ä¸ªé—®é¢˜ï¼Œæ–°æ¥çš„æ•°æ®ç›´æ¥æ”¾åˆ°æœ€åï¼Œå› æ­¤æ•°æ®è¡¨çš„ä¸»é”®å€¼æœ€å¥½é€‰ç”¨å¸¦æœ‰é¡ºåºæ€§çš„å€¼ã€‚\n\n#### 1.2 è”åˆç´¢å¼•çš„æœ€å·¦åŒ¹é…åŸåˆ™\n\n> æœ€å·¦åŒ¹é…åŸåˆ™å°±æ˜¯æŒ‡åœ¨è”åˆç´¢å¼•ä¸­ï¼Œå¦‚æœä½ çš„ SQL è¯­å¥ä¸­ç”¨åˆ°äº†è”åˆç´¢å¼•ä¸­çš„æœ€å·¦è¾¹çš„ç´¢å¼•ï¼Œé‚£ä¹ˆè¿™æ¡ SQL è¯­å¥å°±å¯ä»¥åˆ©ç”¨è¿™ä¸ªè”åˆç´¢å¼•å»è¿›è¡ŒåŒ¹é…ã€‚\n\nä¸º`id, name, age`è¿™ä¸‰ä¸ªå­—æ®µå»ºç«‹è”åˆç´¢å¼•ï¼Œæ­¤æ—¶ä¸€ä¸ªSQLè¯­å¥å¦‚ä¸‹ï¼š\n\n```sql\nSELECT * FROM users WHERE name = 'lyydsheep' AND age = 1;\n```\n\nè¿™æ¡SQLè¯­å¥æ˜¯ç”¨ä¸ä¸Šè”åˆç´¢å¼•çš„ï¼Œå› ä¸ºæŸ¥è¯¢æ¡ä»¶ä¸­æ²¡æœ‰å‡ºç°**ä»æœ€å·¦ç«¯å¼€å§‹çš„è¿ç»­å­—æ®µ**ã€‚è€Œä¸‹åˆ—è¿™æ¡SQLè¯­å¥å°±èƒ½ä½¿ç”¨ä¸Šè”åˆç´¢å¼•\n\n```sql\nSELECT * FROM users WHERE id = 1 AND name = 'lyydsheep';\n```\n\næ ¹æœ¬åŸå› å°±æ˜¯`id`å­—æ®µæ˜¯**å…¨å±€æœ‰åº**ï¼Œè€Œ`name`ã€`age`å­—æ®µæ˜¯**å±€éƒ¨æœ‰åº**çš„\n\n#### 1.3 å”¯ä¸€ç´¢å¼•çš„å¿«æ…¢é—®é¢˜\n\nå”¯ä¸€ç´¢å¼•ç›¸æ¯”äºæ™®é€šç´¢å¼•çš„ä¼˜åŠ¿å°±åœ¨äºå”¯ä¸€ç´¢å¼•é™å®šäº†å­—æ®µå€¼å¿…é¡»æ˜¯å”¯ä¸€çš„ï¼Œå½“æ‰¾åˆ°ä¸€æ¡æ•°æ®åæ—§ç«‹é©¬åœæ­¢æ£€ç´¢ã€‚è€Œæ™®é€šç´¢å¼•ä»éœ€è¦èµ°å®Œæ•´ä¸ªç´¢å¼•æ ‘ï¼Œå› ä¸ºå¯èƒ½å­˜åœ¨å¤šä¸ªç›¸åŒçš„å­—æ®µå€¼çš„æ•°æ®ã€‚\n\nå”¯ä¸€ç´¢å¼•åœ¨æŸ¥è¯¢æ—¶æ¯”æ™®é€šç´¢å¼•å¿«ä¸Šä¸€æˆªï¼Œä½†æ’å…¥æ•°æ®æ—¶å°±ä¸åŒäº†ï¼Œå› ä¸ºè¦ç¡®ä¿æ•°æ®å”¯ä¸€æ€§ï¼Œæ’å…¥æ•°æ®å‰è¦æ£€å¯Ÿä¸€éè¡¨ä¸­æ˜¯å¦å­˜åœ¨ç›¸åŒçš„æ•°æ®ã€‚æ™®é€šç´¢å¼•å°±æ²¡æœ‰è¿™é¡¾è™‘äº†ï¼Œå› æ­¤æ™®é€šç´¢å¼•æ’å…¥æ•°æ®ä¼šæ›´å¿«ä¸€äº›ã€‚\n\n### äºŒã€å»ºç«‹ç´¢å¼•çš„åŸåˆ™\n\n#### 2.1 åº”è¯¥éµå®ˆçš„åŸåˆ™\n\n- â‘ ç»å¸¸**é¢‘ç¹ç”¨ä½œæŸ¥è¯¢æ¡ä»¶çš„å­—æ®µ**åº”é…Œæƒ…è€ƒè™‘ä¸ºå…¶åˆ›å»ºç´¢å¼•ã€‚\n\n- â‘¡è¡¨çš„**ä¸»å¤–é”®æˆ–è¿è¡¨å­—æ®µ**ï¼Œå¿…é¡»å»ºç«‹ç´¢å¼•ï¼Œå› ä¸ºèƒ½å¾ˆå¤§ç¨‹åº¦æå‡è¿è¡¨æŸ¥è¯¢çš„æ€§èƒ½ã€‚\n\n- â‘¢å»ºç«‹ç´¢å¼•çš„å­—æ®µï¼Œä¸€èˆ¬å€¼çš„**åŒºåˆ†æ€§è¦è¶³å¤Ÿé«˜**ï¼Œè¿™æ ·æ‰èƒ½æé«˜ç´¢å¼•çš„æ£€ç´¢æ•ˆç‡ã€‚\n\n- â‘£å»ºç«‹ç´¢å¼•çš„å­—æ®µï¼Œå€¼ä¸åº”è¯¥è¿‡é•¿ï¼Œå¦‚æœ**è¾ƒé•¿çš„å­—æ®µè¦å»ºç«‹ç´¢å¼•ï¼Œå¯ä»¥é€‰æ‹©å‰ç¼€ç´¢å¼•**ã€‚\n\n- â‘¤å»ºç«‹**è”åˆç´¢å¼•**ï¼Œåº”å½“éµå¾ª**æœ€å·¦å‰ç¼€åŸåˆ™**ï¼Œå°†å¤šä¸ªå­—æ®µä¹‹é—´æŒ‰ä¼˜å…ˆçº§é¡ºåºç»„åˆã€‚\n\n- â‘¥ç»å¸¸æ ¹æ®**èŒƒå›´å–å€¼ã€æ’åºã€åˆ†ç»„çš„å­—æ®µåº”å»ºç«‹ç´¢å¼•**ï¼Œå› ä¸ºç´¢å¼•æœ‰åºï¼Œèƒ½åŠ å¿«æ’åºæ—¶é—´ã€‚\n\n- â‘¦å¯¹äº**å”¯ä¸€ç´¢å¼•**ï¼Œå¦‚æœç¡®è®¤ä¸ä¼šåˆ©ç”¨è¯¥å­—æ®µæ’åºï¼Œé‚£å¯ä»¥å°†**ç»“æ„æ”¹ä¸º`Hash`ç»“æ„**ã€‚\n\n- â‘§å°½é‡ä½¿ç”¨**è”åˆç´¢å¼•ä»£æ›¿å•å€¼ç´¢å¼•**ï¼Œè”åˆç´¢å¼•æ¯”å¤šä¸ªå•å€¼ç´¢å¼•æŸ¥è¯¢æ•ˆç‡è¦é«˜ã€‚\n\n#### 2.2 é¢å¤–çš„æ³¨æ„ç‚¹\n\n- â¶**å€¼ç»å¸¸ä¼šå¢åˆ æ”¹çš„å­—æ®µ**ï¼Œä¸åˆé€‚å»ºç«‹ç´¢å¼•ï¼Œå› ä¸ºæ¯æ¬¡æ”¹å˜åéœ€ç»´æŠ¤ç´¢å¼•ç»“æ„ã€‚\n\n- â·ä¸€ä¸ª**å­—æ®µå­˜åœ¨å¤§é‡çš„é‡å¤å€¼**æ—¶ï¼Œä¸é€‚åˆå»ºç«‹ç´¢å¼•ï¼Œæ¯”å¦‚ä¹‹å‰ä¸¾ä¾‹çš„æ€§åˆ«å­—æ®µã€‚\n\n- â¸ç´¢å¼•**ä¸èƒ½å‚ä¸è®¡ç®—**ï¼Œå› æ­¤ç»å¸¸**å¸¦å‡½æ•°æŸ¥è¯¢**çš„å­—æ®µï¼Œå¹¶ä¸é€‚åˆå»ºç«‹ç´¢å¼•ã€‚\n\n- â¹ä¸€å¼ è¡¨ä¸­çš„ç´¢å¼•**æ•°é‡å¹¶ä¸æ˜¯è¶Šå¤šè¶Šå¥½**ï¼Œä¸€èˆ¬æ§åˆ¶åœ¨`3`ï¼Œæœ€å¤šä¸èƒ½è¶…è¿‡`5`ã€‚\n\n- âºå»ºç«‹è”åˆç´¢å¼•æ—¶ï¼Œä¸€å®šè¦è€ƒè™‘ä¼˜å…ˆçº§ï¼ŒæŸ¥è¯¢é¢‘ç‡æœ€é«˜çš„å­—æ®µåº”å½“æ”¾é¦–ä½ã€‚\n\n- â»**å½“è¡¨çš„æ•°æ®è¾ƒå°‘ï¼Œä¸åº”å½“å»ºç«‹ç´¢å¼•**ï¼Œå› ä¸ºæ•°æ®é‡ä¸å¤§æ—¶ï¼Œç»´æŠ¤ç´¢å¼•åè€Œå¼€é”€æ›´å¤§ã€‚\n\n- â¼ç´¢å¼•çš„**å­—æ®µå€¼æ— åºæ—¶**ï¼Œä¸æ¨èå»ºç«‹ç´¢å¼•ï¼Œå› ä¸ºä¼šé€ æˆé¡µåˆ†è£‚ï¼Œå°¤å…¶æ˜¯ä¸»é”®ç´¢å¼•ã€‚\n\n## ç´¢å¼•å¸¸è§è€ƒé¢˜\n\nå‚è€ƒ[åŸæ–‡](https://xiaolincoding.com/mysql/index/index_interview.html)\n\n### ç´¢å¼•çš„åˆ†ç±»\n\nä»å››ä¸ªè§’åº¦å¯¹ç´¢å¼•è¿›è¡Œåˆ†ç±»ï¼š\n\n- ä»¥**æ•°æ®ç»“æ„**åˆ†ç±»ï¼š<font color=\"blue\">B+æ ‘ç´¢å¼•ã€Hashç´¢å¼•ã€Full-textç´¢å¼•</font>\n- ä»¥**ç‰©ç†å­˜å‚¨**åˆ†ç±»ï¼š<font color=\"blue\">èšç°‡ç´¢å¼•ã€äºŒçº§ç´¢å¼•</font>\n- ä»¥**å­—æ®µç‰¹æ€§**åˆ†ç±»ï¼š<font color=\"blue\">ä¸»é”®ç´¢å¼•ã€å”¯ä¸€ç´¢å¼•ã€æ™®é€šç´¢å¼•ã€å‰ç¼€ç´¢å¼•</font>\n- ä»¥å­—æ®µä¸ªæ•°åˆ†ç±»ï¼š<font color=\"blue\">å•åˆ—ç´¢å¼•ã€è”åˆç´¢å¼•</font>\n\n#### æŒ‰æ•°æ®ç»“æ„åˆ†ç±»\n\nä¸åŒçš„å­˜å‚¨å¼•æ“æ‰€æ”¯æŒçš„ç´¢å¼•ç±»å‹ä¸åŒï¼Œå…·ä½“å¦‚ä¸‹å›¾\n\n![image-20240918142021754](https://raw.githubusercontent.com/lyydsheep/pic/main/202409181420334.png)\n\n#### æŒ‰ç‰©ç†å­˜å‚¨åˆ†ç±»\n\n- èšç°‡ç´¢å¼•çš„B+æ ‘å¶å­èŠ‚ç‚¹å­˜æ”¾çš„æ˜¯å®é™…æ•°æ®ï¼ŒåŒ…å«äº†æ•°æ®è¡Œæ‰€æœ‰å­—æ®µçš„æ•°æ®\n- äºŒçº§ç´¢å¼•çš„B+æ ‘å¶å­èŠ‚ç‚¹å­˜æ”¾çš„æ˜¯ä¸»é”®å€¼ï¼Œå¹¶éå®é™…æ•°æ®ã€‚å› æ­¤ï¼Œå¦‚æœæ‰€æŸ¥è¯¢æ•°æ®ä¸äºŒçº§ç´¢å¼•å¶å­èŠ‚ç‚¹ä¸­ï¼Œé‚£ä¹ˆéœ€è¦å†è¿›è¡Œä¸€æ¬¡**å›è¡¨**æ“ä½œï¼›åä¹‹åˆ™æ˜¯**ç´¢å¼•è¦†ç›–**\n\n#### æŒ‰å­—æ®µç‰¹æ€§åˆ†ç±»\n\n**ä¸»é”®ç´¢å¼•**\n\nå»ºç«‹åœ¨ä¸»é”®ä¹‹ä¸Šçš„ç´¢å¼•ï¼Œä¸€èˆ¬åœ¨å»ºè¡¨æ—¶åˆ›å»ºï¼Œä¸€å¼ è¡¨æœ€å¤šåªèƒ½æœ‰ä¸€ä¸ªä¸»é”®ç´¢å¼•ï¼Œå¹¶ä¸”ä¸»é”®å­—æ®µä¸å…è®¸æœ‰`NULL`å€¼\n\nå¦‚æœæ²¡æœ‰æŒ‡æ˜ä¸»é”®ï¼Œåˆ™ç³»ç»Ÿä¼šæŒ‰ç…§ä¸€ä¸‹è§„åˆ™æŒ‘é€‰å¹¶åˆ›å»ºä¸»é”®ç´¢å¼•\n\n- é€‰æ‹©ç¬¬ä¸€ä¸ªä¸åŒ…å«`NULL`å€¼çš„**å”¯ä¸€åˆ—**ä½œä¸ºä¸»é”®åˆ—\n- ä¸‹ä¸‹ç­–ï¼ŒInnoDBè‡ªåŠ¨ç”Ÿæˆä¸€ä¸ªè‡ªå¢çš„éšè—idåˆ—ä½œä¸ºèšç°‡ç´¢å¼•çš„ç´¢å¼•é”®\n\nå»ºè¡¨æ—¶ï¼Œåˆ›å»ºä¸»é”®ç´¢å¼•çš„æ–¹å¼å¦‚ä¸‹ï¼š\n\n```sql\nCREATE TABLE table_name (\n    ...\n    PRIMARY KEY (column_name) USING BTREE\n)\n```\n\n**å”¯ä¸€ç´¢å¼•**\n\nå»ºç«‹åœ¨UNIQUEå­—æ®µä¸Šçš„ç´¢å¼•ï¼Œä¸€å¼ è¡¨å¯ä»¥æœ‰å¤šä¸ªå”¯ä¸€ç´¢å¼•ï¼Œä½†æ˜¯ç´¢å¼•é”®å€¼å¿…é¡»å”¯ä¸€ï¼Œå…è®¸æœ‰`NULL`å€¼\n\nå»ºè¡¨æ—¶ï¼Œåˆ›å»ºå”¯ä¸€ç´¢å¼•çš„æ–¹å¼å¦‚ä¸‹ï¼š\n\n```sql\nCREATE TABLE table_name(\n    ...\n    UNIQUE KEY(column1, column2...)\n)\n```\n\nå»ºè¡¨åï¼Œåˆ›å»ºå”¯ä¸€ç´¢å¼•çš„æ–¹å¼å¦‚ä¸‹ï¼š\n\n```sql\nCREATE UNIQUE INDEX idx_name ON table_name(column1, column2...)\n```\n\n**å‰ç¼€ç´¢å¼•**\n\nä»¥å­—ç¬¦ç±»å‹å­—æ®µçš„å‰ç¼€ä¸ºé”®å€¼å»ºç«‹ç´¢å¼•ï¼Œä¸»è¦ç›®çš„æ˜¯ä¸ºäº†å‡å°‘å­˜å‚¨ç©ºé—´ï¼Œä¼˜åŒ–æŸ¥è¯¢æ•ˆç‡ï¼Œå¯ä»¥ç”¨åœ¨å­—ç¬¦ç±»å‹ä¸º`char`ã€`varchat`ã€`binary`ã€`varbinary`çš„åˆ—ä¸Š\n\nå»ºè¡¨æ—¶ï¼Œåˆ›å»ºå‰ç¼€ç´¢å¼•çš„æ–¹å¼å¦‚ä¸‹ï¼š\n\n```sql\nCREATE TABLE table_name(\n    ...\n    INDEX(column1(length))\n)\n```\n\nå»ºè¡¨åï¼Œåˆ›å»ºå‰ç¼€ç´¢å¼•çš„æ–¹å¼å¦‚ä¸‹ :\n\n```sql\nCREATE INDEX idx_name ON table_name (column1(length))\n```\n\n#### æŒ‰å­—æ®µä¸ªæ•°åˆ†ç±»\n\nä¸»è¦ä»‹ç»è”åˆç´¢å¼•çš„å‡ ä¸ªç‰¹ç‚¹\n\n- èŒƒå›´æŸ¥è¯¢\n  - è”åˆç´¢å¼•çš„æœ€å·¦åŒ¹é…ï¼Œåœ¨é‡åˆ°èŒƒå›´æŸ¥è¯¢ï¼ˆ>ã€<ï¼‰æ—¶ï¼Œå°±ä¼šåœæ­¢åŒ¹é…ã€‚ä¹Ÿå°±æ˜¯è¯´ï¼ŒèŒƒå›´æŸ¥è¯¢çš„å­—æ®µä¼šç”¨åˆ°è”åˆç´¢å¼•ï¼Œä½†ä¹‹åçš„å­—æ®µä¸ä¼šä½¿ç”¨è”åˆç´¢å¼•\n  - å€¼å¾—æ³¨æ„çš„æ˜¯ï¼Œå¯¹äº`>=`ã€`<=`ã€`between xxx and`ã€`like`è¿™ç±»å«æœ‰ç›¸ç­‰æ„ä¹‰çš„èŒƒå›´æŸ¥è¯¢ï¼Œä¸ä¼šç«‹åˆ»åœæ­¢åŒ¹é…ï¼Œå³å†èŒƒå›´æŸ¥è¯¢ä¹‹åçš„å­—æ®µä»ä¼šç”¨ä¸Šè”åˆç´¢å¼•ï¼Œä½†åªé’ˆå¯¹éƒ¨åˆ†æ•°æ®\n- ç´¢å¼•ä¸‹æ¨\n  - MySQL 5.6 å¼•å…¥ç´¢å¼•ä¸‹æ¨ä¼˜åŒ–ï¼Œå¯ä»¥åœ¨è”åˆç´¢å¼•éå†è¿‡ç¨‹ä¸­ï¼Œåˆ©ç”¨è”åˆç´¢å¼•ä¸­æœªç”¨ä¸Šçš„æŸ¥è¯¢æ¡ä»¶å¯¹æ•°æ®è¿›è¡Œè¿‡æ»¤ï¼Œå‡å°‘å›è¡¨æ¬¡æ•°\n- ç´¢å¼•åŒºåˆ†åº¦\n  - åœ¨å»ºç«‹è”åˆç´¢å¼•æ—¶ï¼Œè¦å°½å¯èƒ½ æŠŠåŒºåˆ†åº¦å¤§çš„å­—æ®µæ”¾åœ¨å‰é¢ï¼Œè¿™æ ·è”åˆç´¢å¼•è¢«SQLç”¨åˆ°çš„æ¦‚ç‡æ›´å¤§\n- ç”¨äºæ’åº\n  - å‡å°‘`Using filesort`çš„æ¬¡æ•°\n\n### ä¼˜åŒ–ç´¢å¼•çš„æ–¹æ³•\n\n- å‰ç¼€ç´¢å¼•ä¼˜åŒ–\n  - ä½¿ç”¨å‰ç¼€ç´¢å¼•å¯ä»¥å‡å°ç´¢å¼•å­—æ®µçš„å¤§å°ï¼Œå¢åŠ ä¸€ä¸ªç´¢å¼•é¡µä¸­å­˜å‚¨çš„æ•°æ®é‡ï¼Œæœ‰æ•ˆæé«˜ç´¢å¼•æŸ¥è¯¢çš„æ•ˆç‡\n- è¦†ç›–ç´¢å¼•ä¼˜åŒ–\n  - å°†æ‰€è¦æŸ¥è¯¢çš„å­—æ®µå»ºç«‹æˆè”åˆç´¢å¼•ï¼Œåœ¨SQLæŸ¥è¯¢è¿‡ç¨‹ä¸­å°±èƒ½åœ¨äºŒçº§ç´¢å¼•B+æ ‘çš„å¶å­èŠ‚ç‚¹ä¸Šæ‰¾åˆ°æ‰€éœ€è¦çš„å…¨éƒ¨æ•°æ®ï¼Œè€Œä¸éœ€è¦å†é€šè¿‡èšç°‡ç´¢å¼•æŸ¥è¯¢è·å¾—ï¼Œå‡å°‘å›è¡¨çš„æ“ä½œ\n- ä¸»é”®ç´¢å¼•æœ€å¥½æ˜¯è‡ªå¢çš„\n  - æ’å…¥ä¸€æ¡æ•°æ®éƒ½æ˜¯è¿½åŠ æ“ä½œï¼Œä¸éœ€è¦ç§»åŠ¨æ•°æ®ï¼Œé¿å…äº†é¡µåˆ†è£‚å¸¦æ¥çš„æ€§èƒ½æ¶ˆè€—å’Œå¤§é‡çš„å†…å­˜ç¢ç‰‡\n  - ç´¢å¼•å­—æ®µä¸å®œè¿‡é•¿ï¼Œå‡å°‘äºŒçº§ç´¢å¼•çš„å­˜å‚¨ç©ºé—´\n- ç´¢å¼•æœ€å¥½è®¾ç½®ä¸º`NOT NULL`\n  - ç´¢å¼•åˆ—å­˜åœ¨`NULL`å€¼ä¼šåŠ é‡ç´¢å¼•é€‰æ‹©çš„è´Ÿæ‹…\n  - å‡å°‘ç‰©ç†å­˜å‚¨ç©ºé—´ï¼Œå¦‚æœè¡¨ä¸­å­˜åœ¨å…è®¸ä¸º`NULL`çš„å­—æ®µï¼Œé‚£ä¹ˆè¡Œæ ¼å¼ä¸­è‡³å°‘ä¼šå ç”¨1å­—èŠ‚ç©ºé—´å­˜å‚¨`NULL`å€¼åˆ—è¡¨\n- é˜²æ­¢ç´¢å¼•å¤±æ•ˆ\n","slug":"MySQL/MySQLç´¢å¼•å­¦ä¹ ","published":1,"updated":"2024-12-27T11:03:15.343Z","title":"","comments":1,"layout":"post","photos":[],"_id":"cm6c7md6n002ga5t2h5t613uy","content":"<h1 id=\"MySQLç´¢å¼•å­¦ä¹ \"><a href=\"#MySQLç´¢å¼•å­¦ä¹ \" class=\"headerlink\" title=\"MySQLç´¢å¼•å­¦ä¹ \"></a>MySQLç´¢å¼•å­¦ä¹ </h1><h2 id=\"ç´¢å¼•æ•°æ®ç»“æ„\"><a href=\"#ç´¢å¼•æ•°æ®ç»“æ„\" class=\"headerlink\" title=\"ç´¢å¼•æ•°æ®ç»“æ„\"></a>ç´¢å¼•æ•°æ®ç»“æ„</h2><blockquote>\n<p>ä»€ä¹ˆæ˜¯ç´¢å¼•ï¼Ÿä¸ºä»€ä¹ˆç´¢å¼•èƒ½åŠ å¿«æŸ¥è¯¢ï¼Ÿ</p>\n<p>ç´¢å¼•çš„æ•°æ®ç»“æ„æ˜¯ä»€ä¹ˆï¼Ÿ</p>\n<p>B+æ ‘å’ŒBæ ‘ã€çº¢é»‘æ ‘æœ‰ä»€ä¹ˆåŒºåˆ«ï¼Ÿä¸ºä»€ä¹ˆä½¿ç”¨B+æ ‘ï¼Ÿ</p>\n</blockquote>\n<p>ç´¢å¼•æ˜¯ä¸€ç§æ’å¥½åºçš„å¿«é€ŸæŸ¥æ‰¾çš„æ•°æ®ç»“æ„ã€‚åœ¨ç´¢å¼•ä¸ŠæŸ¥æ‰¾æ•°æ®çš„è¿‡ç¨‹å¯ä»¥ç±»æ¯”åœ¨äºŒå‰æœç´¢æ ‘ä¸Šè¿›è¡Œæ•°æ®æŸ¥è¯¢ï¼Œå¯ä»¥æ ¹æ®æ•°æ®çš„å¤§å°å…³ç³»çœç•¥å¯¹ä¸€äº›æ•°æ®çš„æŸ¥è¯¢æ“ä½œï¼Œä»è€Œ<strong>å‡å°‘ç£ç›˜I&#x2F;Oçš„æ¬¡æ•°</strong>ï¼ŒåŠ å¿«æŸ¥è¯¢æ•ˆç‡ã€‚</p>\n<p>ç´¢å¼•çš„å…·ä½“å®ç°ç”±<strong>åº•å±‚çš„å­˜å‚¨å¼•æ“å†³å®š</strong>ï¼Œä¾‹å¦‚åœ¨InnoDBå­˜å‚¨å¼•æ“ä¸‹ï¼Œç´¢å¼•æ˜¯ç”±B+æ ‘å®ç°çš„ã€‚</p>\n<p>Bæ ‘å’ŒB+æ ‘éƒ½æ˜¯é€šè¿‡å¤šå‰æ ‘çš„å½¢å¼ï¼Œå°†æ ‘çš„é«˜åº¦é™ä½ï¼Œä»¥æ­¤å‡å°‘ç£ç›˜I&#x2F;Oçš„æ¬¡æ•°ã€‚ä½†è¾ƒäºBæ ‘ï¼ŒB+æ ‘æœ‰ä»¥ä¸‹ä¼˜ç‚¹ï¼š</p>\n<ul>\n<li>B+çš„æ ‘<strong>éå¶å­èŠ‚ç‚¹ä¸å­˜æ”¾æ•°æ®åªå­˜æ”¾ç´¢å¼•</strong>ï¼Œè€ŒBæ ‘çš„å†…èŠ‚ç‚¹æ—¢å­˜æ•°æ®åˆå­˜ç´¢å¼•ã€‚å› æ­¤æ•°æ®é‡ç›¸åŒçš„æƒ…å†µä¸‹ï¼ŒB+æ ‘çš„å†…èŠ‚ç‚¹å¯ä»¥å­˜æ”¾æ›´å¤šçš„ç´¢å¼•ï¼Œè¿™ä½¿å¾—B+æ ‘å¯ä»¥æ¯”Bæ ‘æ›´â€œçŸ®èƒ–â€ï¼ŒæŸ¥è¯¢åº•å±‚èŠ‚ç‚¹æ—¶ç£ç›˜I&#x2F;Oæ¬¡æ•°æ›´å°‘</li>\n<li>B+æ ‘<strong>æœ‰å¤§é‡çš„å†—ä½™èŠ‚ç‚¹</strong>ï¼ˆæ‰€æœ‰éå¶å­èŠ‚ç‚¹éƒ½æ˜¯å†—ä½™èŠ‚ç‚¹ï¼‰ï¼Œè¿™äº›å†—ä½™èŠ‚ç‚¹ä½¿å¾—B+æ ‘åœ¨æ’å…¥ã€åˆ é™¤çš„æƒ…å†µä¸‹ï¼Œæ ‘å½¢å˜åŒ–ä¸å¤§ï¼Œæ•ˆç‡æ›´é«˜</li>\n<li>B+æ ‘çš„å¶å­èŠ‚ç‚¹ä¹‹é—´é€šè¿‡<strong>é“¾è¡¨ç›¸äº’è¿æ¥</strong>ï¼Œæœ‰åˆ©äºèŒƒå›´æŸ¥è¯¢</li>\n</ul>\n<h2 id=\"ç´¢å¼•å­˜å‚¨\"><a href=\"#ç´¢å¼•å­˜å‚¨\" class=\"headerlink\" title=\"ç´¢å¼•å­˜å‚¨\"></a>ç´¢å¼•å­˜å‚¨</h2><blockquote>\n<p>å †è¡¨å’Œç´¢å¼•ç»„ç»‡æœ‰ä»€ä¹ˆåŒºåˆ«ï¼Ÿåˆ†åˆ«åº”ç”¨åœºæ™¯æ˜¯ä»€ä¹ˆï¼Ÿ</p>\n</blockquote>\n<p>åœ¨<strong>å †è¡¨</strong>çš„ç»„ç»‡ä¸­ï¼Œ<strong>æ•°æ®å’Œç´¢å¼•æ˜¯åˆ†å¼€å­˜å‚¨çš„</strong>ï¼ŒB+æ ‘å¶å­èŠ‚ç‚¹å­˜æ”¾çš„æ˜¯<strong>ç´¢å¼•+æ•°æ®çš„åœ°å€ï¼Œåœ°å€æŒ‡å‘å †è¡¨ä¸­çš„æ•°æ®</strong>ã€‚ç´¢å¼•æ˜¯æ’åºåçš„æ•°æ®ï¼Œè€Œå †è¡¨ä¸­çš„æ•°æ®æ˜¯æ— åºçš„</p>\n<ul>\n<li>å †è¡¨ä¸­çš„ç´¢å¼•<strong>éƒ½æ˜¯äºŒçº§ç´¢å¼•</strong>ï¼Œå³ä½¿æ˜¯ä¸»é”®ç´¢å¼•ä¹Ÿæ˜¯äºŒçº§ç´¢å¼•ï¼Œæ¯æ¬¡æŸ¥è¯¢éƒ½è¦å›è¡¨</li>\n<li>ç”±äºç´¢å¼•çš„å¶å­èŠ‚ç‚¹å­˜æ”¾äº†æ•°æ®åœ¨å †è¡¨ä¸­çš„åœ°å€ï¼Œå½“å †è¡¨çš„æ•°æ®å‘ç”Ÿå˜åŒ–ä¸”ä½ç½®å‘ç”Ÿäº†æ”¹å˜ï¼Œé‚£ä¹ˆæ‰€æœ‰ç´¢å¼•ä¸­çš„åœ°å€éƒ½è¦è¿›è¡Œå˜æ›´</li>\n<li>åªæ”¯æŒè¡¨é”ï¼Œå¹¶å‘æ€§èƒ½å·®</li>\n</ul>\n<p>åœ¨<strong>ç´¢å¼•ç»„ç»‡è¡¨</strong>ï¼ˆèšç°‡ç´¢å¼•ï¼ŒInnoDBå­˜å‚¨å¼•æ“å®ç°çš„æ•°æ®ç»„ç»‡æ–¹å¼ï¼‰ä¸­ï¼Œæ•°æ®å’Œç´¢å¼•æ˜¯ä¸€èµ·å­˜å‚¨åœ¨B+æ ‘ä¸­çš„ï¼ŒB+æ ‘å¶å­èŠ‚ç‚¹å­˜æ”¾çš„æ˜¯<strong>ç´¢å¼•+è¡Œè®°å½•</strong>ã€‚</p>\n<p>ç´¢å¼•å°±æ˜¯æ•°æ®ï¼Œæ•°æ®å°±æ˜¯ç´¢å¼•</p>\n<ul>\n<li>ç´¢å¼•å’Œæ•°æ®ä¿å­˜åœ¨åŒä¸€ä¸ªB+æ ‘ä¸­ï¼Œå› æ­¤ä»èšç°‡ç´¢å¼•ä¸­è·å–æ•°æ®æ¯”éèšç°‡ç´¢å¼•æ›´å¿«</li>\n<li>åœ¨ç´¢å¼•ç»„ç»‡è¡¨ä¸­ï¼ŒäºŒçº§ç´¢å¼•å…·æœ‰å¤©ç„¶ä¼˜åŠ¿ï¼šè‹¥è®°å½•å‘ç”Ÿäº†æ”¹å˜ï¼Œå…¶ä»–ç´¢å¼•æ— é¡»è¿›è¡Œç»´æŠ¤ï¼Œé™¤éè®°å½•çš„ä¸»é”®å‘ç”Ÿäº†æ”¹å˜</li>\n<li>æ”¯æŒè¡Œçº§é”ï¼Œå¹¶å‘æ€§èƒ½é«˜</li>\n</ul>\n<h2 id=\"è”åˆç´¢å¼•\"><a href=\"#è”åˆç´¢å¼•\" class=\"headerlink\" title=\"è”åˆç´¢å¼•\"></a>è”åˆç´¢å¼•</h2><p>aba</p>\n<h2 id=\"ç´¢å¼•å¤±æ•ˆ\"><a href=\"#ç´¢å¼•å¤±æ•ˆ\" class=\"headerlink\" title=\"ç´¢å¼•å¤±æ•ˆ\"></a>ç´¢å¼•å¤±æ•ˆ</h2><blockquote>\n<p>æœ‰å“ªäº›ç´¢å¼•å¤±æ•ˆçš„åœºæ™¯ï¼Ÿä¸ºä»€ä¹ˆä¼šå¤±æ•ˆï¼Ÿ</p>\n</blockquote>\n<ul>\n<li><p>å¯¹ç´¢å¼•ä½¿ç”¨å·¦æˆ–è€…å·¦å³æ¨¡ç³ŠåŒ¹é…</p>\n<ul>\n<li>B+æ ‘ç´¢å¼•æ˜¯æŒ‰ç…§<strong>ç´¢å¼•å€¼</strong>æœ‰åºæ’åˆ—å­˜å‚¨çš„ï¼Œåªèƒ½æ ¹æ®å‰ç¼€è¿›è¡ŒåŒ¹é…æ¯”è¾ƒ</li>\n</ul>\n</li>\n<li><p>å¯¹ç´¢å¼•ä½¿ç”¨å‡½æ•°</p>\n<ul>\n<li>ç´¢å¼•ä¿å­˜çš„æ˜¯ç´¢å¼•å­—æ®µçš„åŸå§‹å€¼ï¼Œè€Œä¸æ˜¯ç»è¿‡å‡½æ•°è®¡ç®—åçš„ç»“æœï¼Œè‡ªç„¶ä¸èƒ½è¿›è¡Œç´¢å¼•æ¯”è¾ƒ</li>\n</ul>\n</li>\n<li><p>å¯¹ç´¢å¼•è¿›è¡Œè¡¨è¾¾å¼è®¡ç®—</p>\n<ul>\n<li>ç´¢å¼•ä¿å­˜çš„æ˜¯ç´¢å¼•å­—æ®µçš„åŸå§‹å€¼ï¼Œè€Œä¸æ˜¯ç»è¿‡è¡¨è¾¾å¼è®¡ç®—åçš„ç»“æœï¼Œè‡ªç„¶ä¸èƒ½è¿›è¡Œç´¢å¼•æ¯”è¾ƒ</li>\n</ul>\n</li>\n<li><p>å¯¹ç´¢å¼•éšå¼ç±»å‹è½¬æ¢</p>\n<ul>\n<li><p>MySQLåœ¨é‡åˆ°å­—ç¬¦ä¸²å’Œæ•°å­—æ¯”è¾ƒæ—¶ï¼Œä¼šå…ˆå°†å­—ç¬¦ä¸²è½¬æ¢æˆæ•°å­—ï¼Œå†è¿›è¡Œæ•°å­—æ¯”å¤§å°</p>\n</li>\n<li><p>å¦‚ä¸‹ä¸¤æ¡SQLè¯­å¥ï¼Œç¬¬ä¸€æ¡ç´¢å¼•å¤±æ•ˆï¼Œç¬¬äºŒæ¡ç´¢å¼•æ­£å¸¸å·¥ä½œ</p>\n</li>\n<li><pre><code class=\"sql\"># å…ˆå°†nameè½¬æ¢ä¸ºæ•´å‹æ•°å­—ï¼Œå†è¿›è¡Œæ¯”è¾ƒ\nselect * from users where name = 101010\n# ç­‰ä»·äº select * from users where cast(name as signed int) = 101010\n\n\nselect * from users where id = &#39;1&#39;\n# ç­‰ä»·äº select * from users where id = cast(&#39;1&#39; as signed int)\n<figure class=\"highlight plaintext\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"></span><br><span class=\"line\">- è”åˆç´¢å¼•éæœ€å·¦åŒ¹é…</span><br><span class=\"line\"></span><br><span class=\"line\">  - è”åˆç´¢å¼•æ˜¯å…ˆæŒ‰ç…§ç¬¬ä¸€ä¸ªç´¢å¼•é”®æ’åºï¼Œå†æŒ‰ç…§ç¬¬äºŒä¸ªç´¢å¼•é”®æ’åºï¼Œä»¥æ­¤ç±»æ¨</span><br><span class=\"line\"></span><br><span class=\"line\">- whereå­å¥ä¸­çš„or</span><br><span class=\"line\"></span><br><span class=\"line\">  - orå‰çš„æ¡ä»¶åˆ—æ˜¯ç´¢å¼•åˆ—ï¼Œè€Œoråçš„æ¡ä»¶åˆ—ä¸æ˜¯ç´¢å¼•åˆ—åˆ™ä¼šå¯¼è‡´ç´¢å¼•å¤±æ•ˆ</span><br><span class=\"line\"></span><br><span class=\"line\">## ç´¢å¼•é€‰æ‹©</span><br><span class=\"line\"></span><br><span class=\"line\">&gt; MySQLæ•°æ®åº“ä¸­çš„ä¼˜åŒ–å™¨æ˜¯æ€ä¹ˆæ‰§è¡Œçš„ï¼Ÿæ ¹æ®ä»€ä¹ˆæ ‡å‡†é€‰æ‹©ç´¢å¼•çš„ï¼Ÿ</span><br><span class=\"line\"></span><br><span class=\"line\">![image-20240916132934153](https://raw.githubusercontent.com/lyydsheep/pic/main/202409161330104.png)</span><br><span class=\"line\"></span><br><span class=\"line\">MySQLæ•°æ®åº“ç”±Serverå±‚å’ŒEngineå±‚ç»„æˆï¼š</span><br><span class=\"line\"></span><br><span class=\"line\">- Serverå±‚æœ‰SQLåˆ†æå™¨ã€SQLä¼˜åŒ–å™¨ã€SQLæ‰§è¡Œå™¨ï¼Œç”¨äºè´Ÿè´£SQLè¯­å¥çš„å…·ä½“æ‰§è¡Œè¿‡ç¨‹</span><br><span class=\"line\">- Engineå±‚ç”¨äºå­˜å‚¨å…·ä½“çš„æ•°æ®ï¼Œä¾‹å¦‚InnoDBå¼•æ“ï¼Œè¿˜æœ‰ç”¨äºåœ¨å†…å­˜ä¸­å­˜å‚¨ä¸´æ—¶ç»“æœé›†çš„TempTableå¼•æ“</span><br><span class=\"line\"></span><br><span class=\"line\">å…¶ä¸­SQLä¼˜åŒ–å™¨ç”¨äºåˆ†æSQLè¯­å¥åœ¨ä½¿ç”¨ä¸åŒç´¢å¼•æ—¶æ‰€éœ€è¦çš„æˆæœ¬ï¼Œå¹¶é€‰æ‹©æˆæœ¬æœ€å°çš„æ‰§è¡Œè®¡åˆ’ï¼ˆæˆ–å…¨å±€æ‰«æï¼‰ï¼Œä½œä¸ºSQLæœ€ä¼˜æ‰§è¡Œæ–¹æ¡ˆï¼Œè¿™ç§ä¼˜åŒ–å™¨ä¹Ÿå«åšCBOï¼ˆCost-based optimizerï¼‰ä¼˜åŒ–å™¨</span><br><span class=\"line\"></span><br><span class=\"line\">åœ¨MySQLä¸­ï¼Œä¸€æ¡SQLçš„è®¡ç®—æˆæœ¬æŒ‰å¦‚ä¸‹å…¬å¼è®¡ç®—ï¼š</span><br><span class=\"line\"></span><br><span class=\"line\">```sql</span><br><span class=\"line\">Cost = Server Cost + Engine Cost</span><br><span class=\"line\">\t = CPU Cost + IO Cost</span><br></pre></td></tr></table></figure>\n</code></pre>\n</li>\n</ul>\n</li>\n</ul>\n<p>åŸºäºSQLä¼˜åŒ–å™¨çš„å·¥ä½œåŸç†ï¼Œæœ‰å¦‚ä¸‹å®é™…æ¡ˆä¾‹ç»éªŒï¼š</p>\n<ul>\n<li><p>ä¸€èˆ¬åªå¯¹<strong>é«˜é€‰æ‹©åº¦çš„å­—æ®µå’Œå­—æ®µç»„åˆ</strong>å»ºç«‹ç´¢å¼•ï¼Œä½é€‰æ‹©åº¦çš„å­—æ®µå¦‚<strong>æ€§åˆ«</strong>ï¼Œä¸åˆ›å»ºç´¢å¼•</p>\n</li>\n<li><p>ä½é€‰æ‹©æ€§ï¼Œä½†æ˜¯å­˜åœ¨æ•°æ®å€¾æ–œï¼Œä¾‹å¦‚ä¼˜åŒ–å™¨è®¤ä¸ºPçŠ¶æ€æœ‰1&#x2F;3ï¼Œå®é™…ä¸ŠPçŠ¶æ€åªæœ‰1&#x2F;100ï¼Œå¯ä»¥è€ƒè™‘åˆ›å»ºç´¢å¼•</p>\n<ul>\n<li><p>é€šè¿‡åˆ›å»ºç›´æ–¹å›¾ï¼Œè®©ä¼˜åŒ–å™¨çŸ¥é“å®é™…çš„æ•°æ®åˆ†å¸ƒ</p>\n</li>\n<li><pre><code class=\"sql\">ANALYZE TABLE orders \n\nUPDATE HISTOGRAM ON o_orderstatus;\n<figure class=\"highlight plaintext\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br><span class=\"line\">31</span><br><span class=\"line\">32</span><br><span class=\"line\">33</span><br><span class=\"line\">34</span><br><span class=\"line\">35</span><br><span class=\"line\">36</span><br><span class=\"line\">37</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"></span><br><span class=\"line\">## ç´¢å¼•åº”ç”¨</span><br><span class=\"line\"></span><br><span class=\"line\">&gt; å»ºç«‹ç´¢å¼•æœ‰ä»€ä¹ˆä¼˜ç‚¹å’Œç¼ºç‚¹ï¼Ÿ</span><br><span class=\"line\">&gt;</span><br><span class=\"line\">&gt; å¦‚ä½•æ­£ç¡®å»ºç«‹ç´¢å¼•ï¼Ÿ</span><br><span class=\"line\">&gt;</span><br><span class=\"line\">&gt; å“ªäº›åœºæ™¯ä¸‹é€‚åˆå»ºç«‹ç´¢å¼•ï¼Ÿ</span><br><span class=\"line\">&gt;</span><br><span class=\"line\">&gt; å“ªäº›åœºæ™¯ä¸‹ä¸é€‚åˆå»ºç«‹ç´¢å¼•ï¼Ÿ</span><br><span class=\"line\"></span><br><span class=\"line\">å¯ä»¥å‚è€ƒ[åŸæ–‡](https://juejin.cn/post/7149074488649318431)</span><br><span class=\"line\"></span><br><span class=\"line\">### ä¸€ã€MySQLä¸­å„ç´¢å¼•åˆ†æ</span><br><span class=\"line\"></span><br><span class=\"line\">#### 1.1 ä¸ºä»€ä¹ˆé€‰è‡ªå¢Idä½œä¸ºä¸»é”®ï¼Ÿ</span><br><span class=\"line\"></span><br><span class=\"line\">åœ¨MySQLè¡¨ä¸­ï¼Œä¸€èˆ¬éƒ½æ˜¯ç”¨**è‡ªå¢Id**ä½œä¸ºä¸»é”®ï¼Œè¿™ç¡®ä¿äº†æ•°æ®çš„å”¯ä¸€æ€§ï¼Œä½†ä¸ºä»€ä¹ˆåˆéœ€è¦**è‡ªå¢**æ€§è´¨ï¼Ÿ</span><br><span class=\"line\"></span><br><span class=\"line\">åœ¨InnoDBå­˜å‚¨å¼•æ“ä¸­ï¼Œä¸»é”®ç´¢å¼•ä»¥èšç°‡çš„å½¢å¼**æœ‰åº**å­˜å‚¨ï¼Œå³ç´¢å¼•å³æ•°æ®ã€æ•°æ®å³ç´¢å¼•æŒ‰ç…§ä¸»é”®å¤§å°ä¾æ¬¡æ’åˆ—å­˜å‚¨åœ¨ç£ç›˜ä¸Šã€‚å¦‚æœä½¿ç”¨æ— åºçš„uuidä½œä¸ºä¸»é”®ï¼Œè™½ç„¶uuidä¹Ÿèƒ½ä¿è¯æ•°æ®çš„å”¯ä¸€æ€§ï¼Œä½†æ˜¯å¾ˆæœ‰å¯èƒ½ä¼šç ´ååŸæœ¬çš„æ ‘ç»“æ„</span><br><span class=\"line\"></span><br><span class=\"line\">ä¸¾ä¸ªä¾‹å­ï¼š</span><br><span class=\"line\"></span><br><span class=\"line\">ç°è‰²èŠ‚ç‚¹ä½œä¸ºä¸€æ¡æ–°æ•°æ®ï¼Œå¦‚æœæŒ‰ç…§**uuidå¤§å°æ’åˆ—**ï¼Œå®ƒåº”è¯¥æ’å…¥åœ¨ç¬¬äºŒä¸ªä½ç½®ï¼Œé‚£ä¹ˆåç»­èŠ‚ç‚¹éƒ½è¦æŒªåŠ¨ï¼Œæ—¶é—´å¤æ‚åº¦ï¼ˆä¸å°äºï¼‰$$O(n)$$ï¼Œè¿™å°±å¯¼è‡´æ’å…¥æ•°æ®ååˆ†å ç”¨CPUèµ„æºã€‚</span><br><span class=\"line\"></span><br><span class=\"line\">![image-20240917114122420](https://raw.githubusercontent.com/lyydsheep/pic/main/202409171141423.png)</span><br><span class=\"line\"></span><br><span class=\"line\">ä½†ä½¿ç”¨**è‡ªå¢Id**å°±ä¸ä¼šæœ‰è¿™ä¸ªé—®é¢˜ï¼Œæ–°æ¥çš„æ•°æ®ç›´æ¥æ”¾åˆ°æœ€åï¼Œå› æ­¤æ•°æ®è¡¨çš„ä¸»é”®å€¼æœ€å¥½é€‰ç”¨å¸¦æœ‰é¡ºåºæ€§çš„å€¼ã€‚</span><br><span class=\"line\"></span><br><span class=\"line\">#### 1.2 è”åˆç´¢å¼•çš„æœ€å·¦åŒ¹é…åŸåˆ™</span><br><span class=\"line\"></span><br><span class=\"line\">&gt; æœ€å·¦åŒ¹é…åŸåˆ™å°±æ˜¯æŒ‡åœ¨è”åˆç´¢å¼•ä¸­ï¼Œå¦‚æœä½ çš„ SQL è¯­å¥ä¸­ç”¨åˆ°äº†è”åˆç´¢å¼•ä¸­çš„æœ€å·¦è¾¹çš„ç´¢å¼•ï¼Œé‚£ä¹ˆè¿™æ¡ SQL è¯­å¥å°±å¯ä»¥åˆ©ç”¨è¿™ä¸ªè”åˆç´¢å¼•å»è¿›è¡ŒåŒ¹é…ã€‚</span><br><span class=\"line\"></span><br><span class=\"line\">ä¸º`id, name, age`è¿™ä¸‰ä¸ªå­—æ®µå»ºç«‹è”åˆç´¢å¼•ï¼Œæ­¤æ—¶ä¸€ä¸ªSQLè¯­å¥å¦‚ä¸‹ï¼š</span><br><span class=\"line\"></span><br><span class=\"line\">```sql</span><br><span class=\"line\">SELECT * FROM users WHERE name = &#x27;lyydsheep&#x27; AND age = 1;</span><br></pre></td></tr></table></figure>\n</code></pre>\n</li>\n</ul>\n</li>\n</ul>\n<p>è¿™æ¡SQLè¯­å¥æ˜¯ç”¨ä¸ä¸Šè”åˆç´¢å¼•çš„ï¼Œå› ä¸ºæŸ¥è¯¢æ¡ä»¶ä¸­æ²¡æœ‰å‡ºç°<strong>ä»æœ€å·¦ç«¯å¼€å§‹çš„è¿ç»­å­—æ®µ</strong>ã€‚è€Œä¸‹åˆ—è¿™æ¡SQLè¯­å¥å°±èƒ½ä½¿ç”¨ä¸Šè”åˆç´¢å¼•</p>\n<figure class=\"highlight sql\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">SELECT</span> <span class=\"operator\">*</span> <span class=\"keyword\">FROM</span> users <span class=\"keyword\">WHERE</span> id <span class=\"operator\">=</span> <span class=\"number\">1</span> <span class=\"keyword\">AND</span> name <span class=\"operator\">=</span> <span class=\"string\">&#x27;lyydsheep&#x27;</span>;</span><br></pre></td></tr></table></figure>\n\n<p>æ ¹æœ¬åŸå› å°±æ˜¯<code>id</code>å­—æ®µæ˜¯<strong>å…¨å±€æœ‰åº</strong>ï¼Œè€Œ<code>name</code>ã€<code>age</code>å­—æ®µæ˜¯<strong>å±€éƒ¨æœ‰åº</strong>çš„</p>\n<h4 id=\"1-3-å”¯ä¸€ç´¢å¼•çš„å¿«æ…¢é—®é¢˜\"><a href=\"#1-3-å”¯ä¸€ç´¢å¼•çš„å¿«æ…¢é—®é¢˜\" class=\"headerlink\" title=\"1.3 å”¯ä¸€ç´¢å¼•çš„å¿«æ…¢é—®é¢˜\"></a>1.3 å”¯ä¸€ç´¢å¼•çš„å¿«æ…¢é—®é¢˜</h4><p>å”¯ä¸€ç´¢å¼•ç›¸æ¯”äºæ™®é€šç´¢å¼•çš„ä¼˜åŠ¿å°±åœ¨äºå”¯ä¸€ç´¢å¼•é™å®šäº†å­—æ®µå€¼å¿…é¡»æ˜¯å”¯ä¸€çš„ï¼Œå½“æ‰¾åˆ°ä¸€æ¡æ•°æ®åæ—§ç«‹é©¬åœæ­¢æ£€ç´¢ã€‚è€Œæ™®é€šç´¢å¼•ä»éœ€è¦èµ°å®Œæ•´ä¸ªç´¢å¼•æ ‘ï¼Œå› ä¸ºå¯èƒ½å­˜åœ¨å¤šä¸ªç›¸åŒçš„å­—æ®µå€¼çš„æ•°æ®ã€‚</p>\n<p>å”¯ä¸€ç´¢å¼•åœ¨æŸ¥è¯¢æ—¶æ¯”æ™®é€šç´¢å¼•å¿«ä¸Šä¸€æˆªï¼Œä½†æ’å…¥æ•°æ®æ—¶å°±ä¸åŒäº†ï¼Œå› ä¸ºè¦ç¡®ä¿æ•°æ®å”¯ä¸€æ€§ï¼Œæ’å…¥æ•°æ®å‰è¦æ£€å¯Ÿä¸€éè¡¨ä¸­æ˜¯å¦å­˜åœ¨ç›¸åŒçš„æ•°æ®ã€‚æ™®é€šç´¢å¼•å°±æ²¡æœ‰è¿™é¡¾è™‘äº†ï¼Œå› æ­¤æ™®é€šç´¢å¼•æ’å…¥æ•°æ®ä¼šæ›´å¿«ä¸€äº›ã€‚</p>\n<h3 id=\"äºŒã€å»ºç«‹ç´¢å¼•çš„åŸåˆ™\"><a href=\"#äºŒã€å»ºç«‹ç´¢å¼•çš„åŸåˆ™\" class=\"headerlink\" title=\"äºŒã€å»ºç«‹ç´¢å¼•çš„åŸåˆ™\"></a>äºŒã€å»ºç«‹ç´¢å¼•çš„åŸåˆ™</h3><h4 id=\"2-1-åº”è¯¥éµå®ˆçš„åŸåˆ™\"><a href=\"#2-1-åº”è¯¥éµå®ˆçš„åŸåˆ™\" class=\"headerlink\" title=\"2.1 åº”è¯¥éµå®ˆçš„åŸåˆ™\"></a>2.1 åº”è¯¥éµå®ˆçš„åŸåˆ™</h4><ul>\n<li><p>â‘ ç»å¸¸<strong>é¢‘ç¹ç”¨ä½œæŸ¥è¯¢æ¡ä»¶çš„å­—æ®µ</strong>åº”é…Œæƒ…è€ƒè™‘ä¸ºå…¶åˆ›å»ºç´¢å¼•ã€‚</p>\n</li>\n<li><p>â‘¡è¡¨çš„<strong>ä¸»å¤–é”®æˆ–è¿è¡¨å­—æ®µ</strong>ï¼Œå¿…é¡»å»ºç«‹ç´¢å¼•ï¼Œå› ä¸ºèƒ½å¾ˆå¤§ç¨‹åº¦æå‡è¿è¡¨æŸ¥è¯¢çš„æ€§èƒ½ã€‚</p>\n</li>\n<li><p>â‘¢å»ºç«‹ç´¢å¼•çš„å­—æ®µï¼Œä¸€èˆ¬å€¼çš„<strong>åŒºåˆ†æ€§è¦è¶³å¤Ÿé«˜</strong>ï¼Œè¿™æ ·æ‰èƒ½æé«˜ç´¢å¼•çš„æ£€ç´¢æ•ˆç‡ã€‚</p>\n</li>\n<li><p>â‘£å»ºç«‹ç´¢å¼•çš„å­—æ®µï¼Œå€¼ä¸åº”è¯¥è¿‡é•¿ï¼Œå¦‚æœ<strong>è¾ƒé•¿çš„å­—æ®µè¦å»ºç«‹ç´¢å¼•ï¼Œå¯ä»¥é€‰æ‹©å‰ç¼€ç´¢å¼•</strong>ã€‚</p>\n</li>\n<li><p>â‘¤å»ºç«‹<strong>è”åˆç´¢å¼•</strong>ï¼Œåº”å½“éµå¾ª<strong>æœ€å·¦å‰ç¼€åŸåˆ™</strong>ï¼Œå°†å¤šä¸ªå­—æ®µä¹‹é—´æŒ‰ä¼˜å…ˆçº§é¡ºåºç»„åˆã€‚</p>\n</li>\n<li><p>â‘¥ç»å¸¸æ ¹æ®<strong>èŒƒå›´å–å€¼ã€æ’åºã€åˆ†ç»„çš„å­—æ®µåº”å»ºç«‹ç´¢å¼•</strong>ï¼Œå› ä¸ºç´¢å¼•æœ‰åºï¼Œèƒ½åŠ å¿«æ’åºæ—¶é—´ã€‚</p>\n</li>\n<li><p>â‘¦å¯¹äº<strong>å”¯ä¸€ç´¢å¼•</strong>ï¼Œå¦‚æœç¡®è®¤ä¸ä¼šåˆ©ç”¨è¯¥å­—æ®µæ’åºï¼Œé‚£å¯ä»¥å°†<strong>ç»“æ„æ”¹ä¸º<code>Hash</code>ç»“æ„</strong>ã€‚</p>\n</li>\n<li><p>â‘§å°½é‡ä½¿ç”¨<strong>è”åˆç´¢å¼•ä»£æ›¿å•å€¼ç´¢å¼•</strong>ï¼Œè”åˆç´¢å¼•æ¯”å¤šä¸ªå•å€¼ç´¢å¼•æŸ¥è¯¢æ•ˆç‡è¦é«˜ã€‚</p>\n</li>\n</ul>\n<h4 id=\"2-2-é¢å¤–çš„æ³¨æ„ç‚¹\"><a href=\"#2-2-é¢å¤–çš„æ³¨æ„ç‚¹\" class=\"headerlink\" title=\"2.2 é¢å¤–çš„æ³¨æ„ç‚¹\"></a>2.2 é¢å¤–çš„æ³¨æ„ç‚¹</h4><ul>\n<li><p>â¶<strong>å€¼ç»å¸¸ä¼šå¢åˆ æ”¹çš„å­—æ®µ</strong>ï¼Œä¸åˆé€‚å»ºç«‹ç´¢å¼•ï¼Œå› ä¸ºæ¯æ¬¡æ”¹å˜åéœ€ç»´æŠ¤ç´¢å¼•ç»“æ„ã€‚</p>\n</li>\n<li><p>â·ä¸€ä¸ª<strong>å­—æ®µå­˜åœ¨å¤§é‡çš„é‡å¤å€¼</strong>æ—¶ï¼Œä¸é€‚åˆå»ºç«‹ç´¢å¼•ï¼Œæ¯”å¦‚ä¹‹å‰ä¸¾ä¾‹çš„æ€§åˆ«å­—æ®µã€‚</p>\n</li>\n<li><p>â¸ç´¢å¼•<strong>ä¸èƒ½å‚ä¸è®¡ç®—</strong>ï¼Œå› æ­¤ç»å¸¸<strong>å¸¦å‡½æ•°æŸ¥è¯¢</strong>çš„å­—æ®µï¼Œå¹¶ä¸é€‚åˆå»ºç«‹ç´¢å¼•ã€‚</p>\n</li>\n<li><p>â¹ä¸€å¼ è¡¨ä¸­çš„ç´¢å¼•<strong>æ•°é‡å¹¶ä¸æ˜¯è¶Šå¤šè¶Šå¥½</strong>ï¼Œä¸€èˆ¬æ§åˆ¶åœ¨<code>3</code>ï¼Œæœ€å¤šä¸èƒ½è¶…è¿‡<code>5</code>ã€‚</p>\n</li>\n<li><p>âºå»ºç«‹è”åˆç´¢å¼•æ—¶ï¼Œä¸€å®šè¦è€ƒè™‘ä¼˜å…ˆçº§ï¼ŒæŸ¥è¯¢é¢‘ç‡æœ€é«˜çš„å­—æ®µåº”å½“æ”¾é¦–ä½ã€‚</p>\n</li>\n<li><p>â»<strong>å½“è¡¨çš„æ•°æ®è¾ƒå°‘ï¼Œä¸åº”å½“å»ºç«‹ç´¢å¼•</strong>ï¼Œå› ä¸ºæ•°æ®é‡ä¸å¤§æ—¶ï¼Œç»´æŠ¤ç´¢å¼•åè€Œå¼€é”€æ›´å¤§ã€‚</p>\n</li>\n<li><p>â¼ç´¢å¼•çš„<strong>å­—æ®µå€¼æ— åºæ—¶</strong>ï¼Œä¸æ¨èå»ºç«‹ç´¢å¼•ï¼Œå› ä¸ºä¼šé€ æˆé¡µåˆ†è£‚ï¼Œå°¤å…¶æ˜¯ä¸»é”®ç´¢å¼•ã€‚</p>\n</li>\n</ul>\n<h2 id=\"ç´¢å¼•å¸¸è§è€ƒé¢˜\"><a href=\"#ç´¢å¼•å¸¸è§è€ƒé¢˜\" class=\"headerlink\" title=\"ç´¢å¼•å¸¸è§è€ƒé¢˜\"></a>ç´¢å¼•å¸¸è§è€ƒé¢˜</h2><p>å‚è€ƒ<a href=\"https://xiaolincoding.com/mysql/index/index_interview.html\">åŸæ–‡</a></p>\n<h3 id=\"ç´¢å¼•çš„åˆ†ç±»\"><a href=\"#ç´¢å¼•çš„åˆ†ç±»\" class=\"headerlink\" title=\"ç´¢å¼•çš„åˆ†ç±»\"></a>ç´¢å¼•çš„åˆ†ç±»</h3><p>ä»å››ä¸ªè§’åº¦å¯¹ç´¢å¼•è¿›è¡Œåˆ†ç±»ï¼š</p>\n<ul>\n<li>ä»¥<strong>æ•°æ®ç»“æ„</strong>åˆ†ç±»ï¼š<font color=\"blue\">B+æ ‘ç´¢å¼•ã€Hashç´¢å¼•ã€Full-textç´¢å¼•</font></li>\n<li>ä»¥<strong>ç‰©ç†å­˜å‚¨</strong>åˆ†ç±»ï¼š<font color=\"blue\">èšç°‡ç´¢å¼•ã€äºŒçº§ç´¢å¼•</font></li>\n<li>ä»¥<strong>å­—æ®µç‰¹æ€§</strong>åˆ†ç±»ï¼š<font color=\"blue\">ä¸»é”®ç´¢å¼•ã€å”¯ä¸€ç´¢å¼•ã€æ™®é€šç´¢å¼•ã€å‰ç¼€ç´¢å¼•</font></li>\n<li>ä»¥å­—æ®µä¸ªæ•°åˆ†ç±»ï¼š<font color=\"blue\">å•åˆ—ç´¢å¼•ã€è”åˆç´¢å¼•</font></li>\n</ul>\n<h4 id=\"æŒ‰æ•°æ®ç»“æ„åˆ†ç±»\"><a href=\"#æŒ‰æ•°æ®ç»“æ„åˆ†ç±»\" class=\"headerlink\" title=\"æŒ‰æ•°æ®ç»“æ„åˆ†ç±»\"></a>æŒ‰æ•°æ®ç»“æ„åˆ†ç±»</h4><p>ä¸åŒçš„å­˜å‚¨å¼•æ“æ‰€æ”¯æŒçš„ç´¢å¼•ç±»å‹ä¸åŒï¼Œå…·ä½“å¦‚ä¸‹å›¾</p>\n<p><img src=\"https://raw.githubusercontent.com/lyydsheep/pic/main/202409181420334.png\" alt=\"image-20240918142021754\"></p>\n<h4 id=\"æŒ‰ç‰©ç†å­˜å‚¨åˆ†ç±»\"><a href=\"#æŒ‰ç‰©ç†å­˜å‚¨åˆ†ç±»\" class=\"headerlink\" title=\"æŒ‰ç‰©ç†å­˜å‚¨åˆ†ç±»\"></a>æŒ‰ç‰©ç†å­˜å‚¨åˆ†ç±»</h4><ul>\n<li>èšç°‡ç´¢å¼•çš„B+æ ‘å¶å­èŠ‚ç‚¹å­˜æ”¾çš„æ˜¯å®é™…æ•°æ®ï¼ŒåŒ…å«äº†æ•°æ®è¡Œæ‰€æœ‰å­—æ®µçš„æ•°æ®</li>\n<li>äºŒçº§ç´¢å¼•çš„B+æ ‘å¶å­èŠ‚ç‚¹å­˜æ”¾çš„æ˜¯ä¸»é”®å€¼ï¼Œå¹¶éå®é™…æ•°æ®ã€‚å› æ­¤ï¼Œå¦‚æœæ‰€æŸ¥è¯¢æ•°æ®ä¸äºŒçº§ç´¢å¼•å¶å­èŠ‚ç‚¹ä¸­ï¼Œé‚£ä¹ˆéœ€è¦å†è¿›è¡Œä¸€æ¬¡<strong>å›è¡¨</strong>æ“ä½œï¼›åä¹‹åˆ™æ˜¯<strong>ç´¢å¼•è¦†ç›–</strong></li>\n</ul>\n<h4 id=\"æŒ‰å­—æ®µç‰¹æ€§åˆ†ç±»\"><a href=\"#æŒ‰å­—æ®µç‰¹æ€§åˆ†ç±»\" class=\"headerlink\" title=\"æŒ‰å­—æ®µç‰¹æ€§åˆ†ç±»\"></a>æŒ‰å­—æ®µç‰¹æ€§åˆ†ç±»</h4><p><strong>ä¸»é”®ç´¢å¼•</strong></p>\n<p>å»ºç«‹åœ¨ä¸»é”®ä¹‹ä¸Šçš„ç´¢å¼•ï¼Œä¸€èˆ¬åœ¨å»ºè¡¨æ—¶åˆ›å»ºï¼Œä¸€å¼ è¡¨æœ€å¤šåªèƒ½æœ‰ä¸€ä¸ªä¸»é”®ç´¢å¼•ï¼Œå¹¶ä¸”ä¸»é”®å­—æ®µä¸å…è®¸æœ‰<code>NULL</code>å€¼</p>\n<p>å¦‚æœæ²¡æœ‰æŒ‡æ˜ä¸»é”®ï¼Œåˆ™ç³»ç»Ÿä¼šæŒ‰ç…§ä¸€ä¸‹è§„åˆ™æŒ‘é€‰å¹¶åˆ›å»ºä¸»é”®ç´¢å¼•</p>\n<ul>\n<li>é€‰æ‹©ç¬¬ä¸€ä¸ªä¸åŒ…å«<code>NULL</code>å€¼çš„<strong>å”¯ä¸€åˆ—</strong>ä½œä¸ºä¸»é”®åˆ—</li>\n<li>ä¸‹ä¸‹ç­–ï¼ŒInnoDBè‡ªåŠ¨ç”Ÿæˆä¸€ä¸ªè‡ªå¢çš„éšè—idåˆ—ä½œä¸ºèšç°‡ç´¢å¼•çš„ç´¢å¼•é”®</li>\n</ul>\n<p>å»ºè¡¨æ—¶ï¼Œåˆ›å»ºä¸»é”®ç´¢å¼•çš„æ–¹å¼å¦‚ä¸‹ï¼š</p>\n<figure class=\"highlight sql\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">CREATE TABLE</span> table_name (</span><br><span class=\"line\">    ...</span><br><span class=\"line\">    <span class=\"keyword\">PRIMARY KEY</span> (column_name) <span class=\"keyword\">USING</span> BTREE</span><br><span class=\"line\">)</span><br></pre></td></tr></table></figure>\n\n<p><strong>å”¯ä¸€ç´¢å¼•</strong></p>\n<p>å»ºç«‹åœ¨UNIQUEå­—æ®µä¸Šçš„ç´¢å¼•ï¼Œä¸€å¼ è¡¨å¯ä»¥æœ‰å¤šä¸ªå”¯ä¸€ç´¢å¼•ï¼Œä½†æ˜¯ç´¢å¼•é”®å€¼å¿…é¡»å”¯ä¸€ï¼Œå…è®¸æœ‰<code>NULL</code>å€¼</p>\n<p>å»ºè¡¨æ—¶ï¼Œåˆ›å»ºå”¯ä¸€ç´¢å¼•çš„æ–¹å¼å¦‚ä¸‹ï¼š</p>\n<figure class=\"highlight sql\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">CREATE TABLE</span> table_name(</span><br><span class=\"line\">    ...</span><br><span class=\"line\">    <span class=\"keyword\">UNIQUE</span> KEY(column1, column2...)</span><br><span class=\"line\">)</span><br></pre></td></tr></table></figure>\n\n<p>å»ºè¡¨åï¼Œåˆ›å»ºå”¯ä¸€ç´¢å¼•çš„æ–¹å¼å¦‚ä¸‹ï¼š</p>\n<figure class=\"highlight sql\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">CREATE</span> <span class=\"keyword\">UNIQUE</span> INDEX idx_name <span class=\"keyword\">ON</span> table_name(column1, column2...)</span><br></pre></td></tr></table></figure>\n\n<p><strong>å‰ç¼€ç´¢å¼•</strong></p>\n<p>ä»¥å­—ç¬¦ç±»å‹å­—æ®µçš„å‰ç¼€ä¸ºé”®å€¼å»ºç«‹ç´¢å¼•ï¼Œä¸»è¦ç›®çš„æ˜¯ä¸ºäº†å‡å°‘å­˜å‚¨ç©ºé—´ï¼Œä¼˜åŒ–æŸ¥è¯¢æ•ˆç‡ï¼Œå¯ä»¥ç”¨åœ¨å­—ç¬¦ç±»å‹ä¸º<code>char</code>ã€<code>varchat</code>ã€<code>binary</code>ã€<code>varbinary</code>çš„åˆ—ä¸Š</p>\n<p>å»ºè¡¨æ—¶ï¼Œåˆ›å»ºå‰ç¼€ç´¢å¼•çš„æ–¹å¼å¦‚ä¸‹ï¼š</p>\n<figure class=\"highlight sql\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">CREATE TABLE</span> table_name(</span><br><span class=\"line\">    ...</span><br><span class=\"line\">    INDEX(column1(length))</span><br><span class=\"line\">)</span><br></pre></td></tr></table></figure>\n\n<p>å»ºè¡¨åï¼Œåˆ›å»ºå‰ç¼€ç´¢å¼•çš„æ–¹å¼å¦‚ä¸‹ :</p>\n<figure class=\"highlight sql\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">CREATE</span> INDEX idx_name <span class=\"keyword\">ON</span> table_name (column1(length))</span><br></pre></td></tr></table></figure>\n\n<h4 id=\"æŒ‰å­—æ®µä¸ªæ•°åˆ†ç±»\"><a href=\"#æŒ‰å­—æ®µä¸ªæ•°åˆ†ç±»\" class=\"headerlink\" title=\"æŒ‰å­—æ®µä¸ªæ•°åˆ†ç±»\"></a>æŒ‰å­—æ®µä¸ªæ•°åˆ†ç±»</h4><p>ä¸»è¦ä»‹ç»è”åˆç´¢å¼•çš„å‡ ä¸ªç‰¹ç‚¹</p>\n<ul>\n<li>èŒƒå›´æŸ¥è¯¢<ul>\n<li>è”åˆç´¢å¼•çš„æœ€å·¦åŒ¹é…ï¼Œåœ¨é‡åˆ°èŒƒå›´æŸ¥è¯¢ï¼ˆ&gt;ã€&lt;ï¼‰æ—¶ï¼Œå°±ä¼šåœæ­¢åŒ¹é…ã€‚ä¹Ÿå°±æ˜¯è¯´ï¼ŒèŒƒå›´æŸ¥è¯¢çš„å­—æ®µä¼šç”¨åˆ°è”åˆç´¢å¼•ï¼Œä½†ä¹‹åçš„å­—æ®µä¸ä¼šä½¿ç”¨è”åˆç´¢å¼•</li>\n<li>å€¼å¾—æ³¨æ„çš„æ˜¯ï¼Œå¯¹äº<code>&gt;=</code>ã€<code>&lt;=</code>ã€<code>between xxx and</code>ã€<code>like</code>è¿™ç±»å«æœ‰ç›¸ç­‰æ„ä¹‰çš„èŒƒå›´æŸ¥è¯¢ï¼Œä¸ä¼šç«‹åˆ»åœæ­¢åŒ¹é…ï¼Œå³å†èŒƒå›´æŸ¥è¯¢ä¹‹åçš„å­—æ®µä»ä¼šç”¨ä¸Šè”åˆç´¢å¼•ï¼Œä½†åªé’ˆå¯¹éƒ¨åˆ†æ•°æ®</li>\n</ul>\n</li>\n<li>ç´¢å¼•ä¸‹æ¨<ul>\n<li>MySQL 5.6 å¼•å…¥ç´¢å¼•ä¸‹æ¨ä¼˜åŒ–ï¼Œå¯ä»¥åœ¨è”åˆç´¢å¼•éå†è¿‡ç¨‹ä¸­ï¼Œåˆ©ç”¨è”åˆç´¢å¼•ä¸­æœªç”¨ä¸Šçš„æŸ¥è¯¢æ¡ä»¶å¯¹æ•°æ®è¿›è¡Œè¿‡æ»¤ï¼Œå‡å°‘å›è¡¨æ¬¡æ•°</li>\n</ul>\n</li>\n<li>ç´¢å¼•åŒºåˆ†åº¦<ul>\n<li>åœ¨å»ºç«‹è”åˆç´¢å¼•æ—¶ï¼Œè¦å°½å¯èƒ½ æŠŠåŒºåˆ†åº¦å¤§çš„å­—æ®µæ”¾åœ¨å‰é¢ï¼Œè¿™æ ·è”åˆç´¢å¼•è¢«SQLç”¨åˆ°çš„æ¦‚ç‡æ›´å¤§</li>\n</ul>\n</li>\n<li>ç”¨äºæ’åº<ul>\n<li>å‡å°‘<code>Using filesort</code>çš„æ¬¡æ•°</li>\n</ul>\n</li>\n</ul>\n<h3 id=\"ä¼˜åŒ–ç´¢å¼•çš„æ–¹æ³•\"><a href=\"#ä¼˜åŒ–ç´¢å¼•çš„æ–¹æ³•\" class=\"headerlink\" title=\"ä¼˜åŒ–ç´¢å¼•çš„æ–¹æ³•\"></a>ä¼˜åŒ–ç´¢å¼•çš„æ–¹æ³•</h3><ul>\n<li>å‰ç¼€ç´¢å¼•ä¼˜åŒ–<ul>\n<li>ä½¿ç”¨å‰ç¼€ç´¢å¼•å¯ä»¥å‡å°ç´¢å¼•å­—æ®µçš„å¤§å°ï¼Œå¢åŠ ä¸€ä¸ªç´¢å¼•é¡µä¸­å­˜å‚¨çš„æ•°æ®é‡ï¼Œæœ‰æ•ˆæé«˜ç´¢å¼•æŸ¥è¯¢çš„æ•ˆç‡</li>\n</ul>\n</li>\n<li>è¦†ç›–ç´¢å¼•ä¼˜åŒ–<ul>\n<li>å°†æ‰€è¦æŸ¥è¯¢çš„å­—æ®µå»ºç«‹æˆè”åˆç´¢å¼•ï¼Œåœ¨SQLæŸ¥è¯¢è¿‡ç¨‹ä¸­å°±èƒ½åœ¨äºŒçº§ç´¢å¼•B+æ ‘çš„å¶å­èŠ‚ç‚¹ä¸Šæ‰¾åˆ°æ‰€éœ€è¦çš„å…¨éƒ¨æ•°æ®ï¼Œè€Œä¸éœ€è¦å†é€šè¿‡èšç°‡ç´¢å¼•æŸ¥è¯¢è·å¾—ï¼Œå‡å°‘å›è¡¨çš„æ“ä½œ</li>\n</ul>\n</li>\n<li>ä¸»é”®ç´¢å¼•æœ€å¥½æ˜¯è‡ªå¢çš„<ul>\n<li>æ’å…¥ä¸€æ¡æ•°æ®éƒ½æ˜¯è¿½åŠ æ“ä½œï¼Œä¸éœ€è¦ç§»åŠ¨æ•°æ®ï¼Œé¿å…äº†é¡µåˆ†è£‚å¸¦æ¥çš„æ€§èƒ½æ¶ˆè€—å’Œå¤§é‡çš„å†…å­˜ç¢ç‰‡</li>\n<li>ç´¢å¼•å­—æ®µä¸å®œè¿‡é•¿ï¼Œå‡å°‘äºŒçº§ç´¢å¼•çš„å­˜å‚¨ç©ºé—´</li>\n</ul>\n</li>\n<li>ç´¢å¼•æœ€å¥½è®¾ç½®ä¸º<code>NOT NULL</code><ul>\n<li>ç´¢å¼•åˆ—å­˜åœ¨<code>NULL</code>å€¼ä¼šåŠ é‡ç´¢å¼•é€‰æ‹©çš„è´Ÿæ‹…</li>\n<li>å‡å°‘ç‰©ç†å­˜å‚¨ç©ºé—´ï¼Œå¦‚æœè¡¨ä¸­å­˜åœ¨å…è®¸ä¸º<code>NULL</code>çš„å­—æ®µï¼Œé‚£ä¹ˆè¡Œæ ¼å¼ä¸­è‡³å°‘ä¼šå ç”¨1å­—èŠ‚ç©ºé—´å­˜å‚¨<code>NULL</code>å€¼åˆ—è¡¨</li>\n</ul>\n</li>\n<li>é˜²æ­¢ç´¢å¼•å¤±æ•ˆ</li>\n</ul>\n","excerpt":"","more":"<h1 id=\"MySQLç´¢å¼•å­¦ä¹ \"><a href=\"#MySQLç´¢å¼•å­¦ä¹ \" class=\"headerlink\" title=\"MySQLç´¢å¼•å­¦ä¹ \"></a>MySQLç´¢å¼•å­¦ä¹ </h1><h2 id=\"ç´¢å¼•æ•°æ®ç»“æ„\"><a href=\"#ç´¢å¼•æ•°æ®ç»“æ„\" class=\"headerlink\" title=\"ç´¢å¼•æ•°æ®ç»“æ„\"></a>ç´¢å¼•æ•°æ®ç»“æ„</h2><blockquote>\n<p>ä»€ä¹ˆæ˜¯ç´¢å¼•ï¼Ÿä¸ºä»€ä¹ˆç´¢å¼•èƒ½åŠ å¿«æŸ¥è¯¢ï¼Ÿ</p>\n<p>ç´¢å¼•çš„æ•°æ®ç»“æ„æ˜¯ä»€ä¹ˆï¼Ÿ</p>\n<p>B+æ ‘å’ŒBæ ‘ã€çº¢é»‘æ ‘æœ‰ä»€ä¹ˆåŒºåˆ«ï¼Ÿä¸ºä»€ä¹ˆä½¿ç”¨B+æ ‘ï¼Ÿ</p>\n</blockquote>\n<p>ç´¢å¼•æ˜¯ä¸€ç§æ’å¥½åºçš„å¿«é€ŸæŸ¥æ‰¾çš„æ•°æ®ç»“æ„ã€‚åœ¨ç´¢å¼•ä¸ŠæŸ¥æ‰¾æ•°æ®çš„è¿‡ç¨‹å¯ä»¥ç±»æ¯”åœ¨äºŒå‰æœç´¢æ ‘ä¸Šè¿›è¡Œæ•°æ®æŸ¥è¯¢ï¼Œå¯ä»¥æ ¹æ®æ•°æ®çš„å¤§å°å…³ç³»çœç•¥å¯¹ä¸€äº›æ•°æ®çš„æŸ¥è¯¢æ“ä½œï¼Œä»è€Œ<strong>å‡å°‘ç£ç›˜I&#x2F;Oçš„æ¬¡æ•°</strong>ï¼ŒåŠ å¿«æŸ¥è¯¢æ•ˆç‡ã€‚</p>\n<p>ç´¢å¼•çš„å…·ä½“å®ç°ç”±<strong>åº•å±‚çš„å­˜å‚¨å¼•æ“å†³å®š</strong>ï¼Œä¾‹å¦‚åœ¨InnoDBå­˜å‚¨å¼•æ“ä¸‹ï¼Œç´¢å¼•æ˜¯ç”±B+æ ‘å®ç°çš„ã€‚</p>\n<p>Bæ ‘å’ŒB+æ ‘éƒ½æ˜¯é€šè¿‡å¤šå‰æ ‘çš„å½¢å¼ï¼Œå°†æ ‘çš„é«˜åº¦é™ä½ï¼Œä»¥æ­¤å‡å°‘ç£ç›˜I&#x2F;Oçš„æ¬¡æ•°ã€‚ä½†è¾ƒäºBæ ‘ï¼ŒB+æ ‘æœ‰ä»¥ä¸‹ä¼˜ç‚¹ï¼š</p>\n<ul>\n<li>B+çš„æ ‘<strong>éå¶å­èŠ‚ç‚¹ä¸å­˜æ”¾æ•°æ®åªå­˜æ”¾ç´¢å¼•</strong>ï¼Œè€ŒBæ ‘çš„å†…èŠ‚ç‚¹æ—¢å­˜æ•°æ®åˆå­˜ç´¢å¼•ã€‚å› æ­¤æ•°æ®é‡ç›¸åŒçš„æƒ…å†µä¸‹ï¼ŒB+æ ‘çš„å†…èŠ‚ç‚¹å¯ä»¥å­˜æ”¾æ›´å¤šçš„ç´¢å¼•ï¼Œè¿™ä½¿å¾—B+æ ‘å¯ä»¥æ¯”Bæ ‘æ›´â€œçŸ®èƒ–â€ï¼ŒæŸ¥è¯¢åº•å±‚èŠ‚ç‚¹æ—¶ç£ç›˜I&#x2F;Oæ¬¡æ•°æ›´å°‘</li>\n<li>B+æ ‘<strong>æœ‰å¤§é‡çš„å†—ä½™èŠ‚ç‚¹</strong>ï¼ˆæ‰€æœ‰éå¶å­èŠ‚ç‚¹éƒ½æ˜¯å†—ä½™èŠ‚ç‚¹ï¼‰ï¼Œè¿™äº›å†—ä½™èŠ‚ç‚¹ä½¿å¾—B+æ ‘åœ¨æ’å…¥ã€åˆ é™¤çš„æƒ…å†µä¸‹ï¼Œæ ‘å½¢å˜åŒ–ä¸å¤§ï¼Œæ•ˆç‡æ›´é«˜</li>\n<li>B+æ ‘çš„å¶å­èŠ‚ç‚¹ä¹‹é—´é€šè¿‡<strong>é“¾è¡¨ç›¸äº’è¿æ¥</strong>ï¼Œæœ‰åˆ©äºèŒƒå›´æŸ¥è¯¢</li>\n</ul>\n<h2 id=\"ç´¢å¼•å­˜å‚¨\"><a href=\"#ç´¢å¼•å­˜å‚¨\" class=\"headerlink\" title=\"ç´¢å¼•å­˜å‚¨\"></a>ç´¢å¼•å­˜å‚¨</h2><blockquote>\n<p>å †è¡¨å’Œç´¢å¼•ç»„ç»‡æœ‰ä»€ä¹ˆåŒºåˆ«ï¼Ÿåˆ†åˆ«åº”ç”¨åœºæ™¯æ˜¯ä»€ä¹ˆï¼Ÿ</p>\n</blockquote>\n<p>åœ¨<strong>å †è¡¨</strong>çš„ç»„ç»‡ä¸­ï¼Œ<strong>æ•°æ®å’Œç´¢å¼•æ˜¯åˆ†å¼€å­˜å‚¨çš„</strong>ï¼ŒB+æ ‘å¶å­èŠ‚ç‚¹å­˜æ”¾çš„æ˜¯<strong>ç´¢å¼•+æ•°æ®çš„åœ°å€ï¼Œåœ°å€æŒ‡å‘å †è¡¨ä¸­çš„æ•°æ®</strong>ã€‚ç´¢å¼•æ˜¯æ’åºåçš„æ•°æ®ï¼Œè€Œå †è¡¨ä¸­çš„æ•°æ®æ˜¯æ— åºçš„</p>\n<ul>\n<li>å †è¡¨ä¸­çš„ç´¢å¼•<strong>éƒ½æ˜¯äºŒçº§ç´¢å¼•</strong>ï¼Œå³ä½¿æ˜¯ä¸»é”®ç´¢å¼•ä¹Ÿæ˜¯äºŒçº§ç´¢å¼•ï¼Œæ¯æ¬¡æŸ¥è¯¢éƒ½è¦å›è¡¨</li>\n<li>ç”±äºç´¢å¼•çš„å¶å­èŠ‚ç‚¹å­˜æ”¾äº†æ•°æ®åœ¨å †è¡¨ä¸­çš„åœ°å€ï¼Œå½“å †è¡¨çš„æ•°æ®å‘ç”Ÿå˜åŒ–ä¸”ä½ç½®å‘ç”Ÿäº†æ”¹å˜ï¼Œé‚£ä¹ˆæ‰€æœ‰ç´¢å¼•ä¸­çš„åœ°å€éƒ½è¦è¿›è¡Œå˜æ›´</li>\n<li>åªæ”¯æŒè¡¨é”ï¼Œå¹¶å‘æ€§èƒ½å·®</li>\n</ul>\n<p>åœ¨<strong>ç´¢å¼•ç»„ç»‡è¡¨</strong>ï¼ˆèšç°‡ç´¢å¼•ï¼ŒInnoDBå­˜å‚¨å¼•æ“å®ç°çš„æ•°æ®ç»„ç»‡æ–¹å¼ï¼‰ä¸­ï¼Œæ•°æ®å’Œç´¢å¼•æ˜¯ä¸€èµ·å­˜å‚¨åœ¨B+æ ‘ä¸­çš„ï¼ŒB+æ ‘å¶å­èŠ‚ç‚¹å­˜æ”¾çš„æ˜¯<strong>ç´¢å¼•+è¡Œè®°å½•</strong>ã€‚</p>\n<p>ç´¢å¼•å°±æ˜¯æ•°æ®ï¼Œæ•°æ®å°±æ˜¯ç´¢å¼•</p>\n<ul>\n<li>ç´¢å¼•å’Œæ•°æ®ä¿å­˜åœ¨åŒä¸€ä¸ªB+æ ‘ä¸­ï¼Œå› æ­¤ä»èšç°‡ç´¢å¼•ä¸­è·å–æ•°æ®æ¯”éèšç°‡ç´¢å¼•æ›´å¿«</li>\n<li>åœ¨ç´¢å¼•ç»„ç»‡è¡¨ä¸­ï¼ŒäºŒçº§ç´¢å¼•å…·æœ‰å¤©ç„¶ä¼˜åŠ¿ï¼šè‹¥è®°å½•å‘ç”Ÿäº†æ”¹å˜ï¼Œå…¶ä»–ç´¢å¼•æ— é¡»è¿›è¡Œç»´æŠ¤ï¼Œé™¤éè®°å½•çš„ä¸»é”®å‘ç”Ÿäº†æ”¹å˜</li>\n<li>æ”¯æŒè¡Œçº§é”ï¼Œå¹¶å‘æ€§èƒ½é«˜</li>\n</ul>\n<h2 id=\"è”åˆç´¢å¼•\"><a href=\"#è”åˆç´¢å¼•\" class=\"headerlink\" title=\"è”åˆç´¢å¼•\"></a>è”åˆç´¢å¼•</h2><p>aba</p>\n<h2 id=\"ç´¢å¼•å¤±æ•ˆ\"><a href=\"#ç´¢å¼•å¤±æ•ˆ\" class=\"headerlink\" title=\"ç´¢å¼•å¤±æ•ˆ\"></a>ç´¢å¼•å¤±æ•ˆ</h2><blockquote>\n<p>æœ‰å“ªäº›ç´¢å¼•å¤±æ•ˆçš„åœºæ™¯ï¼Ÿä¸ºä»€ä¹ˆä¼šå¤±æ•ˆï¼Ÿ</p>\n</blockquote>\n<ul>\n<li><p>å¯¹ç´¢å¼•ä½¿ç”¨å·¦æˆ–è€…å·¦å³æ¨¡ç³ŠåŒ¹é…</p>\n<ul>\n<li>B+æ ‘ç´¢å¼•æ˜¯æŒ‰ç…§<strong>ç´¢å¼•å€¼</strong>æœ‰åºæ’åˆ—å­˜å‚¨çš„ï¼Œåªèƒ½æ ¹æ®å‰ç¼€è¿›è¡ŒåŒ¹é…æ¯”è¾ƒ</li>\n</ul>\n</li>\n<li><p>å¯¹ç´¢å¼•ä½¿ç”¨å‡½æ•°</p>\n<ul>\n<li>ç´¢å¼•ä¿å­˜çš„æ˜¯ç´¢å¼•å­—æ®µçš„åŸå§‹å€¼ï¼Œè€Œä¸æ˜¯ç»è¿‡å‡½æ•°è®¡ç®—åçš„ç»“æœï¼Œè‡ªç„¶ä¸èƒ½è¿›è¡Œç´¢å¼•æ¯”è¾ƒ</li>\n</ul>\n</li>\n<li><p>å¯¹ç´¢å¼•è¿›è¡Œè¡¨è¾¾å¼è®¡ç®—</p>\n<ul>\n<li>ç´¢å¼•ä¿å­˜çš„æ˜¯ç´¢å¼•å­—æ®µçš„åŸå§‹å€¼ï¼Œè€Œä¸æ˜¯ç»è¿‡è¡¨è¾¾å¼è®¡ç®—åçš„ç»“æœï¼Œè‡ªç„¶ä¸èƒ½è¿›è¡Œç´¢å¼•æ¯”è¾ƒ</li>\n</ul>\n</li>\n<li><p>å¯¹ç´¢å¼•éšå¼ç±»å‹è½¬æ¢</p>\n<ul>\n<li><p>MySQLåœ¨é‡åˆ°å­—ç¬¦ä¸²å’Œæ•°å­—æ¯”è¾ƒæ—¶ï¼Œä¼šå…ˆå°†å­—ç¬¦ä¸²è½¬æ¢æˆæ•°å­—ï¼Œå†è¿›è¡Œæ•°å­—æ¯”å¤§å°</p>\n</li>\n<li><p>å¦‚ä¸‹ä¸¤æ¡SQLè¯­å¥ï¼Œç¬¬ä¸€æ¡ç´¢å¼•å¤±æ•ˆï¼Œç¬¬äºŒæ¡ç´¢å¼•æ­£å¸¸å·¥ä½œ</p>\n</li>\n<li><pre><code class=\"sql\"># å…ˆå°†nameè½¬æ¢ä¸ºæ•´å‹æ•°å­—ï¼Œå†è¿›è¡Œæ¯”è¾ƒ\nselect * from users where name = 101010\n# ç­‰ä»·äº select * from users where cast(name as signed int) = 101010\n\n\nselect * from users where id = &#39;1&#39;\n# ç­‰ä»·äº select * from users where id = cast(&#39;1&#39; as signed int)\n<figure class=\"highlight plaintext\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"></span><br><span class=\"line\">- è”åˆç´¢å¼•éæœ€å·¦åŒ¹é…</span><br><span class=\"line\"></span><br><span class=\"line\">  - è”åˆç´¢å¼•æ˜¯å…ˆæŒ‰ç…§ç¬¬ä¸€ä¸ªç´¢å¼•é”®æ’åºï¼Œå†æŒ‰ç…§ç¬¬äºŒä¸ªç´¢å¼•é”®æ’åºï¼Œä»¥æ­¤ç±»æ¨</span><br><span class=\"line\"></span><br><span class=\"line\">- whereå­å¥ä¸­çš„or</span><br><span class=\"line\"></span><br><span class=\"line\">  - orå‰çš„æ¡ä»¶åˆ—æ˜¯ç´¢å¼•åˆ—ï¼Œè€Œoråçš„æ¡ä»¶åˆ—ä¸æ˜¯ç´¢å¼•åˆ—åˆ™ä¼šå¯¼è‡´ç´¢å¼•å¤±æ•ˆ</span><br><span class=\"line\"></span><br><span class=\"line\">## ç´¢å¼•é€‰æ‹©</span><br><span class=\"line\"></span><br><span class=\"line\">&gt; MySQLæ•°æ®åº“ä¸­çš„ä¼˜åŒ–å™¨æ˜¯æ€ä¹ˆæ‰§è¡Œçš„ï¼Ÿæ ¹æ®ä»€ä¹ˆæ ‡å‡†é€‰æ‹©ç´¢å¼•çš„ï¼Ÿ</span><br><span class=\"line\"></span><br><span class=\"line\">![image-20240916132934153](https://raw.githubusercontent.com/lyydsheep/pic/main/202409161330104.png)</span><br><span class=\"line\"></span><br><span class=\"line\">MySQLæ•°æ®åº“ç”±Serverå±‚å’ŒEngineå±‚ç»„æˆï¼š</span><br><span class=\"line\"></span><br><span class=\"line\">- Serverå±‚æœ‰SQLåˆ†æå™¨ã€SQLä¼˜åŒ–å™¨ã€SQLæ‰§è¡Œå™¨ï¼Œç”¨äºè´Ÿè´£SQLè¯­å¥çš„å…·ä½“æ‰§è¡Œè¿‡ç¨‹</span><br><span class=\"line\">- Engineå±‚ç”¨äºå­˜å‚¨å…·ä½“çš„æ•°æ®ï¼Œä¾‹å¦‚InnoDBå¼•æ“ï¼Œè¿˜æœ‰ç”¨äºåœ¨å†…å­˜ä¸­å­˜å‚¨ä¸´æ—¶ç»“æœé›†çš„TempTableå¼•æ“</span><br><span class=\"line\"></span><br><span class=\"line\">å…¶ä¸­SQLä¼˜åŒ–å™¨ç”¨äºåˆ†æSQLè¯­å¥åœ¨ä½¿ç”¨ä¸åŒç´¢å¼•æ—¶æ‰€éœ€è¦çš„æˆæœ¬ï¼Œå¹¶é€‰æ‹©æˆæœ¬æœ€å°çš„æ‰§è¡Œè®¡åˆ’ï¼ˆæˆ–å…¨å±€æ‰«æï¼‰ï¼Œä½œä¸ºSQLæœ€ä¼˜æ‰§è¡Œæ–¹æ¡ˆï¼Œè¿™ç§ä¼˜åŒ–å™¨ä¹Ÿå«åšCBOï¼ˆCost-based optimizerï¼‰ä¼˜åŒ–å™¨</span><br><span class=\"line\"></span><br><span class=\"line\">åœ¨MySQLä¸­ï¼Œä¸€æ¡SQLçš„è®¡ç®—æˆæœ¬æŒ‰å¦‚ä¸‹å…¬å¼è®¡ç®—ï¼š</span><br><span class=\"line\"></span><br><span class=\"line\">```sql</span><br><span class=\"line\">Cost = Server Cost + Engine Cost</span><br><span class=\"line\">\t = CPU Cost + IO Cost</span><br></pre></td></tr></table></figure>\n</code></pre>\n</li>\n</ul>\n</li>\n</ul>\n<p>åŸºäºSQLä¼˜åŒ–å™¨çš„å·¥ä½œåŸç†ï¼Œæœ‰å¦‚ä¸‹å®é™…æ¡ˆä¾‹ç»éªŒï¼š</p>\n<ul>\n<li><p>ä¸€èˆ¬åªå¯¹<strong>é«˜é€‰æ‹©åº¦çš„å­—æ®µå’Œå­—æ®µç»„åˆ</strong>å»ºç«‹ç´¢å¼•ï¼Œä½é€‰æ‹©åº¦çš„å­—æ®µå¦‚<strong>æ€§åˆ«</strong>ï¼Œä¸åˆ›å»ºç´¢å¼•</p>\n</li>\n<li><p>ä½é€‰æ‹©æ€§ï¼Œä½†æ˜¯å­˜åœ¨æ•°æ®å€¾æ–œï¼Œä¾‹å¦‚ä¼˜åŒ–å™¨è®¤ä¸ºPçŠ¶æ€æœ‰1&#x2F;3ï¼Œå®é™…ä¸ŠPçŠ¶æ€åªæœ‰1&#x2F;100ï¼Œå¯ä»¥è€ƒè™‘åˆ›å»ºç´¢å¼•</p>\n<ul>\n<li><p>é€šè¿‡åˆ›å»ºç›´æ–¹å›¾ï¼Œè®©ä¼˜åŒ–å™¨çŸ¥é“å®é™…çš„æ•°æ®åˆ†å¸ƒ</p>\n</li>\n<li><pre><code class=\"sql\">ANALYZE TABLE orders \n\nUPDATE HISTOGRAM ON o_orderstatus;\n<figure class=\"highlight plaintext\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br><span class=\"line\">31</span><br><span class=\"line\">32</span><br><span class=\"line\">33</span><br><span class=\"line\">34</span><br><span class=\"line\">35</span><br><span class=\"line\">36</span><br><span class=\"line\">37</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"></span><br><span class=\"line\">## ç´¢å¼•åº”ç”¨</span><br><span class=\"line\"></span><br><span class=\"line\">&gt; å»ºç«‹ç´¢å¼•æœ‰ä»€ä¹ˆä¼˜ç‚¹å’Œç¼ºç‚¹ï¼Ÿ</span><br><span class=\"line\">&gt;</span><br><span class=\"line\">&gt; å¦‚ä½•æ­£ç¡®å»ºç«‹ç´¢å¼•ï¼Ÿ</span><br><span class=\"line\">&gt;</span><br><span class=\"line\">&gt; å“ªäº›åœºæ™¯ä¸‹é€‚åˆå»ºç«‹ç´¢å¼•ï¼Ÿ</span><br><span class=\"line\">&gt;</span><br><span class=\"line\">&gt; å“ªäº›åœºæ™¯ä¸‹ä¸é€‚åˆå»ºç«‹ç´¢å¼•ï¼Ÿ</span><br><span class=\"line\"></span><br><span class=\"line\">å¯ä»¥å‚è€ƒ[åŸæ–‡](https://juejin.cn/post/7149074488649318431)</span><br><span class=\"line\"></span><br><span class=\"line\">### ä¸€ã€MySQLä¸­å„ç´¢å¼•åˆ†æ</span><br><span class=\"line\"></span><br><span class=\"line\">#### 1.1 ä¸ºä»€ä¹ˆé€‰è‡ªå¢Idä½œä¸ºä¸»é”®ï¼Ÿ</span><br><span class=\"line\"></span><br><span class=\"line\">åœ¨MySQLè¡¨ä¸­ï¼Œä¸€èˆ¬éƒ½æ˜¯ç”¨**è‡ªå¢Id**ä½œä¸ºä¸»é”®ï¼Œè¿™ç¡®ä¿äº†æ•°æ®çš„å”¯ä¸€æ€§ï¼Œä½†ä¸ºä»€ä¹ˆåˆéœ€è¦**è‡ªå¢**æ€§è´¨ï¼Ÿ</span><br><span class=\"line\"></span><br><span class=\"line\">åœ¨InnoDBå­˜å‚¨å¼•æ“ä¸­ï¼Œä¸»é”®ç´¢å¼•ä»¥èšç°‡çš„å½¢å¼**æœ‰åº**å­˜å‚¨ï¼Œå³ç´¢å¼•å³æ•°æ®ã€æ•°æ®å³ç´¢å¼•æŒ‰ç…§ä¸»é”®å¤§å°ä¾æ¬¡æ’åˆ—å­˜å‚¨åœ¨ç£ç›˜ä¸Šã€‚å¦‚æœä½¿ç”¨æ— åºçš„uuidä½œä¸ºä¸»é”®ï¼Œè™½ç„¶uuidä¹Ÿèƒ½ä¿è¯æ•°æ®çš„å”¯ä¸€æ€§ï¼Œä½†æ˜¯å¾ˆæœ‰å¯èƒ½ä¼šç ´ååŸæœ¬çš„æ ‘ç»“æ„</span><br><span class=\"line\"></span><br><span class=\"line\">ä¸¾ä¸ªä¾‹å­ï¼š</span><br><span class=\"line\"></span><br><span class=\"line\">ç°è‰²èŠ‚ç‚¹ä½œä¸ºä¸€æ¡æ–°æ•°æ®ï¼Œå¦‚æœæŒ‰ç…§**uuidå¤§å°æ’åˆ—**ï¼Œå®ƒåº”è¯¥æ’å…¥åœ¨ç¬¬äºŒä¸ªä½ç½®ï¼Œé‚£ä¹ˆåç»­èŠ‚ç‚¹éƒ½è¦æŒªåŠ¨ï¼Œæ—¶é—´å¤æ‚åº¦ï¼ˆä¸å°äºï¼‰$$O(n)$$ï¼Œè¿™å°±å¯¼è‡´æ’å…¥æ•°æ®ååˆ†å ç”¨CPUèµ„æºã€‚</span><br><span class=\"line\"></span><br><span class=\"line\">![image-20240917114122420](https://raw.githubusercontent.com/lyydsheep/pic/main/202409171141423.png)</span><br><span class=\"line\"></span><br><span class=\"line\">ä½†ä½¿ç”¨**è‡ªå¢Id**å°±ä¸ä¼šæœ‰è¿™ä¸ªé—®é¢˜ï¼Œæ–°æ¥çš„æ•°æ®ç›´æ¥æ”¾åˆ°æœ€åï¼Œå› æ­¤æ•°æ®è¡¨çš„ä¸»é”®å€¼æœ€å¥½é€‰ç”¨å¸¦æœ‰é¡ºåºæ€§çš„å€¼ã€‚</span><br><span class=\"line\"></span><br><span class=\"line\">#### 1.2 è”åˆç´¢å¼•çš„æœ€å·¦åŒ¹é…åŸåˆ™</span><br><span class=\"line\"></span><br><span class=\"line\">&gt; æœ€å·¦åŒ¹é…åŸåˆ™å°±æ˜¯æŒ‡åœ¨è”åˆç´¢å¼•ä¸­ï¼Œå¦‚æœä½ çš„ SQL è¯­å¥ä¸­ç”¨åˆ°äº†è”åˆç´¢å¼•ä¸­çš„æœ€å·¦è¾¹çš„ç´¢å¼•ï¼Œé‚£ä¹ˆè¿™æ¡ SQL è¯­å¥å°±å¯ä»¥åˆ©ç”¨è¿™ä¸ªè”åˆç´¢å¼•å»è¿›è¡ŒåŒ¹é…ã€‚</span><br><span class=\"line\"></span><br><span class=\"line\">ä¸º`id, name, age`è¿™ä¸‰ä¸ªå­—æ®µå»ºç«‹è”åˆç´¢å¼•ï¼Œæ­¤æ—¶ä¸€ä¸ªSQLè¯­å¥å¦‚ä¸‹ï¼š</span><br><span class=\"line\"></span><br><span class=\"line\">```sql</span><br><span class=\"line\">SELECT * FROM users WHERE name = &#x27;lyydsheep&#x27; AND age = 1;</span><br></pre></td></tr></table></figure>\n</code></pre>\n</li>\n</ul>\n</li>\n</ul>\n<p>è¿™æ¡SQLè¯­å¥æ˜¯ç”¨ä¸ä¸Šè”åˆç´¢å¼•çš„ï¼Œå› ä¸ºæŸ¥è¯¢æ¡ä»¶ä¸­æ²¡æœ‰å‡ºç°<strong>ä»æœ€å·¦ç«¯å¼€å§‹çš„è¿ç»­å­—æ®µ</strong>ã€‚è€Œä¸‹åˆ—è¿™æ¡SQLè¯­å¥å°±èƒ½ä½¿ç”¨ä¸Šè”åˆç´¢å¼•</p>\n<figure class=\"highlight sql\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">SELECT</span> <span class=\"operator\">*</span> <span class=\"keyword\">FROM</span> users <span class=\"keyword\">WHERE</span> id <span class=\"operator\">=</span> <span class=\"number\">1</span> <span class=\"keyword\">AND</span> name <span class=\"operator\">=</span> <span class=\"string\">&#x27;lyydsheep&#x27;</span>;</span><br></pre></td></tr></table></figure>\n\n<p>æ ¹æœ¬åŸå› å°±æ˜¯<code>id</code>å­—æ®µæ˜¯<strong>å…¨å±€æœ‰åº</strong>ï¼Œè€Œ<code>name</code>ã€<code>age</code>å­—æ®µæ˜¯<strong>å±€éƒ¨æœ‰åº</strong>çš„</p>\n<h4 id=\"1-3-å”¯ä¸€ç´¢å¼•çš„å¿«æ…¢é—®é¢˜\"><a href=\"#1-3-å”¯ä¸€ç´¢å¼•çš„å¿«æ…¢é—®é¢˜\" class=\"headerlink\" title=\"1.3 å”¯ä¸€ç´¢å¼•çš„å¿«æ…¢é—®é¢˜\"></a>1.3 å”¯ä¸€ç´¢å¼•çš„å¿«æ…¢é—®é¢˜</h4><p>å”¯ä¸€ç´¢å¼•ç›¸æ¯”äºæ™®é€šç´¢å¼•çš„ä¼˜åŠ¿å°±åœ¨äºå”¯ä¸€ç´¢å¼•é™å®šäº†å­—æ®µå€¼å¿…é¡»æ˜¯å”¯ä¸€çš„ï¼Œå½“æ‰¾åˆ°ä¸€æ¡æ•°æ®åæ—§ç«‹é©¬åœæ­¢æ£€ç´¢ã€‚è€Œæ™®é€šç´¢å¼•ä»éœ€è¦èµ°å®Œæ•´ä¸ªç´¢å¼•æ ‘ï¼Œå› ä¸ºå¯èƒ½å­˜åœ¨å¤šä¸ªç›¸åŒçš„å­—æ®µå€¼çš„æ•°æ®ã€‚</p>\n<p>å”¯ä¸€ç´¢å¼•åœ¨æŸ¥è¯¢æ—¶æ¯”æ™®é€šç´¢å¼•å¿«ä¸Šä¸€æˆªï¼Œä½†æ’å…¥æ•°æ®æ—¶å°±ä¸åŒäº†ï¼Œå› ä¸ºè¦ç¡®ä¿æ•°æ®å”¯ä¸€æ€§ï¼Œæ’å…¥æ•°æ®å‰è¦æ£€å¯Ÿä¸€éè¡¨ä¸­æ˜¯å¦å­˜åœ¨ç›¸åŒçš„æ•°æ®ã€‚æ™®é€šç´¢å¼•å°±æ²¡æœ‰è¿™é¡¾è™‘äº†ï¼Œå› æ­¤æ™®é€šç´¢å¼•æ’å…¥æ•°æ®ä¼šæ›´å¿«ä¸€äº›ã€‚</p>\n<h3 id=\"äºŒã€å»ºç«‹ç´¢å¼•çš„åŸåˆ™\"><a href=\"#äºŒã€å»ºç«‹ç´¢å¼•çš„åŸåˆ™\" class=\"headerlink\" title=\"äºŒã€å»ºç«‹ç´¢å¼•çš„åŸåˆ™\"></a>äºŒã€å»ºç«‹ç´¢å¼•çš„åŸåˆ™</h3><h4 id=\"2-1-åº”è¯¥éµå®ˆçš„åŸåˆ™\"><a href=\"#2-1-åº”è¯¥éµå®ˆçš„åŸåˆ™\" class=\"headerlink\" title=\"2.1 åº”è¯¥éµå®ˆçš„åŸåˆ™\"></a>2.1 åº”è¯¥éµå®ˆçš„åŸåˆ™</h4><ul>\n<li><p>â‘ ç»å¸¸<strong>é¢‘ç¹ç”¨ä½œæŸ¥è¯¢æ¡ä»¶çš„å­—æ®µ</strong>åº”é…Œæƒ…è€ƒè™‘ä¸ºå…¶åˆ›å»ºç´¢å¼•ã€‚</p>\n</li>\n<li><p>â‘¡è¡¨çš„<strong>ä¸»å¤–é”®æˆ–è¿è¡¨å­—æ®µ</strong>ï¼Œå¿…é¡»å»ºç«‹ç´¢å¼•ï¼Œå› ä¸ºèƒ½å¾ˆå¤§ç¨‹åº¦æå‡è¿è¡¨æŸ¥è¯¢çš„æ€§èƒ½ã€‚</p>\n</li>\n<li><p>â‘¢å»ºç«‹ç´¢å¼•çš„å­—æ®µï¼Œä¸€èˆ¬å€¼çš„<strong>åŒºåˆ†æ€§è¦è¶³å¤Ÿé«˜</strong>ï¼Œè¿™æ ·æ‰èƒ½æé«˜ç´¢å¼•çš„æ£€ç´¢æ•ˆç‡ã€‚</p>\n</li>\n<li><p>â‘£å»ºç«‹ç´¢å¼•çš„å­—æ®µï¼Œå€¼ä¸åº”è¯¥è¿‡é•¿ï¼Œå¦‚æœ<strong>è¾ƒé•¿çš„å­—æ®µè¦å»ºç«‹ç´¢å¼•ï¼Œå¯ä»¥é€‰æ‹©å‰ç¼€ç´¢å¼•</strong>ã€‚</p>\n</li>\n<li><p>â‘¤å»ºç«‹<strong>è”åˆç´¢å¼•</strong>ï¼Œåº”å½“éµå¾ª<strong>æœ€å·¦å‰ç¼€åŸåˆ™</strong>ï¼Œå°†å¤šä¸ªå­—æ®µä¹‹é—´æŒ‰ä¼˜å…ˆçº§é¡ºåºç»„åˆã€‚</p>\n</li>\n<li><p>â‘¥ç»å¸¸æ ¹æ®<strong>èŒƒå›´å–å€¼ã€æ’åºã€åˆ†ç»„çš„å­—æ®µåº”å»ºç«‹ç´¢å¼•</strong>ï¼Œå› ä¸ºç´¢å¼•æœ‰åºï¼Œèƒ½åŠ å¿«æ’åºæ—¶é—´ã€‚</p>\n</li>\n<li><p>â‘¦å¯¹äº<strong>å”¯ä¸€ç´¢å¼•</strong>ï¼Œå¦‚æœç¡®è®¤ä¸ä¼šåˆ©ç”¨è¯¥å­—æ®µæ’åºï¼Œé‚£å¯ä»¥å°†<strong>ç»“æ„æ”¹ä¸º<code>Hash</code>ç»“æ„</strong>ã€‚</p>\n</li>\n<li><p>â‘§å°½é‡ä½¿ç”¨<strong>è”åˆç´¢å¼•ä»£æ›¿å•å€¼ç´¢å¼•</strong>ï¼Œè”åˆç´¢å¼•æ¯”å¤šä¸ªå•å€¼ç´¢å¼•æŸ¥è¯¢æ•ˆç‡è¦é«˜ã€‚</p>\n</li>\n</ul>\n<h4 id=\"2-2-é¢å¤–çš„æ³¨æ„ç‚¹\"><a href=\"#2-2-é¢å¤–çš„æ³¨æ„ç‚¹\" class=\"headerlink\" title=\"2.2 é¢å¤–çš„æ³¨æ„ç‚¹\"></a>2.2 é¢å¤–çš„æ³¨æ„ç‚¹</h4><ul>\n<li><p>â¶<strong>å€¼ç»å¸¸ä¼šå¢åˆ æ”¹çš„å­—æ®µ</strong>ï¼Œä¸åˆé€‚å»ºç«‹ç´¢å¼•ï¼Œå› ä¸ºæ¯æ¬¡æ”¹å˜åéœ€ç»´æŠ¤ç´¢å¼•ç»“æ„ã€‚</p>\n</li>\n<li><p>â·ä¸€ä¸ª<strong>å­—æ®µå­˜åœ¨å¤§é‡çš„é‡å¤å€¼</strong>æ—¶ï¼Œä¸é€‚åˆå»ºç«‹ç´¢å¼•ï¼Œæ¯”å¦‚ä¹‹å‰ä¸¾ä¾‹çš„æ€§åˆ«å­—æ®µã€‚</p>\n</li>\n<li><p>â¸ç´¢å¼•<strong>ä¸èƒ½å‚ä¸è®¡ç®—</strong>ï¼Œå› æ­¤ç»å¸¸<strong>å¸¦å‡½æ•°æŸ¥è¯¢</strong>çš„å­—æ®µï¼Œå¹¶ä¸é€‚åˆå»ºç«‹ç´¢å¼•ã€‚</p>\n</li>\n<li><p>â¹ä¸€å¼ è¡¨ä¸­çš„ç´¢å¼•<strong>æ•°é‡å¹¶ä¸æ˜¯è¶Šå¤šè¶Šå¥½</strong>ï¼Œä¸€èˆ¬æ§åˆ¶åœ¨<code>3</code>ï¼Œæœ€å¤šä¸èƒ½è¶…è¿‡<code>5</code>ã€‚</p>\n</li>\n<li><p>âºå»ºç«‹è”åˆç´¢å¼•æ—¶ï¼Œä¸€å®šè¦è€ƒè™‘ä¼˜å…ˆçº§ï¼ŒæŸ¥è¯¢é¢‘ç‡æœ€é«˜çš„å­—æ®µåº”å½“æ”¾é¦–ä½ã€‚</p>\n</li>\n<li><p>â»<strong>å½“è¡¨çš„æ•°æ®è¾ƒå°‘ï¼Œä¸åº”å½“å»ºç«‹ç´¢å¼•</strong>ï¼Œå› ä¸ºæ•°æ®é‡ä¸å¤§æ—¶ï¼Œç»´æŠ¤ç´¢å¼•åè€Œå¼€é”€æ›´å¤§ã€‚</p>\n</li>\n<li><p>â¼ç´¢å¼•çš„<strong>å­—æ®µå€¼æ— åºæ—¶</strong>ï¼Œä¸æ¨èå»ºç«‹ç´¢å¼•ï¼Œå› ä¸ºä¼šé€ æˆé¡µåˆ†è£‚ï¼Œå°¤å…¶æ˜¯ä¸»é”®ç´¢å¼•ã€‚</p>\n</li>\n</ul>\n<h2 id=\"ç´¢å¼•å¸¸è§è€ƒé¢˜\"><a href=\"#ç´¢å¼•å¸¸è§è€ƒé¢˜\" class=\"headerlink\" title=\"ç´¢å¼•å¸¸è§è€ƒé¢˜\"></a>ç´¢å¼•å¸¸è§è€ƒé¢˜</h2><p>å‚è€ƒ<a href=\"https://xiaolincoding.com/mysql/index/index_interview.html\">åŸæ–‡</a></p>\n<h3 id=\"ç´¢å¼•çš„åˆ†ç±»\"><a href=\"#ç´¢å¼•çš„åˆ†ç±»\" class=\"headerlink\" title=\"ç´¢å¼•çš„åˆ†ç±»\"></a>ç´¢å¼•çš„åˆ†ç±»</h3><p>ä»å››ä¸ªè§’åº¦å¯¹ç´¢å¼•è¿›è¡Œåˆ†ç±»ï¼š</p>\n<ul>\n<li>ä»¥<strong>æ•°æ®ç»“æ„</strong>åˆ†ç±»ï¼š<font color=\"blue\">B+æ ‘ç´¢å¼•ã€Hashç´¢å¼•ã€Full-textç´¢å¼•</font></li>\n<li>ä»¥<strong>ç‰©ç†å­˜å‚¨</strong>åˆ†ç±»ï¼š<font color=\"blue\">èšç°‡ç´¢å¼•ã€äºŒçº§ç´¢å¼•</font></li>\n<li>ä»¥<strong>å­—æ®µç‰¹æ€§</strong>åˆ†ç±»ï¼š<font color=\"blue\">ä¸»é”®ç´¢å¼•ã€å”¯ä¸€ç´¢å¼•ã€æ™®é€šç´¢å¼•ã€å‰ç¼€ç´¢å¼•</font></li>\n<li>ä»¥å­—æ®µä¸ªæ•°åˆ†ç±»ï¼š<font color=\"blue\">å•åˆ—ç´¢å¼•ã€è”åˆç´¢å¼•</font></li>\n</ul>\n<h4 id=\"æŒ‰æ•°æ®ç»“æ„åˆ†ç±»\"><a href=\"#æŒ‰æ•°æ®ç»“æ„åˆ†ç±»\" class=\"headerlink\" title=\"æŒ‰æ•°æ®ç»“æ„åˆ†ç±»\"></a>æŒ‰æ•°æ®ç»“æ„åˆ†ç±»</h4><p>ä¸åŒçš„å­˜å‚¨å¼•æ“æ‰€æ”¯æŒçš„ç´¢å¼•ç±»å‹ä¸åŒï¼Œå…·ä½“å¦‚ä¸‹å›¾</p>\n<p><img src=\"https://raw.githubusercontent.com/lyydsheep/pic/main/202409181420334.png\" alt=\"image-20240918142021754\"></p>\n<h4 id=\"æŒ‰ç‰©ç†å­˜å‚¨åˆ†ç±»\"><a href=\"#æŒ‰ç‰©ç†å­˜å‚¨åˆ†ç±»\" class=\"headerlink\" title=\"æŒ‰ç‰©ç†å­˜å‚¨åˆ†ç±»\"></a>æŒ‰ç‰©ç†å­˜å‚¨åˆ†ç±»</h4><ul>\n<li>èšç°‡ç´¢å¼•çš„B+æ ‘å¶å­èŠ‚ç‚¹å­˜æ”¾çš„æ˜¯å®é™…æ•°æ®ï¼ŒåŒ…å«äº†æ•°æ®è¡Œæ‰€æœ‰å­—æ®µçš„æ•°æ®</li>\n<li>äºŒçº§ç´¢å¼•çš„B+æ ‘å¶å­èŠ‚ç‚¹å­˜æ”¾çš„æ˜¯ä¸»é”®å€¼ï¼Œå¹¶éå®é™…æ•°æ®ã€‚å› æ­¤ï¼Œå¦‚æœæ‰€æŸ¥è¯¢æ•°æ®ä¸äºŒçº§ç´¢å¼•å¶å­èŠ‚ç‚¹ä¸­ï¼Œé‚£ä¹ˆéœ€è¦å†è¿›è¡Œä¸€æ¬¡<strong>å›è¡¨</strong>æ“ä½œï¼›åä¹‹åˆ™æ˜¯<strong>ç´¢å¼•è¦†ç›–</strong></li>\n</ul>\n<h4 id=\"æŒ‰å­—æ®µç‰¹æ€§åˆ†ç±»\"><a href=\"#æŒ‰å­—æ®µç‰¹æ€§åˆ†ç±»\" class=\"headerlink\" title=\"æŒ‰å­—æ®µç‰¹æ€§åˆ†ç±»\"></a>æŒ‰å­—æ®µç‰¹æ€§åˆ†ç±»</h4><p><strong>ä¸»é”®ç´¢å¼•</strong></p>\n<p>å»ºç«‹åœ¨ä¸»é”®ä¹‹ä¸Šçš„ç´¢å¼•ï¼Œä¸€èˆ¬åœ¨å»ºè¡¨æ—¶åˆ›å»ºï¼Œä¸€å¼ è¡¨æœ€å¤šåªèƒ½æœ‰ä¸€ä¸ªä¸»é”®ç´¢å¼•ï¼Œå¹¶ä¸”ä¸»é”®å­—æ®µä¸å…è®¸æœ‰<code>NULL</code>å€¼</p>\n<p>å¦‚æœæ²¡æœ‰æŒ‡æ˜ä¸»é”®ï¼Œåˆ™ç³»ç»Ÿä¼šæŒ‰ç…§ä¸€ä¸‹è§„åˆ™æŒ‘é€‰å¹¶åˆ›å»ºä¸»é”®ç´¢å¼•</p>\n<ul>\n<li>é€‰æ‹©ç¬¬ä¸€ä¸ªä¸åŒ…å«<code>NULL</code>å€¼çš„<strong>å”¯ä¸€åˆ—</strong>ä½œä¸ºä¸»é”®åˆ—</li>\n<li>ä¸‹ä¸‹ç­–ï¼ŒInnoDBè‡ªåŠ¨ç”Ÿæˆä¸€ä¸ªè‡ªå¢çš„éšè—idåˆ—ä½œä¸ºèšç°‡ç´¢å¼•çš„ç´¢å¼•é”®</li>\n</ul>\n<p>å»ºè¡¨æ—¶ï¼Œåˆ›å»ºä¸»é”®ç´¢å¼•çš„æ–¹å¼å¦‚ä¸‹ï¼š</p>\n<figure class=\"highlight sql\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">CREATE TABLE</span> table_name (</span><br><span class=\"line\">    ...</span><br><span class=\"line\">    <span class=\"keyword\">PRIMARY KEY</span> (column_name) <span class=\"keyword\">USING</span> BTREE</span><br><span class=\"line\">)</span><br></pre></td></tr></table></figure>\n\n<p><strong>å”¯ä¸€ç´¢å¼•</strong></p>\n<p>å»ºç«‹åœ¨UNIQUEå­—æ®µä¸Šçš„ç´¢å¼•ï¼Œä¸€å¼ è¡¨å¯ä»¥æœ‰å¤šä¸ªå”¯ä¸€ç´¢å¼•ï¼Œä½†æ˜¯ç´¢å¼•é”®å€¼å¿…é¡»å”¯ä¸€ï¼Œå…è®¸æœ‰<code>NULL</code>å€¼</p>\n<p>å»ºè¡¨æ—¶ï¼Œåˆ›å»ºå”¯ä¸€ç´¢å¼•çš„æ–¹å¼å¦‚ä¸‹ï¼š</p>\n<figure class=\"highlight sql\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">CREATE TABLE</span> table_name(</span><br><span class=\"line\">    ...</span><br><span class=\"line\">    <span class=\"keyword\">UNIQUE</span> KEY(column1, column2...)</span><br><span class=\"line\">)</span><br></pre></td></tr></table></figure>\n\n<p>å»ºè¡¨åï¼Œåˆ›å»ºå”¯ä¸€ç´¢å¼•çš„æ–¹å¼å¦‚ä¸‹ï¼š</p>\n<figure class=\"highlight sql\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">CREATE</span> <span class=\"keyword\">UNIQUE</span> INDEX idx_name <span class=\"keyword\">ON</span> table_name(column1, column2...)</span><br></pre></td></tr></table></figure>\n\n<p><strong>å‰ç¼€ç´¢å¼•</strong></p>\n<p>ä»¥å­—ç¬¦ç±»å‹å­—æ®µçš„å‰ç¼€ä¸ºé”®å€¼å»ºç«‹ç´¢å¼•ï¼Œä¸»è¦ç›®çš„æ˜¯ä¸ºäº†å‡å°‘å­˜å‚¨ç©ºé—´ï¼Œä¼˜åŒ–æŸ¥è¯¢æ•ˆç‡ï¼Œå¯ä»¥ç”¨åœ¨å­—ç¬¦ç±»å‹ä¸º<code>char</code>ã€<code>varchat</code>ã€<code>binary</code>ã€<code>varbinary</code>çš„åˆ—ä¸Š</p>\n<p>å»ºè¡¨æ—¶ï¼Œåˆ›å»ºå‰ç¼€ç´¢å¼•çš„æ–¹å¼å¦‚ä¸‹ï¼š</p>\n<figure class=\"highlight sql\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">CREATE TABLE</span> table_name(</span><br><span class=\"line\">    ...</span><br><span class=\"line\">    INDEX(column1(length))</span><br><span class=\"line\">)</span><br></pre></td></tr></table></figure>\n\n<p>å»ºè¡¨åï¼Œåˆ›å»ºå‰ç¼€ç´¢å¼•çš„æ–¹å¼å¦‚ä¸‹ :</p>\n<figure class=\"highlight sql\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">CREATE</span> INDEX idx_name <span class=\"keyword\">ON</span> table_name (column1(length))</span><br></pre></td></tr></table></figure>\n\n<h4 id=\"æŒ‰å­—æ®µä¸ªæ•°åˆ†ç±»\"><a href=\"#æŒ‰å­—æ®µä¸ªæ•°åˆ†ç±»\" class=\"headerlink\" title=\"æŒ‰å­—æ®µä¸ªæ•°åˆ†ç±»\"></a>æŒ‰å­—æ®µä¸ªæ•°åˆ†ç±»</h4><p>ä¸»è¦ä»‹ç»è”åˆç´¢å¼•çš„å‡ ä¸ªç‰¹ç‚¹</p>\n<ul>\n<li>èŒƒå›´æŸ¥è¯¢<ul>\n<li>è”åˆç´¢å¼•çš„æœ€å·¦åŒ¹é…ï¼Œåœ¨é‡åˆ°èŒƒå›´æŸ¥è¯¢ï¼ˆ&gt;ã€&lt;ï¼‰æ—¶ï¼Œå°±ä¼šåœæ­¢åŒ¹é…ã€‚ä¹Ÿå°±æ˜¯è¯´ï¼ŒèŒƒå›´æŸ¥è¯¢çš„å­—æ®µä¼šç”¨åˆ°è”åˆç´¢å¼•ï¼Œä½†ä¹‹åçš„å­—æ®µä¸ä¼šä½¿ç”¨è”åˆç´¢å¼•</li>\n<li>å€¼å¾—æ³¨æ„çš„æ˜¯ï¼Œå¯¹äº<code>&gt;=</code>ã€<code>&lt;=</code>ã€<code>between xxx and</code>ã€<code>like</code>è¿™ç±»å«æœ‰ç›¸ç­‰æ„ä¹‰çš„èŒƒå›´æŸ¥è¯¢ï¼Œä¸ä¼šç«‹åˆ»åœæ­¢åŒ¹é…ï¼Œå³å†èŒƒå›´æŸ¥è¯¢ä¹‹åçš„å­—æ®µä»ä¼šç”¨ä¸Šè”åˆç´¢å¼•ï¼Œä½†åªé’ˆå¯¹éƒ¨åˆ†æ•°æ®</li>\n</ul>\n</li>\n<li>ç´¢å¼•ä¸‹æ¨<ul>\n<li>MySQL 5.6 å¼•å…¥ç´¢å¼•ä¸‹æ¨ä¼˜åŒ–ï¼Œå¯ä»¥åœ¨è”åˆç´¢å¼•éå†è¿‡ç¨‹ä¸­ï¼Œåˆ©ç”¨è”åˆç´¢å¼•ä¸­æœªç”¨ä¸Šçš„æŸ¥è¯¢æ¡ä»¶å¯¹æ•°æ®è¿›è¡Œè¿‡æ»¤ï¼Œå‡å°‘å›è¡¨æ¬¡æ•°</li>\n</ul>\n</li>\n<li>ç´¢å¼•åŒºåˆ†åº¦<ul>\n<li>åœ¨å»ºç«‹è”åˆç´¢å¼•æ—¶ï¼Œè¦å°½å¯èƒ½ æŠŠåŒºåˆ†åº¦å¤§çš„å­—æ®µæ”¾åœ¨å‰é¢ï¼Œè¿™æ ·è”åˆç´¢å¼•è¢«SQLç”¨åˆ°çš„æ¦‚ç‡æ›´å¤§</li>\n</ul>\n</li>\n<li>ç”¨äºæ’åº<ul>\n<li>å‡å°‘<code>Using filesort</code>çš„æ¬¡æ•°</li>\n</ul>\n</li>\n</ul>\n<h3 id=\"ä¼˜åŒ–ç´¢å¼•çš„æ–¹æ³•\"><a href=\"#ä¼˜åŒ–ç´¢å¼•çš„æ–¹æ³•\" class=\"headerlink\" title=\"ä¼˜åŒ–ç´¢å¼•çš„æ–¹æ³•\"></a>ä¼˜åŒ–ç´¢å¼•çš„æ–¹æ³•</h3><ul>\n<li>å‰ç¼€ç´¢å¼•ä¼˜åŒ–<ul>\n<li>ä½¿ç”¨å‰ç¼€ç´¢å¼•å¯ä»¥å‡å°ç´¢å¼•å­—æ®µçš„å¤§å°ï¼Œå¢åŠ ä¸€ä¸ªç´¢å¼•é¡µä¸­å­˜å‚¨çš„æ•°æ®é‡ï¼Œæœ‰æ•ˆæé«˜ç´¢å¼•æŸ¥è¯¢çš„æ•ˆç‡</li>\n</ul>\n</li>\n<li>è¦†ç›–ç´¢å¼•ä¼˜åŒ–<ul>\n<li>å°†æ‰€è¦æŸ¥è¯¢çš„å­—æ®µå»ºç«‹æˆè”åˆç´¢å¼•ï¼Œåœ¨SQLæŸ¥è¯¢è¿‡ç¨‹ä¸­å°±èƒ½åœ¨äºŒçº§ç´¢å¼•B+æ ‘çš„å¶å­èŠ‚ç‚¹ä¸Šæ‰¾åˆ°æ‰€éœ€è¦çš„å…¨éƒ¨æ•°æ®ï¼Œè€Œä¸éœ€è¦å†é€šè¿‡èšç°‡ç´¢å¼•æŸ¥è¯¢è·å¾—ï¼Œå‡å°‘å›è¡¨çš„æ“ä½œ</li>\n</ul>\n</li>\n<li>ä¸»é”®ç´¢å¼•æœ€å¥½æ˜¯è‡ªå¢çš„<ul>\n<li>æ’å…¥ä¸€æ¡æ•°æ®éƒ½æ˜¯è¿½åŠ æ“ä½œï¼Œä¸éœ€è¦ç§»åŠ¨æ•°æ®ï¼Œé¿å…äº†é¡µåˆ†è£‚å¸¦æ¥çš„æ€§èƒ½æ¶ˆè€—å’Œå¤§é‡çš„å†…å­˜ç¢ç‰‡</li>\n<li>ç´¢å¼•å­—æ®µä¸å®œè¿‡é•¿ï¼Œå‡å°‘äºŒçº§ç´¢å¼•çš„å­˜å‚¨ç©ºé—´</li>\n</ul>\n</li>\n<li>ç´¢å¼•æœ€å¥½è®¾ç½®ä¸º<code>NOT NULL</code><ul>\n<li>ç´¢å¼•åˆ—å­˜åœ¨<code>NULL</code>å€¼ä¼šåŠ é‡ç´¢å¼•é€‰æ‹©çš„è´Ÿæ‹…</li>\n<li>å‡å°‘ç‰©ç†å­˜å‚¨ç©ºé—´ï¼Œå¦‚æœè¡¨ä¸­å­˜åœ¨å…è®¸ä¸º<code>NULL</code>çš„å­—æ®µï¼Œé‚£ä¹ˆè¡Œæ ¼å¼ä¸­è‡³å°‘ä¼šå ç”¨1å­—èŠ‚ç©ºé—´å­˜å‚¨<code>NULL</code>å€¼åˆ—è¡¨</li>\n</ul>\n</li>\n<li>é˜²æ­¢ç´¢å¼•å¤±æ•ˆ</li>\n</ul>\n"},{"title":"MySQLé”å­¦ä¹ ","publish":true,"description":"è®°å½•ä¸€äº›æœ‰å…³MySQLé”çš„çŸ¥è¯†ç‚¹","date":"2024-09-26T16:00:00.000Z","_content":"\n# é”\n\n## é”ç±»å‹\n\naba\n\n## è¡Œçº§é”\n\naba\n\n## MDLé”\n\naba\n\n## æ­»é”\n\n> æ­»é”æ˜¯æ€ä¹ˆå‘ç”Ÿçš„ï¼Ÿ\n>\n> å‘ç”Ÿæ­»é”çš„æ¡ä»¶æœ‰å“ªäº›ï¼Ÿ\n>\n> æ€ä¹ˆæ’æŸ¥æ­»é”é—®é¢˜ï¼Ÿ\n>\n> æ€ä¹ˆé¿å…æ­»é”é—®é¢˜ï¼Ÿ\n\n### ä¸ºä»€ä¹ˆä¼šäº§ç”Ÿæ­»é”\n\nInnoDBé»˜è®¤çš„äº‹åŠ¡éš”ç¦»çº§åˆ«æ˜¯**å¯é‡å¤è¯»**ï¼Œåœ¨å¯é‡å¤è¯»äº‹åŠ¡éš”ç¦»çº§åˆ«ä¸‹å¤šä¸ªå¹¶å‘çš„äº‹åŠ¡å¯èƒ½ä¼šå¯¼è‡´å¹»è¯»é—®é¢˜ã€‚InnoDBä¸ºäº†æ—¢èƒ½ä¿è¯æ€§èƒ½ï¼ˆä¸ä½¿ç”¨ä¸²è¡ŒåŒ–éš”ç¦»çº§åˆ«ï¼‰åˆèƒ½è§£å†³å¹»è¯»é—®é¢˜ï¼Œä¾¿æå‡ºäº†**next-key**é”ï¼Œå®ƒæ˜¯è®°å½•é”å’Œé—´éš™é”çš„ç»„åˆ\n\n- Record keyï¼Œè®°å½•é”ï¼Œé”çš„æ˜¯è®°å½•æœ¬èº«\n- Gap keyï¼Œé—´éš™é”ï¼Œé”çš„æ˜¯ä¸¤ä¸ªå€¼çš„é—´éš™ï¼Œé˜²æ­¢å…¶ä»–äº‹åŠ¡åœ¨è¿™ä¸ªé—´éš™ä¸­æ’å…¥æ–°çš„è®°å½•ï¼Œä»è€Œé¿å…å¹»è¯»ç°è±¡\n\næ™®é€šçš„`select`è¯­å¥ä½¿ç”¨MVCCæœºåˆ¶å®ç°å¯é‡å¤è¯»ï¼Œå¹¶ä¸ä¼šå¯¹è®°å½•åŠ é”ï¼Œæƒ³è¦åœ¨**æŸ¥è¯¢è®°å½•æ—¶å¯¹è®°å½•åŠ é”**å¯ä»¥ä½¿ç”¨ä¸‹åˆ—ä¸¤ç§æ–¹å¼ï¼š\n\n```sql\nbegin:\n# å¯¹è¯»å–çš„è®°å½•åŠ å…±äº«é”\nselect ... lock in share mode;\ncommit; # æäº¤äº‹åŠ¡ï¼Œé‡Šæ”¾é”\n\n\nbegin:\n# å¯¹è¯»å–çš„è®°å½•åŠ \nselect ... for update;\ncommit; #\n```\n\n> æ€ä¹ˆç¡®å®šåŠ é”ç±»å‹çš„â“â“â“\n\n**è¡Œé”çš„é‡Šæ”¾æ—¶æœºæ˜¯åœ¨äº‹åŠ¡æäº¤ä¹‹åï¼Œå¹¶ä¸æ˜¯æ‰§è¡Œå®Œä¸€æ¡è¯­å¥å°±ä¼šé‡Šæ”¾é”**\n\nâš ï¸ï¼šå¦‚æœupdateè¯­å¥ä¸­**whereæ¡ä»¶æ²¡æœ‰ä½¿ç”¨ç´¢å¼•åˆ—**ï¼Œé‚£ä¹ˆå°±ä¼šå¯¹å…¨è¡¨è¿›è¡Œæ‰«æï¼Œæ‰€æœ‰çš„è®°å½•éƒ½ä¼šè¢«ä¸Šè¡Œé”ï¼Œè®°å½•å’Œè®°å½•ä¹‹é—´çš„é—´éš™ä¼šè¢«ä¸Šé—´éš™é”ï¼Œä¹Ÿå°±æ˜¯è¯´ï¼Œ**æ•´ä¸ªè¡¨éƒ½è¢«ä¸Šé”äº†**ğŸ˜‚ï¼Œç›´åˆ°äº‹åŠ¡ç»“æŸåæ‰ä¼šé‡Šæ”¾ã€‚è¿™å°±ä¼šå¯¼è‡´å…¶ä»–äº‹åŠ¡åœæ»ï¼Œé€ æˆæå¤§çš„æ€§èƒ½æŸå¤±\n\n- æ’å…¥æ„å‘é”å’Œé—´éš™é”æ˜¯å†²çªçš„ï¼Œæ‰€ä»¥å½“å…¶ä»–äº‹åŠ¡æŒæœ‰è¯¥é—´éš™çš„é—´éš™é”æ—¶ï¼Œä¹‹ååœ¨è¿™äº›äº‹åŠ¡æäº¤å¹¶é‡Šæ”¾é”ä¹‹åï¼Œäº‹åŠ¡Aæ‰èƒ½æ‹¿åˆ°æ’å…¥æ„å‘é”ã€‚\n- è€Œé—´éš™é”å’Œé—´éš™é”ä¹‹é—´æ—¶å…¼å®¹çš„ï¼Œå³ä¸¤ä¸ªäº‹åŠ¡æ‹¿ç€çš„é—´éš™é”æ‰€ä¸Šé”çš„åŒºé—´æ˜¯å…è®¸æœ‰é‡å éƒ¨åˆ†çš„ã€‚\n\næ­£æ˜¯å› ä¸ºä¸Šè¿°ä¸¤ä¸ªåŸå› ï¼Œåœ¨æŸäº›æƒ…å†µä¸‹å°±ä¼šæœ‰æ­»é”å‘ç”ŸğŸŒ°ï¼š\n\n![image-20240926084318858](https://raw.githubusercontent.com/lyydsheep/pic/main/202409260844452.png)\n\n### å¦‚ä½•é¿å…æ­»é”\n\næ­»é”äº§ç”Ÿçš„å››ä¸ªå¿…è¦æ¡ä»¶ï¼š<font color='blue'>**äº’æ–¥ã€å æœ‰å¹¶ç­‰å¾…ã€éæŠ¢å ã€å¾ªç¯ç­‰å¾…**</font>ã€‚å¦‚æœç³»ç»Ÿå‘ç”Ÿäº†æ­»é”ï¼Œåªè¦ç ´ç¯å››ä¸ªå¿…è¦æ¡ä»¶ä¸­çš„ä»»æ„ä¸€ä¸ªå°±èƒ½è§£é™¤æ­»é”\n\nåœ¨æ•°æ®åº“å±‚é¢æœ‰ä¸¤ç§ç­–ç•¥æ‰“ç ´**å¾ªç¯ç­‰å¾…**æ¡ä»¶æ¥è§£é™¤æ­»é”ï¼š\n\n- **è®¾ç½®äº‹åŠ¡ç­‰å¾…é”çš„é˜ˆå€¼æ—¶é—´**ï¼šå½“äº‹åŠ¡ç­‰å¾…é”çš„æ—¶é—´è¶…è¿‡é˜ˆå€¼ï¼Œå°±ä¸»åŠ¨è¿›è¡Œå›æ»šæ“ä½œï¼Œå°†é”é‡Šæ”¾ï¼Œé‚£ä¹ˆå¦ä¸€ä¸ªäº‹åŠ¡å°±èƒ½ç»§ç»­æ‰§è¡Œäº†\n- **å¼€å¯ä¸»åŠ¨æ­»é”æ£€æµ‹**ï¼šå½“æ£€æµ‹åˆ°å‘ç”Ÿæ­»é”åï¼Œä¸»åŠ¨å›æ»šæ­»é”é“¾æ¡ä¸­çš„ä¸€ä¸ªäº‹åŠ¡ï¼Œè®©å…¶ä»–äº‹åŠ¡èƒ½å¤Ÿæ­£å¸¸æ‰§è¡Œ\n\n## æ‚²è§‚é”å’Œä¹è§‚é”\n\n### æ‚²è§‚é”å’Œä¹è§‚é”\n\n**æ‚²è§‚é”ï¼ˆPessimistic Lockï¼‰**ï¼šæ‚²è§‚åœ°è®¤ä¸ºæ¯æ‹¿åˆ°æ•°æ®çš„è¿™æ®µæ—¶é—´ï¼Œåˆ«çš„çº¿ç¨‹ä¼šå¯¹æ•°æ®è¿›è¡Œä¿®æ”¹ï¼Œæ‰€ä»¥æ¯æ¬¡æ‹¿æ•°æ®ç›´æ¥éƒ½å¯¹æ•°æ®ä¸Šé”ï¼Œé˜²æ­¢åˆ«çš„çº¿ç¨‹æ‹¿åˆ°æ•°æ®ã€‚**æ‚²è§‚é”ä¸­çš„å…±äº«èµ„æºæ¯æ¬¡åªç»™ä¸€ä¸ªçº¿ç¨‹ä½¿ç”¨ï¼Œå…¶ä»–çº¿ç¨‹åˆ™ä¼šè¢«é˜»å¡ï¼Œç›´è‡³æ‚²è§‚é”é‡Šæ”¾**\n\næ‚²è§‚é”çš„å¹¶å‘æ§åˆ¶å®è´¨ä¸Šæ˜¯é‡‡ç”¨äº†**å…ˆä¸Šé”å†è®¿é—®**çš„ä¿å®ˆç­–ç•¥ï¼Œä¿è¯äº†å¹¶å‘ä¸‹æ•°æ®å®‰å…¨å¤„ç†ï¼Œä½†æ˜¯æ€§èƒ½è¾ƒå·®\n\n![image-20240927100026612](https://raw.githubusercontent.com/lyydsheep/pic/main/202409271000655.png)\n\n**ä¹è§‚é”ï¼ˆOptimistic Lockï¼‰**ï¼šä¹è§‚åœ°è®¤ä¸ºæ‹¿åˆ°æ•°æ®çš„è¿™æ®µæ—¶é—´ï¼Œåˆ«çš„çº¿ç¨‹ä¸ä¼šå¯¹æ•°æ®è¿›è¡Œä¿®æ”¹ï¼Œåªæœ‰åœ¨**æƒ³è¦æ›´æ–°æ•°æ®æ—¶æ‰æ£€æŸ¥æ•°æ®æ˜¯å¦è¢«åˆ«çš„çº¿ç¨‹æ›´æ–°è¿‡**ã€‚å¦‚æœæ›´æ–°è¿‡ï¼Œåˆ™é‡æ–°è¯»å–ï¼Œå¹¶å†æ¬¡å°è¯•æ›´æ–°ï¼Œå¾ªç¯æ­¤æ­¥éª¤ç›´è‡³æ›´æ–°æˆåŠŸï¼ˆæˆ–è¶…æ—¶ï¼‰\n\n![image-20240927100556216](https://raw.githubusercontent.com/lyydsheep/pic/main/202409271005257.png)\n\nä¹è§‚é”è®¤ä¸ºå‘ç”Ÿæ•°æ®ç«äº‰çš„æ¦‚ç‡æ¯”è¾ƒå°ï¼Œåªæœ‰åœ¨æ›´æ–°çš„æ—¶å€™æ‰ä¼šè¿›è¡Œæ•°æ®æ ¡éªŒï¼Œå®é™…ä¸Š**ä¸ä¼šä¸Šé”**ï¼Œæ‰€ä»¥ä¸ä¼šäº§ç”Ÿæ­»é”ç°è±¡\n\nCASï¼ˆcompare and swapï¼‰å³æ¯”è¾ƒå¹¶æ›¿æ¢\n\n- æ¯”è¾ƒï¼šè¯»å–åˆ°ä¸€ä¸ªæ•°æ®å€¼ä¸ºAï¼Œåœ¨å°†å…¶æ›´æ–°ä¸ºBä¹‹å‰ï¼Œå…ˆæ£€æŸ¥ä¸€ä¸‹åŸå€¼æ˜¯å¦ä»æ˜¯A\n- å¦‚æœä¸æ˜¯ï¼Œåˆ™æ”¾å¼ƒæ›´æ”¹\n- å¦‚æœæ˜¯ï¼Œåˆ™å°†æ•°æ®å€¼è®¾ç½®ä¸ºB\n\n`compare`å’Œ`swap`ä¸¤æ­¥æ“ä½œæ˜¯åŸå­æ€§çš„ï¼Œåœ¨CPUçœ‹æ¥å°±æ˜¯ä¸€æ­¥æ“ä½œ\n\n**ABAé—®é¢˜**ï¼šå¦‚æœæŸä¸ªæ•°æ®åˆå€¼ä¸ºAï¼Œä½†æ˜¯åˆ«çš„çº¿ç¨‹å°†å…¶æ”¹ä¸ºCååˆä¿®æ”¹æˆäº†Aï¼Œæ­¤æ—¶åœ¨CASæ£€æŸ¥è¿‡ç¨‹ä¸­å°±è¯¯è®¤ä¸ºæ•°æ®å¹¶æ²¡æœ‰è¢«ä¿®æ”¹ã€‚è¿™ä¸ªé—®é¢˜å°±æ˜¯CASä¸­çš„**ABAé—®é¢˜**\n\n**ABAé—®é¢˜çš„è§£å†³**ï¼šå¯ä»¥å¢åŠ ä¸€ä¸ªç‰ˆæœ¬å·ï¼ˆversionï¼‰å­—æ®µï¼Œæ¯æ¬¡æ›´æ–°æ“ä½œéƒ½è¦å¯¹`version+1`ï¼Œåœ¨CASæ£€æŸ¥è¿‡ç¨‹ä¸­ä¸ä»…ä»…æ£€æŸ¥æ•°æ®å€¼è¿˜è¦æ£€æŸ¥ç‰ˆæœ¬å·æ˜¯å¦ä¿®æ”¹\n\nâš ï¸ï¼š\n\n- ä¹è§‚é”å¹¶æœªçœŸæ­£åŠ é”ï¼Œæ•ˆç‡è¾ƒé«˜ï¼Œé€‚ç”¨äºå†™æ¯”è¾ƒå°‘çš„æƒ…å†µï¼Œæ›´æ–°å¤±è´¥æ¦‚ç‡æ¯”è¾ƒé«˜\n- æ‚²è§‚é”ä¾èµ–äºæ•°æ®åº“é”ï¼Œæ•ˆç‡ä½ï¼Œæ›´æ–°å¤±è´¥æ¦‚ç‡æ¯”è¾ƒä½","source":"_posts/MySQL/MySQLé”å­¦ä¹ .md","raw":"---\ntitle: MySQLé”å­¦ä¹ \npublish: true\ndescription: è®°å½•ä¸€äº›æœ‰å…³MySQLé”çš„çŸ¥è¯†ç‚¹\ndate: 2024-09-27 \ntag: MySQL\n---\n\n# é”\n\n## é”ç±»å‹\n\naba\n\n## è¡Œçº§é”\n\naba\n\n## MDLé”\n\naba\n\n## æ­»é”\n\n> æ­»é”æ˜¯æ€ä¹ˆå‘ç”Ÿçš„ï¼Ÿ\n>\n> å‘ç”Ÿæ­»é”çš„æ¡ä»¶æœ‰å“ªäº›ï¼Ÿ\n>\n> æ€ä¹ˆæ’æŸ¥æ­»é”é—®é¢˜ï¼Ÿ\n>\n> æ€ä¹ˆé¿å…æ­»é”é—®é¢˜ï¼Ÿ\n\n### ä¸ºä»€ä¹ˆä¼šäº§ç”Ÿæ­»é”\n\nInnoDBé»˜è®¤çš„äº‹åŠ¡éš”ç¦»çº§åˆ«æ˜¯**å¯é‡å¤è¯»**ï¼Œåœ¨å¯é‡å¤è¯»äº‹åŠ¡éš”ç¦»çº§åˆ«ä¸‹å¤šä¸ªå¹¶å‘çš„äº‹åŠ¡å¯èƒ½ä¼šå¯¼è‡´å¹»è¯»é—®é¢˜ã€‚InnoDBä¸ºäº†æ—¢èƒ½ä¿è¯æ€§èƒ½ï¼ˆä¸ä½¿ç”¨ä¸²è¡ŒåŒ–éš”ç¦»çº§åˆ«ï¼‰åˆèƒ½è§£å†³å¹»è¯»é—®é¢˜ï¼Œä¾¿æå‡ºäº†**next-key**é”ï¼Œå®ƒæ˜¯è®°å½•é”å’Œé—´éš™é”çš„ç»„åˆ\n\n- Record keyï¼Œè®°å½•é”ï¼Œé”çš„æ˜¯è®°å½•æœ¬èº«\n- Gap keyï¼Œé—´éš™é”ï¼Œé”çš„æ˜¯ä¸¤ä¸ªå€¼çš„é—´éš™ï¼Œé˜²æ­¢å…¶ä»–äº‹åŠ¡åœ¨è¿™ä¸ªé—´éš™ä¸­æ’å…¥æ–°çš„è®°å½•ï¼Œä»è€Œé¿å…å¹»è¯»ç°è±¡\n\næ™®é€šçš„`select`è¯­å¥ä½¿ç”¨MVCCæœºåˆ¶å®ç°å¯é‡å¤è¯»ï¼Œå¹¶ä¸ä¼šå¯¹è®°å½•åŠ é”ï¼Œæƒ³è¦åœ¨**æŸ¥è¯¢è®°å½•æ—¶å¯¹è®°å½•åŠ é”**å¯ä»¥ä½¿ç”¨ä¸‹åˆ—ä¸¤ç§æ–¹å¼ï¼š\n\n```sql\nbegin:\n# å¯¹è¯»å–çš„è®°å½•åŠ å…±äº«é”\nselect ... lock in share mode;\ncommit; # æäº¤äº‹åŠ¡ï¼Œé‡Šæ”¾é”\n\n\nbegin:\n# å¯¹è¯»å–çš„è®°å½•åŠ \nselect ... for update;\ncommit; #\n```\n\n> æ€ä¹ˆç¡®å®šåŠ é”ç±»å‹çš„â“â“â“\n\n**è¡Œé”çš„é‡Šæ”¾æ—¶æœºæ˜¯åœ¨äº‹åŠ¡æäº¤ä¹‹åï¼Œå¹¶ä¸æ˜¯æ‰§è¡Œå®Œä¸€æ¡è¯­å¥å°±ä¼šé‡Šæ”¾é”**\n\nâš ï¸ï¼šå¦‚æœupdateè¯­å¥ä¸­**whereæ¡ä»¶æ²¡æœ‰ä½¿ç”¨ç´¢å¼•åˆ—**ï¼Œé‚£ä¹ˆå°±ä¼šå¯¹å…¨è¡¨è¿›è¡Œæ‰«æï¼Œæ‰€æœ‰çš„è®°å½•éƒ½ä¼šè¢«ä¸Šè¡Œé”ï¼Œè®°å½•å’Œè®°å½•ä¹‹é—´çš„é—´éš™ä¼šè¢«ä¸Šé—´éš™é”ï¼Œä¹Ÿå°±æ˜¯è¯´ï¼Œ**æ•´ä¸ªè¡¨éƒ½è¢«ä¸Šé”äº†**ğŸ˜‚ï¼Œç›´åˆ°äº‹åŠ¡ç»“æŸåæ‰ä¼šé‡Šæ”¾ã€‚è¿™å°±ä¼šå¯¼è‡´å…¶ä»–äº‹åŠ¡åœæ»ï¼Œé€ æˆæå¤§çš„æ€§èƒ½æŸå¤±\n\n- æ’å…¥æ„å‘é”å’Œé—´éš™é”æ˜¯å†²çªçš„ï¼Œæ‰€ä»¥å½“å…¶ä»–äº‹åŠ¡æŒæœ‰è¯¥é—´éš™çš„é—´éš™é”æ—¶ï¼Œä¹‹ååœ¨è¿™äº›äº‹åŠ¡æäº¤å¹¶é‡Šæ”¾é”ä¹‹åï¼Œäº‹åŠ¡Aæ‰èƒ½æ‹¿åˆ°æ’å…¥æ„å‘é”ã€‚\n- è€Œé—´éš™é”å’Œé—´éš™é”ä¹‹é—´æ—¶å…¼å®¹çš„ï¼Œå³ä¸¤ä¸ªäº‹åŠ¡æ‹¿ç€çš„é—´éš™é”æ‰€ä¸Šé”çš„åŒºé—´æ˜¯å…è®¸æœ‰é‡å éƒ¨åˆ†çš„ã€‚\n\næ­£æ˜¯å› ä¸ºä¸Šè¿°ä¸¤ä¸ªåŸå› ï¼Œåœ¨æŸäº›æƒ…å†µä¸‹å°±ä¼šæœ‰æ­»é”å‘ç”ŸğŸŒ°ï¼š\n\n![image-20240926084318858](https://raw.githubusercontent.com/lyydsheep/pic/main/202409260844452.png)\n\n### å¦‚ä½•é¿å…æ­»é”\n\næ­»é”äº§ç”Ÿçš„å››ä¸ªå¿…è¦æ¡ä»¶ï¼š<font color='blue'>**äº’æ–¥ã€å æœ‰å¹¶ç­‰å¾…ã€éæŠ¢å ã€å¾ªç¯ç­‰å¾…**</font>ã€‚å¦‚æœç³»ç»Ÿå‘ç”Ÿäº†æ­»é”ï¼Œåªè¦ç ´ç¯å››ä¸ªå¿…è¦æ¡ä»¶ä¸­çš„ä»»æ„ä¸€ä¸ªå°±èƒ½è§£é™¤æ­»é”\n\nåœ¨æ•°æ®åº“å±‚é¢æœ‰ä¸¤ç§ç­–ç•¥æ‰“ç ´**å¾ªç¯ç­‰å¾…**æ¡ä»¶æ¥è§£é™¤æ­»é”ï¼š\n\n- **è®¾ç½®äº‹åŠ¡ç­‰å¾…é”çš„é˜ˆå€¼æ—¶é—´**ï¼šå½“äº‹åŠ¡ç­‰å¾…é”çš„æ—¶é—´è¶…è¿‡é˜ˆå€¼ï¼Œå°±ä¸»åŠ¨è¿›è¡Œå›æ»šæ“ä½œï¼Œå°†é”é‡Šæ”¾ï¼Œé‚£ä¹ˆå¦ä¸€ä¸ªäº‹åŠ¡å°±èƒ½ç»§ç»­æ‰§è¡Œäº†\n- **å¼€å¯ä¸»åŠ¨æ­»é”æ£€æµ‹**ï¼šå½“æ£€æµ‹åˆ°å‘ç”Ÿæ­»é”åï¼Œä¸»åŠ¨å›æ»šæ­»é”é“¾æ¡ä¸­çš„ä¸€ä¸ªäº‹åŠ¡ï¼Œè®©å…¶ä»–äº‹åŠ¡èƒ½å¤Ÿæ­£å¸¸æ‰§è¡Œ\n\n## æ‚²è§‚é”å’Œä¹è§‚é”\n\n### æ‚²è§‚é”å’Œä¹è§‚é”\n\n**æ‚²è§‚é”ï¼ˆPessimistic Lockï¼‰**ï¼šæ‚²è§‚åœ°è®¤ä¸ºæ¯æ‹¿åˆ°æ•°æ®çš„è¿™æ®µæ—¶é—´ï¼Œåˆ«çš„çº¿ç¨‹ä¼šå¯¹æ•°æ®è¿›è¡Œä¿®æ”¹ï¼Œæ‰€ä»¥æ¯æ¬¡æ‹¿æ•°æ®ç›´æ¥éƒ½å¯¹æ•°æ®ä¸Šé”ï¼Œé˜²æ­¢åˆ«çš„çº¿ç¨‹æ‹¿åˆ°æ•°æ®ã€‚**æ‚²è§‚é”ä¸­çš„å…±äº«èµ„æºæ¯æ¬¡åªç»™ä¸€ä¸ªçº¿ç¨‹ä½¿ç”¨ï¼Œå…¶ä»–çº¿ç¨‹åˆ™ä¼šè¢«é˜»å¡ï¼Œç›´è‡³æ‚²è§‚é”é‡Šæ”¾**\n\næ‚²è§‚é”çš„å¹¶å‘æ§åˆ¶å®è´¨ä¸Šæ˜¯é‡‡ç”¨äº†**å…ˆä¸Šé”å†è®¿é—®**çš„ä¿å®ˆç­–ç•¥ï¼Œä¿è¯äº†å¹¶å‘ä¸‹æ•°æ®å®‰å…¨å¤„ç†ï¼Œä½†æ˜¯æ€§èƒ½è¾ƒå·®\n\n![image-20240927100026612](https://raw.githubusercontent.com/lyydsheep/pic/main/202409271000655.png)\n\n**ä¹è§‚é”ï¼ˆOptimistic Lockï¼‰**ï¼šä¹è§‚åœ°è®¤ä¸ºæ‹¿åˆ°æ•°æ®çš„è¿™æ®µæ—¶é—´ï¼Œåˆ«çš„çº¿ç¨‹ä¸ä¼šå¯¹æ•°æ®è¿›è¡Œä¿®æ”¹ï¼Œåªæœ‰åœ¨**æƒ³è¦æ›´æ–°æ•°æ®æ—¶æ‰æ£€æŸ¥æ•°æ®æ˜¯å¦è¢«åˆ«çš„çº¿ç¨‹æ›´æ–°è¿‡**ã€‚å¦‚æœæ›´æ–°è¿‡ï¼Œåˆ™é‡æ–°è¯»å–ï¼Œå¹¶å†æ¬¡å°è¯•æ›´æ–°ï¼Œå¾ªç¯æ­¤æ­¥éª¤ç›´è‡³æ›´æ–°æˆåŠŸï¼ˆæˆ–è¶…æ—¶ï¼‰\n\n![image-20240927100556216](https://raw.githubusercontent.com/lyydsheep/pic/main/202409271005257.png)\n\nä¹è§‚é”è®¤ä¸ºå‘ç”Ÿæ•°æ®ç«äº‰çš„æ¦‚ç‡æ¯”è¾ƒå°ï¼Œåªæœ‰åœ¨æ›´æ–°çš„æ—¶å€™æ‰ä¼šè¿›è¡Œæ•°æ®æ ¡éªŒï¼Œå®é™…ä¸Š**ä¸ä¼šä¸Šé”**ï¼Œæ‰€ä»¥ä¸ä¼šäº§ç”Ÿæ­»é”ç°è±¡\n\nCASï¼ˆcompare and swapï¼‰å³æ¯”è¾ƒå¹¶æ›¿æ¢\n\n- æ¯”è¾ƒï¼šè¯»å–åˆ°ä¸€ä¸ªæ•°æ®å€¼ä¸ºAï¼Œåœ¨å°†å…¶æ›´æ–°ä¸ºBä¹‹å‰ï¼Œå…ˆæ£€æŸ¥ä¸€ä¸‹åŸå€¼æ˜¯å¦ä»æ˜¯A\n- å¦‚æœä¸æ˜¯ï¼Œåˆ™æ”¾å¼ƒæ›´æ”¹\n- å¦‚æœæ˜¯ï¼Œåˆ™å°†æ•°æ®å€¼è®¾ç½®ä¸ºB\n\n`compare`å’Œ`swap`ä¸¤æ­¥æ“ä½œæ˜¯åŸå­æ€§çš„ï¼Œåœ¨CPUçœ‹æ¥å°±æ˜¯ä¸€æ­¥æ“ä½œ\n\n**ABAé—®é¢˜**ï¼šå¦‚æœæŸä¸ªæ•°æ®åˆå€¼ä¸ºAï¼Œä½†æ˜¯åˆ«çš„çº¿ç¨‹å°†å…¶æ”¹ä¸ºCååˆä¿®æ”¹æˆäº†Aï¼Œæ­¤æ—¶åœ¨CASæ£€æŸ¥è¿‡ç¨‹ä¸­å°±è¯¯è®¤ä¸ºæ•°æ®å¹¶æ²¡æœ‰è¢«ä¿®æ”¹ã€‚è¿™ä¸ªé—®é¢˜å°±æ˜¯CASä¸­çš„**ABAé—®é¢˜**\n\n**ABAé—®é¢˜çš„è§£å†³**ï¼šå¯ä»¥å¢åŠ ä¸€ä¸ªç‰ˆæœ¬å·ï¼ˆversionï¼‰å­—æ®µï¼Œæ¯æ¬¡æ›´æ–°æ“ä½œéƒ½è¦å¯¹`version+1`ï¼Œåœ¨CASæ£€æŸ¥è¿‡ç¨‹ä¸­ä¸ä»…ä»…æ£€æŸ¥æ•°æ®å€¼è¿˜è¦æ£€æŸ¥ç‰ˆæœ¬å·æ˜¯å¦ä¿®æ”¹\n\nâš ï¸ï¼š\n\n- ä¹è§‚é”å¹¶æœªçœŸæ­£åŠ é”ï¼Œæ•ˆç‡è¾ƒé«˜ï¼Œé€‚ç”¨äºå†™æ¯”è¾ƒå°‘çš„æƒ…å†µï¼Œæ›´æ–°å¤±è´¥æ¦‚ç‡æ¯”è¾ƒé«˜\n- æ‚²è§‚é”ä¾èµ–äºæ•°æ®åº“é”ï¼Œæ•ˆç‡ä½ï¼Œæ›´æ–°å¤±è´¥æ¦‚ç‡æ¯”è¾ƒä½","slug":"MySQL/MySQLé”å­¦ä¹ ","published":1,"updated":"2024-12-27T11:03:15.343Z","comments":1,"layout":"post","photos":[],"_id":"cm6c7md6n002ia5t22exeelcy","content":"<h1 id=\"é”\"><a href=\"#é”\" class=\"headerlink\" title=\"é”\"></a>é”</h1><h2 id=\"é”ç±»å‹\"><a href=\"#é”ç±»å‹\" class=\"headerlink\" title=\"é”ç±»å‹\"></a>é”ç±»å‹</h2><p>aba</p>\n<h2 id=\"è¡Œçº§é”\"><a href=\"#è¡Œçº§é”\" class=\"headerlink\" title=\"è¡Œçº§é”\"></a>è¡Œçº§é”</h2><p>aba</p>\n<h2 id=\"MDLé”\"><a href=\"#MDLé”\" class=\"headerlink\" title=\"MDLé”\"></a>MDLé”</h2><p>aba</p>\n<h2 id=\"æ­»é”\"><a href=\"#æ­»é”\" class=\"headerlink\" title=\"æ­»é”\"></a>æ­»é”</h2><blockquote>\n<p>æ­»é”æ˜¯æ€ä¹ˆå‘ç”Ÿçš„ï¼Ÿ</p>\n<p>å‘ç”Ÿæ­»é”çš„æ¡ä»¶æœ‰å“ªäº›ï¼Ÿ</p>\n<p>æ€ä¹ˆæ’æŸ¥æ­»é”é—®é¢˜ï¼Ÿ</p>\n<p>æ€ä¹ˆé¿å…æ­»é”é—®é¢˜ï¼Ÿ</p>\n</blockquote>\n<h3 id=\"ä¸ºä»€ä¹ˆä¼šäº§ç”Ÿæ­»é”\"><a href=\"#ä¸ºä»€ä¹ˆä¼šäº§ç”Ÿæ­»é”\" class=\"headerlink\" title=\"ä¸ºä»€ä¹ˆä¼šäº§ç”Ÿæ­»é”\"></a>ä¸ºä»€ä¹ˆä¼šäº§ç”Ÿæ­»é”</h3><p>InnoDBé»˜è®¤çš„äº‹åŠ¡éš”ç¦»çº§åˆ«æ˜¯<strong>å¯é‡å¤è¯»</strong>ï¼Œåœ¨å¯é‡å¤è¯»äº‹åŠ¡éš”ç¦»çº§åˆ«ä¸‹å¤šä¸ªå¹¶å‘çš„äº‹åŠ¡å¯èƒ½ä¼šå¯¼è‡´å¹»è¯»é—®é¢˜ã€‚InnoDBä¸ºäº†æ—¢èƒ½ä¿è¯æ€§èƒ½ï¼ˆä¸ä½¿ç”¨ä¸²è¡ŒåŒ–éš”ç¦»çº§åˆ«ï¼‰åˆèƒ½è§£å†³å¹»è¯»é—®é¢˜ï¼Œä¾¿æå‡ºäº†<strong>next-key</strong>é”ï¼Œå®ƒæ˜¯è®°å½•é”å’Œé—´éš™é”çš„ç»„åˆ</p>\n<ul>\n<li>Record keyï¼Œè®°å½•é”ï¼Œé”çš„æ˜¯è®°å½•æœ¬èº«</li>\n<li>Gap keyï¼Œé—´éš™é”ï¼Œé”çš„æ˜¯ä¸¤ä¸ªå€¼çš„é—´éš™ï¼Œé˜²æ­¢å…¶ä»–äº‹åŠ¡åœ¨è¿™ä¸ªé—´éš™ä¸­æ’å…¥æ–°çš„è®°å½•ï¼Œä»è€Œé¿å…å¹»è¯»ç°è±¡</li>\n</ul>\n<p>æ™®é€šçš„<code>select</code>è¯­å¥ä½¿ç”¨MVCCæœºåˆ¶å®ç°å¯é‡å¤è¯»ï¼Œå¹¶ä¸ä¼šå¯¹è®°å½•åŠ é”ï¼Œæƒ³è¦åœ¨<strong>æŸ¥è¯¢è®°å½•æ—¶å¯¹è®°å½•åŠ é”</strong>å¯ä»¥ä½¿ç”¨ä¸‹åˆ—ä¸¤ç§æ–¹å¼ï¼š</p>\n<figure class=\"highlight sql\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">begin</span>:</span><br><span class=\"line\"># å¯¹è¯»å–çš„è®°å½•åŠ å…±äº«é”</span><br><span class=\"line\"><span class=\"keyword\">select</span> ... lock <span class=\"keyword\">in</span> share mode;</span><br><span class=\"line\"><span class=\"keyword\">commit</span>; # æäº¤äº‹åŠ¡ï¼Œé‡Šæ”¾é”</span><br><span class=\"line\"></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"keyword\">begin</span>:</span><br><span class=\"line\"># å¯¹è¯»å–çš„è®°å½•åŠ </span><br><span class=\"line\"><span class=\"keyword\">select</span> ... <span class=\"keyword\">for</span> <span class=\"keyword\">update</span>;</span><br><span class=\"line\"><span class=\"keyword\">commit</span>; #</span><br></pre></td></tr></table></figure>\n\n<blockquote>\n<p>æ€ä¹ˆç¡®å®šåŠ é”ç±»å‹çš„â“â“â“</p>\n</blockquote>\n<p><strong>è¡Œé”çš„é‡Šæ”¾æ—¶æœºæ˜¯åœ¨äº‹åŠ¡æäº¤ä¹‹åï¼Œå¹¶ä¸æ˜¯æ‰§è¡Œå®Œä¸€æ¡è¯­å¥å°±ä¼šé‡Šæ”¾é”</strong></p>\n<p>âš ï¸ï¼šå¦‚æœupdateè¯­å¥ä¸­<strong>whereæ¡ä»¶æ²¡æœ‰ä½¿ç”¨ç´¢å¼•åˆ—</strong>ï¼Œé‚£ä¹ˆå°±ä¼šå¯¹å…¨è¡¨è¿›è¡Œæ‰«æï¼Œæ‰€æœ‰çš„è®°å½•éƒ½ä¼šè¢«ä¸Šè¡Œé”ï¼Œè®°å½•å’Œè®°å½•ä¹‹é—´çš„é—´éš™ä¼šè¢«ä¸Šé—´éš™é”ï¼Œä¹Ÿå°±æ˜¯è¯´ï¼Œ<strong>æ•´ä¸ªè¡¨éƒ½è¢«ä¸Šé”äº†</strong>ğŸ˜‚ï¼Œç›´åˆ°äº‹åŠ¡ç»“æŸåæ‰ä¼šé‡Šæ”¾ã€‚è¿™å°±ä¼šå¯¼è‡´å…¶ä»–äº‹åŠ¡åœæ»ï¼Œé€ æˆæå¤§çš„æ€§èƒ½æŸå¤±</p>\n<ul>\n<li>æ’å…¥æ„å‘é”å’Œé—´éš™é”æ˜¯å†²çªçš„ï¼Œæ‰€ä»¥å½“å…¶ä»–äº‹åŠ¡æŒæœ‰è¯¥é—´éš™çš„é—´éš™é”æ—¶ï¼Œä¹‹ååœ¨è¿™äº›äº‹åŠ¡æäº¤å¹¶é‡Šæ”¾é”ä¹‹åï¼Œäº‹åŠ¡Aæ‰èƒ½æ‹¿åˆ°æ’å…¥æ„å‘é”ã€‚</li>\n<li>è€Œé—´éš™é”å’Œé—´éš™é”ä¹‹é—´æ—¶å…¼å®¹çš„ï¼Œå³ä¸¤ä¸ªäº‹åŠ¡æ‹¿ç€çš„é—´éš™é”æ‰€ä¸Šé”çš„åŒºé—´æ˜¯å…è®¸æœ‰é‡å éƒ¨åˆ†çš„ã€‚</li>\n</ul>\n<p>æ­£æ˜¯å› ä¸ºä¸Šè¿°ä¸¤ä¸ªåŸå› ï¼Œåœ¨æŸäº›æƒ…å†µä¸‹å°±ä¼šæœ‰æ­»é”å‘ç”ŸğŸŒ°ï¼š</p>\n<p><img src=\"https://raw.githubusercontent.com/lyydsheep/pic/main/202409260844452.png\" alt=\"image-20240926084318858\"></p>\n<h3 id=\"å¦‚ä½•é¿å…æ­»é”\"><a href=\"#å¦‚ä½•é¿å…æ­»é”\" class=\"headerlink\" title=\"å¦‚ä½•é¿å…æ­»é”\"></a>å¦‚ä½•é¿å…æ­»é”</h3><p>æ­»é”äº§ç”Ÿçš„å››ä¸ªå¿…è¦æ¡ä»¶ï¼š<font color='blue'><strong>äº’æ–¥ã€å æœ‰å¹¶ç­‰å¾…ã€éæŠ¢å ã€å¾ªç¯ç­‰å¾…</strong></font>ã€‚å¦‚æœç³»ç»Ÿå‘ç”Ÿäº†æ­»é”ï¼Œåªè¦ç ´ç¯å››ä¸ªå¿…è¦æ¡ä»¶ä¸­çš„ä»»æ„ä¸€ä¸ªå°±èƒ½è§£é™¤æ­»é”</p>\n<p>åœ¨æ•°æ®åº“å±‚é¢æœ‰ä¸¤ç§ç­–ç•¥æ‰“ç ´<strong>å¾ªç¯ç­‰å¾…</strong>æ¡ä»¶æ¥è§£é™¤æ­»é”ï¼š</p>\n<ul>\n<li><strong>è®¾ç½®äº‹åŠ¡ç­‰å¾…é”çš„é˜ˆå€¼æ—¶é—´</strong>ï¼šå½“äº‹åŠ¡ç­‰å¾…é”çš„æ—¶é—´è¶…è¿‡é˜ˆå€¼ï¼Œå°±ä¸»åŠ¨è¿›è¡Œå›æ»šæ“ä½œï¼Œå°†é”é‡Šæ”¾ï¼Œé‚£ä¹ˆå¦ä¸€ä¸ªäº‹åŠ¡å°±èƒ½ç»§ç»­æ‰§è¡Œäº†</li>\n<li><strong>å¼€å¯ä¸»åŠ¨æ­»é”æ£€æµ‹</strong>ï¼šå½“æ£€æµ‹åˆ°å‘ç”Ÿæ­»é”åï¼Œä¸»åŠ¨å›æ»šæ­»é”é“¾æ¡ä¸­çš„ä¸€ä¸ªäº‹åŠ¡ï¼Œè®©å…¶ä»–äº‹åŠ¡èƒ½å¤Ÿæ­£å¸¸æ‰§è¡Œ</li>\n</ul>\n<h2 id=\"æ‚²è§‚é”å’Œä¹è§‚é”\"><a href=\"#æ‚²è§‚é”å’Œä¹è§‚é”\" class=\"headerlink\" title=\"æ‚²è§‚é”å’Œä¹è§‚é”\"></a>æ‚²è§‚é”å’Œä¹è§‚é”</h2><h3 id=\"æ‚²è§‚é”å’Œä¹è§‚é”-1\"><a href=\"#æ‚²è§‚é”å’Œä¹è§‚é”-1\" class=\"headerlink\" title=\"æ‚²è§‚é”å’Œä¹è§‚é”\"></a>æ‚²è§‚é”å’Œä¹è§‚é”</h3><p><strong>æ‚²è§‚é”ï¼ˆPessimistic Lockï¼‰</strong>ï¼šæ‚²è§‚åœ°è®¤ä¸ºæ¯æ‹¿åˆ°æ•°æ®çš„è¿™æ®µæ—¶é—´ï¼Œåˆ«çš„çº¿ç¨‹ä¼šå¯¹æ•°æ®è¿›è¡Œä¿®æ”¹ï¼Œæ‰€ä»¥æ¯æ¬¡æ‹¿æ•°æ®ç›´æ¥éƒ½å¯¹æ•°æ®ä¸Šé”ï¼Œé˜²æ­¢åˆ«çš„çº¿ç¨‹æ‹¿åˆ°æ•°æ®ã€‚<strong>æ‚²è§‚é”ä¸­çš„å…±äº«èµ„æºæ¯æ¬¡åªç»™ä¸€ä¸ªçº¿ç¨‹ä½¿ç”¨ï¼Œå…¶ä»–çº¿ç¨‹åˆ™ä¼šè¢«é˜»å¡ï¼Œç›´è‡³æ‚²è§‚é”é‡Šæ”¾</strong></p>\n<p>æ‚²è§‚é”çš„å¹¶å‘æ§åˆ¶å®è´¨ä¸Šæ˜¯é‡‡ç”¨äº†<strong>å…ˆä¸Šé”å†è®¿é—®</strong>çš„ä¿å®ˆç­–ç•¥ï¼Œä¿è¯äº†å¹¶å‘ä¸‹æ•°æ®å®‰å…¨å¤„ç†ï¼Œä½†æ˜¯æ€§èƒ½è¾ƒå·®</p>\n<p><img src=\"https://raw.githubusercontent.com/lyydsheep/pic/main/202409271000655.png\" alt=\"image-20240927100026612\"></p>\n<p><strong>ä¹è§‚é”ï¼ˆOptimistic Lockï¼‰</strong>ï¼šä¹è§‚åœ°è®¤ä¸ºæ‹¿åˆ°æ•°æ®çš„è¿™æ®µæ—¶é—´ï¼Œåˆ«çš„çº¿ç¨‹ä¸ä¼šå¯¹æ•°æ®è¿›è¡Œä¿®æ”¹ï¼Œåªæœ‰åœ¨<strong>æƒ³è¦æ›´æ–°æ•°æ®æ—¶æ‰æ£€æŸ¥æ•°æ®æ˜¯å¦è¢«åˆ«çš„çº¿ç¨‹æ›´æ–°è¿‡</strong>ã€‚å¦‚æœæ›´æ–°è¿‡ï¼Œåˆ™é‡æ–°è¯»å–ï¼Œå¹¶å†æ¬¡å°è¯•æ›´æ–°ï¼Œå¾ªç¯æ­¤æ­¥éª¤ç›´è‡³æ›´æ–°æˆåŠŸï¼ˆæˆ–è¶…æ—¶ï¼‰</p>\n<p><img src=\"https://raw.githubusercontent.com/lyydsheep/pic/main/202409271005257.png\" alt=\"image-20240927100556216\"></p>\n<p>ä¹è§‚é”è®¤ä¸ºå‘ç”Ÿæ•°æ®ç«äº‰çš„æ¦‚ç‡æ¯”è¾ƒå°ï¼Œåªæœ‰åœ¨æ›´æ–°çš„æ—¶å€™æ‰ä¼šè¿›è¡Œæ•°æ®æ ¡éªŒï¼Œå®é™…ä¸Š<strong>ä¸ä¼šä¸Šé”</strong>ï¼Œæ‰€ä»¥ä¸ä¼šäº§ç”Ÿæ­»é”ç°è±¡</p>\n<p>CASï¼ˆcompare and swapï¼‰å³æ¯”è¾ƒå¹¶æ›¿æ¢</p>\n<ul>\n<li>æ¯”è¾ƒï¼šè¯»å–åˆ°ä¸€ä¸ªæ•°æ®å€¼ä¸ºAï¼Œåœ¨å°†å…¶æ›´æ–°ä¸ºBä¹‹å‰ï¼Œå…ˆæ£€æŸ¥ä¸€ä¸‹åŸå€¼æ˜¯å¦ä»æ˜¯A</li>\n<li>å¦‚æœä¸æ˜¯ï¼Œåˆ™æ”¾å¼ƒæ›´æ”¹</li>\n<li>å¦‚æœæ˜¯ï¼Œåˆ™å°†æ•°æ®å€¼è®¾ç½®ä¸ºB</li>\n</ul>\n<p><code>compare</code>å’Œ<code>swap</code>ä¸¤æ­¥æ“ä½œæ˜¯åŸå­æ€§çš„ï¼Œåœ¨CPUçœ‹æ¥å°±æ˜¯ä¸€æ­¥æ“ä½œ</p>\n<p><strong>ABAé—®é¢˜</strong>ï¼šå¦‚æœæŸä¸ªæ•°æ®åˆå€¼ä¸ºAï¼Œä½†æ˜¯åˆ«çš„çº¿ç¨‹å°†å…¶æ”¹ä¸ºCååˆä¿®æ”¹æˆäº†Aï¼Œæ­¤æ—¶åœ¨CASæ£€æŸ¥è¿‡ç¨‹ä¸­å°±è¯¯è®¤ä¸ºæ•°æ®å¹¶æ²¡æœ‰è¢«ä¿®æ”¹ã€‚è¿™ä¸ªé—®é¢˜å°±æ˜¯CASä¸­çš„<strong>ABAé—®é¢˜</strong></p>\n<p><strong>ABAé—®é¢˜çš„è§£å†³</strong>ï¼šå¯ä»¥å¢åŠ ä¸€ä¸ªç‰ˆæœ¬å·ï¼ˆversionï¼‰å­—æ®µï¼Œæ¯æ¬¡æ›´æ–°æ“ä½œéƒ½è¦å¯¹<code>version+1</code>ï¼Œåœ¨CASæ£€æŸ¥è¿‡ç¨‹ä¸­ä¸ä»…ä»…æ£€æŸ¥æ•°æ®å€¼è¿˜è¦æ£€æŸ¥ç‰ˆæœ¬å·æ˜¯å¦ä¿®æ”¹</p>\n<p>âš ï¸ï¼š</p>\n<ul>\n<li>ä¹è§‚é”å¹¶æœªçœŸæ­£åŠ é”ï¼Œæ•ˆç‡è¾ƒé«˜ï¼Œé€‚ç”¨äºå†™æ¯”è¾ƒå°‘çš„æƒ…å†µï¼Œæ›´æ–°å¤±è´¥æ¦‚ç‡æ¯”è¾ƒé«˜</li>\n<li>æ‚²è§‚é”ä¾èµ–äºæ•°æ®åº“é”ï¼Œæ•ˆç‡ä½ï¼Œæ›´æ–°å¤±è´¥æ¦‚ç‡æ¯”è¾ƒä½</li>\n</ul>\n","excerpt":"","more":"<h1 id=\"é”\"><a href=\"#é”\" class=\"headerlink\" title=\"é”\"></a>é”</h1><h2 id=\"é”ç±»å‹\"><a href=\"#é”ç±»å‹\" class=\"headerlink\" title=\"é”ç±»å‹\"></a>é”ç±»å‹</h2><p>aba</p>\n<h2 id=\"è¡Œçº§é”\"><a href=\"#è¡Œçº§é”\" class=\"headerlink\" title=\"è¡Œçº§é”\"></a>è¡Œçº§é”</h2><p>aba</p>\n<h2 id=\"MDLé”\"><a href=\"#MDLé”\" class=\"headerlink\" title=\"MDLé”\"></a>MDLé”</h2><p>aba</p>\n<h2 id=\"æ­»é”\"><a href=\"#æ­»é”\" class=\"headerlink\" title=\"æ­»é”\"></a>æ­»é”</h2><blockquote>\n<p>æ­»é”æ˜¯æ€ä¹ˆå‘ç”Ÿçš„ï¼Ÿ</p>\n<p>å‘ç”Ÿæ­»é”çš„æ¡ä»¶æœ‰å“ªäº›ï¼Ÿ</p>\n<p>æ€ä¹ˆæ’æŸ¥æ­»é”é—®é¢˜ï¼Ÿ</p>\n<p>æ€ä¹ˆé¿å…æ­»é”é—®é¢˜ï¼Ÿ</p>\n</blockquote>\n<h3 id=\"ä¸ºä»€ä¹ˆä¼šäº§ç”Ÿæ­»é”\"><a href=\"#ä¸ºä»€ä¹ˆä¼šäº§ç”Ÿæ­»é”\" class=\"headerlink\" title=\"ä¸ºä»€ä¹ˆä¼šäº§ç”Ÿæ­»é”\"></a>ä¸ºä»€ä¹ˆä¼šäº§ç”Ÿæ­»é”</h3><p>InnoDBé»˜è®¤çš„äº‹åŠ¡éš”ç¦»çº§åˆ«æ˜¯<strong>å¯é‡å¤è¯»</strong>ï¼Œåœ¨å¯é‡å¤è¯»äº‹åŠ¡éš”ç¦»çº§åˆ«ä¸‹å¤šä¸ªå¹¶å‘çš„äº‹åŠ¡å¯èƒ½ä¼šå¯¼è‡´å¹»è¯»é—®é¢˜ã€‚InnoDBä¸ºäº†æ—¢èƒ½ä¿è¯æ€§èƒ½ï¼ˆä¸ä½¿ç”¨ä¸²è¡ŒåŒ–éš”ç¦»çº§åˆ«ï¼‰åˆèƒ½è§£å†³å¹»è¯»é—®é¢˜ï¼Œä¾¿æå‡ºäº†<strong>next-key</strong>é”ï¼Œå®ƒæ˜¯è®°å½•é”å’Œé—´éš™é”çš„ç»„åˆ</p>\n<ul>\n<li>Record keyï¼Œè®°å½•é”ï¼Œé”çš„æ˜¯è®°å½•æœ¬èº«</li>\n<li>Gap keyï¼Œé—´éš™é”ï¼Œé”çš„æ˜¯ä¸¤ä¸ªå€¼çš„é—´éš™ï¼Œé˜²æ­¢å…¶ä»–äº‹åŠ¡åœ¨è¿™ä¸ªé—´éš™ä¸­æ’å…¥æ–°çš„è®°å½•ï¼Œä»è€Œé¿å…å¹»è¯»ç°è±¡</li>\n</ul>\n<p>æ™®é€šçš„<code>select</code>è¯­å¥ä½¿ç”¨MVCCæœºåˆ¶å®ç°å¯é‡å¤è¯»ï¼Œå¹¶ä¸ä¼šå¯¹è®°å½•åŠ é”ï¼Œæƒ³è¦åœ¨<strong>æŸ¥è¯¢è®°å½•æ—¶å¯¹è®°å½•åŠ é”</strong>å¯ä»¥ä½¿ç”¨ä¸‹åˆ—ä¸¤ç§æ–¹å¼ï¼š</p>\n<figure class=\"highlight sql\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">begin</span>:</span><br><span class=\"line\"># å¯¹è¯»å–çš„è®°å½•åŠ å…±äº«é”</span><br><span class=\"line\"><span class=\"keyword\">select</span> ... lock <span class=\"keyword\">in</span> share mode;</span><br><span class=\"line\"><span class=\"keyword\">commit</span>; # æäº¤äº‹åŠ¡ï¼Œé‡Šæ”¾é”</span><br><span class=\"line\"></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"keyword\">begin</span>:</span><br><span class=\"line\"># å¯¹è¯»å–çš„è®°å½•åŠ </span><br><span class=\"line\"><span class=\"keyword\">select</span> ... <span class=\"keyword\">for</span> <span class=\"keyword\">update</span>;</span><br><span class=\"line\"><span class=\"keyword\">commit</span>; #</span><br></pre></td></tr></table></figure>\n\n<blockquote>\n<p>æ€ä¹ˆç¡®å®šåŠ é”ç±»å‹çš„â“â“â“</p>\n</blockquote>\n<p><strong>è¡Œé”çš„é‡Šæ”¾æ—¶æœºæ˜¯åœ¨äº‹åŠ¡æäº¤ä¹‹åï¼Œå¹¶ä¸æ˜¯æ‰§è¡Œå®Œä¸€æ¡è¯­å¥å°±ä¼šé‡Šæ”¾é”</strong></p>\n<p>âš ï¸ï¼šå¦‚æœupdateè¯­å¥ä¸­<strong>whereæ¡ä»¶æ²¡æœ‰ä½¿ç”¨ç´¢å¼•åˆ—</strong>ï¼Œé‚£ä¹ˆå°±ä¼šå¯¹å…¨è¡¨è¿›è¡Œæ‰«æï¼Œæ‰€æœ‰çš„è®°å½•éƒ½ä¼šè¢«ä¸Šè¡Œé”ï¼Œè®°å½•å’Œè®°å½•ä¹‹é—´çš„é—´éš™ä¼šè¢«ä¸Šé—´éš™é”ï¼Œä¹Ÿå°±æ˜¯è¯´ï¼Œ<strong>æ•´ä¸ªè¡¨éƒ½è¢«ä¸Šé”äº†</strong>ğŸ˜‚ï¼Œç›´åˆ°äº‹åŠ¡ç»“æŸåæ‰ä¼šé‡Šæ”¾ã€‚è¿™å°±ä¼šå¯¼è‡´å…¶ä»–äº‹åŠ¡åœæ»ï¼Œé€ æˆæå¤§çš„æ€§èƒ½æŸå¤±</p>\n<ul>\n<li>æ’å…¥æ„å‘é”å’Œé—´éš™é”æ˜¯å†²çªçš„ï¼Œæ‰€ä»¥å½“å…¶ä»–äº‹åŠ¡æŒæœ‰è¯¥é—´éš™çš„é—´éš™é”æ—¶ï¼Œä¹‹ååœ¨è¿™äº›äº‹åŠ¡æäº¤å¹¶é‡Šæ”¾é”ä¹‹åï¼Œäº‹åŠ¡Aæ‰èƒ½æ‹¿åˆ°æ’å…¥æ„å‘é”ã€‚</li>\n<li>è€Œé—´éš™é”å’Œé—´éš™é”ä¹‹é—´æ—¶å…¼å®¹çš„ï¼Œå³ä¸¤ä¸ªäº‹åŠ¡æ‹¿ç€çš„é—´éš™é”æ‰€ä¸Šé”çš„åŒºé—´æ˜¯å…è®¸æœ‰é‡å éƒ¨åˆ†çš„ã€‚</li>\n</ul>\n<p>æ­£æ˜¯å› ä¸ºä¸Šè¿°ä¸¤ä¸ªåŸå› ï¼Œåœ¨æŸäº›æƒ…å†µä¸‹å°±ä¼šæœ‰æ­»é”å‘ç”ŸğŸŒ°ï¼š</p>\n<p><img src=\"https://raw.githubusercontent.com/lyydsheep/pic/main/202409260844452.png\" alt=\"image-20240926084318858\"></p>\n<h3 id=\"å¦‚ä½•é¿å…æ­»é”\"><a href=\"#å¦‚ä½•é¿å…æ­»é”\" class=\"headerlink\" title=\"å¦‚ä½•é¿å…æ­»é”\"></a>å¦‚ä½•é¿å…æ­»é”</h3><p>æ­»é”äº§ç”Ÿçš„å››ä¸ªå¿…è¦æ¡ä»¶ï¼š<font color='blue'><strong>äº’æ–¥ã€å æœ‰å¹¶ç­‰å¾…ã€éæŠ¢å ã€å¾ªç¯ç­‰å¾…</strong></font>ã€‚å¦‚æœç³»ç»Ÿå‘ç”Ÿäº†æ­»é”ï¼Œåªè¦ç ´ç¯å››ä¸ªå¿…è¦æ¡ä»¶ä¸­çš„ä»»æ„ä¸€ä¸ªå°±èƒ½è§£é™¤æ­»é”</p>\n<p>åœ¨æ•°æ®åº“å±‚é¢æœ‰ä¸¤ç§ç­–ç•¥æ‰“ç ´<strong>å¾ªç¯ç­‰å¾…</strong>æ¡ä»¶æ¥è§£é™¤æ­»é”ï¼š</p>\n<ul>\n<li><strong>è®¾ç½®äº‹åŠ¡ç­‰å¾…é”çš„é˜ˆå€¼æ—¶é—´</strong>ï¼šå½“äº‹åŠ¡ç­‰å¾…é”çš„æ—¶é—´è¶…è¿‡é˜ˆå€¼ï¼Œå°±ä¸»åŠ¨è¿›è¡Œå›æ»šæ“ä½œï¼Œå°†é”é‡Šæ”¾ï¼Œé‚£ä¹ˆå¦ä¸€ä¸ªäº‹åŠ¡å°±èƒ½ç»§ç»­æ‰§è¡Œäº†</li>\n<li><strong>å¼€å¯ä¸»åŠ¨æ­»é”æ£€æµ‹</strong>ï¼šå½“æ£€æµ‹åˆ°å‘ç”Ÿæ­»é”åï¼Œä¸»åŠ¨å›æ»šæ­»é”é“¾æ¡ä¸­çš„ä¸€ä¸ªäº‹åŠ¡ï¼Œè®©å…¶ä»–äº‹åŠ¡èƒ½å¤Ÿæ­£å¸¸æ‰§è¡Œ</li>\n</ul>\n<h2 id=\"æ‚²è§‚é”å’Œä¹è§‚é”\"><a href=\"#æ‚²è§‚é”å’Œä¹è§‚é”\" class=\"headerlink\" title=\"æ‚²è§‚é”å’Œä¹è§‚é”\"></a>æ‚²è§‚é”å’Œä¹è§‚é”</h2><h3 id=\"æ‚²è§‚é”å’Œä¹è§‚é”-1\"><a href=\"#æ‚²è§‚é”å’Œä¹è§‚é”-1\" class=\"headerlink\" title=\"æ‚²è§‚é”å’Œä¹è§‚é”\"></a>æ‚²è§‚é”å’Œä¹è§‚é”</h3><p><strong>æ‚²è§‚é”ï¼ˆPessimistic Lockï¼‰</strong>ï¼šæ‚²è§‚åœ°è®¤ä¸ºæ¯æ‹¿åˆ°æ•°æ®çš„è¿™æ®µæ—¶é—´ï¼Œåˆ«çš„çº¿ç¨‹ä¼šå¯¹æ•°æ®è¿›è¡Œä¿®æ”¹ï¼Œæ‰€ä»¥æ¯æ¬¡æ‹¿æ•°æ®ç›´æ¥éƒ½å¯¹æ•°æ®ä¸Šé”ï¼Œé˜²æ­¢åˆ«çš„çº¿ç¨‹æ‹¿åˆ°æ•°æ®ã€‚<strong>æ‚²è§‚é”ä¸­çš„å…±äº«èµ„æºæ¯æ¬¡åªç»™ä¸€ä¸ªçº¿ç¨‹ä½¿ç”¨ï¼Œå…¶ä»–çº¿ç¨‹åˆ™ä¼šè¢«é˜»å¡ï¼Œç›´è‡³æ‚²è§‚é”é‡Šæ”¾</strong></p>\n<p>æ‚²è§‚é”çš„å¹¶å‘æ§åˆ¶å®è´¨ä¸Šæ˜¯é‡‡ç”¨äº†<strong>å…ˆä¸Šé”å†è®¿é—®</strong>çš„ä¿å®ˆç­–ç•¥ï¼Œä¿è¯äº†å¹¶å‘ä¸‹æ•°æ®å®‰å…¨å¤„ç†ï¼Œä½†æ˜¯æ€§èƒ½è¾ƒå·®</p>\n<p><img src=\"https://raw.githubusercontent.com/lyydsheep/pic/main/202409271000655.png\" alt=\"image-20240927100026612\"></p>\n<p><strong>ä¹è§‚é”ï¼ˆOptimistic Lockï¼‰</strong>ï¼šä¹è§‚åœ°è®¤ä¸ºæ‹¿åˆ°æ•°æ®çš„è¿™æ®µæ—¶é—´ï¼Œåˆ«çš„çº¿ç¨‹ä¸ä¼šå¯¹æ•°æ®è¿›è¡Œä¿®æ”¹ï¼Œåªæœ‰åœ¨<strong>æƒ³è¦æ›´æ–°æ•°æ®æ—¶æ‰æ£€æŸ¥æ•°æ®æ˜¯å¦è¢«åˆ«çš„çº¿ç¨‹æ›´æ–°è¿‡</strong>ã€‚å¦‚æœæ›´æ–°è¿‡ï¼Œåˆ™é‡æ–°è¯»å–ï¼Œå¹¶å†æ¬¡å°è¯•æ›´æ–°ï¼Œå¾ªç¯æ­¤æ­¥éª¤ç›´è‡³æ›´æ–°æˆåŠŸï¼ˆæˆ–è¶…æ—¶ï¼‰</p>\n<p><img src=\"https://raw.githubusercontent.com/lyydsheep/pic/main/202409271005257.png\" alt=\"image-20240927100556216\"></p>\n<p>ä¹è§‚é”è®¤ä¸ºå‘ç”Ÿæ•°æ®ç«äº‰çš„æ¦‚ç‡æ¯”è¾ƒå°ï¼Œåªæœ‰åœ¨æ›´æ–°çš„æ—¶å€™æ‰ä¼šè¿›è¡Œæ•°æ®æ ¡éªŒï¼Œå®é™…ä¸Š<strong>ä¸ä¼šä¸Šé”</strong>ï¼Œæ‰€ä»¥ä¸ä¼šäº§ç”Ÿæ­»é”ç°è±¡</p>\n<p>CASï¼ˆcompare and swapï¼‰å³æ¯”è¾ƒå¹¶æ›¿æ¢</p>\n<ul>\n<li>æ¯”è¾ƒï¼šè¯»å–åˆ°ä¸€ä¸ªæ•°æ®å€¼ä¸ºAï¼Œåœ¨å°†å…¶æ›´æ–°ä¸ºBä¹‹å‰ï¼Œå…ˆæ£€æŸ¥ä¸€ä¸‹åŸå€¼æ˜¯å¦ä»æ˜¯A</li>\n<li>å¦‚æœä¸æ˜¯ï¼Œåˆ™æ”¾å¼ƒæ›´æ”¹</li>\n<li>å¦‚æœæ˜¯ï¼Œåˆ™å°†æ•°æ®å€¼è®¾ç½®ä¸ºB</li>\n</ul>\n<p><code>compare</code>å’Œ<code>swap</code>ä¸¤æ­¥æ“ä½œæ˜¯åŸå­æ€§çš„ï¼Œåœ¨CPUçœ‹æ¥å°±æ˜¯ä¸€æ­¥æ“ä½œ</p>\n<p><strong>ABAé—®é¢˜</strong>ï¼šå¦‚æœæŸä¸ªæ•°æ®åˆå€¼ä¸ºAï¼Œä½†æ˜¯åˆ«çš„çº¿ç¨‹å°†å…¶æ”¹ä¸ºCååˆä¿®æ”¹æˆäº†Aï¼Œæ­¤æ—¶åœ¨CASæ£€æŸ¥è¿‡ç¨‹ä¸­å°±è¯¯è®¤ä¸ºæ•°æ®å¹¶æ²¡æœ‰è¢«ä¿®æ”¹ã€‚è¿™ä¸ªé—®é¢˜å°±æ˜¯CASä¸­çš„<strong>ABAé—®é¢˜</strong></p>\n<p><strong>ABAé—®é¢˜çš„è§£å†³</strong>ï¼šå¯ä»¥å¢åŠ ä¸€ä¸ªç‰ˆæœ¬å·ï¼ˆversionï¼‰å­—æ®µï¼Œæ¯æ¬¡æ›´æ–°æ“ä½œéƒ½è¦å¯¹<code>version+1</code>ï¼Œåœ¨CASæ£€æŸ¥è¿‡ç¨‹ä¸­ä¸ä»…ä»…æ£€æŸ¥æ•°æ®å€¼è¿˜è¦æ£€æŸ¥ç‰ˆæœ¬å·æ˜¯å¦ä¿®æ”¹</p>\n<p>âš ï¸ï¼š</p>\n<ul>\n<li>ä¹è§‚é”å¹¶æœªçœŸæ­£åŠ é”ï¼Œæ•ˆç‡è¾ƒé«˜ï¼Œé€‚ç”¨äºå†™æ¯”è¾ƒå°‘çš„æƒ…å†µï¼Œæ›´æ–°å¤±è´¥æ¦‚ç‡æ¯”è¾ƒé«˜</li>\n<li>æ‚²è§‚é”ä¾èµ–äºæ•°æ®åº“é”ï¼Œæ•ˆç‡ä½ï¼Œæ›´æ–°å¤±è´¥æ¦‚ç‡æ¯”è¾ƒä½</li>\n</ul>\n"},{"_content":"\n- çŸ­è¿æ¥ï¼šå’ŒMySQLäº¤äº’æ—¶ï¼Œå»ºç«‹è¿æ¥ï¼Œç”¨å®Œå°±å…³é—­\n- é•¿è¿æ¥ï¼šå’ŒMySQLå»ºç«‹çš„è¿æ¥åœ¨ç”¨å®Œåä¸å…³é—­ï¼Œæ”¾å…¥ä¸€ä¸ªæ± å­ä¸­ï¼Œç­‰å¾…å¤ç”¨\n## è¿æ¥æ± å¸¸ç”¨çš„å‚æ•°\n\n- **æœ€å¤§ç©ºé—²è¿æ¥**ï¼šè¡¨ç¤ºè¿æ¥æ± ä¸­æœ€å¤šèƒ½å®¹çº³å¤šå°‘ä¸ªç©ºé—²çš„é•¿è¿æ¥ã€‚æŸä¸ªè¿æ¥å¤„ç†å®Œäº‹åŠ¡åï¼Œå¦‚æœè¿æ¥æ± æœªæ»¡ï¼Œé‚£ä¹ˆè¯¥è¿æ¥ä¼šè¢«æ”¾å…¥è¿æ¥æ± ä¸­ï¼Œå¦åˆ™å…³é—­\n- **æœ€å¤§ç©ºé—²æ—¶é—´**ï¼šè¡¨ç¤ºä¸€ä¸ªé•¿è¿æ¥åœ¨è¿æ¥æ± ä¸­æœ€å¤šå­˜æ´»çš„æ—¶é—´ï¼Œè¶…è¿‡è¿™ä¸ªæ—¶é—´ï¼Œè¿æ¥å°†ä¼šè¢«å…³é—­\n- **æœ€å°è¿æ¥æ•°**ï¼šè¿æ¥æ± ä¸­å…œåº•çš„è¿æ¥æ•°é‡ï¼Œå½“è¿æ¥æ± ä¸­çš„ç©ºé—²è¿æ¥å°‘äºæ­¤å€¼æ—¶ï¼Œä¼šè‡ªåŠ¨è¡¥å……è¿æ¥è‡³æ± ä¸­ã€‚\n\t- æœ€å°è¿æ¥æ•°å¿…é¡»å°äºç­‰äºæœ€å¤§ç©ºé—²è¿æ¥\n\nåœ¨GORMä¸­ï¼Œå¦‚æœè¿æ¥è¯·æ±‚çš„æ•°é‡å¤§äºè®¾ç½®çš„æœ€å¤§ç©ºé—²è¿æ¥æ•°é‡ï¼Œé‚£ä¹ˆå°±ä¼šåˆ›å»ºå¤§é‡çš„çŸ­é“¾æ¥ä¸MySQLè¿›è¡Œäº¤äº’ã€‚åœ¨é«˜å¹¶å‘ç¯å¢ƒä¸‹ä¼šäº§ç”Ÿå¾ˆå¤šçŸ­è¿æ¥ï¼Œç›¸åº”çš„éœ€è¦ä¸»åŠ¨æ–­å¼€å¾ˆå¤šçŸ­è¿æ¥ã€‚æ–­å¼€çŸ­é“¾æ¥çš„è¿‡ç¨‹ä¸­ç”±äºå››æ¬¡æŒ¥æ‰‹**TIME_WAIT**é˜¶æ®µéœ€è¦ç­‰å¾…ä¸€å®šæ—¶é—´ï¼Œå¯¼è‡´ç«¯å£æ— æ³•åŠæ—¶é‡Šæ”¾ï¼Œå°±ä¼šå‡ºç°`can't assign requested address`é”™è¯¯\n\n**è¿æ¥æ± çš„æ ¸å¿ƒå°±æ˜¯è¿æ¥å¤ç”¨**","source":"_posts/MySQL/MySQLè¿æ¥æ± ä¼˜åŒ–.md","raw":"\n- çŸ­è¿æ¥ï¼šå’ŒMySQLäº¤äº’æ—¶ï¼Œå»ºç«‹è¿æ¥ï¼Œç”¨å®Œå°±å…³é—­\n- é•¿è¿æ¥ï¼šå’ŒMySQLå»ºç«‹çš„è¿æ¥åœ¨ç”¨å®Œåä¸å…³é—­ï¼Œæ”¾å…¥ä¸€ä¸ªæ± å­ä¸­ï¼Œç­‰å¾…å¤ç”¨\n## è¿æ¥æ± å¸¸ç”¨çš„å‚æ•°\n\n- **æœ€å¤§ç©ºé—²è¿æ¥**ï¼šè¡¨ç¤ºè¿æ¥æ± ä¸­æœ€å¤šèƒ½å®¹çº³å¤šå°‘ä¸ªç©ºé—²çš„é•¿è¿æ¥ã€‚æŸä¸ªè¿æ¥å¤„ç†å®Œäº‹åŠ¡åï¼Œå¦‚æœè¿æ¥æ± æœªæ»¡ï¼Œé‚£ä¹ˆè¯¥è¿æ¥ä¼šè¢«æ”¾å…¥è¿æ¥æ± ä¸­ï¼Œå¦åˆ™å…³é—­\n- **æœ€å¤§ç©ºé—²æ—¶é—´**ï¼šè¡¨ç¤ºä¸€ä¸ªé•¿è¿æ¥åœ¨è¿æ¥æ± ä¸­æœ€å¤šå­˜æ´»çš„æ—¶é—´ï¼Œè¶…è¿‡è¿™ä¸ªæ—¶é—´ï¼Œè¿æ¥å°†ä¼šè¢«å…³é—­\n- **æœ€å°è¿æ¥æ•°**ï¼šè¿æ¥æ± ä¸­å…œåº•çš„è¿æ¥æ•°é‡ï¼Œå½“è¿æ¥æ± ä¸­çš„ç©ºé—²è¿æ¥å°‘äºæ­¤å€¼æ—¶ï¼Œä¼šè‡ªåŠ¨è¡¥å……è¿æ¥è‡³æ± ä¸­ã€‚\n\t- æœ€å°è¿æ¥æ•°å¿…é¡»å°äºç­‰äºæœ€å¤§ç©ºé—²è¿æ¥\n\nåœ¨GORMä¸­ï¼Œå¦‚æœè¿æ¥è¯·æ±‚çš„æ•°é‡å¤§äºè®¾ç½®çš„æœ€å¤§ç©ºé—²è¿æ¥æ•°é‡ï¼Œé‚£ä¹ˆå°±ä¼šåˆ›å»ºå¤§é‡çš„çŸ­é“¾æ¥ä¸MySQLè¿›è¡Œäº¤äº’ã€‚åœ¨é«˜å¹¶å‘ç¯å¢ƒä¸‹ä¼šäº§ç”Ÿå¾ˆå¤šçŸ­è¿æ¥ï¼Œç›¸åº”çš„éœ€è¦ä¸»åŠ¨æ–­å¼€å¾ˆå¤šçŸ­è¿æ¥ã€‚æ–­å¼€çŸ­é“¾æ¥çš„è¿‡ç¨‹ä¸­ç”±äºå››æ¬¡æŒ¥æ‰‹**TIME_WAIT**é˜¶æ®µéœ€è¦ç­‰å¾…ä¸€å®šæ—¶é—´ï¼Œå¯¼è‡´ç«¯å£æ— æ³•åŠæ—¶é‡Šæ”¾ï¼Œå°±ä¼šå‡ºç°`can't assign requested address`é”™è¯¯\n\n**è¿æ¥æ± çš„æ ¸å¿ƒå°±æ˜¯è¿æ¥å¤ç”¨**","slug":"MySQL/MySQLè¿æ¥æ± ä¼˜åŒ–","published":1,"date":"2024-12-27T11:03:15.343Z","updated":"2024-12-27T11:03:15.343Z","title":"","comments":1,"layout":"post","photos":[],"_id":"cm6c7md6n002ka5t2f9aldmef","content":"<ul>\n<li>çŸ­è¿æ¥ï¼šå’ŒMySQLäº¤äº’æ—¶ï¼Œå»ºç«‹è¿æ¥ï¼Œç”¨å®Œå°±å…³é—­</li>\n<li>é•¿è¿æ¥ï¼šå’ŒMySQLå»ºç«‹çš„è¿æ¥åœ¨ç”¨å®Œåä¸å…³é—­ï¼Œæ”¾å…¥ä¸€ä¸ªæ± å­ä¸­ï¼Œç­‰å¾…å¤ç”¨</li>\n</ul>\n<h2 id=\"è¿æ¥æ± å¸¸ç”¨çš„å‚æ•°\"><a href=\"#è¿æ¥æ± å¸¸ç”¨çš„å‚æ•°\" class=\"headerlink\" title=\"è¿æ¥æ± å¸¸ç”¨çš„å‚æ•°\"></a>è¿æ¥æ± å¸¸ç”¨çš„å‚æ•°</h2><ul>\n<li><strong>æœ€å¤§ç©ºé—²è¿æ¥</strong>ï¼šè¡¨ç¤ºè¿æ¥æ± ä¸­æœ€å¤šèƒ½å®¹çº³å¤šå°‘ä¸ªç©ºé—²çš„é•¿è¿æ¥ã€‚æŸä¸ªè¿æ¥å¤„ç†å®Œäº‹åŠ¡åï¼Œå¦‚æœè¿æ¥æ± æœªæ»¡ï¼Œé‚£ä¹ˆè¯¥è¿æ¥ä¼šè¢«æ”¾å…¥è¿æ¥æ± ä¸­ï¼Œå¦åˆ™å…³é—­</li>\n<li><strong>æœ€å¤§ç©ºé—²æ—¶é—´</strong>ï¼šè¡¨ç¤ºä¸€ä¸ªé•¿è¿æ¥åœ¨è¿æ¥æ± ä¸­æœ€å¤šå­˜æ´»çš„æ—¶é—´ï¼Œè¶…è¿‡è¿™ä¸ªæ—¶é—´ï¼Œè¿æ¥å°†ä¼šè¢«å…³é—­</li>\n<li><strong>æœ€å°è¿æ¥æ•°</strong>ï¼šè¿æ¥æ± ä¸­å…œåº•çš„è¿æ¥æ•°é‡ï¼Œå½“è¿æ¥æ± ä¸­çš„ç©ºé—²è¿æ¥å°‘äºæ­¤å€¼æ—¶ï¼Œä¼šè‡ªåŠ¨è¡¥å……è¿æ¥è‡³æ± ä¸­ã€‚<ul>\n<li>æœ€å°è¿æ¥æ•°å¿…é¡»å°äºç­‰äºæœ€å¤§ç©ºé—²è¿æ¥</li>\n</ul>\n</li>\n</ul>\n<p>åœ¨GORMä¸­ï¼Œå¦‚æœè¿æ¥è¯·æ±‚çš„æ•°é‡å¤§äºè®¾ç½®çš„æœ€å¤§ç©ºé—²è¿æ¥æ•°é‡ï¼Œé‚£ä¹ˆå°±ä¼šåˆ›å»ºå¤§é‡çš„çŸ­é“¾æ¥ä¸MySQLè¿›è¡Œäº¤äº’ã€‚åœ¨é«˜å¹¶å‘ç¯å¢ƒä¸‹ä¼šäº§ç”Ÿå¾ˆå¤šçŸ­è¿æ¥ï¼Œç›¸åº”çš„éœ€è¦ä¸»åŠ¨æ–­å¼€å¾ˆå¤šçŸ­è¿æ¥ã€‚æ–­å¼€çŸ­é“¾æ¥çš„è¿‡ç¨‹ä¸­ç”±äºå››æ¬¡æŒ¥æ‰‹<strong>TIME_WAIT</strong>é˜¶æ®µéœ€è¦ç­‰å¾…ä¸€å®šæ—¶é—´ï¼Œå¯¼è‡´ç«¯å£æ— æ³•åŠæ—¶é‡Šæ”¾ï¼Œå°±ä¼šå‡ºç°<code>can&#39;t assign requested address</code>é”™è¯¯</p>\n<p><strong>è¿æ¥æ± çš„æ ¸å¿ƒå°±æ˜¯è¿æ¥å¤ç”¨</strong></p>\n","excerpt":"","more":"<ul>\n<li>çŸ­è¿æ¥ï¼šå’ŒMySQLäº¤äº’æ—¶ï¼Œå»ºç«‹è¿æ¥ï¼Œç”¨å®Œå°±å…³é—­</li>\n<li>é•¿è¿æ¥ï¼šå’ŒMySQLå»ºç«‹çš„è¿æ¥åœ¨ç”¨å®Œåä¸å…³é—­ï¼Œæ”¾å…¥ä¸€ä¸ªæ± å­ä¸­ï¼Œç­‰å¾…å¤ç”¨</li>\n</ul>\n<h2 id=\"è¿æ¥æ± å¸¸ç”¨çš„å‚æ•°\"><a href=\"#è¿æ¥æ± å¸¸ç”¨çš„å‚æ•°\" class=\"headerlink\" title=\"è¿æ¥æ± å¸¸ç”¨çš„å‚æ•°\"></a>è¿æ¥æ± å¸¸ç”¨çš„å‚æ•°</h2><ul>\n<li><strong>æœ€å¤§ç©ºé—²è¿æ¥</strong>ï¼šè¡¨ç¤ºè¿æ¥æ± ä¸­æœ€å¤šèƒ½å®¹çº³å¤šå°‘ä¸ªç©ºé—²çš„é•¿è¿æ¥ã€‚æŸä¸ªè¿æ¥å¤„ç†å®Œäº‹åŠ¡åï¼Œå¦‚æœè¿æ¥æ± æœªæ»¡ï¼Œé‚£ä¹ˆè¯¥è¿æ¥ä¼šè¢«æ”¾å…¥è¿æ¥æ± ä¸­ï¼Œå¦åˆ™å…³é—­</li>\n<li><strong>æœ€å¤§ç©ºé—²æ—¶é—´</strong>ï¼šè¡¨ç¤ºä¸€ä¸ªé•¿è¿æ¥åœ¨è¿æ¥æ± ä¸­æœ€å¤šå­˜æ´»çš„æ—¶é—´ï¼Œè¶…è¿‡è¿™ä¸ªæ—¶é—´ï¼Œè¿æ¥å°†ä¼šè¢«å…³é—­</li>\n<li><strong>æœ€å°è¿æ¥æ•°</strong>ï¼šè¿æ¥æ± ä¸­å…œåº•çš„è¿æ¥æ•°é‡ï¼Œå½“è¿æ¥æ± ä¸­çš„ç©ºé—²è¿æ¥å°‘äºæ­¤å€¼æ—¶ï¼Œä¼šè‡ªåŠ¨è¡¥å……è¿æ¥è‡³æ± ä¸­ã€‚<ul>\n<li>æœ€å°è¿æ¥æ•°å¿…é¡»å°äºç­‰äºæœ€å¤§ç©ºé—²è¿æ¥</li>\n</ul>\n</li>\n</ul>\n<p>åœ¨GORMä¸­ï¼Œå¦‚æœè¿æ¥è¯·æ±‚çš„æ•°é‡å¤§äºè®¾ç½®çš„æœ€å¤§ç©ºé—²è¿æ¥æ•°é‡ï¼Œé‚£ä¹ˆå°±ä¼šåˆ›å»ºå¤§é‡çš„çŸ­é“¾æ¥ä¸MySQLè¿›è¡Œäº¤äº’ã€‚åœ¨é«˜å¹¶å‘ç¯å¢ƒä¸‹ä¼šäº§ç”Ÿå¾ˆå¤šçŸ­è¿æ¥ï¼Œç›¸åº”çš„éœ€è¦ä¸»åŠ¨æ–­å¼€å¾ˆå¤šçŸ­è¿æ¥ã€‚æ–­å¼€çŸ­é“¾æ¥çš„è¿‡ç¨‹ä¸­ç”±äºå››æ¬¡æŒ¥æ‰‹<strong>TIME_WAIT</strong>é˜¶æ®µéœ€è¦ç­‰å¾…ä¸€å®šæ—¶é—´ï¼Œå¯¼è‡´ç«¯å£æ— æ³•åŠæ—¶é‡Šæ”¾ï¼Œå°±ä¼šå‡ºç°<code>can&#39;t assign requested address</code>é”™è¯¯</p>\n<p><strong>è¿æ¥æ± çš„æ ¸å¿ƒå°±æ˜¯è¿æ¥å¤ç”¨</strong></p>\n"},{"title":"RedisæŒä¹…åŒ–","publish":true,"description":"è®°å½•RedisæŒä¹…åŒ–çŸ¥è¯†ç‚¹","_content":"\n\n\n# RedisæŒä¹…åŒ–\n\n> æŒä¹…åŒ–æ˜¯ä»€ä¹ˆï¼Ÿ\n\nRedisä¸­çš„æ•°æ®æ˜¯å­˜å‚¨åœ¨å†…å­˜ä¸Šçš„ï¼Œå€˜è‹¥å‘ç”Ÿç³»ç»Ÿå¥”æºƒæˆ–ç¨‹åºé‡å¯ï¼ŒRedisä¸­çš„æ•°æ®å°±ä¼šä¸¢å¤±ã€‚å¦‚æœä¸šåŠ¡åœºæ™¯å¸Œæœ›å³ä½¿å‡ºç°å¼‚å¸¸æƒ…å†µï¼ŒRedisä¸­çš„æ•°æ®ä¹Ÿä¸ä¼šä¸¢å¤±ï¼Œå°±éœ€è¦å°†Redisä¸­çš„æ•°æ®**æŒä¹…åŒ–**ä¿å­˜åˆ°å­˜å‚¨è®¾å¤‡ä¸Šã€‚\n\n## RedisæŒä¹…åŒ–æ–¹å¼\n\nRedisæä¾›äº†ä¸¤ç§æŒä¹…åŒ–æ–¹å¼ï¼š\n\n1. RDBï¼ˆRedis Database Backupï¼‰æ˜¯ä¸€ç§ä¿å­˜æ•°æ®å¿«ç…§çš„æŒä¹…åŒ–ç­–ç•¥ã€‚å½“å¼€å¯RDBç­–ç•¥åï¼ŒRedisæ¯ä¸ªä¸€æ®µæ—¶é—´å°±ä¼šå°†å…¨å±€æ•°æ®ä»¥**äºŒè¿›åˆ¶**æ•°æ®çš„å½¢å¼ä¿å­˜åœ¨ç£ç›˜ï¼Œåç»­é€šè¿‡åŠ è½½RDBæ–‡ä»¶æ¢å¤æ•°æ®ã€‚\n\n   <img src=\"https://raw.githubusercontent.com/lyydsheep/pic/main/202410251409010.png\" alt=\"image-20241025140840529\" style=\"zoom:80%;\" />\n\n2. AOFï¼ˆAppend Only Fileï¼‰ä»¥è®°å½•æ—¥å¿—ç¡®ä¿æ•°æ®æŒä¹…åŒ–ã€‚å½“å¼€å¯AOFç­–ç•¥åï¼ŒRedisä¼šå°†æ¯ä¸€æ¡**æ•°æ®æ›´æ–°æ“ä½œ**è®°å½•åˆ°æ—¥å¿—ï¼Œåç»­é€šè¿‡é‡æ”¾æ—¥å¿—æ¢å¤æ•°æ®\n\n   <img src=\"https://raw.githubusercontent.com/lyydsheep/pic/main/202410251412091.png\" alt=\"image-20241025140840529\" style=\"zoom:80%;\" />\n\nä»ä¸¤ç§ç­–ç•¥çš„å®šä¹‰ä¸­å¾ˆå®¹æ˜“èƒ½çœ‹å‡ºæ¥ä¸¤ç§æ–¹æ¡ˆæœ‰ä¸€ä¸‹ä¸åŒç‚¹ï¼š\n\n- ä½“ç§¯ï¼šåœ¨åŒç­‰æ•°æ®é‡çš„æƒ…å†µä¸‹ï¼ŒRDBæ¯”AOFä½“ç§¯æ›´å°ï¼Œå› ä¸ºRDBä¿å­˜çš„æ˜¯**äºŒè¿›åˆ¶ç´§å‡‘æ•°æ®**\n- æ¢å¤é€Ÿåº¦ï¼šRDBæ˜¯å¿«ç…§æ•°æ®ï¼Œç›´æ¥åŠ è½½å³å¯æ¢å¤æ•°æ®ï¼Œè€ŒAOFæ–‡ä»¶æ¢å¤éœ€è¦é‡æ”¾æ—¥å¿—ï¼Œå¼€é”€æ›´å¤§\n- æ•°æ®å®Œæ•´æ€§ï¼šRDBæ˜¯é—´éš”ä¸€æ®µæ—¶é—´å°±è®°å½•ä¸€æ¬¡ï¼Œç›¸æ¯”ä¹‹ä¸‹ï¼ŒAOFæ–‡ä»¶è®°å½•æ¯ä¸€æ¡æ“ä½œï¼Œä¿å­˜çš„æ•°æ®æ›´åŠ å®Œæ•´\n\n### RDBè¿˜æ˜¯AOFï¼Ÿ\n\n> åœ¨Redisä¸­ï¼ŒRDBæ˜¯é»˜è®¤å¼€å¯çš„ï¼Œè€ŒAOFæ˜¯é»˜è®¤å…³é—­çš„ã€‚\n\nä½¿ç”¨RDBè¿˜æ˜¯AOFæŒä¹…åŒ–ç­–ç•¥éœ€è¦ä¾æ®å…·ä½“åœºæ™¯åˆ¤æ–­ï¼š\n\nå¦‚æœå¯¹æ•°æ®å®Œæ•´æ€§è¦æ±‚è¾ƒé«˜ï¼Œåˆ™éœ€è¦å°†**RDBã€AOF**åŒæ—¶å¼€å¯ã€‚æ­¤æ—¶ï¼Œè¿›è¡Œæ•°æ®æ¢å¤åªä¼šé‡‡ç”¨AOFæ–‡ä»¶ï¼Œå› ä¸ºæ—¢ç„¶å¼€å¯äº†AOFç­–ç•¥é‚£ä¹ˆå°±è¯´æ˜éœ€è¦æ•°æ®å®Œæ•´æ€§æ›´å¼ºçš„AOFæ–‡ä»¶ï¼Œè€Œä¸æ˜¯å¯èƒ½ç¼ºå°‘ä¸€äº›æ•°æ®çš„RDBæ–‡ä»¶\n\n<img src=\"https://raw.githubusercontent.com/lyydsheep/pic/main/202410251432209.png\" alt=\"image-20241025143254030\" style=\"zoom:80%;\" />\n\nå¦‚æœèƒ½å¤Ÿå¿å—å‡ åˆ†é’Ÿçš„æ•°æ®ä¸¢å¤±ï¼Œå°±å¯ä»¥**åªå¼€å¯RDBç­–ç•¥**ã€‚ä½†ä¸å»ºè®®å•ç‹¬å¼€å¯AOFç­–ç•¥ï¼Œå…·ä½“åŸå› å¯å‚è€ƒå®˜æ–¹çš„è§£é‡Šï¼š\n\n<img src=\"https://raw.githubusercontent.com/lyydsheep/pic/main/202410251435012.png\" alt=\"image-20241025143518646\" style=\"zoom:80%;\" />\n\n## RDBè¯¦è§£\n\nRDBå±äºæ•°æ®å¿«ç…§æŒä¹…åŒ–ç­–ç•¥ï¼Œæ˜¯ä¸€ç§æœ€å¸¸è§ã€æœ€ç¨³å®šçš„æ•°æ®æŒä¹…åŒ–æ–¹æ¡ˆã€‚é‚£ä¹ˆå¦‚ä½•åœ¨Redisä¸­å¼€å¯RDBæŒä¹…åŒ–ç­–ç•¥ï¼Ÿ\n\nç”±äºRedisé»˜è®¤æ”¯æŒRDBæŒä¹…åŒ–ï¼Œå› æ­¤æˆ‘ä»¬å¯ä»¥åœ¨é…ç½®æ–‡ä»¶ä¸­çœ‹åˆ°å¦‚ä¸‹å†…å®¹\n\n<img src=\"https://raw.githubusercontent.com/lyydsheep/pic/main/202410251940149.png\" alt=\"image-20241025194036067\" style=\"zoom:80%;\" />\n\nå…¶ä¸­`save interval changes`å°±ä»£è¡¨ç€å½“ä¸€å®šæ—¶é—´é—´éš”è¿›è¡Œäº†å¤šå°‘æ¬¡æ•°æ®ä¿®æ”¹å°±è§¦å‘RDBæŒä¹…åŒ–ï¼Œå°†æ•°æ®ä¿å­˜åˆ°ç£ç›˜ä¸Š\n\nå½“ç„¶ï¼Œé™¤äº†ä¸Šè¿°è¢«åŠ¨è§¦å‘RDBæŒä¹…åŒ–ï¼ŒRedisè¿˜æä¾›äº†ä¸¤æ¡å‘½ä»¤æ¥æ”¯æŒä¸»åŠ¨æŒä¹…åŒ–åŠŸèƒ½\n\n- saveï¼šRedisä¸»çº¿ç¨‹å°†å…¨å±€æ•°æ®ç”ŸæˆäºŒè¿›åˆ¶æ–‡ä»¶ã€‚å¦‚æœå†…å­˜ä¸­çš„æ•°æ®é‡åºå¤§ï¼Œé‚£ä¹ˆè¯¥å‘½ä»¤å¯èƒ½ä¼šå¯¼è‡´ä¸»çº¿ç¨‹é˜»å¡ï¼Œé™ä½ç³»ç»Ÿçš„æ‰§è¡Œæ•ˆç‡\n- bgsaveï¼šRedisä¸»çº¿ç¨‹forkä¸€ä¸ªå­è¿›ç¨‹ï¼Œå­è¿›ç¨‹æ‰§è¡ŒæŒä¹…åŒ–æ•°æ®çš„æ“ä½œç”Ÿæˆä¸€ä¸ªæ–°çš„rdbæ–‡ä»¶å¹¶å°†æ—§çš„rdbæ–‡ä»¶æ›¿æ¢ï¼Œé¿å…äº†ä¸»çº¿ç¨‹é˜»å¡\n  - ä¸Šè¿°è¢«åŠ¨è§¦å‘RDBæŒä¹…åŒ–æœ¬è´¨ä¸Šå°±æ˜¯è°ƒç”¨äº†`bgsave`å‘½ä»¤\n\né™¤æ­¤ä¹‹å¤–ï¼ŒRedisåœ¨ç¨‹åºå…³é—­æ—¶ä¼šè‡ªåŠ¨è§¦å‘`save`å‘½ä»¤ï¼Œé˜»å¡ä¸»çº¿ç¨‹è¿›è¡Œæ•°æ®æŒä¹…åŒ–ï¼Œä»¥è®°å½•æ›´åŠ å®Œå…¨çš„æ•°æ®ã€‚\n\n### å†™æ—¶å¤åˆ¶\n\nè°ƒç”¨`bgsave`å‘½ä»¤åï¼Œæ‰§è¡ŒRDBæŒä¹…åŒ–è¿‡ç¨‹ä¸­ï¼ŒRedisä¾ç„¶å¯ä»¥ç»§ç»­å¤„ç†å…¶ä»–å‘½ä»¤ï¼Œè¿™éƒ½å¾—ç›Šäº**å†™æ—¶å¤åˆ¶**æŠ€æœ¯\n\nRedisä¸»çº¿ç¨‹forkå­è¿›ç¨‹æ—¶ï¼Œä¸ºäº†èŠ‚çœå†…å­˜ç©ºé—´ï¼Œå­è¿›ç¨‹ä»…ä»…å¤åˆ¶çˆ¶è¿›ç¨‹çš„é¡µè¡¨ï¼Œä¸¤ä¸ªè¿›ç¨‹çš„é¡µè¡¨æŒ‡å‘åŒä¸€å—ç‰©ç†å†…å­˜ã€‚\n\n<img src=\"https://raw.githubusercontent.com/lyydsheep/pic/main/202410252022075.png\" alt=\"image-20241025202223000\" style=\"zoom:80%;\" />\n\næ¥ç€ï¼Œå­è¿›ç¨‹ä¾æ®ç‰©ç†å†…å­˜ä¸Šçš„æ•°æ®ç”Ÿæˆæ–°çš„rdbæ–‡ä»¶ã€‚å› ä¸ºRDBæ˜¯å¿«ç…§æŒä¹…åŒ–ç­–ç•¥ï¼Œå­è¿›ç¨‹åªä¼šä¿å­˜è°ƒç”¨`bgsave`å‘½ä»¤é‚£ä¸€åˆ»çš„æ•°æ®ï¼Œæ‰€ä»¥å³ä½¿ç”Ÿæˆrdbæ–‡ä»¶çš„è¿‡ç¨‹ä¸­ä¸»è¿›ç¨‹å‘ç”Ÿäº†å†™æ“ä½œï¼Œä¹Ÿä¸èƒ½å½±å“å­è¿›ç¨‹çš„æ•°æ®ã€‚ä¸ºäº†æ»¡è¶³è¿™ä¸€è¦æ±‚ï¼Œ**ä¸»è¿›ç¨‹ä¼šå¤åˆ¶ä¸€ä»½å¯¹åº”çš„ç‰©ç†å†…å­˜ï¼Œç„¶ååœ¨ä¸Šé¢è¿›è¡Œå†™æ“ä½œï¼Œä»è€Œä¸å½±å“å­è¿›ç¨‹çš„æ•°æ®**ï¼Œè¿™å°±æ˜¯å†™æ—¶å¤åˆ¶æœºåˆ¶ã€‚\n\n<img src=\"https://raw.githubusercontent.com/lyydsheep/pic/main/202410252022156.png\" alt=\"image-20241025202241119\" style=\"zoom:80%;\" />\n\n## AOFè¯¦è§£\n\nAOFæŒä¹…åŒ–ç­–ç•¥åœ¨Redisä¸­æ˜¯é»˜è®¤å…³é—­çš„ï¼Œéœ€è¦æ‰‹åŠ¨å¼€å¯ï¼Œå¼€å¯ä¹‹åï¼ŒRedisä¼šå°†æ¯ä¸€æ¡æ›´æ–°æ“ä½œè®°å½•åœ¨AOFæ–‡ä»¶ã€‚å½“é‡å¯æ—¶ï¼ŒRediså°±å¯ä»¥é€šè¿‡AOFæ–‡ä»¶å°†æ‰€æœ‰çš„è¯·æ±‚é‡æ”¾ï¼Œæ¢å¤æ•°æ®ï¼Œä½†é€Ÿåº¦å¾ˆæ…¢ã€‚\n\n### AOFå†™å…¥æµç¨‹\n\nAOFæ–‡ä»¶å†™å…¥æµç¨‹å¤§è‡´åˆ†ä¸ºä¸‰æ­¥ï¼š\n\n1. å°†æ•°æ®å†™å…¥AOFç¼“å­˜ï¼Œå®è´¨æ˜¯ä¸€ä¸ªsdsæ•°æ®\n2. å°†AOFç¼“å­˜åˆ·å…¥ç£ç›˜ç¼“å†²åŒºï¼ˆpage cacheï¼‰ä¸­\n3. åˆ·ç›˜\n\n![image-20241028212538059](https://raw.githubusercontent.com/lyydsheep/pic/main/202410282126394.png)\n\n### AOFé‡å†™\n\néšç€ç”¨æˆ·çš„è¯·æ±‚é€æ¸ç§¯ç´¯ï¼ŒAOFæ–‡ä»¶ä¼šé€æ¸è†¨èƒ€ï¼Œä½†æ˜¯AOFæ–‡ä»¶ä¸­æœ‰æ•ˆè®°å½•æ˜¯å°‘é‡çš„ã€‚è¿™æ˜¯å› ä¸ºï¼Œå¯¹ä¸€ä¸ªkeyä¿®æ”¹æˆåƒä¸Šä¸‡æ¬¡ï¼Œåªæœ‰æœ€åä¸€æ¬¡ä¿®æ”¹æ˜¯æœ‰æ•ˆçš„ï¼Œéœ€è¦çœŸæ­£ä¿å­˜åœ¨AOFæ–‡ä»¶ä¸­ï¼Œè€Œä¹‹å‰çš„ä¿®æ”¹éƒ½æ˜¯æ— æ•ˆçš„ã€‚æ‰€ä»¥ï¼Œå®Œå…¨å¯ä»¥å°†AOFæ–‡ä»¶ä¸­çš„æ— æ•ˆè®°å½•åˆ é™¤ï¼Œé¿å…AOFæ–‡ä»¶è¿‡äºåºå¤§ã€‚\n\nAOFé‡å†™è¿‡ç¨‹å¯ä»¥æ¦‚æ‹¬ä¸º**ä¸€æ¬¡æ‹·è´ï¼Œä¸¤å¤„ç¼“å†²**\n\n- ä¸€æ¬¡æ‹·è´ï¼šé‡å†™å‘ç”Ÿæ—¶ï¼Œä¸»è¿›ç¨‹ä¼šforkå‡ºä¸€ä¸ªå­è¿›ç¨‹ï¼Œå­è¿›ç¨‹å’Œä¸»è¿›ç¨‹å…±äº«Redisç‰©ç†å†…å­˜ï¼Œè®©**å­è¿›ç¨‹å°†è¿™äº›å†…å­˜å†™å…¥é‡å†™æ—¥å¿—**\n- ä¸¤å¤„ç¼“å†²ï¼šåœ¨é‡å†™è¿‡ç¨‹ä¸­ï¼Œå¦‚æœæœ‰æ–°çš„å†™å…¥è¯·æ±‚ï¼Œä¼šç”±ä¸»è¿›ç¨‹åˆ†åˆ«å†™å…¥AOFç¼“å†²å’ŒAOFé‡å†™ç¼“å†²ã€‚AOFç¼“å†²ç”¨äºä¿è¯å³ä½¿æ­¤æ—¶å‘ç”Ÿå®•æœºï¼ŒåŸæ¥çš„AOFæ—¥å¿—ä¹Ÿæ˜¯å®Œæ•´çš„ï¼Œå¯ç”¨äºæ¢å¤ã€‚AOFé‡å†™ç¼“å†²ç”¨äºä¿è¯æ–°çš„AOFæ–‡ä»¶ä¸ä¼šä¸¢å¤±æœ€æ–°çš„å†™å…¥æ“ä½œ\n\n<img src=\"https://raw.githubusercontent.com/lyydsheep/pic/main/202410282135209.png\" alt=\"image-20241028213530151\" style=\"zoom:80%;\" />\n\n### AOFæ··åˆæŒä¹…åŒ–\n\nAOFæ··åˆæŒä¹…åŒ–æ˜¯æŒ‡ï¼Œåœ¨AOFé‡å†™é˜¶æ®µï¼ŒRediså°†ç°é˜¶æ®µçš„æ•°æ®çŠ¶æ€ä¿å­˜ä¸ºRDBçŠ¶æ€çš„äºŒè¿›åˆ¶æ•°æ®ï¼Œå¹¶å†™å…¥AOFæ–‡ä»¶ï¼Œç„¶åå†å°†AOFé‡å†™ç¼“å†²åŒºä¸­çš„æ—¥å¿—æ•°æ®å†™å…¥åˆ°AOFæ–‡ä»¶ï¼Œæœ€åæŠŠæ–°ç”Ÿæˆçš„AOFæ–‡ä»¶æ›¿æ¢æ‰æ—§çš„AOFæ–‡ä»¶ã€‚\n\næ­¤æ—¶çš„AOFæ–‡ä»¶æ—¢åŒ…å«äºŒè¿›åˆ¶æ•°æ®ï¼ŒåˆåŒ…å«æ—¥å¿—æ•°æ®ï¼Œæ‰€ä»¥å«åšæ··åˆæŒä¹…åŒ–ã€‚\n\nAOFæ··åˆæŒä¹…åŒ–é€šè¿‡é™ä½AOFæ–‡ä»¶çš„å¯è¯»æ€§ï¼Œç”¨äºŒè¿›åˆ¶æ•°æ®è®°å½•æ•°æ®çŠ¶æ€ï¼Œå‡å°‘äº†AOFæ–‡ä»¶çš„ä½“ç§¯å¤§å°ã€‚","source":"_posts/Redis/RedisæŒä¹…åŒ–.md","raw":"---\ntitle: RedisæŒä¹…åŒ–\npublish: true\ndescription: è®°å½•RedisæŒä¹…åŒ–çŸ¥è¯†ç‚¹\n---\n\n\n\n# RedisæŒä¹…åŒ–\n\n> æŒä¹…åŒ–æ˜¯ä»€ä¹ˆï¼Ÿ\n\nRedisä¸­çš„æ•°æ®æ˜¯å­˜å‚¨åœ¨å†…å­˜ä¸Šçš„ï¼Œå€˜è‹¥å‘ç”Ÿç³»ç»Ÿå¥”æºƒæˆ–ç¨‹åºé‡å¯ï¼ŒRedisä¸­çš„æ•°æ®å°±ä¼šä¸¢å¤±ã€‚å¦‚æœä¸šåŠ¡åœºæ™¯å¸Œæœ›å³ä½¿å‡ºç°å¼‚å¸¸æƒ…å†µï¼ŒRedisä¸­çš„æ•°æ®ä¹Ÿä¸ä¼šä¸¢å¤±ï¼Œå°±éœ€è¦å°†Redisä¸­çš„æ•°æ®**æŒä¹…åŒ–**ä¿å­˜åˆ°å­˜å‚¨è®¾å¤‡ä¸Šã€‚\n\n## RedisæŒä¹…åŒ–æ–¹å¼\n\nRedisæä¾›äº†ä¸¤ç§æŒä¹…åŒ–æ–¹å¼ï¼š\n\n1. RDBï¼ˆRedis Database Backupï¼‰æ˜¯ä¸€ç§ä¿å­˜æ•°æ®å¿«ç…§çš„æŒä¹…åŒ–ç­–ç•¥ã€‚å½“å¼€å¯RDBç­–ç•¥åï¼ŒRedisæ¯ä¸ªä¸€æ®µæ—¶é—´å°±ä¼šå°†å…¨å±€æ•°æ®ä»¥**äºŒè¿›åˆ¶**æ•°æ®çš„å½¢å¼ä¿å­˜åœ¨ç£ç›˜ï¼Œåç»­é€šè¿‡åŠ è½½RDBæ–‡ä»¶æ¢å¤æ•°æ®ã€‚\n\n   <img src=\"https://raw.githubusercontent.com/lyydsheep/pic/main/202410251409010.png\" alt=\"image-20241025140840529\" style=\"zoom:80%;\" />\n\n2. AOFï¼ˆAppend Only Fileï¼‰ä»¥è®°å½•æ—¥å¿—ç¡®ä¿æ•°æ®æŒä¹…åŒ–ã€‚å½“å¼€å¯AOFç­–ç•¥åï¼ŒRedisä¼šå°†æ¯ä¸€æ¡**æ•°æ®æ›´æ–°æ“ä½œ**è®°å½•åˆ°æ—¥å¿—ï¼Œåç»­é€šè¿‡é‡æ”¾æ—¥å¿—æ¢å¤æ•°æ®\n\n   <img src=\"https://raw.githubusercontent.com/lyydsheep/pic/main/202410251412091.png\" alt=\"image-20241025140840529\" style=\"zoom:80%;\" />\n\nä»ä¸¤ç§ç­–ç•¥çš„å®šä¹‰ä¸­å¾ˆå®¹æ˜“èƒ½çœ‹å‡ºæ¥ä¸¤ç§æ–¹æ¡ˆæœ‰ä¸€ä¸‹ä¸åŒç‚¹ï¼š\n\n- ä½“ç§¯ï¼šåœ¨åŒç­‰æ•°æ®é‡çš„æƒ…å†µä¸‹ï¼ŒRDBæ¯”AOFä½“ç§¯æ›´å°ï¼Œå› ä¸ºRDBä¿å­˜çš„æ˜¯**äºŒè¿›åˆ¶ç´§å‡‘æ•°æ®**\n- æ¢å¤é€Ÿåº¦ï¼šRDBæ˜¯å¿«ç…§æ•°æ®ï¼Œç›´æ¥åŠ è½½å³å¯æ¢å¤æ•°æ®ï¼Œè€ŒAOFæ–‡ä»¶æ¢å¤éœ€è¦é‡æ”¾æ—¥å¿—ï¼Œå¼€é”€æ›´å¤§\n- æ•°æ®å®Œæ•´æ€§ï¼šRDBæ˜¯é—´éš”ä¸€æ®µæ—¶é—´å°±è®°å½•ä¸€æ¬¡ï¼Œç›¸æ¯”ä¹‹ä¸‹ï¼ŒAOFæ–‡ä»¶è®°å½•æ¯ä¸€æ¡æ“ä½œï¼Œä¿å­˜çš„æ•°æ®æ›´åŠ å®Œæ•´\n\n### RDBè¿˜æ˜¯AOFï¼Ÿ\n\n> åœ¨Redisä¸­ï¼ŒRDBæ˜¯é»˜è®¤å¼€å¯çš„ï¼Œè€ŒAOFæ˜¯é»˜è®¤å…³é—­çš„ã€‚\n\nä½¿ç”¨RDBè¿˜æ˜¯AOFæŒä¹…åŒ–ç­–ç•¥éœ€è¦ä¾æ®å…·ä½“åœºæ™¯åˆ¤æ–­ï¼š\n\nå¦‚æœå¯¹æ•°æ®å®Œæ•´æ€§è¦æ±‚è¾ƒé«˜ï¼Œåˆ™éœ€è¦å°†**RDBã€AOF**åŒæ—¶å¼€å¯ã€‚æ­¤æ—¶ï¼Œè¿›è¡Œæ•°æ®æ¢å¤åªä¼šé‡‡ç”¨AOFæ–‡ä»¶ï¼Œå› ä¸ºæ—¢ç„¶å¼€å¯äº†AOFç­–ç•¥é‚£ä¹ˆå°±è¯´æ˜éœ€è¦æ•°æ®å®Œæ•´æ€§æ›´å¼ºçš„AOFæ–‡ä»¶ï¼Œè€Œä¸æ˜¯å¯èƒ½ç¼ºå°‘ä¸€äº›æ•°æ®çš„RDBæ–‡ä»¶\n\n<img src=\"https://raw.githubusercontent.com/lyydsheep/pic/main/202410251432209.png\" alt=\"image-20241025143254030\" style=\"zoom:80%;\" />\n\nå¦‚æœèƒ½å¤Ÿå¿å—å‡ åˆ†é’Ÿçš„æ•°æ®ä¸¢å¤±ï¼Œå°±å¯ä»¥**åªå¼€å¯RDBç­–ç•¥**ã€‚ä½†ä¸å»ºè®®å•ç‹¬å¼€å¯AOFç­–ç•¥ï¼Œå…·ä½“åŸå› å¯å‚è€ƒå®˜æ–¹çš„è§£é‡Šï¼š\n\n<img src=\"https://raw.githubusercontent.com/lyydsheep/pic/main/202410251435012.png\" alt=\"image-20241025143518646\" style=\"zoom:80%;\" />\n\n## RDBè¯¦è§£\n\nRDBå±äºæ•°æ®å¿«ç…§æŒä¹…åŒ–ç­–ç•¥ï¼Œæ˜¯ä¸€ç§æœ€å¸¸è§ã€æœ€ç¨³å®šçš„æ•°æ®æŒä¹…åŒ–æ–¹æ¡ˆã€‚é‚£ä¹ˆå¦‚ä½•åœ¨Redisä¸­å¼€å¯RDBæŒä¹…åŒ–ç­–ç•¥ï¼Ÿ\n\nç”±äºRedisé»˜è®¤æ”¯æŒRDBæŒä¹…åŒ–ï¼Œå› æ­¤æˆ‘ä»¬å¯ä»¥åœ¨é…ç½®æ–‡ä»¶ä¸­çœ‹åˆ°å¦‚ä¸‹å†…å®¹\n\n<img src=\"https://raw.githubusercontent.com/lyydsheep/pic/main/202410251940149.png\" alt=\"image-20241025194036067\" style=\"zoom:80%;\" />\n\nå…¶ä¸­`save interval changes`å°±ä»£è¡¨ç€å½“ä¸€å®šæ—¶é—´é—´éš”è¿›è¡Œäº†å¤šå°‘æ¬¡æ•°æ®ä¿®æ”¹å°±è§¦å‘RDBæŒä¹…åŒ–ï¼Œå°†æ•°æ®ä¿å­˜åˆ°ç£ç›˜ä¸Š\n\nå½“ç„¶ï¼Œé™¤äº†ä¸Šè¿°è¢«åŠ¨è§¦å‘RDBæŒä¹…åŒ–ï¼ŒRedisè¿˜æä¾›äº†ä¸¤æ¡å‘½ä»¤æ¥æ”¯æŒä¸»åŠ¨æŒä¹…åŒ–åŠŸèƒ½\n\n- saveï¼šRedisä¸»çº¿ç¨‹å°†å…¨å±€æ•°æ®ç”ŸæˆäºŒè¿›åˆ¶æ–‡ä»¶ã€‚å¦‚æœå†…å­˜ä¸­çš„æ•°æ®é‡åºå¤§ï¼Œé‚£ä¹ˆè¯¥å‘½ä»¤å¯èƒ½ä¼šå¯¼è‡´ä¸»çº¿ç¨‹é˜»å¡ï¼Œé™ä½ç³»ç»Ÿçš„æ‰§è¡Œæ•ˆç‡\n- bgsaveï¼šRedisä¸»çº¿ç¨‹forkä¸€ä¸ªå­è¿›ç¨‹ï¼Œå­è¿›ç¨‹æ‰§è¡ŒæŒä¹…åŒ–æ•°æ®çš„æ“ä½œç”Ÿæˆä¸€ä¸ªæ–°çš„rdbæ–‡ä»¶å¹¶å°†æ—§çš„rdbæ–‡ä»¶æ›¿æ¢ï¼Œé¿å…äº†ä¸»çº¿ç¨‹é˜»å¡\n  - ä¸Šè¿°è¢«åŠ¨è§¦å‘RDBæŒä¹…åŒ–æœ¬è´¨ä¸Šå°±æ˜¯è°ƒç”¨äº†`bgsave`å‘½ä»¤\n\né™¤æ­¤ä¹‹å¤–ï¼ŒRedisåœ¨ç¨‹åºå…³é—­æ—¶ä¼šè‡ªåŠ¨è§¦å‘`save`å‘½ä»¤ï¼Œé˜»å¡ä¸»çº¿ç¨‹è¿›è¡Œæ•°æ®æŒä¹…åŒ–ï¼Œä»¥è®°å½•æ›´åŠ å®Œå…¨çš„æ•°æ®ã€‚\n\n### å†™æ—¶å¤åˆ¶\n\nè°ƒç”¨`bgsave`å‘½ä»¤åï¼Œæ‰§è¡ŒRDBæŒä¹…åŒ–è¿‡ç¨‹ä¸­ï¼ŒRedisä¾ç„¶å¯ä»¥ç»§ç»­å¤„ç†å…¶ä»–å‘½ä»¤ï¼Œè¿™éƒ½å¾—ç›Šäº**å†™æ—¶å¤åˆ¶**æŠ€æœ¯\n\nRedisä¸»çº¿ç¨‹forkå­è¿›ç¨‹æ—¶ï¼Œä¸ºäº†èŠ‚çœå†…å­˜ç©ºé—´ï¼Œå­è¿›ç¨‹ä»…ä»…å¤åˆ¶çˆ¶è¿›ç¨‹çš„é¡µè¡¨ï¼Œä¸¤ä¸ªè¿›ç¨‹çš„é¡µè¡¨æŒ‡å‘åŒä¸€å—ç‰©ç†å†…å­˜ã€‚\n\n<img src=\"https://raw.githubusercontent.com/lyydsheep/pic/main/202410252022075.png\" alt=\"image-20241025202223000\" style=\"zoom:80%;\" />\n\næ¥ç€ï¼Œå­è¿›ç¨‹ä¾æ®ç‰©ç†å†…å­˜ä¸Šçš„æ•°æ®ç”Ÿæˆæ–°çš„rdbæ–‡ä»¶ã€‚å› ä¸ºRDBæ˜¯å¿«ç…§æŒä¹…åŒ–ç­–ç•¥ï¼Œå­è¿›ç¨‹åªä¼šä¿å­˜è°ƒç”¨`bgsave`å‘½ä»¤é‚£ä¸€åˆ»çš„æ•°æ®ï¼Œæ‰€ä»¥å³ä½¿ç”Ÿæˆrdbæ–‡ä»¶çš„è¿‡ç¨‹ä¸­ä¸»è¿›ç¨‹å‘ç”Ÿäº†å†™æ“ä½œï¼Œä¹Ÿä¸èƒ½å½±å“å­è¿›ç¨‹çš„æ•°æ®ã€‚ä¸ºäº†æ»¡è¶³è¿™ä¸€è¦æ±‚ï¼Œ**ä¸»è¿›ç¨‹ä¼šå¤åˆ¶ä¸€ä»½å¯¹åº”çš„ç‰©ç†å†…å­˜ï¼Œç„¶ååœ¨ä¸Šé¢è¿›è¡Œå†™æ“ä½œï¼Œä»è€Œä¸å½±å“å­è¿›ç¨‹çš„æ•°æ®**ï¼Œè¿™å°±æ˜¯å†™æ—¶å¤åˆ¶æœºåˆ¶ã€‚\n\n<img src=\"https://raw.githubusercontent.com/lyydsheep/pic/main/202410252022156.png\" alt=\"image-20241025202241119\" style=\"zoom:80%;\" />\n\n## AOFè¯¦è§£\n\nAOFæŒä¹…åŒ–ç­–ç•¥åœ¨Redisä¸­æ˜¯é»˜è®¤å…³é—­çš„ï¼Œéœ€è¦æ‰‹åŠ¨å¼€å¯ï¼Œå¼€å¯ä¹‹åï¼ŒRedisä¼šå°†æ¯ä¸€æ¡æ›´æ–°æ“ä½œè®°å½•åœ¨AOFæ–‡ä»¶ã€‚å½“é‡å¯æ—¶ï¼ŒRediså°±å¯ä»¥é€šè¿‡AOFæ–‡ä»¶å°†æ‰€æœ‰çš„è¯·æ±‚é‡æ”¾ï¼Œæ¢å¤æ•°æ®ï¼Œä½†é€Ÿåº¦å¾ˆæ…¢ã€‚\n\n### AOFå†™å…¥æµç¨‹\n\nAOFæ–‡ä»¶å†™å…¥æµç¨‹å¤§è‡´åˆ†ä¸ºä¸‰æ­¥ï¼š\n\n1. å°†æ•°æ®å†™å…¥AOFç¼“å­˜ï¼Œå®è´¨æ˜¯ä¸€ä¸ªsdsæ•°æ®\n2. å°†AOFç¼“å­˜åˆ·å…¥ç£ç›˜ç¼“å†²åŒºï¼ˆpage cacheï¼‰ä¸­\n3. åˆ·ç›˜\n\n![image-20241028212538059](https://raw.githubusercontent.com/lyydsheep/pic/main/202410282126394.png)\n\n### AOFé‡å†™\n\néšç€ç”¨æˆ·çš„è¯·æ±‚é€æ¸ç§¯ç´¯ï¼ŒAOFæ–‡ä»¶ä¼šé€æ¸è†¨èƒ€ï¼Œä½†æ˜¯AOFæ–‡ä»¶ä¸­æœ‰æ•ˆè®°å½•æ˜¯å°‘é‡çš„ã€‚è¿™æ˜¯å› ä¸ºï¼Œå¯¹ä¸€ä¸ªkeyä¿®æ”¹æˆåƒä¸Šä¸‡æ¬¡ï¼Œåªæœ‰æœ€åä¸€æ¬¡ä¿®æ”¹æ˜¯æœ‰æ•ˆçš„ï¼Œéœ€è¦çœŸæ­£ä¿å­˜åœ¨AOFæ–‡ä»¶ä¸­ï¼Œè€Œä¹‹å‰çš„ä¿®æ”¹éƒ½æ˜¯æ— æ•ˆçš„ã€‚æ‰€ä»¥ï¼Œå®Œå…¨å¯ä»¥å°†AOFæ–‡ä»¶ä¸­çš„æ— æ•ˆè®°å½•åˆ é™¤ï¼Œé¿å…AOFæ–‡ä»¶è¿‡äºåºå¤§ã€‚\n\nAOFé‡å†™è¿‡ç¨‹å¯ä»¥æ¦‚æ‹¬ä¸º**ä¸€æ¬¡æ‹·è´ï¼Œä¸¤å¤„ç¼“å†²**\n\n- ä¸€æ¬¡æ‹·è´ï¼šé‡å†™å‘ç”Ÿæ—¶ï¼Œä¸»è¿›ç¨‹ä¼šforkå‡ºä¸€ä¸ªå­è¿›ç¨‹ï¼Œå­è¿›ç¨‹å’Œä¸»è¿›ç¨‹å…±äº«Redisç‰©ç†å†…å­˜ï¼Œè®©**å­è¿›ç¨‹å°†è¿™äº›å†…å­˜å†™å…¥é‡å†™æ—¥å¿—**\n- ä¸¤å¤„ç¼“å†²ï¼šåœ¨é‡å†™è¿‡ç¨‹ä¸­ï¼Œå¦‚æœæœ‰æ–°çš„å†™å…¥è¯·æ±‚ï¼Œä¼šç”±ä¸»è¿›ç¨‹åˆ†åˆ«å†™å…¥AOFç¼“å†²å’ŒAOFé‡å†™ç¼“å†²ã€‚AOFç¼“å†²ç”¨äºä¿è¯å³ä½¿æ­¤æ—¶å‘ç”Ÿå®•æœºï¼ŒåŸæ¥çš„AOFæ—¥å¿—ä¹Ÿæ˜¯å®Œæ•´çš„ï¼Œå¯ç”¨äºæ¢å¤ã€‚AOFé‡å†™ç¼“å†²ç”¨äºä¿è¯æ–°çš„AOFæ–‡ä»¶ä¸ä¼šä¸¢å¤±æœ€æ–°çš„å†™å…¥æ“ä½œ\n\n<img src=\"https://raw.githubusercontent.com/lyydsheep/pic/main/202410282135209.png\" alt=\"image-20241028213530151\" style=\"zoom:80%;\" />\n\n### AOFæ··åˆæŒä¹…åŒ–\n\nAOFæ··åˆæŒä¹…åŒ–æ˜¯æŒ‡ï¼Œåœ¨AOFé‡å†™é˜¶æ®µï¼ŒRediså°†ç°é˜¶æ®µçš„æ•°æ®çŠ¶æ€ä¿å­˜ä¸ºRDBçŠ¶æ€çš„äºŒè¿›åˆ¶æ•°æ®ï¼Œå¹¶å†™å…¥AOFæ–‡ä»¶ï¼Œç„¶åå†å°†AOFé‡å†™ç¼“å†²åŒºä¸­çš„æ—¥å¿—æ•°æ®å†™å…¥åˆ°AOFæ–‡ä»¶ï¼Œæœ€åæŠŠæ–°ç”Ÿæˆçš„AOFæ–‡ä»¶æ›¿æ¢æ‰æ—§çš„AOFæ–‡ä»¶ã€‚\n\næ­¤æ—¶çš„AOFæ–‡ä»¶æ—¢åŒ…å«äºŒè¿›åˆ¶æ•°æ®ï¼ŒåˆåŒ…å«æ—¥å¿—æ•°æ®ï¼Œæ‰€ä»¥å«åšæ··åˆæŒä¹…åŒ–ã€‚\n\nAOFæ··åˆæŒä¹…åŒ–é€šè¿‡é™ä½AOFæ–‡ä»¶çš„å¯è¯»æ€§ï¼Œç”¨äºŒè¿›åˆ¶æ•°æ®è®°å½•æ•°æ®çŠ¶æ€ï¼Œå‡å°‘äº†AOFæ–‡ä»¶çš„ä½“ç§¯å¤§å°ã€‚","slug":"Redis/RedisæŒä¹…åŒ–","published":1,"date":"2024-12-27T11:03:15.343Z","updated":"2024-12-27T11:03:15.343Z","comments":1,"layout":"post","photos":[],"_id":"cm6c7md6n002ma5t2fvuvgq7a","content":"<h1 id=\"RedisæŒä¹…åŒ–\"><a href=\"#RedisæŒä¹…åŒ–\" class=\"headerlink\" title=\"RedisæŒä¹…åŒ–\"></a>RedisæŒä¹…åŒ–</h1><blockquote>\n<p>æŒä¹…åŒ–æ˜¯ä»€ä¹ˆï¼Ÿ</p>\n</blockquote>\n<p>Redisä¸­çš„æ•°æ®æ˜¯å­˜å‚¨åœ¨å†…å­˜ä¸Šçš„ï¼Œå€˜è‹¥å‘ç”Ÿç³»ç»Ÿå¥”æºƒæˆ–ç¨‹åºé‡å¯ï¼ŒRedisä¸­çš„æ•°æ®å°±ä¼šä¸¢å¤±ã€‚å¦‚æœä¸šåŠ¡åœºæ™¯å¸Œæœ›å³ä½¿å‡ºç°å¼‚å¸¸æƒ…å†µï¼ŒRedisä¸­çš„æ•°æ®ä¹Ÿä¸ä¼šä¸¢å¤±ï¼Œå°±éœ€è¦å°†Redisä¸­çš„æ•°æ®<strong>æŒä¹…åŒ–</strong>ä¿å­˜åˆ°å­˜å‚¨è®¾å¤‡ä¸Šã€‚</p>\n<h2 id=\"RedisæŒä¹…åŒ–æ–¹å¼\"><a href=\"#RedisæŒä¹…åŒ–æ–¹å¼\" class=\"headerlink\" title=\"RedisæŒä¹…åŒ–æ–¹å¼\"></a>RedisæŒä¹…åŒ–æ–¹å¼</h2><p>Redisæä¾›äº†ä¸¤ç§æŒä¹…åŒ–æ–¹å¼ï¼š</p>\n<ol>\n<li><p>RDBï¼ˆRedis Database Backupï¼‰æ˜¯ä¸€ç§ä¿å­˜æ•°æ®å¿«ç…§çš„æŒä¹…åŒ–ç­–ç•¥ã€‚å½“å¼€å¯RDBç­–ç•¥åï¼ŒRedisæ¯ä¸ªä¸€æ®µæ—¶é—´å°±ä¼šå°†å…¨å±€æ•°æ®ä»¥<strong>äºŒè¿›åˆ¶</strong>æ•°æ®çš„å½¢å¼ä¿å­˜åœ¨ç£ç›˜ï¼Œåç»­é€šè¿‡åŠ è½½RDBæ–‡ä»¶æ¢å¤æ•°æ®ã€‚</p>\n<img src=\"https://raw.githubusercontent.com/lyydsheep/pic/main/202410251409010.png\" alt=\"image-20241025140840529\" style=\"zoom:80%;\" />\n</li>\n<li><p>AOFï¼ˆAppend Only Fileï¼‰ä»¥è®°å½•æ—¥å¿—ç¡®ä¿æ•°æ®æŒä¹…åŒ–ã€‚å½“å¼€å¯AOFç­–ç•¥åï¼ŒRedisä¼šå°†æ¯ä¸€æ¡<strong>æ•°æ®æ›´æ–°æ“ä½œ</strong>è®°å½•åˆ°æ—¥å¿—ï¼Œåç»­é€šè¿‡é‡æ”¾æ—¥å¿—æ¢å¤æ•°æ®</p>\n<img src=\"https://raw.githubusercontent.com/lyydsheep/pic/main/202410251412091.png\" alt=\"image-20241025140840529\" style=\"zoom:80%;\" /></li>\n</ol>\n<p>ä»ä¸¤ç§ç­–ç•¥çš„å®šä¹‰ä¸­å¾ˆå®¹æ˜“èƒ½çœ‹å‡ºæ¥ä¸¤ç§æ–¹æ¡ˆæœ‰ä¸€ä¸‹ä¸åŒç‚¹ï¼š</p>\n<ul>\n<li>ä½“ç§¯ï¼šåœ¨åŒç­‰æ•°æ®é‡çš„æƒ…å†µä¸‹ï¼ŒRDBæ¯”AOFä½“ç§¯æ›´å°ï¼Œå› ä¸ºRDBä¿å­˜çš„æ˜¯<strong>äºŒè¿›åˆ¶ç´§å‡‘æ•°æ®</strong></li>\n<li>æ¢å¤é€Ÿåº¦ï¼šRDBæ˜¯å¿«ç…§æ•°æ®ï¼Œç›´æ¥åŠ è½½å³å¯æ¢å¤æ•°æ®ï¼Œè€ŒAOFæ–‡ä»¶æ¢å¤éœ€è¦é‡æ”¾æ—¥å¿—ï¼Œå¼€é”€æ›´å¤§</li>\n<li>æ•°æ®å®Œæ•´æ€§ï¼šRDBæ˜¯é—´éš”ä¸€æ®µæ—¶é—´å°±è®°å½•ä¸€æ¬¡ï¼Œç›¸æ¯”ä¹‹ä¸‹ï¼ŒAOFæ–‡ä»¶è®°å½•æ¯ä¸€æ¡æ“ä½œï¼Œä¿å­˜çš„æ•°æ®æ›´åŠ å®Œæ•´</li>\n</ul>\n<h3 id=\"RDBè¿˜æ˜¯AOFï¼Ÿ\"><a href=\"#RDBè¿˜æ˜¯AOFï¼Ÿ\" class=\"headerlink\" title=\"RDBè¿˜æ˜¯AOFï¼Ÿ\"></a>RDBè¿˜æ˜¯AOFï¼Ÿ</h3><blockquote>\n<p>åœ¨Redisä¸­ï¼ŒRDBæ˜¯é»˜è®¤å¼€å¯çš„ï¼Œè€ŒAOFæ˜¯é»˜è®¤å…³é—­çš„ã€‚</p>\n</blockquote>\n<p>ä½¿ç”¨RDBè¿˜æ˜¯AOFæŒä¹…åŒ–ç­–ç•¥éœ€è¦ä¾æ®å…·ä½“åœºæ™¯åˆ¤æ–­ï¼š</p>\n<p>å¦‚æœå¯¹æ•°æ®å®Œæ•´æ€§è¦æ±‚è¾ƒé«˜ï¼Œåˆ™éœ€è¦å°†<strong>RDBã€AOF</strong>åŒæ—¶å¼€å¯ã€‚æ­¤æ—¶ï¼Œè¿›è¡Œæ•°æ®æ¢å¤åªä¼šé‡‡ç”¨AOFæ–‡ä»¶ï¼Œå› ä¸ºæ—¢ç„¶å¼€å¯äº†AOFç­–ç•¥é‚£ä¹ˆå°±è¯´æ˜éœ€è¦æ•°æ®å®Œæ•´æ€§æ›´å¼ºçš„AOFæ–‡ä»¶ï¼Œè€Œä¸æ˜¯å¯èƒ½ç¼ºå°‘ä¸€äº›æ•°æ®çš„RDBæ–‡ä»¶</p>\n<img src=\"https://raw.githubusercontent.com/lyydsheep/pic/main/202410251432209.png\" alt=\"image-20241025143254030\" style=\"zoom:80%;\" />\n\n<p>å¦‚æœèƒ½å¤Ÿå¿å—å‡ åˆ†é’Ÿçš„æ•°æ®ä¸¢å¤±ï¼Œå°±å¯ä»¥<strong>åªå¼€å¯RDBç­–ç•¥</strong>ã€‚ä½†ä¸å»ºè®®å•ç‹¬å¼€å¯AOFç­–ç•¥ï¼Œå…·ä½“åŸå› å¯å‚è€ƒå®˜æ–¹çš„è§£é‡Šï¼š</p>\n<img src=\"https://raw.githubusercontent.com/lyydsheep/pic/main/202410251435012.png\" alt=\"image-20241025143518646\" style=\"zoom:80%;\" />\n\n<h2 id=\"RDBè¯¦è§£\"><a href=\"#RDBè¯¦è§£\" class=\"headerlink\" title=\"RDBè¯¦è§£\"></a>RDBè¯¦è§£</h2><p>RDBå±äºæ•°æ®å¿«ç…§æŒä¹…åŒ–ç­–ç•¥ï¼Œæ˜¯ä¸€ç§æœ€å¸¸è§ã€æœ€ç¨³å®šçš„æ•°æ®æŒä¹…åŒ–æ–¹æ¡ˆã€‚é‚£ä¹ˆå¦‚ä½•åœ¨Redisä¸­å¼€å¯RDBæŒä¹…åŒ–ç­–ç•¥ï¼Ÿ</p>\n<p>ç”±äºRedisé»˜è®¤æ”¯æŒRDBæŒä¹…åŒ–ï¼Œå› æ­¤æˆ‘ä»¬å¯ä»¥åœ¨é…ç½®æ–‡ä»¶ä¸­çœ‹åˆ°å¦‚ä¸‹å†…å®¹</p>\n<img src=\"https://raw.githubusercontent.com/lyydsheep/pic/main/202410251940149.png\" alt=\"image-20241025194036067\" style=\"zoom:80%;\" />\n\n<p>å…¶ä¸­<code>save interval changes</code>å°±ä»£è¡¨ç€å½“ä¸€å®šæ—¶é—´é—´éš”è¿›è¡Œäº†å¤šå°‘æ¬¡æ•°æ®ä¿®æ”¹å°±è§¦å‘RDBæŒä¹…åŒ–ï¼Œå°†æ•°æ®ä¿å­˜åˆ°ç£ç›˜ä¸Š</p>\n<p>å½“ç„¶ï¼Œé™¤äº†ä¸Šè¿°è¢«åŠ¨è§¦å‘RDBæŒä¹…åŒ–ï¼ŒRedisè¿˜æä¾›äº†ä¸¤æ¡å‘½ä»¤æ¥æ”¯æŒä¸»åŠ¨æŒä¹…åŒ–åŠŸèƒ½</p>\n<ul>\n<li>saveï¼šRedisä¸»çº¿ç¨‹å°†å…¨å±€æ•°æ®ç”ŸæˆäºŒè¿›åˆ¶æ–‡ä»¶ã€‚å¦‚æœå†…å­˜ä¸­çš„æ•°æ®é‡åºå¤§ï¼Œé‚£ä¹ˆè¯¥å‘½ä»¤å¯èƒ½ä¼šå¯¼è‡´ä¸»çº¿ç¨‹é˜»å¡ï¼Œé™ä½ç³»ç»Ÿçš„æ‰§è¡Œæ•ˆç‡</li>\n<li>bgsaveï¼šRedisä¸»çº¿ç¨‹forkä¸€ä¸ªå­è¿›ç¨‹ï¼Œå­è¿›ç¨‹æ‰§è¡ŒæŒä¹…åŒ–æ•°æ®çš„æ“ä½œç”Ÿæˆä¸€ä¸ªæ–°çš„rdbæ–‡ä»¶å¹¶å°†æ—§çš„rdbæ–‡ä»¶æ›¿æ¢ï¼Œé¿å…äº†ä¸»çº¿ç¨‹é˜»å¡<ul>\n<li>ä¸Šè¿°è¢«åŠ¨è§¦å‘RDBæŒä¹…åŒ–æœ¬è´¨ä¸Šå°±æ˜¯è°ƒç”¨äº†<code>bgsave</code>å‘½ä»¤</li>\n</ul>\n</li>\n</ul>\n<p>é™¤æ­¤ä¹‹å¤–ï¼ŒRedisåœ¨ç¨‹åºå…³é—­æ—¶ä¼šè‡ªåŠ¨è§¦å‘<code>save</code>å‘½ä»¤ï¼Œé˜»å¡ä¸»çº¿ç¨‹è¿›è¡Œæ•°æ®æŒä¹…åŒ–ï¼Œä»¥è®°å½•æ›´åŠ å®Œå…¨çš„æ•°æ®ã€‚</p>\n<h3 id=\"å†™æ—¶å¤åˆ¶\"><a href=\"#å†™æ—¶å¤åˆ¶\" class=\"headerlink\" title=\"å†™æ—¶å¤åˆ¶\"></a>å†™æ—¶å¤åˆ¶</h3><p>è°ƒç”¨<code>bgsave</code>å‘½ä»¤åï¼Œæ‰§è¡ŒRDBæŒä¹…åŒ–è¿‡ç¨‹ä¸­ï¼ŒRedisä¾ç„¶å¯ä»¥ç»§ç»­å¤„ç†å…¶ä»–å‘½ä»¤ï¼Œè¿™éƒ½å¾—ç›Šäº<strong>å†™æ—¶å¤åˆ¶</strong>æŠ€æœ¯</p>\n<p>Redisä¸»çº¿ç¨‹forkå­è¿›ç¨‹æ—¶ï¼Œä¸ºäº†èŠ‚çœå†…å­˜ç©ºé—´ï¼Œå­è¿›ç¨‹ä»…ä»…å¤åˆ¶çˆ¶è¿›ç¨‹çš„é¡µè¡¨ï¼Œä¸¤ä¸ªè¿›ç¨‹çš„é¡µè¡¨æŒ‡å‘åŒä¸€å—ç‰©ç†å†…å­˜ã€‚</p>\n<img src=\"https://raw.githubusercontent.com/lyydsheep/pic/main/202410252022075.png\" alt=\"image-20241025202223000\" style=\"zoom:80%;\" />\n\n<p>æ¥ç€ï¼Œå­è¿›ç¨‹ä¾æ®ç‰©ç†å†…å­˜ä¸Šçš„æ•°æ®ç”Ÿæˆæ–°çš„rdbæ–‡ä»¶ã€‚å› ä¸ºRDBæ˜¯å¿«ç…§æŒä¹…åŒ–ç­–ç•¥ï¼Œå­è¿›ç¨‹åªä¼šä¿å­˜è°ƒç”¨<code>bgsave</code>å‘½ä»¤é‚£ä¸€åˆ»çš„æ•°æ®ï¼Œæ‰€ä»¥å³ä½¿ç”Ÿæˆrdbæ–‡ä»¶çš„è¿‡ç¨‹ä¸­ä¸»è¿›ç¨‹å‘ç”Ÿäº†å†™æ“ä½œï¼Œä¹Ÿä¸èƒ½å½±å“å­è¿›ç¨‹çš„æ•°æ®ã€‚ä¸ºäº†æ»¡è¶³è¿™ä¸€è¦æ±‚ï¼Œ<strong>ä¸»è¿›ç¨‹ä¼šå¤åˆ¶ä¸€ä»½å¯¹åº”çš„ç‰©ç†å†…å­˜ï¼Œç„¶ååœ¨ä¸Šé¢è¿›è¡Œå†™æ“ä½œï¼Œä»è€Œä¸å½±å“å­è¿›ç¨‹çš„æ•°æ®</strong>ï¼Œè¿™å°±æ˜¯å†™æ—¶å¤åˆ¶æœºåˆ¶ã€‚</p>\n<img src=\"https://raw.githubusercontent.com/lyydsheep/pic/main/202410252022156.png\" alt=\"image-20241025202241119\" style=\"zoom:80%;\" />\n\n<h2 id=\"AOFè¯¦è§£\"><a href=\"#AOFè¯¦è§£\" class=\"headerlink\" title=\"AOFè¯¦è§£\"></a>AOFè¯¦è§£</h2><p>AOFæŒä¹…åŒ–ç­–ç•¥åœ¨Redisä¸­æ˜¯é»˜è®¤å…³é—­çš„ï¼Œéœ€è¦æ‰‹åŠ¨å¼€å¯ï¼Œå¼€å¯ä¹‹åï¼ŒRedisä¼šå°†æ¯ä¸€æ¡æ›´æ–°æ“ä½œè®°å½•åœ¨AOFæ–‡ä»¶ã€‚å½“é‡å¯æ—¶ï¼ŒRediså°±å¯ä»¥é€šè¿‡AOFæ–‡ä»¶å°†æ‰€æœ‰çš„è¯·æ±‚é‡æ”¾ï¼Œæ¢å¤æ•°æ®ï¼Œä½†é€Ÿåº¦å¾ˆæ…¢ã€‚</p>\n<h3 id=\"AOFå†™å…¥æµç¨‹\"><a href=\"#AOFå†™å…¥æµç¨‹\" class=\"headerlink\" title=\"AOFå†™å…¥æµç¨‹\"></a>AOFå†™å…¥æµç¨‹</h3><p>AOFæ–‡ä»¶å†™å…¥æµç¨‹å¤§è‡´åˆ†ä¸ºä¸‰æ­¥ï¼š</p>\n<ol>\n<li>å°†æ•°æ®å†™å…¥AOFç¼“å­˜ï¼Œå®è´¨æ˜¯ä¸€ä¸ªsdsæ•°æ®</li>\n<li>å°†AOFç¼“å­˜åˆ·å…¥ç£ç›˜ç¼“å†²åŒºï¼ˆpage cacheï¼‰ä¸­</li>\n<li>åˆ·ç›˜</li>\n</ol>\n<p><img src=\"https://raw.githubusercontent.com/lyydsheep/pic/main/202410282126394.png\" alt=\"image-20241028212538059\"></p>\n<h3 id=\"AOFé‡å†™\"><a href=\"#AOFé‡å†™\" class=\"headerlink\" title=\"AOFé‡å†™\"></a>AOFé‡å†™</h3><p>éšç€ç”¨æˆ·çš„è¯·æ±‚é€æ¸ç§¯ç´¯ï¼ŒAOFæ–‡ä»¶ä¼šé€æ¸è†¨èƒ€ï¼Œä½†æ˜¯AOFæ–‡ä»¶ä¸­æœ‰æ•ˆè®°å½•æ˜¯å°‘é‡çš„ã€‚è¿™æ˜¯å› ä¸ºï¼Œå¯¹ä¸€ä¸ªkeyä¿®æ”¹æˆåƒä¸Šä¸‡æ¬¡ï¼Œåªæœ‰æœ€åä¸€æ¬¡ä¿®æ”¹æ˜¯æœ‰æ•ˆçš„ï¼Œéœ€è¦çœŸæ­£ä¿å­˜åœ¨AOFæ–‡ä»¶ä¸­ï¼Œè€Œä¹‹å‰çš„ä¿®æ”¹éƒ½æ˜¯æ— æ•ˆçš„ã€‚æ‰€ä»¥ï¼Œå®Œå…¨å¯ä»¥å°†AOFæ–‡ä»¶ä¸­çš„æ— æ•ˆè®°å½•åˆ é™¤ï¼Œé¿å…AOFæ–‡ä»¶è¿‡äºåºå¤§ã€‚</p>\n<p>AOFé‡å†™è¿‡ç¨‹å¯ä»¥æ¦‚æ‹¬ä¸º<strong>ä¸€æ¬¡æ‹·è´ï¼Œä¸¤å¤„ç¼“å†²</strong></p>\n<ul>\n<li>ä¸€æ¬¡æ‹·è´ï¼šé‡å†™å‘ç”Ÿæ—¶ï¼Œä¸»è¿›ç¨‹ä¼šforkå‡ºä¸€ä¸ªå­è¿›ç¨‹ï¼Œå­è¿›ç¨‹å’Œä¸»è¿›ç¨‹å…±äº«Redisç‰©ç†å†…å­˜ï¼Œè®©<strong>å­è¿›ç¨‹å°†è¿™äº›å†…å­˜å†™å…¥é‡å†™æ—¥å¿—</strong></li>\n<li>ä¸¤å¤„ç¼“å†²ï¼šåœ¨é‡å†™è¿‡ç¨‹ä¸­ï¼Œå¦‚æœæœ‰æ–°çš„å†™å…¥è¯·æ±‚ï¼Œä¼šç”±ä¸»è¿›ç¨‹åˆ†åˆ«å†™å…¥AOFç¼“å†²å’ŒAOFé‡å†™ç¼“å†²ã€‚AOFç¼“å†²ç”¨äºä¿è¯å³ä½¿æ­¤æ—¶å‘ç”Ÿå®•æœºï¼ŒåŸæ¥çš„AOFæ—¥å¿—ä¹Ÿæ˜¯å®Œæ•´çš„ï¼Œå¯ç”¨äºæ¢å¤ã€‚AOFé‡å†™ç¼“å†²ç”¨äºä¿è¯æ–°çš„AOFæ–‡ä»¶ä¸ä¼šä¸¢å¤±æœ€æ–°çš„å†™å…¥æ“ä½œ</li>\n</ul>\n<img src=\"https://raw.githubusercontent.com/lyydsheep/pic/main/202410282135209.png\" alt=\"image-20241028213530151\" style=\"zoom:80%;\" />\n\n<h3 id=\"AOFæ··åˆæŒä¹…åŒ–\"><a href=\"#AOFæ··åˆæŒä¹…åŒ–\" class=\"headerlink\" title=\"AOFæ··åˆæŒä¹…åŒ–\"></a>AOFæ··åˆæŒä¹…åŒ–</h3><p>AOFæ··åˆæŒä¹…åŒ–æ˜¯æŒ‡ï¼Œåœ¨AOFé‡å†™é˜¶æ®µï¼ŒRediså°†ç°é˜¶æ®µçš„æ•°æ®çŠ¶æ€ä¿å­˜ä¸ºRDBçŠ¶æ€çš„äºŒè¿›åˆ¶æ•°æ®ï¼Œå¹¶å†™å…¥AOFæ–‡ä»¶ï¼Œç„¶åå†å°†AOFé‡å†™ç¼“å†²åŒºä¸­çš„æ—¥å¿—æ•°æ®å†™å…¥åˆ°AOFæ–‡ä»¶ï¼Œæœ€åæŠŠæ–°ç”Ÿæˆçš„AOFæ–‡ä»¶æ›¿æ¢æ‰æ—§çš„AOFæ–‡ä»¶ã€‚</p>\n<p>æ­¤æ—¶çš„AOFæ–‡ä»¶æ—¢åŒ…å«äºŒè¿›åˆ¶æ•°æ®ï¼ŒåˆåŒ…å«æ—¥å¿—æ•°æ®ï¼Œæ‰€ä»¥å«åšæ··åˆæŒä¹…åŒ–ã€‚</p>\n<p>AOFæ··åˆæŒä¹…åŒ–é€šè¿‡é™ä½AOFæ–‡ä»¶çš„å¯è¯»æ€§ï¼Œç”¨äºŒè¿›åˆ¶æ•°æ®è®°å½•æ•°æ®çŠ¶æ€ï¼Œå‡å°‘äº†AOFæ–‡ä»¶çš„ä½“ç§¯å¤§å°ã€‚</p>\n","excerpt":"","more":"<h1 id=\"RedisæŒä¹…åŒ–\"><a href=\"#RedisæŒä¹…åŒ–\" class=\"headerlink\" title=\"RedisæŒä¹…åŒ–\"></a>RedisæŒä¹…åŒ–</h1><blockquote>\n<p>æŒä¹…åŒ–æ˜¯ä»€ä¹ˆï¼Ÿ</p>\n</blockquote>\n<p>Redisä¸­çš„æ•°æ®æ˜¯å­˜å‚¨åœ¨å†…å­˜ä¸Šçš„ï¼Œå€˜è‹¥å‘ç”Ÿç³»ç»Ÿå¥”æºƒæˆ–ç¨‹åºé‡å¯ï¼ŒRedisä¸­çš„æ•°æ®å°±ä¼šä¸¢å¤±ã€‚å¦‚æœä¸šåŠ¡åœºæ™¯å¸Œæœ›å³ä½¿å‡ºç°å¼‚å¸¸æƒ…å†µï¼ŒRedisä¸­çš„æ•°æ®ä¹Ÿä¸ä¼šä¸¢å¤±ï¼Œå°±éœ€è¦å°†Redisä¸­çš„æ•°æ®<strong>æŒä¹…åŒ–</strong>ä¿å­˜åˆ°å­˜å‚¨è®¾å¤‡ä¸Šã€‚</p>\n<h2 id=\"RedisæŒä¹…åŒ–æ–¹å¼\"><a href=\"#RedisæŒä¹…åŒ–æ–¹å¼\" class=\"headerlink\" title=\"RedisæŒä¹…åŒ–æ–¹å¼\"></a>RedisæŒä¹…åŒ–æ–¹å¼</h2><p>Redisæä¾›äº†ä¸¤ç§æŒä¹…åŒ–æ–¹å¼ï¼š</p>\n<ol>\n<li><p>RDBï¼ˆRedis Database Backupï¼‰æ˜¯ä¸€ç§ä¿å­˜æ•°æ®å¿«ç…§çš„æŒä¹…åŒ–ç­–ç•¥ã€‚å½“å¼€å¯RDBç­–ç•¥åï¼ŒRedisæ¯ä¸ªä¸€æ®µæ—¶é—´å°±ä¼šå°†å…¨å±€æ•°æ®ä»¥<strong>äºŒè¿›åˆ¶</strong>æ•°æ®çš„å½¢å¼ä¿å­˜åœ¨ç£ç›˜ï¼Œåç»­é€šè¿‡åŠ è½½RDBæ–‡ä»¶æ¢å¤æ•°æ®ã€‚</p>\n<img src=\"https://raw.githubusercontent.com/lyydsheep/pic/main/202410251409010.png\" alt=\"image-20241025140840529\" style=\"zoom:80%;\" />\n</li>\n<li><p>AOFï¼ˆAppend Only Fileï¼‰ä»¥è®°å½•æ—¥å¿—ç¡®ä¿æ•°æ®æŒä¹…åŒ–ã€‚å½“å¼€å¯AOFç­–ç•¥åï¼ŒRedisä¼šå°†æ¯ä¸€æ¡<strong>æ•°æ®æ›´æ–°æ“ä½œ</strong>è®°å½•åˆ°æ—¥å¿—ï¼Œåç»­é€šè¿‡é‡æ”¾æ—¥å¿—æ¢å¤æ•°æ®</p>\n<img src=\"https://raw.githubusercontent.com/lyydsheep/pic/main/202410251412091.png\" alt=\"image-20241025140840529\" style=\"zoom:80%;\" /></li>\n</ol>\n<p>ä»ä¸¤ç§ç­–ç•¥çš„å®šä¹‰ä¸­å¾ˆå®¹æ˜“èƒ½çœ‹å‡ºæ¥ä¸¤ç§æ–¹æ¡ˆæœ‰ä¸€ä¸‹ä¸åŒç‚¹ï¼š</p>\n<ul>\n<li>ä½“ç§¯ï¼šåœ¨åŒç­‰æ•°æ®é‡çš„æƒ…å†µä¸‹ï¼ŒRDBæ¯”AOFä½“ç§¯æ›´å°ï¼Œå› ä¸ºRDBä¿å­˜çš„æ˜¯<strong>äºŒè¿›åˆ¶ç´§å‡‘æ•°æ®</strong></li>\n<li>æ¢å¤é€Ÿåº¦ï¼šRDBæ˜¯å¿«ç…§æ•°æ®ï¼Œç›´æ¥åŠ è½½å³å¯æ¢å¤æ•°æ®ï¼Œè€ŒAOFæ–‡ä»¶æ¢å¤éœ€è¦é‡æ”¾æ—¥å¿—ï¼Œå¼€é”€æ›´å¤§</li>\n<li>æ•°æ®å®Œæ•´æ€§ï¼šRDBæ˜¯é—´éš”ä¸€æ®µæ—¶é—´å°±è®°å½•ä¸€æ¬¡ï¼Œç›¸æ¯”ä¹‹ä¸‹ï¼ŒAOFæ–‡ä»¶è®°å½•æ¯ä¸€æ¡æ“ä½œï¼Œä¿å­˜çš„æ•°æ®æ›´åŠ å®Œæ•´</li>\n</ul>\n<h3 id=\"RDBè¿˜æ˜¯AOFï¼Ÿ\"><a href=\"#RDBè¿˜æ˜¯AOFï¼Ÿ\" class=\"headerlink\" title=\"RDBè¿˜æ˜¯AOFï¼Ÿ\"></a>RDBè¿˜æ˜¯AOFï¼Ÿ</h3><blockquote>\n<p>åœ¨Redisä¸­ï¼ŒRDBæ˜¯é»˜è®¤å¼€å¯çš„ï¼Œè€ŒAOFæ˜¯é»˜è®¤å…³é—­çš„ã€‚</p>\n</blockquote>\n<p>ä½¿ç”¨RDBè¿˜æ˜¯AOFæŒä¹…åŒ–ç­–ç•¥éœ€è¦ä¾æ®å…·ä½“åœºæ™¯åˆ¤æ–­ï¼š</p>\n<p>å¦‚æœå¯¹æ•°æ®å®Œæ•´æ€§è¦æ±‚è¾ƒé«˜ï¼Œåˆ™éœ€è¦å°†<strong>RDBã€AOF</strong>åŒæ—¶å¼€å¯ã€‚æ­¤æ—¶ï¼Œè¿›è¡Œæ•°æ®æ¢å¤åªä¼šé‡‡ç”¨AOFæ–‡ä»¶ï¼Œå› ä¸ºæ—¢ç„¶å¼€å¯äº†AOFç­–ç•¥é‚£ä¹ˆå°±è¯´æ˜éœ€è¦æ•°æ®å®Œæ•´æ€§æ›´å¼ºçš„AOFæ–‡ä»¶ï¼Œè€Œä¸æ˜¯å¯èƒ½ç¼ºå°‘ä¸€äº›æ•°æ®çš„RDBæ–‡ä»¶</p>\n<img src=\"https://raw.githubusercontent.com/lyydsheep/pic/main/202410251432209.png\" alt=\"image-20241025143254030\" style=\"zoom:80%;\" />\n\n<p>å¦‚æœèƒ½å¤Ÿå¿å—å‡ åˆ†é’Ÿçš„æ•°æ®ä¸¢å¤±ï¼Œå°±å¯ä»¥<strong>åªå¼€å¯RDBç­–ç•¥</strong>ã€‚ä½†ä¸å»ºè®®å•ç‹¬å¼€å¯AOFç­–ç•¥ï¼Œå…·ä½“åŸå› å¯å‚è€ƒå®˜æ–¹çš„è§£é‡Šï¼š</p>\n<img src=\"https://raw.githubusercontent.com/lyydsheep/pic/main/202410251435012.png\" alt=\"image-20241025143518646\" style=\"zoom:80%;\" />\n\n<h2 id=\"RDBè¯¦è§£\"><a href=\"#RDBè¯¦è§£\" class=\"headerlink\" title=\"RDBè¯¦è§£\"></a>RDBè¯¦è§£</h2><p>RDBå±äºæ•°æ®å¿«ç…§æŒä¹…åŒ–ç­–ç•¥ï¼Œæ˜¯ä¸€ç§æœ€å¸¸è§ã€æœ€ç¨³å®šçš„æ•°æ®æŒä¹…åŒ–æ–¹æ¡ˆã€‚é‚£ä¹ˆå¦‚ä½•åœ¨Redisä¸­å¼€å¯RDBæŒä¹…åŒ–ç­–ç•¥ï¼Ÿ</p>\n<p>ç”±äºRedisé»˜è®¤æ”¯æŒRDBæŒä¹…åŒ–ï¼Œå› æ­¤æˆ‘ä»¬å¯ä»¥åœ¨é…ç½®æ–‡ä»¶ä¸­çœ‹åˆ°å¦‚ä¸‹å†…å®¹</p>\n<img src=\"https://raw.githubusercontent.com/lyydsheep/pic/main/202410251940149.png\" alt=\"image-20241025194036067\" style=\"zoom:80%;\" />\n\n<p>å…¶ä¸­<code>save interval changes</code>å°±ä»£è¡¨ç€å½“ä¸€å®šæ—¶é—´é—´éš”è¿›è¡Œäº†å¤šå°‘æ¬¡æ•°æ®ä¿®æ”¹å°±è§¦å‘RDBæŒä¹…åŒ–ï¼Œå°†æ•°æ®ä¿å­˜åˆ°ç£ç›˜ä¸Š</p>\n<p>å½“ç„¶ï¼Œé™¤äº†ä¸Šè¿°è¢«åŠ¨è§¦å‘RDBæŒä¹…åŒ–ï¼ŒRedisè¿˜æä¾›äº†ä¸¤æ¡å‘½ä»¤æ¥æ”¯æŒä¸»åŠ¨æŒä¹…åŒ–åŠŸèƒ½</p>\n<ul>\n<li>saveï¼šRedisä¸»çº¿ç¨‹å°†å…¨å±€æ•°æ®ç”ŸæˆäºŒè¿›åˆ¶æ–‡ä»¶ã€‚å¦‚æœå†…å­˜ä¸­çš„æ•°æ®é‡åºå¤§ï¼Œé‚£ä¹ˆè¯¥å‘½ä»¤å¯èƒ½ä¼šå¯¼è‡´ä¸»çº¿ç¨‹é˜»å¡ï¼Œé™ä½ç³»ç»Ÿçš„æ‰§è¡Œæ•ˆç‡</li>\n<li>bgsaveï¼šRedisä¸»çº¿ç¨‹forkä¸€ä¸ªå­è¿›ç¨‹ï¼Œå­è¿›ç¨‹æ‰§è¡ŒæŒä¹…åŒ–æ•°æ®çš„æ“ä½œç”Ÿæˆä¸€ä¸ªæ–°çš„rdbæ–‡ä»¶å¹¶å°†æ—§çš„rdbæ–‡ä»¶æ›¿æ¢ï¼Œé¿å…äº†ä¸»çº¿ç¨‹é˜»å¡<ul>\n<li>ä¸Šè¿°è¢«åŠ¨è§¦å‘RDBæŒä¹…åŒ–æœ¬è´¨ä¸Šå°±æ˜¯è°ƒç”¨äº†<code>bgsave</code>å‘½ä»¤</li>\n</ul>\n</li>\n</ul>\n<p>é™¤æ­¤ä¹‹å¤–ï¼ŒRedisåœ¨ç¨‹åºå…³é—­æ—¶ä¼šè‡ªåŠ¨è§¦å‘<code>save</code>å‘½ä»¤ï¼Œé˜»å¡ä¸»çº¿ç¨‹è¿›è¡Œæ•°æ®æŒä¹…åŒ–ï¼Œä»¥è®°å½•æ›´åŠ å®Œå…¨çš„æ•°æ®ã€‚</p>\n<h3 id=\"å†™æ—¶å¤åˆ¶\"><a href=\"#å†™æ—¶å¤åˆ¶\" class=\"headerlink\" title=\"å†™æ—¶å¤åˆ¶\"></a>å†™æ—¶å¤åˆ¶</h3><p>è°ƒç”¨<code>bgsave</code>å‘½ä»¤åï¼Œæ‰§è¡ŒRDBæŒä¹…åŒ–è¿‡ç¨‹ä¸­ï¼ŒRedisä¾ç„¶å¯ä»¥ç»§ç»­å¤„ç†å…¶ä»–å‘½ä»¤ï¼Œè¿™éƒ½å¾—ç›Šäº<strong>å†™æ—¶å¤åˆ¶</strong>æŠ€æœ¯</p>\n<p>Redisä¸»çº¿ç¨‹forkå­è¿›ç¨‹æ—¶ï¼Œä¸ºäº†èŠ‚çœå†…å­˜ç©ºé—´ï¼Œå­è¿›ç¨‹ä»…ä»…å¤åˆ¶çˆ¶è¿›ç¨‹çš„é¡µè¡¨ï¼Œä¸¤ä¸ªè¿›ç¨‹çš„é¡µè¡¨æŒ‡å‘åŒä¸€å—ç‰©ç†å†…å­˜ã€‚</p>\n<img src=\"https://raw.githubusercontent.com/lyydsheep/pic/main/202410252022075.png\" alt=\"image-20241025202223000\" style=\"zoom:80%;\" />\n\n<p>æ¥ç€ï¼Œå­è¿›ç¨‹ä¾æ®ç‰©ç†å†…å­˜ä¸Šçš„æ•°æ®ç”Ÿæˆæ–°çš„rdbæ–‡ä»¶ã€‚å› ä¸ºRDBæ˜¯å¿«ç…§æŒä¹…åŒ–ç­–ç•¥ï¼Œå­è¿›ç¨‹åªä¼šä¿å­˜è°ƒç”¨<code>bgsave</code>å‘½ä»¤é‚£ä¸€åˆ»çš„æ•°æ®ï¼Œæ‰€ä»¥å³ä½¿ç”Ÿæˆrdbæ–‡ä»¶çš„è¿‡ç¨‹ä¸­ä¸»è¿›ç¨‹å‘ç”Ÿäº†å†™æ“ä½œï¼Œä¹Ÿä¸èƒ½å½±å“å­è¿›ç¨‹çš„æ•°æ®ã€‚ä¸ºäº†æ»¡è¶³è¿™ä¸€è¦æ±‚ï¼Œ<strong>ä¸»è¿›ç¨‹ä¼šå¤åˆ¶ä¸€ä»½å¯¹åº”çš„ç‰©ç†å†…å­˜ï¼Œç„¶ååœ¨ä¸Šé¢è¿›è¡Œå†™æ“ä½œï¼Œä»è€Œä¸å½±å“å­è¿›ç¨‹çš„æ•°æ®</strong>ï¼Œè¿™å°±æ˜¯å†™æ—¶å¤åˆ¶æœºåˆ¶ã€‚</p>\n<img src=\"https://raw.githubusercontent.com/lyydsheep/pic/main/202410252022156.png\" alt=\"image-20241025202241119\" style=\"zoom:80%;\" />\n\n<h2 id=\"AOFè¯¦è§£\"><a href=\"#AOFè¯¦è§£\" class=\"headerlink\" title=\"AOFè¯¦è§£\"></a>AOFè¯¦è§£</h2><p>AOFæŒä¹…åŒ–ç­–ç•¥åœ¨Redisä¸­æ˜¯é»˜è®¤å…³é—­çš„ï¼Œéœ€è¦æ‰‹åŠ¨å¼€å¯ï¼Œå¼€å¯ä¹‹åï¼ŒRedisä¼šå°†æ¯ä¸€æ¡æ›´æ–°æ“ä½œè®°å½•åœ¨AOFæ–‡ä»¶ã€‚å½“é‡å¯æ—¶ï¼ŒRediså°±å¯ä»¥é€šè¿‡AOFæ–‡ä»¶å°†æ‰€æœ‰çš„è¯·æ±‚é‡æ”¾ï¼Œæ¢å¤æ•°æ®ï¼Œä½†é€Ÿåº¦å¾ˆæ…¢ã€‚</p>\n<h3 id=\"AOFå†™å…¥æµç¨‹\"><a href=\"#AOFå†™å…¥æµç¨‹\" class=\"headerlink\" title=\"AOFå†™å…¥æµç¨‹\"></a>AOFå†™å…¥æµç¨‹</h3><p>AOFæ–‡ä»¶å†™å…¥æµç¨‹å¤§è‡´åˆ†ä¸ºä¸‰æ­¥ï¼š</p>\n<ol>\n<li>å°†æ•°æ®å†™å…¥AOFç¼“å­˜ï¼Œå®è´¨æ˜¯ä¸€ä¸ªsdsæ•°æ®</li>\n<li>å°†AOFç¼“å­˜åˆ·å…¥ç£ç›˜ç¼“å†²åŒºï¼ˆpage cacheï¼‰ä¸­</li>\n<li>åˆ·ç›˜</li>\n</ol>\n<p><img src=\"https://raw.githubusercontent.com/lyydsheep/pic/main/202410282126394.png\" alt=\"image-20241028212538059\"></p>\n<h3 id=\"AOFé‡å†™\"><a href=\"#AOFé‡å†™\" class=\"headerlink\" title=\"AOFé‡å†™\"></a>AOFé‡å†™</h3><p>éšç€ç”¨æˆ·çš„è¯·æ±‚é€æ¸ç§¯ç´¯ï¼ŒAOFæ–‡ä»¶ä¼šé€æ¸è†¨èƒ€ï¼Œä½†æ˜¯AOFæ–‡ä»¶ä¸­æœ‰æ•ˆè®°å½•æ˜¯å°‘é‡çš„ã€‚è¿™æ˜¯å› ä¸ºï¼Œå¯¹ä¸€ä¸ªkeyä¿®æ”¹æˆåƒä¸Šä¸‡æ¬¡ï¼Œåªæœ‰æœ€åä¸€æ¬¡ä¿®æ”¹æ˜¯æœ‰æ•ˆçš„ï¼Œéœ€è¦çœŸæ­£ä¿å­˜åœ¨AOFæ–‡ä»¶ä¸­ï¼Œè€Œä¹‹å‰çš„ä¿®æ”¹éƒ½æ˜¯æ— æ•ˆçš„ã€‚æ‰€ä»¥ï¼Œå®Œå…¨å¯ä»¥å°†AOFæ–‡ä»¶ä¸­çš„æ— æ•ˆè®°å½•åˆ é™¤ï¼Œé¿å…AOFæ–‡ä»¶è¿‡äºåºå¤§ã€‚</p>\n<p>AOFé‡å†™è¿‡ç¨‹å¯ä»¥æ¦‚æ‹¬ä¸º<strong>ä¸€æ¬¡æ‹·è´ï¼Œä¸¤å¤„ç¼“å†²</strong></p>\n<ul>\n<li>ä¸€æ¬¡æ‹·è´ï¼šé‡å†™å‘ç”Ÿæ—¶ï¼Œä¸»è¿›ç¨‹ä¼šforkå‡ºä¸€ä¸ªå­è¿›ç¨‹ï¼Œå­è¿›ç¨‹å’Œä¸»è¿›ç¨‹å…±äº«Redisç‰©ç†å†…å­˜ï¼Œè®©<strong>å­è¿›ç¨‹å°†è¿™äº›å†…å­˜å†™å…¥é‡å†™æ—¥å¿—</strong></li>\n<li>ä¸¤å¤„ç¼“å†²ï¼šåœ¨é‡å†™è¿‡ç¨‹ä¸­ï¼Œå¦‚æœæœ‰æ–°çš„å†™å…¥è¯·æ±‚ï¼Œä¼šç”±ä¸»è¿›ç¨‹åˆ†åˆ«å†™å…¥AOFç¼“å†²å’ŒAOFé‡å†™ç¼“å†²ã€‚AOFç¼“å†²ç”¨äºä¿è¯å³ä½¿æ­¤æ—¶å‘ç”Ÿå®•æœºï¼ŒåŸæ¥çš„AOFæ—¥å¿—ä¹Ÿæ˜¯å®Œæ•´çš„ï¼Œå¯ç”¨äºæ¢å¤ã€‚AOFé‡å†™ç¼“å†²ç”¨äºä¿è¯æ–°çš„AOFæ–‡ä»¶ä¸ä¼šä¸¢å¤±æœ€æ–°çš„å†™å…¥æ“ä½œ</li>\n</ul>\n<img src=\"https://raw.githubusercontent.com/lyydsheep/pic/main/202410282135209.png\" alt=\"image-20241028213530151\" style=\"zoom:80%;\" />\n\n<h3 id=\"AOFæ··åˆæŒä¹…åŒ–\"><a href=\"#AOFæ··åˆæŒä¹…åŒ–\" class=\"headerlink\" title=\"AOFæ··åˆæŒä¹…åŒ–\"></a>AOFæ··åˆæŒä¹…åŒ–</h3><p>AOFæ··åˆæŒä¹…åŒ–æ˜¯æŒ‡ï¼Œåœ¨AOFé‡å†™é˜¶æ®µï¼ŒRediså°†ç°é˜¶æ®µçš„æ•°æ®çŠ¶æ€ä¿å­˜ä¸ºRDBçŠ¶æ€çš„äºŒè¿›åˆ¶æ•°æ®ï¼Œå¹¶å†™å…¥AOFæ–‡ä»¶ï¼Œç„¶åå†å°†AOFé‡å†™ç¼“å†²åŒºä¸­çš„æ—¥å¿—æ•°æ®å†™å…¥åˆ°AOFæ–‡ä»¶ï¼Œæœ€åæŠŠæ–°ç”Ÿæˆçš„AOFæ–‡ä»¶æ›¿æ¢æ‰æ—§çš„AOFæ–‡ä»¶ã€‚</p>\n<p>æ­¤æ—¶çš„AOFæ–‡ä»¶æ—¢åŒ…å«äºŒè¿›åˆ¶æ•°æ®ï¼ŒåˆåŒ…å«æ—¥å¿—æ•°æ®ï¼Œæ‰€ä»¥å«åšæ··åˆæŒä¹…åŒ–ã€‚</p>\n<p>AOFæ··åˆæŒä¹…åŒ–é€šè¿‡é™ä½AOFæ–‡ä»¶çš„å¯è¯»æ€§ï¼Œç”¨äºŒè¿›åˆ¶æ•°æ®è®°å½•æ•°æ®çŠ¶æ€ï¼Œå‡å°‘äº†AOFæ–‡ä»¶çš„ä½“ç§¯å¤§å°ã€‚</p>\n"},{"title":"Redisåœºæ™¯åº”ç”¨","publish":true,"description":"è®°å½•Redisåœºæ™¯åº”ç”¨çŸ¥è¯†ç‚¹","_content":"\n# Redisåœºæ™¯åº”ç”¨\n\n## ç¼“å­˜åŸºç¡€\n\n> Redisç”±äºæ€§èƒ½é«˜æ•ˆï¼Œé€šå¸¸å¯ä»¥åšæ•°æ®åº“å­˜å‚¨çš„ç¼“å­˜ï¼Œæ¯”å¦‚ç»™MySQLå½“ç¼“å­˜å°±æ˜¯å¸¸è§çš„ç”¨æ³•ã€‚å…·ä½“è€Œè¨€ï¼Œå°±æ˜¯å°†MySQLä¸­çš„çƒ­ç‚¹æ•°æ®å­˜å‚¨åœ¨Redisä¸­ï¼Œé€šå¸¸ä¸šåŠ¡éƒ½æ»¡è¶³äºŒå…«åŸåˆ™ï¼Œå³80%çš„æµé‡é›†ä¸­åœ¨20%çš„æ•°æ®ä¸Šï¼Œæ‰€ä»¥ç¼“å­˜æ˜¯å¯ä»¥æœ‰æ•ˆæé«˜ç³»ç»Ÿçš„ååé‡ã€‚\n\n### ç¼“å­˜çš„å››ç§æ¨¡å¼\n\nç¼“å­˜ä¸€èˆ¬æœ‰å››ç§æ¨¡å¼ï¼š\n\n- Cache-Aside Patternï¼šæ—è·¯ç¼“å­˜\n  - å¯èƒ½å‡ºç°æ•°æ®ä¸ä¸€è‡´é—®é¢˜\n- Read Through Patternï¼šè¯»ç©¿é€ç¼“å­˜\n  - å¯¹ä¸šåŠ¡é€æ˜ï¼Œä»£ç ç®€æ´\n  - ç¼“å­˜å‘½ä¸­æ—¶æ€§èƒ½è¾ƒä½ï¼Œå¤šä¸€æ¬¡æœåŠ¡é—´è°ƒç”¨è¿‡ç¨‹\n- Write Through Patternï¼šå†™ç©¿é€ç¼“å­˜\n- Write Behind Patternï¼šå¼‚æ­¥ç¼“å­˜å†™å…¥æ¨¡å¼\n  - æ•°æ®ä¸å®‰å…¨ï¼Œæœ‰ä¸¢å¤±é£é™©\n\n#### Cache-Aside Pattern\n\næ—è·¯ç¼“å­˜å°±æ˜¯æŒ‡ä¸šåŠ¡æ–¹å°†ç¼“å­˜å½“åšæ˜¯æ•°æ®åº“çš„æ—è·¯ï¼Œä¸šåŠ¡ç›´æ¥å’Œç¼“å­˜æ‰“äº¤é“ã€‚\n\næ—è·¯ç¼“å­˜**è¯»æµç¨‹**ï¼šä¸šåŠ¡æ–¹å…ˆæŸ¥çœ‹ç¼“å­˜ä¸­æ˜¯å¦æœ‰ç›®æ ‡æ•°æ®ï¼Œå¦‚æœæ²¡æœ‰ï¼Œåˆ™å»æ•°æ®åº“ä¸­æŸ¥æ‰¾æŒ‡å®šæ•°æ®ã€‚ä¸šåŠ¡æ–¹åœ¨è·å–åˆ°æ•°æ®çš„åŒæ—¶ï¼Œå°†æ•°æ®ä¿å­˜åœ¨ç¼“å­˜ä¸­ï¼Œä»¥å¤‡åç»­çš„æŸ¥è¯¢ã€‚\n\n<img src=\"https://raw.githubusercontent.com/lyydsheep/pic/main/202410301900893.png\" alt=\"image-20241030190038771\" style=\"zoom:80%;\" />\n\næ—è·¯ç¼“å­˜**å†™æµç¨‹**ï¼šä¸šåŠ¡æ–¹é¦–å…ˆå‘æ•°æ®åº“å†™å…¥æ•°æ®ï¼Œåœ¨**å†™å…¥æˆåŠŸä¹‹åå°†ç¼“å­˜ä¸­å¯¹äºçš„æ•°æ®åˆ é™¤**ã€‚è¿™æ˜¯ä¸ºäº†é¿å…ç”±äºæ›´æ–°ç¼“å­˜çš„æ—¶åºå·®å¼‚å¯¼è‡´çš„**æ•°æ®ä¸ä¸€è‡´é—®é¢˜**ã€‚\n\n<img src=\"https://raw.githubusercontent.com/lyydsheep/pic/main/202410301903846.png\" alt=\"image-20241030190309815\" style=\"zoom:80%;\" />\n\n#### Read Through\n\nè¯»ç©¿é€ç¼“å­˜æ¨¡å¼æä¾›ä¸€ä¸ªæ•°æ®æœåŠ¡ï¼Œä¸šåŠ¡æ–¹ä¸å†ç›´æ¥å’Œç¼“å­˜æ‰“äº¤é“ï¼Œè€Œæ˜¯å°†æŸ¥è¯¢è¯·æ±‚å‘é€ç»™æ•°æ®æœåŠ¡ï¼Œè®©æ•°æ®æœåŠ¡æ‰§è¡ŒæŸ¥è¯¢ç¼“å­˜ã€æ•°æ®åº“çš„æ“ä½œã€‚ä¸€å›¾è”½ä¹‹ï¼š\n\n<img src=\"https://raw.githubusercontent.com/lyydsheep/pic/main/202410301911313.png\" alt=\"image-20241030191116236\" style=\"zoom:80%;\" />\n\n#### Write Through\n\nå†™ç©¿é€ç¼“å­˜æ¨¡å¼é€šå¸¸å’Œè¯»ç©¿é€æ¨¡å¼ä¸€åŒä½¿ç”¨ã€‚å†™ç©¿é€æ¨¡å¼è¦æ±‚æ•°æ®æœåŠ¡åœ¨æ¥å—åˆ°ä¸šåŠ¡æ–¹çš„å†™è¯·æ±‚æ—¶ï¼Œ**å…ˆå°†æ•°æ®å†™å…¥æ•°æ®åº“ï¼Œæ¥ç€å†™å…¥ç¼“å­˜**ã€‚\n\n![image-20241030191922522](https://raw.githubusercontent.com/lyydsheep/pic/main/202410301919593.png)\n\nç”±äºå†™ç©¿é€æ¨¡å¼è¦æ±‚å†™å®Œæ•°æ®åº“åé©¬ä¸Šå†™ç¼“å­˜ï¼Œå¯¹ç¼“å­˜çš„åŠæ—¶æ€§è¦æ±‚é«˜ï¼Œåœ¨é«˜å¹¶å‘çš„ç¯å¢ƒä¸‹å°±å¯èƒ½ä¼šå‡ºç°æ•°æ®ä¸ä¸€è‡´é—®é¢˜ã€‚å¦ä¸€æ–¹é¢ï¼Œè¿˜éœ€è¦åˆç†è®¾ç½®ç¼“å­˜ä¸­æ•°æ®çš„è¿‡æœŸæ—¶é—´ï¼Œå› ä¸ºæ¯ä¸€æ¬¡å†™å…¥æ“ä½œéƒ½ä¼šå¢åŠ ç¼“å­˜ä¸­çš„æ•°æ®ï¼Œä¸åˆç†çš„æ•°æ®è¿‡æœŸæ—¶é—´å¯èƒ½ä¼šå¯¼è‡´ç¼“å­˜ä¸­çš„æ•°æ®æ€¥å‰§è†¨èƒ€ï¼Œå ç”¨å¤§é‡å†…å­˜èµ„æºã€‚\n\n#### Write Behind\n\nWrite Behindå’ŒWrite Throughåœ¨æ‰§è¡Œå†™æ“ä½œæ—¶éƒ½ä¼šå¯¹æ•°æ®åº“å’Œç¼“å­˜æ“ä½œã€‚åŒºåˆ«åœ¨äºï¼Œ**Write Behindå…ˆå†™ç¼“å­˜ï¼Œå†å¼‚æ­¥å°†æ•°æ®å†™å…¥æ•°æ®åº“**ã€‚\n\nWrite Behindç¼“å­˜ç­–ç•¥é‡‡ç”¨å¼‚æ­¥å†™æ•°æ®çš„æ–¹å¼ï¼Œå¯ä»¥**é€‰æ‹©åœ¨æŸä¸ªç‰¹å®šçš„æ—¶é—´ç‚¹**ï¼Œä¾‹å¦‚æ•°æ®åº“è´Ÿè½½è¾ƒä½æ—¶ï¼Œè¿›è¡Œå†™å…¥æ“ä½œï¼Œä¹Ÿå¯ä»¥**é€‰æ‹©ç§¯ç´¯ä¸€å®šé‡çš„å†™å‘½ä»¤**åä¸€æ¬¡æ€§å°†æ•°æ®å†™å…¥æ•°æ®åº“ä¸­ã€‚\n\n![image-20241030192626673](https://raw.githubusercontent.com/lyydsheep/pic/main/202410301926736.png)\n\nå¼‚æ­¥å†™å…¥æ“ä½œæå¤§é™ä½äº†å†™è¯·æ±‚çš„å»¶è¿Ÿä»¥åŠæ•°æ®åº“çš„è´Ÿè½½ï¼Œä½†ä»£ä»·æ˜¯æ•°æ®å®‰å…¨æ€§ä¸å¤Ÿé«˜ã€‚å€˜è‹¥å½“éƒ¨åˆ†å­˜å‚¨åœ¨å†…å­˜ä¸­çš„æ•°æ®æœªå†™å…¥æ•°æ®åº“æ—¶ï¼Œå­˜å‚¨æœåŠ¡å‘ç”Ÿäº†å´©æºƒï¼Œé‚£ä¹ˆæ•°æ®å°±ä¸¢å¤±äº†ã€‚\n\n## åˆ†å¸ƒå¼é”\n\nåˆ†å¸ƒå¼é”å°±æ˜¯åº”ç”¨åœ¨åˆ†å¸ƒå¼åœºæ™¯ä¸‹çš„é”ï¼Œä¿è¯å„å°æœºå™¨ä¸Šçš„å„ä¸ªè¿›ç¨‹å¹¶å‘å®‰å…¨çš„æ“ä½œæŸä¸€èµ„æºã€‚ä¸€ä¸ªåˆç†çš„åˆ†å¸ƒå¼é”åº”å…·å¤‡å¦‚ä¸‹ç‰¹ç‚¹ï¼š\n\n- **äº’æ–¥æ€§**ï¼šé’ˆå¯¹æŸä¸€èµ„æºï¼ŒåŒä¸€æ—¶åˆ»åªèƒ½æœ‰ä¸€ä¸ªç«äº‰è€…æŒæœ‰é”ï¼Œå…¶ä»–ç«äº‰è€…åˆ™é˜»å¡\n- **æŠ—æ­»é”æ€§ï¼ˆæ´»æ€§ï¼‰**ï¼šå½“ä¸€ä¸ªç«äº‰è€…æŒæœ‰é”çš„æœŸé—´ï¼Œå³ä½¿å‘ç”Ÿäº†å¼‚å¸¸å¯¼è‡´ç¨‹åºé€€å‡ºï¼Œæ— æ³•æ­£å¸¸é‡Šæ”¾é”ï¼Œä¹Ÿèƒ½æœ‰å…œåº•ç­–ç•¥å°†é”é‡Šæ”¾ï¼Œé¿å…å‘ç”Ÿæ­»é”\n- **å¯¹ç§°æ€§**ï¼šå¯¹åŒä¸€èµ„æºä¸Šé”å’Œè§£é”å¿…é¡»æ˜¯åŒä¸€ä¸ªç«äº‰è€…\n- **å¯é æ€§**ï¼šå…·å¤‡ä¸€å®šçš„å®¹ç¾èƒ½åŠ›\n\n### å®ç°\n\nä»åˆ†å¸ƒå¼é”çš„ç‰¹ç‚¹å¯ä»¥æ¨æµ‹å‡ºï¼Œä½¿ç”¨Rediså®ç°åˆ†å¸ƒå¼é”å¤§è‡´æµç¨‹åº”è¯¥æ˜¯ï¼š\n\n1. å¯¹æŸä¸€ä¸ªèµ„æºå°è¯•åŠ é”\n2. åŠ é”å¹¶ä¸”æ ‡è®°`owner`\n3. å¤„ç†ä¸šåŠ¡\n4. æ£€æŸ¥é”çš„`owner`\n5. åˆ é™¤é”\n\n> ä¸ºä»€ä¹ˆè¦æ ‡è®°`owner`ï¼Ÿ\n\nå¦‚æœä¸æ ‡è®°é”çš„`owner`ï¼Œå¯èƒ½ä¼šå‡ºç°ç«äº‰è€…Aå°†ç«äº‰è€…Bçš„é”é‡Šæ”¾ï¼ŒğŸŒ°ï¼šå‡è®¾Aç‡å…ˆæ‹¿åˆ°åˆ†å¸ƒå¼é”ï¼Œæ¥ç€è¿›è¡Œä¸šåŠ¡æµç¨‹ã€‚å€˜è‹¥æ­¤æ—¶Aç”±äºç½‘ç»œå»¶è¿Ÿæˆ–CPUå ç”¨ç‡é«˜ç­‰å› ç´ å¯¼è‡´åœ¨**åˆ†å¸ƒå¼é”çš„è¿‡æœŸæ—¶ï¼Œä¸šåŠ¡ä»æ²¡æœ‰å®Œæˆ**ã€‚é‚£ä¹ˆBä»¥ä¸ºåˆ†å¸ƒå¼é”æ²¡æœ‰è¢«å…¶ä»–ç«äº‰è€…å ç”¨ï¼Œé¡ºç†æˆç« åœ°æ‹¿åˆ°äº†åˆ†å¸ƒå¼é”ï¼Œæ‰§è¡Œä¸šåŠ¡é€»è¾‘ã€‚ä¸å¹¸çš„æ˜¯ï¼Œåœ¨Bæ‰§è¡Œä¸šåŠ¡è¿‡ç¨‹ä¸­ï¼ŒAç»ˆäºå®Œæˆäº†ä¸šåŠ¡ï¼Œç„¶åæ‰§è¡Œ`delete`åˆ é™¤åˆ†å¸ƒå¼é”çš„åŠ¨ä½œã€‚ä½†æ­¤æ—¶Aåˆ é™¤çš„å¹¶éæ˜¯è‡ªå·±ï¼Œè€Œæ˜¯Bçš„åˆ†å¸ƒå¼é”ã€‚é‚£ä¹ˆè¯¥åˆ†å¸ƒå¼é”å°±å¤±å»äº†ä¿è¯èµ„æºå¹¶å‘å®‰å…¨çš„æ„ä¹‰ã€‚\n\n> å¦‚ä½•ä¿è¯æ£€æŸ¥-åˆ é™¤çš„åŸå­æ€§ï¼Ÿ\n\n4ã€5æ­¥éª¤æ˜¯å…¸å‹çš„**check-do something**åœºæ™¯ï¼Œéœ€è¦ä¿è¯åŸå­æ€§ï¼Œå¦åˆ™ä¼šå‡ºç°å¹¶å‘é—®é¢˜ã€‚\n\nè¦æƒ³å®ç°RedisæŸäº›æ“ä½œç»„åˆçš„åŸå­æ€§ï¼Œ**Luaè„šæœ¬**æ˜¯ä¸äºŒæ³•é—¨ã€‚Redis+Luaï¼Œå¯ä»¥è¯´æ˜¯ä¸“é—¨ä¸ºè§£å†³åŸå­é—®é¢˜è€Œç”Ÿçš„ã€‚æœ‰äº†Luaçš„ç‰¹æ€§ï¼ŒRedisæ‰çœŸæ­£åœ¨åˆ†å¸ƒå¼é”ã€ç§’æ€ç­‰åœºæ™¯æœ‰äº†ç”¨æ­¦ä¹‹åœ°ï¼Œæœ€ç»ˆRediså®ç°åˆ†å¸ƒå¼é”çš„æµç¨‹å¦‚ä¸‹ï¼š\n\n![image-20241027095707243](https://raw.githubusercontent.com/lyydsheep/pic/main/202410270957284.png)\n\n","source":"_posts/Redis/Redisåœºæ™¯åº”ç”¨.md","raw":"---\ntitle: Redisåœºæ™¯åº”ç”¨\npublish: true\ndescription: è®°å½•Redisåœºæ™¯åº”ç”¨çŸ¥è¯†ç‚¹\n---\n\n# Redisåœºæ™¯åº”ç”¨\n\n## ç¼“å­˜åŸºç¡€\n\n> Redisç”±äºæ€§èƒ½é«˜æ•ˆï¼Œé€šå¸¸å¯ä»¥åšæ•°æ®åº“å­˜å‚¨çš„ç¼“å­˜ï¼Œæ¯”å¦‚ç»™MySQLå½“ç¼“å­˜å°±æ˜¯å¸¸è§çš„ç”¨æ³•ã€‚å…·ä½“è€Œè¨€ï¼Œå°±æ˜¯å°†MySQLä¸­çš„çƒ­ç‚¹æ•°æ®å­˜å‚¨åœ¨Redisä¸­ï¼Œé€šå¸¸ä¸šåŠ¡éƒ½æ»¡è¶³äºŒå…«åŸåˆ™ï¼Œå³80%çš„æµé‡é›†ä¸­åœ¨20%çš„æ•°æ®ä¸Šï¼Œæ‰€ä»¥ç¼“å­˜æ˜¯å¯ä»¥æœ‰æ•ˆæé«˜ç³»ç»Ÿçš„ååé‡ã€‚\n\n### ç¼“å­˜çš„å››ç§æ¨¡å¼\n\nç¼“å­˜ä¸€èˆ¬æœ‰å››ç§æ¨¡å¼ï¼š\n\n- Cache-Aside Patternï¼šæ—è·¯ç¼“å­˜\n  - å¯èƒ½å‡ºç°æ•°æ®ä¸ä¸€è‡´é—®é¢˜\n- Read Through Patternï¼šè¯»ç©¿é€ç¼“å­˜\n  - å¯¹ä¸šåŠ¡é€æ˜ï¼Œä»£ç ç®€æ´\n  - ç¼“å­˜å‘½ä¸­æ—¶æ€§èƒ½è¾ƒä½ï¼Œå¤šä¸€æ¬¡æœåŠ¡é—´è°ƒç”¨è¿‡ç¨‹\n- Write Through Patternï¼šå†™ç©¿é€ç¼“å­˜\n- Write Behind Patternï¼šå¼‚æ­¥ç¼“å­˜å†™å…¥æ¨¡å¼\n  - æ•°æ®ä¸å®‰å…¨ï¼Œæœ‰ä¸¢å¤±é£é™©\n\n#### Cache-Aside Pattern\n\næ—è·¯ç¼“å­˜å°±æ˜¯æŒ‡ä¸šåŠ¡æ–¹å°†ç¼“å­˜å½“åšæ˜¯æ•°æ®åº“çš„æ—è·¯ï¼Œä¸šåŠ¡ç›´æ¥å’Œç¼“å­˜æ‰“äº¤é“ã€‚\n\næ—è·¯ç¼“å­˜**è¯»æµç¨‹**ï¼šä¸šåŠ¡æ–¹å…ˆæŸ¥çœ‹ç¼“å­˜ä¸­æ˜¯å¦æœ‰ç›®æ ‡æ•°æ®ï¼Œå¦‚æœæ²¡æœ‰ï¼Œåˆ™å»æ•°æ®åº“ä¸­æŸ¥æ‰¾æŒ‡å®šæ•°æ®ã€‚ä¸šåŠ¡æ–¹åœ¨è·å–åˆ°æ•°æ®çš„åŒæ—¶ï¼Œå°†æ•°æ®ä¿å­˜åœ¨ç¼“å­˜ä¸­ï¼Œä»¥å¤‡åç»­çš„æŸ¥è¯¢ã€‚\n\n<img src=\"https://raw.githubusercontent.com/lyydsheep/pic/main/202410301900893.png\" alt=\"image-20241030190038771\" style=\"zoom:80%;\" />\n\næ—è·¯ç¼“å­˜**å†™æµç¨‹**ï¼šä¸šåŠ¡æ–¹é¦–å…ˆå‘æ•°æ®åº“å†™å…¥æ•°æ®ï¼Œåœ¨**å†™å…¥æˆåŠŸä¹‹åå°†ç¼“å­˜ä¸­å¯¹äºçš„æ•°æ®åˆ é™¤**ã€‚è¿™æ˜¯ä¸ºäº†é¿å…ç”±äºæ›´æ–°ç¼“å­˜çš„æ—¶åºå·®å¼‚å¯¼è‡´çš„**æ•°æ®ä¸ä¸€è‡´é—®é¢˜**ã€‚\n\n<img src=\"https://raw.githubusercontent.com/lyydsheep/pic/main/202410301903846.png\" alt=\"image-20241030190309815\" style=\"zoom:80%;\" />\n\n#### Read Through\n\nè¯»ç©¿é€ç¼“å­˜æ¨¡å¼æä¾›ä¸€ä¸ªæ•°æ®æœåŠ¡ï¼Œä¸šåŠ¡æ–¹ä¸å†ç›´æ¥å’Œç¼“å­˜æ‰“äº¤é“ï¼Œè€Œæ˜¯å°†æŸ¥è¯¢è¯·æ±‚å‘é€ç»™æ•°æ®æœåŠ¡ï¼Œè®©æ•°æ®æœåŠ¡æ‰§è¡ŒæŸ¥è¯¢ç¼“å­˜ã€æ•°æ®åº“çš„æ“ä½œã€‚ä¸€å›¾è”½ä¹‹ï¼š\n\n<img src=\"https://raw.githubusercontent.com/lyydsheep/pic/main/202410301911313.png\" alt=\"image-20241030191116236\" style=\"zoom:80%;\" />\n\n#### Write Through\n\nå†™ç©¿é€ç¼“å­˜æ¨¡å¼é€šå¸¸å’Œè¯»ç©¿é€æ¨¡å¼ä¸€åŒä½¿ç”¨ã€‚å†™ç©¿é€æ¨¡å¼è¦æ±‚æ•°æ®æœåŠ¡åœ¨æ¥å—åˆ°ä¸šåŠ¡æ–¹çš„å†™è¯·æ±‚æ—¶ï¼Œ**å…ˆå°†æ•°æ®å†™å…¥æ•°æ®åº“ï¼Œæ¥ç€å†™å…¥ç¼“å­˜**ã€‚\n\n![image-20241030191922522](https://raw.githubusercontent.com/lyydsheep/pic/main/202410301919593.png)\n\nç”±äºå†™ç©¿é€æ¨¡å¼è¦æ±‚å†™å®Œæ•°æ®åº“åé©¬ä¸Šå†™ç¼“å­˜ï¼Œå¯¹ç¼“å­˜çš„åŠæ—¶æ€§è¦æ±‚é«˜ï¼Œåœ¨é«˜å¹¶å‘çš„ç¯å¢ƒä¸‹å°±å¯èƒ½ä¼šå‡ºç°æ•°æ®ä¸ä¸€è‡´é—®é¢˜ã€‚å¦ä¸€æ–¹é¢ï¼Œè¿˜éœ€è¦åˆç†è®¾ç½®ç¼“å­˜ä¸­æ•°æ®çš„è¿‡æœŸæ—¶é—´ï¼Œå› ä¸ºæ¯ä¸€æ¬¡å†™å…¥æ“ä½œéƒ½ä¼šå¢åŠ ç¼“å­˜ä¸­çš„æ•°æ®ï¼Œä¸åˆç†çš„æ•°æ®è¿‡æœŸæ—¶é—´å¯èƒ½ä¼šå¯¼è‡´ç¼“å­˜ä¸­çš„æ•°æ®æ€¥å‰§è†¨èƒ€ï¼Œå ç”¨å¤§é‡å†…å­˜èµ„æºã€‚\n\n#### Write Behind\n\nWrite Behindå’ŒWrite Throughåœ¨æ‰§è¡Œå†™æ“ä½œæ—¶éƒ½ä¼šå¯¹æ•°æ®åº“å’Œç¼“å­˜æ“ä½œã€‚åŒºåˆ«åœ¨äºï¼Œ**Write Behindå…ˆå†™ç¼“å­˜ï¼Œå†å¼‚æ­¥å°†æ•°æ®å†™å…¥æ•°æ®åº“**ã€‚\n\nWrite Behindç¼“å­˜ç­–ç•¥é‡‡ç”¨å¼‚æ­¥å†™æ•°æ®çš„æ–¹å¼ï¼Œå¯ä»¥**é€‰æ‹©åœ¨æŸä¸ªç‰¹å®šçš„æ—¶é—´ç‚¹**ï¼Œä¾‹å¦‚æ•°æ®åº“è´Ÿè½½è¾ƒä½æ—¶ï¼Œè¿›è¡Œå†™å…¥æ“ä½œï¼Œä¹Ÿå¯ä»¥**é€‰æ‹©ç§¯ç´¯ä¸€å®šé‡çš„å†™å‘½ä»¤**åä¸€æ¬¡æ€§å°†æ•°æ®å†™å…¥æ•°æ®åº“ä¸­ã€‚\n\n![image-20241030192626673](https://raw.githubusercontent.com/lyydsheep/pic/main/202410301926736.png)\n\nå¼‚æ­¥å†™å…¥æ“ä½œæå¤§é™ä½äº†å†™è¯·æ±‚çš„å»¶è¿Ÿä»¥åŠæ•°æ®åº“çš„è´Ÿè½½ï¼Œä½†ä»£ä»·æ˜¯æ•°æ®å®‰å…¨æ€§ä¸å¤Ÿé«˜ã€‚å€˜è‹¥å½“éƒ¨åˆ†å­˜å‚¨åœ¨å†…å­˜ä¸­çš„æ•°æ®æœªå†™å…¥æ•°æ®åº“æ—¶ï¼Œå­˜å‚¨æœåŠ¡å‘ç”Ÿäº†å´©æºƒï¼Œé‚£ä¹ˆæ•°æ®å°±ä¸¢å¤±äº†ã€‚\n\n## åˆ†å¸ƒå¼é”\n\nåˆ†å¸ƒå¼é”å°±æ˜¯åº”ç”¨åœ¨åˆ†å¸ƒå¼åœºæ™¯ä¸‹çš„é”ï¼Œä¿è¯å„å°æœºå™¨ä¸Šçš„å„ä¸ªè¿›ç¨‹å¹¶å‘å®‰å…¨çš„æ“ä½œæŸä¸€èµ„æºã€‚ä¸€ä¸ªåˆç†çš„åˆ†å¸ƒå¼é”åº”å…·å¤‡å¦‚ä¸‹ç‰¹ç‚¹ï¼š\n\n- **äº’æ–¥æ€§**ï¼šé’ˆå¯¹æŸä¸€èµ„æºï¼ŒåŒä¸€æ—¶åˆ»åªèƒ½æœ‰ä¸€ä¸ªç«äº‰è€…æŒæœ‰é”ï¼Œå…¶ä»–ç«äº‰è€…åˆ™é˜»å¡\n- **æŠ—æ­»é”æ€§ï¼ˆæ´»æ€§ï¼‰**ï¼šå½“ä¸€ä¸ªç«äº‰è€…æŒæœ‰é”çš„æœŸé—´ï¼Œå³ä½¿å‘ç”Ÿäº†å¼‚å¸¸å¯¼è‡´ç¨‹åºé€€å‡ºï¼Œæ— æ³•æ­£å¸¸é‡Šæ”¾é”ï¼Œä¹Ÿèƒ½æœ‰å…œåº•ç­–ç•¥å°†é”é‡Šæ”¾ï¼Œé¿å…å‘ç”Ÿæ­»é”\n- **å¯¹ç§°æ€§**ï¼šå¯¹åŒä¸€èµ„æºä¸Šé”å’Œè§£é”å¿…é¡»æ˜¯åŒä¸€ä¸ªç«äº‰è€…\n- **å¯é æ€§**ï¼šå…·å¤‡ä¸€å®šçš„å®¹ç¾èƒ½åŠ›\n\n### å®ç°\n\nä»åˆ†å¸ƒå¼é”çš„ç‰¹ç‚¹å¯ä»¥æ¨æµ‹å‡ºï¼Œä½¿ç”¨Rediså®ç°åˆ†å¸ƒå¼é”å¤§è‡´æµç¨‹åº”è¯¥æ˜¯ï¼š\n\n1. å¯¹æŸä¸€ä¸ªèµ„æºå°è¯•åŠ é”\n2. åŠ é”å¹¶ä¸”æ ‡è®°`owner`\n3. å¤„ç†ä¸šåŠ¡\n4. æ£€æŸ¥é”çš„`owner`\n5. åˆ é™¤é”\n\n> ä¸ºä»€ä¹ˆè¦æ ‡è®°`owner`ï¼Ÿ\n\nå¦‚æœä¸æ ‡è®°é”çš„`owner`ï¼Œå¯èƒ½ä¼šå‡ºç°ç«äº‰è€…Aå°†ç«äº‰è€…Bçš„é”é‡Šæ”¾ï¼ŒğŸŒ°ï¼šå‡è®¾Aç‡å…ˆæ‹¿åˆ°åˆ†å¸ƒå¼é”ï¼Œæ¥ç€è¿›è¡Œä¸šåŠ¡æµç¨‹ã€‚å€˜è‹¥æ­¤æ—¶Aç”±äºç½‘ç»œå»¶è¿Ÿæˆ–CPUå ç”¨ç‡é«˜ç­‰å› ç´ å¯¼è‡´åœ¨**åˆ†å¸ƒå¼é”çš„è¿‡æœŸæ—¶ï¼Œä¸šåŠ¡ä»æ²¡æœ‰å®Œæˆ**ã€‚é‚£ä¹ˆBä»¥ä¸ºåˆ†å¸ƒå¼é”æ²¡æœ‰è¢«å…¶ä»–ç«äº‰è€…å ç”¨ï¼Œé¡ºç†æˆç« åœ°æ‹¿åˆ°äº†åˆ†å¸ƒå¼é”ï¼Œæ‰§è¡Œä¸šåŠ¡é€»è¾‘ã€‚ä¸å¹¸çš„æ˜¯ï¼Œåœ¨Bæ‰§è¡Œä¸šåŠ¡è¿‡ç¨‹ä¸­ï¼ŒAç»ˆäºå®Œæˆäº†ä¸šåŠ¡ï¼Œç„¶åæ‰§è¡Œ`delete`åˆ é™¤åˆ†å¸ƒå¼é”çš„åŠ¨ä½œã€‚ä½†æ­¤æ—¶Aåˆ é™¤çš„å¹¶éæ˜¯è‡ªå·±ï¼Œè€Œæ˜¯Bçš„åˆ†å¸ƒå¼é”ã€‚é‚£ä¹ˆè¯¥åˆ†å¸ƒå¼é”å°±å¤±å»äº†ä¿è¯èµ„æºå¹¶å‘å®‰å…¨çš„æ„ä¹‰ã€‚\n\n> å¦‚ä½•ä¿è¯æ£€æŸ¥-åˆ é™¤çš„åŸå­æ€§ï¼Ÿ\n\n4ã€5æ­¥éª¤æ˜¯å…¸å‹çš„**check-do something**åœºæ™¯ï¼Œéœ€è¦ä¿è¯åŸå­æ€§ï¼Œå¦åˆ™ä¼šå‡ºç°å¹¶å‘é—®é¢˜ã€‚\n\nè¦æƒ³å®ç°RedisæŸäº›æ“ä½œç»„åˆçš„åŸå­æ€§ï¼Œ**Luaè„šæœ¬**æ˜¯ä¸äºŒæ³•é—¨ã€‚Redis+Luaï¼Œå¯ä»¥è¯´æ˜¯ä¸“é—¨ä¸ºè§£å†³åŸå­é—®é¢˜è€Œç”Ÿçš„ã€‚æœ‰äº†Luaçš„ç‰¹æ€§ï¼ŒRedisæ‰çœŸæ­£åœ¨åˆ†å¸ƒå¼é”ã€ç§’æ€ç­‰åœºæ™¯æœ‰äº†ç”¨æ­¦ä¹‹åœ°ï¼Œæœ€ç»ˆRediså®ç°åˆ†å¸ƒå¼é”çš„æµç¨‹å¦‚ä¸‹ï¼š\n\n![image-20241027095707243](https://raw.githubusercontent.com/lyydsheep/pic/main/202410270957284.png)\n\n","slug":"Redis/Redisåœºæ™¯åº”ç”¨","published":1,"date":"2024-12-27T11:03:15.343Z","updated":"2024-12-27T11:03:15.343Z","comments":1,"layout":"post","photos":[],"_id":"cm6c7md6n002oa5t2a4wx4k2s","content":"<h1 id=\"Redisåœºæ™¯åº”ç”¨\"><a href=\"#Redisåœºæ™¯åº”ç”¨\" class=\"headerlink\" title=\"Redisåœºæ™¯åº”ç”¨\"></a>Redisåœºæ™¯åº”ç”¨</h1><h2 id=\"ç¼“å­˜åŸºç¡€\"><a href=\"#ç¼“å­˜åŸºç¡€\" class=\"headerlink\" title=\"ç¼“å­˜åŸºç¡€\"></a>ç¼“å­˜åŸºç¡€</h2><blockquote>\n<p>Redisç”±äºæ€§èƒ½é«˜æ•ˆï¼Œé€šå¸¸å¯ä»¥åšæ•°æ®åº“å­˜å‚¨çš„ç¼“å­˜ï¼Œæ¯”å¦‚ç»™MySQLå½“ç¼“å­˜å°±æ˜¯å¸¸è§çš„ç”¨æ³•ã€‚å…·ä½“è€Œè¨€ï¼Œå°±æ˜¯å°†MySQLä¸­çš„çƒ­ç‚¹æ•°æ®å­˜å‚¨åœ¨Redisä¸­ï¼Œé€šå¸¸ä¸šåŠ¡éƒ½æ»¡è¶³äºŒå…«åŸåˆ™ï¼Œå³80%çš„æµé‡é›†ä¸­åœ¨20%çš„æ•°æ®ä¸Šï¼Œæ‰€ä»¥ç¼“å­˜æ˜¯å¯ä»¥æœ‰æ•ˆæé«˜ç³»ç»Ÿçš„ååé‡ã€‚</p>\n</blockquote>\n<h3 id=\"ç¼“å­˜çš„å››ç§æ¨¡å¼\"><a href=\"#ç¼“å­˜çš„å››ç§æ¨¡å¼\" class=\"headerlink\" title=\"ç¼“å­˜çš„å››ç§æ¨¡å¼\"></a>ç¼“å­˜çš„å››ç§æ¨¡å¼</h3><p>ç¼“å­˜ä¸€èˆ¬æœ‰å››ç§æ¨¡å¼ï¼š</p>\n<ul>\n<li>Cache-Aside Patternï¼šæ—è·¯ç¼“å­˜<ul>\n<li>å¯èƒ½å‡ºç°æ•°æ®ä¸ä¸€è‡´é—®é¢˜</li>\n</ul>\n</li>\n<li>Read Through Patternï¼šè¯»ç©¿é€ç¼“å­˜<ul>\n<li>å¯¹ä¸šåŠ¡é€æ˜ï¼Œä»£ç ç®€æ´</li>\n<li>ç¼“å­˜å‘½ä¸­æ—¶æ€§èƒ½è¾ƒä½ï¼Œå¤šä¸€æ¬¡æœåŠ¡é—´è°ƒç”¨è¿‡ç¨‹</li>\n</ul>\n</li>\n<li>Write Through Patternï¼šå†™ç©¿é€ç¼“å­˜</li>\n<li>Write Behind Patternï¼šå¼‚æ­¥ç¼“å­˜å†™å…¥æ¨¡å¼<ul>\n<li>æ•°æ®ä¸å®‰å…¨ï¼Œæœ‰ä¸¢å¤±é£é™©</li>\n</ul>\n</li>\n</ul>\n<h4 id=\"Cache-Aside-Pattern\"><a href=\"#Cache-Aside-Pattern\" class=\"headerlink\" title=\"Cache-Aside Pattern\"></a>Cache-Aside Pattern</h4><p>æ—è·¯ç¼“å­˜å°±æ˜¯æŒ‡ä¸šåŠ¡æ–¹å°†ç¼“å­˜å½“åšæ˜¯æ•°æ®åº“çš„æ—è·¯ï¼Œä¸šåŠ¡ç›´æ¥å’Œç¼“å­˜æ‰“äº¤é“ã€‚</p>\n<p>æ—è·¯ç¼“å­˜<strong>è¯»æµç¨‹</strong>ï¼šä¸šåŠ¡æ–¹å…ˆæŸ¥çœ‹ç¼“å­˜ä¸­æ˜¯å¦æœ‰ç›®æ ‡æ•°æ®ï¼Œå¦‚æœæ²¡æœ‰ï¼Œåˆ™å»æ•°æ®åº“ä¸­æŸ¥æ‰¾æŒ‡å®šæ•°æ®ã€‚ä¸šåŠ¡æ–¹åœ¨è·å–åˆ°æ•°æ®çš„åŒæ—¶ï¼Œå°†æ•°æ®ä¿å­˜åœ¨ç¼“å­˜ä¸­ï¼Œä»¥å¤‡åç»­çš„æŸ¥è¯¢ã€‚</p>\n<img src=\"https://raw.githubusercontent.com/lyydsheep/pic/main/202410301900893.png\" alt=\"image-20241030190038771\" style=\"zoom:80%;\" />\n\n<p>æ—è·¯ç¼“å­˜<strong>å†™æµç¨‹</strong>ï¼šä¸šåŠ¡æ–¹é¦–å…ˆå‘æ•°æ®åº“å†™å…¥æ•°æ®ï¼Œåœ¨<strong>å†™å…¥æˆåŠŸä¹‹åå°†ç¼“å­˜ä¸­å¯¹äºçš„æ•°æ®åˆ é™¤</strong>ã€‚è¿™æ˜¯ä¸ºäº†é¿å…ç”±äºæ›´æ–°ç¼“å­˜çš„æ—¶åºå·®å¼‚å¯¼è‡´çš„<strong>æ•°æ®ä¸ä¸€è‡´é—®é¢˜</strong>ã€‚</p>\n<img src=\"https://raw.githubusercontent.com/lyydsheep/pic/main/202410301903846.png\" alt=\"image-20241030190309815\" style=\"zoom:80%;\" />\n\n<h4 id=\"Read-Through\"><a href=\"#Read-Through\" class=\"headerlink\" title=\"Read Through\"></a>Read Through</h4><p>è¯»ç©¿é€ç¼“å­˜æ¨¡å¼æä¾›ä¸€ä¸ªæ•°æ®æœåŠ¡ï¼Œä¸šåŠ¡æ–¹ä¸å†ç›´æ¥å’Œç¼“å­˜æ‰“äº¤é“ï¼Œè€Œæ˜¯å°†æŸ¥è¯¢è¯·æ±‚å‘é€ç»™æ•°æ®æœåŠ¡ï¼Œè®©æ•°æ®æœåŠ¡æ‰§è¡ŒæŸ¥è¯¢ç¼“å­˜ã€æ•°æ®åº“çš„æ“ä½œã€‚ä¸€å›¾è”½ä¹‹ï¼š</p>\n<img src=\"https://raw.githubusercontent.com/lyydsheep/pic/main/202410301911313.png\" alt=\"image-20241030191116236\" style=\"zoom:80%;\" />\n\n<h4 id=\"Write-Through\"><a href=\"#Write-Through\" class=\"headerlink\" title=\"Write Through\"></a>Write Through</h4><p>å†™ç©¿é€ç¼“å­˜æ¨¡å¼é€šå¸¸å’Œè¯»ç©¿é€æ¨¡å¼ä¸€åŒä½¿ç”¨ã€‚å†™ç©¿é€æ¨¡å¼è¦æ±‚æ•°æ®æœåŠ¡åœ¨æ¥å—åˆ°ä¸šåŠ¡æ–¹çš„å†™è¯·æ±‚æ—¶ï¼Œ<strong>å…ˆå°†æ•°æ®å†™å…¥æ•°æ®åº“ï¼Œæ¥ç€å†™å…¥ç¼“å­˜</strong>ã€‚</p>\n<p><img src=\"https://raw.githubusercontent.com/lyydsheep/pic/main/202410301919593.png\" alt=\"image-20241030191922522\"></p>\n<p>ç”±äºå†™ç©¿é€æ¨¡å¼è¦æ±‚å†™å®Œæ•°æ®åº“åé©¬ä¸Šå†™ç¼“å­˜ï¼Œå¯¹ç¼“å­˜çš„åŠæ—¶æ€§è¦æ±‚é«˜ï¼Œåœ¨é«˜å¹¶å‘çš„ç¯å¢ƒä¸‹å°±å¯èƒ½ä¼šå‡ºç°æ•°æ®ä¸ä¸€è‡´é—®é¢˜ã€‚å¦ä¸€æ–¹é¢ï¼Œè¿˜éœ€è¦åˆç†è®¾ç½®ç¼“å­˜ä¸­æ•°æ®çš„è¿‡æœŸæ—¶é—´ï¼Œå› ä¸ºæ¯ä¸€æ¬¡å†™å…¥æ“ä½œéƒ½ä¼šå¢åŠ ç¼“å­˜ä¸­çš„æ•°æ®ï¼Œä¸åˆç†çš„æ•°æ®è¿‡æœŸæ—¶é—´å¯èƒ½ä¼šå¯¼è‡´ç¼“å­˜ä¸­çš„æ•°æ®æ€¥å‰§è†¨èƒ€ï¼Œå ç”¨å¤§é‡å†…å­˜èµ„æºã€‚</p>\n<h4 id=\"Write-Behind\"><a href=\"#Write-Behind\" class=\"headerlink\" title=\"Write Behind\"></a>Write Behind</h4><p>Write Behindå’ŒWrite Throughåœ¨æ‰§è¡Œå†™æ“ä½œæ—¶éƒ½ä¼šå¯¹æ•°æ®åº“å’Œç¼“å­˜æ“ä½œã€‚åŒºåˆ«åœ¨äºï¼Œ<strong>Write Behindå…ˆå†™ç¼“å­˜ï¼Œå†å¼‚æ­¥å°†æ•°æ®å†™å…¥æ•°æ®åº“</strong>ã€‚</p>\n<p>Write Behindç¼“å­˜ç­–ç•¥é‡‡ç”¨å¼‚æ­¥å†™æ•°æ®çš„æ–¹å¼ï¼Œå¯ä»¥<strong>é€‰æ‹©åœ¨æŸä¸ªç‰¹å®šçš„æ—¶é—´ç‚¹</strong>ï¼Œä¾‹å¦‚æ•°æ®åº“è´Ÿè½½è¾ƒä½æ—¶ï¼Œè¿›è¡Œå†™å…¥æ“ä½œï¼Œä¹Ÿå¯ä»¥<strong>é€‰æ‹©ç§¯ç´¯ä¸€å®šé‡çš„å†™å‘½ä»¤</strong>åä¸€æ¬¡æ€§å°†æ•°æ®å†™å…¥æ•°æ®åº“ä¸­ã€‚</p>\n<p><img src=\"https://raw.githubusercontent.com/lyydsheep/pic/main/202410301926736.png\" alt=\"image-20241030192626673\"></p>\n<p>å¼‚æ­¥å†™å…¥æ“ä½œæå¤§é™ä½äº†å†™è¯·æ±‚çš„å»¶è¿Ÿä»¥åŠæ•°æ®åº“çš„è´Ÿè½½ï¼Œä½†ä»£ä»·æ˜¯æ•°æ®å®‰å…¨æ€§ä¸å¤Ÿé«˜ã€‚å€˜è‹¥å½“éƒ¨åˆ†å­˜å‚¨åœ¨å†…å­˜ä¸­çš„æ•°æ®æœªå†™å…¥æ•°æ®åº“æ—¶ï¼Œå­˜å‚¨æœåŠ¡å‘ç”Ÿäº†å´©æºƒï¼Œé‚£ä¹ˆæ•°æ®å°±ä¸¢å¤±äº†ã€‚</p>\n<h2 id=\"åˆ†å¸ƒå¼é”\"><a href=\"#åˆ†å¸ƒå¼é”\" class=\"headerlink\" title=\"åˆ†å¸ƒå¼é”\"></a>åˆ†å¸ƒå¼é”</h2><p>åˆ†å¸ƒå¼é”å°±æ˜¯åº”ç”¨åœ¨åˆ†å¸ƒå¼åœºæ™¯ä¸‹çš„é”ï¼Œä¿è¯å„å°æœºå™¨ä¸Šçš„å„ä¸ªè¿›ç¨‹å¹¶å‘å®‰å…¨çš„æ“ä½œæŸä¸€èµ„æºã€‚ä¸€ä¸ªåˆç†çš„åˆ†å¸ƒå¼é”åº”å…·å¤‡å¦‚ä¸‹ç‰¹ç‚¹ï¼š</p>\n<ul>\n<li><strong>äº’æ–¥æ€§</strong>ï¼šé’ˆå¯¹æŸä¸€èµ„æºï¼ŒåŒä¸€æ—¶åˆ»åªèƒ½æœ‰ä¸€ä¸ªç«äº‰è€…æŒæœ‰é”ï¼Œå…¶ä»–ç«äº‰è€…åˆ™é˜»å¡</li>\n<li><strong>æŠ—æ­»é”æ€§ï¼ˆæ´»æ€§ï¼‰</strong>ï¼šå½“ä¸€ä¸ªç«äº‰è€…æŒæœ‰é”çš„æœŸé—´ï¼Œå³ä½¿å‘ç”Ÿäº†å¼‚å¸¸å¯¼è‡´ç¨‹åºé€€å‡ºï¼Œæ— æ³•æ­£å¸¸é‡Šæ”¾é”ï¼Œä¹Ÿèƒ½æœ‰å…œåº•ç­–ç•¥å°†é”é‡Šæ”¾ï¼Œé¿å…å‘ç”Ÿæ­»é”</li>\n<li><strong>å¯¹ç§°æ€§</strong>ï¼šå¯¹åŒä¸€èµ„æºä¸Šé”å’Œè§£é”å¿…é¡»æ˜¯åŒä¸€ä¸ªç«äº‰è€…</li>\n<li><strong>å¯é æ€§</strong>ï¼šå…·å¤‡ä¸€å®šçš„å®¹ç¾èƒ½åŠ›</li>\n</ul>\n<h3 id=\"å®ç°\"><a href=\"#å®ç°\" class=\"headerlink\" title=\"å®ç°\"></a>å®ç°</h3><p>ä»åˆ†å¸ƒå¼é”çš„ç‰¹ç‚¹å¯ä»¥æ¨æµ‹å‡ºï¼Œä½¿ç”¨Rediså®ç°åˆ†å¸ƒå¼é”å¤§è‡´æµç¨‹åº”è¯¥æ˜¯ï¼š</p>\n<ol>\n<li>å¯¹æŸä¸€ä¸ªèµ„æºå°è¯•åŠ é”</li>\n<li>åŠ é”å¹¶ä¸”æ ‡è®°<code>owner</code></li>\n<li>å¤„ç†ä¸šåŠ¡</li>\n<li>æ£€æŸ¥é”çš„<code>owner</code></li>\n<li>åˆ é™¤é”</li>\n</ol>\n<blockquote>\n<p>ä¸ºä»€ä¹ˆè¦æ ‡è®°<code>owner</code>ï¼Ÿ</p>\n</blockquote>\n<p>å¦‚æœä¸æ ‡è®°é”çš„<code>owner</code>ï¼Œå¯èƒ½ä¼šå‡ºç°ç«äº‰è€…Aå°†ç«äº‰è€…Bçš„é”é‡Šæ”¾ï¼ŒğŸŒ°ï¼šå‡è®¾Aç‡å…ˆæ‹¿åˆ°åˆ†å¸ƒå¼é”ï¼Œæ¥ç€è¿›è¡Œä¸šåŠ¡æµç¨‹ã€‚å€˜è‹¥æ­¤æ—¶Aç”±äºç½‘ç»œå»¶è¿Ÿæˆ–CPUå ç”¨ç‡é«˜ç­‰å› ç´ å¯¼è‡´åœ¨<strong>åˆ†å¸ƒå¼é”çš„è¿‡æœŸæ—¶ï¼Œä¸šåŠ¡ä»æ²¡æœ‰å®Œæˆ</strong>ã€‚é‚£ä¹ˆBä»¥ä¸ºåˆ†å¸ƒå¼é”æ²¡æœ‰è¢«å…¶ä»–ç«äº‰è€…å ç”¨ï¼Œé¡ºç†æˆç« åœ°æ‹¿åˆ°äº†åˆ†å¸ƒå¼é”ï¼Œæ‰§è¡Œä¸šåŠ¡é€»è¾‘ã€‚ä¸å¹¸çš„æ˜¯ï¼Œåœ¨Bæ‰§è¡Œä¸šåŠ¡è¿‡ç¨‹ä¸­ï¼ŒAç»ˆäºå®Œæˆäº†ä¸šåŠ¡ï¼Œç„¶åæ‰§è¡Œ<code>delete</code>åˆ é™¤åˆ†å¸ƒå¼é”çš„åŠ¨ä½œã€‚ä½†æ­¤æ—¶Aåˆ é™¤çš„å¹¶éæ˜¯è‡ªå·±ï¼Œè€Œæ˜¯Bçš„åˆ†å¸ƒå¼é”ã€‚é‚£ä¹ˆè¯¥åˆ†å¸ƒå¼é”å°±å¤±å»äº†ä¿è¯èµ„æºå¹¶å‘å®‰å…¨çš„æ„ä¹‰ã€‚</p>\n<blockquote>\n<p>å¦‚ä½•ä¿è¯æ£€æŸ¥-åˆ é™¤çš„åŸå­æ€§ï¼Ÿ</p>\n</blockquote>\n<p>4ã€5æ­¥éª¤æ˜¯å…¸å‹çš„<strong>check-do something</strong>åœºæ™¯ï¼Œéœ€è¦ä¿è¯åŸå­æ€§ï¼Œå¦åˆ™ä¼šå‡ºç°å¹¶å‘é—®é¢˜ã€‚</p>\n<p>è¦æƒ³å®ç°RedisæŸäº›æ“ä½œç»„åˆçš„åŸå­æ€§ï¼Œ<strong>Luaè„šæœ¬</strong>æ˜¯ä¸äºŒæ³•é—¨ã€‚Redis+Luaï¼Œå¯ä»¥è¯´æ˜¯ä¸“é—¨ä¸ºè§£å†³åŸå­é—®é¢˜è€Œç”Ÿçš„ã€‚æœ‰äº†Luaçš„ç‰¹æ€§ï¼ŒRedisæ‰çœŸæ­£åœ¨åˆ†å¸ƒå¼é”ã€ç§’æ€ç­‰åœºæ™¯æœ‰äº†ç”¨æ­¦ä¹‹åœ°ï¼Œæœ€ç»ˆRediså®ç°åˆ†å¸ƒå¼é”çš„æµç¨‹å¦‚ä¸‹ï¼š</p>\n<p><img src=\"https://raw.githubusercontent.com/lyydsheep/pic/main/202410270957284.png\" alt=\"image-20241027095707243\"></p>\n","excerpt":"","more":"<h1 id=\"Redisåœºæ™¯åº”ç”¨\"><a href=\"#Redisåœºæ™¯åº”ç”¨\" class=\"headerlink\" title=\"Redisåœºæ™¯åº”ç”¨\"></a>Redisåœºæ™¯åº”ç”¨</h1><h2 id=\"ç¼“å­˜åŸºç¡€\"><a href=\"#ç¼“å­˜åŸºç¡€\" class=\"headerlink\" title=\"ç¼“å­˜åŸºç¡€\"></a>ç¼“å­˜åŸºç¡€</h2><blockquote>\n<p>Redisç”±äºæ€§èƒ½é«˜æ•ˆï¼Œé€šå¸¸å¯ä»¥åšæ•°æ®åº“å­˜å‚¨çš„ç¼“å­˜ï¼Œæ¯”å¦‚ç»™MySQLå½“ç¼“å­˜å°±æ˜¯å¸¸è§çš„ç”¨æ³•ã€‚å…·ä½“è€Œè¨€ï¼Œå°±æ˜¯å°†MySQLä¸­çš„çƒ­ç‚¹æ•°æ®å­˜å‚¨åœ¨Redisä¸­ï¼Œé€šå¸¸ä¸šåŠ¡éƒ½æ»¡è¶³äºŒå…«åŸåˆ™ï¼Œå³80%çš„æµé‡é›†ä¸­åœ¨20%çš„æ•°æ®ä¸Šï¼Œæ‰€ä»¥ç¼“å­˜æ˜¯å¯ä»¥æœ‰æ•ˆæé«˜ç³»ç»Ÿçš„ååé‡ã€‚</p>\n</blockquote>\n<h3 id=\"ç¼“å­˜çš„å››ç§æ¨¡å¼\"><a href=\"#ç¼“å­˜çš„å››ç§æ¨¡å¼\" class=\"headerlink\" title=\"ç¼“å­˜çš„å››ç§æ¨¡å¼\"></a>ç¼“å­˜çš„å››ç§æ¨¡å¼</h3><p>ç¼“å­˜ä¸€èˆ¬æœ‰å››ç§æ¨¡å¼ï¼š</p>\n<ul>\n<li>Cache-Aside Patternï¼šæ—è·¯ç¼“å­˜<ul>\n<li>å¯èƒ½å‡ºç°æ•°æ®ä¸ä¸€è‡´é—®é¢˜</li>\n</ul>\n</li>\n<li>Read Through Patternï¼šè¯»ç©¿é€ç¼“å­˜<ul>\n<li>å¯¹ä¸šåŠ¡é€æ˜ï¼Œä»£ç ç®€æ´</li>\n<li>ç¼“å­˜å‘½ä¸­æ—¶æ€§èƒ½è¾ƒä½ï¼Œå¤šä¸€æ¬¡æœåŠ¡é—´è°ƒç”¨è¿‡ç¨‹</li>\n</ul>\n</li>\n<li>Write Through Patternï¼šå†™ç©¿é€ç¼“å­˜</li>\n<li>Write Behind Patternï¼šå¼‚æ­¥ç¼“å­˜å†™å…¥æ¨¡å¼<ul>\n<li>æ•°æ®ä¸å®‰å…¨ï¼Œæœ‰ä¸¢å¤±é£é™©</li>\n</ul>\n</li>\n</ul>\n<h4 id=\"Cache-Aside-Pattern\"><a href=\"#Cache-Aside-Pattern\" class=\"headerlink\" title=\"Cache-Aside Pattern\"></a>Cache-Aside Pattern</h4><p>æ—è·¯ç¼“å­˜å°±æ˜¯æŒ‡ä¸šåŠ¡æ–¹å°†ç¼“å­˜å½“åšæ˜¯æ•°æ®åº“çš„æ—è·¯ï¼Œä¸šåŠ¡ç›´æ¥å’Œç¼“å­˜æ‰“äº¤é“ã€‚</p>\n<p>æ—è·¯ç¼“å­˜<strong>è¯»æµç¨‹</strong>ï¼šä¸šåŠ¡æ–¹å…ˆæŸ¥çœ‹ç¼“å­˜ä¸­æ˜¯å¦æœ‰ç›®æ ‡æ•°æ®ï¼Œå¦‚æœæ²¡æœ‰ï¼Œåˆ™å»æ•°æ®åº“ä¸­æŸ¥æ‰¾æŒ‡å®šæ•°æ®ã€‚ä¸šåŠ¡æ–¹åœ¨è·å–åˆ°æ•°æ®çš„åŒæ—¶ï¼Œå°†æ•°æ®ä¿å­˜åœ¨ç¼“å­˜ä¸­ï¼Œä»¥å¤‡åç»­çš„æŸ¥è¯¢ã€‚</p>\n<img src=\"https://raw.githubusercontent.com/lyydsheep/pic/main/202410301900893.png\" alt=\"image-20241030190038771\" style=\"zoom:80%;\" />\n\n<p>æ—è·¯ç¼“å­˜<strong>å†™æµç¨‹</strong>ï¼šä¸šåŠ¡æ–¹é¦–å…ˆå‘æ•°æ®åº“å†™å…¥æ•°æ®ï¼Œåœ¨<strong>å†™å…¥æˆåŠŸä¹‹åå°†ç¼“å­˜ä¸­å¯¹äºçš„æ•°æ®åˆ é™¤</strong>ã€‚è¿™æ˜¯ä¸ºäº†é¿å…ç”±äºæ›´æ–°ç¼“å­˜çš„æ—¶åºå·®å¼‚å¯¼è‡´çš„<strong>æ•°æ®ä¸ä¸€è‡´é—®é¢˜</strong>ã€‚</p>\n<img src=\"https://raw.githubusercontent.com/lyydsheep/pic/main/202410301903846.png\" alt=\"image-20241030190309815\" style=\"zoom:80%;\" />\n\n<h4 id=\"Read-Through\"><a href=\"#Read-Through\" class=\"headerlink\" title=\"Read Through\"></a>Read Through</h4><p>è¯»ç©¿é€ç¼“å­˜æ¨¡å¼æä¾›ä¸€ä¸ªæ•°æ®æœåŠ¡ï¼Œä¸šåŠ¡æ–¹ä¸å†ç›´æ¥å’Œç¼“å­˜æ‰“äº¤é“ï¼Œè€Œæ˜¯å°†æŸ¥è¯¢è¯·æ±‚å‘é€ç»™æ•°æ®æœåŠ¡ï¼Œè®©æ•°æ®æœåŠ¡æ‰§è¡ŒæŸ¥è¯¢ç¼“å­˜ã€æ•°æ®åº“çš„æ“ä½œã€‚ä¸€å›¾è”½ä¹‹ï¼š</p>\n<img src=\"https://raw.githubusercontent.com/lyydsheep/pic/main/202410301911313.png\" alt=\"image-20241030191116236\" style=\"zoom:80%;\" />\n\n<h4 id=\"Write-Through\"><a href=\"#Write-Through\" class=\"headerlink\" title=\"Write Through\"></a>Write Through</h4><p>å†™ç©¿é€ç¼“å­˜æ¨¡å¼é€šå¸¸å’Œè¯»ç©¿é€æ¨¡å¼ä¸€åŒä½¿ç”¨ã€‚å†™ç©¿é€æ¨¡å¼è¦æ±‚æ•°æ®æœåŠ¡åœ¨æ¥å—åˆ°ä¸šåŠ¡æ–¹çš„å†™è¯·æ±‚æ—¶ï¼Œ<strong>å…ˆå°†æ•°æ®å†™å…¥æ•°æ®åº“ï¼Œæ¥ç€å†™å…¥ç¼“å­˜</strong>ã€‚</p>\n<p><img src=\"https://raw.githubusercontent.com/lyydsheep/pic/main/202410301919593.png\" alt=\"image-20241030191922522\"></p>\n<p>ç”±äºå†™ç©¿é€æ¨¡å¼è¦æ±‚å†™å®Œæ•°æ®åº“åé©¬ä¸Šå†™ç¼“å­˜ï¼Œå¯¹ç¼“å­˜çš„åŠæ—¶æ€§è¦æ±‚é«˜ï¼Œåœ¨é«˜å¹¶å‘çš„ç¯å¢ƒä¸‹å°±å¯èƒ½ä¼šå‡ºç°æ•°æ®ä¸ä¸€è‡´é—®é¢˜ã€‚å¦ä¸€æ–¹é¢ï¼Œè¿˜éœ€è¦åˆç†è®¾ç½®ç¼“å­˜ä¸­æ•°æ®çš„è¿‡æœŸæ—¶é—´ï¼Œå› ä¸ºæ¯ä¸€æ¬¡å†™å…¥æ“ä½œéƒ½ä¼šå¢åŠ ç¼“å­˜ä¸­çš„æ•°æ®ï¼Œä¸åˆç†çš„æ•°æ®è¿‡æœŸæ—¶é—´å¯èƒ½ä¼šå¯¼è‡´ç¼“å­˜ä¸­çš„æ•°æ®æ€¥å‰§è†¨èƒ€ï¼Œå ç”¨å¤§é‡å†…å­˜èµ„æºã€‚</p>\n<h4 id=\"Write-Behind\"><a href=\"#Write-Behind\" class=\"headerlink\" title=\"Write Behind\"></a>Write Behind</h4><p>Write Behindå’ŒWrite Throughåœ¨æ‰§è¡Œå†™æ“ä½œæ—¶éƒ½ä¼šå¯¹æ•°æ®åº“å’Œç¼“å­˜æ“ä½œã€‚åŒºåˆ«åœ¨äºï¼Œ<strong>Write Behindå…ˆå†™ç¼“å­˜ï¼Œå†å¼‚æ­¥å°†æ•°æ®å†™å…¥æ•°æ®åº“</strong>ã€‚</p>\n<p>Write Behindç¼“å­˜ç­–ç•¥é‡‡ç”¨å¼‚æ­¥å†™æ•°æ®çš„æ–¹å¼ï¼Œå¯ä»¥<strong>é€‰æ‹©åœ¨æŸä¸ªç‰¹å®šçš„æ—¶é—´ç‚¹</strong>ï¼Œä¾‹å¦‚æ•°æ®åº“è´Ÿè½½è¾ƒä½æ—¶ï¼Œè¿›è¡Œå†™å…¥æ“ä½œï¼Œä¹Ÿå¯ä»¥<strong>é€‰æ‹©ç§¯ç´¯ä¸€å®šé‡çš„å†™å‘½ä»¤</strong>åä¸€æ¬¡æ€§å°†æ•°æ®å†™å…¥æ•°æ®åº“ä¸­ã€‚</p>\n<p><img src=\"https://raw.githubusercontent.com/lyydsheep/pic/main/202410301926736.png\" alt=\"image-20241030192626673\"></p>\n<p>å¼‚æ­¥å†™å…¥æ“ä½œæå¤§é™ä½äº†å†™è¯·æ±‚çš„å»¶è¿Ÿä»¥åŠæ•°æ®åº“çš„è´Ÿè½½ï¼Œä½†ä»£ä»·æ˜¯æ•°æ®å®‰å…¨æ€§ä¸å¤Ÿé«˜ã€‚å€˜è‹¥å½“éƒ¨åˆ†å­˜å‚¨åœ¨å†…å­˜ä¸­çš„æ•°æ®æœªå†™å…¥æ•°æ®åº“æ—¶ï¼Œå­˜å‚¨æœåŠ¡å‘ç”Ÿäº†å´©æºƒï¼Œé‚£ä¹ˆæ•°æ®å°±ä¸¢å¤±äº†ã€‚</p>\n<h2 id=\"åˆ†å¸ƒå¼é”\"><a href=\"#åˆ†å¸ƒå¼é”\" class=\"headerlink\" title=\"åˆ†å¸ƒå¼é”\"></a>åˆ†å¸ƒå¼é”</h2><p>åˆ†å¸ƒå¼é”å°±æ˜¯åº”ç”¨åœ¨åˆ†å¸ƒå¼åœºæ™¯ä¸‹çš„é”ï¼Œä¿è¯å„å°æœºå™¨ä¸Šçš„å„ä¸ªè¿›ç¨‹å¹¶å‘å®‰å…¨çš„æ“ä½œæŸä¸€èµ„æºã€‚ä¸€ä¸ªåˆç†çš„åˆ†å¸ƒå¼é”åº”å…·å¤‡å¦‚ä¸‹ç‰¹ç‚¹ï¼š</p>\n<ul>\n<li><strong>äº’æ–¥æ€§</strong>ï¼šé’ˆå¯¹æŸä¸€èµ„æºï¼ŒåŒä¸€æ—¶åˆ»åªèƒ½æœ‰ä¸€ä¸ªç«äº‰è€…æŒæœ‰é”ï¼Œå…¶ä»–ç«äº‰è€…åˆ™é˜»å¡</li>\n<li><strong>æŠ—æ­»é”æ€§ï¼ˆæ´»æ€§ï¼‰</strong>ï¼šå½“ä¸€ä¸ªç«äº‰è€…æŒæœ‰é”çš„æœŸé—´ï¼Œå³ä½¿å‘ç”Ÿäº†å¼‚å¸¸å¯¼è‡´ç¨‹åºé€€å‡ºï¼Œæ— æ³•æ­£å¸¸é‡Šæ”¾é”ï¼Œä¹Ÿèƒ½æœ‰å…œåº•ç­–ç•¥å°†é”é‡Šæ”¾ï¼Œé¿å…å‘ç”Ÿæ­»é”</li>\n<li><strong>å¯¹ç§°æ€§</strong>ï¼šå¯¹åŒä¸€èµ„æºä¸Šé”å’Œè§£é”å¿…é¡»æ˜¯åŒä¸€ä¸ªç«äº‰è€…</li>\n<li><strong>å¯é æ€§</strong>ï¼šå…·å¤‡ä¸€å®šçš„å®¹ç¾èƒ½åŠ›</li>\n</ul>\n<h3 id=\"å®ç°\"><a href=\"#å®ç°\" class=\"headerlink\" title=\"å®ç°\"></a>å®ç°</h3><p>ä»åˆ†å¸ƒå¼é”çš„ç‰¹ç‚¹å¯ä»¥æ¨æµ‹å‡ºï¼Œä½¿ç”¨Rediså®ç°åˆ†å¸ƒå¼é”å¤§è‡´æµç¨‹åº”è¯¥æ˜¯ï¼š</p>\n<ol>\n<li>å¯¹æŸä¸€ä¸ªèµ„æºå°è¯•åŠ é”</li>\n<li>åŠ é”å¹¶ä¸”æ ‡è®°<code>owner</code></li>\n<li>å¤„ç†ä¸šåŠ¡</li>\n<li>æ£€æŸ¥é”çš„<code>owner</code></li>\n<li>åˆ é™¤é”</li>\n</ol>\n<blockquote>\n<p>ä¸ºä»€ä¹ˆè¦æ ‡è®°<code>owner</code>ï¼Ÿ</p>\n</blockquote>\n<p>å¦‚æœä¸æ ‡è®°é”çš„<code>owner</code>ï¼Œå¯èƒ½ä¼šå‡ºç°ç«äº‰è€…Aå°†ç«äº‰è€…Bçš„é”é‡Šæ”¾ï¼ŒğŸŒ°ï¼šå‡è®¾Aç‡å…ˆæ‹¿åˆ°åˆ†å¸ƒå¼é”ï¼Œæ¥ç€è¿›è¡Œä¸šåŠ¡æµç¨‹ã€‚å€˜è‹¥æ­¤æ—¶Aç”±äºç½‘ç»œå»¶è¿Ÿæˆ–CPUå ç”¨ç‡é«˜ç­‰å› ç´ å¯¼è‡´åœ¨<strong>åˆ†å¸ƒå¼é”çš„è¿‡æœŸæ—¶ï¼Œä¸šåŠ¡ä»æ²¡æœ‰å®Œæˆ</strong>ã€‚é‚£ä¹ˆBä»¥ä¸ºåˆ†å¸ƒå¼é”æ²¡æœ‰è¢«å…¶ä»–ç«äº‰è€…å ç”¨ï¼Œé¡ºç†æˆç« åœ°æ‹¿åˆ°äº†åˆ†å¸ƒå¼é”ï¼Œæ‰§è¡Œä¸šåŠ¡é€»è¾‘ã€‚ä¸å¹¸çš„æ˜¯ï¼Œåœ¨Bæ‰§è¡Œä¸šåŠ¡è¿‡ç¨‹ä¸­ï¼ŒAç»ˆäºå®Œæˆäº†ä¸šåŠ¡ï¼Œç„¶åæ‰§è¡Œ<code>delete</code>åˆ é™¤åˆ†å¸ƒå¼é”çš„åŠ¨ä½œã€‚ä½†æ­¤æ—¶Aåˆ é™¤çš„å¹¶éæ˜¯è‡ªå·±ï¼Œè€Œæ˜¯Bçš„åˆ†å¸ƒå¼é”ã€‚é‚£ä¹ˆè¯¥åˆ†å¸ƒå¼é”å°±å¤±å»äº†ä¿è¯èµ„æºå¹¶å‘å®‰å…¨çš„æ„ä¹‰ã€‚</p>\n<blockquote>\n<p>å¦‚ä½•ä¿è¯æ£€æŸ¥-åˆ é™¤çš„åŸå­æ€§ï¼Ÿ</p>\n</blockquote>\n<p>4ã€5æ­¥éª¤æ˜¯å…¸å‹çš„<strong>check-do something</strong>åœºæ™¯ï¼Œéœ€è¦ä¿è¯åŸå­æ€§ï¼Œå¦åˆ™ä¼šå‡ºç°å¹¶å‘é—®é¢˜ã€‚</p>\n<p>è¦æƒ³å®ç°RedisæŸäº›æ“ä½œç»„åˆçš„åŸå­æ€§ï¼Œ<strong>Luaè„šæœ¬</strong>æ˜¯ä¸äºŒæ³•é—¨ã€‚Redis+Luaï¼Œå¯ä»¥è¯´æ˜¯ä¸“é—¨ä¸ºè§£å†³åŸå­é—®é¢˜è€Œç”Ÿçš„ã€‚æœ‰äº†Luaçš„ç‰¹æ€§ï¼ŒRedisæ‰çœŸæ­£åœ¨åˆ†å¸ƒå¼é”ã€ç§’æ€ç­‰åœºæ™¯æœ‰äº†ç”¨æ­¦ä¹‹åœ°ï¼Œæœ€ç»ˆRediså®ç°åˆ†å¸ƒå¼é”çš„æµç¨‹å¦‚ä¸‹ï¼š</p>\n<p><img src=\"https://raw.githubusercontent.com/lyydsheep/pic/main/202410270957284.png\" alt=\"image-20241027095707243\"></p>\n"},{"title":"Rediså¯¹è±¡","publish":true,"description":"è®°å½•Rediså¯¹è±¡çŸ¥è¯†ç‚¹","sticky":2,"_content":"\n# Rediså¯¹è±¡\n\n## String\n\nStringå°±æ˜¯å­—ç¬¦ä¸²ï¼Œæ˜¯Redisä¸­çš„ä¸€ä¸ªæœ€åŸºæœ¬æ•°æ®å¯¹è±¡ï¼Œæœ€å¤§å­˜å‚¨æ•°æ®**512MB**\n\n### Setæ“ä½œ\n\nåŸºæœ¬è¯­æ³•ï¼š**`set key value [expiration EX seconds | PX milliseconds] [NX|XX]`**\n\nSetæ“ä½œç”¨äºåœ¨Redisä¸­è®¾ç½®ä¸€ä¸ªK-Vå¯¹ï¼Œå…¶ä¸­å‡ ä¸ªæ‰©å±•å‚æ•°ä½œç”¨åˆ†åˆ«å¦‚ä¸‹ï¼š\n\n- **EX seconds**ï¼šè®¾ç½®K-Vå¯¹çš„è¿‡æœŸæ—¶é—´ä¸ºå¤šå°‘ç§’\n- **PX milliseconds**ï¼šè®¾ç½®K-Vå¯¹çš„è¿‡æœŸæ—¶é—´ä¸ºå¤šå°‘æ¯«ç§’\n- **NX**ï¼šåªæœ‰å½“Keyä¸å­˜åœ¨æ—¶ï¼Œå‘½ä»¤æ‰ç”Ÿæ•ˆï¼Œç›¸å½“äº`setnx key value`\n- **XX**ï¼šåªæœ‰å½“Keyå­˜åœ¨æ—¶ï¼Œå‘½ä»¤æ‰ç”Ÿæ•ˆ\n\nâš ï¸ï¼šå¯¹ä¸€ä¸ªå·²ç»å­˜åœ¨Keyè¿›è¡Œsetæ“ä½œä¼š**å°†åŸæœ‰å€¼è¦†ç›–**ï¼Œå¯èƒ½ä¼šå¯¼è‡´**åŸæœ‰å€¼ä¸¢å¤±ã€æ“¦é™¤è¿‡æœŸæ—¶é—´ã€ä¸¢å¤±åŸæœ‰å€¼ç±»å‹**\n\n### ä¸‰ç§ç¼–ç æ–¹å¼\n\nStringå¯¹è±¡åº•å±‚é‡‡ç”¨ä¸‰ç§ä¸åŒçš„ç¼–ç æ–¹å¼ä»¥é«˜æ•ˆåº”å¯¹å„ç§åœºæ™¯\n\n- **INTç¼–ç **ï¼šç”¨äºå­˜å‚¨longèŒƒå›´å†…çš„**æ•´æ•°**\n  - âš ï¸ï¼šå¦‚æœæ˜¯æµ®ç‚¹æ•°ï¼Œåˆ™ä¸èƒ½ä½¿ç”¨INTç¼–ç ã€‚å› ä¸ºINTç¼–ç åªèƒ½ç”¨äºè¡¨ç¤ºæ•´æ•°\n- **EMBSTRç¼–ç **ï¼šå¦‚æœå­—ç¬¦ä¸²çš„å¤§å°å°äºé˜ˆå€¼å­—èŠ‚ï¼Œåˆ™é‡‡ç”¨æ­¤æ–¹å¼\n- **RAWç¼–ç **ï¼šå¦‚æœå­—ç¬¦ä¸²çš„å¤§å°å¤§äºé˜ˆå€¼å­—èŠ‚ï¼Œåˆ™é‡‡ç”¨æ­¤æ–¹å¼\n\nEMBSTRç¼–ç å’ŒRAWç¼–ç æ–¹å¼åœ¨åº•å±‚å®ç°ä¸­éƒ½æ˜¯ç”±redisObjectå’ŒSDSä¸¤ä¸ªç»“æ„ç»„æˆï¼ŒåŒºåˆ«åœ¨äº**è¿™ä¸¤ä¸ªç»“æ„åœ¨ç‰©ç†å†…å­˜ä¸Šæ˜¯å¦è¿ç»­ï¼ˆä¸ºä¸€æ•´ä½“ï¼‰**\n\nEMBSTRåœ¨å†…å­˜ä¸­çš„è¡¨ç¤ºï¼š\n\n![image-20241003100407308](https://raw.githubusercontent.com/lyydsheep/pic/main/202410031004350.png)\n\nRAWåœ¨å†…å­˜ä¸­çš„è¡¨ç¤ºï¼š\n\n![image-20241003100440097](https://raw.githubusercontent.com/lyydsheep/pic/main/202410031004128.png)\n\n#### ä¸‰ç§ç¼–ç æ–¹å¼çš„è½¬æ¢å…³ç³»\n\néšç€å¯¹Redisçš„æ“ä½œï¼ŒStringå¯¹è±¡çš„ç¼–ç æ–¹å¼å¯èƒ½æœ‰å¦‚ä¸‹å˜åŒ–ï¼š\n\nINT --> RAWï¼šå½“å­˜å‚¨çš„å†…å®¹ä¸å†æ˜¯æ•´æ•°æˆ–å¤§å°è¶…è¿‡longèŒƒå›´ï¼Œåˆ™éœ€è¦å°†INTç¼–ç è½¬æ¢ä¸ºRAWç¼–ç \n\nEMBSTR --> RAWï¼šç”±äºEMBSTRç¼–ç çš„Stringå¯¹è±¡æ˜¯**åªè¯»**çš„ï¼Œæ‰€ä»¥å¯¹ä¸€ä¸ªEMBSTRè¿›è¡Œå†™æ“ä½œæ—¶ï¼Œå°±ä¼šå°†å…¶ç¼–ç æ–¹å¼æ”¹ä¸ºRAWã€‚è¿™æ˜¯å› ä¸ºä¿®æ”¹æ•°æ®å°±è¦é‡æ–°åˆ†é…å­˜å‚¨ç©ºé—´ï¼Œè€ŒEMBSTRä¸­redisObjectå’ŒSDSæ˜¯è¿ç»­çš„ï¼Œä¸æ˜“åˆ†é…ç©ºé—´ã€‚å¹¶ä¸”åªè¦è¿›è¡Œä¿®æ”¹æ“ä½œé‚£ä¹ˆå°±èƒ½è®¤ä¸ºè¿™ä¸ªStringæ˜¯æ˜“å˜çš„ã€ä¸ç¨³å®šçš„ï¼Œé‡‡ç”¨RAWç¼–ç æ–¹å¼èƒ½å¤Ÿå‡å°‘é¢‘ç¹å¯¹EMBSTRå†…å­˜åˆ†é…çš„æ€§èƒ½æŸè€—\n\n### SDSç»“æ„\n\nä¸ç®¡æ˜¯EMBSTRè¿˜æ˜¯RAWï¼Œéƒ½æœ‰ä¸€ä¸ªSDSç»“æ„ï¼ŒSDSç»“æ„æ˜¯ä¸ºäº†è§£å†³Cè¯­è¨€ä¸­å­—ç¬¦ä¸²çš„å°´å°¬å¤„å¢ƒ\n\n- è®¡ç®—å­—ç¬¦ä¸²é•¿åº¦éœ€è¦éå†ï¼Œæ—¶é—´å¤æ‚åº¦$$O(n)$$\n- å¯¹å­—ç¬¦ä¸²è¿½åŠ å†…å®¹éœ€è¦æ‰©å®¹æ“ä½œ\n- äºŒè¿›åˆ¶ä¸å®‰å…¨\n  - äºŒè¿›åˆ¶å®‰å…¨æ˜¯æŒ‡å…¬å¹³å¯¹å¾…æ¯ä¸€ä¸ªå­—ç¬¦ï¼Œä¸ç‰¹æ®Šå¤„ç†ä»»ä½•å­—ç¬¦\n  - Cè¯­è¨€ä¸­å­—ç¬¦ä¸²ç‰¹æ®Šå¤„ç†`\\0`ä¸ºå­—ç¬¦ä¸²ç»“å°¾\n\nSDSç»“æ„å…·ä½“ç”±ä¸€ä¸‹å­—æ®µç»„æˆï¼š\n\n```C\nstruct __attribute__ ((__packed__)) sdshdr8 {\n    uint8_t len;\n    uint8_t alloc;\n    unsigned char flags;\n    char buf[];\n}\n```\n\n- **len**ï¼šè¡¨ç¤ºå­—ç¬¦ä¸²é•¿åº¦ï¼Œ**å¯ä»¥å¿«é€Ÿè¿”å›å­—ç¬¦ä¸²é•¿åº¦ï¼Œå¹¶ä¸”ä¸éœ€è¦`\\0`ä½œä¸ºç»“å°¾ç¬¦å·**\n- **alloc**ï¼šè¡¨ç¤ºåˆ†é…äº†å¤šå°‘å†…å­˜ç©ºé—´ï¼Œ**å…·æœ‰ä¸€å®šçš„é¢„ç•™ç©ºé—´ï¼Œæ— éœ€è¿›è¡Œæ‰©å®¹æ“ä½œ**\n- **flags**ï¼šç”¨äºåŒºåˆ†å…·ä½“æ˜¯ä»€ä¹ˆç±»å‹çš„SDS\n  - åœ¨Redisä¸­SDSåˆ†ä¸ºsdshdr8ã€sdshdr16ã€sdshdr32ã€sdshdr64\n\n## List\n\n3.2ç‰ˆæœ¬ä¹‹å‰ï¼ŒListå¯¹è±¡æœ‰ä¸¤ç§ç¼–ç æ–¹å¼\n\n- ZIPLIST\n- LINKLIST\n\nå½“æ»¡è¶³ä»¥ä¸‹æ¡ä»¶æ—¶ï¼Œé‡‡ç”¨ZIPLISTç¼–ç æ–¹å¼\n\n- åˆ—è¡¨å¯¹è±¡ä¸­æ‰€æœ‰å­˜å‚¨çš„å­—ç¬¦ä¸²å¯¹è±¡é•¿åº¦éƒ½å°äº64å­—èŠ‚\n- åˆ—è¡¨å¯¹è±¡ä¸­å­˜å‚¨çš„å¯¹è±¡æ•°é‡ä¸è¶…è¿‡512ä¸ªï¼ˆè¿™æ˜¯LISTçš„é™åˆ¶ï¼Œè€Œä¸æ˜¯ZIPLISTçš„é™åˆ¶ï¼‰\n\nğŸŒ°ï¼š\n\n![image-20241005112548274](https://raw.githubusercontent.com/lyydsheep/pic/main/202410051125337.png)\n\nZIPLISTä¸­æ•°æ®éƒ½æ˜¯ç´§å¯†æ’åˆ—çš„ï¼Œåœ¨æ•°æ®é‡å°çš„æ—¶å€™å¯ä»¥æœ‰æ•ˆèŠ‚çº¦å†…å­˜ï¼›è€ŒLINKLISTé¡¾åæ€ä¹‰ï¼Œæ•°æ®æ˜¯ä»¥é“¾è¡¨å½¢å¼ä¸²è”èµ·æ¥çš„ï¼Œåœ¨æ•°æ®é‡å¤§çš„æ—¶å€™é‡‡ç”¨LINKLISTç¼–ç å¯ä»¥åŠ å¿«å¤„ç†æ€§èƒ½\n\nğŸŒ°ï¼š\n\n![image-20241005112658713](https://raw.githubusercontent.com/lyydsheep/pic/main/202410051126746.png)\n\n### QUICKLIST\n\nZIPLISTåœ¨æ•°æ®è¾ƒå°‘æ—¶èŠ‚çº¦å†…å­˜ï¼ŒLINKLISTæ˜¯ä¸ºäº†åœ¨æ•°æ®è¾ƒå¤šæ—¶æé«˜æ›´æ–°æ•ˆç‡ã€‚ä½†æ˜¯ZIPLISTåœ¨æ•°æ®ç¨å¤šæ—¶æ’å…¥æ•°æ®ä¼šå¯¼è‡´å¤§é‡æ•°æ®å¤åˆ¶ï¼Œå ç”¨å†…å­˜ç©ºé—´ï¼›åŒæ ·åœ°ï¼ŒLINKLISTç”±äºèŠ‚ç‚¹æ•°é‡ä¹Ÿå¼‚å¸¸å¤šï¼Œä¹Ÿä¼šå ç”¨ä¸å°‘å†…å­˜\n\nåŸºäºä¸Šè¿°é—®é¢˜ï¼Œ3.2ç‰ˆæœ¬å°±å¼•å…¥äº†QUICKLISTã€‚QUICKLISTæœ¬è´¨å°±æ˜¯**ZIPLISTå’ŒLINKLISTçš„ç»“åˆä½“**\n\nQUICKLISTçš„å®ç°æ€è·¯æ˜¯ï¼Œå°†åŸæœ¬LINKLISTçš„**å•ä¸ªèŠ‚ç‚¹å­˜å‚¨å•ä¸ªæ•°æ®**çš„æ¨¡å¼ï¼Œæ›´æ¢æˆä¸€ä¸ª**å•ä¸ªèŠ‚ç‚¹ï¼ˆZIPLISTï¼‰å­˜å‚¨å¤šä¸ªæ•°æ®**çš„å½¢å¼\n\n![image-20241005113525108](https://raw.githubusercontent.com/lyydsheep/pic/main/202410051135173.png)\n\nå½“æ•°æ®è¾ƒå°‘æ—¶ï¼ŒQUICKLISTèŠ‚ç‚¹åªæœ‰ä¸€ä¸ªï¼Œé€€åŒ–æˆZIPLIST\n\nå½“æ•°æ®è¾ƒå¤šæ—¶ï¼Œåˆ™åŒæ—¶åˆ©ç”¨äº†ZIPLISTå’ŒLINKLISTçš„ä¼˜åŠ¿\n\n## å‹ç¼©åˆ—è¡¨\n\nå‹ç¼©åˆ—è¡¨ä½œä¸ºListçš„åº•å±‚æ•°æ®ç»“æ„ï¼Œæä¾›äº†ç´§å‡‘å‹çš„æ•°æ®å­˜å‚¨æ–¹å¼ï¼Œèƒ½èŠ‚çº¦å†…å­˜ï¼Œå°æ•°æ®é‡çš„æ—¶å€™éå†è®¿é—®æ€§èƒ½å¥½ï¼ˆè¿ç»­+å±€éƒ¨æ€§ä¼˜åŠ¿ï¼‰\n\n### ZIPLISTæ•´ä½“ç»“æ„\n\nåœ¨Redisä»£ç æ³¨é‡Šä¸­ï¼Œæœ‰å¯¹ZIPLISTæ¸…æ™°åœ°æè¿°ï¼š\n\n```c\n/* The general layout of the ziplist is as follows:\n\n<zlbytes> <zltail> <zllen> <entry> <entry> <entry> ... <entry> <zlend>\n*/\n```\n\nğŸŒ°ï¼šä¸€ä¸ªå…·æœ‰ä¸‰ä¸ªèŠ‚ç‚¹çš„ZIPLIST\n\n![image-20241008161508590](https://raw.githubusercontent.com/lyydsheep/pic/main/202410081615659.png)\n\n**zlbytes**å­—æ®µè¡¨ç¤ºè¯¥ZIPLISTä¸€å…±å ç”¨äº†å¤šå°‘å­—èŠ‚ï¼ˆåŒ…å«zlbyteså­—æ®µçš„å¤§å°ï¼‰\n\n**zltail**å­—æ®µè¡¨ç¤ºæœ€åä¸€ä¸ª**æ•°æ®èŠ‚ç‚¹ï¼ˆentryï¼‰**è·ç¦»ZIPLISTé¦–éƒ¨çš„åç§»å­—èŠ‚æ•°ï¼Œå¦‚æœZIPLISTä¸ºç©ºï¼ˆå³æœ¨æœ‰entryï¼‰ï¼Œåˆ™æŒ‡ç¤º**zlend**å­—æ®µçš„åç§»é‡\n\n> å¾ˆæ˜¾ç„¶ï¼Œä¼šæœ‰å¦‚ä¸‹ç­‰å¼ï¼š\n>\n> zlbytes = zltial + æœ€åä¸€ä¸ªentryå¤§å°ï¼ˆå¯èƒ½ä¸ºé›¶ï¼‰ + zlendå¤§å°\n\n**zllen**å­—æ®µè¡¨ç¤ºZIPLISTç»“æ„ä¸­entryçš„ä¸ªæ•°ï¼Œä½†ç”±äºè¯¥å­—æ®µåªå ç”¨2å­—èŠ‚ç©ºé—´ï¼Œæ‰€ä»¥æœ€å¤šåªèƒ½è¡¨ç¤º65535ä¸ªã€‚å½“å…ƒç´ ä¸ªæ•°è¿‡å¤šï¼Œåªèƒ½é€šè¿‡**éå†**çš„æ–¹å¼è·å–å…ƒç´ ä¸ªæ•°\n\n**zlend**å­—æ®µæ˜¯ä¸€ä¸ªç‰¹æ®ŠèŠ‚ç‚¹ï¼Œæ ‡è¯†ZIPLISTç»“æ„çš„ç»“æŸ\n\n**entry**å­—æ®µè¡¨ç¤ºä¸€ä¸ªæ•°æ®èŠ‚ç‚¹ï¼Œå®é™…ä¸Šä¹Ÿæ˜¯ä¸€ä¸ªç»“æ„ä½“ç±»å‹ã€‚è¯¥ç±»å‹ç”±ä¸‰ä¸ªå­—æ®µæ„æˆï¼Œåˆ†åˆ«æ˜¯\n\n```c\n<prevlen> <encoding> <entry-data>\n```\n\n### entryç»“æ„\n\n**`prevlen`**å­—æ®µè¡¨ç¤º**ä¸Šä¸€ä¸ªæ•°æ®èŠ‚ç‚¹ï¼ˆentryï¼‰çš„é•¿åº¦**ï¼Œå¦‚æœé•¿åº¦**å°äº254**ï¼Œé‚£ä¹ˆ**`prevlen`**å­—æ®µå ç”¨1å­—èŠ‚ç©ºé—´ï¼›å¦‚æœé•¿åº¦**å¤§äºç­‰äº254**ï¼Œé‚£ä¹ˆè¯¥å­—æ®µéœ€è¦ç”¨5å­—èŠ‚ç©ºé—´è¡¨ç¤ºï¼Œå¹¶ä¸”**ç¬¬ä¸€ä¸ªå­—èŠ‚ä¸º11111110**ï¼Œè¡¨ç¤ºè¿™æ˜¯ä¸€ä¸ª5å­—èŠ‚çš„`prevlen`ä¿¡æ¯ï¼Œå‰©ä¸‹çš„4å­—èŠ‚ç”¨æ¥è¡¨ç¤ºé•¿åº¦\n\nâš ï¸ï¼šä¸ºä»€ä¹ˆé˜ˆå€¼æ˜¯254è€Œä¸æ˜¯255ï¼Ÿè¿™æ˜¯å› ä¸º255è¢«ç”¨æ¥ç‰¹æ®Šè¡¨ç¤º**zlend**å­—æ®µï¼Œæ ‡è¯†ZIPLISTç»“æ„çš„ç»“æŸ\n\n**`encoding`**å­—æ®µæ˜¯ä¸€ä¸ªæ•´å½¢æ•°æ®ï¼Œå…¶äºŒè¿›åˆ¶ç¼–ç ç”±**å†…å®¹ç±»å‹**å’Œ**å†…å®¹æ•°æ®çš„å­—èŠ‚é•¿åº¦**ä¸¤éƒ¨åˆ†ç»„æˆ\n\n### è¿é”æ›´æ–°\n\nå½“å‘ä¸€ä¸ªentryå‰é¢æ’å…¥ä¸€ä¸ªé•¿åº¦è¶…è¿‡254çš„èŠ‚ç‚¹æ—¶ï¼Œ`prevlen`å­—æ®µå¯èƒ½å°±ä¼šç”±1å­—èŠ‚å˜æˆ5å­—èŠ‚ï¼Œå¯¼è‡´æœ¬entryé•¿åº¦å¢å¤§ã€‚å¦‚æœè¿æ°”ä¸æ˜¯å¾ˆå¥½ï¼Œå°†ä¼šå¯¼è‡´ä¸‹ä¸€ä¸ªèŠ‚ç‚¹ä¸­çš„`prevlen`å­—æ®µå¢åŠ ï¼Œä»¥æ­¤ç±»æ¨ï¼Œé€ æˆè¿é”ååº”ï¼Œè¿™å°±æ˜¯è¿é”æ›´æ–°é—®é¢˜ã€‚\n\n![image-20241008185552935](https://raw.githubusercontent.com/lyydsheep/pic/main/202410081855045.png)\n\n#### LISTPACKä¼˜åŒ–\n\n`prevlen`å­—æ®µæ­£æ˜¯è¿é”æ›´æ–°çš„ç½ªé­ç¥¸é¦–ï¼Œä¸ºäº†è§£å†³è¿é”æ›´æ–°é—®é¢˜ï¼Œå°±ä¸èƒ½å†å»è®°å½•ä¸Šä¸€ä¸ªèŠ‚ç‚¹çš„é•¿åº¦ï¼Œä½†åˆè¦ä¿è¯èƒ½å¤Ÿå®ç°å€’åºéå†ï¼ˆæ‰¾åˆ°ä¸Šä¸€ä¸ªèŠ‚ç‚¹çš„ä½ç½®ï¼‰\n\nRedisä½¿ç”¨äº†ä¸€ç§å·§å¦™çš„æ–¹æ³•ï¼šåˆ é™¤`prevlen`å­—æ®µï¼Œ**æ–°å¢`element-tot-len`å­—æ®µè®°å½•æ•´ä¸ªèŠ‚ç‚¹é™¤å®ƒï¼ˆelement-tot-lenå­—æ®µï¼‰è‡ªèº«ä¹‹å¤–çš„é•¿åº¦**\n\næ­¤æ—¶èŠ‚ç‚¹ç»“æ„å°±å˜æˆäº†ï¼š\n\n```c\n<encoding-type> <element-data> <element-top-len>\n```\n\n- encoding-typeæ˜¯ç¼–ç ç±»å‹\n- element-dataæ˜¯æ•°æ®å†…å®¹\n- element-top-lenæ‰€å çš„æ¯ä¸ªå­—èŠ‚çš„ç¬¬ä¸€ä¸ªbitä½ç”¨äºæ ‡è¯†æ˜¯å¦ç»“æŸï¼Œ0åˆ™ç»“æŸï¼Œ1åˆ™ç»§ç»­\n\nğŸŒ°ï¼š![image-20241008190334625](https://raw.githubusercontent.com/lyydsheep/pic/main/202410081903663.png)\n\n## Set\n\nRediä¸­çš„setæ˜¯ä¸€ä¸ªä¸é‡å¤ã€æ— åºçš„å­—ç¬¦ä¸²é›†åˆ\n\n> å¦‚æœSetåº•å±‚ä½¿ç”¨INTSETç¼–ç æ–¹å¼ï¼Œåˆ™é›†åˆæ˜¯æœ‰åºçš„\n\n### ç¼–ç æ–¹å¼ \n\nSetåº•å±‚æœ‰ä¸¤ç§ç¼–ç æ–¹å¼ï¼š**INTSETã€HASHTABLE**\n\nå½“Setä¸­å­˜å‚¨çš„éƒ½æ˜¯æ•´æ•°å¹¶ä¸”å…ƒç´ ä¸ªæ•°å°‘äº512ä¸ªæ—¶ï¼Œåˆ™é‡‡ç”¨INTSETç¼–ç æ–¹å¼\n\n![image-20241009154144626](https://raw.githubusercontent.com/lyydsheep/pic/main/202410091541699.png)\n\nç”±ä¸Šå›¾å¯è§ï¼Œé‡‡ç”¨INTSETç¼–ç ï¼Œå…ƒç´ æ’åˆ—æ¯”è¾ƒç´§å‡‘ï¼Œå†…å­˜å ç”¨å°‘ï¼Œä½†æŸ¥æ‰¾æ—¶éœ€è¦ä½¿ç”¨äºŒåˆ†æ³•ï¼Œæ—¶é—´å¤æ‚åº¦ä¸º$O(nlogn)$\n\nå¦‚æœä¸æ»¡è¶³INTSETç¼–ç æ¡ä»¶ï¼Œåˆ™éœ€è¦ä½¿ç”¨HASHTABLEç¼–ç ï¼ŒHASHTABLEæŸ¥è¯¢ä¸€ä¸ªå…ƒç´ æ€§èƒ½å¾ˆé«˜ï¼Œæ—¶é—´å¤æ‚åº¦ä¸º$O(1)$\n\n![image-20241009154437973](https://raw.githubusercontent.com/lyydsheep/pic/main/202410091544018.png)\n\nç®€å•åœ°æ¦‚æ‹¬ï¼š\n\n- INTSETç¼–ç é€‚ç”¨äºå­˜å‚¨å°‘é‡æ•´æ•°åœºæ™¯ä»¥èŠ‚çº¦å†…å­˜ç©ºé—´\n- HASHTABLEç¼–ç é€‚ç”¨äºå¿«é€Ÿå®šä½æŸä¸ªå…ƒç´ çš„ä½ç½®\n\n## Hash\n\n// to do\n\npanic(\"implement me\")\n\n## HashTable\n\n>  HAHSTABLEæ˜¯Redisä¸­çš„ä¸€ç§åº•å±‚æ•°æ®ç»“æ„\n\né€šè¿‡HASHTABLEå¯ä»¥åœ¨$O(1)$æ—¶é—´å¤æ‚åº¦å†…å¿«é€Ÿå®šä½åˆ°Keyå¯¹äºçš„Value\n\n### ç»“æ„\n\næ€»æ‰€å‘¨çŸ¥ï¼ŒRedisæ˜¯ç”¨Cè¯­è¨€å®ç°çš„ã€‚HASHTABLEçš„Cå®ç°æ¶‰åŠåˆ°ä¸‰ä¸ªç»“æ„ä½“ï¼š`dict`ã€`dictht`ã€`dicEntry`\n\nç®€å•åœ°è¯´ï¼Œ`dict`å°è£…äº†ä¸¤ä¸ª`dictht`ç»“æ„ï¼Œæ¯ä¸€ä¸ª`dictht`ç»“æ„éƒ½æœ‰ä¸€ä¸ªå¤§å°ä¸º`size`çš„**bucket**ï¼Œbucketä¸­å­˜æ”¾ç€`dicEntry`é“¾è¡¨ã€‚ä¸‰ä¸ªç»“æ„ä½“ä¹‹é—´çš„å…³ç³»å¦‚ä¸‹å›¾æ‰€ç¤ºï¼š\n\n<img src=\"https://raw.githubusercontent.com/lyydsheep/pic/main/202410122043279.png\" alt=\"image-20241012204338184\" style=\"zoom:67%;\" />\n\nå¯ä»¥çœ‹åˆ°dictç»“æ„ä¸­æœ‰ä¸¤ä¸ªdicthtç»“æ„ï¼Œä¹Ÿå°±æ˜¯HASHTABLEç»“æ„ã€‚dicEntryæ˜¯é“¾è¡¨ç»“æ„ï¼Œé€šè¿‡æ‹‰é“¾æ³•è§£å†³Hashå†²çª\n\næ¥ä¸‹æ¥ï¼Œç»“åˆæºç jè§£é‡Šæ¯ä¸€ä¸ªç»“æ„ä½“çš„å­—æ®µå«ä¹‰ï¼š\n\n```c\ntypedef struct dict{\n    dictType *type; //ç›´çº¿dictTypeç»“æ„ï¼ŒdictTypeç»“æ„ä¸­åŒ…å«è‡ªå®šä¹‰çš„å‡½æ•°ï¼Œè¿™äº›å‡½æ•°ä½¿å¾—keyå’Œvalueèƒ½å¤Ÿå­˜å‚¨ä»»ä½•ç±»å‹çš„æ•°æ®\n    void *privdata; //ç§æœ‰æ•°æ®ï¼Œä¿å­˜ç€dictTypeç»“æ„ä¸­å‡½æ•°çš„ å‚æ•°\n    dictht ht[2]; //ä¸¤å¼ å“ˆå¸Œè¡¨\n    long rehashidx; //rehashçš„æ ‡è®°ï¼Œrehashidx=-1è¡¨ç¤ºæ²¡æœ‰è¿›è¡Œrehashï¼Œrehashæ—¶æ¯è¿ç§»ä¸€ä¸ªæ¡¶å°±å¯¹rehashidxåŠ ä¸€\n    int itreators;  //æ­£åœ¨è¿­ä»£çš„è¿­ä»£å™¨æ•°é‡\n}\n```\n\n```c\n#dictç»“æ„ä¸­ht[0]ã€ht[1]å“ˆå¸Œè¡¨çš„æ•°æ®ç»“æ„\ntypedef struct dictht{\n    dictEntry[] table;        //å­˜æ”¾ä¸€ä¸ªæ•°ç»„çš„åœ°å€ï¼Œæ•°ç»„ä¸­å­˜æ”¾å“ˆå¸ŒèŠ‚ç‚¹dictEntryçš„åœ°å€\n    unsingned long size;      //å“ˆå¸Œè¡¨tableçš„å¤§å°ï¼Œå‡ºå§‹å¤§å°ä¸º4\n    unsingned long  sizemask; //ç”¨äºå°†hashå€¼æ˜ å°„åˆ°tableä½ç½®çš„ç´¢å¼•ï¼Œå¤§å°ä¸ºï¼ˆsize-1ï¼‰\n    unsingned long  used;     //è®°å½•å“ˆå¸Œè¡¨å·²æœ‰èŠ‚ç‚¹ï¼ˆé”®å€¼å¯¹ï¼‰çš„æ•°é‡\n}\n```\n\n```c\n#å“ˆå¸Œè¡¨èŠ‚ç‚¹ç»“æ„å®šä¹‰\ntypedef struct dictEntity{\n    void *key;//é”®\n    //å€¼\n    union{\n        //â€œæˆ‘ä¹‹æ‰€ä»¥è¦æé†’ä½ æ³¨æ„è¿™é‡Œï¼Œå…¶å®æ˜¯ä¸ºäº†è¯´æ˜ï¼Œè¿™ç§å®ç°æ–¹æ³•æ˜¯ä¸€ç§èŠ‚çœå†…å­˜çš„å¼€å‘å°æŠ€å·§ï¼Œéå¸¸å€¼å¾—å­¦ä¹ ã€‚å› ä¸ºå½“å€¼ä¸ºæ•´æ•°æˆ–åŒç²¾åº¦æµ®ç‚¹æ•°æ—¶ï¼Œç”±äºå…¶æœ¬èº«å°±æ˜¯ 64 ä½ï¼Œå°±å¯ä»¥ä¸ç”¨æŒ‡é’ˆæŒ‡å‘äº†ï¼Œè€Œæ˜¯å¯ä»¥ç›´æ¥å­˜åœ¨é”®å€¼å¯¹çš„ç»“æ„ä½“ä¸­ï¼Œè¿™æ ·å°±é¿å…äº†å†ç”¨ä¸€ä¸ªæŒ‡é’ˆï¼Œä»è€ŒèŠ‚çœäº†å†…å­˜ç©ºé—´ã€‚â€\n        void *val;//è‡ªå®šä¹‰ç±»å‹\n        uint64_t u64;//æ— ç¬¦å·æ•´å½¢\n        int64_t s64;//ç¬¦åˆæ•´å½¢\n        double d;//æµ®ç‚¹å‹\n    } v;\n    struct dictEntity *next;//å‘ç”Ÿå“ˆå¸Œå†²çªæ—¶ä½¿ç”¨ã€‚æŒ‡å‘ä¸‹ä¸€ä¸ªå“ˆå¸Œè¡¨èŠ‚ç‚¹ï¼Œå½¢æˆé“¾è¡¨\n}\n```\n\n### HashTableæ¸è¿›å¼æ‰©å®¹\n\næ¸è¿›å¼æ‰©å®¹ï¼Œé¡¾åæ€ä¹‰å°±æ˜¯ä¸€ç‚¹ä¸€ç‚¹æ‰©å®¹å®¹é‡ã€‚ç›¸æ¯”äºä¸€æ¬¡æ€§æ‰©å®¹å¤§é‡ç©ºé—´ï¼Œå¹¶è¿›è¡Œå¤§é‡çš„æ‹·è´å·¥ä½œï¼Œæ¸è¿›å¼æ‰©å®¹ä¸æ˜“å¯¼è‡´Redisåœ¨ä¸€æ®µæ—¶é—´å†…ç”±äºè¿›è¡Œæ‰©å®¹å·¥ä½œè€Œæ— æ³•æä¾›å…¶ä»–æœåŠ¡ï¼Œç”¨æˆ·ä½“éªŒæ„Ÿæ›´å¥½ã€‚\n\nå½“dictæ»¡è¶³æ‰©å®¹æ¡ä»¶åï¼Œå°±ä¼šè¿›è¡ŒRehashæ“ä½œã€‚Rehashæ“ä½œå¤§è‡´åˆ†ä¸ºä¸‰æ­¥ï¼š\n\n- ä¸º**ht[1]**å“ˆå¸Œè¡¨å¼€è¾Ÿä¸€å—ç©ºé—´ï¼Œç©ºé—´å¤§å°è®¾å®šä¸º**ç¬¬ä¸€ä¸ªå¤§äº2 * ht[0]çš„2æ•´æ•°æ¬¡å¹‚**ã€‚ğŸŒ°ï¼šh[0] = 500ï¼Œé‚£ä¹ˆåœ¨è¿›è¡ŒRehashæ“ä½œæ—¶å¼€è¾Ÿçš„ç©ºé—´ä¸º$2^{\\left\\lceil log_2(2*500) \\right\\rceil} = 1024$\n\n- è¿ç§»ht[0]æ•°æ®è‡³ht[1]ï¼šåœ¨RehashæœŸé—´ï¼Œæ¯æ¬¡å¯¹å­—å…¸è¿›è¡Œå¢åˆ æ”¹æŸ¥æ“ä½œï¼Œç¨‹åºä¼šé¡ºå¸¦è¿ç§»å½“å‰`rehashidx`æ‰€æŒ‡å‘çš„æ•°æ®ï¼Œå¹¶é€’å¢ä¸‹æ ‡å€¼ã€‚å¦‚æœå½“å‰`rehashidx`å‘½ä¸­äº†ä¸€ä¸ªç©ºä½ç½®ï¼Œåˆ™ä¼šå…ˆå°è¯•ç»§ç»­å¾€åæŸ¥æ‰¾è‹¥å¹²ä½ç½®ï¼Œå¦‚æœæŸ¥è¯¢æ— æœå°±ç›´æ¥è¿”å›\n- æœ€ç»ˆï¼Œht[0]çš„æ•°æ®å°†ä¼šå…¨éƒ¨è¿ç§»è‡³ht[1]ä¸­ã€‚æ­¤æ—¶ï¼Œéœ€è¦äº¤æ¢ht[0]å’Œht[1]çš„æŒ‡é’ˆï¼Œå¹¶å°†`rehash`è®¾ä¸º-1ï¼Œè¡¨ç¤ºå¤„äºéRehashçŠ¶æ€\n  - ä¸ºä»€ä¹ˆè¦äº¤æ¢ä¸¤å¼ å“ˆå¸Œè¡¨çš„æŒ‡é’ˆå‘¢ï¼Ÿå› ä¸ºht[0]ä»£è¡¨ç€æ­£åœ¨ä½¿ç”¨çš„å“ˆå¸Œè¡¨\n\n<img src=\"https://raw.githubusercontent.com/lyydsheep/pic/main/202410122114045.png\" alt=\"image-20241012211414978\" style=\"zoom:80%;\" />\n\nâš ï¸ï¼šå€¼å¾—æ³¨æ„çš„æ˜¯ï¼Œåœ¨Rehashé˜¶æ®µï¼Œç”±äºå­˜åœ¨ä¸¤å¼ å“ˆå¸Œè¡¨ï¼Œæ­¤æ—¶è¿›è¡Œçš„åˆ é™¤ã€æŸ¥æ‰¾ã€æ›´æ–°æ“ä½œä¼šåœ¨ä¸¤ä¸ªè¡¨ä¸Šè¿›è¡Œã€‚æ¯”å¦‚æŸ¥æ‰¾å…ƒç´ æ—¶ï¼Œå¦‚æœht[0]è¡¨æ²¡æœ‰æ‰¾åˆ°ï¼Œåˆ™ä¼šæ¥ç€æŸ¥è¯¢ht[1]è¡¨ã€‚ä½†è¿›è¡Œæ’å…¥æ“ä½œæ—¶ï¼Œåªä¼šåœ¨ht[1]è¡¨ä¸Šå¢æ·»æ•°æ®\n\n### æ‰©ï¼ˆç¼©ï¼‰å®¹æ—¶æœº\n\nHASHTABLEç”±ä¸€ä¸ªå˜é‡â€”â€”**è´Ÿè½½å› å­**å†³å®šæ˜¯å¦æ‰©å®¹ï¼ˆç¼©å®¹ï¼‰\n\n**è´Ÿè½½å› å­çš„ç®—æ³•ï¼š`ht[0].used / ht[0].size`**\n\n**æ‰©å®¹åœºæ™¯ï¼š**\n\n- è´Ÿè½½å› å­å¤§äºç­‰äº1å¹¶ä¸”æ­¤æ—¶æœåŠ¡å™¨æ²¡æœ‰æ‰§è¡ŒBGSAVEæˆ–BGREWRITEAOFè¿™ä¸¤ä¸ªå‘½ä»¤\n- è´Ÿè½½å› å­å¤§äº5\n\n**ç¼©å®¹åœºæ™¯ï¼š**\n\n- è´Ÿè½½å› å­å°äº0.1å¹¶ä¸”æ²¡æœ‰BGSAVEæˆ–BGWRITEAOFå‘½ä»¤åœ¨æ‰§è¡Œ\n\n## SkipList\n\n## è·³è¡¨çš„ç»“æ„\n\nè·³è¡¨æ˜¯Redisä¸­ZSETçš„åº•å±‚æ•°æ®ç»“æ„ï¼Œè·³è¡¨æœ¬è´¨ä¸Šå°±æ˜¯ç”±**é“¾è¡¨+å¤šçº§ç´¢å¼•**ç»„æˆçš„\n\nä½†Redisä½¿ç”¨çš„è·³è¡¨å¹¶éæ ‡å‡†è·³è¡¨ï¼ŒRedisä¸­çš„è·³è¡¨åœ¨æ ‡å‡†è·³è¡¨åŸºç¡€ä¹‹ä¸Š**å…è®¸scoreå€¼é‡å¤**ä»¥åŠ**0å±‚èŠ‚ç‚¹å…·æœ‰å‘åæŒ‡é’ˆ**ï¼Œå¦‚ä¸‹å›¾æ‰€ç¤ºï¼š\n\n<img src=\"https://raw.githubusercontent.com/lyydsheep/pic/main/202410141047754.png\" alt=\"image-20241014104743623\" style=\"zoom:67%;\" />\n\nå…¶ä¸­çº¢è‰²æ¡†ä¸­çš„å±äºåŒä¸€ä¸ªèŠ‚ç‚¹çš„ä¸åŒå±‚çº§ï¼Œè·³è¡¨ä¸­èŠ‚ç‚¹çš„æ•°é‡ä½“ç°åœ¨0å±‚ï¼ˆæœ€åº•å±‚ï¼‰èŠ‚ç‚¹çš„ä¸ªæ•°\n\nç»“åˆæºç ï¼Œåˆ†æèŠ‚ç‚¹çš„ç»„æˆï¼š\n\n```C\n// from Redis 7.0.8\n/* ZSETs use a specialized version of Skiplists */\ntypedef struct zskiplistNode {\n    sds ele;\n    double score;\n    struct zskiplistNode *backward;\n    struct zskiplistLevel {\n        struct zskiplistNode *forward;\n        unsigned long span;\n    } level[];\n} zskiplistNode;\n```\n\n- **ele**ï¼šsdsç»“æ„ï¼Œä¸€ä¸ªè¢«å°è£…è¿‡çš„å­—ç¬¦ä¸²ï¼Œæœ¬è´¨ä¸Šæ˜¯ä¸€ä¸ªcharæ•°ç»„ï¼Œç”¨äºå­˜å‚¨æ•°æ®\n- **score**ï¼šåŒç²¾åº¦æµ®ç‚¹æ•°ç±»å‹ï¼Œè¡¨ç¤ºè¯¥èŠ‚ç‚¹çš„åˆ†æ•°ï¼Œå†³å®šäº†è·³è¡¨ä¸­èŠ‚ç‚¹çš„ä½ç½®æ¬¡åº\n- **backward**ï¼šæŒ‡å‘ä¸Šä¸€ä¸ªèŠ‚ç‚¹çš„å›é€€æŒ‡é’ˆ\n- **level**ï¼šæ˜¯ä¸€ä¸ªzskiplistLeveç»“æ„ä½“æ•°ç»„ï¼Œç”¨äºè¡¨ç¤ºé«˜å±‚ç´¢å¼•ã€‚zskiplistLeveç»“æ„ä½“åŒ…å«äº†ä¸¤ä¸ªå­—æ®µï¼Œä¸€ä¸ªæ˜¯**forward**ï¼ŒæŒ‡å‘åŒå±‚çš„ä¸‹ä¸€ä¸ªç´¢å¼•ï¼›å¦ä¸€ä¸ªæ˜¯**span**ï¼Œè®°å½•äº†è·ç¦»ä¸‹ä¸€ä¸ªç´¢å¼•ï¼ˆèŠ‚ç‚¹ï¼‰çš„æ­¥é•¿\n\nç¤ºæ„å›¾ï¼š\n\n<img src=\"https://raw.githubusercontent.com/lyydsheep/pic/main/202410141101384.png\" alt=\"image-20241014110129253\" style=\"zoom:67%;\" />\n\n### å®ç°ç»†èŠ‚\n\n- Redis**è·³è¡¨ä¸­å•ä¸ªèŠ‚ç‚¹çš„å±‚æ•°**ç”±æ¦‚ç‡å†³å®šã€‚æ¯æ’å…¥ä¸€ä¸ªèŠ‚ç‚¹åˆ°0å±‚ï¼ŒRediså†³å®šè¯¥èŠ‚ç‚¹æ˜¯å¦å¢åŠ ä¸€å±‚ç´¢å¼•çš„**æ¦‚ç‡ä¸º25%**\n\n- è·³è¡¨å°†çº¯ç²¹çš„æœ‰åºå•é“¾è¡¨åœ¨æ’å…¥ã€åˆ é™¤ã€æ›´æ–°æ“ä½œä»$O(n)$æ—¶é—´å¤æ‚åº¦é™ä½è‡³$O(logN)$\n\n## ZSet\n\nZsetä¹Ÿå«Sorted Setå³æœ‰åºé›†åˆï¼Œæ˜¯æŒ‰ç…§å…ƒç´ çš„åˆ†æ•°è¿›è¡Œæ’åºçš„é›†åˆã€‚åˆ†æ•°ç›¸åŒçš„æƒ…å†µä¸‹ï¼ŒæŒ‰ç…§å…ƒç´ çš„å­—å…¸åºè¿›è¡Œæ’åº\n\nZSetå¸¸ç”¨äºæ’åºé›†åˆçš„åœºæ™¯ï¼Œæœ€å…¸å‹çš„å°±æ˜¯**æ¸¸æˆæ’è¡Œæ¦œ**\n\n### ç¼–ç æ–¹å¼\n\nZSetæœ‰ä¸¤ç§åº•å±‚ç¼–ç æ–¹å¼ï¼Œä¸€ç§æ˜¯ZIPLISTï¼Œå¦ä¸€ç§æ˜¯SKIPLIST+HASHTABLE\n\n<img src=\"https://raw.githubusercontent.com/lyydsheep/pic/main/202410141759086.png\" alt=\"image-20241014175901004\" style=\"zoom:67%;\" />\n\nå¦‚æœæ»¡è¶³ä¸‹åˆ—æ¡ä»¶ï¼ŒZSetå°±ç”¨ZIPLISTç¼–ç æ–¹å¼ï¼š\n\n- åˆ—è¡¨å¯¹è±¡ä¿å­˜çš„æ‰€æœ‰å­—ç¬¦ä¸²é•¿åº¦å‡å°äº64å­—èŠ‚\n- åˆ—è¡¨å¯¹è±¡ä¿å­˜çš„å…ƒç´ ä¸ªæ•°å°‘äº128ä¸ª\n\nZIPLISTä¾æ—§ä¿æŒç€å®ƒçš„ä¼˜ç‚¹ï¼Œåœ¨æ•°æ®é‡è¾ƒå°‘æ—¶ï¼Œååˆ†èŠ‚çº¦å†…å­˜ç©ºé—´ã€‚å½“ZSeté‡‡ç”¨ZIPLISTç¼–ç æ—¶ï¼Œåº•å±‚ç»“æ„å¦‚ä¸‹å›¾ï¼š\n\n<img src=\"https://raw.githubusercontent.com/lyydsheep/pic/main/202410141802693.png\" alt=\"image-20241014180256647\" style=\"zoom:67%;\" />\n\nä½†å‡¡ä¸Šè¿°çš„ä¸¤ä¸ªæ¡ä»¶æœ‰ä¸€ä¸ªä¸æ»¡è¶³ï¼ŒZSetå°±é‡‡ç”¨**SKIPLIST+HASHTABLE**çš„ç¼–ç æ–¹å¼ã€‚å…¶ä¸­ï¼ŒSKIPLISTæ˜¯ä¸€ä¸ªå…·æœ‰å¤šçº§ç´¢å¼•çš„æœ‰åºé“¾è¡¨ï¼Œ**å¯ä»¥å®ç°é«˜æ•ˆçš„æŸ¥è¯¢ã€æ’å…¥ã€åˆ é™¤æ“ä½œ**ã€‚é™¤æ­¤ä¹‹å¤–ï¼ŒRedisè¿˜åˆ©ç”¨HASHTABLEç»“æ„å®ç°åœ¨$O(1)$æ—¶é—´å¤æ‚åº¦ä¸‹**æŸ¥è¯¢åˆ°ZSetä¸­ä»»ä¸€æˆå‘˜çš„`score`å€¼**\n","source":"_posts/Redis/Rediså¯¹è±¡.md","raw":"---\ntitle: Rediså¯¹è±¡\npublish: true\ndescription: è®°å½•Rediså¯¹è±¡çŸ¥è¯†ç‚¹\ntag: \n- Redis\n- æ•°æ®ç»“æ„\nsticky: 2\n---\n\n# Rediså¯¹è±¡\n\n## String\n\nStringå°±æ˜¯å­—ç¬¦ä¸²ï¼Œæ˜¯Redisä¸­çš„ä¸€ä¸ªæœ€åŸºæœ¬æ•°æ®å¯¹è±¡ï¼Œæœ€å¤§å­˜å‚¨æ•°æ®**512MB**\n\n### Setæ“ä½œ\n\nåŸºæœ¬è¯­æ³•ï¼š**`set key value [expiration EX seconds | PX milliseconds] [NX|XX]`**\n\nSetæ“ä½œç”¨äºåœ¨Redisä¸­è®¾ç½®ä¸€ä¸ªK-Vå¯¹ï¼Œå…¶ä¸­å‡ ä¸ªæ‰©å±•å‚æ•°ä½œç”¨åˆ†åˆ«å¦‚ä¸‹ï¼š\n\n- **EX seconds**ï¼šè®¾ç½®K-Vå¯¹çš„è¿‡æœŸæ—¶é—´ä¸ºå¤šå°‘ç§’\n- **PX milliseconds**ï¼šè®¾ç½®K-Vå¯¹çš„è¿‡æœŸæ—¶é—´ä¸ºå¤šå°‘æ¯«ç§’\n- **NX**ï¼šåªæœ‰å½“Keyä¸å­˜åœ¨æ—¶ï¼Œå‘½ä»¤æ‰ç”Ÿæ•ˆï¼Œç›¸å½“äº`setnx key value`\n- **XX**ï¼šåªæœ‰å½“Keyå­˜åœ¨æ—¶ï¼Œå‘½ä»¤æ‰ç”Ÿæ•ˆ\n\nâš ï¸ï¼šå¯¹ä¸€ä¸ªå·²ç»å­˜åœ¨Keyè¿›è¡Œsetæ“ä½œä¼š**å°†åŸæœ‰å€¼è¦†ç›–**ï¼Œå¯èƒ½ä¼šå¯¼è‡´**åŸæœ‰å€¼ä¸¢å¤±ã€æ“¦é™¤è¿‡æœŸæ—¶é—´ã€ä¸¢å¤±åŸæœ‰å€¼ç±»å‹**\n\n### ä¸‰ç§ç¼–ç æ–¹å¼\n\nStringå¯¹è±¡åº•å±‚é‡‡ç”¨ä¸‰ç§ä¸åŒçš„ç¼–ç æ–¹å¼ä»¥é«˜æ•ˆåº”å¯¹å„ç§åœºæ™¯\n\n- **INTç¼–ç **ï¼šç”¨äºå­˜å‚¨longèŒƒå›´å†…çš„**æ•´æ•°**\n  - âš ï¸ï¼šå¦‚æœæ˜¯æµ®ç‚¹æ•°ï¼Œåˆ™ä¸èƒ½ä½¿ç”¨INTç¼–ç ã€‚å› ä¸ºINTç¼–ç åªèƒ½ç”¨äºè¡¨ç¤ºæ•´æ•°\n- **EMBSTRç¼–ç **ï¼šå¦‚æœå­—ç¬¦ä¸²çš„å¤§å°å°äºé˜ˆå€¼å­—èŠ‚ï¼Œåˆ™é‡‡ç”¨æ­¤æ–¹å¼\n- **RAWç¼–ç **ï¼šå¦‚æœå­—ç¬¦ä¸²çš„å¤§å°å¤§äºé˜ˆå€¼å­—èŠ‚ï¼Œåˆ™é‡‡ç”¨æ­¤æ–¹å¼\n\nEMBSTRç¼–ç å’ŒRAWç¼–ç æ–¹å¼åœ¨åº•å±‚å®ç°ä¸­éƒ½æ˜¯ç”±redisObjectå’ŒSDSä¸¤ä¸ªç»“æ„ç»„æˆï¼ŒåŒºåˆ«åœ¨äº**è¿™ä¸¤ä¸ªç»“æ„åœ¨ç‰©ç†å†…å­˜ä¸Šæ˜¯å¦è¿ç»­ï¼ˆä¸ºä¸€æ•´ä½“ï¼‰**\n\nEMBSTRåœ¨å†…å­˜ä¸­çš„è¡¨ç¤ºï¼š\n\n![image-20241003100407308](https://raw.githubusercontent.com/lyydsheep/pic/main/202410031004350.png)\n\nRAWåœ¨å†…å­˜ä¸­çš„è¡¨ç¤ºï¼š\n\n![image-20241003100440097](https://raw.githubusercontent.com/lyydsheep/pic/main/202410031004128.png)\n\n#### ä¸‰ç§ç¼–ç æ–¹å¼çš„è½¬æ¢å…³ç³»\n\néšç€å¯¹Redisçš„æ“ä½œï¼ŒStringå¯¹è±¡çš„ç¼–ç æ–¹å¼å¯èƒ½æœ‰å¦‚ä¸‹å˜åŒ–ï¼š\n\nINT --> RAWï¼šå½“å­˜å‚¨çš„å†…å®¹ä¸å†æ˜¯æ•´æ•°æˆ–å¤§å°è¶…è¿‡longèŒƒå›´ï¼Œåˆ™éœ€è¦å°†INTç¼–ç è½¬æ¢ä¸ºRAWç¼–ç \n\nEMBSTR --> RAWï¼šç”±äºEMBSTRç¼–ç çš„Stringå¯¹è±¡æ˜¯**åªè¯»**çš„ï¼Œæ‰€ä»¥å¯¹ä¸€ä¸ªEMBSTRè¿›è¡Œå†™æ“ä½œæ—¶ï¼Œå°±ä¼šå°†å…¶ç¼–ç æ–¹å¼æ”¹ä¸ºRAWã€‚è¿™æ˜¯å› ä¸ºä¿®æ”¹æ•°æ®å°±è¦é‡æ–°åˆ†é…å­˜å‚¨ç©ºé—´ï¼Œè€ŒEMBSTRä¸­redisObjectå’ŒSDSæ˜¯è¿ç»­çš„ï¼Œä¸æ˜“åˆ†é…ç©ºé—´ã€‚å¹¶ä¸”åªè¦è¿›è¡Œä¿®æ”¹æ“ä½œé‚£ä¹ˆå°±èƒ½è®¤ä¸ºè¿™ä¸ªStringæ˜¯æ˜“å˜çš„ã€ä¸ç¨³å®šçš„ï¼Œé‡‡ç”¨RAWç¼–ç æ–¹å¼èƒ½å¤Ÿå‡å°‘é¢‘ç¹å¯¹EMBSTRå†…å­˜åˆ†é…çš„æ€§èƒ½æŸè€—\n\n### SDSç»“æ„\n\nä¸ç®¡æ˜¯EMBSTRè¿˜æ˜¯RAWï¼Œéƒ½æœ‰ä¸€ä¸ªSDSç»“æ„ï¼ŒSDSç»“æ„æ˜¯ä¸ºäº†è§£å†³Cè¯­è¨€ä¸­å­—ç¬¦ä¸²çš„å°´å°¬å¤„å¢ƒ\n\n- è®¡ç®—å­—ç¬¦ä¸²é•¿åº¦éœ€è¦éå†ï¼Œæ—¶é—´å¤æ‚åº¦$$O(n)$$\n- å¯¹å­—ç¬¦ä¸²è¿½åŠ å†…å®¹éœ€è¦æ‰©å®¹æ“ä½œ\n- äºŒè¿›åˆ¶ä¸å®‰å…¨\n  - äºŒè¿›åˆ¶å®‰å…¨æ˜¯æŒ‡å…¬å¹³å¯¹å¾…æ¯ä¸€ä¸ªå­—ç¬¦ï¼Œä¸ç‰¹æ®Šå¤„ç†ä»»ä½•å­—ç¬¦\n  - Cè¯­è¨€ä¸­å­—ç¬¦ä¸²ç‰¹æ®Šå¤„ç†`\\0`ä¸ºå­—ç¬¦ä¸²ç»“å°¾\n\nSDSç»“æ„å…·ä½“ç”±ä¸€ä¸‹å­—æ®µç»„æˆï¼š\n\n```C\nstruct __attribute__ ((__packed__)) sdshdr8 {\n    uint8_t len;\n    uint8_t alloc;\n    unsigned char flags;\n    char buf[];\n}\n```\n\n- **len**ï¼šè¡¨ç¤ºå­—ç¬¦ä¸²é•¿åº¦ï¼Œ**å¯ä»¥å¿«é€Ÿè¿”å›å­—ç¬¦ä¸²é•¿åº¦ï¼Œå¹¶ä¸”ä¸éœ€è¦`\\0`ä½œä¸ºç»“å°¾ç¬¦å·**\n- **alloc**ï¼šè¡¨ç¤ºåˆ†é…äº†å¤šå°‘å†…å­˜ç©ºé—´ï¼Œ**å…·æœ‰ä¸€å®šçš„é¢„ç•™ç©ºé—´ï¼Œæ— éœ€è¿›è¡Œæ‰©å®¹æ“ä½œ**\n- **flags**ï¼šç”¨äºåŒºåˆ†å…·ä½“æ˜¯ä»€ä¹ˆç±»å‹çš„SDS\n  - åœ¨Redisä¸­SDSåˆ†ä¸ºsdshdr8ã€sdshdr16ã€sdshdr32ã€sdshdr64\n\n## List\n\n3.2ç‰ˆæœ¬ä¹‹å‰ï¼ŒListå¯¹è±¡æœ‰ä¸¤ç§ç¼–ç æ–¹å¼\n\n- ZIPLIST\n- LINKLIST\n\nå½“æ»¡è¶³ä»¥ä¸‹æ¡ä»¶æ—¶ï¼Œé‡‡ç”¨ZIPLISTç¼–ç æ–¹å¼\n\n- åˆ—è¡¨å¯¹è±¡ä¸­æ‰€æœ‰å­˜å‚¨çš„å­—ç¬¦ä¸²å¯¹è±¡é•¿åº¦éƒ½å°äº64å­—èŠ‚\n- åˆ—è¡¨å¯¹è±¡ä¸­å­˜å‚¨çš„å¯¹è±¡æ•°é‡ä¸è¶…è¿‡512ä¸ªï¼ˆè¿™æ˜¯LISTçš„é™åˆ¶ï¼Œè€Œä¸æ˜¯ZIPLISTçš„é™åˆ¶ï¼‰\n\nğŸŒ°ï¼š\n\n![image-20241005112548274](https://raw.githubusercontent.com/lyydsheep/pic/main/202410051125337.png)\n\nZIPLISTä¸­æ•°æ®éƒ½æ˜¯ç´§å¯†æ’åˆ—çš„ï¼Œåœ¨æ•°æ®é‡å°çš„æ—¶å€™å¯ä»¥æœ‰æ•ˆèŠ‚çº¦å†…å­˜ï¼›è€ŒLINKLISTé¡¾åæ€ä¹‰ï¼Œæ•°æ®æ˜¯ä»¥é“¾è¡¨å½¢å¼ä¸²è”èµ·æ¥çš„ï¼Œåœ¨æ•°æ®é‡å¤§çš„æ—¶å€™é‡‡ç”¨LINKLISTç¼–ç å¯ä»¥åŠ å¿«å¤„ç†æ€§èƒ½\n\nğŸŒ°ï¼š\n\n![image-20241005112658713](https://raw.githubusercontent.com/lyydsheep/pic/main/202410051126746.png)\n\n### QUICKLIST\n\nZIPLISTåœ¨æ•°æ®è¾ƒå°‘æ—¶èŠ‚çº¦å†…å­˜ï¼ŒLINKLISTæ˜¯ä¸ºäº†åœ¨æ•°æ®è¾ƒå¤šæ—¶æé«˜æ›´æ–°æ•ˆç‡ã€‚ä½†æ˜¯ZIPLISTåœ¨æ•°æ®ç¨å¤šæ—¶æ’å…¥æ•°æ®ä¼šå¯¼è‡´å¤§é‡æ•°æ®å¤åˆ¶ï¼Œå ç”¨å†…å­˜ç©ºé—´ï¼›åŒæ ·åœ°ï¼ŒLINKLISTç”±äºèŠ‚ç‚¹æ•°é‡ä¹Ÿå¼‚å¸¸å¤šï¼Œä¹Ÿä¼šå ç”¨ä¸å°‘å†…å­˜\n\nåŸºäºä¸Šè¿°é—®é¢˜ï¼Œ3.2ç‰ˆæœ¬å°±å¼•å…¥äº†QUICKLISTã€‚QUICKLISTæœ¬è´¨å°±æ˜¯**ZIPLISTå’ŒLINKLISTçš„ç»“åˆä½“**\n\nQUICKLISTçš„å®ç°æ€è·¯æ˜¯ï¼Œå°†åŸæœ¬LINKLISTçš„**å•ä¸ªèŠ‚ç‚¹å­˜å‚¨å•ä¸ªæ•°æ®**çš„æ¨¡å¼ï¼Œæ›´æ¢æˆä¸€ä¸ª**å•ä¸ªèŠ‚ç‚¹ï¼ˆZIPLISTï¼‰å­˜å‚¨å¤šä¸ªæ•°æ®**çš„å½¢å¼\n\n![image-20241005113525108](https://raw.githubusercontent.com/lyydsheep/pic/main/202410051135173.png)\n\nå½“æ•°æ®è¾ƒå°‘æ—¶ï¼ŒQUICKLISTèŠ‚ç‚¹åªæœ‰ä¸€ä¸ªï¼Œé€€åŒ–æˆZIPLIST\n\nå½“æ•°æ®è¾ƒå¤šæ—¶ï¼Œåˆ™åŒæ—¶åˆ©ç”¨äº†ZIPLISTå’ŒLINKLISTçš„ä¼˜åŠ¿\n\n## å‹ç¼©åˆ—è¡¨\n\nå‹ç¼©åˆ—è¡¨ä½œä¸ºListçš„åº•å±‚æ•°æ®ç»“æ„ï¼Œæä¾›äº†ç´§å‡‘å‹çš„æ•°æ®å­˜å‚¨æ–¹å¼ï¼Œèƒ½èŠ‚çº¦å†…å­˜ï¼Œå°æ•°æ®é‡çš„æ—¶å€™éå†è®¿é—®æ€§èƒ½å¥½ï¼ˆè¿ç»­+å±€éƒ¨æ€§ä¼˜åŠ¿ï¼‰\n\n### ZIPLISTæ•´ä½“ç»“æ„\n\nåœ¨Redisä»£ç æ³¨é‡Šä¸­ï¼Œæœ‰å¯¹ZIPLISTæ¸…æ™°åœ°æè¿°ï¼š\n\n```c\n/* The general layout of the ziplist is as follows:\n\n<zlbytes> <zltail> <zllen> <entry> <entry> <entry> ... <entry> <zlend>\n*/\n```\n\nğŸŒ°ï¼šä¸€ä¸ªå…·æœ‰ä¸‰ä¸ªèŠ‚ç‚¹çš„ZIPLIST\n\n![image-20241008161508590](https://raw.githubusercontent.com/lyydsheep/pic/main/202410081615659.png)\n\n**zlbytes**å­—æ®µè¡¨ç¤ºè¯¥ZIPLISTä¸€å…±å ç”¨äº†å¤šå°‘å­—èŠ‚ï¼ˆåŒ…å«zlbyteså­—æ®µçš„å¤§å°ï¼‰\n\n**zltail**å­—æ®µè¡¨ç¤ºæœ€åä¸€ä¸ª**æ•°æ®èŠ‚ç‚¹ï¼ˆentryï¼‰**è·ç¦»ZIPLISTé¦–éƒ¨çš„åç§»å­—èŠ‚æ•°ï¼Œå¦‚æœZIPLISTä¸ºç©ºï¼ˆå³æœ¨æœ‰entryï¼‰ï¼Œåˆ™æŒ‡ç¤º**zlend**å­—æ®µçš„åç§»é‡\n\n> å¾ˆæ˜¾ç„¶ï¼Œä¼šæœ‰å¦‚ä¸‹ç­‰å¼ï¼š\n>\n> zlbytes = zltial + æœ€åä¸€ä¸ªentryå¤§å°ï¼ˆå¯èƒ½ä¸ºé›¶ï¼‰ + zlendå¤§å°\n\n**zllen**å­—æ®µè¡¨ç¤ºZIPLISTç»“æ„ä¸­entryçš„ä¸ªæ•°ï¼Œä½†ç”±äºè¯¥å­—æ®µåªå ç”¨2å­—èŠ‚ç©ºé—´ï¼Œæ‰€ä»¥æœ€å¤šåªèƒ½è¡¨ç¤º65535ä¸ªã€‚å½“å…ƒç´ ä¸ªæ•°è¿‡å¤šï¼Œåªèƒ½é€šè¿‡**éå†**çš„æ–¹å¼è·å–å…ƒç´ ä¸ªæ•°\n\n**zlend**å­—æ®µæ˜¯ä¸€ä¸ªç‰¹æ®ŠèŠ‚ç‚¹ï¼Œæ ‡è¯†ZIPLISTç»“æ„çš„ç»“æŸ\n\n**entry**å­—æ®µè¡¨ç¤ºä¸€ä¸ªæ•°æ®èŠ‚ç‚¹ï¼Œå®é™…ä¸Šä¹Ÿæ˜¯ä¸€ä¸ªç»“æ„ä½“ç±»å‹ã€‚è¯¥ç±»å‹ç”±ä¸‰ä¸ªå­—æ®µæ„æˆï¼Œåˆ†åˆ«æ˜¯\n\n```c\n<prevlen> <encoding> <entry-data>\n```\n\n### entryç»“æ„\n\n**`prevlen`**å­—æ®µè¡¨ç¤º**ä¸Šä¸€ä¸ªæ•°æ®èŠ‚ç‚¹ï¼ˆentryï¼‰çš„é•¿åº¦**ï¼Œå¦‚æœé•¿åº¦**å°äº254**ï¼Œé‚£ä¹ˆ**`prevlen`**å­—æ®µå ç”¨1å­—èŠ‚ç©ºé—´ï¼›å¦‚æœé•¿åº¦**å¤§äºç­‰äº254**ï¼Œé‚£ä¹ˆè¯¥å­—æ®µéœ€è¦ç”¨5å­—èŠ‚ç©ºé—´è¡¨ç¤ºï¼Œå¹¶ä¸”**ç¬¬ä¸€ä¸ªå­—èŠ‚ä¸º11111110**ï¼Œè¡¨ç¤ºè¿™æ˜¯ä¸€ä¸ª5å­—èŠ‚çš„`prevlen`ä¿¡æ¯ï¼Œå‰©ä¸‹çš„4å­—èŠ‚ç”¨æ¥è¡¨ç¤ºé•¿åº¦\n\nâš ï¸ï¼šä¸ºä»€ä¹ˆé˜ˆå€¼æ˜¯254è€Œä¸æ˜¯255ï¼Ÿè¿™æ˜¯å› ä¸º255è¢«ç”¨æ¥ç‰¹æ®Šè¡¨ç¤º**zlend**å­—æ®µï¼Œæ ‡è¯†ZIPLISTç»“æ„çš„ç»“æŸ\n\n**`encoding`**å­—æ®µæ˜¯ä¸€ä¸ªæ•´å½¢æ•°æ®ï¼Œå…¶äºŒè¿›åˆ¶ç¼–ç ç”±**å†…å®¹ç±»å‹**å’Œ**å†…å®¹æ•°æ®çš„å­—èŠ‚é•¿åº¦**ä¸¤éƒ¨åˆ†ç»„æˆ\n\n### è¿é”æ›´æ–°\n\nå½“å‘ä¸€ä¸ªentryå‰é¢æ’å…¥ä¸€ä¸ªé•¿åº¦è¶…è¿‡254çš„èŠ‚ç‚¹æ—¶ï¼Œ`prevlen`å­—æ®µå¯èƒ½å°±ä¼šç”±1å­—èŠ‚å˜æˆ5å­—èŠ‚ï¼Œå¯¼è‡´æœ¬entryé•¿åº¦å¢å¤§ã€‚å¦‚æœè¿æ°”ä¸æ˜¯å¾ˆå¥½ï¼Œå°†ä¼šå¯¼è‡´ä¸‹ä¸€ä¸ªèŠ‚ç‚¹ä¸­çš„`prevlen`å­—æ®µå¢åŠ ï¼Œä»¥æ­¤ç±»æ¨ï¼Œé€ æˆè¿é”ååº”ï¼Œè¿™å°±æ˜¯è¿é”æ›´æ–°é—®é¢˜ã€‚\n\n![image-20241008185552935](https://raw.githubusercontent.com/lyydsheep/pic/main/202410081855045.png)\n\n#### LISTPACKä¼˜åŒ–\n\n`prevlen`å­—æ®µæ­£æ˜¯è¿é”æ›´æ–°çš„ç½ªé­ç¥¸é¦–ï¼Œä¸ºäº†è§£å†³è¿é”æ›´æ–°é—®é¢˜ï¼Œå°±ä¸èƒ½å†å»è®°å½•ä¸Šä¸€ä¸ªèŠ‚ç‚¹çš„é•¿åº¦ï¼Œä½†åˆè¦ä¿è¯èƒ½å¤Ÿå®ç°å€’åºéå†ï¼ˆæ‰¾åˆ°ä¸Šä¸€ä¸ªèŠ‚ç‚¹çš„ä½ç½®ï¼‰\n\nRedisä½¿ç”¨äº†ä¸€ç§å·§å¦™çš„æ–¹æ³•ï¼šåˆ é™¤`prevlen`å­—æ®µï¼Œ**æ–°å¢`element-tot-len`å­—æ®µè®°å½•æ•´ä¸ªèŠ‚ç‚¹é™¤å®ƒï¼ˆelement-tot-lenå­—æ®µï¼‰è‡ªèº«ä¹‹å¤–çš„é•¿åº¦**\n\næ­¤æ—¶èŠ‚ç‚¹ç»“æ„å°±å˜æˆäº†ï¼š\n\n```c\n<encoding-type> <element-data> <element-top-len>\n```\n\n- encoding-typeæ˜¯ç¼–ç ç±»å‹\n- element-dataæ˜¯æ•°æ®å†…å®¹\n- element-top-lenæ‰€å çš„æ¯ä¸ªå­—èŠ‚çš„ç¬¬ä¸€ä¸ªbitä½ç”¨äºæ ‡è¯†æ˜¯å¦ç»“æŸï¼Œ0åˆ™ç»“æŸï¼Œ1åˆ™ç»§ç»­\n\nğŸŒ°ï¼š![image-20241008190334625](https://raw.githubusercontent.com/lyydsheep/pic/main/202410081903663.png)\n\n## Set\n\nRediä¸­çš„setæ˜¯ä¸€ä¸ªä¸é‡å¤ã€æ— åºçš„å­—ç¬¦ä¸²é›†åˆ\n\n> å¦‚æœSetåº•å±‚ä½¿ç”¨INTSETç¼–ç æ–¹å¼ï¼Œåˆ™é›†åˆæ˜¯æœ‰åºçš„\n\n### ç¼–ç æ–¹å¼ \n\nSetåº•å±‚æœ‰ä¸¤ç§ç¼–ç æ–¹å¼ï¼š**INTSETã€HASHTABLE**\n\nå½“Setä¸­å­˜å‚¨çš„éƒ½æ˜¯æ•´æ•°å¹¶ä¸”å…ƒç´ ä¸ªæ•°å°‘äº512ä¸ªæ—¶ï¼Œåˆ™é‡‡ç”¨INTSETç¼–ç æ–¹å¼\n\n![image-20241009154144626](https://raw.githubusercontent.com/lyydsheep/pic/main/202410091541699.png)\n\nç”±ä¸Šå›¾å¯è§ï¼Œé‡‡ç”¨INTSETç¼–ç ï¼Œå…ƒç´ æ’åˆ—æ¯”è¾ƒç´§å‡‘ï¼Œå†…å­˜å ç”¨å°‘ï¼Œä½†æŸ¥æ‰¾æ—¶éœ€è¦ä½¿ç”¨äºŒåˆ†æ³•ï¼Œæ—¶é—´å¤æ‚åº¦ä¸º$O(nlogn)$\n\nå¦‚æœä¸æ»¡è¶³INTSETç¼–ç æ¡ä»¶ï¼Œåˆ™éœ€è¦ä½¿ç”¨HASHTABLEç¼–ç ï¼ŒHASHTABLEæŸ¥è¯¢ä¸€ä¸ªå…ƒç´ æ€§èƒ½å¾ˆé«˜ï¼Œæ—¶é—´å¤æ‚åº¦ä¸º$O(1)$\n\n![image-20241009154437973](https://raw.githubusercontent.com/lyydsheep/pic/main/202410091544018.png)\n\nç®€å•åœ°æ¦‚æ‹¬ï¼š\n\n- INTSETç¼–ç é€‚ç”¨äºå­˜å‚¨å°‘é‡æ•´æ•°åœºæ™¯ä»¥èŠ‚çº¦å†…å­˜ç©ºé—´\n- HASHTABLEç¼–ç é€‚ç”¨äºå¿«é€Ÿå®šä½æŸä¸ªå…ƒç´ çš„ä½ç½®\n\n## Hash\n\n// to do\n\npanic(\"implement me\")\n\n## HashTable\n\n>  HAHSTABLEæ˜¯Redisä¸­çš„ä¸€ç§åº•å±‚æ•°æ®ç»“æ„\n\né€šè¿‡HASHTABLEå¯ä»¥åœ¨$O(1)$æ—¶é—´å¤æ‚åº¦å†…å¿«é€Ÿå®šä½åˆ°Keyå¯¹äºçš„Value\n\n### ç»“æ„\n\næ€»æ‰€å‘¨çŸ¥ï¼ŒRedisæ˜¯ç”¨Cè¯­è¨€å®ç°çš„ã€‚HASHTABLEçš„Cå®ç°æ¶‰åŠåˆ°ä¸‰ä¸ªç»“æ„ä½“ï¼š`dict`ã€`dictht`ã€`dicEntry`\n\nç®€å•åœ°è¯´ï¼Œ`dict`å°è£…äº†ä¸¤ä¸ª`dictht`ç»“æ„ï¼Œæ¯ä¸€ä¸ª`dictht`ç»“æ„éƒ½æœ‰ä¸€ä¸ªå¤§å°ä¸º`size`çš„**bucket**ï¼Œbucketä¸­å­˜æ”¾ç€`dicEntry`é“¾è¡¨ã€‚ä¸‰ä¸ªç»“æ„ä½“ä¹‹é—´çš„å…³ç³»å¦‚ä¸‹å›¾æ‰€ç¤ºï¼š\n\n<img src=\"https://raw.githubusercontent.com/lyydsheep/pic/main/202410122043279.png\" alt=\"image-20241012204338184\" style=\"zoom:67%;\" />\n\nå¯ä»¥çœ‹åˆ°dictç»“æ„ä¸­æœ‰ä¸¤ä¸ªdicthtç»“æ„ï¼Œä¹Ÿå°±æ˜¯HASHTABLEç»“æ„ã€‚dicEntryæ˜¯é“¾è¡¨ç»“æ„ï¼Œé€šè¿‡æ‹‰é“¾æ³•è§£å†³Hashå†²çª\n\næ¥ä¸‹æ¥ï¼Œç»“åˆæºç jè§£é‡Šæ¯ä¸€ä¸ªç»“æ„ä½“çš„å­—æ®µå«ä¹‰ï¼š\n\n```c\ntypedef struct dict{\n    dictType *type; //ç›´çº¿dictTypeç»“æ„ï¼ŒdictTypeç»“æ„ä¸­åŒ…å«è‡ªå®šä¹‰çš„å‡½æ•°ï¼Œè¿™äº›å‡½æ•°ä½¿å¾—keyå’Œvalueèƒ½å¤Ÿå­˜å‚¨ä»»ä½•ç±»å‹çš„æ•°æ®\n    void *privdata; //ç§æœ‰æ•°æ®ï¼Œä¿å­˜ç€dictTypeç»“æ„ä¸­å‡½æ•°çš„ å‚æ•°\n    dictht ht[2]; //ä¸¤å¼ å“ˆå¸Œè¡¨\n    long rehashidx; //rehashçš„æ ‡è®°ï¼Œrehashidx=-1è¡¨ç¤ºæ²¡æœ‰è¿›è¡Œrehashï¼Œrehashæ—¶æ¯è¿ç§»ä¸€ä¸ªæ¡¶å°±å¯¹rehashidxåŠ ä¸€\n    int itreators;  //æ­£åœ¨è¿­ä»£çš„è¿­ä»£å™¨æ•°é‡\n}\n```\n\n```c\n#dictç»“æ„ä¸­ht[0]ã€ht[1]å“ˆå¸Œè¡¨çš„æ•°æ®ç»“æ„\ntypedef struct dictht{\n    dictEntry[] table;        //å­˜æ”¾ä¸€ä¸ªæ•°ç»„çš„åœ°å€ï¼Œæ•°ç»„ä¸­å­˜æ”¾å“ˆå¸ŒèŠ‚ç‚¹dictEntryçš„åœ°å€\n    unsingned long size;      //å“ˆå¸Œè¡¨tableçš„å¤§å°ï¼Œå‡ºå§‹å¤§å°ä¸º4\n    unsingned long  sizemask; //ç”¨äºå°†hashå€¼æ˜ å°„åˆ°tableä½ç½®çš„ç´¢å¼•ï¼Œå¤§å°ä¸ºï¼ˆsize-1ï¼‰\n    unsingned long  used;     //è®°å½•å“ˆå¸Œè¡¨å·²æœ‰èŠ‚ç‚¹ï¼ˆé”®å€¼å¯¹ï¼‰çš„æ•°é‡\n}\n```\n\n```c\n#å“ˆå¸Œè¡¨èŠ‚ç‚¹ç»“æ„å®šä¹‰\ntypedef struct dictEntity{\n    void *key;//é”®\n    //å€¼\n    union{\n        //â€œæˆ‘ä¹‹æ‰€ä»¥è¦æé†’ä½ æ³¨æ„è¿™é‡Œï¼Œå…¶å®æ˜¯ä¸ºäº†è¯´æ˜ï¼Œè¿™ç§å®ç°æ–¹æ³•æ˜¯ä¸€ç§èŠ‚çœå†…å­˜çš„å¼€å‘å°æŠ€å·§ï¼Œéå¸¸å€¼å¾—å­¦ä¹ ã€‚å› ä¸ºå½“å€¼ä¸ºæ•´æ•°æˆ–åŒç²¾åº¦æµ®ç‚¹æ•°æ—¶ï¼Œç”±äºå…¶æœ¬èº«å°±æ˜¯ 64 ä½ï¼Œå°±å¯ä»¥ä¸ç”¨æŒ‡é’ˆæŒ‡å‘äº†ï¼Œè€Œæ˜¯å¯ä»¥ç›´æ¥å­˜åœ¨é”®å€¼å¯¹çš„ç»“æ„ä½“ä¸­ï¼Œè¿™æ ·å°±é¿å…äº†å†ç”¨ä¸€ä¸ªæŒ‡é’ˆï¼Œä»è€ŒèŠ‚çœäº†å†…å­˜ç©ºé—´ã€‚â€\n        void *val;//è‡ªå®šä¹‰ç±»å‹\n        uint64_t u64;//æ— ç¬¦å·æ•´å½¢\n        int64_t s64;//ç¬¦åˆæ•´å½¢\n        double d;//æµ®ç‚¹å‹\n    } v;\n    struct dictEntity *next;//å‘ç”Ÿå“ˆå¸Œå†²çªæ—¶ä½¿ç”¨ã€‚æŒ‡å‘ä¸‹ä¸€ä¸ªå“ˆå¸Œè¡¨èŠ‚ç‚¹ï¼Œå½¢æˆé“¾è¡¨\n}\n```\n\n### HashTableæ¸è¿›å¼æ‰©å®¹\n\næ¸è¿›å¼æ‰©å®¹ï¼Œé¡¾åæ€ä¹‰å°±æ˜¯ä¸€ç‚¹ä¸€ç‚¹æ‰©å®¹å®¹é‡ã€‚ç›¸æ¯”äºä¸€æ¬¡æ€§æ‰©å®¹å¤§é‡ç©ºé—´ï¼Œå¹¶è¿›è¡Œå¤§é‡çš„æ‹·è´å·¥ä½œï¼Œæ¸è¿›å¼æ‰©å®¹ä¸æ˜“å¯¼è‡´Redisåœ¨ä¸€æ®µæ—¶é—´å†…ç”±äºè¿›è¡Œæ‰©å®¹å·¥ä½œè€Œæ— æ³•æä¾›å…¶ä»–æœåŠ¡ï¼Œç”¨æˆ·ä½“éªŒæ„Ÿæ›´å¥½ã€‚\n\nå½“dictæ»¡è¶³æ‰©å®¹æ¡ä»¶åï¼Œå°±ä¼šè¿›è¡ŒRehashæ“ä½œã€‚Rehashæ“ä½œå¤§è‡´åˆ†ä¸ºä¸‰æ­¥ï¼š\n\n- ä¸º**ht[1]**å“ˆå¸Œè¡¨å¼€è¾Ÿä¸€å—ç©ºé—´ï¼Œç©ºé—´å¤§å°è®¾å®šä¸º**ç¬¬ä¸€ä¸ªå¤§äº2 * ht[0]çš„2æ•´æ•°æ¬¡å¹‚**ã€‚ğŸŒ°ï¼šh[0] = 500ï¼Œé‚£ä¹ˆåœ¨è¿›è¡ŒRehashæ“ä½œæ—¶å¼€è¾Ÿçš„ç©ºé—´ä¸º$2^{\\left\\lceil log_2(2*500) \\right\\rceil} = 1024$\n\n- è¿ç§»ht[0]æ•°æ®è‡³ht[1]ï¼šåœ¨RehashæœŸé—´ï¼Œæ¯æ¬¡å¯¹å­—å…¸è¿›è¡Œå¢åˆ æ”¹æŸ¥æ“ä½œï¼Œç¨‹åºä¼šé¡ºå¸¦è¿ç§»å½“å‰`rehashidx`æ‰€æŒ‡å‘çš„æ•°æ®ï¼Œå¹¶é€’å¢ä¸‹æ ‡å€¼ã€‚å¦‚æœå½“å‰`rehashidx`å‘½ä¸­äº†ä¸€ä¸ªç©ºä½ç½®ï¼Œåˆ™ä¼šå…ˆå°è¯•ç»§ç»­å¾€åæŸ¥æ‰¾è‹¥å¹²ä½ç½®ï¼Œå¦‚æœæŸ¥è¯¢æ— æœå°±ç›´æ¥è¿”å›\n- æœ€ç»ˆï¼Œht[0]çš„æ•°æ®å°†ä¼šå…¨éƒ¨è¿ç§»è‡³ht[1]ä¸­ã€‚æ­¤æ—¶ï¼Œéœ€è¦äº¤æ¢ht[0]å’Œht[1]çš„æŒ‡é’ˆï¼Œå¹¶å°†`rehash`è®¾ä¸º-1ï¼Œè¡¨ç¤ºå¤„äºéRehashçŠ¶æ€\n  - ä¸ºä»€ä¹ˆè¦äº¤æ¢ä¸¤å¼ å“ˆå¸Œè¡¨çš„æŒ‡é’ˆå‘¢ï¼Ÿå› ä¸ºht[0]ä»£è¡¨ç€æ­£åœ¨ä½¿ç”¨çš„å“ˆå¸Œè¡¨\n\n<img src=\"https://raw.githubusercontent.com/lyydsheep/pic/main/202410122114045.png\" alt=\"image-20241012211414978\" style=\"zoom:80%;\" />\n\nâš ï¸ï¼šå€¼å¾—æ³¨æ„çš„æ˜¯ï¼Œåœ¨Rehashé˜¶æ®µï¼Œç”±äºå­˜åœ¨ä¸¤å¼ å“ˆå¸Œè¡¨ï¼Œæ­¤æ—¶è¿›è¡Œçš„åˆ é™¤ã€æŸ¥æ‰¾ã€æ›´æ–°æ“ä½œä¼šåœ¨ä¸¤ä¸ªè¡¨ä¸Šè¿›è¡Œã€‚æ¯”å¦‚æŸ¥æ‰¾å…ƒç´ æ—¶ï¼Œå¦‚æœht[0]è¡¨æ²¡æœ‰æ‰¾åˆ°ï¼Œåˆ™ä¼šæ¥ç€æŸ¥è¯¢ht[1]è¡¨ã€‚ä½†è¿›è¡Œæ’å…¥æ“ä½œæ—¶ï¼Œåªä¼šåœ¨ht[1]è¡¨ä¸Šå¢æ·»æ•°æ®\n\n### æ‰©ï¼ˆç¼©ï¼‰å®¹æ—¶æœº\n\nHASHTABLEç”±ä¸€ä¸ªå˜é‡â€”â€”**è´Ÿè½½å› å­**å†³å®šæ˜¯å¦æ‰©å®¹ï¼ˆç¼©å®¹ï¼‰\n\n**è´Ÿè½½å› å­çš„ç®—æ³•ï¼š`ht[0].used / ht[0].size`**\n\n**æ‰©å®¹åœºæ™¯ï¼š**\n\n- è´Ÿè½½å› å­å¤§äºç­‰äº1å¹¶ä¸”æ­¤æ—¶æœåŠ¡å™¨æ²¡æœ‰æ‰§è¡ŒBGSAVEæˆ–BGREWRITEAOFè¿™ä¸¤ä¸ªå‘½ä»¤\n- è´Ÿè½½å› å­å¤§äº5\n\n**ç¼©å®¹åœºæ™¯ï¼š**\n\n- è´Ÿè½½å› å­å°äº0.1å¹¶ä¸”æ²¡æœ‰BGSAVEæˆ–BGWRITEAOFå‘½ä»¤åœ¨æ‰§è¡Œ\n\n## SkipList\n\n## è·³è¡¨çš„ç»“æ„\n\nè·³è¡¨æ˜¯Redisä¸­ZSETçš„åº•å±‚æ•°æ®ç»“æ„ï¼Œè·³è¡¨æœ¬è´¨ä¸Šå°±æ˜¯ç”±**é“¾è¡¨+å¤šçº§ç´¢å¼•**ç»„æˆçš„\n\nä½†Redisä½¿ç”¨çš„è·³è¡¨å¹¶éæ ‡å‡†è·³è¡¨ï¼ŒRedisä¸­çš„è·³è¡¨åœ¨æ ‡å‡†è·³è¡¨åŸºç¡€ä¹‹ä¸Š**å…è®¸scoreå€¼é‡å¤**ä»¥åŠ**0å±‚èŠ‚ç‚¹å…·æœ‰å‘åæŒ‡é’ˆ**ï¼Œå¦‚ä¸‹å›¾æ‰€ç¤ºï¼š\n\n<img src=\"https://raw.githubusercontent.com/lyydsheep/pic/main/202410141047754.png\" alt=\"image-20241014104743623\" style=\"zoom:67%;\" />\n\nå…¶ä¸­çº¢è‰²æ¡†ä¸­çš„å±äºåŒä¸€ä¸ªèŠ‚ç‚¹çš„ä¸åŒå±‚çº§ï¼Œè·³è¡¨ä¸­èŠ‚ç‚¹çš„æ•°é‡ä½“ç°åœ¨0å±‚ï¼ˆæœ€åº•å±‚ï¼‰èŠ‚ç‚¹çš„ä¸ªæ•°\n\nç»“åˆæºç ï¼Œåˆ†æèŠ‚ç‚¹çš„ç»„æˆï¼š\n\n```C\n// from Redis 7.0.8\n/* ZSETs use a specialized version of Skiplists */\ntypedef struct zskiplistNode {\n    sds ele;\n    double score;\n    struct zskiplistNode *backward;\n    struct zskiplistLevel {\n        struct zskiplistNode *forward;\n        unsigned long span;\n    } level[];\n} zskiplistNode;\n```\n\n- **ele**ï¼šsdsç»“æ„ï¼Œä¸€ä¸ªè¢«å°è£…è¿‡çš„å­—ç¬¦ä¸²ï¼Œæœ¬è´¨ä¸Šæ˜¯ä¸€ä¸ªcharæ•°ç»„ï¼Œç”¨äºå­˜å‚¨æ•°æ®\n- **score**ï¼šåŒç²¾åº¦æµ®ç‚¹æ•°ç±»å‹ï¼Œè¡¨ç¤ºè¯¥èŠ‚ç‚¹çš„åˆ†æ•°ï¼Œå†³å®šäº†è·³è¡¨ä¸­èŠ‚ç‚¹çš„ä½ç½®æ¬¡åº\n- **backward**ï¼šæŒ‡å‘ä¸Šä¸€ä¸ªèŠ‚ç‚¹çš„å›é€€æŒ‡é’ˆ\n- **level**ï¼šæ˜¯ä¸€ä¸ªzskiplistLeveç»“æ„ä½“æ•°ç»„ï¼Œç”¨äºè¡¨ç¤ºé«˜å±‚ç´¢å¼•ã€‚zskiplistLeveç»“æ„ä½“åŒ…å«äº†ä¸¤ä¸ªå­—æ®µï¼Œä¸€ä¸ªæ˜¯**forward**ï¼ŒæŒ‡å‘åŒå±‚çš„ä¸‹ä¸€ä¸ªç´¢å¼•ï¼›å¦ä¸€ä¸ªæ˜¯**span**ï¼Œè®°å½•äº†è·ç¦»ä¸‹ä¸€ä¸ªç´¢å¼•ï¼ˆèŠ‚ç‚¹ï¼‰çš„æ­¥é•¿\n\nç¤ºæ„å›¾ï¼š\n\n<img src=\"https://raw.githubusercontent.com/lyydsheep/pic/main/202410141101384.png\" alt=\"image-20241014110129253\" style=\"zoom:67%;\" />\n\n### å®ç°ç»†èŠ‚\n\n- Redis**è·³è¡¨ä¸­å•ä¸ªèŠ‚ç‚¹çš„å±‚æ•°**ç”±æ¦‚ç‡å†³å®šã€‚æ¯æ’å…¥ä¸€ä¸ªèŠ‚ç‚¹åˆ°0å±‚ï¼ŒRediså†³å®šè¯¥èŠ‚ç‚¹æ˜¯å¦å¢åŠ ä¸€å±‚ç´¢å¼•çš„**æ¦‚ç‡ä¸º25%**\n\n- è·³è¡¨å°†çº¯ç²¹çš„æœ‰åºå•é“¾è¡¨åœ¨æ’å…¥ã€åˆ é™¤ã€æ›´æ–°æ“ä½œä»$O(n)$æ—¶é—´å¤æ‚åº¦é™ä½è‡³$O(logN)$\n\n## ZSet\n\nZsetä¹Ÿå«Sorted Setå³æœ‰åºé›†åˆï¼Œæ˜¯æŒ‰ç…§å…ƒç´ çš„åˆ†æ•°è¿›è¡Œæ’åºçš„é›†åˆã€‚åˆ†æ•°ç›¸åŒçš„æƒ…å†µä¸‹ï¼ŒæŒ‰ç…§å…ƒç´ çš„å­—å…¸åºè¿›è¡Œæ’åº\n\nZSetå¸¸ç”¨äºæ’åºé›†åˆçš„åœºæ™¯ï¼Œæœ€å…¸å‹çš„å°±æ˜¯**æ¸¸æˆæ’è¡Œæ¦œ**\n\n### ç¼–ç æ–¹å¼\n\nZSetæœ‰ä¸¤ç§åº•å±‚ç¼–ç æ–¹å¼ï¼Œä¸€ç§æ˜¯ZIPLISTï¼Œå¦ä¸€ç§æ˜¯SKIPLIST+HASHTABLE\n\n<img src=\"https://raw.githubusercontent.com/lyydsheep/pic/main/202410141759086.png\" alt=\"image-20241014175901004\" style=\"zoom:67%;\" />\n\nå¦‚æœæ»¡è¶³ä¸‹åˆ—æ¡ä»¶ï¼ŒZSetå°±ç”¨ZIPLISTç¼–ç æ–¹å¼ï¼š\n\n- åˆ—è¡¨å¯¹è±¡ä¿å­˜çš„æ‰€æœ‰å­—ç¬¦ä¸²é•¿åº¦å‡å°äº64å­—èŠ‚\n- åˆ—è¡¨å¯¹è±¡ä¿å­˜çš„å…ƒç´ ä¸ªæ•°å°‘äº128ä¸ª\n\nZIPLISTä¾æ—§ä¿æŒç€å®ƒçš„ä¼˜ç‚¹ï¼Œåœ¨æ•°æ®é‡è¾ƒå°‘æ—¶ï¼Œååˆ†èŠ‚çº¦å†…å­˜ç©ºé—´ã€‚å½“ZSeté‡‡ç”¨ZIPLISTç¼–ç æ—¶ï¼Œåº•å±‚ç»“æ„å¦‚ä¸‹å›¾ï¼š\n\n<img src=\"https://raw.githubusercontent.com/lyydsheep/pic/main/202410141802693.png\" alt=\"image-20241014180256647\" style=\"zoom:67%;\" />\n\nä½†å‡¡ä¸Šè¿°çš„ä¸¤ä¸ªæ¡ä»¶æœ‰ä¸€ä¸ªä¸æ»¡è¶³ï¼ŒZSetå°±é‡‡ç”¨**SKIPLIST+HASHTABLE**çš„ç¼–ç æ–¹å¼ã€‚å…¶ä¸­ï¼ŒSKIPLISTæ˜¯ä¸€ä¸ªå…·æœ‰å¤šçº§ç´¢å¼•çš„æœ‰åºé“¾è¡¨ï¼Œ**å¯ä»¥å®ç°é«˜æ•ˆçš„æŸ¥è¯¢ã€æ’å…¥ã€åˆ é™¤æ“ä½œ**ã€‚é™¤æ­¤ä¹‹å¤–ï¼ŒRedisè¿˜åˆ©ç”¨HASHTABLEç»“æ„å®ç°åœ¨$O(1)$æ—¶é—´å¤æ‚åº¦ä¸‹**æŸ¥è¯¢åˆ°ZSetä¸­ä»»ä¸€æˆå‘˜çš„`score`å€¼**\n","slug":"Redis/Rediså¯¹è±¡","published":1,"date":"2024-12-27T11:03:15.343Z","updated":"2024-12-27T11:03:15.343Z","comments":1,"layout":"post","photos":[],"_id":"cm6c7md6n002qa5t25va14by5","content":"<h1 id=\"Rediså¯¹è±¡\"><a href=\"#Rediså¯¹è±¡\" class=\"headerlink\" title=\"Rediså¯¹è±¡\"></a>Rediså¯¹è±¡</h1><h2 id=\"String\"><a href=\"#String\" class=\"headerlink\" title=\"String\"></a>String</h2><p>Stringå°±æ˜¯å­—ç¬¦ä¸²ï¼Œæ˜¯Redisä¸­çš„ä¸€ä¸ªæœ€åŸºæœ¬æ•°æ®å¯¹è±¡ï¼Œæœ€å¤§å­˜å‚¨æ•°æ®<strong>512MB</strong></p>\n<h3 id=\"Setæ“ä½œ\"><a href=\"#Setæ“ä½œ\" class=\"headerlink\" title=\"Setæ“ä½œ\"></a>Setæ“ä½œ</h3><p>åŸºæœ¬è¯­æ³•ï¼š**<code>set key value [expiration EX seconds | PX milliseconds] [NX|XX]</code>**</p>\n<p>Setæ“ä½œç”¨äºåœ¨Redisä¸­è®¾ç½®ä¸€ä¸ªK-Vå¯¹ï¼Œå…¶ä¸­å‡ ä¸ªæ‰©å±•å‚æ•°ä½œç”¨åˆ†åˆ«å¦‚ä¸‹ï¼š</p>\n<ul>\n<li><strong>EX seconds</strong>ï¼šè®¾ç½®K-Vå¯¹çš„è¿‡æœŸæ—¶é—´ä¸ºå¤šå°‘ç§’</li>\n<li><strong>PX milliseconds</strong>ï¼šè®¾ç½®K-Vå¯¹çš„è¿‡æœŸæ—¶é—´ä¸ºå¤šå°‘æ¯«ç§’</li>\n<li><strong>NX</strong>ï¼šåªæœ‰å½“Keyä¸å­˜åœ¨æ—¶ï¼Œå‘½ä»¤æ‰ç”Ÿæ•ˆï¼Œç›¸å½“äº<code>setnx key value</code></li>\n<li><strong>XX</strong>ï¼šåªæœ‰å½“Keyå­˜åœ¨æ—¶ï¼Œå‘½ä»¤æ‰ç”Ÿæ•ˆ</li>\n</ul>\n<p>âš ï¸ï¼šå¯¹ä¸€ä¸ªå·²ç»å­˜åœ¨Keyè¿›è¡Œsetæ“ä½œä¼š<strong>å°†åŸæœ‰å€¼è¦†ç›–</strong>ï¼Œå¯èƒ½ä¼šå¯¼è‡´<strong>åŸæœ‰å€¼ä¸¢å¤±ã€æ“¦é™¤è¿‡æœŸæ—¶é—´ã€ä¸¢å¤±åŸæœ‰å€¼ç±»å‹</strong></p>\n<h3 id=\"ä¸‰ç§ç¼–ç æ–¹å¼\"><a href=\"#ä¸‰ç§ç¼–ç æ–¹å¼\" class=\"headerlink\" title=\"ä¸‰ç§ç¼–ç æ–¹å¼\"></a>ä¸‰ç§ç¼–ç æ–¹å¼</h3><p>Stringå¯¹è±¡åº•å±‚é‡‡ç”¨ä¸‰ç§ä¸åŒçš„ç¼–ç æ–¹å¼ä»¥é«˜æ•ˆåº”å¯¹å„ç§åœºæ™¯</p>\n<ul>\n<li><strong>INTç¼–ç </strong>ï¼šç”¨äºå­˜å‚¨longèŒƒå›´å†…çš„<strong>æ•´æ•°</strong><ul>\n<li>âš ï¸ï¼šå¦‚æœæ˜¯æµ®ç‚¹æ•°ï¼Œåˆ™ä¸èƒ½ä½¿ç”¨INTç¼–ç ã€‚å› ä¸ºINTç¼–ç åªèƒ½ç”¨äºè¡¨ç¤ºæ•´æ•°</li>\n</ul>\n</li>\n<li><strong>EMBSTRç¼–ç </strong>ï¼šå¦‚æœå­—ç¬¦ä¸²çš„å¤§å°å°äºé˜ˆå€¼å­—èŠ‚ï¼Œåˆ™é‡‡ç”¨æ­¤æ–¹å¼</li>\n<li><strong>RAWç¼–ç </strong>ï¼šå¦‚æœå­—ç¬¦ä¸²çš„å¤§å°å¤§äºé˜ˆå€¼å­—èŠ‚ï¼Œåˆ™é‡‡ç”¨æ­¤æ–¹å¼</li>\n</ul>\n<p>EMBSTRç¼–ç å’ŒRAWç¼–ç æ–¹å¼åœ¨åº•å±‚å®ç°ä¸­éƒ½æ˜¯ç”±redisObjectå’ŒSDSä¸¤ä¸ªç»“æ„ç»„æˆï¼ŒåŒºåˆ«åœ¨äº<strong>è¿™ä¸¤ä¸ªç»“æ„åœ¨ç‰©ç†å†…å­˜ä¸Šæ˜¯å¦è¿ç»­ï¼ˆä¸ºä¸€æ•´ä½“ï¼‰</strong></p>\n<p>EMBSTRåœ¨å†…å­˜ä¸­çš„è¡¨ç¤ºï¼š</p>\n<p><img src=\"https://raw.githubusercontent.com/lyydsheep/pic/main/202410031004350.png\" alt=\"image-20241003100407308\"></p>\n<p>RAWåœ¨å†…å­˜ä¸­çš„è¡¨ç¤ºï¼š</p>\n<p><img src=\"https://raw.githubusercontent.com/lyydsheep/pic/main/202410031004128.png\" alt=\"image-20241003100440097\"></p>\n<h4 id=\"ä¸‰ç§ç¼–ç æ–¹å¼çš„è½¬æ¢å…³ç³»\"><a href=\"#ä¸‰ç§ç¼–ç æ–¹å¼çš„è½¬æ¢å…³ç³»\" class=\"headerlink\" title=\"ä¸‰ç§ç¼–ç æ–¹å¼çš„è½¬æ¢å…³ç³»\"></a>ä¸‰ç§ç¼–ç æ–¹å¼çš„è½¬æ¢å…³ç³»</h4><p>éšç€å¯¹Redisçš„æ“ä½œï¼ŒStringå¯¹è±¡çš„ç¼–ç æ–¹å¼å¯èƒ½æœ‰å¦‚ä¸‹å˜åŒ–ï¼š</p>\n<p>INT â€“&gt; RAWï¼šå½“å­˜å‚¨çš„å†…å®¹ä¸å†æ˜¯æ•´æ•°æˆ–å¤§å°è¶…è¿‡longèŒƒå›´ï¼Œåˆ™éœ€è¦å°†INTç¼–ç è½¬æ¢ä¸ºRAWç¼–ç </p>\n<p>EMBSTR â€“&gt; RAWï¼šç”±äºEMBSTRç¼–ç çš„Stringå¯¹è±¡æ˜¯<strong>åªè¯»</strong>çš„ï¼Œæ‰€ä»¥å¯¹ä¸€ä¸ªEMBSTRè¿›è¡Œå†™æ“ä½œæ—¶ï¼Œå°±ä¼šå°†å…¶ç¼–ç æ–¹å¼æ”¹ä¸ºRAWã€‚è¿™æ˜¯å› ä¸ºä¿®æ”¹æ•°æ®å°±è¦é‡æ–°åˆ†é…å­˜å‚¨ç©ºé—´ï¼Œè€ŒEMBSTRä¸­redisObjectå’ŒSDSæ˜¯è¿ç»­çš„ï¼Œä¸æ˜“åˆ†é…ç©ºé—´ã€‚å¹¶ä¸”åªè¦è¿›è¡Œä¿®æ”¹æ“ä½œé‚£ä¹ˆå°±èƒ½è®¤ä¸ºè¿™ä¸ªStringæ˜¯æ˜“å˜çš„ã€ä¸ç¨³å®šçš„ï¼Œé‡‡ç”¨RAWç¼–ç æ–¹å¼èƒ½å¤Ÿå‡å°‘é¢‘ç¹å¯¹EMBSTRå†…å­˜åˆ†é…çš„æ€§èƒ½æŸè€—</p>\n<h3 id=\"SDSç»“æ„\"><a href=\"#SDSç»“æ„\" class=\"headerlink\" title=\"SDSç»“æ„\"></a>SDSç»“æ„</h3><p>ä¸ç®¡æ˜¯EMBSTRè¿˜æ˜¯RAWï¼Œéƒ½æœ‰ä¸€ä¸ªSDSç»“æ„ï¼ŒSDSç»“æ„æ˜¯ä¸ºäº†è§£å†³Cè¯­è¨€ä¸­å­—ç¬¦ä¸²çš„å°´å°¬å¤„å¢ƒ</p>\n<ul>\n<li>è®¡ç®—å­—ç¬¦ä¸²é•¿åº¦éœ€è¦éå†ï¼Œæ—¶é—´å¤æ‚åº¦$$O(n)$$</li>\n<li>å¯¹å­—ç¬¦ä¸²è¿½åŠ å†…å®¹éœ€è¦æ‰©å®¹æ“ä½œ</li>\n<li>äºŒè¿›åˆ¶ä¸å®‰å…¨<ul>\n<li>äºŒè¿›åˆ¶å®‰å…¨æ˜¯æŒ‡å…¬å¹³å¯¹å¾…æ¯ä¸€ä¸ªå­—ç¬¦ï¼Œä¸ç‰¹æ®Šå¤„ç†ä»»ä½•å­—ç¬¦</li>\n<li>Cè¯­è¨€ä¸­å­—ç¬¦ä¸²ç‰¹æ®Šå¤„ç†<code>\\0</code>ä¸ºå­—ç¬¦ä¸²ç»“å°¾</li>\n</ul>\n</li>\n</ul>\n<p>SDSç»“æ„å…·ä½“ç”±ä¸€ä¸‹å­—æ®µç»„æˆï¼š</p>\n<figure class=\"highlight c\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"class\"><span class=\"keyword\">struct</span> __<span class=\"title\">attribute__</span> ((__<span class=\"title\">packed__</span>)) <span class=\"title\">sdshdr8</span> &#123;</span></span><br><span class=\"line\">    <span class=\"type\">uint8_t</span> len;</span><br><span class=\"line\">    <span class=\"type\">uint8_t</span> alloc;</span><br><span class=\"line\">    <span class=\"type\">unsigned</span> <span class=\"type\">char</span> flags;</span><br><span class=\"line\">    <span class=\"type\">char</span> buf[];</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n\n<ul>\n<li><strong>len</strong>ï¼šè¡¨ç¤ºå­—ç¬¦ä¸²é•¿åº¦ï¼Œ<strong>å¯ä»¥å¿«é€Ÿè¿”å›å­—ç¬¦ä¸²é•¿åº¦ï¼Œå¹¶ä¸”ä¸éœ€è¦<code>\\0</code>ä½œä¸ºç»“å°¾ç¬¦å·</strong></li>\n<li><strong>alloc</strong>ï¼šè¡¨ç¤ºåˆ†é…äº†å¤šå°‘å†…å­˜ç©ºé—´ï¼Œ<strong>å…·æœ‰ä¸€å®šçš„é¢„ç•™ç©ºé—´ï¼Œæ— éœ€è¿›è¡Œæ‰©å®¹æ“ä½œ</strong></li>\n<li><strong>flags</strong>ï¼šç”¨äºåŒºåˆ†å…·ä½“æ˜¯ä»€ä¹ˆç±»å‹çš„SDS<ul>\n<li>åœ¨Redisä¸­SDSåˆ†ä¸ºsdshdr8ã€sdshdr16ã€sdshdr32ã€sdshdr64</li>\n</ul>\n</li>\n</ul>\n<h2 id=\"List\"><a href=\"#List\" class=\"headerlink\" title=\"List\"></a>List</h2><p>3.2ç‰ˆæœ¬ä¹‹å‰ï¼ŒListå¯¹è±¡æœ‰ä¸¤ç§ç¼–ç æ–¹å¼</p>\n<ul>\n<li>ZIPLIST</li>\n<li>LINKLIST</li>\n</ul>\n<p>å½“æ»¡è¶³ä»¥ä¸‹æ¡ä»¶æ—¶ï¼Œé‡‡ç”¨ZIPLISTç¼–ç æ–¹å¼</p>\n<ul>\n<li>åˆ—è¡¨å¯¹è±¡ä¸­æ‰€æœ‰å­˜å‚¨çš„å­—ç¬¦ä¸²å¯¹è±¡é•¿åº¦éƒ½å°äº64å­—èŠ‚</li>\n<li>åˆ—è¡¨å¯¹è±¡ä¸­å­˜å‚¨çš„å¯¹è±¡æ•°é‡ä¸è¶…è¿‡512ä¸ªï¼ˆè¿™æ˜¯LISTçš„é™åˆ¶ï¼Œè€Œä¸æ˜¯ZIPLISTçš„é™åˆ¶ï¼‰</li>\n</ul>\n<p>ğŸŒ°ï¼š</p>\n<p><img src=\"https://raw.githubusercontent.com/lyydsheep/pic/main/202410051125337.png\" alt=\"image-20241005112548274\"></p>\n<p>ZIPLISTä¸­æ•°æ®éƒ½æ˜¯ç´§å¯†æ’åˆ—çš„ï¼Œåœ¨æ•°æ®é‡å°çš„æ—¶å€™å¯ä»¥æœ‰æ•ˆèŠ‚çº¦å†…å­˜ï¼›è€ŒLINKLISTé¡¾åæ€ä¹‰ï¼Œæ•°æ®æ˜¯ä»¥é“¾è¡¨å½¢å¼ä¸²è”èµ·æ¥çš„ï¼Œåœ¨æ•°æ®é‡å¤§çš„æ—¶å€™é‡‡ç”¨LINKLISTç¼–ç å¯ä»¥åŠ å¿«å¤„ç†æ€§èƒ½</p>\n<p>ğŸŒ°ï¼š</p>\n<p><img src=\"https://raw.githubusercontent.com/lyydsheep/pic/main/202410051126746.png\" alt=\"image-20241005112658713\"></p>\n<h3 id=\"QUICKLIST\"><a href=\"#QUICKLIST\" class=\"headerlink\" title=\"QUICKLIST\"></a>QUICKLIST</h3><p>ZIPLISTåœ¨æ•°æ®è¾ƒå°‘æ—¶èŠ‚çº¦å†…å­˜ï¼ŒLINKLISTæ˜¯ä¸ºäº†åœ¨æ•°æ®è¾ƒå¤šæ—¶æé«˜æ›´æ–°æ•ˆç‡ã€‚ä½†æ˜¯ZIPLISTåœ¨æ•°æ®ç¨å¤šæ—¶æ’å…¥æ•°æ®ä¼šå¯¼è‡´å¤§é‡æ•°æ®å¤åˆ¶ï¼Œå ç”¨å†…å­˜ç©ºé—´ï¼›åŒæ ·åœ°ï¼ŒLINKLISTç”±äºèŠ‚ç‚¹æ•°é‡ä¹Ÿå¼‚å¸¸å¤šï¼Œä¹Ÿä¼šå ç”¨ä¸å°‘å†…å­˜</p>\n<p>åŸºäºä¸Šè¿°é—®é¢˜ï¼Œ3.2ç‰ˆæœ¬å°±å¼•å…¥äº†QUICKLISTã€‚QUICKLISTæœ¬è´¨å°±æ˜¯<strong>ZIPLISTå’ŒLINKLISTçš„ç»“åˆä½“</strong></p>\n<p>QUICKLISTçš„å®ç°æ€è·¯æ˜¯ï¼Œå°†åŸæœ¬LINKLISTçš„<strong>å•ä¸ªèŠ‚ç‚¹å­˜å‚¨å•ä¸ªæ•°æ®</strong>çš„æ¨¡å¼ï¼Œæ›´æ¢æˆä¸€ä¸ª<strong>å•ä¸ªèŠ‚ç‚¹ï¼ˆZIPLISTï¼‰å­˜å‚¨å¤šä¸ªæ•°æ®</strong>çš„å½¢å¼</p>\n<p><img src=\"https://raw.githubusercontent.com/lyydsheep/pic/main/202410051135173.png\" alt=\"image-20241005113525108\"></p>\n<p>å½“æ•°æ®è¾ƒå°‘æ—¶ï¼ŒQUICKLISTèŠ‚ç‚¹åªæœ‰ä¸€ä¸ªï¼Œé€€åŒ–æˆZIPLIST</p>\n<p>å½“æ•°æ®è¾ƒå¤šæ—¶ï¼Œåˆ™åŒæ—¶åˆ©ç”¨äº†ZIPLISTå’ŒLINKLISTçš„ä¼˜åŠ¿</p>\n<h2 id=\"å‹ç¼©åˆ—è¡¨\"><a href=\"#å‹ç¼©åˆ—è¡¨\" class=\"headerlink\" title=\"å‹ç¼©åˆ—è¡¨\"></a>å‹ç¼©åˆ—è¡¨</h2><p>å‹ç¼©åˆ—è¡¨ä½œä¸ºListçš„åº•å±‚æ•°æ®ç»“æ„ï¼Œæä¾›äº†ç´§å‡‘å‹çš„æ•°æ®å­˜å‚¨æ–¹å¼ï¼Œèƒ½èŠ‚çº¦å†…å­˜ï¼Œå°æ•°æ®é‡çš„æ—¶å€™éå†è®¿é—®æ€§èƒ½å¥½ï¼ˆè¿ç»­+å±€éƒ¨æ€§ä¼˜åŠ¿ï¼‰</p>\n<h3 id=\"ZIPLISTæ•´ä½“ç»“æ„\"><a href=\"#ZIPLISTæ•´ä½“ç»“æ„\" class=\"headerlink\" title=\"ZIPLISTæ•´ä½“ç»“æ„\"></a>ZIPLISTæ•´ä½“ç»“æ„</h3><p>åœ¨Redisä»£ç æ³¨é‡Šä¸­ï¼Œæœ‰å¯¹ZIPLISTæ¸…æ™°åœ°æè¿°ï¼š</p>\n<figure class=\"highlight c\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\">/* The general layout of the ziplist is as follows:</span></span><br><span class=\"line\"><span class=\"comment\"></span></span><br><span class=\"line\"><span class=\"comment\">&lt;zlbytes&gt; &lt;zltail&gt; &lt;zllen&gt; &lt;entry&gt; &lt;entry&gt; &lt;entry&gt; ... &lt;entry&gt; &lt;zlend&gt;</span></span><br><span class=\"line\"><span class=\"comment\">*/</span></span><br></pre></td></tr></table></figure>\n\n<p>ğŸŒ°ï¼šä¸€ä¸ªå…·æœ‰ä¸‰ä¸ªèŠ‚ç‚¹çš„ZIPLIST</p>\n<p><img src=\"https://raw.githubusercontent.com/lyydsheep/pic/main/202410081615659.png\" alt=\"image-20241008161508590\"></p>\n<p><strong>zlbytes</strong>å­—æ®µè¡¨ç¤ºè¯¥ZIPLISTä¸€å…±å ç”¨äº†å¤šå°‘å­—èŠ‚ï¼ˆåŒ…å«zlbyteså­—æ®µçš„å¤§å°ï¼‰</p>\n<p><strong>zltail</strong>å­—æ®µè¡¨ç¤ºæœ€åä¸€ä¸ª<strong>æ•°æ®èŠ‚ç‚¹ï¼ˆentryï¼‰</strong>è·ç¦»ZIPLISTé¦–éƒ¨çš„åç§»å­—èŠ‚æ•°ï¼Œå¦‚æœZIPLISTä¸ºç©ºï¼ˆå³æœ¨æœ‰entryï¼‰ï¼Œåˆ™æŒ‡ç¤º<strong>zlend</strong>å­—æ®µçš„åç§»é‡</p>\n<blockquote>\n<p>å¾ˆæ˜¾ç„¶ï¼Œä¼šæœ‰å¦‚ä¸‹ç­‰å¼ï¼š</p>\n<p>zlbytes &#x3D; zltial + æœ€åä¸€ä¸ªentryå¤§å°ï¼ˆå¯èƒ½ä¸ºé›¶ï¼‰ + zlendå¤§å°</p>\n</blockquote>\n<p><strong>zllen</strong>å­—æ®µè¡¨ç¤ºZIPLISTç»“æ„ä¸­entryçš„ä¸ªæ•°ï¼Œä½†ç”±äºè¯¥å­—æ®µåªå ç”¨2å­—èŠ‚ç©ºé—´ï¼Œæ‰€ä»¥æœ€å¤šåªèƒ½è¡¨ç¤º65535ä¸ªã€‚å½“å…ƒç´ ä¸ªæ•°è¿‡å¤šï¼Œåªèƒ½é€šè¿‡<strong>éå†</strong>çš„æ–¹å¼è·å–å…ƒç´ ä¸ªæ•°</p>\n<p><strong>zlend</strong>å­—æ®µæ˜¯ä¸€ä¸ªç‰¹æ®ŠèŠ‚ç‚¹ï¼Œæ ‡è¯†ZIPLISTç»“æ„çš„ç»“æŸ</p>\n<p><strong>entry</strong>å­—æ®µè¡¨ç¤ºä¸€ä¸ªæ•°æ®èŠ‚ç‚¹ï¼Œå®é™…ä¸Šä¹Ÿæ˜¯ä¸€ä¸ªç»“æ„ä½“ç±»å‹ã€‚è¯¥ç±»å‹ç”±ä¸‰ä¸ªå­—æ®µæ„æˆï¼Œåˆ†åˆ«æ˜¯</p>\n<figure class=\"highlight c\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">&lt;prevlen&gt; &lt;encoding&gt; &lt;entry-data&gt;</span><br></pre></td></tr></table></figure>\n\n<h3 id=\"entryç»“æ„\"><a href=\"#entryç»“æ„\" class=\"headerlink\" title=\"entryç»“æ„\"></a>entryç»“æ„</h3><p><strong><code>prevlen</code><strong>å­—æ®µè¡¨ç¤º</strong>ä¸Šä¸€ä¸ªæ•°æ®èŠ‚ç‚¹ï¼ˆentryï¼‰çš„é•¿åº¦</strong>ï¼Œå¦‚æœé•¿åº¦<strong>å°äº254</strong>ï¼Œé‚£ä¹ˆ**<code>prevlen</code><strong>å­—æ®µå ç”¨1å­—èŠ‚ç©ºé—´ï¼›å¦‚æœé•¿åº¦</strong>å¤§äºç­‰äº254<strong>ï¼Œé‚£ä¹ˆè¯¥å­—æ®µéœ€è¦ç”¨5å­—èŠ‚ç©ºé—´è¡¨ç¤ºï¼Œå¹¶ä¸”</strong>ç¬¬ä¸€ä¸ªå­—èŠ‚ä¸º11111110**ï¼Œè¡¨ç¤ºè¿™æ˜¯ä¸€ä¸ª5å­—èŠ‚çš„<code>prevlen</code>ä¿¡æ¯ï¼Œå‰©ä¸‹çš„4å­—èŠ‚ç”¨æ¥è¡¨ç¤ºé•¿åº¦</p>\n<p>âš ï¸ï¼šä¸ºä»€ä¹ˆé˜ˆå€¼æ˜¯254è€Œä¸æ˜¯255ï¼Ÿè¿™æ˜¯å› ä¸º255è¢«ç”¨æ¥ç‰¹æ®Šè¡¨ç¤º<strong>zlend</strong>å­—æ®µï¼Œæ ‡è¯†ZIPLISTç»“æ„çš„ç»“æŸ</p>\n<p><strong><code>encoding</code><strong>å­—æ®µæ˜¯ä¸€ä¸ªæ•´å½¢æ•°æ®ï¼Œå…¶äºŒè¿›åˆ¶ç¼–ç ç”±</strong>å†…å®¹ç±»å‹</strong>å’Œ<strong>å†…å®¹æ•°æ®çš„å­—èŠ‚é•¿åº¦</strong>ä¸¤éƒ¨åˆ†ç»„æˆ</p>\n<h3 id=\"è¿é”æ›´æ–°\"><a href=\"#è¿é”æ›´æ–°\" class=\"headerlink\" title=\"è¿é”æ›´æ–°\"></a>è¿é”æ›´æ–°</h3><p>å½“å‘ä¸€ä¸ªentryå‰é¢æ’å…¥ä¸€ä¸ªé•¿åº¦è¶…è¿‡254çš„èŠ‚ç‚¹æ—¶ï¼Œ<code>prevlen</code>å­—æ®µå¯èƒ½å°±ä¼šç”±1å­—èŠ‚å˜æˆ5å­—èŠ‚ï¼Œå¯¼è‡´æœ¬entryé•¿åº¦å¢å¤§ã€‚å¦‚æœè¿æ°”ä¸æ˜¯å¾ˆå¥½ï¼Œå°†ä¼šå¯¼è‡´ä¸‹ä¸€ä¸ªèŠ‚ç‚¹ä¸­çš„<code>prevlen</code>å­—æ®µå¢åŠ ï¼Œä»¥æ­¤ç±»æ¨ï¼Œé€ æˆè¿é”ååº”ï¼Œè¿™å°±æ˜¯è¿é”æ›´æ–°é—®é¢˜ã€‚</p>\n<p><img src=\"https://raw.githubusercontent.com/lyydsheep/pic/main/202410081855045.png\" alt=\"image-20241008185552935\"></p>\n<h4 id=\"LISTPACKä¼˜åŒ–\"><a href=\"#LISTPACKä¼˜åŒ–\" class=\"headerlink\" title=\"LISTPACKä¼˜åŒ–\"></a>LISTPACKä¼˜åŒ–</h4><p><code>prevlen</code>å­—æ®µæ­£æ˜¯è¿é”æ›´æ–°çš„ç½ªé­ç¥¸é¦–ï¼Œä¸ºäº†è§£å†³è¿é”æ›´æ–°é—®é¢˜ï¼Œå°±ä¸èƒ½å†å»è®°å½•ä¸Šä¸€ä¸ªèŠ‚ç‚¹çš„é•¿åº¦ï¼Œä½†åˆè¦ä¿è¯èƒ½å¤Ÿå®ç°å€’åºéå†ï¼ˆæ‰¾åˆ°ä¸Šä¸€ä¸ªèŠ‚ç‚¹çš„ä½ç½®ï¼‰</p>\n<p>Redisä½¿ç”¨äº†ä¸€ç§å·§å¦™çš„æ–¹æ³•ï¼šåˆ é™¤<code>prevlen</code>å­—æ®µï¼Œ<strong>æ–°å¢<code>element-tot-len</code>å­—æ®µè®°å½•æ•´ä¸ªèŠ‚ç‚¹é™¤å®ƒï¼ˆelement-tot-lenå­—æ®µï¼‰è‡ªèº«ä¹‹å¤–çš„é•¿åº¦</strong></p>\n<p>æ­¤æ—¶èŠ‚ç‚¹ç»“æ„å°±å˜æˆäº†ï¼š</p>\n<figure class=\"highlight c\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">&lt;encoding-type&gt; &lt;element-data&gt; &lt;element-top-len&gt;</span><br></pre></td></tr></table></figure>\n\n<ul>\n<li>encoding-typeæ˜¯ç¼–ç ç±»å‹</li>\n<li>element-dataæ˜¯æ•°æ®å†…å®¹</li>\n<li>element-top-lenæ‰€å çš„æ¯ä¸ªå­—èŠ‚çš„ç¬¬ä¸€ä¸ªbitä½ç”¨äºæ ‡è¯†æ˜¯å¦ç»“æŸï¼Œ0åˆ™ç»“æŸï¼Œ1åˆ™ç»§ç»­</li>\n</ul>\n<p>ğŸŒ°ï¼š<img src=\"https://raw.githubusercontent.com/lyydsheep/pic/main/202410081903663.png\" alt=\"image-20241008190334625\"></p>\n<h2 id=\"Set\"><a href=\"#Set\" class=\"headerlink\" title=\"Set\"></a>Set</h2><p>Rediä¸­çš„setæ˜¯ä¸€ä¸ªä¸é‡å¤ã€æ— åºçš„å­—ç¬¦ä¸²é›†åˆ</p>\n<blockquote>\n<p>å¦‚æœSetåº•å±‚ä½¿ç”¨INTSETç¼–ç æ–¹å¼ï¼Œåˆ™é›†åˆæ˜¯æœ‰åºçš„</p>\n</blockquote>\n<h3 id=\"ç¼–ç æ–¹å¼\"><a href=\"#ç¼–ç æ–¹å¼\" class=\"headerlink\" title=\"ç¼–ç æ–¹å¼\"></a>ç¼–ç æ–¹å¼</h3><p>Setåº•å±‚æœ‰ä¸¤ç§ç¼–ç æ–¹å¼ï¼š<strong>INTSETã€HASHTABLE</strong></p>\n<p>å½“Setä¸­å­˜å‚¨çš„éƒ½æ˜¯æ•´æ•°å¹¶ä¸”å…ƒç´ ä¸ªæ•°å°‘äº512ä¸ªæ—¶ï¼Œåˆ™é‡‡ç”¨INTSETç¼–ç æ–¹å¼</p>\n<p><img src=\"https://raw.githubusercontent.com/lyydsheep/pic/main/202410091541699.png\" alt=\"image-20241009154144626\"></p>\n<p>ç”±ä¸Šå›¾å¯è§ï¼Œé‡‡ç”¨INTSETç¼–ç ï¼Œå…ƒç´ æ’åˆ—æ¯”è¾ƒç´§å‡‘ï¼Œå†…å­˜å ç”¨å°‘ï¼Œä½†æŸ¥æ‰¾æ—¶éœ€è¦ä½¿ç”¨äºŒåˆ†æ³•ï¼Œæ—¶é—´å¤æ‚åº¦ä¸º$O(nlogn)$</p>\n<p>å¦‚æœä¸æ»¡è¶³INTSETç¼–ç æ¡ä»¶ï¼Œåˆ™éœ€è¦ä½¿ç”¨HASHTABLEç¼–ç ï¼ŒHASHTABLEæŸ¥è¯¢ä¸€ä¸ªå…ƒç´ æ€§èƒ½å¾ˆé«˜ï¼Œæ—¶é—´å¤æ‚åº¦ä¸º$O(1)$</p>\n<p><img src=\"https://raw.githubusercontent.com/lyydsheep/pic/main/202410091544018.png\" alt=\"image-20241009154437973\"></p>\n<p>ç®€å•åœ°æ¦‚æ‹¬ï¼š</p>\n<ul>\n<li>INTSETç¼–ç é€‚ç”¨äºå­˜å‚¨å°‘é‡æ•´æ•°åœºæ™¯ä»¥èŠ‚çº¦å†…å­˜ç©ºé—´</li>\n<li>HASHTABLEç¼–ç é€‚ç”¨äºå¿«é€Ÿå®šä½æŸä¸ªå…ƒç´ çš„ä½ç½®</li>\n</ul>\n<h2 id=\"Hash\"><a href=\"#Hash\" class=\"headerlink\" title=\"Hash\"></a>Hash</h2><p>&#x2F;&#x2F; to do</p>\n<p>panic(â€œimplement meâ€)</p>\n<h2 id=\"HashTable\"><a href=\"#HashTable\" class=\"headerlink\" title=\"HashTable\"></a>HashTable</h2><blockquote>\n<p> HAHSTABLEæ˜¯Redisä¸­çš„ä¸€ç§åº•å±‚æ•°æ®ç»“æ„</p>\n</blockquote>\n<p>é€šè¿‡HASHTABLEå¯ä»¥åœ¨$O(1)$æ—¶é—´å¤æ‚åº¦å†…å¿«é€Ÿå®šä½åˆ°Keyå¯¹äºçš„Value</p>\n<h3 id=\"ç»“æ„\"><a href=\"#ç»“æ„\" class=\"headerlink\" title=\"ç»“æ„\"></a>ç»“æ„</h3><p>æ€»æ‰€å‘¨çŸ¥ï¼ŒRedisæ˜¯ç”¨Cè¯­è¨€å®ç°çš„ã€‚HASHTABLEçš„Cå®ç°æ¶‰åŠåˆ°ä¸‰ä¸ªç»“æ„ä½“ï¼š<code>dict</code>ã€<code>dictht</code>ã€<code>dicEntry</code></p>\n<p>ç®€å•åœ°è¯´ï¼Œ<code>dict</code>å°è£…äº†ä¸¤ä¸ª<code>dictht</code>ç»“æ„ï¼Œæ¯ä¸€ä¸ª<code>dictht</code>ç»“æ„éƒ½æœ‰ä¸€ä¸ªå¤§å°ä¸º<code>size</code>çš„<strong>bucket</strong>ï¼Œbucketä¸­å­˜æ”¾ç€<code>dicEntry</code>é“¾è¡¨ã€‚ä¸‰ä¸ªç»“æ„ä½“ä¹‹é—´çš„å…³ç³»å¦‚ä¸‹å›¾æ‰€ç¤ºï¼š</p>\n<img src=\"https://raw.githubusercontent.com/lyydsheep/pic/main/202410122043279.png\" alt=\"image-20241012204338184\" style=\"zoom:67%;\" />\n\n<p>å¯ä»¥çœ‹åˆ°dictç»“æ„ä¸­æœ‰ä¸¤ä¸ªdicthtç»“æ„ï¼Œä¹Ÿå°±æ˜¯HASHTABLEç»“æ„ã€‚dicEntryæ˜¯é“¾è¡¨ç»“æ„ï¼Œé€šè¿‡æ‹‰é“¾æ³•è§£å†³Hashå†²çª</p>\n<p>æ¥ä¸‹æ¥ï¼Œç»“åˆæºç jè§£é‡Šæ¯ä¸€ä¸ªç»“æ„ä½“çš„å­—æ®µå«ä¹‰ï¼š</p>\n<figure class=\"highlight c\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">typedef</span> <span class=\"class\"><span class=\"keyword\">struct</span> <span class=\"title\">dict</span>&#123;</span></span><br><span class=\"line\">    dictType *type; <span class=\"comment\">//ç›´çº¿dictTypeç»“æ„ï¼ŒdictTypeç»“æ„ä¸­åŒ…å«è‡ªå®šä¹‰çš„å‡½æ•°ï¼Œè¿™äº›å‡½æ•°ä½¿å¾—keyå’Œvalueèƒ½å¤Ÿå­˜å‚¨ä»»ä½•ç±»å‹çš„æ•°æ®</span></span><br><span class=\"line\">    <span class=\"type\">void</span> *privdata; <span class=\"comment\">//ç§æœ‰æ•°æ®ï¼Œä¿å­˜ç€dictTypeç»“æ„ä¸­å‡½æ•°çš„ å‚æ•°</span></span><br><span class=\"line\">    dictht ht[<span class=\"number\">2</span>]; <span class=\"comment\">//ä¸¤å¼ å“ˆå¸Œè¡¨</span></span><br><span class=\"line\">    <span class=\"type\">long</span> rehashidx; <span class=\"comment\">//rehashçš„æ ‡è®°ï¼Œrehashidx=-1è¡¨ç¤ºæ²¡æœ‰è¿›è¡Œrehashï¼Œrehashæ—¶æ¯è¿ç§»ä¸€ä¸ªæ¡¶å°±å¯¹rehashidxåŠ ä¸€</span></span><br><span class=\"line\">    <span class=\"type\">int</span> itreators;  <span class=\"comment\">//æ­£åœ¨è¿­ä»£çš„è¿­ä»£å™¨æ•°é‡</span></span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n\n<figure class=\"highlight c\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"meta\">#dictç»“æ„ä¸­ht[0]ã€ht[1]å“ˆå¸Œè¡¨çš„æ•°æ®ç»“æ„</span></span><br><span class=\"line\"><span class=\"keyword\">typedef</span> <span class=\"class\"><span class=\"keyword\">struct</span> <span class=\"title\">dictht</span>&#123;</span></span><br><span class=\"line\">    dictEntry[] table;        <span class=\"comment\">//å­˜æ”¾ä¸€ä¸ªæ•°ç»„çš„åœ°å€ï¼Œæ•°ç»„ä¸­å­˜æ”¾å“ˆå¸ŒèŠ‚ç‚¹dictEntryçš„åœ°å€</span></span><br><span class=\"line\">    unsingned <span class=\"type\">long</span> size;      <span class=\"comment\">//å“ˆå¸Œè¡¨tableçš„å¤§å°ï¼Œå‡ºå§‹å¤§å°ä¸º4</span></span><br><span class=\"line\">    unsingned <span class=\"type\">long</span>  sizemask; <span class=\"comment\">//ç”¨äºå°†hashå€¼æ˜ å°„åˆ°tableä½ç½®çš„ç´¢å¼•ï¼Œå¤§å°ä¸ºï¼ˆsize-1ï¼‰</span></span><br><span class=\"line\">    unsingned <span class=\"type\">long</span>  used;     <span class=\"comment\">//è®°å½•å“ˆå¸Œè¡¨å·²æœ‰èŠ‚ç‚¹ï¼ˆé”®å€¼å¯¹ï¼‰çš„æ•°é‡</span></span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n\n<figure class=\"highlight c\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">#å“ˆå¸Œè¡¨èŠ‚ç‚¹ç»“æ„å®šä¹‰</span><br><span class=\"line\"><span class=\"keyword\">typedef</span> <span class=\"class\"><span class=\"keyword\">struct</span> <span class=\"title\">dictEntity</span>&#123;</span></span><br><span class=\"line\">    <span class=\"type\">void</span> *key;<span class=\"comment\">//é”®</span></span><br><span class=\"line\">    <span class=\"comment\">//å€¼</span></span><br><span class=\"line\">    <span class=\"class\"><span class=\"keyword\">union</span>&#123;</span></span><br><span class=\"line\">        <span class=\"comment\">//â€œæˆ‘ä¹‹æ‰€ä»¥è¦æé†’ä½ æ³¨æ„è¿™é‡Œï¼Œå…¶å®æ˜¯ä¸ºäº†è¯´æ˜ï¼Œè¿™ç§å®ç°æ–¹æ³•æ˜¯ä¸€ç§èŠ‚çœå†…å­˜çš„å¼€å‘å°æŠ€å·§ï¼Œéå¸¸å€¼å¾—å­¦ä¹ ã€‚å› ä¸ºå½“å€¼ä¸ºæ•´æ•°æˆ–åŒç²¾åº¦æµ®ç‚¹æ•°æ—¶ï¼Œç”±äºå…¶æœ¬èº«å°±æ˜¯ 64 ä½ï¼Œå°±å¯ä»¥ä¸ç”¨æŒ‡é’ˆæŒ‡å‘äº†ï¼Œè€Œæ˜¯å¯ä»¥ç›´æ¥å­˜åœ¨é”®å€¼å¯¹çš„ç»“æ„ä½“ä¸­ï¼Œè¿™æ ·å°±é¿å…äº†å†ç”¨ä¸€ä¸ªæŒ‡é’ˆï¼Œä»è€ŒèŠ‚çœäº†å†…å­˜ç©ºé—´ã€‚â€</span></span><br><span class=\"line\">        <span class=\"type\">void</span> *val;<span class=\"comment\">//è‡ªå®šä¹‰ç±»å‹</span></span><br><span class=\"line\">        <span class=\"type\">uint64_t</span> u64;<span class=\"comment\">//æ— ç¬¦å·æ•´å½¢</span></span><br><span class=\"line\">        <span class=\"type\">int64_t</span> s64;<span class=\"comment\">//ç¬¦åˆæ•´å½¢</span></span><br><span class=\"line\">        <span class=\"type\">double</span> d;<span class=\"comment\">//æµ®ç‚¹å‹</span></span><br><span class=\"line\">    &#125; v;</span><br><span class=\"line\">    <span class=\"class\"><span class=\"keyword\">struct</span> <span class=\"title\">dictEntity</span> *<span class=\"title\">next</span>;</span><span class=\"comment\">//å‘ç”Ÿå“ˆå¸Œå†²çªæ—¶ä½¿ç”¨ã€‚æŒ‡å‘ä¸‹ä¸€ä¸ªå“ˆå¸Œè¡¨èŠ‚ç‚¹ï¼Œå½¢æˆé“¾è¡¨</span></span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n\n<h3 id=\"HashTableæ¸è¿›å¼æ‰©å®¹\"><a href=\"#HashTableæ¸è¿›å¼æ‰©å®¹\" class=\"headerlink\" title=\"HashTableæ¸è¿›å¼æ‰©å®¹\"></a>HashTableæ¸è¿›å¼æ‰©å®¹</h3><p>æ¸è¿›å¼æ‰©å®¹ï¼Œé¡¾åæ€ä¹‰å°±æ˜¯ä¸€ç‚¹ä¸€ç‚¹æ‰©å®¹å®¹é‡ã€‚ç›¸æ¯”äºä¸€æ¬¡æ€§æ‰©å®¹å¤§é‡ç©ºé—´ï¼Œå¹¶è¿›è¡Œå¤§é‡çš„æ‹·è´å·¥ä½œï¼Œæ¸è¿›å¼æ‰©å®¹ä¸æ˜“å¯¼è‡´Redisåœ¨ä¸€æ®µæ—¶é—´å†…ç”±äºè¿›è¡Œæ‰©å®¹å·¥ä½œè€Œæ— æ³•æä¾›å…¶ä»–æœåŠ¡ï¼Œç”¨æˆ·ä½“éªŒæ„Ÿæ›´å¥½ã€‚</p>\n<p>å½“dictæ»¡è¶³æ‰©å®¹æ¡ä»¶åï¼Œå°±ä¼šè¿›è¡ŒRehashæ“ä½œã€‚Rehashæ“ä½œå¤§è‡´åˆ†ä¸ºä¸‰æ­¥ï¼š</p>\n<ul>\n<li><p>ä¸º<strong>ht[1]<strong>å“ˆå¸Œè¡¨å¼€è¾Ÿä¸€å—ç©ºé—´ï¼Œç©ºé—´å¤§å°è®¾å®šä¸º</strong>ç¬¬ä¸€ä¸ªå¤§äº2 * ht[0]çš„2æ•´æ•°æ¬¡å¹‚</strong>ã€‚ğŸŒ°ï¼šh[0] &#x3D; 500ï¼Œé‚£ä¹ˆåœ¨è¿›è¡ŒRehashæ“ä½œæ—¶å¼€è¾Ÿçš„ç©ºé—´ä¸º$2^{\\left\\lceil log_2(2*500) \\right\\rceil} &#x3D; 1024$</p>\n</li>\n<li><p>è¿ç§»ht[0]æ•°æ®è‡³ht[1]ï¼šåœ¨RehashæœŸé—´ï¼Œæ¯æ¬¡å¯¹å­—å…¸è¿›è¡Œå¢åˆ æ”¹æŸ¥æ“ä½œï¼Œç¨‹åºä¼šé¡ºå¸¦è¿ç§»å½“å‰<code>rehashidx</code>æ‰€æŒ‡å‘çš„æ•°æ®ï¼Œå¹¶é€’å¢ä¸‹æ ‡å€¼ã€‚å¦‚æœå½“å‰<code>rehashidx</code>å‘½ä¸­äº†ä¸€ä¸ªç©ºä½ç½®ï¼Œåˆ™ä¼šå…ˆå°è¯•ç»§ç»­å¾€åæŸ¥æ‰¾è‹¥å¹²ä½ç½®ï¼Œå¦‚æœæŸ¥è¯¢æ— æœå°±ç›´æ¥è¿”å›</p>\n</li>\n<li><p>æœ€ç»ˆï¼Œht[0]çš„æ•°æ®å°†ä¼šå…¨éƒ¨è¿ç§»è‡³ht[1]ä¸­ã€‚æ­¤æ—¶ï¼Œéœ€è¦äº¤æ¢ht[0]å’Œht[1]çš„æŒ‡é’ˆï¼Œå¹¶å°†<code>rehash</code>è®¾ä¸º-1ï¼Œè¡¨ç¤ºå¤„äºéRehashçŠ¶æ€</p>\n<ul>\n<li>ä¸ºä»€ä¹ˆè¦äº¤æ¢ä¸¤å¼ å“ˆå¸Œè¡¨çš„æŒ‡é’ˆå‘¢ï¼Ÿå› ä¸ºht[0]ä»£è¡¨ç€æ­£åœ¨ä½¿ç”¨çš„å“ˆå¸Œè¡¨</li>\n</ul>\n</li>\n</ul>\n<img src=\"https://raw.githubusercontent.com/lyydsheep/pic/main/202410122114045.png\" alt=\"image-20241012211414978\" style=\"zoom:80%;\" />\n\n<p>âš ï¸ï¼šå€¼å¾—æ³¨æ„çš„æ˜¯ï¼Œåœ¨Rehashé˜¶æ®µï¼Œç”±äºå­˜åœ¨ä¸¤å¼ å“ˆå¸Œè¡¨ï¼Œæ­¤æ—¶è¿›è¡Œçš„åˆ é™¤ã€æŸ¥æ‰¾ã€æ›´æ–°æ“ä½œä¼šåœ¨ä¸¤ä¸ªè¡¨ä¸Šè¿›è¡Œã€‚æ¯”å¦‚æŸ¥æ‰¾å…ƒç´ æ—¶ï¼Œå¦‚æœht[0]è¡¨æ²¡æœ‰æ‰¾åˆ°ï¼Œåˆ™ä¼šæ¥ç€æŸ¥è¯¢ht[1]è¡¨ã€‚ä½†è¿›è¡Œæ’å…¥æ“ä½œæ—¶ï¼Œåªä¼šåœ¨ht[1]è¡¨ä¸Šå¢æ·»æ•°æ®</p>\n<h3 id=\"æ‰©ï¼ˆç¼©ï¼‰å®¹æ—¶æœº\"><a href=\"#æ‰©ï¼ˆç¼©ï¼‰å®¹æ—¶æœº\" class=\"headerlink\" title=\"æ‰©ï¼ˆç¼©ï¼‰å®¹æ—¶æœº\"></a>æ‰©ï¼ˆç¼©ï¼‰å®¹æ—¶æœº</h3><p>HASHTABLEç”±ä¸€ä¸ªå˜é‡â€”â€”<strong>è´Ÿè½½å› å­</strong>å†³å®šæ˜¯å¦æ‰©å®¹ï¼ˆç¼©å®¹ï¼‰</p>\n<p><strong>è´Ÿè½½å› å­çš„ç®—æ³•ï¼š<code>ht[0].used / ht[0].size</code></strong></p>\n<p><strong>æ‰©å®¹åœºæ™¯ï¼š</strong></p>\n<ul>\n<li>è´Ÿè½½å› å­å¤§äºç­‰äº1å¹¶ä¸”æ­¤æ—¶æœåŠ¡å™¨æ²¡æœ‰æ‰§è¡ŒBGSAVEæˆ–BGREWRITEAOFè¿™ä¸¤ä¸ªå‘½ä»¤</li>\n<li>è´Ÿè½½å› å­å¤§äº5</li>\n</ul>\n<p><strong>ç¼©å®¹åœºæ™¯ï¼š</strong></p>\n<ul>\n<li>è´Ÿè½½å› å­å°äº0.1å¹¶ä¸”æ²¡æœ‰BGSAVEæˆ–BGWRITEAOFå‘½ä»¤åœ¨æ‰§è¡Œ</li>\n</ul>\n<h2 id=\"SkipList\"><a href=\"#SkipList\" class=\"headerlink\" title=\"SkipList\"></a>SkipList</h2><h2 id=\"è·³è¡¨çš„ç»“æ„\"><a href=\"#è·³è¡¨çš„ç»“æ„\" class=\"headerlink\" title=\"è·³è¡¨çš„ç»“æ„\"></a>è·³è¡¨çš„ç»“æ„</h2><p>è·³è¡¨æ˜¯Redisä¸­ZSETçš„åº•å±‚æ•°æ®ç»“æ„ï¼Œè·³è¡¨æœ¬è´¨ä¸Šå°±æ˜¯ç”±<strong>é“¾è¡¨+å¤šçº§ç´¢å¼•</strong>ç»„æˆçš„</p>\n<p>ä½†Redisä½¿ç”¨çš„è·³è¡¨å¹¶éæ ‡å‡†è·³è¡¨ï¼ŒRedisä¸­çš„è·³è¡¨åœ¨æ ‡å‡†è·³è¡¨åŸºç¡€ä¹‹ä¸Š<strong>å…è®¸scoreå€¼é‡å¤</strong>ä»¥åŠ<strong>0å±‚èŠ‚ç‚¹å…·æœ‰å‘åæŒ‡é’ˆ</strong>ï¼Œå¦‚ä¸‹å›¾æ‰€ç¤ºï¼š</p>\n<img src=\"https://raw.githubusercontent.com/lyydsheep/pic/main/202410141047754.png\" alt=\"image-20241014104743623\" style=\"zoom:67%;\" />\n\n<p>å…¶ä¸­çº¢è‰²æ¡†ä¸­çš„å±äºåŒä¸€ä¸ªèŠ‚ç‚¹çš„ä¸åŒå±‚çº§ï¼Œè·³è¡¨ä¸­èŠ‚ç‚¹çš„æ•°é‡ä½“ç°åœ¨0å±‚ï¼ˆæœ€åº•å±‚ï¼‰èŠ‚ç‚¹çš„ä¸ªæ•°</p>\n<p>ç»“åˆæºç ï¼Œåˆ†æèŠ‚ç‚¹çš„ç»„æˆï¼š</p>\n<figure class=\"highlight c\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\">// from Redis 7.0.8</span></span><br><span class=\"line\"><span class=\"comment\">/* ZSETs use a specialized version of Skiplists */</span></span><br><span class=\"line\"><span class=\"keyword\">typedef</span> <span class=\"class\"><span class=\"keyword\">struct</span> <span class=\"title\">zskiplistNode</span> &#123;</span></span><br><span class=\"line\">    sds ele;</span><br><span class=\"line\">    <span class=\"type\">double</span> score;</span><br><span class=\"line\">    <span class=\"class\"><span class=\"keyword\">struct</span> <span class=\"title\">zskiplistNode</span> *<span class=\"title\">backward</span>;</span></span><br><span class=\"line\">    <span class=\"class\"><span class=\"keyword\">struct</span> <span class=\"title\">zskiplistLevel</span> &#123;</span></span><br><span class=\"line\">        <span class=\"class\"><span class=\"keyword\">struct</span> <span class=\"title\">zskiplistNode</span> *<span class=\"title\">forward</span>;</span></span><br><span class=\"line\">        <span class=\"type\">unsigned</span> <span class=\"type\">long</span> span;</span><br><span class=\"line\">    &#125; level[];</span><br><span class=\"line\">&#125; zskiplistNode;</span><br></pre></td></tr></table></figure>\n\n<ul>\n<li><strong>ele</strong>ï¼šsdsç»“æ„ï¼Œä¸€ä¸ªè¢«å°è£…è¿‡çš„å­—ç¬¦ä¸²ï¼Œæœ¬è´¨ä¸Šæ˜¯ä¸€ä¸ªcharæ•°ç»„ï¼Œç”¨äºå­˜å‚¨æ•°æ®</li>\n<li><strong>score</strong>ï¼šåŒç²¾åº¦æµ®ç‚¹æ•°ç±»å‹ï¼Œè¡¨ç¤ºè¯¥èŠ‚ç‚¹çš„åˆ†æ•°ï¼Œå†³å®šäº†è·³è¡¨ä¸­èŠ‚ç‚¹çš„ä½ç½®æ¬¡åº</li>\n<li><strong>backward</strong>ï¼šæŒ‡å‘ä¸Šä¸€ä¸ªèŠ‚ç‚¹çš„å›é€€æŒ‡é’ˆ</li>\n<li><strong>level</strong>ï¼šæ˜¯ä¸€ä¸ªzskiplistLeveç»“æ„ä½“æ•°ç»„ï¼Œç”¨äºè¡¨ç¤ºé«˜å±‚ç´¢å¼•ã€‚zskiplistLeveç»“æ„ä½“åŒ…å«äº†ä¸¤ä¸ªå­—æ®µï¼Œä¸€ä¸ªæ˜¯<strong>forward</strong>ï¼ŒæŒ‡å‘åŒå±‚çš„ä¸‹ä¸€ä¸ªç´¢å¼•ï¼›å¦ä¸€ä¸ªæ˜¯<strong>span</strong>ï¼Œè®°å½•äº†è·ç¦»ä¸‹ä¸€ä¸ªç´¢å¼•ï¼ˆèŠ‚ç‚¹ï¼‰çš„æ­¥é•¿</li>\n</ul>\n<p>ç¤ºæ„å›¾ï¼š</p>\n<img src=\"https://raw.githubusercontent.com/lyydsheep/pic/main/202410141101384.png\" alt=\"image-20241014110129253\" style=\"zoom:67%;\" />\n\n<h3 id=\"å®ç°ç»†èŠ‚\"><a href=\"#å®ç°ç»†èŠ‚\" class=\"headerlink\" title=\"å®ç°ç»†èŠ‚\"></a>å®ç°ç»†èŠ‚</h3><ul>\n<li><p>Redis<strong>è·³è¡¨ä¸­å•ä¸ªèŠ‚ç‚¹çš„å±‚æ•°</strong>ç”±æ¦‚ç‡å†³å®šã€‚æ¯æ’å…¥ä¸€ä¸ªèŠ‚ç‚¹åˆ°0å±‚ï¼ŒRediså†³å®šè¯¥èŠ‚ç‚¹æ˜¯å¦å¢åŠ ä¸€å±‚ç´¢å¼•çš„<strong>æ¦‚ç‡ä¸º25%</strong></p>\n</li>\n<li><p>è·³è¡¨å°†çº¯ç²¹çš„æœ‰åºå•é“¾è¡¨åœ¨æ’å…¥ã€åˆ é™¤ã€æ›´æ–°æ“ä½œä»$O(n)$æ—¶é—´å¤æ‚åº¦é™ä½è‡³$O(logN)$</p>\n</li>\n</ul>\n<h2 id=\"ZSet\"><a href=\"#ZSet\" class=\"headerlink\" title=\"ZSet\"></a>ZSet</h2><p>Zsetä¹Ÿå«Sorted Setå³æœ‰åºé›†åˆï¼Œæ˜¯æŒ‰ç…§å…ƒç´ çš„åˆ†æ•°è¿›è¡Œæ’åºçš„é›†åˆã€‚åˆ†æ•°ç›¸åŒçš„æƒ…å†µä¸‹ï¼ŒæŒ‰ç…§å…ƒç´ çš„å­—å…¸åºè¿›è¡Œæ’åº</p>\n<p>ZSetå¸¸ç”¨äºæ’åºé›†åˆçš„åœºæ™¯ï¼Œæœ€å…¸å‹çš„å°±æ˜¯<strong>æ¸¸æˆæ’è¡Œæ¦œ</strong></p>\n<h3 id=\"ç¼–ç æ–¹å¼-1\"><a href=\"#ç¼–ç æ–¹å¼-1\" class=\"headerlink\" title=\"ç¼–ç æ–¹å¼\"></a>ç¼–ç æ–¹å¼</h3><p>ZSetæœ‰ä¸¤ç§åº•å±‚ç¼–ç æ–¹å¼ï¼Œä¸€ç§æ˜¯ZIPLISTï¼Œå¦ä¸€ç§æ˜¯SKIPLIST+HASHTABLE</p>\n<img src=\"https://raw.githubusercontent.com/lyydsheep/pic/main/202410141759086.png\" alt=\"image-20241014175901004\" style=\"zoom:67%;\" />\n\n<p>å¦‚æœæ»¡è¶³ä¸‹åˆ—æ¡ä»¶ï¼ŒZSetå°±ç”¨ZIPLISTç¼–ç æ–¹å¼ï¼š</p>\n<ul>\n<li>åˆ—è¡¨å¯¹è±¡ä¿å­˜çš„æ‰€æœ‰å­—ç¬¦ä¸²é•¿åº¦å‡å°äº64å­—èŠ‚</li>\n<li>åˆ—è¡¨å¯¹è±¡ä¿å­˜çš„å…ƒç´ ä¸ªæ•°å°‘äº128ä¸ª</li>\n</ul>\n<p>ZIPLISTä¾æ—§ä¿æŒç€å®ƒçš„ä¼˜ç‚¹ï¼Œåœ¨æ•°æ®é‡è¾ƒå°‘æ—¶ï¼Œååˆ†èŠ‚çº¦å†…å­˜ç©ºé—´ã€‚å½“ZSeté‡‡ç”¨ZIPLISTç¼–ç æ—¶ï¼Œåº•å±‚ç»“æ„å¦‚ä¸‹å›¾ï¼š</p>\n<img src=\"https://raw.githubusercontent.com/lyydsheep/pic/main/202410141802693.png\" alt=\"image-20241014180256647\" style=\"zoom:67%;\" />\n\n<p>ä½†å‡¡ä¸Šè¿°çš„ä¸¤ä¸ªæ¡ä»¶æœ‰ä¸€ä¸ªä¸æ»¡è¶³ï¼ŒZSetå°±é‡‡ç”¨<strong>SKIPLIST+HASHTABLE</strong>çš„ç¼–ç æ–¹å¼ã€‚å…¶ä¸­ï¼ŒSKIPLISTæ˜¯ä¸€ä¸ªå…·æœ‰å¤šçº§ç´¢å¼•çš„æœ‰åºé“¾è¡¨ï¼Œ<strong>å¯ä»¥å®ç°é«˜æ•ˆçš„æŸ¥è¯¢ã€æ’å…¥ã€åˆ é™¤æ“ä½œ</strong>ã€‚é™¤æ­¤ä¹‹å¤–ï¼ŒRedisè¿˜åˆ©ç”¨HASHTABLEç»“æ„å®ç°åœ¨$O(1)$æ—¶é—´å¤æ‚åº¦ä¸‹<strong>æŸ¥è¯¢åˆ°ZSetä¸­ä»»ä¸€æˆå‘˜çš„<code>score</code>å€¼</strong></p>\n","excerpt":"","more":"<h1 id=\"Rediså¯¹è±¡\"><a href=\"#Rediså¯¹è±¡\" class=\"headerlink\" title=\"Rediså¯¹è±¡\"></a>Rediså¯¹è±¡</h1><h2 id=\"String\"><a href=\"#String\" class=\"headerlink\" title=\"String\"></a>String</h2><p>Stringå°±æ˜¯å­—ç¬¦ä¸²ï¼Œæ˜¯Redisä¸­çš„ä¸€ä¸ªæœ€åŸºæœ¬æ•°æ®å¯¹è±¡ï¼Œæœ€å¤§å­˜å‚¨æ•°æ®<strong>512MB</strong></p>\n<h3 id=\"Setæ“ä½œ\"><a href=\"#Setæ“ä½œ\" class=\"headerlink\" title=\"Setæ“ä½œ\"></a>Setæ“ä½œ</h3><p>åŸºæœ¬è¯­æ³•ï¼š**<code>set key value [expiration EX seconds | PX milliseconds] [NX|XX]</code>**</p>\n<p>Setæ“ä½œç”¨äºåœ¨Redisä¸­è®¾ç½®ä¸€ä¸ªK-Vå¯¹ï¼Œå…¶ä¸­å‡ ä¸ªæ‰©å±•å‚æ•°ä½œç”¨åˆ†åˆ«å¦‚ä¸‹ï¼š</p>\n<ul>\n<li><strong>EX seconds</strong>ï¼šè®¾ç½®K-Vå¯¹çš„è¿‡æœŸæ—¶é—´ä¸ºå¤šå°‘ç§’</li>\n<li><strong>PX milliseconds</strong>ï¼šè®¾ç½®K-Vå¯¹çš„è¿‡æœŸæ—¶é—´ä¸ºå¤šå°‘æ¯«ç§’</li>\n<li><strong>NX</strong>ï¼šåªæœ‰å½“Keyä¸å­˜åœ¨æ—¶ï¼Œå‘½ä»¤æ‰ç”Ÿæ•ˆï¼Œç›¸å½“äº<code>setnx key value</code></li>\n<li><strong>XX</strong>ï¼šåªæœ‰å½“Keyå­˜åœ¨æ—¶ï¼Œå‘½ä»¤æ‰ç”Ÿæ•ˆ</li>\n</ul>\n<p>âš ï¸ï¼šå¯¹ä¸€ä¸ªå·²ç»å­˜åœ¨Keyè¿›è¡Œsetæ“ä½œä¼š<strong>å°†åŸæœ‰å€¼è¦†ç›–</strong>ï¼Œå¯èƒ½ä¼šå¯¼è‡´<strong>åŸæœ‰å€¼ä¸¢å¤±ã€æ“¦é™¤è¿‡æœŸæ—¶é—´ã€ä¸¢å¤±åŸæœ‰å€¼ç±»å‹</strong></p>\n<h3 id=\"ä¸‰ç§ç¼–ç æ–¹å¼\"><a href=\"#ä¸‰ç§ç¼–ç æ–¹å¼\" class=\"headerlink\" title=\"ä¸‰ç§ç¼–ç æ–¹å¼\"></a>ä¸‰ç§ç¼–ç æ–¹å¼</h3><p>Stringå¯¹è±¡åº•å±‚é‡‡ç”¨ä¸‰ç§ä¸åŒçš„ç¼–ç æ–¹å¼ä»¥é«˜æ•ˆåº”å¯¹å„ç§åœºæ™¯</p>\n<ul>\n<li><strong>INTç¼–ç </strong>ï¼šç”¨äºå­˜å‚¨longèŒƒå›´å†…çš„<strong>æ•´æ•°</strong><ul>\n<li>âš ï¸ï¼šå¦‚æœæ˜¯æµ®ç‚¹æ•°ï¼Œåˆ™ä¸èƒ½ä½¿ç”¨INTç¼–ç ã€‚å› ä¸ºINTç¼–ç åªèƒ½ç”¨äºè¡¨ç¤ºæ•´æ•°</li>\n</ul>\n</li>\n<li><strong>EMBSTRç¼–ç </strong>ï¼šå¦‚æœå­—ç¬¦ä¸²çš„å¤§å°å°äºé˜ˆå€¼å­—èŠ‚ï¼Œåˆ™é‡‡ç”¨æ­¤æ–¹å¼</li>\n<li><strong>RAWç¼–ç </strong>ï¼šå¦‚æœå­—ç¬¦ä¸²çš„å¤§å°å¤§äºé˜ˆå€¼å­—èŠ‚ï¼Œåˆ™é‡‡ç”¨æ­¤æ–¹å¼</li>\n</ul>\n<p>EMBSTRç¼–ç å’ŒRAWç¼–ç æ–¹å¼åœ¨åº•å±‚å®ç°ä¸­éƒ½æ˜¯ç”±redisObjectå’ŒSDSä¸¤ä¸ªç»“æ„ç»„æˆï¼ŒåŒºåˆ«åœ¨äº<strong>è¿™ä¸¤ä¸ªç»“æ„åœ¨ç‰©ç†å†…å­˜ä¸Šæ˜¯å¦è¿ç»­ï¼ˆä¸ºä¸€æ•´ä½“ï¼‰</strong></p>\n<p>EMBSTRåœ¨å†…å­˜ä¸­çš„è¡¨ç¤ºï¼š</p>\n<p><img src=\"https://raw.githubusercontent.com/lyydsheep/pic/main/202410031004350.png\" alt=\"image-20241003100407308\"></p>\n<p>RAWåœ¨å†…å­˜ä¸­çš„è¡¨ç¤ºï¼š</p>\n<p><img src=\"https://raw.githubusercontent.com/lyydsheep/pic/main/202410031004128.png\" alt=\"image-20241003100440097\"></p>\n<h4 id=\"ä¸‰ç§ç¼–ç æ–¹å¼çš„è½¬æ¢å…³ç³»\"><a href=\"#ä¸‰ç§ç¼–ç æ–¹å¼çš„è½¬æ¢å…³ç³»\" class=\"headerlink\" title=\"ä¸‰ç§ç¼–ç æ–¹å¼çš„è½¬æ¢å…³ç³»\"></a>ä¸‰ç§ç¼–ç æ–¹å¼çš„è½¬æ¢å…³ç³»</h4><p>éšç€å¯¹Redisçš„æ“ä½œï¼ŒStringå¯¹è±¡çš„ç¼–ç æ–¹å¼å¯èƒ½æœ‰å¦‚ä¸‹å˜åŒ–ï¼š</p>\n<p>INT â€“&gt; RAWï¼šå½“å­˜å‚¨çš„å†…å®¹ä¸å†æ˜¯æ•´æ•°æˆ–å¤§å°è¶…è¿‡longèŒƒå›´ï¼Œåˆ™éœ€è¦å°†INTç¼–ç è½¬æ¢ä¸ºRAWç¼–ç </p>\n<p>EMBSTR â€“&gt; RAWï¼šç”±äºEMBSTRç¼–ç çš„Stringå¯¹è±¡æ˜¯<strong>åªè¯»</strong>çš„ï¼Œæ‰€ä»¥å¯¹ä¸€ä¸ªEMBSTRè¿›è¡Œå†™æ“ä½œæ—¶ï¼Œå°±ä¼šå°†å…¶ç¼–ç æ–¹å¼æ”¹ä¸ºRAWã€‚è¿™æ˜¯å› ä¸ºä¿®æ”¹æ•°æ®å°±è¦é‡æ–°åˆ†é…å­˜å‚¨ç©ºé—´ï¼Œè€ŒEMBSTRä¸­redisObjectå’ŒSDSæ˜¯è¿ç»­çš„ï¼Œä¸æ˜“åˆ†é…ç©ºé—´ã€‚å¹¶ä¸”åªè¦è¿›è¡Œä¿®æ”¹æ“ä½œé‚£ä¹ˆå°±èƒ½è®¤ä¸ºè¿™ä¸ªStringæ˜¯æ˜“å˜çš„ã€ä¸ç¨³å®šçš„ï¼Œé‡‡ç”¨RAWç¼–ç æ–¹å¼èƒ½å¤Ÿå‡å°‘é¢‘ç¹å¯¹EMBSTRå†…å­˜åˆ†é…çš„æ€§èƒ½æŸè€—</p>\n<h3 id=\"SDSç»“æ„\"><a href=\"#SDSç»“æ„\" class=\"headerlink\" title=\"SDSç»“æ„\"></a>SDSç»“æ„</h3><p>ä¸ç®¡æ˜¯EMBSTRè¿˜æ˜¯RAWï¼Œéƒ½æœ‰ä¸€ä¸ªSDSç»“æ„ï¼ŒSDSç»“æ„æ˜¯ä¸ºäº†è§£å†³Cè¯­è¨€ä¸­å­—ç¬¦ä¸²çš„å°´å°¬å¤„å¢ƒ</p>\n<ul>\n<li>è®¡ç®—å­—ç¬¦ä¸²é•¿åº¦éœ€è¦éå†ï¼Œæ—¶é—´å¤æ‚åº¦$$O(n)$$</li>\n<li>å¯¹å­—ç¬¦ä¸²è¿½åŠ å†…å®¹éœ€è¦æ‰©å®¹æ“ä½œ</li>\n<li>äºŒè¿›åˆ¶ä¸å®‰å…¨<ul>\n<li>äºŒè¿›åˆ¶å®‰å…¨æ˜¯æŒ‡å…¬å¹³å¯¹å¾…æ¯ä¸€ä¸ªå­—ç¬¦ï¼Œä¸ç‰¹æ®Šå¤„ç†ä»»ä½•å­—ç¬¦</li>\n<li>Cè¯­è¨€ä¸­å­—ç¬¦ä¸²ç‰¹æ®Šå¤„ç†<code>\\0</code>ä¸ºå­—ç¬¦ä¸²ç»“å°¾</li>\n</ul>\n</li>\n</ul>\n<p>SDSç»“æ„å…·ä½“ç”±ä¸€ä¸‹å­—æ®µç»„æˆï¼š</p>\n<figure class=\"highlight c\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"class\"><span class=\"keyword\">struct</span> __<span class=\"title\">attribute__</span> ((__<span class=\"title\">packed__</span>)) <span class=\"title\">sdshdr8</span> &#123;</span></span><br><span class=\"line\">    <span class=\"type\">uint8_t</span> len;</span><br><span class=\"line\">    <span class=\"type\">uint8_t</span> alloc;</span><br><span class=\"line\">    <span class=\"type\">unsigned</span> <span class=\"type\">char</span> flags;</span><br><span class=\"line\">    <span class=\"type\">char</span> buf[];</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n\n<ul>\n<li><strong>len</strong>ï¼šè¡¨ç¤ºå­—ç¬¦ä¸²é•¿åº¦ï¼Œ<strong>å¯ä»¥å¿«é€Ÿè¿”å›å­—ç¬¦ä¸²é•¿åº¦ï¼Œå¹¶ä¸”ä¸éœ€è¦<code>\\0</code>ä½œä¸ºç»“å°¾ç¬¦å·</strong></li>\n<li><strong>alloc</strong>ï¼šè¡¨ç¤ºåˆ†é…äº†å¤šå°‘å†…å­˜ç©ºé—´ï¼Œ<strong>å…·æœ‰ä¸€å®šçš„é¢„ç•™ç©ºé—´ï¼Œæ— éœ€è¿›è¡Œæ‰©å®¹æ“ä½œ</strong></li>\n<li><strong>flags</strong>ï¼šç”¨äºåŒºåˆ†å…·ä½“æ˜¯ä»€ä¹ˆç±»å‹çš„SDS<ul>\n<li>åœ¨Redisä¸­SDSåˆ†ä¸ºsdshdr8ã€sdshdr16ã€sdshdr32ã€sdshdr64</li>\n</ul>\n</li>\n</ul>\n<h2 id=\"List\"><a href=\"#List\" class=\"headerlink\" title=\"List\"></a>List</h2><p>3.2ç‰ˆæœ¬ä¹‹å‰ï¼ŒListå¯¹è±¡æœ‰ä¸¤ç§ç¼–ç æ–¹å¼</p>\n<ul>\n<li>ZIPLIST</li>\n<li>LINKLIST</li>\n</ul>\n<p>å½“æ»¡è¶³ä»¥ä¸‹æ¡ä»¶æ—¶ï¼Œé‡‡ç”¨ZIPLISTç¼–ç æ–¹å¼</p>\n<ul>\n<li>åˆ—è¡¨å¯¹è±¡ä¸­æ‰€æœ‰å­˜å‚¨çš„å­—ç¬¦ä¸²å¯¹è±¡é•¿åº¦éƒ½å°äº64å­—èŠ‚</li>\n<li>åˆ—è¡¨å¯¹è±¡ä¸­å­˜å‚¨çš„å¯¹è±¡æ•°é‡ä¸è¶…è¿‡512ä¸ªï¼ˆè¿™æ˜¯LISTçš„é™åˆ¶ï¼Œè€Œä¸æ˜¯ZIPLISTçš„é™åˆ¶ï¼‰</li>\n</ul>\n<p>ğŸŒ°ï¼š</p>\n<p><img src=\"https://raw.githubusercontent.com/lyydsheep/pic/main/202410051125337.png\" alt=\"image-20241005112548274\"></p>\n<p>ZIPLISTä¸­æ•°æ®éƒ½æ˜¯ç´§å¯†æ’åˆ—çš„ï¼Œåœ¨æ•°æ®é‡å°çš„æ—¶å€™å¯ä»¥æœ‰æ•ˆèŠ‚çº¦å†…å­˜ï¼›è€ŒLINKLISTé¡¾åæ€ä¹‰ï¼Œæ•°æ®æ˜¯ä»¥é“¾è¡¨å½¢å¼ä¸²è”èµ·æ¥çš„ï¼Œåœ¨æ•°æ®é‡å¤§çš„æ—¶å€™é‡‡ç”¨LINKLISTç¼–ç å¯ä»¥åŠ å¿«å¤„ç†æ€§èƒ½</p>\n<p>ğŸŒ°ï¼š</p>\n<p><img src=\"https://raw.githubusercontent.com/lyydsheep/pic/main/202410051126746.png\" alt=\"image-20241005112658713\"></p>\n<h3 id=\"QUICKLIST\"><a href=\"#QUICKLIST\" class=\"headerlink\" title=\"QUICKLIST\"></a>QUICKLIST</h3><p>ZIPLISTåœ¨æ•°æ®è¾ƒå°‘æ—¶èŠ‚çº¦å†…å­˜ï¼ŒLINKLISTæ˜¯ä¸ºäº†åœ¨æ•°æ®è¾ƒå¤šæ—¶æé«˜æ›´æ–°æ•ˆç‡ã€‚ä½†æ˜¯ZIPLISTåœ¨æ•°æ®ç¨å¤šæ—¶æ’å…¥æ•°æ®ä¼šå¯¼è‡´å¤§é‡æ•°æ®å¤åˆ¶ï¼Œå ç”¨å†…å­˜ç©ºé—´ï¼›åŒæ ·åœ°ï¼ŒLINKLISTç”±äºèŠ‚ç‚¹æ•°é‡ä¹Ÿå¼‚å¸¸å¤šï¼Œä¹Ÿä¼šå ç”¨ä¸å°‘å†…å­˜</p>\n<p>åŸºäºä¸Šè¿°é—®é¢˜ï¼Œ3.2ç‰ˆæœ¬å°±å¼•å…¥äº†QUICKLISTã€‚QUICKLISTæœ¬è´¨å°±æ˜¯<strong>ZIPLISTå’ŒLINKLISTçš„ç»“åˆä½“</strong></p>\n<p>QUICKLISTçš„å®ç°æ€è·¯æ˜¯ï¼Œå°†åŸæœ¬LINKLISTçš„<strong>å•ä¸ªèŠ‚ç‚¹å­˜å‚¨å•ä¸ªæ•°æ®</strong>çš„æ¨¡å¼ï¼Œæ›´æ¢æˆä¸€ä¸ª<strong>å•ä¸ªèŠ‚ç‚¹ï¼ˆZIPLISTï¼‰å­˜å‚¨å¤šä¸ªæ•°æ®</strong>çš„å½¢å¼</p>\n<p><img src=\"https://raw.githubusercontent.com/lyydsheep/pic/main/202410051135173.png\" alt=\"image-20241005113525108\"></p>\n<p>å½“æ•°æ®è¾ƒå°‘æ—¶ï¼ŒQUICKLISTèŠ‚ç‚¹åªæœ‰ä¸€ä¸ªï¼Œé€€åŒ–æˆZIPLIST</p>\n<p>å½“æ•°æ®è¾ƒå¤šæ—¶ï¼Œåˆ™åŒæ—¶åˆ©ç”¨äº†ZIPLISTå’ŒLINKLISTçš„ä¼˜åŠ¿</p>\n<h2 id=\"å‹ç¼©åˆ—è¡¨\"><a href=\"#å‹ç¼©åˆ—è¡¨\" class=\"headerlink\" title=\"å‹ç¼©åˆ—è¡¨\"></a>å‹ç¼©åˆ—è¡¨</h2><p>å‹ç¼©åˆ—è¡¨ä½œä¸ºListçš„åº•å±‚æ•°æ®ç»“æ„ï¼Œæä¾›äº†ç´§å‡‘å‹çš„æ•°æ®å­˜å‚¨æ–¹å¼ï¼Œèƒ½èŠ‚çº¦å†…å­˜ï¼Œå°æ•°æ®é‡çš„æ—¶å€™éå†è®¿é—®æ€§èƒ½å¥½ï¼ˆè¿ç»­+å±€éƒ¨æ€§ä¼˜åŠ¿ï¼‰</p>\n<h3 id=\"ZIPLISTæ•´ä½“ç»“æ„\"><a href=\"#ZIPLISTæ•´ä½“ç»“æ„\" class=\"headerlink\" title=\"ZIPLISTæ•´ä½“ç»“æ„\"></a>ZIPLISTæ•´ä½“ç»“æ„</h3><p>åœ¨Redisä»£ç æ³¨é‡Šä¸­ï¼Œæœ‰å¯¹ZIPLISTæ¸…æ™°åœ°æè¿°ï¼š</p>\n<figure class=\"highlight c\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\">/* The general layout of the ziplist is as follows:</span></span><br><span class=\"line\"><span class=\"comment\"></span></span><br><span class=\"line\"><span class=\"comment\">&lt;zlbytes&gt; &lt;zltail&gt; &lt;zllen&gt; &lt;entry&gt; &lt;entry&gt; &lt;entry&gt; ... &lt;entry&gt; &lt;zlend&gt;</span></span><br><span class=\"line\"><span class=\"comment\">*/</span></span><br></pre></td></tr></table></figure>\n\n<p>ğŸŒ°ï¼šä¸€ä¸ªå…·æœ‰ä¸‰ä¸ªèŠ‚ç‚¹çš„ZIPLIST</p>\n<p><img src=\"https://raw.githubusercontent.com/lyydsheep/pic/main/202410081615659.png\" alt=\"image-20241008161508590\"></p>\n<p><strong>zlbytes</strong>å­—æ®µè¡¨ç¤ºè¯¥ZIPLISTä¸€å…±å ç”¨äº†å¤šå°‘å­—èŠ‚ï¼ˆåŒ…å«zlbyteså­—æ®µçš„å¤§å°ï¼‰</p>\n<p><strong>zltail</strong>å­—æ®µè¡¨ç¤ºæœ€åä¸€ä¸ª<strong>æ•°æ®èŠ‚ç‚¹ï¼ˆentryï¼‰</strong>è·ç¦»ZIPLISTé¦–éƒ¨çš„åç§»å­—èŠ‚æ•°ï¼Œå¦‚æœZIPLISTä¸ºç©ºï¼ˆå³æœ¨æœ‰entryï¼‰ï¼Œåˆ™æŒ‡ç¤º<strong>zlend</strong>å­—æ®µçš„åç§»é‡</p>\n<blockquote>\n<p>å¾ˆæ˜¾ç„¶ï¼Œä¼šæœ‰å¦‚ä¸‹ç­‰å¼ï¼š</p>\n<p>zlbytes &#x3D; zltial + æœ€åä¸€ä¸ªentryå¤§å°ï¼ˆå¯èƒ½ä¸ºé›¶ï¼‰ + zlendå¤§å°</p>\n</blockquote>\n<p><strong>zllen</strong>å­—æ®µè¡¨ç¤ºZIPLISTç»“æ„ä¸­entryçš„ä¸ªæ•°ï¼Œä½†ç”±äºè¯¥å­—æ®µåªå ç”¨2å­—èŠ‚ç©ºé—´ï¼Œæ‰€ä»¥æœ€å¤šåªèƒ½è¡¨ç¤º65535ä¸ªã€‚å½“å…ƒç´ ä¸ªæ•°è¿‡å¤šï¼Œåªèƒ½é€šè¿‡<strong>éå†</strong>çš„æ–¹å¼è·å–å…ƒç´ ä¸ªæ•°</p>\n<p><strong>zlend</strong>å­—æ®µæ˜¯ä¸€ä¸ªç‰¹æ®ŠèŠ‚ç‚¹ï¼Œæ ‡è¯†ZIPLISTç»“æ„çš„ç»“æŸ</p>\n<p><strong>entry</strong>å­—æ®µè¡¨ç¤ºä¸€ä¸ªæ•°æ®èŠ‚ç‚¹ï¼Œå®é™…ä¸Šä¹Ÿæ˜¯ä¸€ä¸ªç»“æ„ä½“ç±»å‹ã€‚è¯¥ç±»å‹ç”±ä¸‰ä¸ªå­—æ®µæ„æˆï¼Œåˆ†åˆ«æ˜¯</p>\n<figure class=\"highlight c\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">&lt;prevlen&gt; &lt;encoding&gt; &lt;entry-data&gt;</span><br></pre></td></tr></table></figure>\n\n<h3 id=\"entryç»“æ„\"><a href=\"#entryç»“æ„\" class=\"headerlink\" title=\"entryç»“æ„\"></a>entryç»“æ„</h3><p><strong><code>prevlen</code><strong>å­—æ®µè¡¨ç¤º</strong>ä¸Šä¸€ä¸ªæ•°æ®èŠ‚ç‚¹ï¼ˆentryï¼‰çš„é•¿åº¦</strong>ï¼Œå¦‚æœé•¿åº¦<strong>å°äº254</strong>ï¼Œé‚£ä¹ˆ**<code>prevlen</code><strong>å­—æ®µå ç”¨1å­—èŠ‚ç©ºé—´ï¼›å¦‚æœé•¿åº¦</strong>å¤§äºç­‰äº254<strong>ï¼Œé‚£ä¹ˆè¯¥å­—æ®µéœ€è¦ç”¨5å­—èŠ‚ç©ºé—´è¡¨ç¤ºï¼Œå¹¶ä¸”</strong>ç¬¬ä¸€ä¸ªå­—èŠ‚ä¸º11111110**ï¼Œè¡¨ç¤ºè¿™æ˜¯ä¸€ä¸ª5å­—èŠ‚çš„<code>prevlen</code>ä¿¡æ¯ï¼Œå‰©ä¸‹çš„4å­—èŠ‚ç”¨æ¥è¡¨ç¤ºé•¿åº¦</p>\n<p>âš ï¸ï¼šä¸ºä»€ä¹ˆé˜ˆå€¼æ˜¯254è€Œä¸æ˜¯255ï¼Ÿè¿™æ˜¯å› ä¸º255è¢«ç”¨æ¥ç‰¹æ®Šè¡¨ç¤º<strong>zlend</strong>å­—æ®µï¼Œæ ‡è¯†ZIPLISTç»“æ„çš„ç»“æŸ</p>\n<p><strong><code>encoding</code><strong>å­—æ®µæ˜¯ä¸€ä¸ªæ•´å½¢æ•°æ®ï¼Œå…¶äºŒè¿›åˆ¶ç¼–ç ç”±</strong>å†…å®¹ç±»å‹</strong>å’Œ<strong>å†…å®¹æ•°æ®çš„å­—èŠ‚é•¿åº¦</strong>ä¸¤éƒ¨åˆ†ç»„æˆ</p>\n<h3 id=\"è¿é”æ›´æ–°\"><a href=\"#è¿é”æ›´æ–°\" class=\"headerlink\" title=\"è¿é”æ›´æ–°\"></a>è¿é”æ›´æ–°</h3><p>å½“å‘ä¸€ä¸ªentryå‰é¢æ’å…¥ä¸€ä¸ªé•¿åº¦è¶…è¿‡254çš„èŠ‚ç‚¹æ—¶ï¼Œ<code>prevlen</code>å­—æ®µå¯èƒ½å°±ä¼šç”±1å­—èŠ‚å˜æˆ5å­—èŠ‚ï¼Œå¯¼è‡´æœ¬entryé•¿åº¦å¢å¤§ã€‚å¦‚æœè¿æ°”ä¸æ˜¯å¾ˆå¥½ï¼Œå°†ä¼šå¯¼è‡´ä¸‹ä¸€ä¸ªèŠ‚ç‚¹ä¸­çš„<code>prevlen</code>å­—æ®µå¢åŠ ï¼Œä»¥æ­¤ç±»æ¨ï¼Œé€ æˆè¿é”ååº”ï¼Œè¿™å°±æ˜¯è¿é”æ›´æ–°é—®é¢˜ã€‚</p>\n<p><img src=\"https://raw.githubusercontent.com/lyydsheep/pic/main/202410081855045.png\" alt=\"image-20241008185552935\"></p>\n<h4 id=\"LISTPACKä¼˜åŒ–\"><a href=\"#LISTPACKä¼˜åŒ–\" class=\"headerlink\" title=\"LISTPACKä¼˜åŒ–\"></a>LISTPACKä¼˜åŒ–</h4><p><code>prevlen</code>å­—æ®µæ­£æ˜¯è¿é”æ›´æ–°çš„ç½ªé­ç¥¸é¦–ï¼Œä¸ºäº†è§£å†³è¿é”æ›´æ–°é—®é¢˜ï¼Œå°±ä¸èƒ½å†å»è®°å½•ä¸Šä¸€ä¸ªèŠ‚ç‚¹çš„é•¿åº¦ï¼Œä½†åˆè¦ä¿è¯èƒ½å¤Ÿå®ç°å€’åºéå†ï¼ˆæ‰¾åˆ°ä¸Šä¸€ä¸ªèŠ‚ç‚¹çš„ä½ç½®ï¼‰</p>\n<p>Redisä½¿ç”¨äº†ä¸€ç§å·§å¦™çš„æ–¹æ³•ï¼šåˆ é™¤<code>prevlen</code>å­—æ®µï¼Œ<strong>æ–°å¢<code>element-tot-len</code>å­—æ®µè®°å½•æ•´ä¸ªèŠ‚ç‚¹é™¤å®ƒï¼ˆelement-tot-lenå­—æ®µï¼‰è‡ªèº«ä¹‹å¤–çš„é•¿åº¦</strong></p>\n<p>æ­¤æ—¶èŠ‚ç‚¹ç»“æ„å°±å˜æˆäº†ï¼š</p>\n<figure class=\"highlight c\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">&lt;encoding-type&gt; &lt;element-data&gt; &lt;element-top-len&gt;</span><br></pre></td></tr></table></figure>\n\n<ul>\n<li>encoding-typeæ˜¯ç¼–ç ç±»å‹</li>\n<li>element-dataæ˜¯æ•°æ®å†…å®¹</li>\n<li>element-top-lenæ‰€å çš„æ¯ä¸ªå­—èŠ‚çš„ç¬¬ä¸€ä¸ªbitä½ç”¨äºæ ‡è¯†æ˜¯å¦ç»“æŸï¼Œ0åˆ™ç»“æŸï¼Œ1åˆ™ç»§ç»­</li>\n</ul>\n<p>ğŸŒ°ï¼š<img src=\"https://raw.githubusercontent.com/lyydsheep/pic/main/202410081903663.png\" alt=\"image-20241008190334625\"></p>\n<h2 id=\"Set\"><a href=\"#Set\" class=\"headerlink\" title=\"Set\"></a>Set</h2><p>Rediä¸­çš„setæ˜¯ä¸€ä¸ªä¸é‡å¤ã€æ— åºçš„å­—ç¬¦ä¸²é›†åˆ</p>\n<blockquote>\n<p>å¦‚æœSetåº•å±‚ä½¿ç”¨INTSETç¼–ç æ–¹å¼ï¼Œåˆ™é›†åˆæ˜¯æœ‰åºçš„</p>\n</blockquote>\n<h3 id=\"ç¼–ç æ–¹å¼\"><a href=\"#ç¼–ç æ–¹å¼\" class=\"headerlink\" title=\"ç¼–ç æ–¹å¼\"></a>ç¼–ç æ–¹å¼</h3><p>Setåº•å±‚æœ‰ä¸¤ç§ç¼–ç æ–¹å¼ï¼š<strong>INTSETã€HASHTABLE</strong></p>\n<p>å½“Setä¸­å­˜å‚¨çš„éƒ½æ˜¯æ•´æ•°å¹¶ä¸”å…ƒç´ ä¸ªæ•°å°‘äº512ä¸ªæ—¶ï¼Œåˆ™é‡‡ç”¨INTSETç¼–ç æ–¹å¼</p>\n<p><img src=\"https://raw.githubusercontent.com/lyydsheep/pic/main/202410091541699.png\" alt=\"image-20241009154144626\"></p>\n<p>ç”±ä¸Šå›¾å¯è§ï¼Œé‡‡ç”¨INTSETç¼–ç ï¼Œå…ƒç´ æ’åˆ—æ¯”è¾ƒç´§å‡‘ï¼Œå†…å­˜å ç”¨å°‘ï¼Œä½†æŸ¥æ‰¾æ—¶éœ€è¦ä½¿ç”¨äºŒåˆ†æ³•ï¼Œæ—¶é—´å¤æ‚åº¦ä¸º$O(nlogn)$</p>\n<p>å¦‚æœä¸æ»¡è¶³INTSETç¼–ç æ¡ä»¶ï¼Œåˆ™éœ€è¦ä½¿ç”¨HASHTABLEç¼–ç ï¼ŒHASHTABLEæŸ¥è¯¢ä¸€ä¸ªå…ƒç´ æ€§èƒ½å¾ˆé«˜ï¼Œæ—¶é—´å¤æ‚åº¦ä¸º$O(1)$</p>\n<p><img src=\"https://raw.githubusercontent.com/lyydsheep/pic/main/202410091544018.png\" alt=\"image-20241009154437973\"></p>\n<p>ç®€å•åœ°æ¦‚æ‹¬ï¼š</p>\n<ul>\n<li>INTSETç¼–ç é€‚ç”¨äºå­˜å‚¨å°‘é‡æ•´æ•°åœºæ™¯ä»¥èŠ‚çº¦å†…å­˜ç©ºé—´</li>\n<li>HASHTABLEç¼–ç é€‚ç”¨äºå¿«é€Ÿå®šä½æŸä¸ªå…ƒç´ çš„ä½ç½®</li>\n</ul>\n<h2 id=\"Hash\"><a href=\"#Hash\" class=\"headerlink\" title=\"Hash\"></a>Hash</h2><p>&#x2F;&#x2F; to do</p>\n<p>panic(â€œimplement meâ€)</p>\n<h2 id=\"HashTable\"><a href=\"#HashTable\" class=\"headerlink\" title=\"HashTable\"></a>HashTable</h2><blockquote>\n<p> HAHSTABLEæ˜¯Redisä¸­çš„ä¸€ç§åº•å±‚æ•°æ®ç»“æ„</p>\n</blockquote>\n<p>é€šè¿‡HASHTABLEå¯ä»¥åœ¨$O(1)$æ—¶é—´å¤æ‚åº¦å†…å¿«é€Ÿå®šä½åˆ°Keyå¯¹äºçš„Value</p>\n<h3 id=\"ç»“æ„\"><a href=\"#ç»“æ„\" class=\"headerlink\" title=\"ç»“æ„\"></a>ç»“æ„</h3><p>æ€»æ‰€å‘¨çŸ¥ï¼ŒRedisæ˜¯ç”¨Cè¯­è¨€å®ç°çš„ã€‚HASHTABLEçš„Cå®ç°æ¶‰åŠåˆ°ä¸‰ä¸ªç»“æ„ä½“ï¼š<code>dict</code>ã€<code>dictht</code>ã€<code>dicEntry</code></p>\n<p>ç®€å•åœ°è¯´ï¼Œ<code>dict</code>å°è£…äº†ä¸¤ä¸ª<code>dictht</code>ç»“æ„ï¼Œæ¯ä¸€ä¸ª<code>dictht</code>ç»“æ„éƒ½æœ‰ä¸€ä¸ªå¤§å°ä¸º<code>size</code>çš„<strong>bucket</strong>ï¼Œbucketä¸­å­˜æ”¾ç€<code>dicEntry</code>é“¾è¡¨ã€‚ä¸‰ä¸ªç»“æ„ä½“ä¹‹é—´çš„å…³ç³»å¦‚ä¸‹å›¾æ‰€ç¤ºï¼š</p>\n<img src=\"https://raw.githubusercontent.com/lyydsheep/pic/main/202410122043279.png\" alt=\"image-20241012204338184\" style=\"zoom:67%;\" />\n\n<p>å¯ä»¥çœ‹åˆ°dictç»“æ„ä¸­æœ‰ä¸¤ä¸ªdicthtç»“æ„ï¼Œä¹Ÿå°±æ˜¯HASHTABLEç»“æ„ã€‚dicEntryæ˜¯é“¾è¡¨ç»“æ„ï¼Œé€šè¿‡æ‹‰é“¾æ³•è§£å†³Hashå†²çª</p>\n<p>æ¥ä¸‹æ¥ï¼Œç»“åˆæºç jè§£é‡Šæ¯ä¸€ä¸ªç»“æ„ä½“çš„å­—æ®µå«ä¹‰ï¼š</p>\n<figure class=\"highlight c\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">typedef</span> <span class=\"class\"><span class=\"keyword\">struct</span> <span class=\"title\">dict</span>&#123;</span></span><br><span class=\"line\">    dictType *type; <span class=\"comment\">//ç›´çº¿dictTypeç»“æ„ï¼ŒdictTypeç»“æ„ä¸­åŒ…å«è‡ªå®šä¹‰çš„å‡½æ•°ï¼Œè¿™äº›å‡½æ•°ä½¿å¾—keyå’Œvalueèƒ½å¤Ÿå­˜å‚¨ä»»ä½•ç±»å‹çš„æ•°æ®</span></span><br><span class=\"line\">    <span class=\"type\">void</span> *privdata; <span class=\"comment\">//ç§æœ‰æ•°æ®ï¼Œä¿å­˜ç€dictTypeç»“æ„ä¸­å‡½æ•°çš„ å‚æ•°</span></span><br><span class=\"line\">    dictht ht[<span class=\"number\">2</span>]; <span class=\"comment\">//ä¸¤å¼ å“ˆå¸Œè¡¨</span></span><br><span class=\"line\">    <span class=\"type\">long</span> rehashidx; <span class=\"comment\">//rehashçš„æ ‡è®°ï¼Œrehashidx=-1è¡¨ç¤ºæ²¡æœ‰è¿›è¡Œrehashï¼Œrehashæ—¶æ¯è¿ç§»ä¸€ä¸ªæ¡¶å°±å¯¹rehashidxåŠ ä¸€</span></span><br><span class=\"line\">    <span class=\"type\">int</span> itreators;  <span class=\"comment\">//æ­£åœ¨è¿­ä»£çš„è¿­ä»£å™¨æ•°é‡</span></span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n\n<figure class=\"highlight c\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"meta\">#dictç»“æ„ä¸­ht[0]ã€ht[1]å“ˆå¸Œè¡¨çš„æ•°æ®ç»“æ„</span></span><br><span class=\"line\"><span class=\"keyword\">typedef</span> <span class=\"class\"><span class=\"keyword\">struct</span> <span class=\"title\">dictht</span>&#123;</span></span><br><span class=\"line\">    dictEntry[] table;        <span class=\"comment\">//å­˜æ”¾ä¸€ä¸ªæ•°ç»„çš„åœ°å€ï¼Œæ•°ç»„ä¸­å­˜æ”¾å“ˆå¸ŒèŠ‚ç‚¹dictEntryçš„åœ°å€</span></span><br><span class=\"line\">    unsingned <span class=\"type\">long</span> size;      <span class=\"comment\">//å“ˆå¸Œè¡¨tableçš„å¤§å°ï¼Œå‡ºå§‹å¤§å°ä¸º4</span></span><br><span class=\"line\">    unsingned <span class=\"type\">long</span>  sizemask; <span class=\"comment\">//ç”¨äºå°†hashå€¼æ˜ å°„åˆ°tableä½ç½®çš„ç´¢å¼•ï¼Œå¤§å°ä¸ºï¼ˆsize-1ï¼‰</span></span><br><span class=\"line\">    unsingned <span class=\"type\">long</span>  used;     <span class=\"comment\">//è®°å½•å“ˆå¸Œè¡¨å·²æœ‰èŠ‚ç‚¹ï¼ˆé”®å€¼å¯¹ï¼‰çš„æ•°é‡</span></span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n\n<figure class=\"highlight c\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">#å“ˆå¸Œè¡¨èŠ‚ç‚¹ç»“æ„å®šä¹‰</span><br><span class=\"line\"><span class=\"keyword\">typedef</span> <span class=\"class\"><span class=\"keyword\">struct</span> <span class=\"title\">dictEntity</span>&#123;</span></span><br><span class=\"line\">    <span class=\"type\">void</span> *key;<span class=\"comment\">//é”®</span></span><br><span class=\"line\">    <span class=\"comment\">//å€¼</span></span><br><span class=\"line\">    <span class=\"class\"><span class=\"keyword\">union</span>&#123;</span></span><br><span class=\"line\">        <span class=\"comment\">//â€œæˆ‘ä¹‹æ‰€ä»¥è¦æé†’ä½ æ³¨æ„è¿™é‡Œï¼Œå…¶å®æ˜¯ä¸ºäº†è¯´æ˜ï¼Œè¿™ç§å®ç°æ–¹æ³•æ˜¯ä¸€ç§èŠ‚çœå†…å­˜çš„å¼€å‘å°æŠ€å·§ï¼Œéå¸¸å€¼å¾—å­¦ä¹ ã€‚å› ä¸ºå½“å€¼ä¸ºæ•´æ•°æˆ–åŒç²¾åº¦æµ®ç‚¹æ•°æ—¶ï¼Œç”±äºå…¶æœ¬èº«å°±æ˜¯ 64 ä½ï¼Œå°±å¯ä»¥ä¸ç”¨æŒ‡é’ˆæŒ‡å‘äº†ï¼Œè€Œæ˜¯å¯ä»¥ç›´æ¥å­˜åœ¨é”®å€¼å¯¹çš„ç»“æ„ä½“ä¸­ï¼Œè¿™æ ·å°±é¿å…äº†å†ç”¨ä¸€ä¸ªæŒ‡é’ˆï¼Œä»è€ŒèŠ‚çœäº†å†…å­˜ç©ºé—´ã€‚â€</span></span><br><span class=\"line\">        <span class=\"type\">void</span> *val;<span class=\"comment\">//è‡ªå®šä¹‰ç±»å‹</span></span><br><span class=\"line\">        <span class=\"type\">uint64_t</span> u64;<span class=\"comment\">//æ— ç¬¦å·æ•´å½¢</span></span><br><span class=\"line\">        <span class=\"type\">int64_t</span> s64;<span class=\"comment\">//ç¬¦åˆæ•´å½¢</span></span><br><span class=\"line\">        <span class=\"type\">double</span> d;<span class=\"comment\">//æµ®ç‚¹å‹</span></span><br><span class=\"line\">    &#125; v;</span><br><span class=\"line\">    <span class=\"class\"><span class=\"keyword\">struct</span> <span class=\"title\">dictEntity</span> *<span class=\"title\">next</span>;</span><span class=\"comment\">//å‘ç”Ÿå“ˆå¸Œå†²çªæ—¶ä½¿ç”¨ã€‚æŒ‡å‘ä¸‹ä¸€ä¸ªå“ˆå¸Œè¡¨èŠ‚ç‚¹ï¼Œå½¢æˆé“¾è¡¨</span></span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n\n<h3 id=\"HashTableæ¸è¿›å¼æ‰©å®¹\"><a href=\"#HashTableæ¸è¿›å¼æ‰©å®¹\" class=\"headerlink\" title=\"HashTableæ¸è¿›å¼æ‰©å®¹\"></a>HashTableæ¸è¿›å¼æ‰©å®¹</h3><p>æ¸è¿›å¼æ‰©å®¹ï¼Œé¡¾åæ€ä¹‰å°±æ˜¯ä¸€ç‚¹ä¸€ç‚¹æ‰©å®¹å®¹é‡ã€‚ç›¸æ¯”äºä¸€æ¬¡æ€§æ‰©å®¹å¤§é‡ç©ºé—´ï¼Œå¹¶è¿›è¡Œå¤§é‡çš„æ‹·è´å·¥ä½œï¼Œæ¸è¿›å¼æ‰©å®¹ä¸æ˜“å¯¼è‡´Redisåœ¨ä¸€æ®µæ—¶é—´å†…ç”±äºè¿›è¡Œæ‰©å®¹å·¥ä½œè€Œæ— æ³•æä¾›å…¶ä»–æœåŠ¡ï¼Œç”¨æˆ·ä½“éªŒæ„Ÿæ›´å¥½ã€‚</p>\n<p>å½“dictæ»¡è¶³æ‰©å®¹æ¡ä»¶åï¼Œå°±ä¼šè¿›è¡ŒRehashæ“ä½œã€‚Rehashæ“ä½œå¤§è‡´åˆ†ä¸ºä¸‰æ­¥ï¼š</p>\n<ul>\n<li><p>ä¸º<strong>ht[1]<strong>å“ˆå¸Œè¡¨å¼€è¾Ÿä¸€å—ç©ºé—´ï¼Œç©ºé—´å¤§å°è®¾å®šä¸º</strong>ç¬¬ä¸€ä¸ªå¤§äº2 * ht[0]çš„2æ•´æ•°æ¬¡å¹‚</strong>ã€‚ğŸŒ°ï¼šh[0] &#x3D; 500ï¼Œé‚£ä¹ˆåœ¨è¿›è¡ŒRehashæ“ä½œæ—¶å¼€è¾Ÿçš„ç©ºé—´ä¸º$2^{\\left\\lceil log_2(2*500) \\right\\rceil} &#x3D; 1024$</p>\n</li>\n<li><p>è¿ç§»ht[0]æ•°æ®è‡³ht[1]ï¼šåœ¨RehashæœŸé—´ï¼Œæ¯æ¬¡å¯¹å­—å…¸è¿›è¡Œå¢åˆ æ”¹æŸ¥æ“ä½œï¼Œç¨‹åºä¼šé¡ºå¸¦è¿ç§»å½“å‰<code>rehashidx</code>æ‰€æŒ‡å‘çš„æ•°æ®ï¼Œå¹¶é€’å¢ä¸‹æ ‡å€¼ã€‚å¦‚æœå½“å‰<code>rehashidx</code>å‘½ä¸­äº†ä¸€ä¸ªç©ºä½ç½®ï¼Œåˆ™ä¼šå…ˆå°è¯•ç»§ç»­å¾€åæŸ¥æ‰¾è‹¥å¹²ä½ç½®ï¼Œå¦‚æœæŸ¥è¯¢æ— æœå°±ç›´æ¥è¿”å›</p>\n</li>\n<li><p>æœ€ç»ˆï¼Œht[0]çš„æ•°æ®å°†ä¼šå…¨éƒ¨è¿ç§»è‡³ht[1]ä¸­ã€‚æ­¤æ—¶ï¼Œéœ€è¦äº¤æ¢ht[0]å’Œht[1]çš„æŒ‡é’ˆï¼Œå¹¶å°†<code>rehash</code>è®¾ä¸º-1ï¼Œè¡¨ç¤ºå¤„äºéRehashçŠ¶æ€</p>\n<ul>\n<li>ä¸ºä»€ä¹ˆè¦äº¤æ¢ä¸¤å¼ å“ˆå¸Œè¡¨çš„æŒ‡é’ˆå‘¢ï¼Ÿå› ä¸ºht[0]ä»£è¡¨ç€æ­£åœ¨ä½¿ç”¨çš„å“ˆå¸Œè¡¨</li>\n</ul>\n</li>\n</ul>\n<img src=\"https://raw.githubusercontent.com/lyydsheep/pic/main/202410122114045.png\" alt=\"image-20241012211414978\" style=\"zoom:80%;\" />\n\n<p>âš ï¸ï¼šå€¼å¾—æ³¨æ„çš„æ˜¯ï¼Œåœ¨Rehashé˜¶æ®µï¼Œç”±äºå­˜åœ¨ä¸¤å¼ å“ˆå¸Œè¡¨ï¼Œæ­¤æ—¶è¿›è¡Œçš„åˆ é™¤ã€æŸ¥æ‰¾ã€æ›´æ–°æ“ä½œä¼šåœ¨ä¸¤ä¸ªè¡¨ä¸Šè¿›è¡Œã€‚æ¯”å¦‚æŸ¥æ‰¾å…ƒç´ æ—¶ï¼Œå¦‚æœht[0]è¡¨æ²¡æœ‰æ‰¾åˆ°ï¼Œåˆ™ä¼šæ¥ç€æŸ¥è¯¢ht[1]è¡¨ã€‚ä½†è¿›è¡Œæ’å…¥æ“ä½œæ—¶ï¼Œåªä¼šåœ¨ht[1]è¡¨ä¸Šå¢æ·»æ•°æ®</p>\n<h3 id=\"æ‰©ï¼ˆç¼©ï¼‰å®¹æ—¶æœº\"><a href=\"#æ‰©ï¼ˆç¼©ï¼‰å®¹æ—¶æœº\" class=\"headerlink\" title=\"æ‰©ï¼ˆç¼©ï¼‰å®¹æ—¶æœº\"></a>æ‰©ï¼ˆç¼©ï¼‰å®¹æ—¶æœº</h3><p>HASHTABLEç”±ä¸€ä¸ªå˜é‡â€”â€”<strong>è´Ÿè½½å› å­</strong>å†³å®šæ˜¯å¦æ‰©å®¹ï¼ˆç¼©å®¹ï¼‰</p>\n<p><strong>è´Ÿè½½å› å­çš„ç®—æ³•ï¼š<code>ht[0].used / ht[0].size</code></strong></p>\n<p><strong>æ‰©å®¹åœºæ™¯ï¼š</strong></p>\n<ul>\n<li>è´Ÿè½½å› å­å¤§äºç­‰äº1å¹¶ä¸”æ­¤æ—¶æœåŠ¡å™¨æ²¡æœ‰æ‰§è¡ŒBGSAVEæˆ–BGREWRITEAOFè¿™ä¸¤ä¸ªå‘½ä»¤</li>\n<li>è´Ÿè½½å› å­å¤§äº5</li>\n</ul>\n<p><strong>ç¼©å®¹åœºæ™¯ï¼š</strong></p>\n<ul>\n<li>è´Ÿè½½å› å­å°äº0.1å¹¶ä¸”æ²¡æœ‰BGSAVEæˆ–BGWRITEAOFå‘½ä»¤åœ¨æ‰§è¡Œ</li>\n</ul>\n<h2 id=\"SkipList\"><a href=\"#SkipList\" class=\"headerlink\" title=\"SkipList\"></a>SkipList</h2><h2 id=\"è·³è¡¨çš„ç»“æ„\"><a href=\"#è·³è¡¨çš„ç»“æ„\" class=\"headerlink\" title=\"è·³è¡¨çš„ç»“æ„\"></a>è·³è¡¨çš„ç»“æ„</h2><p>è·³è¡¨æ˜¯Redisä¸­ZSETçš„åº•å±‚æ•°æ®ç»“æ„ï¼Œè·³è¡¨æœ¬è´¨ä¸Šå°±æ˜¯ç”±<strong>é“¾è¡¨+å¤šçº§ç´¢å¼•</strong>ç»„æˆçš„</p>\n<p>ä½†Redisä½¿ç”¨çš„è·³è¡¨å¹¶éæ ‡å‡†è·³è¡¨ï¼ŒRedisä¸­çš„è·³è¡¨åœ¨æ ‡å‡†è·³è¡¨åŸºç¡€ä¹‹ä¸Š<strong>å…è®¸scoreå€¼é‡å¤</strong>ä»¥åŠ<strong>0å±‚èŠ‚ç‚¹å…·æœ‰å‘åæŒ‡é’ˆ</strong>ï¼Œå¦‚ä¸‹å›¾æ‰€ç¤ºï¼š</p>\n<img src=\"https://raw.githubusercontent.com/lyydsheep/pic/main/202410141047754.png\" alt=\"image-20241014104743623\" style=\"zoom:67%;\" />\n\n<p>å…¶ä¸­çº¢è‰²æ¡†ä¸­çš„å±äºåŒä¸€ä¸ªèŠ‚ç‚¹çš„ä¸åŒå±‚çº§ï¼Œè·³è¡¨ä¸­èŠ‚ç‚¹çš„æ•°é‡ä½“ç°åœ¨0å±‚ï¼ˆæœ€åº•å±‚ï¼‰èŠ‚ç‚¹çš„ä¸ªæ•°</p>\n<p>ç»“åˆæºç ï¼Œåˆ†æèŠ‚ç‚¹çš„ç»„æˆï¼š</p>\n<figure class=\"highlight c\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\">// from Redis 7.0.8</span></span><br><span class=\"line\"><span class=\"comment\">/* ZSETs use a specialized version of Skiplists */</span></span><br><span class=\"line\"><span class=\"keyword\">typedef</span> <span class=\"class\"><span class=\"keyword\">struct</span> <span class=\"title\">zskiplistNode</span> &#123;</span></span><br><span class=\"line\">    sds ele;</span><br><span class=\"line\">    <span class=\"type\">double</span> score;</span><br><span class=\"line\">    <span class=\"class\"><span class=\"keyword\">struct</span> <span class=\"title\">zskiplistNode</span> *<span class=\"title\">backward</span>;</span></span><br><span class=\"line\">    <span class=\"class\"><span class=\"keyword\">struct</span> <span class=\"title\">zskiplistLevel</span> &#123;</span></span><br><span class=\"line\">        <span class=\"class\"><span class=\"keyword\">struct</span> <span class=\"title\">zskiplistNode</span> *<span class=\"title\">forward</span>;</span></span><br><span class=\"line\">        <span class=\"type\">unsigned</span> <span class=\"type\">long</span> span;</span><br><span class=\"line\">    &#125; level[];</span><br><span class=\"line\">&#125; zskiplistNode;</span><br></pre></td></tr></table></figure>\n\n<ul>\n<li><strong>ele</strong>ï¼šsdsç»“æ„ï¼Œä¸€ä¸ªè¢«å°è£…è¿‡çš„å­—ç¬¦ä¸²ï¼Œæœ¬è´¨ä¸Šæ˜¯ä¸€ä¸ªcharæ•°ç»„ï¼Œç”¨äºå­˜å‚¨æ•°æ®</li>\n<li><strong>score</strong>ï¼šåŒç²¾åº¦æµ®ç‚¹æ•°ç±»å‹ï¼Œè¡¨ç¤ºè¯¥èŠ‚ç‚¹çš„åˆ†æ•°ï¼Œå†³å®šäº†è·³è¡¨ä¸­èŠ‚ç‚¹çš„ä½ç½®æ¬¡åº</li>\n<li><strong>backward</strong>ï¼šæŒ‡å‘ä¸Šä¸€ä¸ªèŠ‚ç‚¹çš„å›é€€æŒ‡é’ˆ</li>\n<li><strong>level</strong>ï¼šæ˜¯ä¸€ä¸ªzskiplistLeveç»“æ„ä½“æ•°ç»„ï¼Œç”¨äºè¡¨ç¤ºé«˜å±‚ç´¢å¼•ã€‚zskiplistLeveç»“æ„ä½“åŒ…å«äº†ä¸¤ä¸ªå­—æ®µï¼Œä¸€ä¸ªæ˜¯<strong>forward</strong>ï¼ŒæŒ‡å‘åŒå±‚çš„ä¸‹ä¸€ä¸ªç´¢å¼•ï¼›å¦ä¸€ä¸ªæ˜¯<strong>span</strong>ï¼Œè®°å½•äº†è·ç¦»ä¸‹ä¸€ä¸ªç´¢å¼•ï¼ˆèŠ‚ç‚¹ï¼‰çš„æ­¥é•¿</li>\n</ul>\n<p>ç¤ºæ„å›¾ï¼š</p>\n<img src=\"https://raw.githubusercontent.com/lyydsheep/pic/main/202410141101384.png\" alt=\"image-20241014110129253\" style=\"zoom:67%;\" />\n\n<h3 id=\"å®ç°ç»†èŠ‚\"><a href=\"#å®ç°ç»†èŠ‚\" class=\"headerlink\" title=\"å®ç°ç»†èŠ‚\"></a>å®ç°ç»†èŠ‚</h3><ul>\n<li><p>Redis<strong>è·³è¡¨ä¸­å•ä¸ªèŠ‚ç‚¹çš„å±‚æ•°</strong>ç”±æ¦‚ç‡å†³å®šã€‚æ¯æ’å…¥ä¸€ä¸ªèŠ‚ç‚¹åˆ°0å±‚ï¼ŒRediså†³å®šè¯¥èŠ‚ç‚¹æ˜¯å¦å¢åŠ ä¸€å±‚ç´¢å¼•çš„<strong>æ¦‚ç‡ä¸º25%</strong></p>\n</li>\n<li><p>è·³è¡¨å°†çº¯ç²¹çš„æœ‰åºå•é“¾è¡¨åœ¨æ’å…¥ã€åˆ é™¤ã€æ›´æ–°æ“ä½œä»$O(n)$æ—¶é—´å¤æ‚åº¦é™ä½è‡³$O(logN)$</p>\n</li>\n</ul>\n<h2 id=\"ZSet\"><a href=\"#ZSet\" class=\"headerlink\" title=\"ZSet\"></a>ZSet</h2><p>Zsetä¹Ÿå«Sorted Setå³æœ‰åºé›†åˆï¼Œæ˜¯æŒ‰ç…§å…ƒç´ çš„åˆ†æ•°è¿›è¡Œæ’åºçš„é›†åˆã€‚åˆ†æ•°ç›¸åŒçš„æƒ…å†µä¸‹ï¼ŒæŒ‰ç…§å…ƒç´ çš„å­—å…¸åºè¿›è¡Œæ’åº</p>\n<p>ZSetå¸¸ç”¨äºæ’åºé›†åˆçš„åœºæ™¯ï¼Œæœ€å…¸å‹çš„å°±æ˜¯<strong>æ¸¸æˆæ’è¡Œæ¦œ</strong></p>\n<h3 id=\"ç¼–ç æ–¹å¼-1\"><a href=\"#ç¼–ç æ–¹å¼-1\" class=\"headerlink\" title=\"ç¼–ç æ–¹å¼\"></a>ç¼–ç æ–¹å¼</h3><p>ZSetæœ‰ä¸¤ç§åº•å±‚ç¼–ç æ–¹å¼ï¼Œä¸€ç§æ˜¯ZIPLISTï¼Œå¦ä¸€ç§æ˜¯SKIPLIST+HASHTABLE</p>\n<img src=\"https://raw.githubusercontent.com/lyydsheep/pic/main/202410141759086.png\" alt=\"image-20241014175901004\" style=\"zoom:67%;\" />\n\n<p>å¦‚æœæ»¡è¶³ä¸‹åˆ—æ¡ä»¶ï¼ŒZSetå°±ç”¨ZIPLISTç¼–ç æ–¹å¼ï¼š</p>\n<ul>\n<li>åˆ—è¡¨å¯¹è±¡ä¿å­˜çš„æ‰€æœ‰å­—ç¬¦ä¸²é•¿åº¦å‡å°äº64å­—èŠ‚</li>\n<li>åˆ—è¡¨å¯¹è±¡ä¿å­˜çš„å…ƒç´ ä¸ªæ•°å°‘äº128ä¸ª</li>\n</ul>\n<p>ZIPLISTä¾æ—§ä¿æŒç€å®ƒçš„ä¼˜ç‚¹ï¼Œåœ¨æ•°æ®é‡è¾ƒå°‘æ—¶ï¼Œååˆ†èŠ‚çº¦å†…å­˜ç©ºé—´ã€‚å½“ZSeté‡‡ç”¨ZIPLISTç¼–ç æ—¶ï¼Œåº•å±‚ç»“æ„å¦‚ä¸‹å›¾ï¼š</p>\n<img src=\"https://raw.githubusercontent.com/lyydsheep/pic/main/202410141802693.png\" alt=\"image-20241014180256647\" style=\"zoom:67%;\" />\n\n<p>ä½†å‡¡ä¸Šè¿°çš„ä¸¤ä¸ªæ¡ä»¶æœ‰ä¸€ä¸ªä¸æ»¡è¶³ï¼ŒZSetå°±é‡‡ç”¨<strong>SKIPLIST+HASHTABLE</strong>çš„ç¼–ç æ–¹å¼ã€‚å…¶ä¸­ï¼ŒSKIPLISTæ˜¯ä¸€ä¸ªå…·æœ‰å¤šçº§ç´¢å¼•çš„æœ‰åºé“¾è¡¨ï¼Œ<strong>å¯ä»¥å®ç°é«˜æ•ˆçš„æŸ¥è¯¢ã€æ’å…¥ã€åˆ é™¤æ“ä½œ</strong>ã€‚é™¤æ­¤ä¹‹å¤–ï¼ŒRedisè¿˜åˆ©ç”¨HASHTABLEç»“æ„å®ç°åœ¨$O(1)$æ—¶é—´å¤æ‚åº¦ä¸‹<strong>æŸ¥è¯¢åˆ°ZSetä¸­ä»»ä¸€æˆå‘˜çš„<code>score</code>å€¼</strong></p>\n"},{"title":"Redisè¿è¡ŒåŸç†","publish":true,"description":"è®°å½•Redisè¿è¡ŒåŸç†çŸ¥è¯†","_content":"\n\n\n# Redisè¿è¡ŒåŸç†\n\n## Redisåœ¨å†…å­˜ä¸­æ˜¯å¦‚ä½•å­˜å‚¨çš„ï¼Ÿ\n\nç®€å•æ¥è¯´ï¼ŒRediså°±æ˜¯ä¸€ä¸ªè¿è¡Œåœ¨å†…å­˜ä¸­çš„k-vå­—å…¸ã€‚è¯´åˆ°k-vå­—å…¸ï¼Œå¾ˆå®¹æ˜“è”æƒ³åˆ°Redisåº•å±‚æ•°æ®ç»“æ„**dict(HASHTABLE)**ï¼Œå®é™…ä¸Šä»Cä»£ç ä¸­å¯ä»¥çœ‹å‡ºï¼ŒRedisæ•°æ®åº“å°±æ˜¯åœ¨**dict**åŸºç¡€ä¸Šå°è£…äº†ä¼—å¤šåŠŸèƒ½ï¼ˆ~~è£…é¥°å™¨æ¨¡å¼ä¸‡å²ğŸ˜†~~ï¼‰\n\n```c\ntypedef struct redisDB {\n    dict *dict;\n    dict *expires;\n    dict *blocking_keys;\n    dict *ready_keys;\n    dict *watched_keys;\n    int id;\n    long long avg_ttl;\n    list *defrag_later;\n} redisDb;\n```\n\næ ¸å¿ƒç»“æ„**dict**å€¼å¾—é‡ç‚¹å…³å¿ƒï¼š\n\n```c\ntypedef struct dict{\n    dictType *type; //ç›´çº¿dictTypeç»“æ„ï¼ŒdictTypeç»“æ„ä¸­åŒ…å«è‡ªå®šä¹‰çš„å‡½æ•°ï¼Œè¿™äº›å‡½æ•°ä½¿å¾—keyå’Œvalueèƒ½å¤Ÿå­˜å‚¨ä»»ä½•ç±»å‹çš„æ•°æ®\n    void *privdata; //ç§æœ‰æ•°æ®ï¼Œä¿å­˜ç€dictTypeç»“æ„ä¸­å‡½æ•°çš„ å‚æ•°\n    dictht ht[2]; //ä¸¤å¼ å“ˆå¸Œè¡¨\n    long rehashidx; //rehashçš„æ ‡è®°ï¼Œrehashidx=-1è¡¨ç¤ºæ²¡æœ‰è¿›è¡Œrehashï¼Œrehashæ—¶æ¯è¿ç§»ä¸€ä¸ªæ¡¶å°±å¯¹rehashidxåŠ ä¸€\n    int itreators;  //æ­£åœ¨è¿­ä»£çš„è¿­ä»£å™¨æ•°é‡\n}\n```\n\nå½“æˆ‘ä»¬ä½¿ç”¨Rediså­˜å‚¨é”®å€¼å¯¹æ—¶ï¼Œdictå­—æ®µå­˜å‚¨è¿™å­—ç¬¦ä¸²ç±»å‹çš„keyä»¥åŠä»»æ„ç±»å‹çš„value\n\n<img src=\"https://raw.githubusercontent.com/lyydsheep/pic/main/202410171559595.png\" alt=\"image-20241017155911540\" style=\"zoom:50%;\" />\n\né™¤äº†dictå­—æ®µï¼Œexpireå­—æ®µä¹Ÿå¾ˆé‡è¦ã€‚ä¼—æ‰€å‘¨çŸ¥ï¼ŒRedisåœ¨å­˜å‚¨k-væ—¶å¯ä»¥ä¸ºé”®å€¼å¯¹è®¾ç½®è¿‡æœŸæ—¶é—´ï¼Œæé«˜Rediså¯¹å†…å­˜çš„ä½¿ç”¨æ•ˆç‡ã€‚expireå­—å…¸ä¸­å°±å­˜å‚¨ç€å…·æœ‰è¿‡æœŸæ—¶é—´çš„é”®å€¼å¯¹ä¿¡æ¯ï¼Œå…¶ä¸­keyå°±æ˜¯é”®å€¼å¯¹çš„é”®ï¼Œè€Œvalueå°±æ˜¯å¯¹åº”çš„è¿‡æœŸæ—¶é—´ã€‚å…·ä½“å¦‚ä¸‹å›¾æ‰€ç¤ºï¼š\n\n<img src=\"https://raw.githubusercontent.com/lyydsheep/pic/main/202410171608652.png\" alt=\"image-20241017160835599\" style=\"zoom: 67%;\" />\n\nå¯ä»¥çœ‹åˆ°ï¼Œåœ¨dictå’Œexpireå…¶å®æ˜¯å…·æœ‰ä¸€äº›ç›¸åŒçš„keyçš„ï¼ŒRedisä¸ºäº†èŠ‚çœå†…å­˜å¼€é”€ï¼Œå®é™…ä¸Šå¹¶æ²¡æœ‰å­˜å‚¨äº†ä¸¤ä»½ä¸€æ¨¡ä¸€æ ·çš„keyï¼Œè€Œæ˜¯è¿›è¡Œäº†å†…å­˜å¤ç”¨æ“ä½œã€‚ä»€ä¹ˆæ„æ€ï¼Ÿç®€å•åœ°è¯´ï¼Œdictå­—å…¸å’Œexpireå­—å…¸éƒ½æŒ‡å‘äº†åŒä¸€å—å†…å­˜ç©ºé—´çš„keyã€‚ğŸŒ°ï¼šdictä¸­çš„`animal`æ‰§è¡Œå†…å­˜`0xababababa`ï¼Œexpireä¸­çš„`animal`ä¹ŸæŒ‡å‘å†…å­˜`0xababababa`\n\n## Redisæ˜¯å•çº¿ç¨‹è¿˜æ˜¯å¤šçº¿ç¨‹ï¼Ÿ\n\nå…ˆä¸Šç»“è®ºï¼ŒRedisä½œä¸ºä¸€ä¸ªèƒ½å¤Ÿé«˜æ•ˆå¤„ç†æ•°æ®è¯·æ±‚çš„ç»„ä»¶ï¼Œ**ä¸»æ¨¡å—ä½¿ç”¨å•çº¿ç¨‹**ï¼›**è¾…åŠ©æ¨¡å—ï¼Œä¾‹å¦‚å¼‚æ­¥æ“ä½œã€ç½‘ç»œI/Oåˆ™ä½¿ç”¨å¤šçº¿ç¨‹**\n\n> ä¸ºä»€ä¹ˆRedisä¸»æ¨¡å—ä¸ä½¿ç”¨å¤šçº¿ç¨‹ï¼Ÿ\n\nå¦‚æœå¯¹åº•å±‚å­˜å‚¨æœ‰ä¸€å®šäº†è§£çš„è¯ï¼Œé‚£ä¹ˆå¯¹ä¸‹é¢è¿™å¼ å›¾ä¸€å®šä¸é™Œç”Ÿã€‚ï¼ˆ[æ¥æº](https://www.toutiao.com/article/7204821418587144736/?wid=1729307852409)ï¼‰\n\n<img src=\"https://raw.githubusercontent.com/lyydsheep/pic/main/202410191118868.png\" alt=\"image-20241019111805677\" style=\"zoom:50%;\" />\n\næˆ‘ä»¬çŸ¥é“ï¼Œå¤šçº¿ç¨‹å¯ä»¥å……åˆ†åˆ©ç”¨CPUå¤šæ ¸çš„è¿ç®—èƒ½åŠ›ï¼Œä½†æ˜¯å¯¹äºä¸»è¦å·¥ä½œå†…å­˜ä¸Šçš„Redisæ¥è¯´ï¼ŒCPUå¹¶ä¸æ˜¯ä¸»è¦çš„æ€§èƒ½ç“¶é¢ˆã€‚ç”±ä¸Šå›¾æˆ‘ä»¬ä¹Ÿå¯ä»¥å¾ˆå®¹æ˜“çŒœåˆ°Redisæ€§èƒ½**ä¸»è¦å—é™äºç½‘ç»œIO**ã€‚\n\nå¦ä¸€æ–¹é¢ï¼ŒRedisçš„å®—æ—¨æ˜¯â€œæƒœå†…å­˜å¦‚é‡‘ï¼Œç®€å•é«˜æ•ˆâ€ï¼Œå¼•å…¥å¤šçº¿ç¨‹åè€Œå¯¼è‡´é¡¹ç›®å¤æ‚ã€ä¸æ˜“ç»´æŠ¤ï¼ŒåŒæ—¶ä¹Ÿä¼šå¸¦æ¥ä¸€å®šçš„æˆæœ¬å¼€é”€ã€‚å…·ä½“æœ‰ä»¥ä¸‹å‡ ä¸ªæ–¹é¢ï¼š\n\n- å¼•å…¥å¤šçº¿ç¨‹åï¼ŒRedisä¸ºäº†æ”¯æŒäº‹åŠ¡çš„ACIDå°±ä¸å¾—ä¸é¢å¤–æ·»åŠ ä¸€äº›å¤æ‚çš„æ“ä½œï¼Œç”šè‡³éœ€è¦å°†åŸæœ‰çš„æ•°æ®ç»“æ„æ”¹é€ æˆå¹¶å‘å®‰å…¨çš„\n- ä¸Šä¸‹æ–‡åˆ‡æ¢æˆæœ¬ï¼šCPUåœ¨è¿›è¡Œçº¿ç¨‹è°ƒåº¦æ—¶éœ€è¦å…ˆä¿å­˜å½“å‰çº¿ç¨‹çš„ä¸Šä¸‹æ–‡æ•°æ®ï¼Œå†åˆ‡æ¢åˆ°ä¸‹ä¸€ä¸ªçº¿ç¨‹\n- å¤šçº¿ç¨‹åŒæ­¥æœºåˆ¶ï¼ˆåŠ é”ã€è§£é”ï¼‰ä¼šå¼•å…¥ä¸€å®šçš„CPUå¼€é”€\n- å†…å­˜æ¶ˆè€—ï¼šæ¯ä¸€ä¸ªçº¿ç¨‹éƒ½æ˜¯å ç”¨ä¸€å®šçš„å†…å­˜èµ„æºçš„ï¼Œå¯¹äºRedisæ¥è¯´ï¼Œå†…å­˜èµ„æºååˆ†å®è´µï¼Œèƒ½çœåˆ™çœ\n\n## ä¸ºä»€ä¹ˆRediså•çº¿ç¨‹è¿™ä¹ˆå¿«ï¼Ÿ\n\næˆ‘ä»¬çŸ¥é“ï¼ŒRedisæ˜¯å•çº¿ç¨‹å¤„ç†è¯·æ±‚ï¼Œä½†æ˜¯Rediså´èƒ½åšåˆ°10wé‡çº§çš„QPSï¼Œå…³é”®ç‚¹æœ‰ä»¥ä¸‹å‡ ä¸ªï¼š\n\n- Rediså¤§éƒ¨åˆ†æ“ä½œéƒ½æ˜¯åœ¨å†…å­˜ä¸Šå®Œæˆçš„ï¼Œå†…å­˜æ“ä½œæœ¬èº«å°±å¾ˆå¿«\n- Redisä¸­å„å¼å„æ ·çš„æ•°æ®ç»“æ„åº•å±‚ä¾æ®ä¸åŒåœºæ™¯é‡‡ç”¨ä¸åŒçš„ç¼–ç å®ç°æ–¹å¼ï¼Œä½¿å¾—Redisåœ¨å„ç§åœºæ™¯ä¸‹éƒ½èƒ½ä¿æŒé«˜æ€§èƒ½ï¼ˆ[æ¥æº](https://www.toutiao.com/article/7204821418587144736/?wid=1729307852409)ï¼‰\n  - ![image-20241019152651588](https://raw.githubusercontent.com/lyydsheep/pic/main/202410191526662.png)\n- Redisé‡‡ç”¨IOå¤šè·¯å¤ç”¨æœºåˆ¶è§£å†³ç½‘ç»œIOé˜»å¡é—®é¢˜ï¼Œé¿å…Rediså•çº¿ç¨‹åœ¨å¤„ç†ç½‘ç»œè¯·æ±‚æ—¶é¢‘ç¹å‘ç”Ÿé˜»å¡ï¼Œæé«˜äº†Redisç½‘ç»œååé‡\n\n>  ä¸‹é¢ç€é‡è®²è®²Redisçš„ç½‘ç»œIOå¤šè·¯å¤ç”¨æœºåˆ¶\n\nä¸€èˆ¬åœ°ï¼Œå¦‚æœæ²¡æœ‰IOå¤šè·¯å¤ç”¨ï¼Œé‚£ä¹ˆRedisæ˜¯å¦‚ä½•å¤„ç†è¯·æ±‚çš„ï¼Ÿ\n\nğŸŒ°ä»¥ä¸€ä¸ªGETè¯·æ±‚ä¸ºä¾‹ï¼š\n\n1. å®¢æˆ·ç«¯å‘é€GETè¯·æ±‚ï¼ŒRedisè°ƒç”¨**accept**å‡½æ•°ä¸å…¶å»ºç«‹è¿æ¥\n2. Redisè°ƒç”¨**recv**å‡½æ•°ä»å¥—æ¥å­—ä¸­è·å–è¯·æ±‚\n3. è§£æå®¢æˆ·ç«¯è¯·æ±‚ï¼Œè·å–å‚æ•°\n4. Rediså¤„ç†æ¥è‡ªå®¢æˆ·ç«¯çš„å‚æ•°ï¼Œæœ¬ä¾‹ä¸­å°±æ˜¯è·å–keyæ‰€å¯¹åº”çš„value\n5. Redisé€šè¿‡**send**å‡½æ•°å°†ç»“æœè¿”å›ç»™å®¢æˆ·ç«¯\n\n![image-20241019154821888](https://raw.githubusercontent.com/lyydsheep/pic/main/202410191548939.png)\n\nç”±äºå¥—æ¥å­—é‡‡ç”¨é»˜è®¤é˜»å¡æ¨¡å¼ï¼Œå› æ­¤Redisåœ¨è¿›è¡Œ**acceptå’Œrecv**æ—¶å°±æœ‰å¯èƒ½å‡ºç°é˜»å¡ï¼Œæ¯”å¦‚acceptå»ºç«‹é“¾æ¥æ—¶é—´è¿‡é•¿ã€è°ƒç”¨recvåï¼Œå®¢æˆ·ç«¯è¿Ÿè¿Ÿæ²¡æœ‰å‘é€æ•°æ®ï¼Œè¿™å¯¹å•çº¿ç¨‹çš„Redisæ¥è¯´æ˜¯è‡´å‘½çš„ã€‚\n\näºæ˜¯Redisé‡‡ç”¨IOå¤šè·¯å¤ç”¨æœºåˆ¶è§£å†³é˜»å¡é—®é¢˜ã€‚åœ¨Redisä¸­ï¼Œå°†å¥—æ¥å­—è®¾ç½®æˆ**éé˜»å¡**æ¨¡å¼ï¼Œå¹¶ä¸”åŸºäºç³»ç»Ÿå‡½æ•°å°è£…äº†ä¸€ä¸ª**reactor**æ¨¡å‹ã€‚ç®€å•æ¥è¯´ï¼Œæ¯å½“æœ‰äº‹ä»¶å‘ç”Ÿï¼Œreactoræ¨¡å‹å°±é€šçŸ¥ä¸åŒçš„å¤„ç†å™¨å»å¤„ç†äº‹ä»¶ï¼Œè¿™æ ·å°±ä¸ä¼šé˜»å¡åœ¨æŸä¸€ä¸ªæ“ä½œä¸Šï¼Œå……åˆ†åˆ©ç”¨äº†CPU\n\n![image-20241019160842167](https://raw.githubusercontent.com/lyydsheep/pic/main/202410191608206.png)\n\n**âš ï¸ï¼šè¿™æ˜¯ä»æ˜¯å¹¶å‘è¿è¡Œï¼Œè€Œéå¹¶è¡Œ**\n\n## å†…å­˜æ·˜æ±°ç­–ç•¥\n\næˆ‘ä»¬çŸ¥é“Rediså°†æ‰€æœ‰çš„æ•°æ®ä¿å­˜åœ¨å†…å­˜ä¸Šï¼Œä½†æ˜¯å†…å­˜ç©ºé—´æ˜¯æœ‰é™çš„ï¼Œéšç€æ—¶é—´çš„æ¨ç§»ï¼Œæœ‰é™çš„å†…å­˜ç©ºé—´è‚¯å®šæ˜¯ä¸èƒ½æ»¡è¶³æ— é™çš„æ•°æ®ã€‚å› æ­¤ï¼ŒRediséœ€è¦é‡‡ç”¨ä¸€äº›å†…å­˜æ·˜æ±°ç­–ç•¥å°†â€œæ— ç”¨â€çš„æ•°æ®ä¸¢å¼ƒï¼Œä»¥è·å¾—æ›´å¤šçš„ç©ºé—²å†…å­˜ç©ºé—´ä¿å­˜æ•°æ®ã€‚\n\nåœ¨Redisä¸­æœ‰å¦‚ä¸‹å‡ ç§å†…å­˜æ·˜æ±°ç­–ç•¥ï¼š\n\n<img src=\"https://raw.githubusercontent.com/lyydsheep/pic/main/202410221850573.png\" alt=\"image-20241022185052519\" style=\"zoom: 50%;\" />\n\nç°ç€é‡è€ƒè™‘**LRUå’ŒLFU**ç®—æ³•\n\n### LRUç®—æ³•\n\nLRU(Least Recently Used)ç®—æ³•çš„ä¸€èˆ¬å®ç°å°±æ˜¯ç»´æŠ¤ä¸€ä¸ªæŒ‰æ—¶é—´æˆ³æœ‰åºçš„ï¼ˆåŒå‘ï¼‰é“¾è¡¨ï¼Œæ¯æ¬¡å°†é“¾è¡¨æœ«å°¾çš„èŠ‚ç‚¹æ·˜æ±°ï¼Œå³åˆ é™¤æœ€ä¹…æœªè¢«è®¿é—®çš„å…ƒç´ ã€‚\n\nRedisé‡‡ç”¨çš„æ˜¯ä¸€ç§è¿‘ä¼¼LRUç®—æ³•ï¼Œå› ä¸ºä½¿ç”¨æ­£ç»Ÿçš„LRUç®—æ³•å°±æ„å‘³ç€éœ€è¦ç»´æŠ¤ä¸€ä¸ªåŒ…å«å…¨å±€å…ƒç´ çš„é“¾è¡¨ï¼Œè¿™å¯¹äºRedisæ¥è¯´æˆæœ¬æ˜¯å·¨å¤§çš„ï¼Œæ‰€ä»¥Redisé€‰æ‹©ä¸€ç§è¿‘ä¼¼çš„LRUç®—æ³•ä½œä¸ºå†…å­˜æ·˜æ±°ç­–ç•¥ã€‚\n\nRedisä½¿ç”¨çš„è¿‘ä¼¼LRUç®—æ³•ä¼šç»´æŠ¤ä¸€ä¸ªå¤§å°ä¸º16çš„æ·˜æ±°æ± ï¼Œä¸‹é¢æ ¹æ®æ·˜æ±°æ± æ˜¯å¦æœ‰ç©ºä½™ä½ç½®è¿›è¡Œåˆ†ç±»è®¨è®ºï¼š\n\n- å½“æ·˜æ±°æ± æœªæ»¡æ—¶ï¼Œæ¯æ¬¡ä»å…¨å±€éšæœºé€‰å–5ä¸ªå…ƒç´ ï¼Œæ”¾å…¥æ± å­ä¸­ï¼Œç„¶åæ·˜æ±°æ± å­ä¸­**ç©ºé—²æ—¶é—´æœ€å¤§çš„å…ƒç´ **\n- å½“æ·˜æ±°æ± æ»¡äº†ï¼Œæ¯æ¬¡ä»å…¨å±€éšæœºé€‰å–5ä¸ªå…ƒç´ ï¼Œä½†è¿™5ä¸ªå…ƒç´ åªæœ‰ç©ºé—²æ—¶é—´å¤§äºæ± ä¸­å…ƒç´ çš„æœ€å°ç©ºé—²æ—¶é—´çš„ï¼Œæ‰ä¼šè¢«æ”¾å…¥æ± ä¸­ã€‚æœ€åå°†æ·˜æ±°æ± ä¸­ç©ºé—´æ—¶é—´æœ€å¤§çš„å…ƒç´ æ·˜æ±°\n\n","source":"_posts/Redis/Redisè¿è¡ŒåŸç†.md","raw":"---\ntitle: Redisè¿è¡ŒåŸç†\npublish: true\ndescription: è®°å½•Redisè¿è¡ŒåŸç†çŸ¥è¯†\ntag:\n- Redis\n---\n\n\n\n# Redisè¿è¡ŒåŸç†\n\n## Redisåœ¨å†…å­˜ä¸­æ˜¯å¦‚ä½•å­˜å‚¨çš„ï¼Ÿ\n\nç®€å•æ¥è¯´ï¼ŒRediså°±æ˜¯ä¸€ä¸ªè¿è¡Œåœ¨å†…å­˜ä¸­çš„k-vå­—å…¸ã€‚è¯´åˆ°k-vå­—å…¸ï¼Œå¾ˆå®¹æ˜“è”æƒ³åˆ°Redisåº•å±‚æ•°æ®ç»“æ„**dict(HASHTABLE)**ï¼Œå®é™…ä¸Šä»Cä»£ç ä¸­å¯ä»¥çœ‹å‡ºï¼ŒRedisæ•°æ®åº“å°±æ˜¯åœ¨**dict**åŸºç¡€ä¸Šå°è£…äº†ä¼—å¤šåŠŸèƒ½ï¼ˆ~~è£…é¥°å™¨æ¨¡å¼ä¸‡å²ğŸ˜†~~ï¼‰\n\n```c\ntypedef struct redisDB {\n    dict *dict;\n    dict *expires;\n    dict *blocking_keys;\n    dict *ready_keys;\n    dict *watched_keys;\n    int id;\n    long long avg_ttl;\n    list *defrag_later;\n} redisDb;\n```\n\næ ¸å¿ƒç»“æ„**dict**å€¼å¾—é‡ç‚¹å…³å¿ƒï¼š\n\n```c\ntypedef struct dict{\n    dictType *type; //ç›´çº¿dictTypeç»“æ„ï¼ŒdictTypeç»“æ„ä¸­åŒ…å«è‡ªå®šä¹‰çš„å‡½æ•°ï¼Œè¿™äº›å‡½æ•°ä½¿å¾—keyå’Œvalueèƒ½å¤Ÿå­˜å‚¨ä»»ä½•ç±»å‹çš„æ•°æ®\n    void *privdata; //ç§æœ‰æ•°æ®ï¼Œä¿å­˜ç€dictTypeç»“æ„ä¸­å‡½æ•°çš„ å‚æ•°\n    dictht ht[2]; //ä¸¤å¼ å“ˆå¸Œè¡¨\n    long rehashidx; //rehashçš„æ ‡è®°ï¼Œrehashidx=-1è¡¨ç¤ºæ²¡æœ‰è¿›è¡Œrehashï¼Œrehashæ—¶æ¯è¿ç§»ä¸€ä¸ªæ¡¶å°±å¯¹rehashidxåŠ ä¸€\n    int itreators;  //æ­£åœ¨è¿­ä»£çš„è¿­ä»£å™¨æ•°é‡\n}\n```\n\nå½“æˆ‘ä»¬ä½¿ç”¨Rediså­˜å‚¨é”®å€¼å¯¹æ—¶ï¼Œdictå­—æ®µå­˜å‚¨è¿™å­—ç¬¦ä¸²ç±»å‹çš„keyä»¥åŠä»»æ„ç±»å‹çš„value\n\n<img src=\"https://raw.githubusercontent.com/lyydsheep/pic/main/202410171559595.png\" alt=\"image-20241017155911540\" style=\"zoom:50%;\" />\n\né™¤äº†dictå­—æ®µï¼Œexpireå­—æ®µä¹Ÿå¾ˆé‡è¦ã€‚ä¼—æ‰€å‘¨çŸ¥ï¼ŒRedisåœ¨å­˜å‚¨k-væ—¶å¯ä»¥ä¸ºé”®å€¼å¯¹è®¾ç½®è¿‡æœŸæ—¶é—´ï¼Œæé«˜Rediså¯¹å†…å­˜çš„ä½¿ç”¨æ•ˆç‡ã€‚expireå­—å…¸ä¸­å°±å­˜å‚¨ç€å…·æœ‰è¿‡æœŸæ—¶é—´çš„é”®å€¼å¯¹ä¿¡æ¯ï¼Œå…¶ä¸­keyå°±æ˜¯é”®å€¼å¯¹çš„é”®ï¼Œè€Œvalueå°±æ˜¯å¯¹åº”çš„è¿‡æœŸæ—¶é—´ã€‚å…·ä½“å¦‚ä¸‹å›¾æ‰€ç¤ºï¼š\n\n<img src=\"https://raw.githubusercontent.com/lyydsheep/pic/main/202410171608652.png\" alt=\"image-20241017160835599\" style=\"zoom: 67%;\" />\n\nå¯ä»¥çœ‹åˆ°ï¼Œåœ¨dictå’Œexpireå…¶å®æ˜¯å…·æœ‰ä¸€äº›ç›¸åŒçš„keyçš„ï¼ŒRedisä¸ºäº†èŠ‚çœå†…å­˜å¼€é”€ï¼Œå®é™…ä¸Šå¹¶æ²¡æœ‰å­˜å‚¨äº†ä¸¤ä»½ä¸€æ¨¡ä¸€æ ·çš„keyï¼Œè€Œæ˜¯è¿›è¡Œäº†å†…å­˜å¤ç”¨æ“ä½œã€‚ä»€ä¹ˆæ„æ€ï¼Ÿç®€å•åœ°è¯´ï¼Œdictå­—å…¸å’Œexpireå­—å…¸éƒ½æŒ‡å‘äº†åŒä¸€å—å†…å­˜ç©ºé—´çš„keyã€‚ğŸŒ°ï¼šdictä¸­çš„`animal`æ‰§è¡Œå†…å­˜`0xababababa`ï¼Œexpireä¸­çš„`animal`ä¹ŸæŒ‡å‘å†…å­˜`0xababababa`\n\n## Redisæ˜¯å•çº¿ç¨‹è¿˜æ˜¯å¤šçº¿ç¨‹ï¼Ÿ\n\nå…ˆä¸Šç»“è®ºï¼ŒRedisä½œä¸ºä¸€ä¸ªèƒ½å¤Ÿé«˜æ•ˆå¤„ç†æ•°æ®è¯·æ±‚çš„ç»„ä»¶ï¼Œ**ä¸»æ¨¡å—ä½¿ç”¨å•çº¿ç¨‹**ï¼›**è¾…åŠ©æ¨¡å—ï¼Œä¾‹å¦‚å¼‚æ­¥æ“ä½œã€ç½‘ç»œI/Oåˆ™ä½¿ç”¨å¤šçº¿ç¨‹**\n\n> ä¸ºä»€ä¹ˆRedisä¸»æ¨¡å—ä¸ä½¿ç”¨å¤šçº¿ç¨‹ï¼Ÿ\n\nå¦‚æœå¯¹åº•å±‚å­˜å‚¨æœ‰ä¸€å®šäº†è§£çš„è¯ï¼Œé‚£ä¹ˆå¯¹ä¸‹é¢è¿™å¼ å›¾ä¸€å®šä¸é™Œç”Ÿã€‚ï¼ˆ[æ¥æº](https://www.toutiao.com/article/7204821418587144736/?wid=1729307852409)ï¼‰\n\n<img src=\"https://raw.githubusercontent.com/lyydsheep/pic/main/202410191118868.png\" alt=\"image-20241019111805677\" style=\"zoom:50%;\" />\n\næˆ‘ä»¬çŸ¥é“ï¼Œå¤šçº¿ç¨‹å¯ä»¥å……åˆ†åˆ©ç”¨CPUå¤šæ ¸çš„è¿ç®—èƒ½åŠ›ï¼Œä½†æ˜¯å¯¹äºä¸»è¦å·¥ä½œå†…å­˜ä¸Šçš„Redisæ¥è¯´ï¼ŒCPUå¹¶ä¸æ˜¯ä¸»è¦çš„æ€§èƒ½ç“¶é¢ˆã€‚ç”±ä¸Šå›¾æˆ‘ä»¬ä¹Ÿå¯ä»¥å¾ˆå®¹æ˜“çŒœåˆ°Redisæ€§èƒ½**ä¸»è¦å—é™äºç½‘ç»œIO**ã€‚\n\nå¦ä¸€æ–¹é¢ï¼ŒRedisçš„å®—æ—¨æ˜¯â€œæƒœå†…å­˜å¦‚é‡‘ï¼Œç®€å•é«˜æ•ˆâ€ï¼Œå¼•å…¥å¤šçº¿ç¨‹åè€Œå¯¼è‡´é¡¹ç›®å¤æ‚ã€ä¸æ˜“ç»´æŠ¤ï¼ŒåŒæ—¶ä¹Ÿä¼šå¸¦æ¥ä¸€å®šçš„æˆæœ¬å¼€é”€ã€‚å…·ä½“æœ‰ä»¥ä¸‹å‡ ä¸ªæ–¹é¢ï¼š\n\n- å¼•å…¥å¤šçº¿ç¨‹åï¼ŒRedisä¸ºäº†æ”¯æŒäº‹åŠ¡çš„ACIDå°±ä¸å¾—ä¸é¢å¤–æ·»åŠ ä¸€äº›å¤æ‚çš„æ“ä½œï¼Œç”šè‡³éœ€è¦å°†åŸæœ‰çš„æ•°æ®ç»“æ„æ”¹é€ æˆå¹¶å‘å®‰å…¨çš„\n- ä¸Šä¸‹æ–‡åˆ‡æ¢æˆæœ¬ï¼šCPUåœ¨è¿›è¡Œçº¿ç¨‹è°ƒåº¦æ—¶éœ€è¦å…ˆä¿å­˜å½“å‰çº¿ç¨‹çš„ä¸Šä¸‹æ–‡æ•°æ®ï¼Œå†åˆ‡æ¢åˆ°ä¸‹ä¸€ä¸ªçº¿ç¨‹\n- å¤šçº¿ç¨‹åŒæ­¥æœºåˆ¶ï¼ˆåŠ é”ã€è§£é”ï¼‰ä¼šå¼•å…¥ä¸€å®šçš„CPUå¼€é”€\n- å†…å­˜æ¶ˆè€—ï¼šæ¯ä¸€ä¸ªçº¿ç¨‹éƒ½æ˜¯å ç”¨ä¸€å®šçš„å†…å­˜èµ„æºçš„ï¼Œå¯¹äºRedisæ¥è¯´ï¼Œå†…å­˜èµ„æºååˆ†å®è´µï¼Œèƒ½çœåˆ™çœ\n\n## ä¸ºä»€ä¹ˆRediså•çº¿ç¨‹è¿™ä¹ˆå¿«ï¼Ÿ\n\næˆ‘ä»¬çŸ¥é“ï¼ŒRedisæ˜¯å•çº¿ç¨‹å¤„ç†è¯·æ±‚ï¼Œä½†æ˜¯Rediså´èƒ½åšåˆ°10wé‡çº§çš„QPSï¼Œå…³é”®ç‚¹æœ‰ä»¥ä¸‹å‡ ä¸ªï¼š\n\n- Rediså¤§éƒ¨åˆ†æ“ä½œéƒ½æ˜¯åœ¨å†…å­˜ä¸Šå®Œæˆçš„ï¼Œå†…å­˜æ“ä½œæœ¬èº«å°±å¾ˆå¿«\n- Redisä¸­å„å¼å„æ ·çš„æ•°æ®ç»“æ„åº•å±‚ä¾æ®ä¸åŒåœºæ™¯é‡‡ç”¨ä¸åŒçš„ç¼–ç å®ç°æ–¹å¼ï¼Œä½¿å¾—Redisåœ¨å„ç§åœºæ™¯ä¸‹éƒ½èƒ½ä¿æŒé«˜æ€§èƒ½ï¼ˆ[æ¥æº](https://www.toutiao.com/article/7204821418587144736/?wid=1729307852409)ï¼‰\n  - ![image-20241019152651588](https://raw.githubusercontent.com/lyydsheep/pic/main/202410191526662.png)\n- Redisé‡‡ç”¨IOå¤šè·¯å¤ç”¨æœºåˆ¶è§£å†³ç½‘ç»œIOé˜»å¡é—®é¢˜ï¼Œé¿å…Rediså•çº¿ç¨‹åœ¨å¤„ç†ç½‘ç»œè¯·æ±‚æ—¶é¢‘ç¹å‘ç”Ÿé˜»å¡ï¼Œæé«˜äº†Redisç½‘ç»œååé‡\n\n>  ä¸‹é¢ç€é‡è®²è®²Redisçš„ç½‘ç»œIOå¤šè·¯å¤ç”¨æœºåˆ¶\n\nä¸€èˆ¬åœ°ï¼Œå¦‚æœæ²¡æœ‰IOå¤šè·¯å¤ç”¨ï¼Œé‚£ä¹ˆRedisæ˜¯å¦‚ä½•å¤„ç†è¯·æ±‚çš„ï¼Ÿ\n\nğŸŒ°ä»¥ä¸€ä¸ªGETè¯·æ±‚ä¸ºä¾‹ï¼š\n\n1. å®¢æˆ·ç«¯å‘é€GETè¯·æ±‚ï¼ŒRedisè°ƒç”¨**accept**å‡½æ•°ä¸å…¶å»ºç«‹è¿æ¥\n2. Redisè°ƒç”¨**recv**å‡½æ•°ä»å¥—æ¥å­—ä¸­è·å–è¯·æ±‚\n3. è§£æå®¢æˆ·ç«¯è¯·æ±‚ï¼Œè·å–å‚æ•°\n4. Rediså¤„ç†æ¥è‡ªå®¢æˆ·ç«¯çš„å‚æ•°ï¼Œæœ¬ä¾‹ä¸­å°±æ˜¯è·å–keyæ‰€å¯¹åº”çš„value\n5. Redisé€šè¿‡**send**å‡½æ•°å°†ç»“æœè¿”å›ç»™å®¢æˆ·ç«¯\n\n![image-20241019154821888](https://raw.githubusercontent.com/lyydsheep/pic/main/202410191548939.png)\n\nç”±äºå¥—æ¥å­—é‡‡ç”¨é»˜è®¤é˜»å¡æ¨¡å¼ï¼Œå› æ­¤Redisåœ¨è¿›è¡Œ**acceptå’Œrecv**æ—¶å°±æœ‰å¯èƒ½å‡ºç°é˜»å¡ï¼Œæ¯”å¦‚acceptå»ºç«‹é“¾æ¥æ—¶é—´è¿‡é•¿ã€è°ƒç”¨recvåï¼Œå®¢æˆ·ç«¯è¿Ÿè¿Ÿæ²¡æœ‰å‘é€æ•°æ®ï¼Œè¿™å¯¹å•çº¿ç¨‹çš„Redisæ¥è¯´æ˜¯è‡´å‘½çš„ã€‚\n\näºæ˜¯Redisé‡‡ç”¨IOå¤šè·¯å¤ç”¨æœºåˆ¶è§£å†³é˜»å¡é—®é¢˜ã€‚åœ¨Redisä¸­ï¼Œå°†å¥—æ¥å­—è®¾ç½®æˆ**éé˜»å¡**æ¨¡å¼ï¼Œå¹¶ä¸”åŸºäºç³»ç»Ÿå‡½æ•°å°è£…äº†ä¸€ä¸ª**reactor**æ¨¡å‹ã€‚ç®€å•æ¥è¯´ï¼Œæ¯å½“æœ‰äº‹ä»¶å‘ç”Ÿï¼Œreactoræ¨¡å‹å°±é€šçŸ¥ä¸åŒçš„å¤„ç†å™¨å»å¤„ç†äº‹ä»¶ï¼Œè¿™æ ·å°±ä¸ä¼šé˜»å¡åœ¨æŸä¸€ä¸ªæ“ä½œä¸Šï¼Œå……åˆ†åˆ©ç”¨äº†CPU\n\n![image-20241019160842167](https://raw.githubusercontent.com/lyydsheep/pic/main/202410191608206.png)\n\n**âš ï¸ï¼šè¿™æ˜¯ä»æ˜¯å¹¶å‘è¿è¡Œï¼Œè€Œéå¹¶è¡Œ**\n\n## å†…å­˜æ·˜æ±°ç­–ç•¥\n\næˆ‘ä»¬çŸ¥é“Rediså°†æ‰€æœ‰çš„æ•°æ®ä¿å­˜åœ¨å†…å­˜ä¸Šï¼Œä½†æ˜¯å†…å­˜ç©ºé—´æ˜¯æœ‰é™çš„ï¼Œéšç€æ—¶é—´çš„æ¨ç§»ï¼Œæœ‰é™çš„å†…å­˜ç©ºé—´è‚¯å®šæ˜¯ä¸èƒ½æ»¡è¶³æ— é™çš„æ•°æ®ã€‚å› æ­¤ï¼ŒRediséœ€è¦é‡‡ç”¨ä¸€äº›å†…å­˜æ·˜æ±°ç­–ç•¥å°†â€œæ— ç”¨â€çš„æ•°æ®ä¸¢å¼ƒï¼Œä»¥è·å¾—æ›´å¤šçš„ç©ºé—²å†…å­˜ç©ºé—´ä¿å­˜æ•°æ®ã€‚\n\nåœ¨Redisä¸­æœ‰å¦‚ä¸‹å‡ ç§å†…å­˜æ·˜æ±°ç­–ç•¥ï¼š\n\n<img src=\"https://raw.githubusercontent.com/lyydsheep/pic/main/202410221850573.png\" alt=\"image-20241022185052519\" style=\"zoom: 50%;\" />\n\nç°ç€é‡è€ƒè™‘**LRUå’ŒLFU**ç®—æ³•\n\n### LRUç®—æ³•\n\nLRU(Least Recently Used)ç®—æ³•çš„ä¸€èˆ¬å®ç°å°±æ˜¯ç»´æŠ¤ä¸€ä¸ªæŒ‰æ—¶é—´æˆ³æœ‰åºçš„ï¼ˆåŒå‘ï¼‰é“¾è¡¨ï¼Œæ¯æ¬¡å°†é“¾è¡¨æœ«å°¾çš„èŠ‚ç‚¹æ·˜æ±°ï¼Œå³åˆ é™¤æœ€ä¹…æœªè¢«è®¿é—®çš„å…ƒç´ ã€‚\n\nRedisé‡‡ç”¨çš„æ˜¯ä¸€ç§è¿‘ä¼¼LRUç®—æ³•ï¼Œå› ä¸ºä½¿ç”¨æ­£ç»Ÿçš„LRUç®—æ³•å°±æ„å‘³ç€éœ€è¦ç»´æŠ¤ä¸€ä¸ªåŒ…å«å…¨å±€å…ƒç´ çš„é“¾è¡¨ï¼Œè¿™å¯¹äºRedisæ¥è¯´æˆæœ¬æ˜¯å·¨å¤§çš„ï¼Œæ‰€ä»¥Redisé€‰æ‹©ä¸€ç§è¿‘ä¼¼çš„LRUç®—æ³•ä½œä¸ºå†…å­˜æ·˜æ±°ç­–ç•¥ã€‚\n\nRedisä½¿ç”¨çš„è¿‘ä¼¼LRUç®—æ³•ä¼šç»´æŠ¤ä¸€ä¸ªå¤§å°ä¸º16çš„æ·˜æ±°æ± ï¼Œä¸‹é¢æ ¹æ®æ·˜æ±°æ± æ˜¯å¦æœ‰ç©ºä½™ä½ç½®è¿›è¡Œåˆ†ç±»è®¨è®ºï¼š\n\n- å½“æ·˜æ±°æ± æœªæ»¡æ—¶ï¼Œæ¯æ¬¡ä»å…¨å±€éšæœºé€‰å–5ä¸ªå…ƒç´ ï¼Œæ”¾å…¥æ± å­ä¸­ï¼Œç„¶åæ·˜æ±°æ± å­ä¸­**ç©ºé—²æ—¶é—´æœ€å¤§çš„å…ƒç´ **\n- å½“æ·˜æ±°æ± æ»¡äº†ï¼Œæ¯æ¬¡ä»å…¨å±€éšæœºé€‰å–5ä¸ªå…ƒç´ ï¼Œä½†è¿™5ä¸ªå…ƒç´ åªæœ‰ç©ºé—²æ—¶é—´å¤§äºæ± ä¸­å…ƒç´ çš„æœ€å°ç©ºé—²æ—¶é—´çš„ï¼Œæ‰ä¼šè¢«æ”¾å…¥æ± ä¸­ã€‚æœ€åå°†æ·˜æ±°æ± ä¸­ç©ºé—´æ—¶é—´æœ€å¤§çš„å…ƒç´ æ·˜æ±°\n\n","slug":"Redis/Redisè¿è¡ŒåŸç†","published":1,"date":"2024-12-27T11:03:15.343Z","updated":"2024-12-27T11:03:15.343Z","comments":1,"layout":"post","photos":[],"_id":"cm6c7md6o002sa5t29zbl1235","content":"<h1 id=\"Redisè¿è¡ŒåŸç†\"><a href=\"#Redisè¿è¡ŒåŸç†\" class=\"headerlink\" title=\"Redisè¿è¡ŒåŸç†\"></a>Redisè¿è¡ŒåŸç†</h1><h2 id=\"Redisåœ¨å†…å­˜ä¸­æ˜¯å¦‚ä½•å­˜å‚¨çš„ï¼Ÿ\"><a href=\"#Redisåœ¨å†…å­˜ä¸­æ˜¯å¦‚ä½•å­˜å‚¨çš„ï¼Ÿ\" class=\"headerlink\" title=\"Redisåœ¨å†…å­˜ä¸­æ˜¯å¦‚ä½•å­˜å‚¨çš„ï¼Ÿ\"></a>Redisåœ¨å†…å­˜ä¸­æ˜¯å¦‚ä½•å­˜å‚¨çš„ï¼Ÿ</h2><p>ç®€å•æ¥è¯´ï¼ŒRediså°±æ˜¯ä¸€ä¸ªè¿è¡Œåœ¨å†…å­˜ä¸­çš„k-vå­—å…¸ã€‚è¯´åˆ°k-vå­—å…¸ï¼Œå¾ˆå®¹æ˜“è”æƒ³åˆ°Redisåº•å±‚æ•°æ®ç»“æ„<strong>dict(HASHTABLE)<strong>ï¼Œå®é™…ä¸Šä»Cä»£ç ä¸­å¯ä»¥çœ‹å‡ºï¼ŒRedisæ•°æ®åº“å°±æ˜¯åœ¨</strong>dict</strong>åŸºç¡€ä¸Šå°è£…äº†ä¼—å¤šåŠŸèƒ½ï¼ˆ<del>è£…é¥°å™¨æ¨¡å¼ä¸‡å²ğŸ˜†</del>ï¼‰</p>\n<figure class=\"highlight c\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">typedef</span> <span class=\"class\"><span class=\"keyword\">struct</span> <span class=\"title\">redisDB</span> &#123;</span></span><br><span class=\"line\">    dict *dict;</span><br><span class=\"line\">    dict *expires;</span><br><span class=\"line\">    dict *blocking_keys;</span><br><span class=\"line\">    dict *ready_keys;</span><br><span class=\"line\">    dict *watched_keys;</span><br><span class=\"line\">    <span class=\"type\">int</span> id;</span><br><span class=\"line\">    <span class=\"type\">long</span> <span class=\"type\">long</span> avg_ttl;</span><br><span class=\"line\">    <span class=\"built_in\">list</span> *defrag_later;</span><br><span class=\"line\">&#125; redisDb;</span><br></pre></td></tr></table></figure>\n\n<p>æ ¸å¿ƒç»“æ„<strong>dict</strong>å€¼å¾—é‡ç‚¹å…³å¿ƒï¼š</p>\n<figure class=\"highlight c\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">typedef</span> <span class=\"class\"><span class=\"keyword\">struct</span> <span class=\"title\">dict</span>&#123;</span></span><br><span class=\"line\">    dictType *type; <span class=\"comment\">//ç›´çº¿dictTypeç»“æ„ï¼ŒdictTypeç»“æ„ä¸­åŒ…å«è‡ªå®šä¹‰çš„å‡½æ•°ï¼Œè¿™äº›å‡½æ•°ä½¿å¾—keyå’Œvalueèƒ½å¤Ÿå­˜å‚¨ä»»ä½•ç±»å‹çš„æ•°æ®</span></span><br><span class=\"line\">    <span class=\"type\">void</span> *privdata; <span class=\"comment\">//ç§æœ‰æ•°æ®ï¼Œä¿å­˜ç€dictTypeç»“æ„ä¸­å‡½æ•°çš„ å‚æ•°</span></span><br><span class=\"line\">    dictht ht[<span class=\"number\">2</span>]; <span class=\"comment\">//ä¸¤å¼ å“ˆå¸Œè¡¨</span></span><br><span class=\"line\">    <span class=\"type\">long</span> rehashidx; <span class=\"comment\">//rehashçš„æ ‡è®°ï¼Œrehashidx=-1è¡¨ç¤ºæ²¡æœ‰è¿›è¡Œrehashï¼Œrehashæ—¶æ¯è¿ç§»ä¸€ä¸ªæ¡¶å°±å¯¹rehashidxåŠ ä¸€</span></span><br><span class=\"line\">    <span class=\"type\">int</span> itreators;  <span class=\"comment\">//æ­£åœ¨è¿­ä»£çš„è¿­ä»£å™¨æ•°é‡</span></span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n\n<p>å½“æˆ‘ä»¬ä½¿ç”¨Rediså­˜å‚¨é”®å€¼å¯¹æ—¶ï¼Œdictå­—æ®µå­˜å‚¨è¿™å­—ç¬¦ä¸²ç±»å‹çš„keyä»¥åŠä»»æ„ç±»å‹çš„value</p>\n<img src=\"https://raw.githubusercontent.com/lyydsheep/pic/main/202410171559595.png\" alt=\"image-20241017155911540\" style=\"zoom:50%;\" />\n\n<p>é™¤äº†dictå­—æ®µï¼Œexpireå­—æ®µä¹Ÿå¾ˆé‡è¦ã€‚ä¼—æ‰€å‘¨çŸ¥ï¼ŒRedisåœ¨å­˜å‚¨k-væ—¶å¯ä»¥ä¸ºé”®å€¼å¯¹è®¾ç½®è¿‡æœŸæ—¶é—´ï¼Œæé«˜Rediså¯¹å†…å­˜çš„ä½¿ç”¨æ•ˆç‡ã€‚expireå­—å…¸ä¸­å°±å­˜å‚¨ç€å…·æœ‰è¿‡æœŸæ—¶é—´çš„é”®å€¼å¯¹ä¿¡æ¯ï¼Œå…¶ä¸­keyå°±æ˜¯é”®å€¼å¯¹çš„é”®ï¼Œè€Œvalueå°±æ˜¯å¯¹åº”çš„è¿‡æœŸæ—¶é—´ã€‚å…·ä½“å¦‚ä¸‹å›¾æ‰€ç¤ºï¼š</p>\n<img src=\"https://raw.githubusercontent.com/lyydsheep/pic/main/202410171608652.png\" alt=\"image-20241017160835599\" style=\"zoom: 67%;\" />\n\n<p>å¯ä»¥çœ‹åˆ°ï¼Œåœ¨dictå’Œexpireå…¶å®æ˜¯å…·æœ‰ä¸€äº›ç›¸åŒçš„keyçš„ï¼ŒRedisä¸ºäº†èŠ‚çœå†…å­˜å¼€é”€ï¼Œå®é™…ä¸Šå¹¶æ²¡æœ‰å­˜å‚¨äº†ä¸¤ä»½ä¸€æ¨¡ä¸€æ ·çš„keyï¼Œè€Œæ˜¯è¿›è¡Œäº†å†…å­˜å¤ç”¨æ“ä½œã€‚ä»€ä¹ˆæ„æ€ï¼Ÿç®€å•åœ°è¯´ï¼Œdictå­—å…¸å’Œexpireå­—å…¸éƒ½æŒ‡å‘äº†åŒä¸€å—å†…å­˜ç©ºé—´çš„keyã€‚ğŸŒ°ï¼šdictä¸­çš„<code>animal</code>æ‰§è¡Œå†…å­˜<code>0xababababa</code>ï¼Œexpireä¸­çš„<code>animal</code>ä¹ŸæŒ‡å‘å†…å­˜<code>0xababababa</code></p>\n<h2 id=\"Redisæ˜¯å•çº¿ç¨‹è¿˜æ˜¯å¤šçº¿ç¨‹ï¼Ÿ\"><a href=\"#Redisæ˜¯å•çº¿ç¨‹è¿˜æ˜¯å¤šçº¿ç¨‹ï¼Ÿ\" class=\"headerlink\" title=\"Redisæ˜¯å•çº¿ç¨‹è¿˜æ˜¯å¤šçº¿ç¨‹ï¼Ÿ\"></a>Redisæ˜¯å•çº¿ç¨‹è¿˜æ˜¯å¤šçº¿ç¨‹ï¼Ÿ</h2><p>å…ˆä¸Šç»“è®ºï¼ŒRedisä½œä¸ºä¸€ä¸ªèƒ½å¤Ÿé«˜æ•ˆå¤„ç†æ•°æ®è¯·æ±‚çš„ç»„ä»¶ï¼Œ<strong>ä¸»æ¨¡å—ä½¿ç”¨å•çº¿ç¨‹</strong>ï¼›<strong>è¾…åŠ©æ¨¡å—ï¼Œä¾‹å¦‚å¼‚æ­¥æ“ä½œã€ç½‘ç»œI&#x2F;Oåˆ™ä½¿ç”¨å¤šçº¿ç¨‹</strong></p>\n<blockquote>\n<p>ä¸ºä»€ä¹ˆRedisä¸»æ¨¡å—ä¸ä½¿ç”¨å¤šçº¿ç¨‹ï¼Ÿ</p>\n</blockquote>\n<p>å¦‚æœå¯¹åº•å±‚å­˜å‚¨æœ‰ä¸€å®šäº†è§£çš„è¯ï¼Œé‚£ä¹ˆå¯¹ä¸‹é¢è¿™å¼ å›¾ä¸€å®šä¸é™Œç”Ÿã€‚ï¼ˆ<a href=\"https://www.toutiao.com/article/7204821418587144736/?wid=1729307852409\">æ¥æº</a>ï¼‰</p>\n<img src=\"https://raw.githubusercontent.com/lyydsheep/pic/main/202410191118868.png\" alt=\"image-20241019111805677\" style=\"zoom:50%;\" />\n\n<p>æˆ‘ä»¬çŸ¥é“ï¼Œå¤šçº¿ç¨‹å¯ä»¥å……åˆ†åˆ©ç”¨CPUå¤šæ ¸çš„è¿ç®—èƒ½åŠ›ï¼Œä½†æ˜¯å¯¹äºä¸»è¦å·¥ä½œå†…å­˜ä¸Šçš„Redisæ¥è¯´ï¼ŒCPUå¹¶ä¸æ˜¯ä¸»è¦çš„æ€§èƒ½ç“¶é¢ˆã€‚ç”±ä¸Šå›¾æˆ‘ä»¬ä¹Ÿå¯ä»¥å¾ˆå®¹æ˜“çŒœåˆ°Redisæ€§èƒ½<strong>ä¸»è¦å—é™äºç½‘ç»œIO</strong>ã€‚</p>\n<p>å¦ä¸€æ–¹é¢ï¼ŒRedisçš„å®—æ—¨æ˜¯â€œæƒœå†…å­˜å¦‚é‡‘ï¼Œç®€å•é«˜æ•ˆâ€ï¼Œå¼•å…¥å¤šçº¿ç¨‹åè€Œå¯¼è‡´é¡¹ç›®å¤æ‚ã€ä¸æ˜“ç»´æŠ¤ï¼ŒåŒæ—¶ä¹Ÿä¼šå¸¦æ¥ä¸€å®šçš„æˆæœ¬å¼€é”€ã€‚å…·ä½“æœ‰ä»¥ä¸‹å‡ ä¸ªæ–¹é¢ï¼š</p>\n<ul>\n<li>å¼•å…¥å¤šçº¿ç¨‹åï¼ŒRedisä¸ºäº†æ”¯æŒäº‹åŠ¡çš„ACIDå°±ä¸å¾—ä¸é¢å¤–æ·»åŠ ä¸€äº›å¤æ‚çš„æ“ä½œï¼Œç”šè‡³éœ€è¦å°†åŸæœ‰çš„æ•°æ®ç»“æ„æ”¹é€ æˆå¹¶å‘å®‰å…¨çš„</li>\n<li>ä¸Šä¸‹æ–‡åˆ‡æ¢æˆæœ¬ï¼šCPUåœ¨è¿›è¡Œçº¿ç¨‹è°ƒåº¦æ—¶éœ€è¦å…ˆä¿å­˜å½“å‰çº¿ç¨‹çš„ä¸Šä¸‹æ–‡æ•°æ®ï¼Œå†åˆ‡æ¢åˆ°ä¸‹ä¸€ä¸ªçº¿ç¨‹</li>\n<li>å¤šçº¿ç¨‹åŒæ­¥æœºåˆ¶ï¼ˆåŠ é”ã€è§£é”ï¼‰ä¼šå¼•å…¥ä¸€å®šçš„CPUå¼€é”€</li>\n<li>å†…å­˜æ¶ˆè€—ï¼šæ¯ä¸€ä¸ªçº¿ç¨‹éƒ½æ˜¯å ç”¨ä¸€å®šçš„å†…å­˜èµ„æºçš„ï¼Œå¯¹äºRedisæ¥è¯´ï¼Œå†…å­˜èµ„æºååˆ†å®è´µï¼Œèƒ½çœåˆ™çœ</li>\n</ul>\n<h2 id=\"ä¸ºä»€ä¹ˆRediså•çº¿ç¨‹è¿™ä¹ˆå¿«ï¼Ÿ\"><a href=\"#ä¸ºä»€ä¹ˆRediså•çº¿ç¨‹è¿™ä¹ˆå¿«ï¼Ÿ\" class=\"headerlink\" title=\"ä¸ºä»€ä¹ˆRediså•çº¿ç¨‹è¿™ä¹ˆå¿«ï¼Ÿ\"></a>ä¸ºä»€ä¹ˆRediså•çº¿ç¨‹è¿™ä¹ˆå¿«ï¼Ÿ</h2><p>æˆ‘ä»¬çŸ¥é“ï¼ŒRedisæ˜¯å•çº¿ç¨‹å¤„ç†è¯·æ±‚ï¼Œä½†æ˜¯Rediså´èƒ½åšåˆ°10wé‡çº§çš„QPSï¼Œå…³é”®ç‚¹æœ‰ä»¥ä¸‹å‡ ä¸ªï¼š</p>\n<ul>\n<li>Rediså¤§éƒ¨åˆ†æ“ä½œéƒ½æ˜¯åœ¨å†…å­˜ä¸Šå®Œæˆçš„ï¼Œå†…å­˜æ“ä½œæœ¬èº«å°±å¾ˆå¿«</li>\n<li>Redisä¸­å„å¼å„æ ·çš„æ•°æ®ç»“æ„åº•å±‚ä¾æ®ä¸åŒåœºæ™¯é‡‡ç”¨ä¸åŒçš„ç¼–ç å®ç°æ–¹å¼ï¼Œä½¿å¾—Redisåœ¨å„ç§åœºæ™¯ä¸‹éƒ½èƒ½ä¿æŒé«˜æ€§èƒ½ï¼ˆ<a href=\"https://www.toutiao.com/article/7204821418587144736/?wid=1729307852409\">æ¥æº</a>ï¼‰<ul>\n<li><img src=\"https://raw.githubusercontent.com/lyydsheep/pic/main/202410191526662.png\" alt=\"image-20241019152651588\"></li>\n</ul>\n</li>\n<li>Redisé‡‡ç”¨IOå¤šè·¯å¤ç”¨æœºåˆ¶è§£å†³ç½‘ç»œIOé˜»å¡é—®é¢˜ï¼Œé¿å…Rediså•çº¿ç¨‹åœ¨å¤„ç†ç½‘ç»œè¯·æ±‚æ—¶é¢‘ç¹å‘ç”Ÿé˜»å¡ï¼Œæé«˜äº†Redisç½‘ç»œååé‡</li>\n</ul>\n<blockquote>\n<p> ä¸‹é¢ç€é‡è®²è®²Redisçš„ç½‘ç»œIOå¤šè·¯å¤ç”¨æœºåˆ¶</p>\n</blockquote>\n<p>ä¸€èˆ¬åœ°ï¼Œå¦‚æœæ²¡æœ‰IOå¤šè·¯å¤ç”¨ï¼Œé‚£ä¹ˆRedisæ˜¯å¦‚ä½•å¤„ç†è¯·æ±‚çš„ï¼Ÿ</p>\n<p>ğŸŒ°ä»¥ä¸€ä¸ªGETè¯·æ±‚ä¸ºä¾‹ï¼š</p>\n<ol>\n<li>å®¢æˆ·ç«¯å‘é€GETè¯·æ±‚ï¼ŒRedisè°ƒç”¨<strong>accept</strong>å‡½æ•°ä¸å…¶å»ºç«‹è¿æ¥</li>\n<li>Redisè°ƒç”¨<strong>recv</strong>å‡½æ•°ä»å¥—æ¥å­—ä¸­è·å–è¯·æ±‚</li>\n<li>è§£æå®¢æˆ·ç«¯è¯·æ±‚ï¼Œè·å–å‚æ•°</li>\n<li>Rediså¤„ç†æ¥è‡ªå®¢æˆ·ç«¯çš„å‚æ•°ï¼Œæœ¬ä¾‹ä¸­å°±æ˜¯è·å–keyæ‰€å¯¹åº”çš„value</li>\n<li>Redisé€šè¿‡<strong>send</strong>å‡½æ•°å°†ç»“æœè¿”å›ç»™å®¢æˆ·ç«¯</li>\n</ol>\n<p><img src=\"https://raw.githubusercontent.com/lyydsheep/pic/main/202410191548939.png\" alt=\"image-20241019154821888\"></p>\n<p>ç”±äºå¥—æ¥å­—é‡‡ç”¨é»˜è®¤é˜»å¡æ¨¡å¼ï¼Œå› æ­¤Redisåœ¨è¿›è¡Œ<strong>acceptå’Œrecv</strong>æ—¶å°±æœ‰å¯èƒ½å‡ºç°é˜»å¡ï¼Œæ¯”å¦‚acceptå»ºç«‹é“¾æ¥æ—¶é—´è¿‡é•¿ã€è°ƒç”¨recvåï¼Œå®¢æˆ·ç«¯è¿Ÿè¿Ÿæ²¡æœ‰å‘é€æ•°æ®ï¼Œè¿™å¯¹å•çº¿ç¨‹çš„Redisæ¥è¯´æ˜¯è‡´å‘½çš„ã€‚</p>\n<p>äºæ˜¯Redisé‡‡ç”¨IOå¤šè·¯å¤ç”¨æœºåˆ¶è§£å†³é˜»å¡é—®é¢˜ã€‚åœ¨Redisä¸­ï¼Œå°†å¥—æ¥å­—è®¾ç½®æˆ<strong>éé˜»å¡</strong>æ¨¡å¼ï¼Œå¹¶ä¸”åŸºäºç³»ç»Ÿå‡½æ•°å°è£…äº†ä¸€ä¸ª<strong>reactor</strong>æ¨¡å‹ã€‚ç®€å•æ¥è¯´ï¼Œæ¯å½“æœ‰äº‹ä»¶å‘ç”Ÿï¼Œreactoræ¨¡å‹å°±é€šçŸ¥ä¸åŒçš„å¤„ç†å™¨å»å¤„ç†äº‹ä»¶ï¼Œè¿™æ ·å°±ä¸ä¼šé˜»å¡åœ¨æŸä¸€ä¸ªæ“ä½œä¸Šï¼Œå……åˆ†åˆ©ç”¨äº†CPU</p>\n<p><img src=\"https://raw.githubusercontent.com/lyydsheep/pic/main/202410191608206.png\" alt=\"image-20241019160842167\"></p>\n<p><strong>âš ï¸ï¼šè¿™æ˜¯ä»æ˜¯å¹¶å‘è¿è¡Œï¼Œè€Œéå¹¶è¡Œ</strong></p>\n<h2 id=\"å†…å­˜æ·˜æ±°ç­–ç•¥\"><a href=\"#å†…å­˜æ·˜æ±°ç­–ç•¥\" class=\"headerlink\" title=\"å†…å­˜æ·˜æ±°ç­–ç•¥\"></a>å†…å­˜æ·˜æ±°ç­–ç•¥</h2><p>æˆ‘ä»¬çŸ¥é“Rediså°†æ‰€æœ‰çš„æ•°æ®ä¿å­˜åœ¨å†…å­˜ä¸Šï¼Œä½†æ˜¯å†…å­˜ç©ºé—´æ˜¯æœ‰é™çš„ï¼Œéšç€æ—¶é—´çš„æ¨ç§»ï¼Œæœ‰é™çš„å†…å­˜ç©ºé—´è‚¯å®šæ˜¯ä¸èƒ½æ»¡è¶³æ— é™çš„æ•°æ®ã€‚å› æ­¤ï¼ŒRediséœ€è¦é‡‡ç”¨ä¸€äº›å†…å­˜æ·˜æ±°ç­–ç•¥å°†â€œæ— ç”¨â€çš„æ•°æ®ä¸¢å¼ƒï¼Œä»¥è·å¾—æ›´å¤šçš„ç©ºé—²å†…å­˜ç©ºé—´ä¿å­˜æ•°æ®ã€‚</p>\n<p>åœ¨Redisä¸­æœ‰å¦‚ä¸‹å‡ ç§å†…å­˜æ·˜æ±°ç­–ç•¥ï¼š</p>\n<img src=\"https://raw.githubusercontent.com/lyydsheep/pic/main/202410221850573.png\" alt=\"image-20241022185052519\" style=\"zoom: 50%;\" />\n\n<p>ç°ç€é‡è€ƒè™‘<strong>LRUå’ŒLFU</strong>ç®—æ³•</p>\n<h3 id=\"LRUç®—æ³•\"><a href=\"#LRUç®—æ³•\" class=\"headerlink\" title=\"LRUç®—æ³•\"></a>LRUç®—æ³•</h3><p>LRU(Least Recently Used)ç®—æ³•çš„ä¸€èˆ¬å®ç°å°±æ˜¯ç»´æŠ¤ä¸€ä¸ªæŒ‰æ—¶é—´æˆ³æœ‰åºçš„ï¼ˆåŒå‘ï¼‰é“¾è¡¨ï¼Œæ¯æ¬¡å°†é“¾è¡¨æœ«å°¾çš„èŠ‚ç‚¹æ·˜æ±°ï¼Œå³åˆ é™¤æœ€ä¹…æœªè¢«è®¿é—®çš„å…ƒç´ ã€‚</p>\n<p>Redisé‡‡ç”¨çš„æ˜¯ä¸€ç§è¿‘ä¼¼LRUç®—æ³•ï¼Œå› ä¸ºä½¿ç”¨æ­£ç»Ÿçš„LRUç®—æ³•å°±æ„å‘³ç€éœ€è¦ç»´æŠ¤ä¸€ä¸ªåŒ…å«å…¨å±€å…ƒç´ çš„é“¾è¡¨ï¼Œè¿™å¯¹äºRedisæ¥è¯´æˆæœ¬æ˜¯å·¨å¤§çš„ï¼Œæ‰€ä»¥Redisé€‰æ‹©ä¸€ç§è¿‘ä¼¼çš„LRUç®—æ³•ä½œä¸ºå†…å­˜æ·˜æ±°ç­–ç•¥ã€‚</p>\n<p>Redisä½¿ç”¨çš„è¿‘ä¼¼LRUç®—æ³•ä¼šç»´æŠ¤ä¸€ä¸ªå¤§å°ä¸º16çš„æ·˜æ±°æ± ï¼Œä¸‹é¢æ ¹æ®æ·˜æ±°æ± æ˜¯å¦æœ‰ç©ºä½™ä½ç½®è¿›è¡Œåˆ†ç±»è®¨è®ºï¼š</p>\n<ul>\n<li>å½“æ·˜æ±°æ± æœªæ»¡æ—¶ï¼Œæ¯æ¬¡ä»å…¨å±€éšæœºé€‰å–5ä¸ªå…ƒç´ ï¼Œæ”¾å…¥æ± å­ä¸­ï¼Œç„¶åæ·˜æ±°æ± å­ä¸­<strong>ç©ºé—²æ—¶é—´æœ€å¤§çš„å…ƒç´ </strong></li>\n<li>å½“æ·˜æ±°æ± æ»¡äº†ï¼Œæ¯æ¬¡ä»å…¨å±€éšæœºé€‰å–5ä¸ªå…ƒç´ ï¼Œä½†è¿™5ä¸ªå…ƒç´ åªæœ‰ç©ºé—²æ—¶é—´å¤§äºæ± ä¸­å…ƒç´ çš„æœ€å°ç©ºé—²æ—¶é—´çš„ï¼Œæ‰ä¼šè¢«æ”¾å…¥æ± ä¸­ã€‚æœ€åå°†æ·˜æ±°æ± ä¸­ç©ºé—´æ—¶é—´æœ€å¤§çš„å…ƒç´ æ·˜æ±°</li>\n</ul>\n","excerpt":"","more":"<h1 id=\"Redisè¿è¡ŒåŸç†\"><a href=\"#Redisè¿è¡ŒåŸç†\" class=\"headerlink\" title=\"Redisè¿è¡ŒåŸç†\"></a>Redisè¿è¡ŒåŸç†</h1><h2 id=\"Redisåœ¨å†…å­˜ä¸­æ˜¯å¦‚ä½•å­˜å‚¨çš„ï¼Ÿ\"><a href=\"#Redisåœ¨å†…å­˜ä¸­æ˜¯å¦‚ä½•å­˜å‚¨çš„ï¼Ÿ\" class=\"headerlink\" title=\"Redisåœ¨å†…å­˜ä¸­æ˜¯å¦‚ä½•å­˜å‚¨çš„ï¼Ÿ\"></a>Redisåœ¨å†…å­˜ä¸­æ˜¯å¦‚ä½•å­˜å‚¨çš„ï¼Ÿ</h2><p>ç®€å•æ¥è¯´ï¼ŒRediså°±æ˜¯ä¸€ä¸ªè¿è¡Œåœ¨å†…å­˜ä¸­çš„k-vå­—å…¸ã€‚è¯´åˆ°k-vå­—å…¸ï¼Œå¾ˆå®¹æ˜“è”æƒ³åˆ°Redisåº•å±‚æ•°æ®ç»“æ„<strong>dict(HASHTABLE)<strong>ï¼Œå®é™…ä¸Šä»Cä»£ç ä¸­å¯ä»¥çœ‹å‡ºï¼ŒRedisæ•°æ®åº“å°±æ˜¯åœ¨</strong>dict</strong>åŸºç¡€ä¸Šå°è£…äº†ä¼—å¤šåŠŸèƒ½ï¼ˆ<del>è£…é¥°å™¨æ¨¡å¼ä¸‡å²ğŸ˜†</del>ï¼‰</p>\n<figure class=\"highlight c\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">typedef</span> <span class=\"class\"><span class=\"keyword\">struct</span> <span class=\"title\">redisDB</span> &#123;</span></span><br><span class=\"line\">    dict *dict;</span><br><span class=\"line\">    dict *expires;</span><br><span class=\"line\">    dict *blocking_keys;</span><br><span class=\"line\">    dict *ready_keys;</span><br><span class=\"line\">    dict *watched_keys;</span><br><span class=\"line\">    <span class=\"type\">int</span> id;</span><br><span class=\"line\">    <span class=\"type\">long</span> <span class=\"type\">long</span> avg_ttl;</span><br><span class=\"line\">    <span class=\"built_in\">list</span> *defrag_later;</span><br><span class=\"line\">&#125; redisDb;</span><br></pre></td></tr></table></figure>\n\n<p>æ ¸å¿ƒç»“æ„<strong>dict</strong>å€¼å¾—é‡ç‚¹å…³å¿ƒï¼š</p>\n<figure class=\"highlight c\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">typedef</span> <span class=\"class\"><span class=\"keyword\">struct</span> <span class=\"title\">dict</span>&#123;</span></span><br><span class=\"line\">    dictType *type; <span class=\"comment\">//ç›´çº¿dictTypeç»“æ„ï¼ŒdictTypeç»“æ„ä¸­åŒ…å«è‡ªå®šä¹‰çš„å‡½æ•°ï¼Œè¿™äº›å‡½æ•°ä½¿å¾—keyå’Œvalueèƒ½å¤Ÿå­˜å‚¨ä»»ä½•ç±»å‹çš„æ•°æ®</span></span><br><span class=\"line\">    <span class=\"type\">void</span> *privdata; <span class=\"comment\">//ç§æœ‰æ•°æ®ï¼Œä¿å­˜ç€dictTypeç»“æ„ä¸­å‡½æ•°çš„ å‚æ•°</span></span><br><span class=\"line\">    dictht ht[<span class=\"number\">2</span>]; <span class=\"comment\">//ä¸¤å¼ å“ˆå¸Œè¡¨</span></span><br><span class=\"line\">    <span class=\"type\">long</span> rehashidx; <span class=\"comment\">//rehashçš„æ ‡è®°ï¼Œrehashidx=-1è¡¨ç¤ºæ²¡æœ‰è¿›è¡Œrehashï¼Œrehashæ—¶æ¯è¿ç§»ä¸€ä¸ªæ¡¶å°±å¯¹rehashidxåŠ ä¸€</span></span><br><span class=\"line\">    <span class=\"type\">int</span> itreators;  <span class=\"comment\">//æ­£åœ¨è¿­ä»£çš„è¿­ä»£å™¨æ•°é‡</span></span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n\n<p>å½“æˆ‘ä»¬ä½¿ç”¨Rediså­˜å‚¨é”®å€¼å¯¹æ—¶ï¼Œdictå­—æ®µå­˜å‚¨è¿™å­—ç¬¦ä¸²ç±»å‹çš„keyä»¥åŠä»»æ„ç±»å‹çš„value</p>\n<img src=\"https://raw.githubusercontent.com/lyydsheep/pic/main/202410171559595.png\" alt=\"image-20241017155911540\" style=\"zoom:50%;\" />\n\n<p>é™¤äº†dictå­—æ®µï¼Œexpireå­—æ®µä¹Ÿå¾ˆé‡è¦ã€‚ä¼—æ‰€å‘¨çŸ¥ï¼ŒRedisåœ¨å­˜å‚¨k-væ—¶å¯ä»¥ä¸ºé”®å€¼å¯¹è®¾ç½®è¿‡æœŸæ—¶é—´ï¼Œæé«˜Rediså¯¹å†…å­˜çš„ä½¿ç”¨æ•ˆç‡ã€‚expireå­—å…¸ä¸­å°±å­˜å‚¨ç€å…·æœ‰è¿‡æœŸæ—¶é—´çš„é”®å€¼å¯¹ä¿¡æ¯ï¼Œå…¶ä¸­keyå°±æ˜¯é”®å€¼å¯¹çš„é”®ï¼Œè€Œvalueå°±æ˜¯å¯¹åº”çš„è¿‡æœŸæ—¶é—´ã€‚å…·ä½“å¦‚ä¸‹å›¾æ‰€ç¤ºï¼š</p>\n<img src=\"https://raw.githubusercontent.com/lyydsheep/pic/main/202410171608652.png\" alt=\"image-20241017160835599\" style=\"zoom: 67%;\" />\n\n<p>å¯ä»¥çœ‹åˆ°ï¼Œåœ¨dictå’Œexpireå…¶å®æ˜¯å…·æœ‰ä¸€äº›ç›¸åŒçš„keyçš„ï¼ŒRedisä¸ºäº†èŠ‚çœå†…å­˜å¼€é”€ï¼Œå®é™…ä¸Šå¹¶æ²¡æœ‰å­˜å‚¨äº†ä¸¤ä»½ä¸€æ¨¡ä¸€æ ·çš„keyï¼Œè€Œæ˜¯è¿›è¡Œäº†å†…å­˜å¤ç”¨æ“ä½œã€‚ä»€ä¹ˆæ„æ€ï¼Ÿç®€å•åœ°è¯´ï¼Œdictå­—å…¸å’Œexpireå­—å…¸éƒ½æŒ‡å‘äº†åŒä¸€å—å†…å­˜ç©ºé—´çš„keyã€‚ğŸŒ°ï¼šdictä¸­çš„<code>animal</code>æ‰§è¡Œå†…å­˜<code>0xababababa</code>ï¼Œexpireä¸­çš„<code>animal</code>ä¹ŸæŒ‡å‘å†…å­˜<code>0xababababa</code></p>\n<h2 id=\"Redisæ˜¯å•çº¿ç¨‹è¿˜æ˜¯å¤šçº¿ç¨‹ï¼Ÿ\"><a href=\"#Redisæ˜¯å•çº¿ç¨‹è¿˜æ˜¯å¤šçº¿ç¨‹ï¼Ÿ\" class=\"headerlink\" title=\"Redisæ˜¯å•çº¿ç¨‹è¿˜æ˜¯å¤šçº¿ç¨‹ï¼Ÿ\"></a>Redisæ˜¯å•çº¿ç¨‹è¿˜æ˜¯å¤šçº¿ç¨‹ï¼Ÿ</h2><p>å…ˆä¸Šç»“è®ºï¼ŒRedisä½œä¸ºä¸€ä¸ªèƒ½å¤Ÿé«˜æ•ˆå¤„ç†æ•°æ®è¯·æ±‚çš„ç»„ä»¶ï¼Œ<strong>ä¸»æ¨¡å—ä½¿ç”¨å•çº¿ç¨‹</strong>ï¼›<strong>è¾…åŠ©æ¨¡å—ï¼Œä¾‹å¦‚å¼‚æ­¥æ“ä½œã€ç½‘ç»œI&#x2F;Oåˆ™ä½¿ç”¨å¤šçº¿ç¨‹</strong></p>\n<blockquote>\n<p>ä¸ºä»€ä¹ˆRedisä¸»æ¨¡å—ä¸ä½¿ç”¨å¤šçº¿ç¨‹ï¼Ÿ</p>\n</blockquote>\n<p>å¦‚æœå¯¹åº•å±‚å­˜å‚¨æœ‰ä¸€å®šäº†è§£çš„è¯ï¼Œé‚£ä¹ˆå¯¹ä¸‹é¢è¿™å¼ å›¾ä¸€å®šä¸é™Œç”Ÿã€‚ï¼ˆ<a href=\"https://www.toutiao.com/article/7204821418587144736/?wid=1729307852409\">æ¥æº</a>ï¼‰</p>\n<img src=\"https://raw.githubusercontent.com/lyydsheep/pic/main/202410191118868.png\" alt=\"image-20241019111805677\" style=\"zoom:50%;\" />\n\n<p>æˆ‘ä»¬çŸ¥é“ï¼Œå¤šçº¿ç¨‹å¯ä»¥å……åˆ†åˆ©ç”¨CPUå¤šæ ¸çš„è¿ç®—èƒ½åŠ›ï¼Œä½†æ˜¯å¯¹äºä¸»è¦å·¥ä½œå†…å­˜ä¸Šçš„Redisæ¥è¯´ï¼ŒCPUå¹¶ä¸æ˜¯ä¸»è¦çš„æ€§èƒ½ç“¶é¢ˆã€‚ç”±ä¸Šå›¾æˆ‘ä»¬ä¹Ÿå¯ä»¥å¾ˆå®¹æ˜“çŒœåˆ°Redisæ€§èƒ½<strong>ä¸»è¦å—é™äºç½‘ç»œIO</strong>ã€‚</p>\n<p>å¦ä¸€æ–¹é¢ï¼ŒRedisçš„å®—æ—¨æ˜¯â€œæƒœå†…å­˜å¦‚é‡‘ï¼Œç®€å•é«˜æ•ˆâ€ï¼Œå¼•å…¥å¤šçº¿ç¨‹åè€Œå¯¼è‡´é¡¹ç›®å¤æ‚ã€ä¸æ˜“ç»´æŠ¤ï¼ŒåŒæ—¶ä¹Ÿä¼šå¸¦æ¥ä¸€å®šçš„æˆæœ¬å¼€é”€ã€‚å…·ä½“æœ‰ä»¥ä¸‹å‡ ä¸ªæ–¹é¢ï¼š</p>\n<ul>\n<li>å¼•å…¥å¤šçº¿ç¨‹åï¼ŒRedisä¸ºäº†æ”¯æŒäº‹åŠ¡çš„ACIDå°±ä¸å¾—ä¸é¢å¤–æ·»åŠ ä¸€äº›å¤æ‚çš„æ“ä½œï¼Œç”šè‡³éœ€è¦å°†åŸæœ‰çš„æ•°æ®ç»“æ„æ”¹é€ æˆå¹¶å‘å®‰å…¨çš„</li>\n<li>ä¸Šä¸‹æ–‡åˆ‡æ¢æˆæœ¬ï¼šCPUåœ¨è¿›è¡Œçº¿ç¨‹è°ƒåº¦æ—¶éœ€è¦å…ˆä¿å­˜å½“å‰çº¿ç¨‹çš„ä¸Šä¸‹æ–‡æ•°æ®ï¼Œå†åˆ‡æ¢åˆ°ä¸‹ä¸€ä¸ªçº¿ç¨‹</li>\n<li>å¤šçº¿ç¨‹åŒæ­¥æœºåˆ¶ï¼ˆåŠ é”ã€è§£é”ï¼‰ä¼šå¼•å…¥ä¸€å®šçš„CPUå¼€é”€</li>\n<li>å†…å­˜æ¶ˆè€—ï¼šæ¯ä¸€ä¸ªçº¿ç¨‹éƒ½æ˜¯å ç”¨ä¸€å®šçš„å†…å­˜èµ„æºçš„ï¼Œå¯¹äºRedisæ¥è¯´ï¼Œå†…å­˜èµ„æºååˆ†å®è´µï¼Œèƒ½çœåˆ™çœ</li>\n</ul>\n<h2 id=\"ä¸ºä»€ä¹ˆRediså•çº¿ç¨‹è¿™ä¹ˆå¿«ï¼Ÿ\"><a href=\"#ä¸ºä»€ä¹ˆRediså•çº¿ç¨‹è¿™ä¹ˆå¿«ï¼Ÿ\" class=\"headerlink\" title=\"ä¸ºä»€ä¹ˆRediså•çº¿ç¨‹è¿™ä¹ˆå¿«ï¼Ÿ\"></a>ä¸ºä»€ä¹ˆRediså•çº¿ç¨‹è¿™ä¹ˆå¿«ï¼Ÿ</h2><p>æˆ‘ä»¬çŸ¥é“ï¼ŒRedisæ˜¯å•çº¿ç¨‹å¤„ç†è¯·æ±‚ï¼Œä½†æ˜¯Rediså´èƒ½åšåˆ°10wé‡çº§çš„QPSï¼Œå…³é”®ç‚¹æœ‰ä»¥ä¸‹å‡ ä¸ªï¼š</p>\n<ul>\n<li>Rediså¤§éƒ¨åˆ†æ“ä½œéƒ½æ˜¯åœ¨å†…å­˜ä¸Šå®Œæˆçš„ï¼Œå†…å­˜æ“ä½œæœ¬èº«å°±å¾ˆå¿«</li>\n<li>Redisä¸­å„å¼å„æ ·çš„æ•°æ®ç»“æ„åº•å±‚ä¾æ®ä¸åŒåœºæ™¯é‡‡ç”¨ä¸åŒçš„ç¼–ç å®ç°æ–¹å¼ï¼Œä½¿å¾—Redisåœ¨å„ç§åœºæ™¯ä¸‹éƒ½èƒ½ä¿æŒé«˜æ€§èƒ½ï¼ˆ<a href=\"https://www.toutiao.com/article/7204821418587144736/?wid=1729307852409\">æ¥æº</a>ï¼‰<ul>\n<li><img src=\"https://raw.githubusercontent.com/lyydsheep/pic/main/202410191526662.png\" alt=\"image-20241019152651588\"></li>\n</ul>\n</li>\n<li>Redisé‡‡ç”¨IOå¤šè·¯å¤ç”¨æœºåˆ¶è§£å†³ç½‘ç»œIOé˜»å¡é—®é¢˜ï¼Œé¿å…Rediså•çº¿ç¨‹åœ¨å¤„ç†ç½‘ç»œè¯·æ±‚æ—¶é¢‘ç¹å‘ç”Ÿé˜»å¡ï¼Œæé«˜äº†Redisç½‘ç»œååé‡</li>\n</ul>\n<blockquote>\n<p> ä¸‹é¢ç€é‡è®²è®²Redisçš„ç½‘ç»œIOå¤šè·¯å¤ç”¨æœºåˆ¶</p>\n</blockquote>\n<p>ä¸€èˆ¬åœ°ï¼Œå¦‚æœæ²¡æœ‰IOå¤šè·¯å¤ç”¨ï¼Œé‚£ä¹ˆRedisæ˜¯å¦‚ä½•å¤„ç†è¯·æ±‚çš„ï¼Ÿ</p>\n<p>ğŸŒ°ä»¥ä¸€ä¸ªGETè¯·æ±‚ä¸ºä¾‹ï¼š</p>\n<ol>\n<li>å®¢æˆ·ç«¯å‘é€GETè¯·æ±‚ï¼ŒRedisè°ƒç”¨<strong>accept</strong>å‡½æ•°ä¸å…¶å»ºç«‹è¿æ¥</li>\n<li>Redisè°ƒç”¨<strong>recv</strong>å‡½æ•°ä»å¥—æ¥å­—ä¸­è·å–è¯·æ±‚</li>\n<li>è§£æå®¢æˆ·ç«¯è¯·æ±‚ï¼Œè·å–å‚æ•°</li>\n<li>Rediså¤„ç†æ¥è‡ªå®¢æˆ·ç«¯çš„å‚æ•°ï¼Œæœ¬ä¾‹ä¸­å°±æ˜¯è·å–keyæ‰€å¯¹åº”çš„value</li>\n<li>Redisé€šè¿‡<strong>send</strong>å‡½æ•°å°†ç»“æœè¿”å›ç»™å®¢æˆ·ç«¯</li>\n</ol>\n<p><img src=\"https://raw.githubusercontent.com/lyydsheep/pic/main/202410191548939.png\" alt=\"image-20241019154821888\"></p>\n<p>ç”±äºå¥—æ¥å­—é‡‡ç”¨é»˜è®¤é˜»å¡æ¨¡å¼ï¼Œå› æ­¤Redisåœ¨è¿›è¡Œ<strong>acceptå’Œrecv</strong>æ—¶å°±æœ‰å¯èƒ½å‡ºç°é˜»å¡ï¼Œæ¯”å¦‚acceptå»ºç«‹é“¾æ¥æ—¶é—´è¿‡é•¿ã€è°ƒç”¨recvåï¼Œå®¢æˆ·ç«¯è¿Ÿè¿Ÿæ²¡æœ‰å‘é€æ•°æ®ï¼Œè¿™å¯¹å•çº¿ç¨‹çš„Redisæ¥è¯´æ˜¯è‡´å‘½çš„ã€‚</p>\n<p>äºæ˜¯Redisé‡‡ç”¨IOå¤šè·¯å¤ç”¨æœºåˆ¶è§£å†³é˜»å¡é—®é¢˜ã€‚åœ¨Redisä¸­ï¼Œå°†å¥—æ¥å­—è®¾ç½®æˆ<strong>éé˜»å¡</strong>æ¨¡å¼ï¼Œå¹¶ä¸”åŸºäºç³»ç»Ÿå‡½æ•°å°è£…äº†ä¸€ä¸ª<strong>reactor</strong>æ¨¡å‹ã€‚ç®€å•æ¥è¯´ï¼Œæ¯å½“æœ‰äº‹ä»¶å‘ç”Ÿï¼Œreactoræ¨¡å‹å°±é€šçŸ¥ä¸åŒçš„å¤„ç†å™¨å»å¤„ç†äº‹ä»¶ï¼Œè¿™æ ·å°±ä¸ä¼šé˜»å¡åœ¨æŸä¸€ä¸ªæ“ä½œä¸Šï¼Œå……åˆ†åˆ©ç”¨äº†CPU</p>\n<p><img src=\"https://raw.githubusercontent.com/lyydsheep/pic/main/202410191608206.png\" alt=\"image-20241019160842167\"></p>\n<p><strong>âš ï¸ï¼šè¿™æ˜¯ä»æ˜¯å¹¶å‘è¿è¡Œï¼Œè€Œéå¹¶è¡Œ</strong></p>\n<h2 id=\"å†…å­˜æ·˜æ±°ç­–ç•¥\"><a href=\"#å†…å­˜æ·˜æ±°ç­–ç•¥\" class=\"headerlink\" title=\"å†…å­˜æ·˜æ±°ç­–ç•¥\"></a>å†…å­˜æ·˜æ±°ç­–ç•¥</h2><p>æˆ‘ä»¬çŸ¥é“Rediså°†æ‰€æœ‰çš„æ•°æ®ä¿å­˜åœ¨å†…å­˜ä¸Šï¼Œä½†æ˜¯å†…å­˜ç©ºé—´æ˜¯æœ‰é™çš„ï¼Œéšç€æ—¶é—´çš„æ¨ç§»ï¼Œæœ‰é™çš„å†…å­˜ç©ºé—´è‚¯å®šæ˜¯ä¸èƒ½æ»¡è¶³æ— é™çš„æ•°æ®ã€‚å› æ­¤ï¼ŒRediséœ€è¦é‡‡ç”¨ä¸€äº›å†…å­˜æ·˜æ±°ç­–ç•¥å°†â€œæ— ç”¨â€çš„æ•°æ®ä¸¢å¼ƒï¼Œä»¥è·å¾—æ›´å¤šçš„ç©ºé—²å†…å­˜ç©ºé—´ä¿å­˜æ•°æ®ã€‚</p>\n<p>åœ¨Redisä¸­æœ‰å¦‚ä¸‹å‡ ç§å†…å­˜æ·˜æ±°ç­–ç•¥ï¼š</p>\n<img src=\"https://raw.githubusercontent.com/lyydsheep/pic/main/202410221850573.png\" alt=\"image-20241022185052519\" style=\"zoom: 50%;\" />\n\n<p>ç°ç€é‡è€ƒè™‘<strong>LRUå’ŒLFU</strong>ç®—æ³•</p>\n<h3 id=\"LRUç®—æ³•\"><a href=\"#LRUç®—æ³•\" class=\"headerlink\" title=\"LRUç®—æ³•\"></a>LRUç®—æ³•</h3><p>LRU(Least Recently Used)ç®—æ³•çš„ä¸€èˆ¬å®ç°å°±æ˜¯ç»´æŠ¤ä¸€ä¸ªæŒ‰æ—¶é—´æˆ³æœ‰åºçš„ï¼ˆåŒå‘ï¼‰é“¾è¡¨ï¼Œæ¯æ¬¡å°†é“¾è¡¨æœ«å°¾çš„èŠ‚ç‚¹æ·˜æ±°ï¼Œå³åˆ é™¤æœ€ä¹…æœªè¢«è®¿é—®çš„å…ƒç´ ã€‚</p>\n<p>Redisé‡‡ç”¨çš„æ˜¯ä¸€ç§è¿‘ä¼¼LRUç®—æ³•ï¼Œå› ä¸ºä½¿ç”¨æ­£ç»Ÿçš„LRUç®—æ³•å°±æ„å‘³ç€éœ€è¦ç»´æŠ¤ä¸€ä¸ªåŒ…å«å…¨å±€å…ƒç´ çš„é“¾è¡¨ï¼Œè¿™å¯¹äºRedisæ¥è¯´æˆæœ¬æ˜¯å·¨å¤§çš„ï¼Œæ‰€ä»¥Redisé€‰æ‹©ä¸€ç§è¿‘ä¼¼çš„LRUç®—æ³•ä½œä¸ºå†…å­˜æ·˜æ±°ç­–ç•¥ã€‚</p>\n<p>Redisä½¿ç”¨çš„è¿‘ä¼¼LRUç®—æ³•ä¼šç»´æŠ¤ä¸€ä¸ªå¤§å°ä¸º16çš„æ·˜æ±°æ± ï¼Œä¸‹é¢æ ¹æ®æ·˜æ±°æ± æ˜¯å¦æœ‰ç©ºä½™ä½ç½®è¿›è¡Œåˆ†ç±»è®¨è®ºï¼š</p>\n<ul>\n<li>å½“æ·˜æ±°æ± æœªæ»¡æ—¶ï¼Œæ¯æ¬¡ä»å…¨å±€éšæœºé€‰å–5ä¸ªå…ƒç´ ï¼Œæ”¾å…¥æ± å­ä¸­ï¼Œç„¶åæ·˜æ±°æ± å­ä¸­<strong>ç©ºé—²æ—¶é—´æœ€å¤§çš„å…ƒç´ </strong></li>\n<li>å½“æ·˜æ±°æ± æ»¡äº†ï¼Œæ¯æ¬¡ä»å…¨å±€éšæœºé€‰å–5ä¸ªå…ƒç´ ï¼Œä½†è¿™5ä¸ªå…ƒç´ åªæœ‰ç©ºé—²æ—¶é—´å¤§äºæ± ä¸­å…ƒç´ çš„æœ€å°ç©ºé—²æ—¶é—´çš„ï¼Œæ‰ä¼šè¢«æ”¾å…¥æ± ä¸­ã€‚æœ€åå°†æ·˜æ±°æ± ä¸­ç©ºé—´æ—¶é—´æœ€å¤§çš„å…ƒç´ æ·˜æ±°</li>\n</ul>\n"},{"_content":"## MySQL\n- æ°´å¹³åˆ†è¡¨æœ‰å“ªäº›ä¸»æµæ–¹å¼ï¼Ÿåˆ†åˆ«æœ‰å“ªäº›ä¼˜ç¼ºç‚¹ä»¥åŠä½¿ç”¨åœºæ™¯ï¼Ÿåº”å¯¹ä¸šåŠ¡é‡æ‰©å¢ï¼Œå“ªç§åˆ†è¡¨æ–¹å¼æ¯”è¾ƒå¥½ï¼Ÿ\n\t- èŒƒå›´åˆ†ç‰‡\n\t\t- ç±»å‹\n\t\t\t- æ—¶é—´åˆ†ç‰‡\n\t\t\t- åœ°åŸŸåˆ†ç‰‡\n\t\t\t- å¤§å°åˆ†ç‰‡\n\t\t- ä¼˜ç‚¹\n\t\t\t- å•è¡¨æ•°æ®é‡å¯æ§\n\t\t\t- æ°´å¹³æ‰©å±•åªéœ€å¢åŠ èŠ‚ç‚¹å°±è¡Œï¼Œä¸éœ€è¦å¯¹å…¶ä»–åˆ†ç‰‡æ•°æ®è¿›è¡Œè¿ç§»\n\t\t- ç¼ºç‚¹\n\t\t\t- æŸäº›åˆ†ç‰‡å¯èƒ½å­˜åœ¨è¿ç»­çš„çƒ­ç‚¹æ•°æ®ï¼Œå¯¼è‡´æ•°æ®å€¾æ–œï¼Œæ•°æ®åº“å‹åŠ›åˆ†æ‘Šä¸å‡\n\t- hashåˆ†ç‰‡\n\t\t- ä¼˜ç‚¹\n\t\t\t- æ•°æ®åˆ†å¸ƒæ¯”è¾ƒå‡åŒ€ï¼Œä¸ä¼šå‡ºç°å¤§é‡å¤§é‡è¯·æ±‚è½åœ¨ä¸€ä¸ªæ•°æ®åº“ä¸Š\n\t\t- ç¼ºç‚¹\n\t\t\t- åœ¨é›†ç¾¤çš„ä¼¸ç¼©æ€§ä¸Šæœ‰ä¸€å®šçš„å±€é™\n\t\t- æ”¹è¿›\n\t\t\t- ä½¿ç”¨ä¸€è‡´æ€§å“ˆå¸Œç®—æ³•ï¼Œé¿å…å¤§é‡åœ°æ•°æ®è¿ç§»\n\t- æŸ¥è¡¨åˆ†ç‰‡\n\t\t- ä¼˜ç‚¹\n\t\t\t- çµæ´»æ€§é«˜\n\t\t- ç¼ºç‚¹\n\t\t\t- å¯¹æ•°æ®é‡æœ‰ä¸€å®šé™åˆ¶\n\t- æ—¥å¿—ï¼šæ•°æ®é‡å¤§ã€èŒƒå›´å±æ€§æ˜æ˜¾ ---> èŒƒå›´åˆ†ç‰‡\n\t- SaaSã€ç©å®¶æ•°æ®ï¼šæ•°é‡ä¸å¤§ã€åˆ†ç‰‡ç»´åº¦å¤šã€é¢‘ç¹è°ƒæ•´åˆ†ç‰‡ç­–ç•¥ ---> æŸ¥è¡¨åˆ†ç‰‡\n\t- ç¤¾äº¤å¹³å°ï¼šæ•°æ®é‡å¤§ã€åˆ†å¸ƒç›¸å¯¹å‡åŒ€ ---> hashåˆ†ç‰‡\n\t\n- æœ‰å“ªäº›æƒ…å†µä¼šå¯¼è‡´ä¸»ä»å»¶è¿Ÿï¼Ÿ\n- ä»åº“çš„é‡æ”¾å¯ä»¥å¹¶å‘æ‰§è¡Œå—ï¼Ÿ\n\n## Go\n- Goæ¥å£ä¸»è¦ç”¨äºè§£å†³ä»€ä¹ˆé—®é¢˜ï¼Ÿinterfaceåº•å±‚åŸç†ï¼Ÿ\n- GMPè°ƒåº¦æ¨¡å‹ï¼Ÿä¸ºä»€ä¹ˆè¦æœ‰è¿™ä¸ªPï¼Ÿåç¨‹è°ƒåº¦å’Œçº¿ç¨‹è°ƒåº¦çš„åŒºåˆ«ï¼Ÿ\n\n\n## è®¡ç®—æœºç½‘ç»œ\n- tcpæ€ä¹ˆä¿è¯å¯é æ€§ï¼Ÿ","source":"_posts/interview experience/å…¶ä»–.md","raw":"## MySQL\n- æ°´å¹³åˆ†è¡¨æœ‰å“ªäº›ä¸»æµæ–¹å¼ï¼Ÿåˆ†åˆ«æœ‰å“ªäº›ä¼˜ç¼ºç‚¹ä»¥åŠä½¿ç”¨åœºæ™¯ï¼Ÿåº”å¯¹ä¸šåŠ¡é‡æ‰©å¢ï¼Œå“ªç§åˆ†è¡¨æ–¹å¼æ¯”è¾ƒå¥½ï¼Ÿ\n\t- èŒƒå›´åˆ†ç‰‡\n\t\t- ç±»å‹\n\t\t\t- æ—¶é—´åˆ†ç‰‡\n\t\t\t- åœ°åŸŸåˆ†ç‰‡\n\t\t\t- å¤§å°åˆ†ç‰‡\n\t\t- ä¼˜ç‚¹\n\t\t\t- å•è¡¨æ•°æ®é‡å¯æ§\n\t\t\t- æ°´å¹³æ‰©å±•åªéœ€å¢åŠ èŠ‚ç‚¹å°±è¡Œï¼Œä¸éœ€è¦å¯¹å…¶ä»–åˆ†ç‰‡æ•°æ®è¿›è¡Œè¿ç§»\n\t\t- ç¼ºç‚¹\n\t\t\t- æŸäº›åˆ†ç‰‡å¯èƒ½å­˜åœ¨è¿ç»­çš„çƒ­ç‚¹æ•°æ®ï¼Œå¯¼è‡´æ•°æ®å€¾æ–œï¼Œæ•°æ®åº“å‹åŠ›åˆ†æ‘Šä¸å‡\n\t- hashåˆ†ç‰‡\n\t\t- ä¼˜ç‚¹\n\t\t\t- æ•°æ®åˆ†å¸ƒæ¯”è¾ƒå‡åŒ€ï¼Œä¸ä¼šå‡ºç°å¤§é‡å¤§é‡è¯·æ±‚è½åœ¨ä¸€ä¸ªæ•°æ®åº“ä¸Š\n\t\t- ç¼ºç‚¹\n\t\t\t- åœ¨é›†ç¾¤çš„ä¼¸ç¼©æ€§ä¸Šæœ‰ä¸€å®šçš„å±€é™\n\t\t- æ”¹è¿›\n\t\t\t- ä½¿ç”¨ä¸€è‡´æ€§å“ˆå¸Œç®—æ³•ï¼Œé¿å…å¤§é‡åœ°æ•°æ®è¿ç§»\n\t- æŸ¥è¡¨åˆ†ç‰‡\n\t\t- ä¼˜ç‚¹\n\t\t\t- çµæ´»æ€§é«˜\n\t\t- ç¼ºç‚¹\n\t\t\t- å¯¹æ•°æ®é‡æœ‰ä¸€å®šé™åˆ¶\n\t- æ—¥å¿—ï¼šæ•°æ®é‡å¤§ã€èŒƒå›´å±æ€§æ˜æ˜¾ ---> èŒƒå›´åˆ†ç‰‡\n\t- SaaSã€ç©å®¶æ•°æ®ï¼šæ•°é‡ä¸å¤§ã€åˆ†ç‰‡ç»´åº¦å¤šã€é¢‘ç¹è°ƒæ•´åˆ†ç‰‡ç­–ç•¥ ---> æŸ¥è¡¨åˆ†ç‰‡\n\t- ç¤¾äº¤å¹³å°ï¼šæ•°æ®é‡å¤§ã€åˆ†å¸ƒç›¸å¯¹å‡åŒ€ ---> hashåˆ†ç‰‡\n\t\n- æœ‰å“ªäº›æƒ…å†µä¼šå¯¼è‡´ä¸»ä»å»¶è¿Ÿï¼Ÿ\n- ä»åº“çš„é‡æ”¾å¯ä»¥å¹¶å‘æ‰§è¡Œå—ï¼Ÿ\n\n## Go\n- Goæ¥å£ä¸»è¦ç”¨äºè§£å†³ä»€ä¹ˆé—®é¢˜ï¼Ÿinterfaceåº•å±‚åŸç†ï¼Ÿ\n- GMPè°ƒåº¦æ¨¡å‹ï¼Ÿä¸ºä»€ä¹ˆè¦æœ‰è¿™ä¸ªPï¼Ÿåç¨‹è°ƒåº¦å’Œçº¿ç¨‹è°ƒåº¦çš„åŒºåˆ«ï¼Ÿ\n\n\n## è®¡ç®—æœºç½‘ç»œ\n- tcpæ€ä¹ˆä¿è¯å¯é æ€§ï¼Ÿ","slug":"interview experience/å…¶ä»–","published":1,"date":"2025-01-16T12:23:34.969Z","updated":"2025-01-17T02:49:03.403Z","title":"","comments":1,"layout":"post","photos":[],"_id":"cm6c7md6o002ua5t225vc42ay","content":"<h2 id=\"MySQL\"><a href=\"#MySQL\" class=\"headerlink\" title=\"MySQL\"></a>MySQL</h2><ul>\n<li><p>æ°´å¹³åˆ†è¡¨æœ‰å“ªäº›ä¸»æµæ–¹å¼ï¼Ÿåˆ†åˆ«æœ‰å“ªäº›ä¼˜ç¼ºç‚¹ä»¥åŠä½¿ç”¨åœºæ™¯ï¼Ÿåº”å¯¹ä¸šåŠ¡é‡æ‰©å¢ï¼Œå“ªç§åˆ†è¡¨æ–¹å¼æ¯”è¾ƒå¥½ï¼Ÿ</p>\n<ul>\n<li>èŒƒå›´åˆ†ç‰‡<ul>\n<li>ç±»å‹<ul>\n<li>æ—¶é—´åˆ†ç‰‡</li>\n<li>åœ°åŸŸåˆ†ç‰‡</li>\n<li>å¤§å°åˆ†ç‰‡</li>\n</ul>\n</li>\n<li>ä¼˜ç‚¹<ul>\n<li>å•è¡¨æ•°æ®é‡å¯æ§</li>\n<li>æ°´å¹³æ‰©å±•åªéœ€å¢åŠ èŠ‚ç‚¹å°±è¡Œï¼Œä¸éœ€è¦å¯¹å…¶ä»–åˆ†ç‰‡æ•°æ®è¿›è¡Œè¿ç§»</li>\n</ul>\n</li>\n<li>ç¼ºç‚¹<ul>\n<li>æŸäº›åˆ†ç‰‡å¯èƒ½å­˜åœ¨è¿ç»­çš„çƒ­ç‚¹æ•°æ®ï¼Œå¯¼è‡´æ•°æ®å€¾æ–œï¼Œæ•°æ®åº“å‹åŠ›åˆ†æ‘Šä¸å‡</li>\n</ul>\n</li>\n</ul>\n</li>\n<li>hashåˆ†ç‰‡<ul>\n<li>ä¼˜ç‚¹<ul>\n<li>æ•°æ®åˆ†å¸ƒæ¯”è¾ƒå‡åŒ€ï¼Œä¸ä¼šå‡ºç°å¤§é‡å¤§é‡è¯·æ±‚è½åœ¨ä¸€ä¸ªæ•°æ®åº“ä¸Š</li>\n</ul>\n</li>\n<li>ç¼ºç‚¹<ul>\n<li>åœ¨é›†ç¾¤çš„ä¼¸ç¼©æ€§ä¸Šæœ‰ä¸€å®šçš„å±€é™</li>\n</ul>\n</li>\n<li>æ”¹è¿›<ul>\n<li>ä½¿ç”¨ä¸€è‡´æ€§å“ˆå¸Œç®—æ³•ï¼Œé¿å…å¤§é‡åœ°æ•°æ®è¿ç§»</li>\n</ul>\n</li>\n</ul>\n</li>\n<li>æŸ¥è¡¨åˆ†ç‰‡<ul>\n<li>ä¼˜ç‚¹<ul>\n<li>çµæ´»æ€§é«˜</li>\n</ul>\n</li>\n<li>ç¼ºç‚¹<ul>\n<li>å¯¹æ•°æ®é‡æœ‰ä¸€å®šé™åˆ¶</li>\n</ul>\n</li>\n</ul>\n</li>\n<li>æ—¥å¿—ï¼šæ•°æ®é‡å¤§ã€èŒƒå›´å±æ€§æ˜æ˜¾ â€”&gt; èŒƒå›´åˆ†ç‰‡</li>\n<li>SaaSã€ç©å®¶æ•°æ®ï¼šæ•°é‡ä¸å¤§ã€åˆ†ç‰‡ç»´åº¦å¤šã€é¢‘ç¹è°ƒæ•´åˆ†ç‰‡ç­–ç•¥ â€”&gt; æŸ¥è¡¨åˆ†ç‰‡</li>\n<li>ç¤¾äº¤å¹³å°ï¼šæ•°æ®é‡å¤§ã€åˆ†å¸ƒç›¸å¯¹å‡åŒ€ â€”&gt; hashåˆ†ç‰‡</li>\n</ul>\n</li>\n<li><p>æœ‰å“ªäº›æƒ…å†µä¼šå¯¼è‡´ä¸»ä»å»¶è¿Ÿï¼Ÿ</p>\n</li>\n<li><p>ä»åº“çš„é‡æ”¾å¯ä»¥å¹¶å‘æ‰§è¡Œå—ï¼Ÿ</p>\n</li>\n</ul>\n<h2 id=\"Go\"><a href=\"#Go\" class=\"headerlink\" title=\"Go\"></a>Go</h2><ul>\n<li>Goæ¥å£ä¸»è¦ç”¨äºè§£å†³ä»€ä¹ˆé—®é¢˜ï¼Ÿinterfaceåº•å±‚åŸç†ï¼Ÿ</li>\n<li>GMPè°ƒåº¦æ¨¡å‹ï¼Ÿä¸ºä»€ä¹ˆè¦æœ‰è¿™ä¸ªPï¼Ÿåç¨‹è°ƒåº¦å’Œçº¿ç¨‹è°ƒåº¦çš„åŒºåˆ«ï¼Ÿ</li>\n</ul>\n<h2 id=\"è®¡ç®—æœºç½‘ç»œ\"><a href=\"#è®¡ç®—æœºç½‘ç»œ\" class=\"headerlink\" title=\"è®¡ç®—æœºç½‘ç»œ\"></a>è®¡ç®—æœºç½‘ç»œ</h2><ul>\n<li>tcpæ€ä¹ˆä¿è¯å¯é æ€§ï¼Ÿ</li>\n</ul>\n","excerpt":"","more":"<h2 id=\"MySQL\"><a href=\"#MySQL\" class=\"headerlink\" title=\"MySQL\"></a>MySQL</h2><ul>\n<li><p>æ°´å¹³åˆ†è¡¨æœ‰å“ªäº›ä¸»æµæ–¹å¼ï¼Ÿåˆ†åˆ«æœ‰å“ªäº›ä¼˜ç¼ºç‚¹ä»¥åŠä½¿ç”¨åœºæ™¯ï¼Ÿåº”å¯¹ä¸šåŠ¡é‡æ‰©å¢ï¼Œå“ªç§åˆ†è¡¨æ–¹å¼æ¯”è¾ƒå¥½ï¼Ÿ</p>\n<ul>\n<li>èŒƒå›´åˆ†ç‰‡<ul>\n<li>ç±»å‹<ul>\n<li>æ—¶é—´åˆ†ç‰‡</li>\n<li>åœ°åŸŸåˆ†ç‰‡</li>\n<li>å¤§å°åˆ†ç‰‡</li>\n</ul>\n</li>\n<li>ä¼˜ç‚¹<ul>\n<li>å•è¡¨æ•°æ®é‡å¯æ§</li>\n<li>æ°´å¹³æ‰©å±•åªéœ€å¢åŠ èŠ‚ç‚¹å°±è¡Œï¼Œä¸éœ€è¦å¯¹å…¶ä»–åˆ†ç‰‡æ•°æ®è¿›è¡Œè¿ç§»</li>\n</ul>\n</li>\n<li>ç¼ºç‚¹<ul>\n<li>æŸäº›åˆ†ç‰‡å¯èƒ½å­˜åœ¨è¿ç»­çš„çƒ­ç‚¹æ•°æ®ï¼Œå¯¼è‡´æ•°æ®å€¾æ–œï¼Œæ•°æ®åº“å‹åŠ›åˆ†æ‘Šä¸å‡</li>\n</ul>\n</li>\n</ul>\n</li>\n<li>hashåˆ†ç‰‡<ul>\n<li>ä¼˜ç‚¹<ul>\n<li>æ•°æ®åˆ†å¸ƒæ¯”è¾ƒå‡åŒ€ï¼Œä¸ä¼šå‡ºç°å¤§é‡å¤§é‡è¯·æ±‚è½åœ¨ä¸€ä¸ªæ•°æ®åº“ä¸Š</li>\n</ul>\n</li>\n<li>ç¼ºç‚¹<ul>\n<li>åœ¨é›†ç¾¤çš„ä¼¸ç¼©æ€§ä¸Šæœ‰ä¸€å®šçš„å±€é™</li>\n</ul>\n</li>\n<li>æ”¹è¿›<ul>\n<li>ä½¿ç”¨ä¸€è‡´æ€§å“ˆå¸Œç®—æ³•ï¼Œé¿å…å¤§é‡åœ°æ•°æ®è¿ç§»</li>\n</ul>\n</li>\n</ul>\n</li>\n<li>æŸ¥è¡¨åˆ†ç‰‡<ul>\n<li>ä¼˜ç‚¹<ul>\n<li>çµæ´»æ€§é«˜</li>\n</ul>\n</li>\n<li>ç¼ºç‚¹<ul>\n<li>å¯¹æ•°æ®é‡æœ‰ä¸€å®šé™åˆ¶</li>\n</ul>\n</li>\n</ul>\n</li>\n<li>æ—¥å¿—ï¼šæ•°æ®é‡å¤§ã€èŒƒå›´å±æ€§æ˜æ˜¾ â€”&gt; èŒƒå›´åˆ†ç‰‡</li>\n<li>SaaSã€ç©å®¶æ•°æ®ï¼šæ•°é‡ä¸å¤§ã€åˆ†ç‰‡ç»´åº¦å¤šã€é¢‘ç¹è°ƒæ•´åˆ†ç‰‡ç­–ç•¥ â€”&gt; æŸ¥è¡¨åˆ†ç‰‡</li>\n<li>ç¤¾äº¤å¹³å°ï¼šæ•°æ®é‡å¤§ã€åˆ†å¸ƒç›¸å¯¹å‡åŒ€ â€”&gt; hashåˆ†ç‰‡</li>\n</ul>\n</li>\n<li><p>æœ‰å“ªäº›æƒ…å†µä¼šå¯¼è‡´ä¸»ä»å»¶è¿Ÿï¼Ÿ</p>\n</li>\n<li><p>ä»åº“çš„é‡æ”¾å¯ä»¥å¹¶å‘æ‰§è¡Œå—ï¼Ÿ</p>\n</li>\n</ul>\n<h2 id=\"Go\"><a href=\"#Go\" class=\"headerlink\" title=\"Go\"></a>Go</h2><ul>\n<li>Goæ¥å£ä¸»è¦ç”¨äºè§£å†³ä»€ä¹ˆé—®é¢˜ï¼Ÿinterfaceåº•å±‚åŸç†ï¼Ÿ</li>\n<li>GMPè°ƒåº¦æ¨¡å‹ï¼Ÿä¸ºä»€ä¹ˆè¦æœ‰è¿™ä¸ªPï¼Ÿåç¨‹è°ƒåº¦å’Œçº¿ç¨‹è°ƒåº¦çš„åŒºåˆ«ï¼Ÿ</li>\n</ul>\n<h2 id=\"è®¡ç®—æœºç½‘ç»œ\"><a href=\"#è®¡ç®—æœºç½‘ç»œ\" class=\"headerlink\" title=\"è®¡ç®—æœºç½‘ç»œ\"></a>è®¡ç®—æœºç½‘ç»œ</h2><ul>\n<li>tcpæ€ä¹ˆä¿è¯å¯é æ€§ï¼Ÿ</li>\n</ul>\n"},{"_content":"## Go\n\n\n## ç®—æ³•\n\n\n## Redis\n\n\n## MySQL\n\n\n## æ“ä½œç³»ç»Ÿ\n\n\n## è®¡ç®—æœºç½‘ç»œ\n\n- åŠ å…¥æ‰‹æœºä¸Šç™»å…¥äº†é£ä¹¦ï¼Œæƒ³åœ¨PCç«¯è¿›è¡Œæ‰«ç ç™»å½•ï¼Œè¿‡ç¨‹æ˜¯æ€æ ·çš„ï¼Ÿ\n-  æœåŠ¡ç«¯æ€ä¹ˆçŸ¥é“æ‰«ç åï¼Œåº”è¯¥ç™»å…¥å“ªä¸ªè´¦å·ï¼Ÿ\n\t- [æ‰«ç ç™»å½•æµç¨‹](https://arcstack.top/md/interview/advance/advance/system-design/1-scan-code-login.html)\n\t- é£ä¹¦ --> ç³»ç»Ÿè®¾è®¡èµ„æ–™\n- ä»‹ç»ä¸€ä¸‹WebSoketçš„åŸç†\n\t- [WebSoketåŸç†](https://juejin.cn/post/7086021621542027271)\n- ä¸ºä»€ä¹ˆHTTPSæ˜¯å®‰å…¨çš„ï¼Ÿ\n\t- HTTPSé€šè¿‡TLSåè®®å¯¹æ•°æ®è¿›è¡ŒåŠ å¯†ï¼Œæä¾›æ›´é«˜çš„å®‰å…¨æ€§å’Œæ•°æ®ä¿æŠ¤\n- TLSæ¡æ‰‹è¿‡ç¨‹ä¸­ï¼ŒæœåŠ¡ç«¯çš„è¯ä¹¦æ˜¯æ€ä¹ˆéªŒè¯çš„ï¼Ÿ\n\t- å®¢æˆ·ç«¯ä½¿ç”¨è¯ä¹¦ä¸­çš„ç­¾åç®—æ³•å¯¹è¯ä¹¦è¿›è¡Œå“ˆå¸Œè®¡ç®—ï¼Œè·å¾—ç­¾å\n\t- å®¢æˆ·ç«¯ä½¿ç”¨CAå…¬é’¥å¯¹åŠ å¯†çš„ç­¾åè§£å¯†ï¼Œè·å–ç­¾å\n\t- æ¯”è¾ƒä¸¤ä¸ªç­¾åæ˜¯å¦ä¸€è‡´\n- URLé•¿åº¦æœ‰é™åˆ¶å—ï¼Ÿé™åˆ¶æ˜¯å¤šå°‘ï¼Ÿä¸ºä»€ä¹ˆè¦æœ‰é™åˆ¶ï¼Ÿ\n\t- æœ‰ï¼Œä¸åŒçš„æµè§ˆå™¨å¯¹URLé•¿åº¦çš„é™åˆ¶ä¸åŒ\n\t- æ€§èƒ½è€ƒè™‘ï¼šè¿‡é•¿çš„URLåœ¨ç½‘ç»œä¼ è¾“è¿‡ç¨‹ä¸­ä¼šå ç”¨è¾ƒå¤šçš„ç½‘ç»œå¸¦å®½å’ŒæœåŠ¡å™¨èµ„æº\n\t- ç¨‹åºï¼šä¸URLå¤„ç†ç›¸å…³çš„å†…éƒ¨ç¼“å†²åŒºå¤§å°æœ‰é™ï¼Œè¿‡é•¿çš„URLå¯èƒ½ä¼šé€ æˆç¼“å†²åŒºæº¢å‡ºï¼Œå¯¼è‡´ç¨‹åºå´©æºƒ","source":"_posts/interview experience/å­—èŠ‚è·³åŠ¨.md","raw":"## Go\n\n\n## ç®—æ³•\n\n\n## Redis\n\n\n## MySQL\n\n\n## æ“ä½œç³»ç»Ÿ\n\n\n## è®¡ç®—æœºç½‘ç»œ\n\n- åŠ å…¥æ‰‹æœºä¸Šç™»å…¥äº†é£ä¹¦ï¼Œæƒ³åœ¨PCç«¯è¿›è¡Œæ‰«ç ç™»å½•ï¼Œè¿‡ç¨‹æ˜¯æ€æ ·çš„ï¼Ÿ\n-  æœåŠ¡ç«¯æ€ä¹ˆçŸ¥é“æ‰«ç åï¼Œåº”è¯¥ç™»å…¥å“ªä¸ªè´¦å·ï¼Ÿ\n\t- [æ‰«ç ç™»å½•æµç¨‹](https://arcstack.top/md/interview/advance/advance/system-design/1-scan-code-login.html)\n\t- é£ä¹¦ --> ç³»ç»Ÿè®¾è®¡èµ„æ–™\n- ä»‹ç»ä¸€ä¸‹WebSoketçš„åŸç†\n\t- [WebSoketåŸç†](https://juejin.cn/post/7086021621542027271)\n- ä¸ºä»€ä¹ˆHTTPSæ˜¯å®‰å…¨çš„ï¼Ÿ\n\t- HTTPSé€šè¿‡TLSåè®®å¯¹æ•°æ®è¿›è¡ŒåŠ å¯†ï¼Œæä¾›æ›´é«˜çš„å®‰å…¨æ€§å’Œæ•°æ®ä¿æŠ¤\n- TLSæ¡æ‰‹è¿‡ç¨‹ä¸­ï¼ŒæœåŠ¡ç«¯çš„è¯ä¹¦æ˜¯æ€ä¹ˆéªŒè¯çš„ï¼Ÿ\n\t- å®¢æˆ·ç«¯ä½¿ç”¨è¯ä¹¦ä¸­çš„ç­¾åç®—æ³•å¯¹è¯ä¹¦è¿›è¡Œå“ˆå¸Œè®¡ç®—ï¼Œè·å¾—ç­¾å\n\t- å®¢æˆ·ç«¯ä½¿ç”¨CAå…¬é’¥å¯¹åŠ å¯†çš„ç­¾åè§£å¯†ï¼Œè·å–ç­¾å\n\t- æ¯”è¾ƒä¸¤ä¸ªç­¾åæ˜¯å¦ä¸€è‡´\n- URLé•¿åº¦æœ‰é™åˆ¶å—ï¼Ÿé™åˆ¶æ˜¯å¤šå°‘ï¼Ÿä¸ºä»€ä¹ˆè¦æœ‰é™åˆ¶ï¼Ÿ\n\t- æœ‰ï¼Œä¸åŒçš„æµè§ˆå™¨å¯¹URLé•¿åº¦çš„é™åˆ¶ä¸åŒ\n\t- æ€§èƒ½è€ƒè™‘ï¼šè¿‡é•¿çš„URLåœ¨ç½‘ç»œä¼ è¾“è¿‡ç¨‹ä¸­ä¼šå ç”¨è¾ƒå¤šçš„ç½‘ç»œå¸¦å®½å’ŒæœåŠ¡å™¨èµ„æº\n\t- ç¨‹åºï¼šä¸URLå¤„ç†ç›¸å…³çš„å†…éƒ¨ç¼“å†²åŒºå¤§å°æœ‰é™ï¼Œè¿‡é•¿çš„URLå¯èƒ½ä¼šé€ æˆç¼“å†²åŒºæº¢å‡ºï¼Œå¯¼è‡´ç¨‹åºå´©æºƒ","slug":"interview experience/å­—èŠ‚è·³åŠ¨","published":1,"date":"2025-01-12T01:25:51.005Z","updated":"2025-01-19T07:06:55.166Z","title":"","comments":1,"layout":"post","photos":[],"_id":"cm6c7md6o0030a5t20qef5jb3","content":"<h2 id=\"Go\"><a href=\"#Go\" class=\"headerlink\" title=\"Go\"></a>Go</h2><h2 id=\"ç®—æ³•\"><a href=\"#ç®—æ³•\" class=\"headerlink\" title=\"ç®—æ³•\"></a>ç®—æ³•</h2><h2 id=\"Redis\"><a href=\"#Redis\" class=\"headerlink\" title=\"Redis\"></a>Redis</h2><h2 id=\"MySQL\"><a href=\"#MySQL\" class=\"headerlink\" title=\"MySQL\"></a>MySQL</h2><h2 id=\"æ“ä½œç³»ç»Ÿ\"><a href=\"#æ“ä½œç³»ç»Ÿ\" class=\"headerlink\" title=\"æ“ä½œç³»ç»Ÿ\"></a>æ“ä½œç³»ç»Ÿ</h2><h2 id=\"è®¡ç®—æœºç½‘ç»œ\"><a href=\"#è®¡ç®—æœºç½‘ç»œ\" class=\"headerlink\" title=\"è®¡ç®—æœºç½‘ç»œ\"></a>è®¡ç®—æœºç½‘ç»œ</h2><ul>\n<li>åŠ å…¥æ‰‹æœºä¸Šç™»å…¥äº†é£ä¹¦ï¼Œæƒ³åœ¨PCç«¯è¿›è¡Œæ‰«ç ç™»å½•ï¼Œè¿‡ç¨‹æ˜¯æ€æ ·çš„ï¼Ÿ</li>\n<li>æœåŠ¡ç«¯æ€ä¹ˆçŸ¥é“æ‰«ç åï¼Œåº”è¯¥ç™»å…¥å“ªä¸ªè´¦å·ï¼Ÿ<ul>\n<li><a href=\"https://arcstack.top/md/interview/advance/advance/system-design/1-scan-code-login.html\">æ‰«ç ç™»å½•æµç¨‹</a></li>\n<li>é£ä¹¦ â€“&gt; ç³»ç»Ÿè®¾è®¡èµ„æ–™</li>\n</ul>\n</li>\n<li>ä»‹ç»ä¸€ä¸‹WebSoketçš„åŸç†<ul>\n<li><a href=\"https://juejin.cn/post/7086021621542027271\">WebSoketåŸç†</a></li>\n</ul>\n</li>\n<li>ä¸ºä»€ä¹ˆHTTPSæ˜¯å®‰å…¨çš„ï¼Ÿ<ul>\n<li>HTTPSé€šè¿‡TLSåè®®å¯¹æ•°æ®è¿›è¡ŒåŠ å¯†ï¼Œæä¾›æ›´é«˜çš„å®‰å…¨æ€§å’Œæ•°æ®ä¿æŠ¤</li>\n</ul>\n</li>\n<li>TLSæ¡æ‰‹è¿‡ç¨‹ä¸­ï¼ŒæœåŠ¡ç«¯çš„è¯ä¹¦æ˜¯æ€ä¹ˆéªŒè¯çš„ï¼Ÿ<ul>\n<li>å®¢æˆ·ç«¯ä½¿ç”¨è¯ä¹¦ä¸­çš„ç­¾åç®—æ³•å¯¹è¯ä¹¦è¿›è¡Œå“ˆå¸Œè®¡ç®—ï¼Œè·å¾—ç­¾å</li>\n<li>å®¢æˆ·ç«¯ä½¿ç”¨CAå…¬é’¥å¯¹åŠ å¯†çš„ç­¾åè§£å¯†ï¼Œè·å–ç­¾å</li>\n<li>æ¯”è¾ƒä¸¤ä¸ªç­¾åæ˜¯å¦ä¸€è‡´</li>\n</ul>\n</li>\n<li>URLé•¿åº¦æœ‰é™åˆ¶å—ï¼Ÿé™åˆ¶æ˜¯å¤šå°‘ï¼Ÿä¸ºä»€ä¹ˆè¦æœ‰é™åˆ¶ï¼Ÿ<ul>\n<li>æœ‰ï¼Œä¸åŒçš„æµè§ˆå™¨å¯¹URLé•¿åº¦çš„é™åˆ¶ä¸åŒ</li>\n<li>æ€§èƒ½è€ƒè™‘ï¼šè¿‡é•¿çš„URLåœ¨ç½‘ç»œä¼ è¾“è¿‡ç¨‹ä¸­ä¼šå ç”¨è¾ƒå¤šçš„ç½‘ç»œå¸¦å®½å’ŒæœåŠ¡å™¨èµ„æº</li>\n<li>ç¨‹åºï¼šä¸URLå¤„ç†ç›¸å…³çš„å†…éƒ¨ç¼“å†²åŒºå¤§å°æœ‰é™ï¼Œè¿‡é•¿çš„URLå¯èƒ½ä¼šé€ æˆç¼“å†²åŒºæº¢å‡ºï¼Œå¯¼è‡´ç¨‹åºå´©æºƒ</li>\n</ul>\n</li>\n</ul>\n","excerpt":"","more":"<h2 id=\"Go\"><a href=\"#Go\" class=\"headerlink\" title=\"Go\"></a>Go</h2><h2 id=\"ç®—æ³•\"><a href=\"#ç®—æ³•\" class=\"headerlink\" title=\"ç®—æ³•\"></a>ç®—æ³•</h2><h2 id=\"Redis\"><a href=\"#Redis\" class=\"headerlink\" title=\"Redis\"></a>Redis</h2><h2 id=\"MySQL\"><a href=\"#MySQL\" class=\"headerlink\" title=\"MySQL\"></a>MySQL</h2><h2 id=\"æ“ä½œç³»ç»Ÿ\"><a href=\"#æ“ä½œç³»ç»Ÿ\" class=\"headerlink\" title=\"æ“ä½œç³»ç»Ÿ\"></a>æ“ä½œç³»ç»Ÿ</h2><h2 id=\"è®¡ç®—æœºç½‘ç»œ\"><a href=\"#è®¡ç®—æœºç½‘ç»œ\" class=\"headerlink\" title=\"è®¡ç®—æœºç½‘ç»œ\"></a>è®¡ç®—æœºç½‘ç»œ</h2><ul>\n<li>åŠ å…¥æ‰‹æœºä¸Šç™»å…¥äº†é£ä¹¦ï¼Œæƒ³åœ¨PCç«¯è¿›è¡Œæ‰«ç ç™»å½•ï¼Œè¿‡ç¨‹æ˜¯æ€æ ·çš„ï¼Ÿ</li>\n<li>æœåŠ¡ç«¯æ€ä¹ˆçŸ¥é“æ‰«ç åï¼Œåº”è¯¥ç™»å…¥å“ªä¸ªè´¦å·ï¼Ÿ<ul>\n<li><a href=\"https://arcstack.top/md/interview/advance/advance/system-design/1-scan-code-login.html\">æ‰«ç ç™»å½•æµç¨‹</a></li>\n<li>é£ä¹¦ â€“&gt; ç³»ç»Ÿè®¾è®¡èµ„æ–™</li>\n</ul>\n</li>\n<li>ä»‹ç»ä¸€ä¸‹WebSoketçš„åŸç†<ul>\n<li><a href=\"https://juejin.cn/post/7086021621542027271\">WebSoketåŸç†</a></li>\n</ul>\n</li>\n<li>ä¸ºä»€ä¹ˆHTTPSæ˜¯å®‰å…¨çš„ï¼Ÿ<ul>\n<li>HTTPSé€šè¿‡TLSåè®®å¯¹æ•°æ®è¿›è¡ŒåŠ å¯†ï¼Œæä¾›æ›´é«˜çš„å®‰å…¨æ€§å’Œæ•°æ®ä¿æŠ¤</li>\n</ul>\n</li>\n<li>TLSæ¡æ‰‹è¿‡ç¨‹ä¸­ï¼ŒæœåŠ¡ç«¯çš„è¯ä¹¦æ˜¯æ€ä¹ˆéªŒè¯çš„ï¼Ÿ<ul>\n<li>å®¢æˆ·ç«¯ä½¿ç”¨è¯ä¹¦ä¸­çš„ç­¾åç®—æ³•å¯¹è¯ä¹¦è¿›è¡Œå“ˆå¸Œè®¡ç®—ï¼Œè·å¾—ç­¾å</li>\n<li>å®¢æˆ·ç«¯ä½¿ç”¨CAå…¬é’¥å¯¹åŠ å¯†çš„ç­¾åè§£å¯†ï¼Œè·å–ç­¾å</li>\n<li>æ¯”è¾ƒä¸¤ä¸ªç­¾åæ˜¯å¦ä¸€è‡´</li>\n</ul>\n</li>\n<li>URLé•¿åº¦æœ‰é™åˆ¶å—ï¼Ÿé™åˆ¶æ˜¯å¤šå°‘ï¼Ÿä¸ºä»€ä¹ˆè¦æœ‰é™åˆ¶ï¼Ÿ<ul>\n<li>æœ‰ï¼Œä¸åŒçš„æµè§ˆå™¨å¯¹URLé•¿åº¦çš„é™åˆ¶ä¸åŒ</li>\n<li>æ€§èƒ½è€ƒè™‘ï¼šè¿‡é•¿çš„URLåœ¨ç½‘ç»œä¼ è¾“è¿‡ç¨‹ä¸­ä¼šå ç”¨è¾ƒå¤šçš„ç½‘ç»œå¸¦å®½å’ŒæœåŠ¡å™¨èµ„æº</li>\n<li>ç¨‹åºï¼šä¸URLå¤„ç†ç›¸å…³çš„å†…éƒ¨ç¼“å†²åŒºå¤§å°æœ‰é™ï¼Œè¿‡é•¿çš„URLå¯èƒ½ä¼šé€ æˆç¼“å†²åŒºæº¢å‡ºï¼Œå¯¼è‡´ç¨‹åºå´©æºƒ</li>\n</ul>\n</li>\n</ul>\n"},{"_content":"## Go\n\n\n## ç®—æ³•\n\n\n## Redis\n- RedisåŸºæœ¬æ•°æ®ç±»å‹\n\t- Stringã€Setã€ZSetã€å­—å…¸ã€List\n- å­—ç¬¦ä¸²åº•å±‚çš„å®ç°ï¼Ÿ\n\t- å­—ç¬¦ä¸²åº•å±‚æ˜¯ä¸€ä¸ªStringå¯¹è±¡ï¼Œæœ‰ä¸‰ç§ç¼–ç æ–¹å¼ï¼šINTã€EMBSTRã€RAWã€‚å¦‚æœæ˜¯å­˜å‚¨ä¸€ä¸ªlongçš„æ•´æ•°ï¼Œé‚£ä¹ˆä½¿ç”¨INTå‹ç¼–ç ï¼›å¦‚æœæ˜¯å­˜å­—ç¬¦ä¸²ä¸”å­—ç¬¦ä¸²é•¿åº¦å°äºä¸€å®šé˜ˆå€¼ï¼Œé‚£ä¹ˆå°±ç”¨EMBSTRç¼–ç ï¼Œå¦åˆ™å°±ç”¨RAWç¼–ç \n- ZSetçš„åº•å±‚å®ç°ï¼Ÿ\n\t- ZSetåº•å±‚æä¾›äº†ä¸¤ç§ç¼–ç æ–¹å¼ï¼šziplistç¼–ç æˆ–è€…æ˜¯skiplist + å­—å…¸\n\t- å½“ZSetä¸­çš„å…ƒç´ ä¸ªæ•°å°äº128å¹¶ä¸”ï¼Œæ‰€æœ‰å…ƒç´ çš„é•¿åº¦å°äº64å­—èŠ‚ï¼Œé‚£ä¹ˆå°±ä½¿ç”¨ziplistç¼–ç æ–¹å¼ï¼Œå¦åˆ™é‡‡ç”¨skip list + å­—å…¸çš„ç¼–ç æ–¹å¼\n- RedisæŒä¹…åŒ–æ–¹å¼ï¼Ÿ\n\t- AOFæˆ–RDB\n- Rediså†…å­˜æ»¡äº†æ€ä¹ˆåŠï¼Ÿ\n\t- çœ‹æ˜¯å¦å¼€å¯äº†å†…å­˜æ·˜æ±°ç­–ç•¥\n\t\t- æ²¡æœ‰å¼€å¯å†…å­˜æ·˜æ±°ç­–ç•¥ï¼šå¦‚æœæ­¤æ—¶å†…å­˜æ»¡äº†ï¼Œå†™å…¥æ“ä½œå°±ä¼šå¤±è´¥ï¼Œä½†æ˜¯ä¸ä¼šæ·˜æ±°å·²æœ‰çš„æ•°æ®\n\t\t- å¼€å¯å†…å­˜æ·˜æ±°ç­–ç•¥ï¼šæŒ‰ç…§è§„åˆ™è¿›è¡Œæ·˜æ±°\n\t\t\t- åˆ†ä¸ºä¸¤å¤§ç±»ï¼Œä¸€ä¸ªæ˜¯åŸºäºæœ‰è¿‡æœŸæ—¶é—´çš„æ•°æ®æ·˜æ±°ç­–ç•¥ï¼Œå¦ä¸€ä¸ªæ˜¯é’ˆå¯¹å…¨å±€æ•°æ®çš„æ·˜æ±°ç­–ç•¥ã€‚è¿™ä¸¤ç§éƒ½æ”¯æŒLRUã€LFUã€Randomç®—æ³•ï¼Œå…¶ä¸­åŸºäºè¿‡æœŸæ—¶é—´çš„è¿˜æ”¯æŒæ ¹æ®ttlå¤§å°æ·˜æ±°\n- Redisç¼“å­˜ç©¿é€æ˜¯ä»€ä¹ˆï¼Ÿå¦‚ä½•è§£å†³ï¼Ÿ\n- ç¼“å­˜å‡»ç©¿å‘¢ï¼Ÿ\n- ä½¿ç”¨Redisä¸€ä¸ªforå¾ªç¯ï¼Œæ¯æ¬¡éƒ½å»getRedis(key)ï¼Œæ€ä¹ˆå»ä¼˜åŒ–ï¼Ÿ\n\t- mgetå‘½ä»¤ï¼Œæ‰¹é‡è¯»å–\n\t- luaè„šæœ¬\n- åˆ†å¸ƒå¼é”è¿˜æœ‰å“ªäº›å®ç°æ–¹å¼ï¼Ÿ**ï¼ˆä¼˜åŒ–å¤œå¸‚ï¼Œå¾…å­¦ä¹ ï¼‰**\n- Redisæ˜¯å¦‚ä½•å®ç°é«˜å¯ç”¨çš„ï¼Ÿ\n- äº†è§£ä¸€è‡´æ€§å“ˆå¸Œå—ï¼Ÿ**ï¼ˆå¾…å­¦ä¹ ï¼‰**\n\n\n## MySQL\n- ä½ çŸ¥é“å“ªäº›åˆ†åº“åˆ†è¡¨çš„è®¾è®¡å—ï¼Ÿ\n- åˆ†å¸ƒå¼äº‹åŠ¡çš„è§£å†³æ–¹å¼ï¼Ÿï¼ˆå¾…å­¦ä¹ ï¼‰\n- åˆ†åº“åˆ†è¡¨ä¸‹çš„æ•°æ®è¿ç§»ï¼Ÿï¼ˆåˆ†åº“åˆ†è¡¨çš„é—®é¢˜å¤œå¸‚ï¼‰\n\t- ä»åº“æ–¹æ¡ˆ\n\t- åŒå†™æ–¹æ¡ˆ\n- å…¨å±€IDå®ç°æ–¹å¼\n\t- é›ªèŠ±\n\t- leaf\n\t- uuid\n\t- MySQLã€Redis\n\n\n\n## æ“ä½œç³»ç»Ÿ\n\n\n## è®¡ç®—æœºç½‘ç»œ\n","source":"_posts/interview experience/é˜¿é‡Œå·´å·´.md","raw":"## Go\n\n\n## ç®—æ³•\n\n\n## Redis\n- RedisåŸºæœ¬æ•°æ®ç±»å‹\n\t- Stringã€Setã€ZSetã€å­—å…¸ã€List\n- å­—ç¬¦ä¸²åº•å±‚çš„å®ç°ï¼Ÿ\n\t- å­—ç¬¦ä¸²åº•å±‚æ˜¯ä¸€ä¸ªStringå¯¹è±¡ï¼Œæœ‰ä¸‰ç§ç¼–ç æ–¹å¼ï¼šINTã€EMBSTRã€RAWã€‚å¦‚æœæ˜¯å­˜å‚¨ä¸€ä¸ªlongçš„æ•´æ•°ï¼Œé‚£ä¹ˆä½¿ç”¨INTå‹ç¼–ç ï¼›å¦‚æœæ˜¯å­˜å­—ç¬¦ä¸²ä¸”å­—ç¬¦ä¸²é•¿åº¦å°äºä¸€å®šé˜ˆå€¼ï¼Œé‚£ä¹ˆå°±ç”¨EMBSTRç¼–ç ï¼Œå¦åˆ™å°±ç”¨RAWç¼–ç \n- ZSetçš„åº•å±‚å®ç°ï¼Ÿ\n\t- ZSetåº•å±‚æä¾›äº†ä¸¤ç§ç¼–ç æ–¹å¼ï¼šziplistç¼–ç æˆ–è€…æ˜¯skiplist + å­—å…¸\n\t- å½“ZSetä¸­çš„å…ƒç´ ä¸ªæ•°å°äº128å¹¶ä¸”ï¼Œæ‰€æœ‰å…ƒç´ çš„é•¿åº¦å°äº64å­—èŠ‚ï¼Œé‚£ä¹ˆå°±ä½¿ç”¨ziplistç¼–ç æ–¹å¼ï¼Œå¦åˆ™é‡‡ç”¨skip list + å­—å…¸çš„ç¼–ç æ–¹å¼\n- RedisæŒä¹…åŒ–æ–¹å¼ï¼Ÿ\n\t- AOFæˆ–RDB\n- Rediså†…å­˜æ»¡äº†æ€ä¹ˆåŠï¼Ÿ\n\t- çœ‹æ˜¯å¦å¼€å¯äº†å†…å­˜æ·˜æ±°ç­–ç•¥\n\t\t- æ²¡æœ‰å¼€å¯å†…å­˜æ·˜æ±°ç­–ç•¥ï¼šå¦‚æœæ­¤æ—¶å†…å­˜æ»¡äº†ï¼Œå†™å…¥æ“ä½œå°±ä¼šå¤±è´¥ï¼Œä½†æ˜¯ä¸ä¼šæ·˜æ±°å·²æœ‰çš„æ•°æ®\n\t\t- å¼€å¯å†…å­˜æ·˜æ±°ç­–ç•¥ï¼šæŒ‰ç…§è§„åˆ™è¿›è¡Œæ·˜æ±°\n\t\t\t- åˆ†ä¸ºä¸¤å¤§ç±»ï¼Œä¸€ä¸ªæ˜¯åŸºäºæœ‰è¿‡æœŸæ—¶é—´çš„æ•°æ®æ·˜æ±°ç­–ç•¥ï¼Œå¦ä¸€ä¸ªæ˜¯é’ˆå¯¹å…¨å±€æ•°æ®çš„æ·˜æ±°ç­–ç•¥ã€‚è¿™ä¸¤ç§éƒ½æ”¯æŒLRUã€LFUã€Randomç®—æ³•ï¼Œå…¶ä¸­åŸºäºè¿‡æœŸæ—¶é—´çš„è¿˜æ”¯æŒæ ¹æ®ttlå¤§å°æ·˜æ±°\n- Redisç¼“å­˜ç©¿é€æ˜¯ä»€ä¹ˆï¼Ÿå¦‚ä½•è§£å†³ï¼Ÿ\n- ç¼“å­˜å‡»ç©¿å‘¢ï¼Ÿ\n- ä½¿ç”¨Redisä¸€ä¸ªforå¾ªç¯ï¼Œæ¯æ¬¡éƒ½å»getRedis(key)ï¼Œæ€ä¹ˆå»ä¼˜åŒ–ï¼Ÿ\n\t- mgetå‘½ä»¤ï¼Œæ‰¹é‡è¯»å–\n\t- luaè„šæœ¬\n- åˆ†å¸ƒå¼é”è¿˜æœ‰å“ªäº›å®ç°æ–¹å¼ï¼Ÿ**ï¼ˆä¼˜åŒ–å¤œå¸‚ï¼Œå¾…å­¦ä¹ ï¼‰**\n- Redisæ˜¯å¦‚ä½•å®ç°é«˜å¯ç”¨çš„ï¼Ÿ\n- äº†è§£ä¸€è‡´æ€§å“ˆå¸Œå—ï¼Ÿ**ï¼ˆå¾…å­¦ä¹ ï¼‰**\n\n\n## MySQL\n- ä½ çŸ¥é“å“ªäº›åˆ†åº“åˆ†è¡¨çš„è®¾è®¡å—ï¼Ÿ\n- åˆ†å¸ƒå¼äº‹åŠ¡çš„è§£å†³æ–¹å¼ï¼Ÿï¼ˆå¾…å­¦ä¹ ï¼‰\n- åˆ†åº“åˆ†è¡¨ä¸‹çš„æ•°æ®è¿ç§»ï¼Ÿï¼ˆåˆ†åº“åˆ†è¡¨çš„é—®é¢˜å¤œå¸‚ï¼‰\n\t- ä»åº“æ–¹æ¡ˆ\n\t- åŒå†™æ–¹æ¡ˆ\n- å…¨å±€IDå®ç°æ–¹å¼\n\t- é›ªèŠ±\n\t- leaf\n\t- uuid\n\t- MySQLã€Redis\n\n\n\n## æ“ä½œç³»ç»Ÿ\n\n\n## è®¡ç®—æœºç½‘ç»œ\n","slug":"interview experience/é˜¿é‡Œå·´å·´","published":1,"date":"2025-01-19T07:13:49.096Z","updated":"2025-01-20T14:29:55.728Z","title":"","comments":1,"layout":"post","photos":[],"_id":"cm6c7md6o0031a5t2a2m28sev","content":"<h2 id=\"Go\"><a href=\"#Go\" class=\"headerlink\" title=\"Go\"></a>Go</h2><h2 id=\"ç®—æ³•\"><a href=\"#ç®—æ³•\" class=\"headerlink\" title=\"ç®—æ³•\"></a>ç®—æ³•</h2><h2 id=\"Redis\"><a href=\"#Redis\" class=\"headerlink\" title=\"Redis\"></a>Redis</h2><ul>\n<li>RedisåŸºæœ¬æ•°æ®ç±»å‹<ul>\n<li>Stringã€Setã€ZSetã€å­—å…¸ã€List</li>\n</ul>\n</li>\n<li>å­—ç¬¦ä¸²åº•å±‚çš„å®ç°ï¼Ÿ<ul>\n<li>å­—ç¬¦ä¸²åº•å±‚æ˜¯ä¸€ä¸ªStringå¯¹è±¡ï¼Œæœ‰ä¸‰ç§ç¼–ç æ–¹å¼ï¼šINTã€EMBSTRã€RAWã€‚å¦‚æœæ˜¯å­˜å‚¨ä¸€ä¸ªlongçš„æ•´æ•°ï¼Œé‚£ä¹ˆä½¿ç”¨INTå‹ç¼–ç ï¼›å¦‚æœæ˜¯å­˜å­—ç¬¦ä¸²ä¸”å­—ç¬¦ä¸²é•¿åº¦å°äºä¸€å®šé˜ˆå€¼ï¼Œé‚£ä¹ˆå°±ç”¨EMBSTRç¼–ç ï¼Œå¦åˆ™å°±ç”¨RAWç¼–ç </li>\n</ul>\n</li>\n<li>ZSetçš„åº•å±‚å®ç°ï¼Ÿ<ul>\n<li>ZSetåº•å±‚æä¾›äº†ä¸¤ç§ç¼–ç æ–¹å¼ï¼šziplistç¼–ç æˆ–è€…æ˜¯skiplist + å­—å…¸</li>\n<li>å½“ZSetä¸­çš„å…ƒç´ ä¸ªæ•°å°äº128å¹¶ä¸”ï¼Œæ‰€æœ‰å…ƒç´ çš„é•¿åº¦å°äº64å­—èŠ‚ï¼Œé‚£ä¹ˆå°±ä½¿ç”¨ziplistç¼–ç æ–¹å¼ï¼Œå¦åˆ™é‡‡ç”¨skip list + å­—å…¸çš„ç¼–ç æ–¹å¼</li>\n</ul>\n</li>\n<li>RedisæŒä¹…åŒ–æ–¹å¼ï¼Ÿ<ul>\n<li>AOFæˆ–RDB</li>\n</ul>\n</li>\n<li>Rediså†…å­˜æ»¡äº†æ€ä¹ˆåŠï¼Ÿ<ul>\n<li>çœ‹æ˜¯å¦å¼€å¯äº†å†…å­˜æ·˜æ±°ç­–ç•¥<ul>\n<li>æ²¡æœ‰å¼€å¯å†…å­˜æ·˜æ±°ç­–ç•¥ï¼šå¦‚æœæ­¤æ—¶å†…å­˜æ»¡äº†ï¼Œå†™å…¥æ“ä½œå°±ä¼šå¤±è´¥ï¼Œä½†æ˜¯ä¸ä¼šæ·˜æ±°å·²æœ‰çš„æ•°æ®</li>\n<li>å¼€å¯å†…å­˜æ·˜æ±°ç­–ç•¥ï¼šæŒ‰ç…§è§„åˆ™è¿›è¡Œæ·˜æ±°<ul>\n<li>åˆ†ä¸ºä¸¤å¤§ç±»ï¼Œä¸€ä¸ªæ˜¯åŸºäºæœ‰è¿‡æœŸæ—¶é—´çš„æ•°æ®æ·˜æ±°ç­–ç•¥ï¼Œå¦ä¸€ä¸ªæ˜¯é’ˆå¯¹å…¨å±€æ•°æ®çš„æ·˜æ±°ç­–ç•¥ã€‚è¿™ä¸¤ç§éƒ½æ”¯æŒLRUã€LFUã€Randomç®—æ³•ï¼Œå…¶ä¸­åŸºäºè¿‡æœŸæ—¶é—´çš„è¿˜æ”¯æŒæ ¹æ®ttlå¤§å°æ·˜æ±°</li>\n</ul>\n</li>\n</ul>\n</li>\n</ul>\n</li>\n<li>Redisç¼“å­˜ç©¿é€æ˜¯ä»€ä¹ˆï¼Ÿå¦‚ä½•è§£å†³ï¼Ÿ</li>\n<li>ç¼“å­˜å‡»ç©¿å‘¢ï¼Ÿ</li>\n<li>ä½¿ç”¨Redisä¸€ä¸ªforå¾ªç¯ï¼Œæ¯æ¬¡éƒ½å»getRedis(key)ï¼Œæ€ä¹ˆå»ä¼˜åŒ–ï¼Ÿ<ul>\n<li>mgetå‘½ä»¤ï¼Œæ‰¹é‡è¯»å–</li>\n<li>luaè„šæœ¬</li>\n</ul>\n</li>\n<li>åˆ†å¸ƒå¼é”è¿˜æœ‰å“ªäº›å®ç°æ–¹å¼ï¼Ÿ<strong>ï¼ˆä¼˜åŒ–å¤œå¸‚ï¼Œå¾…å­¦ä¹ ï¼‰</strong></li>\n<li>Redisæ˜¯å¦‚ä½•å®ç°é«˜å¯ç”¨çš„ï¼Ÿ</li>\n<li>äº†è§£ä¸€è‡´æ€§å“ˆå¸Œå—ï¼Ÿ<strong>ï¼ˆå¾…å­¦ä¹ ï¼‰</strong></li>\n</ul>\n<h2 id=\"MySQL\"><a href=\"#MySQL\" class=\"headerlink\" title=\"MySQL\"></a>MySQL</h2><ul>\n<li>ä½ çŸ¥é“å“ªäº›åˆ†åº“åˆ†è¡¨çš„è®¾è®¡å—ï¼Ÿ</li>\n<li>åˆ†å¸ƒå¼äº‹åŠ¡çš„è§£å†³æ–¹å¼ï¼Ÿï¼ˆå¾…å­¦ä¹ ï¼‰</li>\n<li>åˆ†åº“åˆ†è¡¨ä¸‹çš„æ•°æ®è¿ç§»ï¼Ÿï¼ˆåˆ†åº“åˆ†è¡¨çš„é—®é¢˜å¤œå¸‚ï¼‰<ul>\n<li>ä»åº“æ–¹æ¡ˆ</li>\n<li>åŒå†™æ–¹æ¡ˆ</li>\n</ul>\n</li>\n<li>å…¨å±€IDå®ç°æ–¹å¼<ul>\n<li>é›ªèŠ±</li>\n<li>leaf</li>\n<li>uuid</li>\n<li>MySQLã€Redis</li>\n</ul>\n</li>\n</ul>\n<h2 id=\"æ“ä½œç³»ç»Ÿ\"><a href=\"#æ“ä½œç³»ç»Ÿ\" class=\"headerlink\" title=\"æ“ä½œç³»ç»Ÿ\"></a>æ“ä½œç³»ç»Ÿ</h2><h2 id=\"è®¡ç®—æœºç½‘ç»œ\"><a href=\"#è®¡ç®—æœºç½‘ç»œ\" class=\"headerlink\" title=\"è®¡ç®—æœºç½‘ç»œ\"></a>è®¡ç®—æœºç½‘ç»œ</h2>","excerpt":"","more":"<h2 id=\"Go\"><a href=\"#Go\" class=\"headerlink\" title=\"Go\"></a>Go</h2><h2 id=\"ç®—æ³•\"><a href=\"#ç®—æ³•\" class=\"headerlink\" title=\"ç®—æ³•\"></a>ç®—æ³•</h2><h2 id=\"Redis\"><a href=\"#Redis\" class=\"headerlink\" title=\"Redis\"></a>Redis</h2><ul>\n<li>RedisåŸºæœ¬æ•°æ®ç±»å‹<ul>\n<li>Stringã€Setã€ZSetã€å­—å…¸ã€List</li>\n</ul>\n</li>\n<li>å­—ç¬¦ä¸²åº•å±‚çš„å®ç°ï¼Ÿ<ul>\n<li>å­—ç¬¦ä¸²åº•å±‚æ˜¯ä¸€ä¸ªStringå¯¹è±¡ï¼Œæœ‰ä¸‰ç§ç¼–ç æ–¹å¼ï¼šINTã€EMBSTRã€RAWã€‚å¦‚æœæ˜¯å­˜å‚¨ä¸€ä¸ªlongçš„æ•´æ•°ï¼Œé‚£ä¹ˆä½¿ç”¨INTå‹ç¼–ç ï¼›å¦‚æœæ˜¯å­˜å­—ç¬¦ä¸²ä¸”å­—ç¬¦ä¸²é•¿åº¦å°äºä¸€å®šé˜ˆå€¼ï¼Œé‚£ä¹ˆå°±ç”¨EMBSTRç¼–ç ï¼Œå¦åˆ™å°±ç”¨RAWç¼–ç </li>\n</ul>\n</li>\n<li>ZSetçš„åº•å±‚å®ç°ï¼Ÿ<ul>\n<li>ZSetåº•å±‚æä¾›äº†ä¸¤ç§ç¼–ç æ–¹å¼ï¼šziplistç¼–ç æˆ–è€…æ˜¯skiplist + å­—å…¸</li>\n<li>å½“ZSetä¸­çš„å…ƒç´ ä¸ªæ•°å°äº128å¹¶ä¸”ï¼Œæ‰€æœ‰å…ƒç´ çš„é•¿åº¦å°äº64å­—èŠ‚ï¼Œé‚£ä¹ˆå°±ä½¿ç”¨ziplistç¼–ç æ–¹å¼ï¼Œå¦åˆ™é‡‡ç”¨skip list + å­—å…¸çš„ç¼–ç æ–¹å¼</li>\n</ul>\n</li>\n<li>RedisæŒä¹…åŒ–æ–¹å¼ï¼Ÿ<ul>\n<li>AOFæˆ–RDB</li>\n</ul>\n</li>\n<li>Rediså†…å­˜æ»¡äº†æ€ä¹ˆåŠï¼Ÿ<ul>\n<li>çœ‹æ˜¯å¦å¼€å¯äº†å†…å­˜æ·˜æ±°ç­–ç•¥<ul>\n<li>æ²¡æœ‰å¼€å¯å†…å­˜æ·˜æ±°ç­–ç•¥ï¼šå¦‚æœæ­¤æ—¶å†…å­˜æ»¡äº†ï¼Œå†™å…¥æ“ä½œå°±ä¼šå¤±è´¥ï¼Œä½†æ˜¯ä¸ä¼šæ·˜æ±°å·²æœ‰çš„æ•°æ®</li>\n<li>å¼€å¯å†…å­˜æ·˜æ±°ç­–ç•¥ï¼šæŒ‰ç…§è§„åˆ™è¿›è¡Œæ·˜æ±°<ul>\n<li>åˆ†ä¸ºä¸¤å¤§ç±»ï¼Œä¸€ä¸ªæ˜¯åŸºäºæœ‰è¿‡æœŸæ—¶é—´çš„æ•°æ®æ·˜æ±°ç­–ç•¥ï¼Œå¦ä¸€ä¸ªæ˜¯é’ˆå¯¹å…¨å±€æ•°æ®çš„æ·˜æ±°ç­–ç•¥ã€‚è¿™ä¸¤ç§éƒ½æ”¯æŒLRUã€LFUã€Randomç®—æ³•ï¼Œå…¶ä¸­åŸºäºè¿‡æœŸæ—¶é—´çš„è¿˜æ”¯æŒæ ¹æ®ttlå¤§å°æ·˜æ±°</li>\n</ul>\n</li>\n</ul>\n</li>\n</ul>\n</li>\n<li>Redisç¼“å­˜ç©¿é€æ˜¯ä»€ä¹ˆï¼Ÿå¦‚ä½•è§£å†³ï¼Ÿ</li>\n<li>ç¼“å­˜å‡»ç©¿å‘¢ï¼Ÿ</li>\n<li>ä½¿ç”¨Redisä¸€ä¸ªforå¾ªç¯ï¼Œæ¯æ¬¡éƒ½å»getRedis(key)ï¼Œæ€ä¹ˆå»ä¼˜åŒ–ï¼Ÿ<ul>\n<li>mgetå‘½ä»¤ï¼Œæ‰¹é‡è¯»å–</li>\n<li>luaè„šæœ¬</li>\n</ul>\n</li>\n<li>åˆ†å¸ƒå¼é”è¿˜æœ‰å“ªäº›å®ç°æ–¹å¼ï¼Ÿ<strong>ï¼ˆä¼˜åŒ–å¤œå¸‚ï¼Œå¾…å­¦ä¹ ï¼‰</strong></li>\n<li>Redisæ˜¯å¦‚ä½•å®ç°é«˜å¯ç”¨çš„ï¼Ÿ</li>\n<li>äº†è§£ä¸€è‡´æ€§å“ˆå¸Œå—ï¼Ÿ<strong>ï¼ˆå¾…å­¦ä¹ ï¼‰</strong></li>\n</ul>\n<h2 id=\"MySQL\"><a href=\"#MySQL\" class=\"headerlink\" title=\"MySQL\"></a>MySQL</h2><ul>\n<li>ä½ çŸ¥é“å“ªäº›åˆ†åº“åˆ†è¡¨çš„è®¾è®¡å—ï¼Ÿ</li>\n<li>åˆ†å¸ƒå¼äº‹åŠ¡çš„è§£å†³æ–¹å¼ï¼Ÿï¼ˆå¾…å­¦ä¹ ï¼‰</li>\n<li>åˆ†åº“åˆ†è¡¨ä¸‹çš„æ•°æ®è¿ç§»ï¼Ÿï¼ˆåˆ†åº“åˆ†è¡¨çš„é—®é¢˜å¤œå¸‚ï¼‰<ul>\n<li>ä»åº“æ–¹æ¡ˆ</li>\n<li>åŒå†™æ–¹æ¡ˆ</li>\n</ul>\n</li>\n<li>å…¨å±€IDå®ç°æ–¹å¼<ul>\n<li>é›ªèŠ±</li>\n<li>leaf</li>\n<li>uuid</li>\n<li>MySQLã€Redis</li>\n</ul>\n</li>\n</ul>\n<h2 id=\"æ“ä½œç³»ç»Ÿ\"><a href=\"#æ“ä½œç³»ç»Ÿ\" class=\"headerlink\" title=\"æ“ä½œç³»ç»Ÿ\"></a>æ“ä½œç³»ç»Ÿ</h2><h2 id=\"è®¡ç®—æœºç½‘ç»œ\"><a href=\"#è®¡ç®—æœºç½‘ç»œ\" class=\"headerlink\" title=\"è®¡ç®—æœºç½‘ç»œ\"></a>è®¡ç®—æœºç½‘ç»œ</h2>"}],"PostAsset":[],"PostCategory":[],"PostTag":[{"post_id":"cm6c7md6f0001a5t2d10u8ihd","tag_id":"cm6c7md6g0003a5t2a0lid5zs","_id":"cm6c7md6h0007a5t2cs6f4s0p"},{"post_id":"cm6c7md6h0008a5t29qz25cih","tag_id":"cm6c7md6h000aa5t237ofenzg","_id":"cm6c7md6i000fa5t2d4185rcx"},{"post_id":"cm6c7md6h0009a5t29ppedzne","tag_id":"cm6c7md6i000ea5t2g8qodjsu","_id":"cm6c7md6i000ka5t27aizflfe"},{"post_id":"cm6c7md6h000ca5t2a1jdepaq","tag_id":"cm6c7md6i000ia5t2gp803833","_id":"cm6c7md6i000oa5t2gzi0a2ob"},{"post_id":"cm6c7md6h000da5t2cs692rgb","tag_id":"cm6c7md6i000ma5t20b13drlx","_id":"cm6c7md6j000sa5t2awmh6ukg"},{"post_id":"cm6c7md6i000pa5t2233r35uc","tag_id":"cm6c7md6i000ea5t2g8qodjsu","_id":"cm6c7md6j000ua5t2ahm47h6c"},{"post_id":"cm6c7md6i000ha5t27jvj6lzt","tag_id":"cm6c7md6i000qa5t2brz66nqm","_id":"cm6c7md6j000xa5t2h1845qkc"},{"post_id":"cm6c7md6i000ja5t21uba1ks8","tag_id":"cm6c7md6j000wa5t28sue4frg","_id":"cm6c7md6j0012a5t22g4obug8"},{"post_id":"cm6c7md6j0011a5t24hlzhtnu","tag_id":"cm6c7md6j0010a5t2d92h0p26","_id":"cm6c7md6j0015a5t26de956wy"},{"post_id":"cm6c7md6i000la5t21dfo2257","tag_id":"cm6c7md6j0010a5t2d92h0p26","_id":"cm6c7md6j0017a5t22cazg3vt"},{"post_id":"cm6c7md6l001aa5t26g27ffq2","tag_id":"cm6c7md6j0010a5t2d92h0p26","_id":"cm6c7md6l001ca5t2dbjudsd6"},{"post_id":"cm6c7md6l001ba5t2dt3q415q","tag_id":"cm6c7md6j0010a5t2d92h0p26","_id":"cm6c7md6l001fa5t2fgywhhma"},{"post_id":"cm6c7md6i000na5t297ug5by3","tag_id":"cm6c7md6j0014a5t24fbgga4g","_id":"cm6c7md6l001ha5t2g61w7pmi"},{"post_id":"cm6c7md6i000na5t297ug5by3","tag_id":"cm6c7md6k0019a5t21efeg4k3","_id":"cm6c7md6l001ka5t2dpez355x"},{"post_id":"cm6c7md6j000ta5t26mn0f4ae","tag_id":"cm6c7md6l001ea5t2277u3428","_id":"cm6c7md6l001ma5t29e164kdh"},{"post_id":"cm6c7md6j000va5t2aa62c9mc","tag_id":"cm6c7md6i000ma5t20b13drlx","_id":"cm6c7md6m001qa5t2672mdf06"},{"post_id":"cm6c7md6j000va5t2aa62c9mc","tag_id":"cm6c7md6l001ja5t220v67t15","_id":"cm6c7md6m001sa5t2fuap88kn"},{"post_id":"cm6c7md6j000ya5t249oj8dxi","tag_id":"cm6c7md6l001ea5t2277u3428","_id":"cm6c7md6m001va5t2hf7u4hol"},{"post_id":"cm6c7md6m001ra5t24ban8agk","tag_id":"cm6c7md6i000ma5t20b13drlx","_id":"cm6c7md6m001xa5t26lmzdf7r"},{"post_id":"cm6c7md6k0018a5t20hb54uqq","tag_id":"cm6c7md6l001ea5t2277u3428","_id":"cm6c7md6m0020a5t2djfkcalk"},{"post_id":"cm6c7md6m001wa5t217u41wql","tag_id":"cm6c7md6i000ma5t20b13drlx","_id":"cm6c7md6m0022a5t21heq275s"},{"post_id":"cm6c7md6m001za5t2ex0zfbv6","tag_id":"cm6c7md6i000ma5t20b13drlx","_id":"cm6c7md6m0024a5t27dw6bgz0"},{"post_id":"cm6c7md6m001za5t2ex0zfbv6","tag_id":"cm6c7md6l001ea5t2277u3428","_id":"cm6c7md6m0026a5t241ga16xy"},{"post_id":"cm6c7md6l001na5t2bas2f99k","tag_id":"cm6c7md6m001ya5t201275jna","_id":"cm6c7md6n0028a5t2edve7hnr"},{"post_id":"cm6c7md6m0021a5t2fa347a3p","tag_id":"cm6c7md6i000ma5t20b13drlx","_id":"cm6c7md6n002aa5t2di98gk9x"},{"post_id":"cm6c7md6m0021a5t2fa347a3p","tag_id":"cm6c7md6l001ja5t220v67t15","_id":"cm6c7md6n002ca5t29oprdk3e"},{"post_id":"cm6c7md6m0025a5t2bpi200c0","tag_id":"cm6c7md6i000ma5t20b13drlx","_id":"cm6c7md6n002fa5t2214s1wms"},{"post_id":"cm6c7md6m0025a5t2bpi200c0","tag_id":"cm6c7md6l001ja5t220v67t15","_id":"cm6c7md6n002ha5t24n5x4yre"},{"post_id":"cm6c7md6n0027a5t2ak4rf36m","tag_id":"cm6c7md6i000ma5t20b13drlx","_id":"cm6c7md6n002ja5t23fet4au5"},{"post_id":"cm6c7md6n0027a5t2ak4rf36m","tag_id":"cm6c7md6l001ja5t220v67t15","_id":"cm6c7md6n002la5t25qhk2c8u"},{"post_id":"cm6c7md6n002ga5t2h5t613uy","tag_id":"cm6c7md6n002da5t248qs9f2x","_id":"cm6c7md6n002na5t2dlli1mws"},{"post_id":"cm6c7md6n0029a5t23h4se78m","tag_id":"cm6c7md6n002da5t248qs9f2x","_id":"cm6c7md6n002pa5t29h8meprz"},{"post_id":"cm6c7md6n002ia5t22exeelcy","tag_id":"cm6c7md6n002da5t248qs9f2x","_id":"cm6c7md6o002ra5t2gru22fxx"},{"post_id":"cm6c7md6n002qa5t25va14by5","tag_id":"cm6c7md6o002ta5t25b6z2rf6","_id":"cm6c7md6o002xa5t2bbxearmx"},{"post_id":"cm6c7md6n002qa5t25va14by5","tag_id":"cm6c7md6o002va5t25pniajge","_id":"cm6c7md6o002ya5t2faxq9yep"},{"post_id":"cm6c7md6o002sa5t29zbl1235","tag_id":"cm6c7md6o002ta5t25b6z2rf6","_id":"cm6c7md6o002za5t2a8ky9swb"}],"Tag":[{"name":"Docker","_id":"cm6c7md6g0003a5t2a0lid5zs"},{"name":"Git","_id":"cm6c7md6h000aa5t237ofenzg"},{"name":"Golang","_id":"cm6c7md6i000ea5t2g8qodjsu"},{"name":"é…ç½®","_id":"cm6c7md6i000ia5t2gp803833"},{"name":"Go","_id":"cm6c7md6i000ma5t20b13drlx"},{"name":"ä¼˜è´¨æ–‡ç« ","_id":"cm6c7md6i000qa5t2brz66nqm"},{"name":"è®¾è®¡æ¨¡å¼","_id":"cm6c7md6j000wa5t28sue4frg"},{"name":"è®¡ç®—æœºç½‘ç»œ","_id":"cm6c7md6j0010a5t2d92h0p26"},{"name":"å¼€æºå·¥å…·","_id":"cm6c7md6j0014a5t24fbgga4g"},{"name":"èµ„æº","_id":"cm6c7md6k0019a5t21efeg4k3"},{"name":"é¡¹ç›®","_id":"cm6c7md6l001ea5t2277u3428"},{"name":"å­¦ä¹ ","_id":"cm6c7md6l001ja5t220v67t15"},{"name":"excalidraw","_id":"cm6c7md6m001ya5t201275jna"},{"name":"MySQL","_id":"cm6c7md6n002da5t248qs9f2x"},{"name":"Redis","_id":"cm6c7md6o002ta5t25b6z2rf6"},{"name":"æ•°æ®ç»“æ„","_id":"cm6c7md6o002va5t25pniajge"}]}}